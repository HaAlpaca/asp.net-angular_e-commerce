(self.webpackChunkclient=self.webpackChunkclient||[]).push([[179],{6019:(yi,on,ue)=>{"use strict";ue.d(on,{B:()=>En});var C=ue(7579),De=ue(6063);class Xe extends C.x{constructor(ii=1/0,hn=1/0,Vn=De.l){super(),this._bufferSize=ii,this._windowTime=hn,this._timestampProvider=Vn,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=hn===1/0,this._bufferSize=Math.max(1,ii),this._windowTime=Math.max(1,hn)}next(ii){const{isStopped:hn,_buffer:Vn,_infiniteTimeWindow:hi,_timestampProvider:Te,_windowTime:_t}=this;hn||(Vn.push(ii),!hi&&Vn.push(Te.now()+_t)),this._trimBuffer(),super.next(ii)}_subscribe(ii){this._throwIfClosed(),this._trimBuffer();const hn=this._innerSubscribe(ii),{_infiniteTimeWindow:Vn,_buffer:hi}=this,Te=hi.slice();for(let _t=0;_t<Te.length&&!ii.closed;_t+=Vn?1:2)ii.next(Te[_t]);return this._checkFinalizedStatuses(ii),hn}_trimBuffer(){const{_bufferSize:ii,_timestampProvider:hn,_buffer:Vn,_infiniteTimeWindow:hi}=this,Te=(hi?1:2)*ii;if(ii<1/0&&Te<Vn.length&&Vn.splice(0,Vn.length-Te),!hi){const _t=hn.now();let Ue=0;for(let Ye=1;Ye<Vn.length&&Vn[Ye]<=_t;Ye+=2)Ue=Ye;Ue&&Vn.splice(0,Ue+1)}}}var s=ue(9646),ct=ue(4004),de=ue(2340),Et=ue(529),qt=ue(1571);const gt=new qt.OlP("JWT_OPTIONS");let jt=(()=>{class dn{constructor(hn=null){this.tokenGetter=hn&&hn.tokenGetter||function(){}}urlBase64Decode(hn){let Vn=hn.replace(/-/g,"+").replace(/_/g,"/");switch(Vn.length%4){case 0:break;case 2:Vn+="==";break;case 3:Vn+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(Vn)}b64decode(hn){let hi="";if((hn=String(hn).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let _t,Ue,Te=0,Ye=0;Ue=hn.charAt(Ye++);~Ue&&(_t=Te%4?64*_t+Ue:Ue,Te++%4)?hi+=String.fromCharCode(255&_t>>(-2*Te&6)):0)Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(Ue);return hi}b64DecodeUnicode(hn){return decodeURIComponent(Array.prototype.map.call(this.b64decode(hn),Vn=>"%"+("00"+Vn.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(hn=this.tokenGetter()){return hn instanceof Promise?hn.then(Vn=>this._decodeToken(Vn)):this._decodeToken(hn)}_decodeToken(hn){if(!hn||""===hn)return null;const Vn=hn.split(".");if(3!==Vn.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const hi=this.urlBase64Decode(Vn[1]);if(!hi)throw new Error("Cannot decode the token.");return JSON.parse(hi)}getTokenExpirationDate(hn=this.tokenGetter()){return hn instanceof Promise?hn.then(Vn=>this._getTokenExpirationDate(Vn)):this._getTokenExpirationDate(hn)}_getTokenExpirationDate(hn){let Vn;if(Vn=this.decodeToken(hn),!Vn||!Vn.hasOwnProperty("exp"))return null;const hi=new Date(0);return hi.setUTCSeconds(Vn.exp),hi}isTokenExpired(hn=this.tokenGetter(),Vn){return hn instanceof Promise?hn.then(hi=>this._isTokenExpired(hi,Vn)):this._isTokenExpired(hn,Vn)}_isTokenExpired(hn,Vn){if(!hn||""===hn)return!0;const hi=this.getTokenExpirationDate(hn);return Vn=Vn||0,null!==hi&&!(hi.valueOf()>(new Date).valueOf()+1e3*Vn)}getAuthScheme(hn,Vn){return"function"==typeof hn?hn(Vn):hn}}return dn.\u0275fac=function(hn){return new(hn||dn)(qt.LFG(gt))},dn.\u0275prov=qt.Yz7({token:dn,factory:dn.\u0275fac}),dn})();var Sn=ue(9838);let En=(()=>{class dn{constructor(hn,Vn){this.http=hn,this.router=Vn,this.baseUrl=de.N.apiUrl,this.currentUserSource=new Xe(1),this.currentUser$=this.currentUserSource.asObservable(),this.currentUserRole=new Xe(1),this.currentRole$=this.currentUserRole.asObservable()}loadCurrentUser(hn){if(null===hn)return this.currentUserSource.next(null),(0,s.of)(null);let Vn=new Et.WM;return Vn=Vn.set("Authorization",`Bearer ${hn}`),this.http.get(this.baseUrl+"account",{headers:Vn}).pipe((0,ct.U)(hi=>hi?(localStorage.setItem("token",hi.token),this.currentUserSource.next(hi),hi):null))}login(hn){return this.http.post(this.baseUrl+"account/login",hn).pipe((0,ct.U)(Vn=>{localStorage.setItem("token",Vn.token),this.currentUserSource.next(Vn)}))}register(hn){return this.http.post(this.baseUrl+"account/register",hn).pipe((0,ct.U)(Vn=>(localStorage.setItem("token",Vn.token),this.currentUserSource.next(Vn),Vn)))}logout(){localStorage.removeItem("token"),this.currentUserSource.next(null),this.currentUserRole.next(null),this.router.navigateByUrl("/")}checkEmailExists(hn){return this.http.get(this.baseUrl+"account/emailExists?email="+hn)}getUserAddress(){return this.http.get(this.baseUrl+"account/address")}updateUserAddress(hn){return this.http.put(this.baseUrl+"account/address",hn)}getRoleFromToken(hn){return null==hn?null:{role:(new jt).decodeToken(hn).role}}static#e=this.\u0275fac=function(Vn){return new(Vn||dn)(qt.LFG(Et.eN),qt.LFG(Sn.F0))};static#t=this.\u0275prov=qt.Yz7({token:dn,factory:dn.\u0275fac,providedIn:"root"})}return dn})()},5866:(yi,on,ue)=>{"use strict";ue.d(on,{v:()=>qt});var C=ue(1135),De=ue(4004),Xe=ue(2340),s=ue(8653);class ct{constructor(){this.id=s(),this.items=[],this.shippingPrice=0}}var de=ue(1571),Et=ue(529);let qt=(()=>{class gt{constructor(wt){this.http=wt,this.baseUrl=Xe.N.apiUrl,this.basketSource=new C.X(null),this.basketSource$=this.basketSource.asObservable(),this.basketTotalSource=new C.X(null),this.basketTotalSource$=this.basketTotalSource.asObservable()}createPaymentIntent(){return this.http.post(this.baseUrl+"payments/"+this.getCurrentBasketValue()?.id,{}).pipe((0,De.U)(wt=>{this.basketSource.next(wt),console.log(wt)}))}setShippingPrice(wt){const Gt=this.getCurrentBasketValue();Gt&&(Gt.shippingPrice=wt.price,Gt.deliveryMethodId=wt.id,this.setBasket(Gt))}getBasket(wt){return this.http.get(this.baseUrl+"basket?id="+wt).subscribe({next:Gt=>{this.basketSource.next(Gt),this.calculateTotals()}})}setBasket(wt){return this.http.post(this.baseUrl+"basket",wt).subscribe({next:Gt=>{this.basketSource.next(Gt),this.calculateTotals()}})}getCurrentBasketValue(){return this.basketSource.value}addItemToBasket(wt,Gt=1){this.isProduct(wt)&&(wt=this.mapProductItemToBasket(wt)),console.log(wt);const Kn=this.getCurrentBasketValue()??this.createBasket();Kn.items=this.addOrUpdateItem(Kn.items,wt,Gt),this.setBasket(Kn)}removeItemFromBasket(wt,Gt=1){const Kn=this.getCurrentBasketValue();if(!Kn)return;const Sn=Kn.items.find(En=>En.id===wt);Sn&&(Sn.quantity-=Gt,0===Sn.quantity&&(Kn.items=Kn.items.filter(En=>En.id!==wt)),Kn.items.length>0?this.setBasket(Kn):this.deleteBasket(Kn))}deleteBasket(wt){return this.http.delete(this.baseUrl+"basket?id="+wt.id).subscribe({next:()=>{this.basketSource.next(null),this.basketTotalSource.next(null),localStorage.removeItem("basket_id")}})}deleteLocalBasket(){this.basketSource.next(null),this.basketTotalSource.next(null),localStorage.removeItem("basket_id")}addOrUpdateItem(wt,Gt,Kn){const Sn=wt.find(En=>En.id===Gt.id);return Sn?Sn.quantity+=Kn:(Gt.quantity=Kn,wt.push(Gt)),wt}createBasket(){const wt=new ct;return localStorage.setItem("basket_Id",wt.id),wt}mapProductItemToBasket(wt){return{id:wt.id,productName:wt.name,price:wt.price,quantity:0,pictureUrl:wt.pictureUrl,brand:wt.productBrand,type:wt.productType}}calculateTotals(){const wt=this.getCurrentBasketValue();if(!wt)return;const Gt=wt.items.reduce((Sn,En)=>En.price*En.quantity+Sn,0);this.basketTotalSource.next({shipping:wt.shippingPrice,total:Gt+wt.shippingPrice,subtotal:Gt})}isProduct(wt){return void 0!==wt.productBrand}static#e=this.\u0275fac=function(Gt){return new(Gt||gt)(de.LFG(Et.eN))};static#t=this.\u0275prov=de.Yz7({token:gt,factory:gt.\u0275fac,providedIn:"root"})}return gt})()},4466:(yi,on,ue)=>{"use strict";ue.d(on,{m:()=>jt});var C=ue(6895),De=ue(2521),Xe=ue(433),s=ue(371),ct=ue(7817),de=ue(2216),Et=ue(6875),qt=ue(9838),gt=ue(1571);let jt=(()=>{class wt{static#e=this.\u0275fac=function(Sn){return new(Sn||wt)};static#t=this.\u0275mod=gt.oAB({type:wt});static#n=this.\u0275inj=gt.cJS({imports:[de.uH,C.ez,De.u3.forRoot(),Xe.UX,s.bB,ct.mr.forRoot(),Et.U5,qt.Bz,De.u3,Xe.UX,ct.mr,Et.U5]})}return wt})()},4333:(yi,on,ue)=>{"use strict";ue.r(on),ue.d(on,{ShopModule:()=>xt});var C=ue(6895),De=ue(2216),Xe=ue(4466),s=ue(9838);class ct{constructor(){this.brandId=0,this.typeId=0,this.sort="name",this.pageNumber=1,this.pageSize=6,this.search=""}}var de=ue(1571),Et=ue(529),qt=ue(2340);let gt=(()=>{class ht{constructor(Ne){this.http=Ne,this.baseUrl=qt.N.apiUrl}getProducts(Ne){let Pe=new Et.LE;return Ne.brandId>0&&(Pe=Pe.append("brandId",Ne.brandId)),Ne.typeId>0&&(Pe=Pe.append("typeId",Ne.typeId)),Pe=Pe.append("sort",Ne.sort),Pe=Pe.append("pageIndex",Ne.pageNumber),Pe=Pe.append("pageSize",Ne.pageSize),Ne.search&&(Pe=Pe.append("search",Ne.search)),this.http.get(this.baseUrl+"products",{params:Pe})}getProduct(Ne){return this.http.get(this.baseUrl+"products/"+Ne)}getBrands(){return this.http.get(this.baseUrl+"products/brands")}getTypes(){return this.http.get(this.baseUrl+"products/types")}static#e=this.\u0275fac=function(Pe){return new(Pe||ht)(de.LFG(Et.eN))};static#t=this.\u0275prov=de.Yz7({token:ht,factory:ht.\u0275fac,providedIn:"root"})}return ht})();function jt(ht,st){if(1&ht&&(de.TgZ(0,"span"),de._uU(1,"Showing "),de.TgZ(2,"strong"),de._uU(3),de.qZA(),de._uU(4," of "),de.TgZ(5,"strong"),de._uU(6),de.qZA(),de._uU(7," Results "),de.qZA()),2&ht){const Ne=de.oxw(2);de.xp6(3),de.AsE("",(Ne.pageNumber-1)*Ne.pageSize+1," - ",Ne.pageNumber*Ne.pageSize>Ne.totalCount?Ne.totalCount:Ne.pageNumber*Ne.pageSize," "),de.xp6(3),de.Oqu(Ne.totalCount)}}function wt(ht,st){1&ht&&(de.TgZ(0,"span"),de._uU(1,"There is "),de.TgZ(2,"strong"),de._uU(3,"0"),de.qZA(),de._uU(4," result "),de.qZA())}function Gt(ht,st){if(1&ht&&(de.TgZ(0,"header"),de.YNc(1,jt,8,3,"span",0),de.YNc(2,wt,5,0,"span",0),de.qZA()),2&ht){const Ne=de.oxw();de.xp6(1),de.Q6J("ngIf",Ne.totalCount>0),de.xp6(1),de.Q6J("ngIf",0==Ne.totalCount)}}let Kn=(()=>{class ht{static#e=this.\u0275fac=function(Pe){return new(Pe||ht)};static#t=this.\u0275cmp=de.Xpm({type:ht,selectors:[["app-paging-header"]],inputs:{pageNumber:"pageNumber",pageSize:"pageSize",totalCount:"totalCount"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(Pe,Ke){1&Pe&&de.YNc(0,Gt,3,2,"header",0),2&Pe&&de.Q6J("ngIf",Ke.totalCount&&Ke.pageNumber&&Ke.pageSize)},dependencies:[C.O5]})}return ht})();var Sn=ue(2521);function En(ht,st){if(1&ht){const Ne=de.EpF();de.TgZ(0,"pagination",1),de.NdJ("pageChanged",function(Ke){de.CHM(Ne);const Bt=de.oxw();return de.KtG(Bt.onPagerChange(Ke))}),de.qZA()}if(2&ht){const Ne=de.oxw();de.Q6J("boundaryLinks",!0)("totalItems",Ne.totalCount)("itemsPerPage",Ne.pageSize)("maxSize",10)}}let dn=(()=>{class ht{constructor(){this.pageChanged=new de.vpe}onPagerChange(Ne){this.pageChanged.emit(Ne.page)}static#e=this.\u0275fac=function(Pe){return new(Pe||ht)};static#t=this.\u0275cmp=de.Xpm({type:ht,selectors:[["app-pager"]],inputs:{totalCount:"totalCount",pageSize:"pageSize"},outputs:{pageChanged:"pageChanged"},decls:1,vars:1,consts:[["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",3,"boundaryLinks","totalItems","itemsPerPage","maxSize","pageChanged",4,"ngIf"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",3,"boundaryLinks","totalItems","itemsPerPage","maxSize","pageChanged"]],template:function(Pe,Ke){1&Pe&&de.YNc(0,En,1,4,"pagination",0),2&Pe&&de.Q6J("ngIf",Ke.totalCount&&Ke.pageSize)},dependencies:[C.O5,Sn.Qt]})}return ht})();var ii=ue(433),hn=ue(2687),Vn=ue(5866);function hi(ht,st){if(1&ht){const Ne=de.EpF();de.TgZ(0,"div",1)(1,"div",2),de._UZ(2,"img",3),de.TgZ(3,"div",4)(4,"button",5),de.NdJ("click",function(){de.CHM(Ne);const Ke=de.oxw();return de.KtG(Ke.addItemToBasket())}),de._UZ(5,"fa-icon",6)(6,"i",7),de.qZA(),de.TgZ(7,"button",8),de._uU(8,"View"),de.qZA()()(),de.TgZ(9,"div",9)(10,"a",10)(11,"h6",11),de._uU(12),de.qZA()(),de.TgZ(13,"span",12),de._uU(14),de.ALo(15,"currency"),de.qZA()()()}if(2&ht){const Ne=de.oxw();de.xp6(2),de.s9C("src",Ne.product.pictureUrl,de.LSH),de.s9C("alt",Ne.product.name),de.xp6(3),de.Q6J("icon",Ne.faCartShopping),de.xp6(2),de.MGl("routerLink","/shop/",Ne.product.id,""),de.xp6(5),de.hij(" ",Ne.product.name," "),de.xp6(2),de.hij("",de.lcZ(15,6,Ne.product.price)," ")}}let Te=(()=>{class ht{constructor(Ne){this.basketService=Ne,this.faCartShopping=hn.yYj}addItemToBasket(){this.product&&this.basketService.addItemToBasket(this.product)}static#e=this.\u0275fac=function(Pe){return new(Pe||ht)(de.Y36(Vn.v))};static#t=this.\u0275cmp=de.Xpm({type:ht,selectors:[["app-product-item"]],inputs:{product:"product"},decls:1,vars:1,consts:[["class","card h-100 shadow-sm",4,"ngIf"],[1,"card","h-100","shadow-sm"],[1,"image","position-relative",2,"cursor","pointer"],[1,"img-fluid","bg-info",3,"src","alt"],[1,"d-flex","justify-content-center","align-items-center","hover-overlay"],[1,"btn","btn-primary","me-2",3,"click"],[3,"icon"],[1,"fa-solid","fa-cart-shopping"],[1,"btn","btn-primary",3,"routerLink"],[1,"card-body","d-flex","flex-column"],["href","",1,"text-decoration-none"],[1,"text-uppercase"],[1,"mb-2"]],template:function(Pe,Ke){1&Pe&&de.YNc(0,hi,16,8,"div",0),2&Pe&&de.Q6J("ngIf",Ke.product)},dependencies:[C.O5,De.BN,s.rH,C.H9],styles:[".btn[_ngcontent-%COMP%]{width:30%;height:40px}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{opacity:1}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]{transform:none;opacity:1}.hover-overlay[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;background-color:#ffffff80;opacity:0;transition:all .5s}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{z-index:1000;transition:all .5}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{transform:translate(-20px)}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{transform:translate(20px)}"]})}return ht})();const _t=["search"];function Ue(ht,st){if(1&ht&&(de.TgZ(0,"option",21),de._uU(1),de.qZA()),2&ht){const Ne=st.$implicit;de.Q6J("value",Ne.value),de.xp6(1),de.Oqu(Ne.name)}}function Ye(ht,st){if(1&ht){const Ne=de.EpF();de.TgZ(0,"li",22),de.NdJ("click",function(){const Bt=de.CHM(Ne).$implicit,mi=de.oxw(2);return de.KtG(mi.onBrandSelected(Bt.id))}),de._uU(1),de.qZA()}if(2&ht){const Ne=st.$implicit,Pe=de.oxw(2);de.ekj("active",Ne.id===Pe.shopParam.brandId),de.Q6J("value",Ne.id),de.xp6(1),de.hij(" ",Ne.name," ")}}function Pt(ht,st){if(1&ht){const Ne=de.EpF();de.TgZ(0,"li",22),de.NdJ("click",function(){const Bt=de.CHM(Ne).$implicit,mi=de.oxw(2);return de.KtG(mi.onTypeSelected(Bt.id))}),de._uU(1),de.qZA()}if(2&ht){const Ne=st.$implicit,Pe=de.oxw(2);de.ekj("active",Ne.id===Pe.shopParam.typeId),de.Q6J("value",Ne.id),de.xp6(1),de.Oqu(Ne.name)}}function je(ht,st){if(1&ht&&(de.TgZ(0,"div",23),de._UZ(1,"app-product-item",24),de.qZA()),2&ht){const Ne=st.$implicit;de.xp6(1),de.Q6J("product",Ne)}}function Ze(ht,st){if(1&ht){const Ne=de.EpF();de.TgZ(0,"div",2)(1,"section",3)(2,"h5",4),de._uU(3,"Sort"),de.qZA(),de.TgZ(4,"select",5),de.NdJ("change",function(Ke){de.CHM(Ne);const Bt=de.oxw();return de.KtG(Bt.onSortSelected(Ke))}),de.YNc(5,Ue,2,2,"option",6),de.qZA(),de.TgZ(6,"h5",4),de._uU(7,"Brands"),de.qZA(),de.TgZ(8,"ul",7),de.YNc(9,Ye,2,4,"li",8),de.qZA(),de.TgZ(10,"h5",4),de._uU(11,"Types"),de.qZA(),de.TgZ(12,"ul",7),de.YNc(13,Pt,2,4,"li",8),de.qZA()(),de.TgZ(14,"section",9)(15,"div",10),de._UZ(16,"app-paging-header",11),de.TgZ(17,"div",12)(18,"input",13,14),de.NdJ("keyup.enter",function(){de.CHM(Ne);const Ke=de.oxw();return de.KtG(Ke.onSearch())}),de.qZA(),de.TgZ(20,"button",15),de.NdJ("click",function(){de.CHM(Ne);const Ke=de.oxw();return de.KtG(Ke.onSearch())}),de._uU(21,"Search"),de.qZA(),de.TgZ(22,"button",16),de.NdJ("click",function(){de.CHM(Ne);const Ke=de.oxw();return de.KtG(Ke.onReset())}),de._uU(23,"Reset"),de.qZA()()(),de.TgZ(24,"div",17),de.YNc(25,je,2,1,"div",18),de.qZA(),de.TgZ(26,"div",19)(27,"app-pager",20),de.NdJ("pageChanged",function(Ke){de.CHM(Ne);const Bt=de.oxw();return de.KtG(Bt.onPageChanged(Ke))}),de.qZA()()()()}if(2&ht){const Ne=de.oxw();de.xp6(5),de.Q6J("ngForOf",Ne.sortOptions),de.xp6(4),de.Q6J("ngForOf",Ne.brands),de.xp6(4),de.Q6J("ngForOf",Ne.types),de.xp6(3),de.Q6J("totalCount",Ne.totalCount)("pageNumber",Ne.shopParam.pageNumber)("pageSize",Ne.shopParam.pageSize),de.xp6(9),de.Q6J("ngForOf",Ne.products),de.xp6(2),de.Q6J("totalCount",Ne.totalCount)("pageSize",Ne.shopParam.pageSize)}}let ot=(()=>{class ht{constructor(Ne){this.shopService=Ne,this.products=[],this.brands=[],this.types=[],this.shopParam=new ct,this.totalCount=0,this.sortOptions=[{name:"Alphabetical",value:"name"},{name:"Price: Low to high",value:"priceAsc"},{name:"Price: High to low",value:"priceDesc"}]}ngOnInit(){this.getProducts(),this.getBrands(),this.getTypes()}getProducts(){this.shopService.getProducts(this.shopParam).subscribe({next:Ne=>{this.products=Ne.data,this.shopParam.pageNumber=Ne.pageIndex,this.shopParam.pageSize=Ne.pageSize,this.totalCount=Ne.count},error:Ne=>console.log(Ne)})}getBrands(){this.shopService.getBrands().subscribe({next:Ne=>this.brands=[{id:0,name:"All"},...Ne],error:Ne=>console.log(Ne)})}getTypes(){this.shopService.getTypes().subscribe({next:Ne=>this.types=[{id:0,name:"All"},...Ne],error:Ne=>console.log(Ne)})}onBrandSelected(Ne){this.shopParam.brandId=Ne,this.shopParam.pageNumber=1,this.getProducts()}onTypeSelected(Ne){this.shopParam.typeId=Ne,this.shopParam.pageNumber=1,this.getProducts()}onSortSelected(Ne){this.shopParam.sort=Ne.target.value,this.getProducts()}onPageChanged(Ne){this.shopParam.pageNumber!==Ne&&(this.shopParam.pageNumber=Ne,this.getProducts())}onSearch(){this.shopParam.search=this.searchTerm?.nativeElement.value,this.getProducts()}onReset(){this.searchTerm&&(this.searchTerm.nativeElement.value=""),this.shopParam=new ct,this.getProducts()}static#e=this.\u0275fac=function(Pe){return new(Pe||ht)(de.Y36(gt))};static#t=this.\u0275cmp=de.Xpm({type:ht,selectors:[["app-shop"]],viewQuery:function(Pe,Ke){if(1&Pe&&de.Gf(_t,5),2&Pe){let Bt;de.iGM(Bt=de.CRH())&&(Ke.searchTerm=Bt.first)}},decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col-3"],[1,"text-warning","ms-3"],[1,"form-select","mb-4",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"list-group","my-3"],["class","list-group-item",3,"active","value","click",4,"ngFor","ngForOf"],[1,"col-9"],[1,"d-flex","justify-content-between","align-items-center","pb-2"],[3,"totalCount","pageNumber","pageSize"],[1,"d-flex","mt-2"],["type","text","placeholder","Search",1,"form-control","me-2",3,"keyup.enter"],["search",""],[1,"btn","btn-primary","mx-2",3,"click"],[1,"btn","btn-outline-success","mx-2",3,"click"],[1,"row","row-cols-3","g-3","mb-4"],["class","col",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center"],[3,"totalCount","pageSize","pageChanged"],[3,"value"],[1,"list-group-item",3,"value","click"],[1,"col"],[3,"product"]],template:function(Pe,Ke){1&Pe&&(de.TgZ(0,"div",0),de.YNc(1,Ze,28,9,"div",1),de.qZA()),2&Pe&&(de.xp6(1),de.Q6J("ngIf",Ke.types.length>0&&Ke.brands.length>0))},dependencies:[C.sg,C.O5,Kn,dn,ii.YN,ii.Kr,Te]})}return ht})();var pt=ue(5698),Ot=ue(8909);function Xt(ht,st){if(1&ht&&(de.TgZ(0,"h5",13),de._uU(1),de.qZA()),2&ht){const Ne=de.oxw(2);de.xp6(1),de.hij(" You have ",Ne.quantityInBasket," of this item in your basket ")}}function Mi(ht,st){if(1&ht){const Ne=de.EpF();de.TgZ(0,"fa-icon",14),de.NdJ("click",function(){de.CHM(Ne);const Ke=de.oxw(2);return de.KtG(Ke.decreasementQuantity())}),de.qZA()}if(2&ht){const Ne=de.oxw(2);de.Q6J("icon",Ne.minusIcon)}}function Wi(ht,st){if(1&ht){const Ne=de.EpF();de.TgZ(0,"div",2)(1,"div",3),de._UZ(2,"img",4),de.qZA(),de.TgZ(3,"div",5)(4,"h2"),de._uU(5),de.qZA(),de.TgZ(6,"p"),de._uU(7),de.ALo(8,"currency"),de.qZA(),de.YNc(9,Xt,2,1,"h5",6),de.TgZ(10,"div",7)(11,"fa-icon",8),de.NdJ("click",function(){de.CHM(Ne);const Ke=de.oxw();return de.KtG(Ke.increasementQuantity())}),de.qZA(),de.TgZ(12,"span",9),de._uU(13),de.qZA(),de.YNc(14,Mi,1,1,"fa-icon",10),de.TgZ(15,"button",11),de.NdJ("click",function(){de.CHM(Ne);const Ke=de.oxw();return de.KtG(Ke.updateBasket())}),de._uU(16),de.qZA()(),de.TgZ(17,"div",12)(18,"h4"),de._uU(19,"Description"),de.qZA(),de.TgZ(20,"p"),de._uU(21),de.qZA()()()()}if(2&ht){const Ne=de.oxw();de.xp6(2),de.s9C("src",Ne.product.pictureUrl,de.LSH),de.s9C("alt",Ne.product.pictureUrl),de.xp6(3),de.Oqu(Ne.product.name),de.xp6(2),de.Oqu(de.lcZ(8,11,Ne.product.price)),de.xp6(2),de.Q6J("ngIf",Ne.quantityInBasket>0),de.xp6(2),de.Q6J("icon",Ne.plusIcon),de.xp6(2),de.Oqu(Ne.quantity),de.xp6(1),de.Q6J("ngIf",Ne.quantity>0),de.xp6(1),de.Q6J("disabled",Ne.quantity===Ne.quantityInBasket),de.xp6(1),de.Oqu(Ne.ButtonText),de.xp6(5),de.Oqu(Ne.product.description)}}const Tn=[{path:"",component:ot},{path:":id",component:(()=>{class ht{constructor(Ne,Pe,Ke,Bt){this.shopService=Ne,this.activeRoute=Pe,this.bcSevice=Ke,this.basketService=Bt,this.plusIcon=hn.EQ8,this.minusIcon=hn.W7v,this.quantity=1,this.quantityInBasket=0,this.bcSevice.set("@productDetails"," ")}ngOnInit(){this.loadProduct()}loadProduct(){const Ne=this.activeRoute.snapshot.paramMap.get("id");Ne&&this.shopService.getProduct(+Ne).subscribe({next:Pe=>{this.product=Pe,this.bcSevice.set("@productDetails",this.product.name),this.basketService.basketSource$.pipe((0,pt.q)(1)).subscribe({next:Ke=>{const Bt=Ke?.items.find(mi=>mi.id===+Ne);Bt&&(this.quantity=Bt.quantity,this.quantityInBasket=Bt.quantity)}})},error:Pe=>console.log(Pe)})}increasementQuantity(){this.quantity++}decreasementQuantity(){this.quantity>=0&&this.quantity--}updateBasket(){if(this.product)if(this.quantity>this.quantityInBasket){const Ne=this.quantity-this.quantityInBasket;this.quantityInBasket+=Ne,this.basketService.addItemToBasket(this.product,Ne)}else{const Ne=this.quantityInBasket-this.quantity;this.quantityInBasket-=Ne,this.basketService.removeItemFromBasket(this.product.id,Ne)}}get ButtonText(){return 0===this.quantityInBasket?"Add to basket":"Update basket"}static#e=this.\u0275fac=function(Pe){return new(Pe||ht)(de.Y36(gt),de.Y36(s.gz),de.Y36(Ot.pm),de.Y36(Vn.v))};static#t=this.\u0275cmp=de.Xpm({type:ht,selectors:[["app-product-details"]],decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col-6"],[1,"w-100",3,"src","alt"],[1,"col-6","mt-5"],["class","text-primary mb-3",4,"ngIf"],[1,"d-flex","justify-content-start","align-items-center"],[1,"text-warning","me-2",2,"cursor","pointer","font-size","2rem",3,"icon","click"],[1,"font-weight-bold",2,"font-size","1.5rem"],["class","text-warning ms-2","style","cursor: pointer; font-size: 2rem;",3,"icon","click",4,"ngIf"],[1,"btn","btn-outline-secondary","ms-4",3,"disabled","click"],[1,"mt-4","row"],[1,"text-primary","mb-3"],[1,"text-warning","ms-2",2,"cursor","pointer","font-size","2rem",3,"icon","click"]],template:function(Pe,Ke){1&Pe&&(de.TgZ(0,"div",0),de.YNc(1,Wi,22,13,"div",1),de.qZA()),2&Pe&&(de.xp6(1),de.Q6J("ngIf",Ke.product))},dependencies:[C.O5,De.BN,C.H9]})}return ht})(),data:{breadcrumb:{alias:"productDetails",label:"app home",info:"home"}}}];let rt=(()=>{class ht{static#e=this.\u0275fac=function(Pe){return new(Pe||ht)};static#t=this.\u0275mod=de.oAB({type:ht});static#n=this.\u0275inj=de.cJS({imports:[C.ez,s.Bz.forChild(Tn),s.Bz]})}return ht})(),xt=(()=>{class ht{static#e=this.\u0275fac=function(Pe){return new(Pe||ht)};static#t=this.\u0275mod=de.oAB({type:ht});static#n=this.\u0275inj=de.cJS({imports:[C.ez,De.uH,Xe.m,rt]})}return ht})()},2340:(yi,on,ue)=>{"use strict";ue.d(on,{N:()=>C});const C={production:!0,apiUrl:"http://localhost:5001/api/",mapbox:{accessToken:"pk.eyJ1IjoiaGFhbHBhY2EiLCJhIjoiY2x1d28xNTFoMGFuMTJybW8ydXR0ajhvbSJ9.S-v3GDMh7tH2PnZzIQZ_iw"}}},4133:(yi,on,ue)=>{"use strict";var C=ue(1481),De=ue(529),Xe=ue(9838),s=ue(1571),ct=ue(371);let de=(()=>{class te{static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-home-carousel"]],features:[s._Bn([{provide:ct.Dg,useValue:{interval:3e3,noPause:!0,showIndicators:!0}}])],decls:22,vars:0,consts:[[2,"max-height","100px"],["src","../../../assets/images/carousel/ski1.jpg","alt","first slide",2,"display","block","width","100%"],[1,"carousel-caption","d-none","d-md-block"],["src","../../../assets/images/carousel/ski2.jpg","alt","second slide",2,"display","block","width","100%"],["src","../../../assets/images/carousel/ski3.jpg","alt","third slide",2,"display","block","width","100%"]],template:function(q,he){1&q&&(s.TgZ(0,"carousel",0)(1,"slide"),s._UZ(2,"img",1),s.TgZ(3,"div",2)(4,"h3"),s._uU(5,"Durable"),s.qZA(),s.TgZ(6,"p"),s._uU(7,"Nulla vitae elit libero, a pharetra augue mollis interdum."),s.qZA()()(),s.TgZ(8,"slide"),s._UZ(9,"img",3),s.TgZ(10,"div",2)(11,"h3"),s._uU(12,"Cheap"),s.qZA(),s.TgZ(13,"p"),s._uU(14,"Lorem ipsum dolor sit amet, consectetur adipiscing elit."),s.qZA()()(),s.TgZ(15,"slide"),s._UZ(16,"img",4),s.TgZ(17,"div",2)(18,"h3"),s._uU(19,"Beautiful"),s.qZA(),s.TgZ(20,"p"),s._uU(21,"Praesent commodo cursus magna, vel scelerisque nisl consectetur."),s.qZA()()()())},dependencies:[ct.o6,ct.Fy]})}return te})(),Et=(()=>{class te{static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-home"]],decls:3,vars:0,consts:[[1,"container"]],template:function(q,he){1&q&&(s.TgZ(0,"div",0),s._uU(1," content "),s._UZ(2,"app-home-carousel"),s.qZA())},dependencies:[de]})}return te})();var qt=ue(2340),gt=ue(6895);function jt(te,P){if(1&te&&(s.TgZ(0,"li"),s._uU(1),s.qZA()),2&te){const D=P.$implicit;s.xp6(1),s.Oqu(D)}}function wt(te,P){if(1&te&&(s.TgZ(0,"div",3)(1,"ul",4),s.YNc(2,jt,2,1,"li",5),s.qZA()()),2&te){const D=s.oxw();s.xp6(2),s.Q6J("ngForOf",D.validationErrors)}}let Gt=(()=>{class te{constructor(D){this.http=D,this.baseUrl=qt.N.apiUrl,this.validationErrors=[]}ngOnInit(){}get404NotFound(){this.http.get(this.baseUrl+"products/42").subscribe({next:D=>console.log(D),error:D=>console.log(D)})}get500ServerErrors(){this.http.get(this.baseUrl+"buggy/servererror").subscribe({next:D=>console.log(D),error:D=>console.log(D)})}get400BadRequest(){this.http.get(this.baseUrl+"buggy/badrequest").subscribe({next:D=>console.log(D),error:D=>console.log(D)})}get400ValidationError(){this.http.get(this.baseUrl+"products/fortytwo").subscribe({next:D=>console.log(D),error:D=>{console.log(D),this.validationErrors=D.errors}})}static#e=this.\u0275fac=function(q){return new(q||te)(s.Y36(De.eN))};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-test-error"]],decls:10,vars:1,consts:[[1,"container","mt-5"],[1,"btn","btn-outline-secondary","me-2",3,"click"],["class","row mt-5",4,"ngIf"],[1,"row","mt-5"],[1,"text-danger"],[4,"ngFor","ngForOf"]],template:function(q,he){1&q&&(s.TgZ(0,"div",0)(1,"div",1),s.NdJ("click",function(){return he.get404NotFound()}),s._uU(2,"get404NotFound"),s.qZA(),s.TgZ(3,"div",1),s.NdJ("click",function(){return he.get500ServerErrors()}),s._uU(4,"get500ServerErrors"),s.qZA(),s.TgZ(5,"div",1),s.NdJ("click",function(){return he.get400BadRequest()}),s._uU(6,"get400BadRequest"),s.qZA(),s.TgZ(7,"div",1),s.NdJ("click",function(){return he.get400ValidationError()}),s._uU(8,"get400ValidationError"),s.qZA(),s.YNc(9,wt,3,1,"div",2),s.qZA()),2&q&&(s.xp6(9),s.Q6J("ngIf",he.validationErrors.length>0))},dependencies:[gt.sg,gt.O5]})}return te})(),Kn=(()=>{class te{static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-not-found"]],decls:3,vars:0,consts:[[1,"container","mt-5"]],template:function(q,he){1&q&&(s.TgZ(0,"div",0)(1,"h1"),s._uU(2,"404 Not Found"),s.qZA()())}})}return te})();function Sn(te,P){if(1&te&&(s.ynx(0),s.TgZ(1,"h5",2),s._uU(2),s.qZA(),s.TgZ(3,"p",3),s._uU(4," This error comes from server "),s.qZA(),s.TgZ(5,"h5")(6,"code",4),s._uU(7),s.qZA()(),s.BQk()),2&te){const D=s.oxw();s.xp6(2),s.hij("Error: ",D.error.message,""),s.xp6(5),s.Oqu(D.error.details)}}let En=(()=>{class te{constructor(D){this.router=D;const q=this.router.getCurrentNavigation();this.error=q?.extras?.state?.error}static#e=this.\u0275fac=function(q){return new(q||te)(s.Y36(Xe.F0))};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-server-error"]],decls:4,vars:1,consts:[[1,"container","mt-5"],[4,"ngIf"],[1,"text-danger"],[1,"font-weight-bold"],[1,"mt-5",2,"background","whitesmoke"]],template:function(q,he){1&q&&(s.TgZ(0,"div",0)(1,"h4"),s._uU(2,"500: Internal Sever Error"),s.qZA(),s.YNc(3,Sn,8,2,"ng-container",1),s.qZA()),2&q&&(s.xp6(3),s.Q6J("ngIf",he.error))},dependencies:[gt.O5]})}return te})();var dn=ue(4004),ii=ue(6019);let hn=(()=>{class te{constructor(D,q){this.accountService=D,this.router=q}canActivate(D,q){return this.accountService.currentUser$.pipe((0,dn.U)(he=>!!he||(this.router.navigate(["/account/login"],{queryParams:{returnUrl:q.url}}),!1)))}static#e=this.\u0275fac=function(q){return new(q||te)(s.LFG(ii.B),s.LFG(Xe.F0))};static#t=this.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac,providedIn:"root"})}return te})();var Vn=ue(9898);const Te=[{path:"",component:Et,data:{breadcrumb:"Home"}},{path:"about",component:(()=>{class te{ngOnInit(){this.map=new Vn.Map({accessToken:qt.N.mapbox.accessToken,container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[105,18],zoom:4}),new Vn.Marker({color:"pink",draggable:!0,anchor:"bottom"}).setLngLat([105,21]).addTo(this.map),new Vn.Marker({color:"red",draggable:!0,anchor:"bottom"}).setLngLat([108.07,16.5]).addTo(this.map),new Vn.Marker({color:"red",draggable:!0,anchor:"bottom"}).setLngLat([107.85,15]).addTo(this.map),new Vn.Popup({closeButton:!0,closeOnClick:!1,anchor:"right"}).setLngLat([105.85,21]).setHTML("<small>Ha Noi</small>").addTo(this.map),new Vn.Popup({closeButton:!0,closeOnClick:!1,anchor:"right"}).setLngLat([108.07,16.5]).setHTML("<small>Da Nang</small>").addTo(this.map),new Vn.Popup({closeButton:!0,closeOnClick:!1,anchor:"right"}).setLngLat([107.85,15]).setHTML("<small>Ho Chi Minh</small>").addTo(this.map),this.map.addControl(new Vn.NavigationControl({showCompass:!0,showZoom:!0})),this.map.addControl(new Vn.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}))}static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-about"]],decls:82,vars:0,consts:[[1,"py-3","py-md-5","py-xl-8"],[1,"container"],[1,"row","gy-3","gy-md-4","gy-lg-0","align-items-lg-center"],[1,"col-12","col-lg-6","col-xl-5"],["loading","lazy","src","https://bootstrapbrain.com/demo/components/abouts/about-1/assets/img/about-img-1.jpg","alt","C\u1eeda h\xe0ng b\xe1n \u0111\u1ed3 tr\u01b0\u1ee3t tuy\u1ebft",1,"img-fluid","rounded"],[1,"col-12","col-lg-6","col-xl-7"],[1,"row","justify-content-xl-center"],[1,"col-12","col-xl-11"],[1,"h1","mb-3"],[1,"lead","fs-4","text-secondary","mb-3"],[1,"mb-5"],[1,"row","gy-4","gy-md-0","gx-xxl-5X"],[1,"col-12","col-md-6"],[1,"d-flex"],[1,"me-4","text-primary"],["xmlns","http://www.w3.org/2000/svg","width","32","height","32","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-gear-fill"],["d","M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"],[1,"mb-3"],[1,"text-secondary","mb-0"],["xmlns","http://www.w3.org/2000/svg","width","32","height","32","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-fire"],["d","M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16Zm0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15Z"],[1,"py-3","py-md-5","py-xl-8","row"],[1,"col-md-6"],["id","map",2,"width","600px","height","500px"],[1,"row"],[1,"col-md-4"],[1,"card","mb-4","h-100"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["href","http://www.alpineadventure.com"],["href","http://www.snowpeakgear.vn"],["href","http://www.summitsports.com"]],template:function(q,he){1&q&&(s.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3),s._UZ(4,"img",4),s.qZA(),s.TgZ(5,"div",5)(6,"div",6)(7,"div",7)(8,"h2",8),s._uU(9,"V\u1ec1 ch\xfang t\xf4i"),s.qZA(),s.TgZ(10,"p",9),s._uU(11,"Ch\xfang t\xf4i l\xe0 \u0111\u1ecba ch\u1ec9 tin c\u1eady \u0111\u1ec3 b\u1ea1n tr\u1ea3i nghi\u1ec7m v\u1edbi \u0111\u1ed3 tr\u01b0\u1ee3t tuy\u1ebft ch\u1ea5t l\u01b0\u1ee3ng nh\u1ea5t."),s.qZA(),s.TgZ(12,"p",10),s._uU(13,"T\u1ea1i c\u1eeda h\xe0ng ch\xfang t\xf4i, ch\xfang t\xf4i cam k\u1ebft cung c\u1ea5p nh\u1eefng s\u1ea3n ph\u1ea9m ch\u1ea5t l\u01b0\u1ee3ng t\u1eeb c\xe1c th\u01b0\u01a1ng hi\u1ec7u uy t\xedn tr\xean th\u1ecb tr\u01b0\u1eddng. Ch\xfang t\xf4i t\u1ef1 h\xe0o l\xe0 \u0111\u1ed1i t\xe1c \u0111\u1ed3ng h\xe0nh c\xf9ng b\u1ea1n trong m\u1ed7i chuy\u1ebfn \u0111i tr\u01b0\u1ee3t tuy\u1ebft."),s.qZA(),s.TgZ(14,"div",11)(15,"div",12)(16,"div",13)(17,"div",14),s.O4$(),s.TgZ(18,"svg",15),s._UZ(19,"path",16),s.qZA()(),s.kcU(),s.TgZ(20,"div")(21,"h5",17),s._uU(22,"S\u1ea3n ph\u1ea9m \u0111a d\u1ea1ng"),s.qZA(),s.TgZ(23,"p",18),s._uU(24,"Ch\xfang t\xf4i cung c\u1ea5p m\u1ed9t lo\u1ea1t c\xe1c s\u1ea3n ph\u1ea9m t\u1eeb tr\u01b0\u1ee3t tuy\u1ebft cho \u0111\u1ebfn ph\u1ee5 ki\u1ec7n v\xe0 \u0111\u1ed3 b\u1ea3o v\u1ec7."),s.qZA()()()(),s.TgZ(25,"div",12)(26,"div",13)(27,"div",14),s.O4$(),s.TgZ(28,"svg",19),s._UZ(29,"path",20),s.qZA()(),s.kcU(),s.TgZ(30,"div")(31,"h5",17),s._uU(32,"D\u1ecbch v\u1ee5 chuy\xean nghi\u1ec7p"),s.qZA(),s.TgZ(33,"p",18),s._uU(34,"\u0110\u1ed9i ng\u0169 nh\xe2n vi\xean c\u1ee7a ch\xfang t\xf4i lu\xf4n s\u1eb5n s\xe0ng h\u1ed7 tr\u1ee3 v\xe0 t\u01b0 v\u1ea5n cho b\u1ea1n m\u1ecdi l\xfac, m\u1ecdi n\u01a1i."),s.qZA()()()()()()()()()()(),s.TgZ(35,"section",21)(36,"div",22),s._UZ(37,"div",23),s.qZA(),s.TgZ(38,"div",22)(39,"h1"),s._uU(40,"Contact us"),s.qZA(),s.TgZ(41,"div",1)(42,"div",24)(43,"div",25)(44,"div",26)(45,"div",27)(46,"h5",28),s._uU(47,"C\u1eeda H\xe0ng Tr\u01b0\u1ee3t Tuy\u1ebft Alpine Adventure"),s.qZA(),s.TgZ(48,"p",29),s._uU(49," \u0110\u1ecba ch\u1ec9: 123 \u0110\u01b0\u1eddng Ph\u1ed1 H\u1ea1nh Ph\xfac, Qu\u1eadn 1, Th\xe0nh Ph\u1ed1 H\u1ed3 Ch\xed Minh "),s._UZ(50,"br"),s._uU(51," S\u1ed1 \u0111i\u1ec7n tho\u1ea1i: (0123) 456 789 "),s._UZ(52,"br"),s._uU(53," Website: "),s.TgZ(54,"a",30),s._uU(55,"www.alpineadventure.com"),s.qZA()()()()(),s.TgZ(56,"div",25)(57,"div",26)(58,"div",27)(59,"h5",28),s._uU(60,"C\u1eeda H\xe0ng Tr\u01b0\u1ee3t Tuy\u1ebft SnowPeak Gear"),s.qZA(),s.TgZ(61,"p",29),s._uU(62," \u0110\u1ecba ch\u1ec9: 456 \u0110\u01b0\u1eddng L\u1ea1c Quan, Qu\u1eadn 2, Th\xe0nh Ph\u1ed1 H\xe0 N\u1ed9i "),s._UZ(63,"br"),s._uU(64," S\u1ed1 \u0111i\u1ec7n tho\u1ea1i: (098) 765 4321 "),s._UZ(65,"br"),s._uU(66," Website: "),s.TgZ(67,"a",31),s._uU(68,"www.snowpeakgear.vn"),s.qZA()()()()(),s.TgZ(69,"div",25)(70,"div",26)(71,"div",27)(72,"h5",28),s._uU(73,"C\u1eeda H\xe0ng Tr\u01b0\u1ee3t Tuy\u1ebft Summit Sports"),s.qZA(),s.TgZ(74,"p",29),s._uU(75," \u0110\u1ecba ch\u1ec9: 789 \u0110\u01b0\u1eddng Th\u0103ng B\xecnh, Qu\u1eadn 3, Th\xe0nh Ph\u1ed1 \u0110\xe0 N\u1eb5ng "),s._UZ(76,"br"),s._uU(77," S\u1ed1 \u0111i\u1ec7n tho\u1ea1i: (0123) 987 654 "),s._UZ(78,"br"),s._uU(79," Website: "),s.TgZ(80,"a",32),s._uU(81,"www.summitsports.com"),s.qZA()()()()()()()()())}})}return te})(),data:{breadcrumb:"About Us"}},{path:"test-error",component:Gt},{path:"not-found",component:Kn},{path:"server-error",component:En},{path:"shop",loadChildren:()=>Promise.resolve().then(ue.bind(ue,4333)).then(te=>te.ShopModule)},{path:"basket",loadChildren:()=>Promise.all([ue.e(592),ue.e(361)]).then(ue.bind(ue,3361)).then(te=>te.BasketModule)},{path:"checkout",canActivate:[hn],loadChildren:()=>Promise.all([ue.e(592),ue.e(665)]).then(ue.bind(ue,1665)).then(te=>te.CheckoutModule)},{path:"account",loadChildren:()=>Promise.all([ue.e(592),ue.e(210)]).then(ue.bind(ue,9210)).then(te=>te.AccountModule)},{path:"orders",canActivate:[hn],loadChildren:()=>ue.e(775).then(ue.bind(ue,6775)).then(te=>te.OrdersModule),data:{breadcrumb:"Orders"}},{path:"**",redirectTo:"",pathMatch:"full"}];let _t=(()=>{class te{static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275mod=s.oAB({type:te});static#n=this.\u0275inj=s.cJS({imports:[Xe.Bz.forRoot(Te),Xe.Bz]})}return te})();var Ue=ue(5866),Ye=ue(2687),Pt=ue(7817),je=ue(2216);function Ze(te,P){if(1&te&&(s.TgZ(0,"div",14),s._uU(1),s.qZA()),2&te){const D=P.ngIf,q=s.oxw();s.xp6(1),s.Oqu(q.getCount(D.items))}}function ot(te,P){1&te&&(s.ynx(0),s.TgZ(1,"a",15),s._uU(2,"Login"),s.qZA(),s.TgZ(3,"a",16),s._uU(4,"Sign up"),s.qZA(),s.BQk())}function pt(te,P){if(1&te){const D=s.EpF();s.TgZ(0,"ul",21)(1,"li",22)(2,"a",23),s._uU(3,"Basket"),s.qZA()(),s.TgZ(4,"li",24)(5,"a",23),s._uU(6,"Checkout"),s.qZA()(),s.TgZ(7,"li",25)(8,"a",23),s._uU(9,"Orders"),s.qZA()(),s.TgZ(10,"li",26),s.NdJ("click",function(){s.CHM(D);const he=s.oxw(2);return s.KtG(he.accountService.logout())}),s.TgZ(11,"a",23),s._uU(12,"Logout"),s.qZA()()()}}function Ot(te,P){if(1&te&&(s.ynx(0,1),s.TgZ(1,"div",17)(2,"button",18)(3,"strong"),s._uU(4),s.qZA(),s._UZ(5,"span",19),s.qZA(),s.YNc(6,pt,13,0,"ul",20),s.qZA(),s.BQk()),2&te){const D=P.ngIf;s.xp6(4),s.hij("Wellcome ",D.displayName,"")}}const Xt=function(){return{exact:!0}};let Mi=(()=>{class te{constructor(D,q){this.basketService=D,this.accountService=q,this.role="",this.faCartShopping=Ye.yYj,this.faCartArrowDown=Ye.bMA,this.faSetting=Ye.cRF}ngOnInit(){this.accountService.currentRole$.subscribe(D=>{this.role=D?.role,console.log(this.role)})}getCount(D){return D.reduce((q,he)=>q+he.quantity,0)}static#e=this.\u0275fac=function(q){return new(q||te)(s.Y36(Ue.v),s.Y36(ii.B))};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-nav-bar"]],decls:23,vars:12,consts:[[1,"d-flex","flex-row","align-items-center","justify-content-between","p-3","px-4","mb-3","bg-white","fixed-top","border-bottom","shadow-sm"],[1,"d-flex","align-items-center"],["src","assets/images/skiLogo.png","alt","logo","routerLink","/",1,"logo",2,"max-height","70px"],[1,"ms-3","mb-0"],[1,"my-2","text-uppercase","fs-5"],["routerLink","/","routerLinkActive","active",1,"p-2",3,"routerLinkActiveOptions"],["routerLink","/shop","routerLinkActive","active",1,"p-2"],["routerLink","/about","routerLinkActive","active",1,"p-2"],["routerLink","/test-error","routerLinkActive","active",1,"p-2"],["routerLink","/basket",1,"position-relative"],[1,"fa-2x","me-5",3,"icon"],["class","cart-no",4,"ngIf"],[4,"ngIf"],["class","d-flex align-items-center",4,"ngIf"],[1,"cart-no"],["routerLink","/account/login",1,"btn","btn-outline-secondary","me-2"],["routerLink","/account/register",1,"btn","btn-outline-secondary","me-3"],["dropdown","",1,"btn-group","ms-3","me-5",2,"cursor","pointer"],["id","button-animated","dropdownToggle","","type","button","aria-controls","dropdown-animated",1,"btn","btn-primary","dropdown-toggle"],[1,"caret"],["id","dropdown-menu","class","dropdown-menu","role","menu","aria-labelledby","button-animated",4,"dropdownMenu"],["id","dropdown-menu","role","menu","aria-labelledby","button-animated",1,"dropdown-menu"],["role","menuitem","routerLink","/basket"],[1,"dropdown-item"],["role","menuitem","routerLink","/checkout"],["role","menuitem","routerLink","/orders"],["role","menuitem",3,"click"]],template:function(q,he){1&q&&(s.TgZ(0,"header",0)(1,"div",1),s._UZ(2,"img",2),s.TgZ(3,"h1",3),s._uU(4,"SkiShop"),s.qZA()(),s.TgZ(5,"nav",4)(6,"a",5),s._uU(7,"Home"),s.qZA(),s.TgZ(8,"a",6),s._uU(9,"Shop"),s.qZA(),s.TgZ(10,"a",7),s._uU(11,"About Us"),s.qZA(),s.TgZ(12,"a",8),s._uU(13,"Errors"),s.qZA()(),s.TgZ(14,"div",1)(15,"a",9),s._UZ(16,"fa-icon",10),s.YNc(17,Ze,2,1,"div",11),s.ALo(18,"async"),s.qZA(),s.YNc(19,ot,5,0,"ng-container",12),s.ALo(20,"async"),s.YNc(21,Ot,7,1,"ng-container",13),s.ALo(22,"async"),s.qZA()()),2&q&&(s.xp6(6),s.Q6J("routerLinkActiveOptions",s.DdM(11,Xt)),s.xp6(10),s.Q6J("icon",he.faCartShopping),s.xp6(1),s.Q6J("ngIf",s.lcZ(18,5,he.basketService.basketSource$)),s.xp6(2),s.Q6J("ngIf",null==s.lcZ(20,7,he.accountService.currentUser$)),s.xp6(2),s.Q6J("ngIf",s.lcZ(22,9,he.accountService.currentUser$)))},dependencies:[Pt.Hz,Pt.Mq,Pt.TO,gt.O5,je.BN,Xe.rH,Xe.Od,gt.Ov],styles:[".cart-no[_ngcontent-%COMP%]{position:absolute;min-height:25px;min-width:25px;border-radius:50%;background-color:#e6e6fa;color:#fff;text-align:center;top:-12px;right:32px}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}a.active[_ngcontent-%COMP%]{color:orange}.logo[_ngcontent-%COMP%]{cursor:pointer}"]})}return te})();var Wi=ue(8909);function ti(te,P){if(1&te&&(s.ynx(0),s._uU(1),s.ALo(2,"titlecase"),s.BQk()),2&te){const D=P.$implicit;s.xp6(1),s.hij(" ",s.lcZ(2,1,D)," ")}}function Tn(te,P){if(1&te&&(s.TgZ(0,"section",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2"),s._uU(5),s.qZA()(),s.TgZ(6,"div",6)(7,"nav")(8,"xng-breadcrumb"),s.YNc(9,ti,3,3,"ng-container",7),s.qZA()()()()()()),2&te){const D=s.oxw().ngIf;s.xp6(5),s.hij(" ",D[D.length-1].label," ")}}function rt(te,P){if(1&te&&(s.ynx(0),s.YNc(1,Tn,10,1,"section",1),s.BQk()),2&te){const D=P.ngIf;s.xp6(1),s.Q6J("ngIf","Home"!==D[D.length-1].label)}}let xt=(()=>{class te{constructor(D){this.bcService=D}static#e=this.\u0275fac=function(q){return new(q||te)(s.Y36(Wi.pm))};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-section-header"]],decls:2,vars:3,consts:[[4,"ngIf"],["class","py-5 mb-3 ","style","margin-top: 105px;background-color: #f5f5f5;",4,"ngIf"],[1,"py-5","mb-3",2,"margin-top","105px","background-color","#f5f5f5"],[1,"container"],[1,"row","d-flex","align-items-center"],[1,"col-9"],[1,"col-3"],[4,"xngBreadcrumbItem"]],template:function(q,he){1&q&&(s.YNc(0,rt,2,1,"ng-container",0),s.ALo(1,"async")),2&q&&s.Q6J("ngIf",s.lcZ(1,1,he.bcService.breadcrumbs$))},dependencies:[gt.O5,Wi.LI,Wi.Of,gt.Ov,gt.rS],styles:["label.xng-breadcrumb-trail[_ngcontent-%COMP%]{color:orange}"]})}return te})();var ht=ue(1135),st=ue(7579),Ne=ue(9300),Pe=ue(2722),Ke=ue(7340);const Bt=["overlay"];function mi(te,P){1&te&&s._UZ(0,"div")}function Di(te,P){if(1&te&&(s.TgZ(0,"div"),s.YNc(1,mi,1,0,"div",6),s.qZA()),2&te){const D=s.oxw(2);s.Tol(D.spinner.class),s.Udp("color",D.spinner.color),s.xp6(1),s.Q6J("ngForOf",D.spinner.divArray)}}function Ii(te,P){if(1&te&&(s._UZ(0,"div",7),s.ALo(1,"safeHtml")),2&te){const D=s.oxw(2);s.Q6J("innerHTML",s.lcZ(1,1,D.template),s.oJD)}}function Gi(te,P){if(1&te&&(s.TgZ(0,"div",1,2),s.YNc(2,Di,2,5,"div",3),s.YNc(3,Ii,2,3,"div",4),s.TgZ(4,"div",5),s.Hsn(5),s.qZA()()),2&te){const D=s.oxw();s.Udp("background-color",D.spinner.bdColor)("z-index",D.spinner.zIndex)("position",D.spinner.fullScreen?"fixed":"absolute"),s.Q6J("@.disabled",D.disableAnimation)("@fadeIn","in"),s.xp6(2),s.Q6J("ngIf",!D.template),s.xp6(1),s.Q6J("ngIf",D.template),s.xp6(1),s.Udp("z-index",D.spinner.zIndex)}}const Br=["*"],Hr={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":4,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1},Si="primary";class Xi{constructor(P){Object.assign(this,P)}static create(P){return!P?.template&&(null==P?.type||0===P.type.length)&&console.warn('[ngx-spinner]: Property "type" is missed. Please, provide animation type to <ngx-spinner> component\n        and ensure css is added to angular.json file'),new Xi(P)}}let Rs=(()=>{class te{constructor(){this.spinnerObservable=new ht.X(null)}getSpinner(D){return this.spinnerObservable.asObservable().pipe((0,Ne.h)(q=>q&&q.name===D))}show(D=Si,q){return new Promise((he,Fe)=>{setTimeout(()=>{q&&Object.keys(q).length?(q.name=D,this.spinnerObservable.next(new Xi({...q,show:!0})),he(!0)):(this.spinnerObservable.next(new Xi({name:D,show:!0})),he(!0))},10)})}hide(D=Si,q=10){return new Promise((he,Fe)=>{setTimeout(()=>{this.spinnerObservable.next(new Xi({name:D,show:!1})),he(!0)},q)})}}return te.\u0275fac=function(D){return new(D||te)},te.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac,providedIn:"root"}),te})();const $r=new s.OlP("NGX_SPINNER_CONFIG");let Ji=(()=>{class te{constructor(D){this._sanitizer=D}transform(D){if(D)return this._sanitizer.bypassSecurityTrustHtml(D)}}return te.\u0275fac=function(D){return new(D||te)(s.Y36(C.H7,16))},te.\u0275pipe=s.Yjl({name:"safeHtml",type:te,pure:!0}),te})(),ir=(()=>{class te{constructor(D,q,he,Fe){this.spinnerService=D,this.changeDetector=q,this.elementRef=he,this.globalConfig=Fe,this.disableAnimation=!1,this.spinner=new Xi,this.ngUnsubscribe=new st.x,this.setDefaultOptions=()=>{const{type:bt}=this.globalConfig??{};this.spinner=Xi.create({name:this.name,bdColor:this.bdColor,size:this.size,color:this.color,type:this.type??bt,fullScreen:this.fullScreen,divArray:this.divArray,divCount:this.divCount,show:this.show,zIndex:this.zIndex,template:this.template,showSpinner:this.showSpinner})},this.bdColor="rgba(51,51,51,0.8)",this.zIndex=99999,this.color="#fff",this.size="large",this.fullScreen=!0,this.name=Si,this.template=null,this.showSpinner=!1,this.divArray=[],this.divCount=0,this.show=!1}handleKeyboardEvent(D){this.spinnerDOM&&this.spinnerDOM.nativeElement&&(this.fullScreen||!this.fullScreen&&this.isSpinnerZone(D.target))&&(D.returnValue=!1,D.preventDefault())}initObservable(){this.spinnerService.getSpinner(this.name).pipe((0,Pe.R)(this.ngUnsubscribe)).subscribe(D=>{this.setDefaultOptions(),Object.assign(this.spinner,D),D.show&&this.onInputChange(),this.changeDetector.detectChanges()})}ngOnInit(){this.setDefaultOptions(),this.initObservable()}isSpinnerZone(D){return D===this.elementRef.nativeElement.parentElement||D.parentNode&&this.isSpinnerZone(D.parentNode)}ngOnChanges(D){for(const q in D)if(q){const he=D[q];if(he.isFirstChange())return;typeof he.currentValue<"u"&&he.currentValue!==he.previousValue&&""!==he.currentValue&&(this.spinner[q]=he.currentValue,"showSpinner"===q&&(he.currentValue?this.spinnerService.show(this.spinner.name,this.spinner):this.spinnerService.hide(this.spinner.name)),"name"===q&&this.initObservable())}}getClass(D,q){this.spinner.divCount=Hr[D],this.spinner.divArray=Array(this.spinner.divCount).fill(0).map((Fe,bt)=>bt);let he="";switch(q.toLowerCase()){case"small":he="la-sm";break;case"medium":he="la-2x";break;case"large":he="la-3x"}return"la-"+D+" "+he}onInputChange(){this.spinner.class=this.getClass(this.spinner.type,this.spinner.size)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return te.\u0275fac=function(D){return new(D||te)(s.Y36(Rs),s.Y36(s.sBO),s.Y36(s.SBq),s.Y36($r,8))},te.\u0275cmp=s.Xpm({type:te,selectors:[["ngx-spinner"]],viewQuery:function(D,q){if(1&D&&s.Gf(Bt,5),2&D){let he;s.iGM(he=s.CRH())&&(q.spinnerDOM=he.first)}},hostBindings:function(D,q){1&D&&s.NdJ("keydown",function(Fe){return q.handleKeyboardEvent(Fe)},!1,s.evT)},inputs:{bdColor:"bdColor",size:"size",color:"color",type:"type",fullScreen:"fullScreen",name:"name",zIndex:"zIndex",template:"template",showSpinner:"showSpinner",disableAnimation:"disableAnimation"},features:[s.TTD],ngContentSelectors:Br,decls:1,vars:1,consts:[["class","ngx-spinner-overlay",3,"background-color","z-index","position",4,"ngIf"],[1,"ngx-spinner-overlay"],["overlay",""],[3,"class","color",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[1,"loading-text"],[4,"ngFor","ngForOf"],[3,"innerHTML"]],template:function(D,q){1&D&&(s.F$t(),s.YNc(0,Gi,6,12,"div",0)),2&D&&s.Q6J("ngIf",q.spinner.show)},dependencies:[gt.sg,gt.O5,Ji],styles:[".ngx-spinner-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%}.ngx-spinner-overlay[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.loading-text){top:50%;left:50%;margin:0;position:absolute;transform:translate(-50%,-50%)}.loading-text[_ngcontent-%COMP%]{position:absolute;top:60%;left:50%;transform:translate(-50%,-60%)}"],data:{animation:[(0,Ke.X$)("fadeIn",[(0,Ke.SB)("in",(0,Ke.oB)({opacity:1})),(0,Ke.eR)(":enter",[(0,Ke.oB)({opacity:0}),(0,Ke.jt)(300)]),(0,Ke.eR)(":leave",(0,Ke.jt)(200,(0,Ke.oB)({opacity:0})))])]},changeDetection:0}),te})(),jr=(()=>{class te{static forRoot(D){return{ngModule:te,providers:[{provide:$r,useValue:D}]}}}return te.\u0275fac=function(D){return new(D||te)},te.\u0275mod=s.oAB({type:te}),te.\u0275inj=s.cJS({imports:[gt.ez]}),te})(),sn=(()=>{class te{constructor(D,q,he){this.http=D,this.basketService=q,this.accountService=he,this.title="E-Shopping",this.products=[]}ngOnInit(){this.loadBasket(),this.loadCurrentUser(),this.getCurrentRole()}loadBasket(){const D=localStorage.getItem("basket_Id");D&&this.basketService.getBasket(D)}loadCurrentUser(){const D=localStorage.getItem("token");this.accountService.loadCurrentUser(D).subscribe()}getCurrentRole(){localStorage.getItem("token")}static#e=this.\u0275fac=function(q){return new(q||te)(s.Y36(De.eN),s.Y36(Ue.v),s.Y36(ii.B))};static#t=this.\u0275cmp=s.Xpm({type:te,selectors:[["app-root"]],decls:6,vars:0,consts:[["type","timer"],[1,"container",2,"margin-top","30px"]],template:function(q,he){1&q&&(s.TgZ(0,"ngx-spinner",0),s._uU(1," Loading...\n"),s.qZA(),s._UZ(2,"app-nav-bar")(3,"app-section-header"),s.TgZ(4,"div",1),s._UZ(5,"router-outlet"),s.qZA())},dependencies:[Xe.lC,Mi,xt,ir]})}return te})();function He(te){return new s.vHH(3e3,!1)}function St(){return typeof window<"u"&&typeof window.document<"u"}function nn(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function bn(te){switch(te.length){case 0:return new Ke.ZN;case 1:return te[0];default:return new Ke.ZE(te)}}function Dn(te,P,D,q,he=new Map,Fe=new Map){const bt=[],Mt=[];let fn=-1,An=null;if(q.forEach(fi=>{const Vi=fi.get("offset"),Zr=Vi==fn,Wr=Zr&&An||new Map;fi.forEach((pr,Fr)=>{let _s=Fr,vr=pr;if("offset"!==Fr)switch(_s=P.normalizePropertyName(_s,bt),vr){case Ke.k1:vr=he.get(Fr);break;case Ke.l3:vr=Fe.get(Fr);break;default:vr=P.normalizeStyleValue(Fr,_s,vr,bt)}Wr.set(_s,vr)}),Zr||Mt.push(Wr),An=Wr,fn=Vi}),bt.length)throw function Oi(te){return new s.vHH(3502,!1)}();return Mt}function Nn(te,P,D,q){switch(P){case"start":te.onStart(()=>q(D&&Ei(D,"start",te)));break;case"done":te.onDone(()=>q(D&&Ei(D,"done",te)));break;case"destroy":te.onDestroy(()=>q(D&&Ei(D,"destroy",te)))}}function Ei(te,P,D){const Fe=si(te.element,te.triggerName,te.fromState,te.toState,P||te.phaseName,D.totalTime??te.totalTime,!!D.disabled),bt=te._data;return null!=bt&&(Fe._data=bt),Fe}function si(te,P,D,q,he="",Fe=0,bt){return{element:te,triggerName:P,fromState:D,toState:q,phaseName:he,totalTime:Fe,disabled:!!bt}}function er(te,P,D){let q=te.get(P);return q||te.set(P,q=D),q}function rs(te){const P=te.indexOf(":");return[te.substring(1,P),te.slice(P+1)]}let Er=(te,P)=>!1,zs=(te,P,D)=>[],Qs=null;function zr(te){const P=te.parentNode||te.host;return P===Qs?null:P}(nn()||typeof Element<"u")&&(St()?(Qs=(()=>document.documentElement)(),Er=(te,P)=>{for(;P;){if(P===te)return!0;P=zr(P)}return!1}):Er=(te,P)=>te.contains(P),zs=(te,P,D)=>{if(D)return Array.from(te.querySelectorAll(P));const q=te.querySelector(P);return q?[q]:[]});let ro=null,Os=!1;const So=Er,vi=zs;let Sr=(()=>{class te{validateStyleProperty(D){return function e1(te){ro||(ro=function qo(){return typeof document<"u"?document.body:null}()||{},Os=!!ro.style&&"WebkitAppearance"in ro.style);let P=!0;return ro.style&&!function ds(te){return"ebkit"==te.substring(1,6)}(te)&&(P=te in ro.style,!P&&Os&&(P="Webkit"+te.charAt(0).toUpperCase()+te.slice(1)in ro.style)),P}(D)}matchesElement(D,q){return!1}containsElement(D,q){return So(D,q)}getParentElement(D){return zr(D)}query(D,q,he){return vi(D,q,he)}computeStyle(D,q,he){return he||""}animate(D,q,he,Fe,bt,Mt=[],fn){return new Ke.ZN(he,Fe)}}return te.\u0275fac=function(D){return new(D||te)},te.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac}),te})(),Pi=(()=>{class te{}return te.NOOP=new Sr,te})();const Io=1e3,ps="ng-enter",Fs="ng-leave",Vo="ng-trigger",br=".ng-trigger",ws="ng-animating",qn=".ng-animating";function Yi(te){if("number"==typeof te)return te;const P=te.match(/^(-?[\.\d]+)(m?s)/);return!P||P.length<2?0:tr(parseFloat(P[1]),P[2])}function tr(te,P){return"s"===P?te*Io:te}function es(te,P,D){return te.hasOwnProperty("duration")?te:function ho(te,P,D){let he,Fe=0,bt="";if("string"==typeof te){const Mt=te.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===Mt)return P.push(He()),{duration:0,delay:0,easing:""};he=tr(parseFloat(Mt[1]),Mt[2]);const fn=Mt[3];null!=fn&&(Fe=tr(parseFloat(fn),Mt[4]));const An=Mt[5];An&&(bt=An)}else he=te;if(!D){let Mt=!1,fn=P.length;he<0&&(P.push(function it(){return new s.vHH(3100,!1)}()),Mt=!0),Fe<0&&(P.push(function zt(){return new s.vHH(3101,!1)}()),Mt=!0),Mt&&P.splice(fn,0,He())}return{duration:he,delay:Fe,easing:bt}}(te,P,D)}function rr(te,P={}){return Object.keys(te).forEach(D=>{P[D]=te[D]}),P}function Cs(te){const P=new Map;return Object.keys(te).forEach(D=>{P.set(D,te[D])}),P}function _r(te,P=new Map,D){if(D)for(let[q,he]of D)P.set(q,he);for(let[q,he]of te)P.set(q,he);return P}function vs(te,P,D){return D?P+":"+D+";":""}function ci(te){let P="";for(let D=0;D<te.style.length;D++){const q=te.style.item(D);P+=vs(0,q,te.style.getPropertyValue(q))}for(const D in te.style)te.style.hasOwnProperty(D)&&!D.startsWith("_")&&(P+=vs(0,to(D),te.style[D]));te.setAttribute("style",P)}function eo(te,P,D){te.style&&(P.forEach((q,he)=>{const Fe=as(he);D&&!D.has(he)&&D.set(he,te.style[Fe]),te.style[Fe]=q}),nn()&&ci(te))}function Ci(te,P){te.style&&(P.forEach((D,q)=>{const he=as(q);te.style[he]=""}),nn()&&ci(te))}function As(te){return Array.isArray(te)?1==te.length?te[0]:(0,Ke.vP)(te):te}const Vs=new RegExp("{{\\s*(.+?)\\s*}}","g");function Gs(te){let P=[];if("string"==typeof te){let D;for(;D=Vs.exec(te);)P.push(D[1]);Vs.lastIndex=0}return P}function Qn(te,P,D){const q=te.toString(),he=q.replace(Vs,(Fe,bt)=>{let Mt=P[bt];return null==Mt&&(D.push(function It(te){return new s.vHH(3003,!1)}()),Mt=""),Mt.toString()});return he==q?te:he}function Ls(te){const P=[];let D=te.next();for(;!D.done;)P.push(D.value),D=te.next();return P}const so=/-+([a-z0-9])/g;function as(te){return te.replace(so,(...P)=>P[1].toUpperCase())}function to(te){return te.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Nr(te,P,D){switch(P.type){case 7:return te.visitTrigger(P,D);case 0:return te.visitState(P,D);case 1:return te.visitTransition(P,D);case 2:return te.visitSequence(P,D);case 3:return te.visitGroup(P,D);case 4:return te.visitAnimate(P,D);case 5:return te.visitKeyframes(P,D);case 6:return te.visitStyle(P,D);case 8:return te.visitReference(P,D);case 9:return te.visitAnimateChild(P,D);case 10:return te.visitAnimateRef(P,D);case 11:return te.visitQuery(P,D);case 12:return te.visitStagger(P,D);default:throw function Hn(te){return new s.vHH(3004,!1)}()}}function Ms(te,P){return window.getComputedStyle(te)[P]}const Fo="*";function Xo(te,P){const D=[];return"string"==typeof te?te.split(/\s*,\s*/).forEach(q=>function U1(te,P,D){if(":"==te[0]){const fn=function Jo(te,P){switch(te){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(D,q)=>parseFloat(q)>parseFloat(D);case":decrement":return(D,q)=>parseFloat(q)<parseFloat(D);default:return P.push(function Tt(te){return new s.vHH(3016,!1)}()),"* => *"}}(te,D);if("function"==typeof fn)return void P.push(fn);te=fn}const q=te.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==q||q.length<4)return D.push(function Be(te){return new s.vHH(3015,!1)}()),P;const he=q[1],Fe=q[2],bt=q[3];P.push(To(he,bt));"<"==Fe[0]&&!(he==Fo&&bt==Fo)&&P.push(To(bt,he))}(q,D,P)):D.push(te),D}const va=new Set(["true","1"]),cr=new Set(["false","0"]);function To(te,P){const D=va.has(te)||cr.has(te),q=va.has(P)||cr.has(P);return(he,Fe)=>{let bt=te==Fo||te==he,Mt=P==Fo||P==Fe;return!bt&&D&&"boolean"==typeof he&&(bt=he?va.has(te):cr.has(te)),!Mt&&q&&"boolean"==typeof Fe&&(Mt=Fe?va.has(P):cr.has(P)),bt&&Mt}}const D2=new RegExp("s*:selfs*,?","g");function v1(te,P,D,q){return new ao(te).build(P,D,q)}class ao{constructor(P){this._driver=P}build(P,D,q){const he=new j1(D);return this._resetContextStyleTimingState(he),Nr(this,As(P),he)}_resetContextStyleTimingState(P){P.currentQuerySelector="",P.collectedStyles=new Map,P.collectedStyles.set("",new Map),P.currentTime=0}visitTrigger(P,D){let q=D.queryCount=0,he=D.depCount=0;const Fe=[],bt=[];return"@"==P.name.charAt(0)&&D.errors.push(function $n(){return new s.vHH(3006,!1)}()),P.definitions.forEach(Mt=>{if(this._resetContextStyleTimingState(D),0==Mt.type){const fn=Mt,An=fn.name;An.toString().split(/\s*,\s*/).forEach(fi=>{fn.name=fi,Fe.push(this.visitState(fn,D))}),fn.name=An}else if(1==Mt.type){const fn=this.visitTransition(Mt,D);q+=fn.queryCount,he+=fn.depCount,bt.push(fn)}else D.errors.push(function Wn(){return new s.vHH(3007,!1)}())}),{type:7,name:P.name,states:Fe,transitions:bt,queryCount:q,depCount:he,options:null}}visitState(P,D){const q=this.visitStyle(P.styles,D),he=P.options&&P.options.params||null;if(q.containsDynamicStyles){const Fe=new Set,bt=he||{};q.styles.forEach(Mt=>{Mt instanceof Map&&Mt.forEach(fn=>{Gs(fn).forEach(An=>{bt.hasOwnProperty(An)||Fe.add(An)})})}),Fe.size&&(Ls(Fe.values()),D.errors.push(function Zn(te,P){return new s.vHH(3008,!1)}()))}return{type:0,name:P.name,style:q,options:he?{params:he}:null}}visitTransition(P,D){D.queryCount=0,D.depCount=0;const q=Nr(this,As(P.animation),D);return{type:1,matchers:Xo(P.expr,D.errors),animation:q,queryCount:D.queryCount,depCount:D.depCount,options:xo(P.options)}}visitSequence(P,D){return{type:2,steps:P.steps.map(q=>Nr(this,q,D)),options:xo(P.options)}}visitGroup(P,D){const q=D.currentTime;let he=0;const Fe=P.steps.map(bt=>{D.currentTime=q;const Mt=Nr(this,bt,D);return he=Math.max(he,D.currentTime),Mt});return D.currentTime=he,{type:3,steps:Fe,options:xo(P.options)}}visitAnimate(P,D){const q=function ya(te,P){if(te.hasOwnProperty("duration"))return te;if("number"==typeof te)return y1(es(te,P).duration,0,"");const D=te;if(D.split(/\s+/).some(Fe=>"{"==Fe.charAt(0)&&"{"==Fe.charAt(1))){const Fe=y1(0,0,"");return Fe.dynamic=!0,Fe.strValue=D,Fe}const he=es(D,P);return y1(he.duration,he.delay,he.easing)}(P.timings,D.errors);D.currentAnimateTimings=q;let he,Fe=P.styles?P.styles:(0,Ke.oB)({});if(5==Fe.type)he=this.visitKeyframes(Fe,D);else{let bt=P.styles,Mt=!1;if(!bt){Mt=!0;const An={};q.easing&&(An.easing=q.easing),bt=(0,Ke.oB)(An)}D.currentTime+=q.duration+q.delay;const fn=this.visitStyle(bt,D);fn.isEmptyStep=Mt,he=fn}return D.currentAnimateTimings=null,{type:4,timings:q,style:he,options:null}}visitStyle(P,D){const q=this._makeStyleAst(P,D);return this._validateStyleAst(q,D),q}_makeStyleAst(P,D){const q=[],he=Array.isArray(P.styles)?P.styles:[P.styles];for(let Mt of he)"string"==typeof Mt?Mt===Ke.l3?q.push(Mt):D.errors.push(new s.vHH(3002,!1)):q.push(Cs(Mt));let Fe=!1,bt=null;return q.forEach(Mt=>{if(Mt instanceof Map&&(Mt.has("easing")&&(bt=Mt.get("easing"),Mt.delete("easing")),!Fe))for(let fn of Mt.values())if(fn.toString().indexOf("{{")>=0){Fe=!0;break}}),{type:6,styles:q,easing:bt,offset:P.offset,containsDynamicStyles:Fe,options:null}}_validateStyleAst(P,D){const q=D.currentAnimateTimings;let he=D.currentTime,Fe=D.currentTime;q&&Fe>0&&(Fe-=q.duration+q.delay),P.styles.forEach(bt=>{"string"!=typeof bt&&bt.forEach((Mt,fn)=>{const An=D.collectedStyles.get(D.currentQuerySelector),fi=An.get(fn);let Vi=!0;fi&&(Fe!=he&&Fe>=fi.startTime&&he<=fi.endTime&&(D.errors.push(function Xr(te,P,D,q,he){return new s.vHH(3010,!1)}()),Vi=!1),Fe=fi.startTime),Vi&&An.set(fn,{startTime:Fe,endTime:he}),D.options&&function Bi(te,P,D){const q=P.params||{},he=Gs(te);he.length&&he.forEach(Fe=>{q.hasOwnProperty(Fe)||D.push(function At(te){return new s.vHH(3001,!1)}())})}(Mt,D.options,D.errors)})})}visitKeyframes(P,D){const q={type:5,styles:[],options:null};if(!D.currentAnimateTimings)return D.errors.push(function Ti(){return new s.vHH(3011,!1)}()),q;let Fe=0;const bt=[];let Mt=!1,fn=!1,An=0;const fi=P.steps.map(vr=>{const ko=this._makeStyleAst(vr,D);let da=null!=ko.offset?ko.offset:function Po(te){if("string"==typeof te)return null;let P=null;if(Array.isArray(te))te.forEach(D=>{if(D instanceof Map&&D.has("offset")){const q=D;P=parseFloat(q.get("offset")),q.delete("offset")}});else if(te instanceof Map&&te.has("offset")){const D=te;P=parseFloat(D.get("offset")),D.delete("offset")}return P}(ko.styles),Ia=0;return null!=da&&(Fe++,Ia=ko.offset=da),fn=fn||Ia<0||Ia>1,Mt=Mt||Ia<An,An=Ia,bt.push(Ia),ko});fn&&D.errors.push(function hr(){return new s.vHH(3012,!1)}()),Mt&&D.errors.push(function ri(){return new s.vHH(3200,!1)}());const Vi=P.steps.length;let Zr=0;Fe>0&&Fe<Vi?D.errors.push(function Qi(){return new s.vHH(3202,!1)}()):0==Fe&&(Zr=1/(Vi-1));const Wr=Vi-1,pr=D.currentTime,Fr=D.currentAnimateTimings,_s=Fr.duration;return fi.forEach((vr,ko)=>{const da=Zr>0?ko==Wr?1:Zr*ko:bt[ko],Ia=da*_s;D.currentTime=pr+Fr.delay+Ia,Fr.duration=Ia,this._validateStyleAst(vr,D),vr.offset=da,q.styles.push(vr)}),q}visitReference(P,D){return{type:8,animation:Nr(this,As(P.animation),D),options:xo(P.options)}}visitAnimateChild(P,D){return D.depCount++,{type:9,options:xo(P.options)}}visitAnimateRef(P,D){return{type:10,animation:this.visitReference(P.animation,D),options:xo(P.options)}}visitQuery(P,D){const q=D.currentQuerySelector,he=P.options||{};D.queryCount++,D.currentQuery=P;const[Fe,bt]=function Ua(te){const P=!!te.split(/\s*,\s*/).find(D=>":self"==D);return P&&(te=te.replace(D2,"")),te=te.replace(/@\*/g,br).replace(/@\w+/g,D=>br+"-"+D.slice(1)).replace(/:animating/g,qn),[te,P]}(P.selector);D.currentQuerySelector=q.length?q+" "+Fe:Fe,er(D.collectedStyles,D.currentQuerySelector,new Map);const Mt=Nr(this,As(P.animation),D);return D.currentQuery=null,D.currentQuerySelector=q,{type:11,selector:Fe,limit:he.limit||0,optional:!!he.optional,includeSelf:bt,animation:Mt,originalSelector:P.selector,options:xo(P.options)}}visitStagger(P,D){D.currentQuery||D.errors.push(function Ir(){return new s.vHH(3013,!1)}());const q="full"===P.timings?{duration:0,delay:0,easing:"full"}:es(P.timings,D.errors,!0);return{type:12,animation:Nr(this,As(P.animation),D),timings:q,options:null}}}class j1{constructor(P){this.errors=P,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function xo(te){return te?(te=rr(te)).params&&(te.params=function Ho(te){return te?rr(te):null}(te.params)):te={},te}function y1(te,P,D){return{duration:te,delay:P,easing:D}}function x1(te,P,D,q,he,Fe,bt=null,Mt=!1){return{type:1,element:te,keyframes:P,preStyleProps:D,postStyleProps:q,duration:he,delay:Fe,totalTime:he+Fe,easing:bt,subTimeline:Mt}}class Ds{constructor(){this._map=new Map}get(P){return this._map.get(P)||[]}append(P,D){let q=this._map.get(P);q||this._map.set(P,q=[]),q.push(...D)}has(P){return this._map.has(P)}clear(){this._map.clear()}}const n1=new RegExp(":enter","g"),Ws=new RegExp(":leave","g");function xa(te,P,D,q,he,Fe=new Map,bt=new Map,Mt,fn,An=[]){return(new ea).buildKeyframes(te,P,D,q,he,Fe,bt,Mt,fn,An)}class ea{buildKeyframes(P,D,q,he,Fe,bt,Mt,fn,An,fi=[]){An=An||new Ds;const Vi=new ja(P,D,An,he,Fe,fi,[]);Vi.options=fn;const Zr=fn.delay?Yi(fn.delay):0;Vi.currentTimeline.delayNextStep(Zr),Vi.currentTimeline.setStyles([bt],null,Vi.errors,fn),Nr(this,q,Vi);const Wr=Vi.timelines.filter(pr=>pr.containsAnimation());if(Wr.length&&Mt.size){let pr;for(let Fr=Wr.length-1;Fr>=0;Fr--){const _s=Wr[Fr];if(_s.element===D){pr=_s;break}}pr&&!pr.allowOnlyTimelineStyles()&&pr.setStyles([Mt],null,Vi.errors,fn)}return Wr.length?Wr.map(pr=>pr.buildKeyframes()):[x1(D,[],[],[],0,Zr,"",!1)]}visitTrigger(P,D){}visitState(P,D){}visitTransition(P,D){}visitAnimateChild(P,D){const q=D.subInstructions.get(D.element);if(q){const he=D.createSubContext(P.options),Fe=D.currentTimeline.currentTime,bt=this._visitSubInstructions(q,he,he.options);Fe!=bt&&D.transformIntoNewTimeline(bt)}D.previousNode=P}visitAnimateRef(P,D){const q=D.createSubContext(P.options);q.transformIntoNewTimeline(),this._applyAnimationRefDelays([P.options,P.animation.options],D,q),this.visitReference(P.animation,q),D.transformIntoNewTimeline(q.currentTimeline.currentTime),D.previousNode=P}_applyAnimationRefDelays(P,D,q){for(const he of P){const Fe=he?.delay;if(Fe){const bt="number"==typeof Fe?Fe:Yi(Qn(Fe,he?.params??{},D.errors));q.delayNextStep(bt)}}}_visitSubInstructions(P,D,q){let Fe=D.currentTimeline.currentTime;const bt=null!=q.duration?Yi(q.duration):null,Mt=null!=q.delay?Yi(q.delay):null;return 0!==bt&&P.forEach(fn=>{const An=D.appendInstructionToTimeline(fn,bt,Mt);Fe=Math.max(Fe,An.duration+An.delay)}),Fe}visitReference(P,D){D.updateOptions(P.options,!0),Nr(this,P.animation,D),D.previousNode=P}visitSequence(P,D){const q=D.subContextCount;let he=D;const Fe=P.options;if(Fe&&(Fe.params||Fe.delay)&&(he=D.createSubContext(Fe),he.transformIntoNewTimeline(),null!=Fe.delay)){6==he.previousNode.type&&(he.currentTimeline.snapshotCurrentStyles(),he.previousNode=co);const bt=Yi(Fe.delay);he.delayNextStep(bt)}P.steps.length&&(P.steps.forEach(bt=>Nr(this,bt,he)),he.currentTimeline.applyStylesToKeyframe(),he.subContextCount>q&&he.transformIntoNewTimeline()),D.previousNode=P}visitGroup(P,D){const q=[];let he=D.currentTimeline.currentTime;const Fe=P.options&&P.options.delay?Yi(P.options.delay):0;P.steps.forEach(bt=>{const Mt=D.createSubContext(P.options);Fe&&Mt.delayNextStep(Fe),Nr(this,bt,Mt),he=Math.max(he,Mt.currentTimeline.currentTime),q.push(Mt.currentTimeline)}),q.forEach(bt=>D.currentTimeline.mergeTimelineCollectedStyles(bt)),D.transformIntoNewTimeline(he),D.previousNode=P}_visitTiming(P,D){if(P.dynamic){const q=P.strValue;return es(D.params?Qn(q,D.params,D.errors):q,D.errors)}return{duration:P.duration,delay:P.delay,easing:P.easing}}visitAnimate(P,D){const q=D.currentAnimateTimings=this._visitTiming(P.timings,D),he=D.currentTimeline;q.delay&&(D.incrementTime(q.delay),he.snapshotCurrentStyles());const Fe=P.style;5==Fe.type?this.visitKeyframes(Fe,D):(D.incrementTime(q.duration),this.visitStyle(Fe,D),he.applyStylesToKeyframe()),D.currentAnimateTimings=null,D.previousNode=P}visitStyle(P,D){const q=D.currentTimeline,he=D.currentAnimateTimings;!he&&q.hasCurrentStyleProperties()&&q.forwardFrame();const Fe=he&&he.easing||P.easing;P.isEmptyStep?q.applyEmptyStep(Fe):q.setStyles(P.styles,Fe,D.errors,D.options),D.previousNode=P}visitKeyframes(P,D){const q=D.currentAnimateTimings,he=D.currentTimeline.duration,Fe=q.duration,Mt=D.createSubContext().currentTimeline;Mt.easing=q.easing,P.styles.forEach(fn=>{Mt.forwardTime((fn.offset||0)*Fe),Mt.setStyles(fn.styles,fn.easing,D.errors,D.options),Mt.applyStylesToKeyframe()}),D.currentTimeline.mergeTimelineCollectedStyles(Mt),D.transformIntoNewTimeline(he+Fe),D.previousNode=P}visitQuery(P,D){const q=D.currentTimeline.currentTime,he=P.options||{},Fe=he.delay?Yi(he.delay):0;Fe&&(6===D.previousNode.type||0==q&&D.currentTimeline.hasCurrentStyleProperties())&&(D.currentTimeline.snapshotCurrentStyles(),D.previousNode=co);let bt=q;const Mt=D.invokeQuery(P.selector,P.originalSelector,P.limit,P.includeSelf,!!he.optional,D.errors);D.currentQueryTotal=Mt.length;let fn=null;Mt.forEach((An,fi)=>{D.currentQueryIndex=fi;const Vi=D.createSubContext(P.options,An);Fe&&Vi.delayNextStep(Fe),An===D.element&&(fn=Vi.currentTimeline),Nr(this,P.animation,Vi),Vi.currentTimeline.applyStylesToKeyframe(),bt=Math.max(bt,Vi.currentTimeline.currentTime)}),D.currentQueryIndex=0,D.currentQueryTotal=0,D.transformIntoNewTimeline(bt),fn&&(D.currentTimeline.mergeTimelineCollectedStyles(fn),D.currentTimeline.snapshotCurrentStyles()),D.previousNode=P}visitStagger(P,D){const q=D.parentContext,he=D.currentTimeline,Fe=P.timings,bt=Math.abs(Fe.duration),Mt=bt*(D.currentQueryTotal-1);let fn=bt*D.currentQueryIndex;switch(Fe.duration<0?"reverse":Fe.easing){case"reverse":fn=Mt-fn;break;case"full":fn=q.currentStaggerTime}const fi=D.currentTimeline;fn&&fi.delayNextStep(fn);const Vi=fi.currentTime;Nr(this,P.animation,D),D.previousNode=P,q.currentStaggerTime=he.currentTime-Vi+(he.startTime-q.currentTimeline.startTime)}}const co={};class ja{constructor(P,D,q,he,Fe,bt,Mt,fn){this._driver=P,this.element=D,this.subInstructions=q,this._enterClassName=he,this._leaveClassName=Fe,this.errors=bt,this.timelines=Mt,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=co,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=fn||new Zo(this._driver,D,0),Mt.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(P,D){if(!P)return;const q=P;let he=this.options;null!=q.duration&&(he.duration=Yi(q.duration)),null!=q.delay&&(he.delay=Yi(q.delay));const Fe=q.params;if(Fe){let bt=he.params;bt||(bt=this.options.params={}),Object.keys(Fe).forEach(Mt=>{(!D||!bt.hasOwnProperty(Mt))&&(bt[Mt]=Qn(Fe[Mt],bt,this.errors))})}}_copyOptions(){const P={};if(this.options){const D=this.options.params;if(D){const q=P.params={};Object.keys(D).forEach(he=>{q[he]=D[he]})}}return P}createSubContext(P=null,D,q){const he=D||this.element,Fe=new ja(this._driver,he,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(he,q||0));return Fe.previousNode=this.previousNode,Fe.currentAnimateTimings=this.currentAnimateTimings,Fe.options=this._copyOptions(),Fe.updateOptions(P),Fe.currentQueryIndex=this.currentQueryIndex,Fe.currentQueryTotal=this.currentQueryTotal,Fe.parentContext=this,this.subContextCount++,Fe}transformIntoNewTimeline(P){return this.previousNode=co,this.currentTimeline=this.currentTimeline.fork(this.element,P),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(P,D,q){const he={duration:D??P.duration,delay:this.currentTimeline.currentTime+(q??0)+P.delay,easing:""},Fe=new po(this._driver,P.element,P.keyframes,P.preStyleProps,P.postStyleProps,he,P.stretchStartingKeyframe);return this.timelines.push(Fe),he}incrementTime(P){this.currentTimeline.forwardTime(this.currentTimeline.duration+P)}delayNextStep(P){P>0&&this.currentTimeline.delayNextStep(P)}invokeQuery(P,D,q,he,Fe,bt){let Mt=[];if(he&&Mt.push(this.element),P.length>0){P=(P=P.replace(n1,"."+this._enterClassName)).replace(Ws,"."+this._leaveClassName);let An=this._driver.query(this.element,P,1!=q);0!==q&&(An=q<0?An.slice(An.length+q,An.length):An.slice(0,q)),Mt.push(...An)}return!Fe&&0==Mt.length&&bt.push(function cn(te){return new s.vHH(3014,!1)}()),Mt}}class Zo{constructor(P,D,q,he){this._driver=P,this.element=D,this.startTime=q,this._elementTimelineStylesLookup=he,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(D),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(D,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(P){const D=1===this._keyframes.size&&this._pendingStyles.size;this.duration||D?(this.forwardTime(this.currentTime+P),D&&this.snapshotCurrentStyles()):this.startTime+=P}fork(P,D){return this.applyStylesToKeyframe(),new Zo(this._driver,P,D||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(P){this.applyStylesToKeyframe(),this.duration=P,this._loadKeyframe()}_updateStyle(P,D){this._localTimelineStyles.set(P,D),this._globalTimelineStyles.set(P,D),this._styleSummary.set(P,{time:this.currentTime,value:D})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(P){P&&this._previousKeyframe.set("easing",P);for(let[D,q]of this._globalTimelineStyles)this._backFill.set(D,q||Ke.l3),this._currentKeyframe.set(D,Ke.l3);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(P,D,q,he){D&&this._previousKeyframe.set("easing",D);const Fe=he&&he.params||{},bt=function Rn(te,P){const D=new Map;let q;return te.forEach(he=>{if("*"===he){q=q||P.keys();for(let Fe of q)D.set(Fe,Ke.l3)}else _r(he,D)}),D}(P,this._globalTimelineStyles);for(let[Mt,fn]of bt){const An=Qn(fn,Fe,q);this._pendingStyles.set(Mt,An),this._localTimelineStyles.has(Mt)||this._backFill.set(Mt,this._globalTimelineStyles.get(Mt)??Ke.l3),this._updateStyle(Mt,An)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((P,D)=>{this._currentKeyframe.set(D,P)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((P,D)=>{this._currentKeyframe.has(D)||this._currentKeyframe.set(D,P)}))}snapshotCurrentStyles(){for(let[P,D]of this._localTimelineStyles)this._pendingStyles.set(P,D),this._updateStyle(P,D)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const P=[];for(let D in this._currentKeyframe)P.push(D);return P}mergeTimelineCollectedStyles(P){P._styleSummary.forEach((D,q)=>{const he=this._styleSummary.get(q);(!he||D.time>he.time)&&this._updateStyle(q,D.value)})}buildKeyframes(){this.applyStylesToKeyframe();const P=new Set,D=new Set,q=1===this._keyframes.size&&0===this.duration;let he=[];this._keyframes.forEach((Mt,fn)=>{const An=_r(Mt,new Map,this._backFill);An.forEach((fi,Vi)=>{fi===Ke.k1?P.add(Vi):fi===Ke.l3&&D.add(Vi)}),q||An.set("offset",fn/this.duration),he.push(An)});const Fe=P.size?Ls(P.values()):[],bt=D.size?Ls(D.values()):[];if(q){const Mt=he[0],fn=new Map(Mt);Mt.set("offset",0),fn.set("offset",1),he=[Mt,fn]}return x1(this.element,he,Fe,bt,this.duration,this.startTime,this.easing,!1)}}class po extends Zo{constructor(P,D,q,he,Fe,bt,Mt=!1){super(P,D,bt.delay),this.keyframes=q,this.preStyleProps=he,this.postStyleProps=Fe,this._stretchStartingKeyframe=Mt,this.timings={duration:bt.duration,delay:bt.delay,easing:bt.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let P=this.keyframes,{delay:D,duration:q,easing:he}=this.timings;if(this._stretchStartingKeyframe&&D){const Fe=[],bt=q+D,Mt=D/bt,fn=_r(P[0]);fn.set("offset",0),Fe.push(fn);const An=_r(P[0]);An.set("offset",Ss(Mt)),Fe.push(An);const fi=P.length-1;for(let Vi=1;Vi<=fi;Vi++){let Zr=_r(P[Vi]);const Wr=Zr.get("offset");Zr.set("offset",Ss((D+Wr*q)/bt)),Fe.push(Zr)}q=bt,D=0,he="",P=Fe}return x1(this.element,P,this.preStyleProps,this.postStyleProps,q,D,he,!0)}}function Ss(te,P=3){const D=Math.pow(10,P-1);return Math.round(te*D)/D}class A1{}const Ga=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class aa extends A1{normalizePropertyName(P,D){return as(P)}normalizeStyleValue(P,D,q,he){let Fe="";const bt=q.toString().trim();if(Ga.has(D)&&0!==q&&"0"!==q)if("number"==typeof q)Fe="px";else{const Mt=q.match(/^[+-]?[\d\.]+([a-z]*)$/);Mt&&0==Mt[1].length&&he.push(function Qt(te,P){return new s.vHH(3005,!1)}())}return bt+Fe}}function sr(te,P,D,q,he,Fe,bt,Mt,fn,An,fi,Vi,Zr){return{type:0,element:te,triggerName:P,isRemovalTransition:he,fromState:D,fromStyles:Fe,toState:q,toStyles:bt,timelines:Mt,queriedElements:fn,preStyleProps:An,postStyleProps:fi,totalTime:Vi,errors:Zr}}const ca={};class la{constructor(P,D,q){this._triggerName=P,this.ast=D,this._stateStyles=q}match(P,D,q,he){return function $a(te,P,D,q,he){return te.some(Fe=>Fe(P,D,q,he))}(this.ast.matchers,P,D,q,he)}buildStyles(P,D,q){let he=this._stateStyles.get("*");return void 0!==P&&(he=this._stateStyles.get(P?.toString())||he),he?he.buildStyles(D,q):new Map}build(P,D,q,he,Fe,bt,Mt,fn,An,fi){const Vi=[],Zr=this.ast.options&&this.ast.options.params||ca,pr=this.buildStyles(q,Mt&&Mt.params||ca,Vi),Fr=fn&&fn.params||ca,_s=this.buildStyles(he,Fr,Vi),vr=new Set,ko=new Map,da=new Map,Ia="void"===he,Va={params:se(Fr,Zr),delay:this.ast.options?.delay},ia=fi?[]:xa(P,D,this.ast.animation,Fe,bt,pr,_s,Va,An,Vi);let jo=0;if(ia.forEach(Xn=>{jo=Math.max(Xn.duration+Xn.delay,jo)}),Vi.length)return sr(D,this._triggerName,q,he,Ia,pr,_s,[],[],ko,da,jo,Vi);ia.forEach(Xn=>{const C1=Xn.element,Nc=er(ko,C1,new Set);Xn.preStyleProps.forEach(Ya=>Nc.add(Ya));const Ts=er(da,C1,new Set);Xn.postStyleProps.forEach(Ya=>Ts.add(Ya)),C1!==D&&vr.add(C1)});const P1=Ls(vr.values());return sr(D,this._triggerName,q,he,Ia,pr,_s,ia,P1,ko,da,jo)}}function se(te,P){const D=rr(P);for(const q in te)te.hasOwnProperty(q)&&null!=te[q]&&(D[q]=te[q]);return D}class ne{constructor(P,D,q){this.styles=P,this.defaultParams=D,this.normalizer=q}buildStyles(P,D){const q=new Map,he=rr(this.defaultParams);return Object.keys(P).forEach(Fe=>{const bt=P[Fe];null!==bt&&(he[Fe]=bt)}),this.styles.styles.forEach(Fe=>{"string"!=typeof Fe&&Fe.forEach((bt,Mt)=>{bt&&(bt=Qn(bt,he,D));const fn=this.normalizer.normalizePropertyName(Mt,D);bt=this.normalizer.normalizeStyleValue(Mt,fn,bt,D),q.set(Mt,bt)})}),q}}class Ve{constructor(P,D,q){this.name=P,this.ast=D,this._normalizer=q,this.transitionFactories=[],this.states=new Map,D.states.forEach(he=>{this.states.set(he.name,new ne(he.style,he.options&&he.options.params||{},q))}),jn(this.states,"true","1"),jn(this.states,"false","0"),D.transitions.forEach(he=>{this.transitionFactories.push(new la(P,he,this.states))}),this.fallbackTransition=function lt(te,P,D){return new la(te,{type:1,animation:{type:2,steps:[],options:null},matchers:[(bt,Mt)=>!0],options:null,queryCount:0,depCount:0},P)}(P,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(P,D,q,he){return this.transitionFactories.find(bt=>bt.match(P,D,q,he))||null}matchStyles(P,D,q){return this.fallbackTransition.buildStyles(P,D,q)}}function jn(te,P,D){te.has(P)?te.has(D)||te.set(D,te.get(P)):te.has(D)&&te.set(P,te.get(D))}const ms=new Ds;class Eo{constructor(P,D,q){this.bodyNode=P,this._driver=D,this._normalizer=q,this._animations=new Map,this._playersById=new Map,this.players=[]}register(P,D){const q=[],he=[],Fe=v1(this._driver,D,q,he);if(q.length)throw function kt(te){return new s.vHH(3503,!1)}();this._animations.set(P,Fe)}_buildPlayer(P,D,q){const he=P.element,Fe=Dn(0,this._normalizer,0,P.keyframes,D,q);return this._driver.animate(he,Fe,P.duration,P.delay,P.easing,[],!0)}create(P,D,q={}){const he=[],Fe=this._animations.get(P);let bt;const Mt=new Map;if(Fe?(bt=xa(this._driver,D,Fe,ps,Fs,new Map,new Map,q,ms,he),bt.forEach(fi=>{const Vi=er(Mt,fi.element,new Map);fi.postStyleProps.forEach(Zr=>Vi.set(Zr,null))})):(he.push(function Ht(){return new s.vHH(3300,!1)}()),bt=[]),he.length)throw function an(te){return new s.vHH(3504,!1)}();Mt.forEach((fi,Vi)=>{fi.forEach((Zr,Wr)=>{fi.set(Wr,this._driver.computeStyle(Vi,Wr,Ke.l3))})});const An=bn(bt.map(fi=>{const Vi=Mt.get(fi.element);return this._buildPlayer(fi,new Map,Vi)}));return this._playersById.set(P,An),An.onDestroy(()=>this.destroy(P)),this.players.push(An),An}destroy(P){const D=this._getPlayer(P);D.destroy(),this._playersById.delete(P);const q=this.players.indexOf(D);q>=0&&this.players.splice(q,1)}_getPlayer(P){const D=this._playersById.get(P);if(!D)throw function _n(te){return new s.vHH(3301,!1)}();return D}listen(P,D,q,he){const Fe=si(D,"","","");return Nn(this._getPlayer(P),q,Fe,he),()=>{}}command(P,D,q,he){if("register"==q)return void this.register(P,he[0]);if("create"==q)return void this.create(P,D,he[0]||{});const Fe=this._getPlayer(P);switch(q){case"play":Fe.play();break;case"pause":Fe.pause();break;case"reset":Fe.reset();break;case"restart":Fe.restart();break;case"finish":Fe.finish();break;case"init":Fe.init();break;case"setPosition":Fe.setPosition(parseFloat(he[0]));break;case"destroy":this.destroy(P)}}}const Hs="ng-animate-queued",Yo="ng-animate-disabled",a1=[],b1={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},t2={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},gs="__ng_removed";class Bo{get params(){return this.options.params}constructor(P,D=""){this.namespaceId=D;const q=P&&P.hasOwnProperty("value");if(this.value=function I1(te){return te??null}(q?P.value:P),q){const Fe=rr(P);delete Fe.value,this.options=Fe}else this.options={};this.options.params||(this.options.params={})}absorbOptions(P){const D=P.params;if(D){const q=this.options.params;Object.keys(D).forEach(he=>{null==q[he]&&(q[he]=D[he])})}}}const ta="void",c1=new Bo(ta);class mo{constructor(P,D,q){this.id=P,this.hostElement=D,this._engine=q,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+P,Yt(D,this._hostClassName)}listen(P,D,q,he){if(!this._triggers.has(D))throw function qe(te,P){return new s.vHH(3302,!1)}();if(null==q||0==q.length)throw function Ge(te){return new s.vHH(3303,!1)}();if(!function qa(te){return"start"==te||"done"==te}(q))throw function ye(te,P){return new s.vHH(3400,!1)}();const Fe=er(this._elementListeners,P,[]),bt={name:D,phase:q,callback:he};Fe.push(bt);const Mt=er(this._engine.statesByElement,P,new Map);return Mt.has(D)||(Yt(P,Vo),Yt(P,Vo+"-"+D),Mt.set(D,c1)),()=>{this._engine.afterFlush(()=>{const fn=Fe.indexOf(bt);fn>=0&&Fe.splice(fn,1),this._triggers.has(D)||Mt.delete(D)})}}register(P,D){return!this._triggers.has(P)&&(this._triggers.set(P,D),!0)}_getTrigger(P){const D=this._triggers.get(P);if(!D)throw function ke(te){return new s.vHH(3401,!1)}();return D}trigger(P,D,q,he=!0){const Fe=this._getTrigger(D),bt=new Wa(this.id,D,P);let Mt=this._engine.statesByElement.get(P);Mt||(Yt(P,Vo),Yt(P,Vo+"-"+D),this._engine.statesByElement.set(P,Mt=new Map));let fn=Mt.get(D);const An=new Bo(q,this.id);if(!(q&&q.hasOwnProperty("value"))&&fn&&An.absorbOptions(fn.options),Mt.set(D,An),fn||(fn=c1),An.value!==ta&&fn.value===An.value){if(!function Da(te,P){const D=Object.keys(te),q=Object.keys(P);if(D.length!=q.length)return!1;for(let he=0;he<D.length;he++){const Fe=D[he];if(!P.hasOwnProperty(Fe)||te[Fe]!==P[Fe])return!1}return!0}(fn.params,An.params)){const Fr=[],_s=Fe.matchStyles(fn.value,fn.params,Fr),vr=Fe.matchStyles(An.value,An.params,Fr);Fr.length?this._engine.reportError(Fr):this._engine.afterFlush(()=>{Ci(P,_s),eo(P,vr)})}return}const Zr=er(this._engine.playersByElement,P,[]);Zr.forEach(Fr=>{Fr.namespaceId==this.id&&Fr.triggerName==D&&Fr.queued&&Fr.destroy()});let Wr=Fe.matchTransition(fn.value,An.value,P,An.params),pr=!1;if(!Wr){if(!he)return;Wr=Fe.fallbackTransition,pr=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:P,triggerName:D,transition:Wr,fromState:fn,toState:An,player:bt,isFallbackTransition:pr}),pr||(Yt(P,Hs),bt.onStart(()=>{Pn(P,Hs)})),bt.onDone(()=>{let Fr=this.players.indexOf(bt);Fr>=0&&this.players.splice(Fr,1);const _s=this._engine.playersByElement.get(P);if(_s){let vr=_s.indexOf(bt);vr>=0&&_s.splice(vr,1)}}),this.players.push(bt),Zr.push(bt),bt}deregister(P){this._triggers.delete(P),this._engine.statesByElement.forEach(D=>D.delete(P)),this._elementListeners.forEach((D,q)=>{this._elementListeners.set(q,D.filter(he=>he.name!=P))})}clearElementCache(P){this._engine.statesByElement.delete(P),this._elementListeners.delete(P);const D=this._engine.playersByElement.get(P);D&&(D.forEach(q=>q.destroy()),this._engine.playersByElement.delete(P))}_signalRemovalForInnerTriggers(P,D){const q=this._engine.driver.query(P,br,!0);q.forEach(he=>{if(he[gs])return;const Fe=this._engine.fetchNamespacesByElement(he);Fe.size?Fe.forEach(bt=>bt.triggerLeaveAnimation(he,D,!1,!0)):this.clearElementCache(he)}),this._engine.afterFlushAnimationsDone(()=>q.forEach(he=>this.clearElementCache(he)))}triggerLeaveAnimation(P,D,q,he){const Fe=this._engine.statesByElement.get(P),bt=new Map;if(Fe){const Mt=[];if(Fe.forEach((fn,An)=>{if(bt.set(An,fn.value),this._triggers.has(An)){const fi=this.trigger(P,An,ta,he);fi&&Mt.push(fi)}}),Mt.length)return this._engine.markElementAsRemoved(this.id,P,!0,D,bt),q&&bn(Mt).onDone(()=>this._engine.processLeaveNode(P)),!0}return!1}prepareLeaveAnimationListeners(P){const D=this._elementListeners.get(P),q=this._engine.statesByElement.get(P);if(D&&q){const he=new Set;D.forEach(Fe=>{const bt=Fe.name;if(he.has(bt))return;he.add(bt);const fn=this._triggers.get(bt).fallbackTransition,An=q.get(bt)||c1,fi=new Bo(ta),Vi=new Wa(this.id,bt,P);this._engine.totalQueuedPlayers++,this._queue.push({element:P,triggerName:bt,transition:fn,fromState:An,toState:fi,player:Vi,isFallbackTransition:!0})})}}removeNode(P,D){const q=this._engine;if(P.childElementCount&&this._signalRemovalForInnerTriggers(P,D),this.triggerLeaveAnimation(P,D,!0))return;let he=!1;if(q.totalAnimations){const Fe=q.players.length?q.playersByQueriedElement.get(P):[];if(Fe&&Fe.length)he=!0;else{let bt=P;for(;bt=bt.parentNode;)if(q.statesByElement.get(bt)){he=!0;break}}}if(this.prepareLeaveAnimationListeners(P),he)q.markElementAsRemoved(this.id,P,!1,D);else{const Fe=P[gs];(!Fe||Fe===b1)&&(q.afterFlush(()=>this.clearElementCache(P)),q.destroyInnerAnimations(P),q._onRemovalComplete(P,D))}}insertNode(P,D){Yt(P,this._hostClassName)}drainQueuedTransitions(P){const D=[];return this._queue.forEach(q=>{const he=q.player;if(he.destroyed)return;const Fe=q.element,bt=this._elementListeners.get(Fe);bt&&bt.forEach(Mt=>{if(Mt.name==q.triggerName){const fn=si(Fe,q.triggerName,q.fromState.value,q.toState.value);fn._data=P,Nn(q.player,Mt.phase,fn,Mt.callback)}}),he.markedForDestroy?this._engine.afterFlush(()=>{he.destroy()}):D.push(q)}),this._queue=[],D.sort((q,he)=>{const Fe=q.transition.ast.depCount,bt=he.transition.ast.depCount;return 0==Fe||0==bt?Fe-bt:this._engine.driver.containsElement(q.element,he.element)?1:-1})}destroy(P){this.players.forEach(D=>D.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,P)}elementContainsData(P){let D=!1;return this._elementListeners.has(P)&&(D=!0),D=!!this._queue.find(q=>q.element===P)||D,D}}class n2{_onRemovalComplete(P,D){this.onRemovalComplete(P,D)}constructor(P,D,q){this.bodyNode=P,this.driver=D,this._normalizer=q,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(he,Fe)=>{}}get queuedPlayers(){const P=[];return this._namespaceList.forEach(D=>{D.players.forEach(q=>{q.queued&&P.push(q)})}),P}createNamespace(P,D){const q=new mo(P,D,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,D)?this._balanceNamespaceList(q,D):(this.newHostElements.set(D,q),this.collectEnterElement(D)),this._namespaceLookup[P]=q}_balanceNamespaceList(P,D){const q=this._namespaceList,he=this.namespacesByHostElement;if(q.length-1>=0){let bt=!1,Mt=this.driver.getParentElement(D);for(;Mt;){const fn=he.get(Mt);if(fn){const An=q.indexOf(fn);q.splice(An+1,0,P),bt=!0;break}Mt=this.driver.getParentElement(Mt)}bt||q.unshift(P)}else q.push(P);return he.set(D,P),P}register(P,D){let q=this._namespaceLookup[P];return q||(q=this.createNamespace(P,D)),q}registerTrigger(P,D,q){let he=this._namespaceLookup[P];he&&he.register(D,q)&&this.totalAnimations++}destroy(P,D){if(!P)return;const q=this._fetchNamespace(P);this.afterFlush(()=>{this.namespacesByHostElement.delete(q.hostElement),delete this._namespaceLookup[P];const he=this._namespaceList.indexOf(q);he>=0&&this._namespaceList.splice(he,1)}),this.afterFlushAnimationsDone(()=>q.destroy(D))}_fetchNamespace(P){return this._namespaceLookup[P]}fetchNamespacesByElement(P){const D=new Set,q=this.statesByElement.get(P);if(q)for(let he of q.values())if(he.namespaceId){const Fe=this._fetchNamespace(he.namespaceId);Fe&&D.add(Fe)}return D}trigger(P,D,q,he){if(wa(D)){const Fe=this._fetchNamespace(P);if(Fe)return Fe.trigger(D,q,he),!0}return!1}insertNode(P,D,q,he){if(!wa(D))return;const Fe=D[gs];if(Fe&&Fe.setForRemoval){Fe.setForRemoval=!1,Fe.setForMove=!0;const bt=this.collectedLeaveElements.indexOf(D);bt>=0&&this.collectedLeaveElements.splice(bt,1)}if(P){const bt=this._fetchNamespace(P);bt&&bt.insertNode(D,q)}he&&this.collectEnterElement(D)}collectEnterElement(P){this.collectedEnterElements.push(P)}markElementAsDisabled(P,D){D?this.disabledNodes.has(P)||(this.disabledNodes.add(P),Yt(P,Yo)):this.disabledNodes.has(P)&&(this.disabledNodes.delete(P),Pn(P,Yo))}removeNode(P,D,q,he){if(wa(D)){const Fe=P?this._fetchNamespace(P):null;if(Fe?Fe.removeNode(D,he):this.markElementAsRemoved(P,D,!1,he),q){const bt=this.namespacesByHostElement.get(D);bt&&bt.id!==P&&bt.removeNode(D,he)}}else this._onRemovalComplete(D,he)}markElementAsRemoved(P,D,q,he,Fe){this.collectedLeaveElements.push(D),D[gs]={namespaceId:P,setForRemoval:he,hasAnimation:q,removedBeforeQueried:!1,previousTriggersValues:Fe}}listen(P,D,q,he,Fe){return wa(D)?this._fetchNamespace(P).listen(D,q,he,Fe):()=>{}}_buildInstruction(P,D,q,he,Fe){return P.transition.build(this.driver,P.element,P.fromState.value,P.toState.value,q,he,P.fromState.options,P.toState.options,D,Fe)}destroyInnerAnimations(P){let D=this.driver.query(P,br,!0);D.forEach(q=>this.destroyActiveAnimationsForElement(q)),0!=this.playersByQueriedElement.size&&(D=this.driver.query(P,qn,!0),D.forEach(q=>this.finishActiveQueriedAnimationOnElement(q)))}destroyActiveAnimationsForElement(P){const D=this.playersByElement.get(P);D&&D.forEach(q=>{q.queued?q.markedForDestroy=!0:q.destroy()})}finishActiveQueriedAnimationOnElement(P){const D=this.playersByQueriedElement.get(P);D&&D.forEach(q=>q.finish())}whenRenderingDone(){return new Promise(P=>{if(this.players.length)return bn(this.players).onDone(()=>P());P()})}processLeaveNode(P){const D=P[gs];if(D&&D.setForRemoval){if(P[gs]=b1,D.namespaceId){this.destroyInnerAnimations(P);const q=this._fetchNamespace(D.namespaceId);q&&q.clearElementCache(P)}this._onRemovalComplete(P,D.setForRemoval)}P.classList?.contains(Yo)&&this.markElementAsDisabled(P,!1),this.driver.query(P,".ng-animate-disabled",!0).forEach(q=>{this.markElementAsDisabled(q,!1)})}flush(P=-1){let D=[];if(this.newHostElements.size&&(this.newHostElements.forEach((q,he)=>this._balanceNamespaceList(q,he)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let q=0;q<this.collectedEnterElements.length;q++)Yt(this.collectedEnterElements[q],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const q=[];try{D=this._flushAnimations(q,P)}finally{for(let he=0;he<q.length;he++)q[he]()}}else for(let q=0;q<this.collectedLeaveElements.length;q++)this.processLeaveNode(this.collectedLeaveElements[q]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(q=>q()),this._flushFns=[],this._whenQuietFns.length){const q=this._whenQuietFns;this._whenQuietFns=[],D.length?bn(D).onDone(()=>{q.forEach(he=>he())}):q.forEach(he=>he())}}reportError(P){throw function J(te){return new s.vHH(3402,!1)}()}_flushAnimations(P,D){const q=new Ds,he=[],Fe=new Map,bt=[],Mt=new Map,fn=new Map,An=new Map,fi=new Set;this.disabledNodes.forEach(Ni=>{fi.add(Ni);const lr=this.driver.query(Ni,".ng-animate-queued",!0);for(let wr=0;wr<lr.length;wr++)fi.add(lr[wr])});const Vi=this.bodyNode,Zr=Array.from(this.statesByElement.keys()),Wr=$e(Zr,this.collectedEnterElements),pr=new Map;let Fr=0;Wr.forEach((Ni,lr)=>{const wr=ps+Fr++;pr.set(lr,wr),Ni.forEach(us=>Yt(us,wr))});const _s=[],vr=new Set,ko=new Set;for(let Ni=0;Ni<this.collectedLeaveElements.length;Ni++){const lr=this.collectedLeaveElements[Ni],wr=lr[gs];wr&&wr.setForRemoval&&(_s.push(lr),vr.add(lr),wr.hasAnimation?this.driver.query(lr,".ng-star-inserted",!0).forEach(us=>vr.add(us)):ko.add(lr))}const da=new Map,Ia=$e(Zr,Array.from(vr));Ia.forEach((Ni,lr)=>{const wr=Fs+Fr++;da.set(lr,wr),Ni.forEach(us=>Yt(us,wr))}),P.push(()=>{Wr.forEach((Ni,lr)=>{const wr=pr.get(lr);Ni.forEach(us=>Pn(us,wr))}),Ia.forEach((Ni,lr)=>{const wr=da.get(lr);Ni.forEach(us=>Pn(us,wr))}),_s.forEach(Ni=>{this.processLeaveNode(Ni)})});const Va=[],ia=[];for(let Ni=this._namespaceList.length-1;Ni>=0;Ni--)this._namespaceList[Ni].drainQueuedTransitions(D).forEach(wr=>{const us=wr.player,Ao=wr.element;if(Va.push(us),this.collectedEnterElements.length){const $=Ao[gs];if($&&$.setForMove){if($.previousTriggersValues&&$.previousTriggersValues.has(wr.triggerName)){const oe=$.previousTriggersValues.get(wr.triggerName),xe=this.statesByElement.get(wr.element);if(xe&&xe.has(wr.triggerName)){const Oe=xe.get(wr.triggerName);Oe.value=oe,xe.set(wr.triggerName,Oe)}}return void us.destroy()}}const L1=!Vi||!this.driver.containsElement(Vi,Ao),f1=da.get(Ao),W1=pr.get(Ao),k=this._buildInstruction(wr,q,W1,f1,L1);if(k.errors&&k.errors.length)return void ia.push(k);if(L1)return us.onStart(()=>Ci(Ao,k.fromStyles)),us.onDestroy(()=>eo(Ao,k.toStyles)),void he.push(us);if(wr.isFallbackTransition)return us.onStart(()=>Ci(Ao,k.fromStyles)),us.onDestroy(()=>eo(Ao,k.toStyles)),void he.push(us);const F=[];k.timelines.forEach($=>{$.stretchStartingKeyframe=!0,this.disabledNodes.has($.element)||F.push($)}),k.timelines=F,q.append(Ao,k.timelines),bt.push({instruction:k,player:us,element:Ao}),k.queriedElements.forEach($=>er(Mt,$,[]).push(us)),k.preStyleProps.forEach(($,oe)=>{if($.size){let xe=fn.get(oe);xe||fn.set(oe,xe=new Set),$.forEach((Oe,Ut)=>xe.add(Ut))}}),k.postStyleProps.forEach(($,oe)=>{let xe=An.get(oe);xe||An.set(oe,xe=new Set),$.forEach((Oe,Ut)=>xe.add(Ut))})});if(ia.length){const Ni=[];ia.forEach(lr=>{Ni.push(function Se(te,P){return new s.vHH(3505,!1)}())}),Va.forEach(lr=>lr.destroy()),this.reportError(Ni)}const jo=new Map,P1=new Map;bt.forEach(Ni=>{const lr=Ni.element;q.has(lr)&&(P1.set(lr,lr),this._beforeAnimationBuild(Ni.player.namespaceId,Ni.instruction,jo))}),he.forEach(Ni=>{const lr=Ni.element;this._getPreviousPlayers(lr,!1,Ni.namespaceId,Ni.triggerName,null).forEach(us=>{er(jo,lr,[]).push(us),us.destroy()})});const Xn=_s.filter(Ni=>V1(Ni,fn,An)),C1=new Map;ft(C1,this.driver,ko,An,Ke.l3).forEach(Ni=>{V1(Ni,fn,An)&&Xn.push(Ni)});const Ts=new Map;Wr.forEach((Ni,lr)=>{ft(Ts,this.driver,new Set(Ni),fn,Ke.k1)}),Xn.forEach(Ni=>{const lr=C1.get(Ni),wr=Ts.get(Ni);C1.set(Ni,new Map([...Array.from(lr?.entries()??[]),...Array.from(wr?.entries()??[])]))});const Ya=[],ai=[],o2={};bt.forEach(Ni=>{const{element:lr,player:wr,instruction:us}=Ni;if(q.has(lr)){if(fi.has(lr))return wr.onDestroy(()=>eo(lr,us.toStyles)),wr.disabled=!0,wr.overrideTotalTime(us.totalTime),void he.push(wr);let Ao=o2;if(P1.size>1){let f1=lr;const W1=[];for(;f1=f1.parentNode;){const k=P1.get(f1);if(k){Ao=k;break}W1.push(f1)}W1.forEach(k=>P1.set(k,Ao))}const L1=this._buildAnimation(wr.namespaceId,us,jo,Fe,Ts,C1);if(wr.setRealPlayer(L1),Ao===o2)Ya.push(wr);else{const f1=this.playersByElement.get(Ao);f1&&f1.length&&(wr.parentPlayer=bn(f1)),he.push(wr)}}else Ci(lr,us.fromStyles),wr.onDestroy(()=>eo(lr,us.toStyles)),ai.push(wr),fi.has(lr)&&he.push(wr)}),ai.forEach(Ni=>{const lr=Fe.get(Ni.element);if(lr&&lr.length){const wr=bn(lr);Ni.setRealPlayer(wr)}}),he.forEach(Ni=>{Ni.parentPlayer?Ni.syncPlayerEvents(Ni.parentPlayer):Ni.destroy()});for(let Ni=0;Ni<_s.length;Ni++){const lr=_s[Ni],wr=lr[gs];if(Pn(lr,Fs),wr&&wr.hasAnimation)continue;let us=[];if(Mt.size){let L1=Mt.get(lr);L1&&L1.length&&us.push(...L1);let f1=this.driver.query(lr,qn,!0);for(let W1=0;W1<f1.length;W1++){let k=Mt.get(f1[W1]);k&&k.length&&us.push(...k)}}const Ao=us.filter(L1=>!L1.destroyed);Ao.length?Ui(this,lr,Ao):this.processLeaveNode(lr)}return _s.length=0,Ya.forEach(Ni=>{this.players.push(Ni),Ni.onDone(()=>{Ni.destroy();const lr=this.players.indexOf(Ni);this.players.splice(lr,1)}),Ni.play()}),Ya}elementContainsData(P,D){let q=!1;const he=D[gs];return he&&he.setForRemoval&&(q=!0),this.playersByElement.has(D)&&(q=!0),this.playersByQueriedElement.has(D)&&(q=!0),this.statesByElement.has(D)&&(q=!0),this._fetchNamespace(P).elementContainsData(D)||q}afterFlush(P){this._flushFns.push(P)}afterFlushAnimationsDone(P){this._whenQuietFns.push(P)}_getPreviousPlayers(P,D,q,he,Fe){let bt=[];if(D){const Mt=this.playersByQueriedElement.get(P);Mt&&(bt=Mt)}else{const Mt=this.playersByElement.get(P);if(Mt){const fn=!Fe||Fe==ta;Mt.forEach(An=>{An.queued||!fn&&An.triggerName!=he||bt.push(An)})}}return(q||he)&&(bt=bt.filter(Mt=>!(q&&q!=Mt.namespaceId||he&&he!=Mt.triggerName))),bt}_beforeAnimationBuild(P,D,q){const Fe=D.element,bt=D.isRemovalTransition?void 0:P,Mt=D.isRemovalTransition?void 0:D.triggerName;for(const fn of D.timelines){const An=fn.element,fi=An!==Fe,Vi=er(q,An,[]);this._getPreviousPlayers(An,fi,bt,Mt,D.toState).forEach(Wr=>{const pr=Wr.getRealPlayer();pr.beforeDestroy&&pr.beforeDestroy(),Wr.destroy(),Vi.push(Wr)})}Ci(Fe,D.fromStyles)}_buildAnimation(P,D,q,he,Fe,bt){const Mt=D.triggerName,fn=D.element,An=[],fi=new Set,Vi=new Set,Zr=D.timelines.map(pr=>{const Fr=pr.element;fi.add(Fr);const _s=Fr[gs];if(_s&&_s.removedBeforeQueried)return new Ke.ZN(pr.duration,pr.delay);const vr=Fr!==fn,ko=function ys(te){const P=[];return na(te,P),P}((q.get(Fr)||a1).map(jo=>jo.getRealPlayer())).filter(jo=>!!jo.element&&jo.element===Fr),da=Fe.get(Fr),Ia=bt.get(Fr),Va=Dn(0,this._normalizer,0,pr.keyframes,da,Ia),ia=this._buildPlayer(pr,Va,ko);if(pr.subTimeline&&he&&Vi.add(Fr),vr){const jo=new Wa(P,Mt,Fr);jo.setRealPlayer(ia),An.push(jo)}return ia});An.forEach(pr=>{er(this.playersByQueriedElement,pr.element,[]).push(pr),pr.onDone(()=>function La(te,P,D){let q=te.get(P);if(q){if(q.length){const he=q.indexOf(D);q.splice(he,1)}0==q.length&&te.delete(P)}return q}(this.playersByQueriedElement,pr.element,pr))}),fi.forEach(pr=>Yt(pr,ws));const Wr=bn(Zr);return Wr.onDestroy(()=>{fi.forEach(pr=>Pn(pr,ws)),eo(fn,D.toStyles)}),Vi.forEach(pr=>{er(he,pr,[]).push(Wr)}),Wr}_buildPlayer(P,D,q){return D.length>0?this.driver.animate(P.element,D,P.duration,P.delay,P.easing,q):new Ke.ZN(P.duration,P.delay)}}class Wa{constructor(P,D,q){this.namespaceId=P,this.triggerName=D,this.element=q,this._player=new Ke.ZN,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(P){this._containsRealPlayer||(this._player=P,this._queuedCallbacks.forEach((D,q)=>{D.forEach(he=>Nn(P,q,void 0,he))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(P.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(P){this.totalTime=P}syncPlayerEvents(P){const D=this._player;D.triggerCallback&&P.onStart(()=>D.triggerCallback("start")),P.onDone(()=>this.finish()),P.onDestroy(()=>this.destroy())}_queueEvent(P,D){er(this._queuedCallbacks,P,[]).push(D)}onDone(P){this.queued&&this._queueEvent("done",P),this._player.onDone(P)}onStart(P){this.queued&&this._queueEvent("start",P),this._player.onStart(P)}onDestroy(P){this.queued&&this._queueEvent("destroy",P),this._player.onDestroy(P)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(P){this.queued||this._player.setPosition(P)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(P){const D=this._player;D.triggerCallback&&D.triggerCallback(P)}}function wa(te){return te&&1===te.nodeType}function vt(te,P){const D=te.style.display;return te.style.display=P??"none",D}function ft(te,P,D,q,he){const Fe=[];D.forEach(fn=>Fe.push(vt(fn)));const bt=[];q.forEach((fn,An)=>{const fi=new Map;fn.forEach(Vi=>{const Zr=P.computeStyle(An,Vi,he);fi.set(Vi,Zr),(!Zr||0==Zr.length)&&(An[gs]=t2,bt.push(An))}),te.set(An,fi)});let Mt=0;return D.forEach(fn=>vt(fn,Fe[Mt++])),bt}function $e(te,P){const D=new Map;if(te.forEach(Mt=>D.set(Mt,[])),0==P.length)return D;const q=1,he=new Set(P),Fe=new Map;function bt(Mt){if(!Mt)return q;let fn=Fe.get(Mt);if(fn)return fn;const An=Mt.parentNode;return fn=D.has(An)?An:he.has(An)?q:bt(An),Fe.set(Mt,fn),fn}return P.forEach(Mt=>{const fn=bt(Mt);fn!==q&&D.get(fn).push(Mt)}),D}function Yt(te,P){te.classList?.add(P)}function Pn(te,P){te.classList?.remove(P)}function Ui(te,P,D){bn(D).onDone(()=>te.processLeaveNode(P))}function na(te,P){for(let D=0;D<te.length;D++){const q=te[D];q instanceof Ke.ZE?na(q.players,P):P.push(q)}}function V1(te,P,D){const q=D.get(te);if(!q)return!1;let he=P.get(te);return he?q.forEach(Fe=>he.add(Fe)):P.set(te,q),D.delete(te),!0}class ua{constructor(P,D,q){this.bodyNode=P,this._driver=D,this._normalizer=q,this._triggerCache={},this.onRemovalComplete=(he,Fe)=>{},this._transitionEngine=new n2(P,D,q),this._timelineEngine=new Eo(P,D,q),this._transitionEngine.onRemovalComplete=(he,Fe)=>this.onRemovalComplete(he,Fe)}registerTrigger(P,D,q,he,Fe){const bt=P+"-"+he;let Mt=this._triggerCache[bt];if(!Mt){const fn=[],An=[],fi=v1(this._driver,Fe,fn,An);if(fn.length)throw function ei(te,P){return new s.vHH(3404,!1)}();Mt=function X(te,P,D){return new Ve(te,P,D)}(he,fi,this._normalizer),this._triggerCache[bt]=Mt}this._transitionEngine.registerTrigger(D,he,Mt)}register(P,D){this._transitionEngine.register(P,D)}destroy(P,D){this._transitionEngine.destroy(P,D)}onInsert(P,D,q,he){this._transitionEngine.insertNode(P,D,q,he)}onRemove(P,D,q,he){this._transitionEngine.removeNode(P,D,he||!1,q)}disableAnimations(P,D){this._transitionEngine.markElementAsDisabled(P,D)}process(P,D,q,he){if("@"==q.charAt(0)){const[Fe,bt]=rs(q);this._timelineEngine.command(Fe,D,bt,he)}else this._transitionEngine.trigger(P,D,q,he)}listen(P,D,q,he,Fe){if("@"==q.charAt(0)){const[bt,Mt]=rs(q);return this._timelineEngine.listen(bt,D,Mt,Fe)}return this._transitionEngine.listen(P,D,q,he,Fe)}flush(P=-1){this._transitionEngine.flush(P)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let zo=(()=>{class te{constructor(D,q,he){this._element=D,this._startStyles=q,this._endStyles=he,this._state=0;let Fe=te.initialStylesByElement.get(D);Fe||te.initialStylesByElement.set(D,Fe=new Map),this._initialStyles=Fe}start(){this._state<1&&(this._startStyles&&eo(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(eo(this._element,this._initialStyles),this._endStyles&&(eo(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(te.initialStylesByElement.delete(this._element),this._startStyles&&(Ci(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ci(this._element,this._endStyles),this._endStyles=null),eo(this._element,this._initialStyles),this._state=3)}}return te.initialStylesByElement=new WeakMap,te})();function l1(te){let P=null;return te.forEach((D,q)=>{(function Zs(te){return"display"===te||"position"===te})(q)&&(P=P||new Map,P.set(q,D))}),P}class X2{constructor(P,D,q,he){this.element=P,this.keyframes=D,this.options=q,this._specialStyles=he,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=q.duration,this._delay=q.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(P=>P()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const P=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,P,this.options),this._finalKeyframe=P.length?P[P.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(P){const D=[];return P.forEach(q=>{D.push(Object.fromEntries(q))}),D}_triggerWebAnimation(P,D,q){return P.animate(this._convertKeyframesToObject(D),q)}onStart(P){this._originalOnStartFns.push(P),this._onStartFns.push(P)}onDone(P){this._originalOnDoneFns.push(P),this._onDoneFns.push(P)}onDestroy(P){this._onDestroyFns.push(P)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(P=>P()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(P=>P()),this._onDestroyFns=[])}setPosition(P){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=P*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const P=new Map;this.hasStarted()&&this._finalKeyframe.forEach((q,he)=>{"offset"!==he&&P.set(he,this._finished?q:Ms(this.element,he))}),this.currentSnapshot=P}triggerCallback(P){const D="start"===P?this._onStartFns:this._onDoneFns;D.forEach(q=>q()),D.length=0}}class u1{validateStyleProperty(P){return!0}validateAnimatableStyleProperty(P){return!0}matchesElement(P,D){return!1}containsElement(P,D){return So(P,D)}getParentElement(P){return zr(P)}query(P,D,q){return vi(P,D,q)}computeStyle(P,D,q){return window.getComputedStyle(P)[D]}animate(P,D,q,he,Fe,bt=[]){const fn={duration:q,delay:he,fill:0==he?"both":"forwards"};Fe&&(fn.easing=Fe);const An=new Map,fi=bt.filter(Wr=>Wr instanceof X2);(function $s(te,P){return 0===te||0===P})(q,he)&&fi.forEach(Wr=>{Wr.currentSnapshot.forEach((pr,Fr)=>An.set(Fr,pr))});let Vi=function fo(te){return te.length?te[0]instanceof Map?te:te.map(P=>Cs(P)):[]}(D).map(Wr=>_r(Wr));Vi=function Oo(te,P,D){if(D.size&&P.length){let q=P[0],he=[];if(D.forEach((Fe,bt)=>{q.has(bt)||he.push(bt),q.set(bt,Fe)}),he.length)for(let Fe=1;Fe<P.length;Fe++){let bt=P[Fe];he.forEach(Mt=>bt.set(Mt,Ms(te,Mt)))}}return P}(P,Vi,An);const Zr=function v2(te,P){let D=null,q=null;return Array.isArray(P)&&P.length?(D=l1(P[0]),P.length>1&&(q=l1(P[P.length-1]))):P instanceof Map&&(D=l1(P)),D||q?new zo(te,D,q):null}(P,Vi);return new X2(P,Vi,fn,Zr)}}let l2=(()=>{class te extends Ke._j{constructor(D,q){super(),this._nextAnimationId=0,this._renderer=D.createRenderer(q.body,{id:"0",encapsulation:s.ifc.None,styles:[],data:{animation:[]}})}build(D){const q=this._nextAnimationId.toString();this._nextAnimationId++;const he=Array.isArray(D)?(0,Ke.vP)(D):D;return Z(this._renderer,null,q,"register",[he]),new I2(q,this._renderer)}}return te.\u0275fac=function(D){return new(D||te)(s.LFG(s.FYo),s.LFG(gt.K0))},te.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac}),te})();class I2 extends Ke.LC{constructor(P,D){super(),this._id=P,this._renderer=D}create(P,D){return new V2(this._id,P,D||{},this._renderer)}}class V2{constructor(P,D,q,he){this.id=P,this.element=D,this._renderer=he,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",q)}_listen(P,D){return this._renderer.listen(this.element,`@@${this.id}:${P}`,D)}_command(P,...D){return Z(this._renderer,this.element,this.id,P,D)}onDone(P){this._listen("done",P)}onStart(P){this._listen("start",P)}onDestroy(P){this._listen("destroy",P)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(P){this._command("setPosition",P)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function Z(te,P,D,q,he){return te.setProperty(P,`@@${D}:${q}`,he)}const I="@",L="@.disabled";let j=(()=>{class te{constructor(D,q,he){this.delegate=D,this.engine=q,this._zone=he,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),q.onRemovalComplete=(Fe,bt)=>{const Mt=bt?.parentNode(Fe);Mt&&bt.removeChild(Mt,Fe)}}createRenderer(D,q){const Fe=this.delegate.createRenderer(D,q);if(!(D&&q&&q.data&&q.data.animation)){let fi=this._rendererCache.get(Fe);return fi||(fi=new ie("",Fe,this.engine,()=>this._rendererCache.delete(Fe)),this._rendererCache.set(Fe,fi)),fi}const bt=q.id,Mt=q.id+"-"+this._currentId;this._currentId++,this.engine.register(Mt,D);const fn=fi=>{Array.isArray(fi)?fi.forEach(fn):this.engine.registerTrigger(bt,Mt,D,fi.name,fi)};return q.data.animation.forEach(fn),new we(this,Mt,Fe,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(D,q,he){D>=0&&D<this._microtaskId?this._zone.run(()=>q(he)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(Fe=>{const[bt,Mt]=Fe;bt(Mt)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([q,he]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return te.\u0275fac=function(D){return new(D||te)(s.LFG(s.FYo),s.LFG(ua),s.LFG(s.R0b))},te.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac}),te})();class ie{constructor(P,D,q,he){this.namespaceId=P,this.delegate=D,this.engine=q,this._onDestroy=he,this.destroyNode=this.delegate.destroyNode?Fe=>D.destroyNode(Fe):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(P,D){return this.delegate.createElement(P,D)}createComment(P){return this.delegate.createComment(P)}createText(P){return this.delegate.createText(P)}appendChild(P,D){this.delegate.appendChild(P,D),this.engine.onInsert(this.namespaceId,D,P,!1)}insertBefore(P,D,q,he=!0){this.delegate.insertBefore(P,D,q),this.engine.onInsert(this.namespaceId,D,P,he)}removeChild(P,D,q){this.engine.onRemove(this.namespaceId,D,this.delegate,q)}selectRootElement(P,D){return this.delegate.selectRootElement(P,D)}parentNode(P){return this.delegate.parentNode(P)}nextSibling(P){return this.delegate.nextSibling(P)}setAttribute(P,D,q,he){this.delegate.setAttribute(P,D,q,he)}removeAttribute(P,D,q){this.delegate.removeAttribute(P,D,q)}addClass(P,D){this.delegate.addClass(P,D)}removeClass(P,D){this.delegate.removeClass(P,D)}setStyle(P,D,q,he){this.delegate.setStyle(P,D,q,he)}removeStyle(P,D,q){this.delegate.removeStyle(P,D,q)}setProperty(P,D,q){D.charAt(0)==I&&D==L?this.disableAnimations(P,!!q):this.delegate.setProperty(P,D,q)}setValue(P,D){this.delegate.setValue(P,D)}listen(P,D,q){return this.delegate.listen(P,D,q)}disableAnimations(P,D){this.engine.disableAnimations(P,D)}}class we extends ie{constructor(P,D,q,he,Fe){super(D,q,he,Fe),this.factory=P,this.namespaceId=D}setProperty(P,D,q){D.charAt(0)==I?"."==D.charAt(1)&&D==L?this.disableAnimations(P,q=void 0===q||!!q):this.engine.process(this.namespaceId,P,D.slice(1),q):this.delegate.setProperty(P,D,q)}listen(P,D,q){if(D.charAt(0)==I){const he=function Je(te){switch(te){case"body":return document.body;case"document":return document;case"window":return window;default:return te}}(P);let Fe=D.slice(1),bt="";return Fe.charAt(0)!=I&&([Fe,bt]=function yt(te){const P=te.indexOf(".");return[te.substring(0,P),te.slice(P+1)]}(Fe)),this.engine.listen(this.namespaceId,he,Fe,bt,Mt=>{this.factory.scheduleListenerCallback(Mt._data||-1,q,Mt)})}return this.delegate.listen(P,D,q)}}const Bn=[{provide:Ke._j,useClass:l2},{provide:A1,useFactory:function mn(){return new aa}},{provide:ua,useClass:(()=>{class te extends ua{constructor(D,q,he,Fe){super(D.body,q,he)}ngOnDestroy(){this.flush()}}return te.\u0275fac=function(D){return new(D||te)(s.LFG(gt.K0),s.LFG(Pi),s.LFG(A1),s.LFG(s.z2F))},te.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac}),te})()},{provide:s.FYo,useFactory:function Jn(te,P,D){return new j(te,P,D)},deps:[C.se,ua,s.R0b]}],gi=[{provide:Pi,useFactory:()=>new u1},{provide:s.QbO,useValue:"BrowserAnimations"},...Bn],Zi=[{provide:Pi,useClass:Sr},{provide:s.QbO,useValue:"NoopAnimations"},...Bn];let dr=(()=>{class te{static withConfig(D){return{ngModule:te,providers:D.disableAnimations?Zi:gi}}}return te.\u0275fac=function(D){return new(D||te)},te.\u0275mod=s.oAB({type:te}),te.\u0275inj=s.cJS({providers:gi,imports:[C.b2]}),te})();var Bs=ue(262),Ps=ue(2843),xs=ue(7185);let uo=(()=>{class te{constructor(D,q){this.router=D,this.toast=q}intercept(D,q){return q.handle(D).pipe((0,Bs.K)(he=>{if(he){if(400===he.status){if(he.error.errors)throw he.error;this.toast.error(he.error.message,he.status.toString())}401===he.status&&this.toast.error(he.error.message,he.status.toString()),404===he.status&&this.router.navigateByUrl("/not-found"),500===he.status&&this.router.navigateByUrl("/server-error",{state:{error:he.error}})}return(0,Ps._)(()=>new Error(he.message))}))}static#e=this.\u0275fac=function(q){return new(q||te)(s.LFG(Xe.F0),s.LFG(xs._W))};static#t=this.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac})}return te})();var Uo=ue(4671),Za=ue(4986),h1=ue(7272),ha=ue(5698),fa=ue(4482),r2=ue(5403),H2=ue(5032),gc=ue(9718),Dl=ue(5577),$1=ue(8421);function _c(te,P){return P?D=>(0,h1.z)(P.pipe((0,ha.q)(1),function J2(){return(0,fa.e)((te,P)=>{te.subscribe((0,r2.x)(P,H2.Z))})}()),D.pipe(_c(te))):(0,Dl.z)((D,q)=>(0,$1.Xf)(te(D,q)).pipe((0,ha.q)(1),(0,gc.h)(D)))}var y2=ue(9751),x2=ue(3532);var Vc=ue(8746);let Hc=(()=>{class te{constructor(D){this.spinnerService=D,this.busyRequestCount=0}busy(){this.busyRequestCount++,this.spinnerService.show(void 0,{type:"timer",bdColor:"rgba(255.255.255.0.7)",color:"#333333"})}idle(){this.busyRequestCount--,this.busyRequestCount<=0&&(this.busyRequestCount=0,this.spinnerService.hide())}static#e=this.\u0275fac=function(q){return new(q||te)(s.LFG(Rs))};static#t=this.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac,providedIn:"root"})}return te})(),yc=(()=>{class te{constructor(D){this.busyService=D}intercept(D,q){return D.url.includes("emailExists")||"POST"===D.method&&D.url.includes("orders")?q.handle(D):(this.busyService.busy(),q.handle(D).pipe(qt.N.production?Uo.y:function Q2(te,P=Za.z){const D=function P2(te=0,P,D=Za.P){let q=-1;return null!=P&&((0,x2.K)(P)?D=P:q=P),new y2.y(he=>{let Fe=function vc(te){return te instanceof Date&&!isNaN(te)}(te)?+te-D.now():te;Fe<0&&(Fe=0);let bt=0;return D.schedule(function(){he.closed||(he.next(bt++),0<=q?this.schedule(void 0,q):he.complete())},Fe)})}(te,P);return _c(()=>D)}(1e3),(0,Vc.x)(()=>this.busyService.idle())))}static#e=this.\u0275fac=function(q){return new(q||te)(s.LFG(Hc))};static#t=this.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac})}return te})(),Ca=(()=>{class te{constructor(D){this.accountService=D}intercept(D,q){return this.accountService.currentUser$.pipe((0,ha.q)(1)).subscribe({next:he=>this.token=he?.token}),this.token&&(D=D.clone({setHeaders:{Authorization:`Bearer ${this.token}`}})),q.handle(D)}static#e=this.\u0275fac=function(q){return new(q||te)(s.LFG(ii.B))};static#t=this.\u0275prov=s.Yz7({token:te,factory:te.\u0275fac})}return te})();var H1=ue(4466);let s2=(()=>{class te{static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275mod=s.oAB({type:te});static#n=this.\u0275inj=s.cJS({imports:[H1.m,gt.ez,je.uH,Xe.Bz,xs.Rh.forRoot({positionClass:"toast-bottom-right",disableTimeOut:!1,timeOut:5e3,closeButton:!0,progressBar:!0,preventDuplicates:!0}),Wi.wH,jr,jr]})}return te})();var b2=ue(4333);let w1=(()=>{class te{static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275mod=s.oAB({type:te});static#n=this.\u0275inj=s.cJS({imports:[gt.ez,H1.m]})}return te})(),Pc=(()=>{class te{static#e=this.\u0275fac=function(q){return new(q||te)};static#t=this.\u0275mod=s.oAB({type:te,bootstrap:[sn]});static#n=this.\u0275inj=s.cJS({providers:[{provide:De.TP,useClass:uo,multi:!0},{provide:De.TP,useClass:yc,multi:!0},{provide:De.TP,useClass:Ca,multi:!0}],imports:[C.b2,_t,dr,je.uH,De.JF,s2,b2.ShopModule,w1,H1.m]})}return te})();C.q6().bootstrapModule(Pc).catch(te=>console.error(te))},8653:(yi,on,ue)=>{var C=ue(8922),De=ue(8009),Xe=ue(8214),s=0,ct=4,de=36,Et=Math.pow(de,ct);function qt(){return De((Xe()*Et<<0).toString(de),ct)}function gt(){return s=s<Et?s:0,++s-1}function jt(){return"c"+(new Date).getTime().toString(de)+De(gt().toString(de),ct)+C()+(qt()+qt())}jt.slug=function(){var Gt=(new Date).getTime().toString(36),Kn=gt().toString(36).slice(-4),Sn=C().slice(0,1)+C().slice(-1),En=qt().slice(-2);return Gt.slice(-2)+Kn+Sn+En},jt.isCuid=function(Gt){return"string"==typeof Gt&&!!Gt.startsWith("c")},jt.isSlug=function(Gt){if("string"!=typeof Gt)return!1;var Kn=Gt.length;return Kn>=7&&Kn<=10},jt.fingerprint=C,yi.exports=jt},8922:(yi,on,ue)=>{var C=ue(8009),De="object"==typeof window?window:self,Xe=Object.keys(De).length,ct=C(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+Xe.toString(36),4);yi.exports=function(){return ct}},8214:yi=>{var on,ue=typeof window<"u"&&(window.crypto||window.msCrypto)||typeof self<"u"&&self.crypto;if(ue){var C=Math.pow(2,32)-1;on=function(){return Math.abs(ue.getRandomValues(new Uint32Array(1))[0]/C)}}else on=Math.random;yi.exports=on},8009:yi=>{yi.exports=function(ue,C){var De="000000000"+ue;return De.substr(De.length-C)}},9898:function(yi){yi.exports=function(){"use strict";var on,ue,C;function De(s,ct){if(on)if(ue){var de="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+on+")(sharedChunk); ("+ue+")(sharedChunk); self.onerror = null;",Et={};on(Et),C=ct(Et),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(C.workerUrl=window.URL.createObjectURL(new Blob([de],{type:"text/javascript"})))}else ue=ct;else on=ct}return De(0,function(s){var ct="3.3.0";let de;const Et={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==de){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{de=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{de=t}}return de},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Et.API_URL)return null;try{const t=new URL(Et.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function qt(t){return Et.API_URL_REGEX.test(t)}function gt(t){return 0===t.indexOf("mapbox:")}function jt(t){return Et.API_CDN_URL_REGEX.test(t)}function wt(t){return Et.API_SPRITE_REGEX.test(t)}function Gt(t){return Et.API_STYLE_REGEX.test(t)&&!wt(t)}const Kn={create:"create",load:"load",fullLoad:"fullLoad"};function Sn(t){const e=t.name.split("?")[0];return jt(e)&&e.includes("mapbox-gl.js")?"javascript":jt(e)&&e.includes("mapbox-gl.css")?"css":Et.API_FONTS_REGEX.test(e)?"fontRange":wt(e)?"sprite":Gt(e)?"style":Et.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}function En(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dn=ii;function ii(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=r}ii.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,r=0;r<8;r++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var u=this.sampleCurveDerivativeX(n);if(Math.abs(u)<1e-6)break;n-=c/u}var p=0,g=1;for(n=t,r=0;r<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));r++)t>c?p=n:g=n,n=.5*(g-p)+p;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var hn=En(dn),Vn=hi;function hi(t,e){this.x=t,this.y=e}hi.prototype={clone:function(){return new hi(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),c=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},hi.convert=function(t){return t instanceof hi?t:Array.isArray(t)?new hi(t[0],t[1]):t};var Te=En(Vn);const _t=Math.PI/180,Ue=180/Math.PI;function Ye(t){return t*_t}function Pt(t){return t*Ue}const je=[[0,0],[1,0],[1,1],[0,1]];function Ze(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function ot(t,e,n,r){const c=new hn(t,e,n,r);return function(u){return c.solve(u)}}const pt=ot(.25,.1,.25,1);function Ot(t,e,n){return Math.min(n,Math.max(e,t))}function Xt(t,e,n){return(n=Ot((n-t)/(e-t),0,1))*n*(3-2*n)}function Mi(t,e,n){const r=n-e,c=((t-e)%r+r)%r+e;return c===e?n:c}function Wi(t,e,n){if(!t.length)return n(null,[]);let r=t.length;const c=new Array(t.length);let u=null;t.forEach((p,g)=>{e(p,(y,x)=>{y&&(u=y),c[g]=x,0==--r&&n(u,c)})})}function ti(t,...e){for(const n of e)for(const r in n)t[r]=n[r];return t}let Tn=1;function rt(){return Tn++}function xt(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ht(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function st(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ne(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Pe(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Ke(t,e,n){const r={};for(const c in t)r[c]=e.call(n||this,t[c],c,t);return r}function Bt(t,e,n){const r={};for(const c in t)e.call(n||this,t[c],c,t)&&(r[c]=t[c]);return r}function mi(t){return Array.isArray(t)?t.map(mi):"object"==typeof t&&t?Ke(t,mi):t}const Di={};function Ii(t){Di[t]||(typeof console<"u"&&console.warn(t),Di[t]=!0)}function Gi(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Br(t){let e=0;for(let n,r,c=0,u=t.length,p=u-1;c<u;p=c++)n=t[c],r=t[p],e+=(r.x-n.x)*(n.y+r.y);return e}function Hr([t,e,n]){const r=Ye(e+90),c=Ye(n);return{x:t*Math.cos(r)*Math.sin(c),y:t*Math.sin(r)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function Ur(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Si(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,r,c,u)=>{const p=c||u;return e[r]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Xi,Rs,$r,Ji,ir,jr,sn=null;function me(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function He(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function it(t,e,n,r){for(;e<n;){const c=e+n>>1;t[c]<r?e=c+1:n=c}return e}function zt(t,e,n,r){for(;e<n;){const c=e+n>>1;t[c]<=r?e=c+1:n=c}return e}function At(){return null==Xi&&(Xi=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Xi}const It={now:()=>void 0!==Ji?Ji:performance.now(),setNow(t){Ji=t},restoreNow(){Ji=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:r}=t;ir||(ir=document.createElement("canvas"));const c=ir.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>ir.width||r>ir.height)&&(ir.width=n,ir.height=r),c.clearRect(-e,-e,n+2*e,r+2*e),c.drawImage(t,0,0,n,r),c.getImageData(-e,-e,n+2*e,r+2*e)},resolveURL:t=>(Rs||(Rs=document.createElement("a")),Rs.href=t,Rs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==$r&&($r=window.matchMedia("(prefers-reduced-motion: reduce)")),$r.matches)},hasCanvasFingerprintNoise(){if(void 0!==jr)return jr;if(!At())return jr=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);const r=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<r.data.length;++c)if(c%4!=3&&n++!==r.data[c])return jr=!0,!0;return jr=!1,!1}},Hn="mapbox-tiles";let Wn,Zn,Qt=500,$n=50;function Fi(){try{return caches}catch{}}function Hi(){const t=Fi();t&&!Wn&&(Wn=t.open(Hn))}function Xr(t){const e=t.indexOf("?");if(e<0)return t;const n=["language","worldview"],r=new URLSearchParams,c=new URLSearchParams(t.slice(e));for(const u of n){const p=c.get(u);p&&r.set(u,p)}return`${t.slice(0,e)}?${r.toString()}`}function Ti(t,e){const n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;const r=new URLSearchParams(t.slice(n));for(const c in e)r.set(c,e[c]);return`${t.slice(0,n)}?${r.toString()}`}let hr=1/0;const ri={supported:!1,testSupport:function(t){!cn&&Ir&&(Be?In(t):Qi=t)}};let Qi,Ir,cn=!1,Be=!1;const Tt=typeof self<"u"?self:{};function In(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ir),t.isContextLost())return;ri.supported=!0}catch{}t.deleteTexture(e),cn=!0}Tt.document&&(Ir=Tt.document.createElement("img"),Ir.onload=function(){Qi&&In(Qi),Qi=null,Be=!0},Ir.onerror=function(){cn=!0,Qi=null},Ir.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const vn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(vn);class ei extends Error{constructor(e,n,r){401===n&&qt(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Oi=Ur()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,kt=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Oi())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(r,c){const u=new AbortController,p=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Oi(),referrerPolicy:r.referrerPolicy,signal:u.signal});let g=!1,y=!1;const x=(M=p.url).indexOf("sku=")>0&&qt(M);var M;"json"===r.type&&p.headers.set("Accept","application/json");const E=(O,U,W)=>{if(y)return;if(O&&"SecurityError"!==O.message&&Ii(O.toString()),U&&W)return A(U);const ee=Date.now();fetch(p).then(ae=>{if(ae.ok){const be=x?ae.clone():null;return A(ae,be,ee)}return c(new ei(ae.statusText,ae.status,r.url))}).catch(ae=>{"AbortError"!==ae.name&&c(new Error(`${ae.message} ${r.url}`))})},A=(O,U,W)=>{("arrayBuffer"===r.type?O.arrayBuffer():"json"===r.type?O.json():O.text()).then(ee=>{y||(U&&W&&function(ae,be,Ee){if(Hi(),!Wn)return;const Me=Si(be.headers.get("Cache-Control")||"");if(Me["no-store"])return;const We={status:be.status,statusText:be.statusText,headers:new Headers};be.headers.forEach((mt,Dt)=>We.headers.set(Dt,mt)),Me["max-age"]&&We.headers.set("Expires",new Date(Ee+1e3*Me["max-age"]).toUTCString());const Re=We.headers.get("Expires");if(!Re||new Date(Re).getTime()-Ee<42e4)return;let et=Xr(ae.url);if(206===be.status){const mt=ae.headers.get("Range");if(!mt)return;We.status=200,et=Ti(et,{range:mt})}!function(mt,Dt){if(void 0===Zn)try{new Response(new ReadableStream),Zn=!0}catch{Zn=!1}Zn?Dt(mt.body):mt.blob().then(Dt)}(be,mt=>{const Dt=new Response(mt,We);Hi(),Wn&&Wn.then(Wt=>Wt.put(et,Dt)).catch(Wt=>Ii(Wt.message))})}(p,U,W),g=!0,c(null,ee,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(ee=>{y||c(new Error(ee.message))})};return x?function(O,U){if(Hi(),!Wn)return U(null);Wn.then(W=>{let ee=Xr(O.url);const ae=O.headers.get("Range");ae&&(ee=Ti(ee,{range:ae})),W.match(ee).then(be=>{const Ee=function(Me){if(!Me)return!1;const We=new Date(Me.headers.get("Expires")||0),Re=Si(Me.headers.get("Cache-Control")||"");return We>Date.now()&&!Re["no-cache"]}(be);W.delete(ee),Ee&&W.put(ee,be.clone()),U(null,be,Ee)}).catch(U)}).catch(U)}(p,E):E(null,null),{cancel:()=>{y=!0,g||u.abort()}}}(t,e);if(Ur()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(r,c){const u=new XMLHttpRequest;u.open(r.method||"GET",r.url,!0),"arrayBuffer"===r.type&&(u.responseType="arraybuffer");for(const p in r.headers)u.setRequestHeader(p,r.headers[p]);return"json"===r.type&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials="include"===r.credentials,u.onerror=()=>{c(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||0===u.status)&&null!==u.response){let p=u.response;if("json"===r.type)try{p=JSON.parse(u.response)}catch(g){return c(g)}c(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else c(new ei(u.statusText,u.status,r.url))},u.send(r.body),{cancel:()=>u.abort()}}(t,e)},Ht=function(t,e){return kt(ti(t,{type:"arrayBuffer"}),e)};function an(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const _n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let qe,Ge;qe=[],Ge=0;const ye=function(t,e){if(ri.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ge>=Et.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return qe.push(u),u}Ge++;let n=!1;const r=()=>{if(!n)for(n=!0,Ge--;qe.length&&Ge<Et.MAX_PARALLEL_IMAGE_REQUESTS;){const u=qe.shift(),{requestParameters:p,callback:g,cancelled:y}=u;y||(u.cancel=ye(p,g).cancel)}},c=Ht(t,(u,p,g,y)=>{r(),u?e(u):p&&(self.createImageBitmap?function(x,M){const E=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(E).then(A=>{M(null,A)}).catch(A=>{M(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(x,M)=>e(x,M,g,y)):function(x,M){const E=new Image;E.onload=()=>{M(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=_n})},E.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(x)],{type:"image/png"});E.src=x.byteLength?URL.createObjectURL(A):_n}(p,(x,M)=>e(x,M,g,y)))});return{cancel:()=>{c.cancel(),r()}}},ke="01",J="NO_ACCESS_TOKEN",_e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Se(t){const e=t.match(_e);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function at(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const St="mapbox.eventData";function nn(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class bn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=nn(Et.ACCESS_TOKEN);let r="";return r=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,u)=>String.fromCharCode(Number("0x"+u)))):Et.ACCESS_TOKEN||"",e?`${St}.${e}:${r}`:`${St}:${r}`}fetchEventData(){const e=me("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));const u=localStorage.getItem(r);u&&(this.anonId=u)}catch{Ii("Unable to read from LocalStorage")}}saveEventData(){const e=me("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(r,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Ii("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,r,c){if(!Et.EVENTS_URL)return;const u=Se(Et.EVENTS_URL);u.params.push(`access_token=${c||Et.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},g=n?ti(p,n):p,y={url:at(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};var M;this.pendingRequest=(M=x=>{this.pendingRequest=null,r(x),this.saveEventData(),this.processRequests(c)},kt(ti(y,{method:"POST"}),M))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Dn=new class extends bn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Et.EVENTS_URL&&Et.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>gt(n)||qt(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=nn(Et.ACCESS_TOKEN),n=e?e.u:Et.ACCESS_TOKEN;let r=n!==this.eventData.tokenU;st(this.anonId)||(this.anonId=xt(),r=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;r=r||g>=1||g<-1||u.getDate()!==p.getDate()}else r=!0;r?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ct,skuId:ke,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},Nn=Dn.postTurnstileEvent.bind(Dn),Ei=new class extends bn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,r){this.skuToken=e,this.errorCb=r,Et.EVENTS_URL&&(n||Et.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(J)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),st(this.anonId)||(this.anonId=xt()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ct,skuId:ke,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},si=Ei.postMapLoadEvent.bind(Ei),er=new class extends bn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Et.EVENTS_URL&&(t||Et.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),r=function(c){const u=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),g=function(O){const U={};if(O)for(const W in O)if("other"!==W)for(const ee of O[W]){const ae=`${W}ResolveRangeMin`,be=`${W}ResolveRangeMax`,Ee=`${W}RequestCount`,Me=`${W}RequestCachedCount`;U[ae]=Math.min(U[ae]||1/0,ee.startTime),U[be]=Math.max(U[be]||-1/0,ee.responseEnd);const We=Re=>{void 0===U[Re]&&(U[Re]=0),++U[Re]};void 0!==ee.transferSize&&0===ee.transferSize&&We(Me),We(Ee)}return U}(function(O,U){const W={};if(O)for(const ee of O){const ae=U(ee);void 0===W[ae]&&(W[ae]=[]),W[ae].push(ee)}return W}(u,Sn)),y=window.devicePixelRatio,x=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=x?x.effectiveType:void 0,E={counters:[],metadata:[],attributes:[]},A=(O,U,W)=>{null!=W&&O.push({name:U,value:W.toString()})};for(const O in g)A(E.counters,O,g[O]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(A(E.counters,"interactionRangeMin",c.interactionRange[0]),A(E.counters,"interactionRangeMax",c.interactionRange[1])),p)for(const O of Object.keys(Kn)){const U=Kn[O],W=p.find(ee=>ee.name===U);W&&A(E.counters,U,W.startTime)}return A(E.counters,"visibilityHidden",c.visibilityHidden),A(E.attributes,"style",function(O){if(O)for(const U of O){const W=U.name.split("?")[0];if(Gt(W)){const ee=W.split("/").slice(-2);if(2===ee.length)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(u)),A(E.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),A(E.attributes,"fogEnabled",c.fogEnabled?"true":"false"),A(E.attributes,"projection",c.projection),A(E.attributes,"zoom",c.zoom),A(E.metadata,"devicePixelRatio",y),A(E.metadata,"connectionEffectiveType",M),A(E.metadata,"navigatorUserAgent",navigator.userAgent),A(E.metadata,"screenWidth",window.screen.width),A(E.metadata,"screenHeight",window.screen.height),A(E.metadata,"windowWidth",window.innerWidth),A(E.metadata,"windowHeight",window.innerHeight),A(E.metadata,"mapWidth",c.width/y),A(E.metadata,"mapHeight",c.height/y),A(E.metadata,"webglRenderer",c.renderer),A(E.metadata,"webglVendor",c.vendor),A(E.metadata,"sdkVersion",ct),A(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(n);for(const c of r.metadata);for(const c of r.counters);for(const c of r.attributes);this.postEvent(e,r,()=>{},t)}},rs=er.postPerformanceEvent.bind(er),Er=new class extends bn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,r){if(!Et.API_URL||!Et.SESSION_PATH)return;const c=Se(Et.API_URL+Et.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${r||Et.ACCESS_TOKEN||""}`);const u={url:at(c),headers:{"Content-Type":"text/plain"}};var g;this.pendingRequest=(g=p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(r)},kt(ti(u,{method:"GET"}),g))}getSessionAPI(t,e,n,r){this.skuToken=e,this.errorCb=r,Et.SESSION_PATH&&Et.API_URL&&(n||Et.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(J)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},zs=Er.getSessionAPI.bind(Er),Qs=new Set;function zr(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function ls(t,e,n){if(n&&n[t]){const r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}class ds{constructor(e,n={}){ti(this,n),this.type=e}}class ro extends ds{constructor(e,n={}){super("error",ti({error:e},n))}}class Os{on(e,n){return this._listeners=this._listeners||{},zr(e,n,this._listeners),this}off(e,n){return ls(e,n,this._listeners),ls(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},zr(e,n,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,n){"string"==typeof e&&(e=new ds(e,n||{}));const r=e.type;if(this.listens(r)){e.target=this;const c=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const g of c)g.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const g of u)ls(r,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(ti(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof ro&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}s.y=void 0;var e1={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Oa(t){return(t=Math.round(t))<0?0:t>255?255:t}function qo(t){return Oa("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function So(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function vi(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{s.y={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in e1)return e1[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=n.indexOf("("),c=n.indexOf(")");if(-1!==r&&c+1===n.length){var u=n.substr(0,r),p=n.substr(r+1,c-(r+1)).split(","),g=1;switch(u){case"rgba":if(4!==p.length)return null;g=So(p.pop());case"rgb":return 3!==p.length?null:[qo(p[0]),qo(p[1]),qo(p[2]),g];case"hsla":if(4!==p.length)return null;g=So(p.pop());case"hsl":if(3!==p.length)return null;var y=(parseFloat(p[0])%360+360)%360/360,x=So(p[1]),M=So(p[2]),E=M<=.5?M*(x+1):M+x-M*x,A=2*M-E;return[Oa(255*vi(A,E,y+1/3)),Oa(255*vi(A,E,y)),Oa(255*vi(A,E,y-1/3)),g];default:return null}}return null}}catch{}class qi{constructor(e,n,r,c=1){this.r=e,this.g=n,this.b=r,this.a=c}static parse(e){if(!e)return;if(e instanceof qi)return e;if("string"!=typeof e)return;const n=s.y(e);return n?new qi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,r,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(r)},${c})`}toArray(){const{r:e,g:n,b:r,a:c}=this;return 0===c?[0,0,0,0]:[255*e/c,255*n/c,255*r/c,c]}toArray01(){const{r:e,g:n,b:r,a:c}=this;return 0===c?[0,0,0,0]:[e/c,n/c,r/c,c]}toArray01Scaled(e){const{r:n,g:r,b:c,a:u}=this;return 0===u?[0,0,0]:[n/u*e,r/u*e,c/u*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:r,a:c}=this;return[e,n,r,c]}toArray01Linear(){const{r:e,g:n,b:r,a:c}=this;return 0===c?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(r/c,2.2),c]}}qi.black=new qi(0,0,0,1),qi.white=new qi(1,1,1,1),qi.transparent=new qi(0,0,0,0),qi.red=new qi(1,0,0,1),qi.blue=new qi(0,0,1,1);var Sr=qi;function Pi(t,e,n){return t*(1-n)+e*n}function Io(t,e,n){return t.map((r,c)=>Pi(r,e[c],n))}var js=Object.freeze({__proto__:null,array:Io,color:function(t,e,n){return new Sr(Pi(t.r,e.r,n),Pi(t.g,e.g,n),Pi(t.b,e.b,n),Pi(t.a,e.a,n))},number:Pi});function sa(t,...e){for(const n of e)for(const r in n)t[r]=n[r];return t}class ps extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Fs=ps;class Vo{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[r,c]of n)this.bindings[r]=c}concat(e){return new Vo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var br=Vo;const ws={kind:"null"},qn={kind:"number"},Yi={kind:"string"},tr={kind:"boolean"},es={kind:"color"},ho={kind:"object"},rr={kind:"value"},Cs={kind:"collator"},fo={kind:"formatted"},_a={kind:"resolvedImage"};function _r(t,e){return{kind:"array",itemType:t,N:e}}function vs(t){if("array"===t.kind){const e=vs(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ci=[ws,qn,Yi,tr,es,fo,ho,_r(rr),_a];function eo(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!eo(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of ci)if(!eo(n,e))return null}return`Expected ${vs(t)} but found ${vs(e)} instead.`}function Ci(t,e){return e.some(n=>n.kind===t.kind)}function As(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}class Bi{constructor(e,n,r){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vs{constructor(e,n,r,c,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=r,this.fontStack=c,this.textColor=u}}class Gs{constructor(e){this.sections=e}static fromString(e){return new Gs([new Vs(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof Gs?e:Gs.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const r={};n.fontStack&&(r["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(r["font-scale"]=n.scale),n.textColor&&(r["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(r)}return e}}class Qn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Qn({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ls(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function so(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Sr||t instanceof Bi||t instanceof Gs||t instanceof Qn)return!0;if(Array.isArray(t)){for(const e of t)if(!so(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!so(t[e]))return!1;return!0}return!1}function as(t){if(null===t)return ws;if("string"==typeof t)return Yi;if("boolean"==typeof t)return tr;if("number"==typeof t)return qn;if(t instanceof Sr)return es;if(t instanceof Bi)return Cs;if(t instanceof Gs)return fo;if(t instanceof Qn)return _a;if(Array.isArray(t)){const e=t.length;let n;for(const r of t){const c=as(r);if(n){if(n===c)continue;n=rr;break}n=c}return _r(n||rr,e)}return ho}function to(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Sr||t instanceof Gs||t instanceof Qn?t.toString():JSON.stringify(t)}class $s{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!so(e[1]))return n.error("invalid value");const r=e[1];let c=as(r);const u=n.expectedType;return"array"!==c.kind||0!==c.N||!u||"array"!==u.kind||"number"==typeof u.N&&0!==u.N||(c=u),new $s(c,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Sr?["rgba"].concat(this.value.toArray()):this.value instanceof Gs?this.value.serialize():this.value}}var Oo=$s,Nr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Ms={string:Yi,number:qn,boolean:tr,object:ho};class Fa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r,c=1;const u=e[0];if("array"===u){let g,y;if(e.length>2){const x=e[1];if("string"!=typeof x||!(x in Ms)||"object"===x)return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=Ms[x],c++}else g=rr;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}r=_r(g,y)}else r=Ms[u];const p=[];for(;c<e.length;c++){const g=n.parse(e[c],c,rr);if(!g)return null;p.push(g)}return new Fa(r,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const r=this.args[n].evaluate(e);if(!eo(this.type,as(r)))return r;if(n===this.args.length-1)throw new Nr(`Expected value to be of type ${vs(this.type)}, but found ${vs(as(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){n.push(r.kind);const c=e.N;("number"==typeof c||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(r=>r.serialize()))}}var oo=Fa;class _1{constructor(e){this.type=fo,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return n.error("First argument must be an image or text section.");const c=[];let u=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(u&&"object"==typeof g&&!Array.isArray(g)){u=!1;let y=null;if(g["font-scale"]&&(y=n.parse(g["font-scale"],1,qn),!y))return null;let x=null;if(g["text-font"]&&(x=n.parse(g["text-font"],1,_r(Yi)),!x))return null;let M=null;if(g["text-color"]&&(M=n.parse(g["text-color"],1,es),!M))return null;const E=c[c.length-1];E.scale=y,E.font=x,E.textColor=M}else{const y=n.parse(e[p],1,rr);if(!y)return null;const x=y.type.kind;if("string"!==x&&"value"!==x&&"null"!==x&&"resolvedImage"!==x)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new _1(c)}evaluate(e){return new Gs(this.sections.map(n=>{const r=n.content.evaluate(e);return as(r)===_a?new Vs("",r,null,null,null):new Vs(to(r),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const r={};n.scale&&(r["font-scale"]=n.scale.serialize()),n.font&&(r["text-font"]=n.font.serialize()),n.textColor&&(r["text-color"]=n.textColor.serialize()),e.push(r)}return e}}class yo{constructor(e,n){this.type=_a,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const r=n.parse(e[1],1,Yi);if(!r)return n.error("No image name provided.");if(2===e.length)return new yo(r);const c=n.parse(e[2],1,Yi);return c?new yo(r,c):n.error("Secondary image variant is not a string.")}evaluate(e){const n=Qn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function oa(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const za={"to-boolean":tr,"to-color":es,"to-number":qn,"to-string":Yi};class t1{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[0],c=[];let u=ws;if("to-array"===r){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(n.expectedType){if("array"!==n.expectedType.kind)return n.error(`Expected ${n.expectedType.kind} but found array.`);u=_r(n.expectedType.itemType,p)}else{if(!(p>0&&so(e[1][0])))return null;u=_r(as(e[1][0]),p)}for(let g=0;g<p;g++){const y=e[1][g];let x;if("array"===oa(y))x=n.parse(y,void 0,u.itemType);else{const M=oa(y);if(M!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${M}.`);x=n.registry.literal.parse(["literal",void 0===y?null:y],n)}if(!x)return null;c.push(x)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return n.error("Expected one argument.");u=za[r];for(let p=1;p<e.length;p++){const g=n.parse(e[p],p,rr);if(!g)return null;c.push(g)}}return new t1(u,c)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,r;for(const c of this.args){if(n=c.evaluate(e),r=null,n instanceof Sr)return n;if("string"==typeof n){const u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(r=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ls(n[0],n[1],n[2],n[3]),!r))return new Sr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Nr(r||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const r of this.args){if(n=r.evaluate(e),null===n)return 0;const c=Number(n);if(!isNaN(c))return c}throw new Nr(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Gs.fromString(to(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Qn.fromString(to(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(n=>n.evaluate(e)):to(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new _1([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new yo(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Fo=t1;const Xo=["Unknown","Point","LineString","Polygon"];var U1=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Xo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Sr.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Jo{constructor(e,n,r,c,u){this.name=e,this.type=n,this._evaluate=r,this.args=c,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const n=Jo.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const r=e[0],c=Jo.definitions[r];if(!c)return n.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=[];let y=null,x=-1;for(const[M,E]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;g.push(M),x++,y=new Pn(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const A=[];let O=!1;for(let U=1;U<e.length;U++){const W=e[U],ee=Array.isArray(M)?M[U-1]:M.type,ae=y.parse(W,1+A.length,ee);if(!ae){O=!0;break}A.push(ae)}if(!O)if(Array.isArray(M)&&M.length!==A.length)y.error(`Expected ${M.length} arguments, but found ${A.length} instead.`);else{for(let U=0;U<A.length;U++){const W=Array.isArray(M)?M[U]:M.type,ee=A[U];y.concat(U+1).checkSubtype(W,ee.type)}if(0===y.errors.length)return new Jo(r,u,E,A,x)}}if(1===g.length)n.errors.push(...y.errors);else{const M=(g.length?g:p.map(([A])=>A)).map(va).join(" | "),E=[];for(let A=1;A<e.length;A++){const O=n.parse(e[A],1+E.length);if(!O)return null;E.push(vs(O.type))}n.error(`Expected arguments of type ${M}, but found (${E.join(", ")}) instead.`)}return null}static register(e,n){Jo.definitions=n;for(const r in n)e[r]=Jo}}function va(t){return Array.isArray(t)?`(${t.map(vs).join(", ")})`:`(${vs(t.type)}...)`}var cr=Jo;class To{constructor(e,n,r){this.type=Cs,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return n.error("Collator options argument must be an object.");const c=n.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,tr);if(!c)return null;const u=n.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,tr);if(!u)return null;let p=null;return r.locale&&(p=n.parse(r.locale,1,Yi),!p)?null:new To(c,u,p)}evaluate(e){return new Bi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Ba={exports:{}};Ba.exports=function(){function t(r,c,u,p,g){for(;p>u;){if(p-u>600){var y=p-u+1,x=c-u+1,M=Math.log(y),E=.5*Math.exp(2*M/3),A=.5*Math.sqrt(M*E*(y-E)/y)*(x-y/2<0?-1:1);t(r,c,Math.max(u,Math.floor(c-x*E/y+A)),Math.min(p,Math.floor(c+(y-x)*E/y+A)),g)}var O=r[c],U=u,W=p;for(e(r,u,c),g(r[p],O)>0&&e(r,u,p);U<W;){for(e(r,U,W),U++,W--;g(r[U],O)<0;)U++;for(;g(r[W],O)>0;)W--}0===g(r[u],O)?e(r,u,W):e(r,++W,p),W<=c&&(u=W+1),c<=W&&(p=W-1)}}function e(r,c,u){var p=r[c];r[c]=r[u],r[u]=p}function n(r,c){return r<c?-1:r>c?1:0}return function(r,c,u,p,g){t(r,c,u||0,p||r.length-1,g||n)}}();var D2=En(Ba.exports);function v1(t){let e=0;for(let n,r,c=0,u=t.length,p=u-1;c<u;p=c++)n=t[c],r=t[p],e+=(r.x-n.x)*(n.y+r.y);return e}function Qo(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ao(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ua(t,e,n){const r=t[0]-e[0],c=t[1]-e[1],u=t[0]-n[0],p=t[1]-n[1];return r*p-u*c==0&&r*u<=0&&c*p<=0}function Ho(t,e,n=!1){let r=!1;for(let g=0,y=e.length;g<y;g++){const x=e[g];for(let M=0,E=x.length,A=E-1;M<E;A=M++){const O=x[A],U=x[M];if(Ua(t,O,U))return n;(u=O)[1]>(c=t)[1]!=(p=U)[1]>c[1]&&c[0]<(p[0]-u[0])*(c[1]-u[1])/(p[1]-u[1])+u[0]&&(r=!r)}}var c,u,p;return r}function j1(t,e,n,r){const c=r[0]-n[0],u=r[1]-n[1],p=(t[0]-n[0])*u-c*(t[1]-n[1]),g=(e[0]-n[0])*u-c*(e[1]-n[1]);return p>0&&g<0||p<0&&g>0}function Po(t,e,n,r){return(c=[r[0]-n[0],r[1]-n[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*u[0]!=0&&!(!j1(t,e,n,r)||!j1(n,r,t,e));var c,u}const ya=8192;function xo(t,e){const n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*ya),Math.round(r*c*ya)]}function y1(t,e){for(let n=0;n<e.length;n++)if(Ho(t,e[n]))return!0;return!1}function x1(t,e,n){for(const r of n)for(let c=0,u=r.length,p=u-1;c<u;p=c++)if(Po(t,e,r[p],r[c]))return!0;return!1}function Ds(t,e){for(let n=0;n<t.length;++n)if(!Ho(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(x1(t[n],t[n+1],e))return!1;return!0}function z1(t,e){for(let n=0;n<e.length;n++)if(Ds(t,e[n]))return!0;return!1}function bo(t,e,n){const r=[];for(let c=0;c<t.length;c++){const u=[];for(let p=0;p<t[c].length;p++){const g=xo(t[c][p],n);Qo(e,g),u.push(g)}r.push(u)}return r}function n1(t,e,n){const r=[];for(let c=0;c<t.length;c++){const u=bo(t[c],e,n);r.push(u)}return r}function r1(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){const c=.5*r;let u=t[0]-n[0]>c?-r:n[0]-t[0]>c?r:0;0===u&&(u=t[0]-n[2]>c?-r:n[2]-t[0]>c?r:0),t[0]+=u}Qo(e,t)}function Ws(t,e,n,r){const c=Math.pow(2,r.z)*ya,u=[r.x*ya,r.y*ya],p=[];if(!t)return p;for(const g of t)for(const y of g){const x=[y.x+u[0],y.y+u[1]];r1(x,e,n,c),p.push(x)}return p}function xa(t,e,n,r){const c=Math.pow(2,r.z)*ya,u=[r.x*ya,r.y*ya],p=[];if(!t)return p;for(const y of t){const x=[];for(const M of y){const E=[M.x+u[0],M.y+u[1]];Qo(e,E),x.push(E)}p.push(x)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const y of p)for(const x of y)r1(x,e,n,c)}var g;return p}class ea{constructor(e,n){this.type=tr,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(so(e[1])){const r=e[1];if("FeatureCollection"===r.type)for(let c=0;c<r.features.length;++c){const u=r.features[c].geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new ea(r,r.features[c].geometry)}else if("Feature"===r.type){const c=r.geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new ea(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new ea(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,r){const c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if("Polygon"===r.type){const g=bo(r.coordinates,u,p),y=Ws(n.geometry(),c,u,p);if(!ao(c,u))return!1;for(const x of y)if(!Ho(x,g))return!1}if("MultiPolygon"===r.type){const g=n1(r.coordinates,u,p),y=Ws(n.geometry(),c,u,p);if(!ao(c,u))return!1;for(const x of y)if(!y1(x,g))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,r){const c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if("Polygon"===r.type){const g=bo(r.coordinates,u,p),y=xa(n.geometry(),c,u,p);if(!ao(c,u))return!1;for(const x of y)if(!Ds(x,g))return!1}if("MultiPolygon"===r.type){const g=n1(r.coordinates,u,p),y=xa(n.geometry(),c,u,p);if(!ao(c,u))return!1;for(const x of y)if(!z1(x,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var co=ea,ja={exports:{}};ja.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),r=Math.PI/180,c=function(x,M){if(void 0===x)throw new Error("No latitude given.");if(M&&!t[M])throw new Error("Unknown unit "+M+". Use one of: "+Object.keys(t).join(", "));var E=6378.137*r*(M?t[M]:1),A=Math.cos(x*r),O=1/(1-n*(1-A*A)),U=Math.sqrt(O);this.kx=E*U*A,this.ky=E*U*O*(1-n)},u={units:{configurable:!0}};function p(x,M){return x[0]===M[0]&&x[1]===M[1]}function g(x,M,E){var A=y(M[0]-x[0]);return[x[0]+A*E,x[1]+(M[1]-x[1])*E]}function y(x){for(;x<-180;)x+=360;for(;x>180;)x-=360;return x}return c.fromTile=function(x,M,E){var A=Math.PI*(1-2*(x+.5)/Math.pow(2,M)),O=Math.atan(.5*(Math.exp(A)-Math.exp(-A)))/r;return new c(O,E)},u.units.get=function(){return t},c.prototype.distance=function(x,M){var E=y(x[0]-M[0])*this.kx,A=(x[1]-M[1])*this.ky;return Math.sqrt(E*E+A*A)},c.prototype.bearing=function(x,M){var E=y(M[0]-x[0])*this.kx;return Math.atan2(E,(M[1]-x[1])*this.ky)/r},c.prototype.destination=function(x,M,E){var A=E*r;return this.offset(x,Math.sin(A)*M,Math.cos(A)*M)},c.prototype.offset=function(x,M,E){return[x[0]+M/this.kx,x[1]+E/this.ky]},c.prototype.lineDistance=function(x){for(var M=0,E=0;E<x.length-1;E++)M+=this.distance(x[E],x[E+1]);return M},c.prototype.area=function(x){for(var M=0,E=0;E<x.length;E++)for(var A=x[E],O=0,U=A.length,W=U-1;O<U;W=O++)M+=y(A[O][0]-A[W][0])*(A[O][1]+A[W][1])*(E?-1:1);return Math.abs(M)/2*this.kx*this.ky},c.prototype.along=function(x,M){var E=0;if(M<=0)return x[0];for(var A=0;A<x.length-1;A++){var O=x[A],U=x[A+1],W=this.distance(O,U);if((E+=W)>M)return g(O,U,(M-(E-W))/W)}return x[x.length-1]},c.prototype.pointToSegmentDistance=function(x,M,E){var A=M[0],O=M[1],U=y(E[0]-A)*this.kx,W=(E[1]-O)*this.ky,ee=0;return 0===U&&0===W||((ee=(y(x[0]-A)*this.kx*U+(x[1]-O)*this.ky*W)/(U*U+W*W))>1?(A=E[0],O=E[1]):ee>0&&(A+=U/this.kx*ee,O+=W/this.ky*ee)),U=y(x[0]-A)*this.kx,W=(x[1]-O)*this.ky,Math.sqrt(U*U+W*W)},c.prototype.pointOnLine=function(x,M){for(var E,A,O,U,W=1/0,ee=0;ee<x.length-1;ee++){var ae=x[ee][0],be=x[ee][1],Ee=y(x[ee+1][0]-ae)*this.kx,Me=(x[ee+1][1]-be)*this.ky,We=0;0===Ee&&0===Me||((We=(y(M[0]-ae)*this.kx*Ee+(M[1]-be)*this.ky*Me)/(Ee*Ee+Me*Me))>1?(ae=x[ee+1][0],be=x[ee+1][1]):We>0&&(ae+=Ee/this.kx*We,be+=Me/this.ky*We));var Re=(Ee=y(M[0]-ae)*this.kx)*Ee+(Me=(M[1]-be)*this.ky)*Me;Re<W&&(W=Re,E=ae,A=be,O=ee,U=We)}return{point:[E,A],index:O,t:Math.max(0,Math.min(1,U))}},c.prototype.lineSlice=function(x,M,E){var A=this.pointOnLine(E,x),O=this.pointOnLine(E,M);if(A.index>O.index||A.index===O.index&&A.t>O.t){var U=A;A=O,O=U}var W=[A.point],ee=A.index+1,ae=O.index;!p(E[ee],W[0])&&ee<=ae&&W.push(E[ee]);for(var be=ee+1;be<=ae;be++)W.push(E[be]);return p(E[ae],O.point)||W.push(O.point),W},c.prototype.lineSliceAlong=function(x,M,E){for(var A=0,O=[],U=0;U<E.length-1;U++){var W=E[U],ee=E[U+1],ae=this.distance(W,ee);if((A+=ae)>x&&0===O.length&&O.push(g(W,ee,(x-(A-ae))/ae)),A>=M)return O.push(g(W,ee,(M-(A-ae))/ae)),O;A>x&&O.push(ee)}return O},c.prototype.bufferPoint=function(x,M){var E=M/this.ky,A=M/this.kx;return[x[0]-A,x[1]-E,x[0]+A,x[1]+E]},c.prototype.bufferBBox=function(x,M){var E=M/this.ky,A=M/this.kx;return[x[0]-A,x[1]-E,x[2]+A,x[3]+E]},c.prototype.insideBBox=function(x,M){return y(x[0]-M[0])>=0&&y(x[0]-M[2])<=0&&x[1]>=M[1]&&x[1]<=M[3]},Object.defineProperties(c,u),c}();var Zo=En(ja.exports),po={exports:{}};po.exports=function(){var t=function(n,r){if(void 0===n&&(n=[]),void 0===r&&(r=e),this.data=n,this.length=this.data.length,this.compare=r,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function e(n,r){return n<r?-1:n>r?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var n=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var r=this.data,c=this.compare,u=r[n];n>0;){var p=n-1>>1,g=r[p];if(c(u,g)>=0)break;r[n]=g,n=p}r[n]=u},t.prototype._down=function(n){for(var r=this.data,c=this.compare,u=this.length>>1,p=r[n];n<u;){var g=1+(n<<1),y=r[g],x=g+1;if(x<this.length&&c(r[x],y)<0&&(g=x,y=r[x]),c(y,p)>=0)break;r[n]=y,n=g}r[n]=p},t}();var Ss=En(po.exports),Rn=8192;function s1(t,e){return e.dist-t.dist}const A1=100,lo=50;function Ga(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function aa(t){return t[1]-t[0]+1}function sr(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function ca(t,e){if(t[0]>t[1])return[null,null];const n=aa(t);if(e){if(2===n)return[t,null];const r=Math.floor(n/2);return[[t[0],t[0]+r],[t[0]+r,t[1]]]}{if(1===n)return[t,null];const r=Math.floor(n/2)-1;return[[t[0],t[0]+r],[t[0]+r+1,t[1]]]}}function la(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!sr(e,t.length))return n;for(let r=e[0];r<=e[1];++r)Qo(n,t[r]);return n}function G1(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)Qo(e,t[n][r]);return e}function $a(t,e,n){if(Ga(t)||Ga(e))return NaN;let r=0,c=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[r,c])}function se(t){return 360*t-180}function ne(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function X(t,e){const n=Math.pow(2,e.z),r=(t.y/Rn+e.y)/n;return[se((t.x/Rn+e.x)/n),ne(r)]}function Ve(t,e){const n=[];for(let r=0;r<t.length;++r)n.push(X(t[r],e));return n}function lt(t,e,n){const r=n.pointOnLine(e,t).point;return n.distance(t,r)}function jn(t,e,n,r,c){const u=n.slice(r[0],r[1]+1);let p=1/0;for(let g=e[0];g<=e[1];++g)if(0===(p=Math.min(p,lt(t[g],u,c))))return 0;return p}function ms(t,e,n,r,c){const u=Math.min(c.pointToSegmentDistance(t,n,r),c.pointToSegmentDistance(e,n,r)),p=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(r,t,e));return Math.min(u,p)}function Eo(t,e,n,r,c){if(!sr(e,t.length)||!sr(r,n.length))return NaN;let u=1/0;for(let p=e[0];p<e[1];++p)for(let g=r[0];g<r[1];++g){if(Po(t[p],t[p+1],n[g],n[g+1]))return 0;u=Math.min(u,ms(t[p],t[p+1],n[g],n[g+1],c))}return u}function Hs(t,e,n,r,c){if(!sr(e,t.length)||!sr(r,n.length))return NaN;let u=1/0;for(let p=e[0];p<=e[1];++p)for(let g=r[0];g<=r[1];++g)if(0===(u=Math.min(u,c.distance(t[p],n[g]))))return u;return u}function o1(t,e,n){if(Ho(t,e,!0))return 0;let r=1/0;for(const c of e){const u=c.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[u-1]&&0===(r=Math.min(r,n.pointToSegmentDistance(t,c[u-1],c[0])))||0===(r=Math.min(r,lt(t,c,n))))return r}return r}function Yo(t,e,n,r){if(!sr(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(Ho(t[u],n,!0))return 0;let c=1/0;for(let u=e[0];u<e[1];++u)for(const p of n)for(let g=0,y=p.length,x=y-1;g<y;x=g++){if(Po(t[u],t[u+1],p[x],p[g]))return 0;c=Math.min(c,ms(t[u],t[u+1],p[x],p[g],r))}return c}function qs(t,e){for(const n of t)for(let r=0;r<=n.length-1;++r)if(Ho(n[r],e,!0))return!0;return!1}function ba(t,e,n,r=1/0){const c=G1(t),u=G1(e);if(r!==1/0&&$a(c,u,n)>=r)return r;if(ao(c,u)){if(qs(t,e))return 0}else if(qs(e,t))return 0;let p=r;for(const g of t)for(let y=0,x=g.length,M=x-1;y<x;M=y++)for(const E of e)for(let A=0,O=E.length,U=O-1;A<O;U=A++){if(Po(g[M],g[y],E[U],E[A]))return 0;p=Math.min(p,ms(g[M],g[y],E[U],E[A],n))}return p}function Aa(t,e,n,r,c,u,p){if(null===u||null===p)return;const g=$a(la(r,u),la(c,p),n);g<e&&t.push({dist:g,range1:u,range2:p})}function a1(t,e,n,r,c=1/0){let u=Math.min(r.distance(t[0],n[0][0]),c);if(0===u)return u;const p=new Ss([{dist:0,range1:[0,t.length-1],range2:[0,0]}],s1),g=e?lo:A1,y=G1(n);for(;p.length;){const x=p.pop();if(x.dist>=u)continue;const M=x.range1;if(aa(M)<=g){if(!sr(M,t.length))return NaN;if(e){const E=Yo(t,M,n,r);if(0===(u=Math.min(u,E)))return u}else for(let E=M[0];E<=M[1];++E){const A=o1(t[E],n,r);if(0===(u=Math.min(u,A)))return u}}else{const E=ca(M,e);if(null!==E[0]){const A=$a(la(t,E[0]),y,r);A<u&&p.push({dist:A,range1:E[0],range2:[0,0]})}if(null!==E[1]){const A=$a(la(t,E[1]),y,r);A<u&&p.push({dist:A,range1:E[1],range2:[0,0]})}}}return u}function b1(t,e,n,r,c,u=1/0){let p=Math.min(u,c.distance(t[0],n[0]));if(0===p)return p;const g=new Ss([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],s1),y=e?lo:A1,x=r?lo:A1;for(;g.length;){const M=g.pop();if(M.dist>=p)continue;const E=M.range1,A=M.range2;if(aa(E)<=y&&aa(A)<=x){if(!sr(E,t.length)||!sr(A,n.length))return NaN;if(e&&r?p=Math.min(p,Eo(t,E,n,A,c)):e||r?e&&!r?p=Math.min(p,jn(n,A,t,E,c)):!e&&r&&(p=Math.min(p,jn(t,E,n,A,c))):p=Math.min(p,Hs(t,E,n,A,c)),0===p)return p}else{const O=ca(E,e),U=ca(A,r);Aa(g,p,c,t,n,O[0],U[0]),Aa(g,p,c,t,n,O[0],U[1]),Aa(g,p,c,t,n,O[1],U[0]),Aa(g,p,c,t,n,O[1],U[1])}}return p}function t2(t,e,n,r,c=1/0){let u=c;const p=la(t,[0,t.length-1]);for(const g of n)if(!(u!==1/0&&$a(p,la(g,[0,g.length-1]),r)>=u)&&(u=Math.min(u,b1(t,e,g,!0,r,u)),0===u))return u;return u}function gs(t,e,n,r,c=1/0){let u=c;const p=la(t,[0,t.length-1]);for(const g of n){if(u!==1/0&&$a(p,G1(g),r)>=u)continue;const y=a1(t,e,g,r,u);if(isNaN(y))return y;if(0===(u=Math.min(u,y)))return u}return u}function Bo(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class ta{constructor(e,n){this.type=qn,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(so(e[1])){const r=e[1];if("FeatureCollection"===r.type){for(let c=0;c<r.features.length;++c)if(Bo(r.features[c].geometry.type))return new ta(r,r.features[c].geometry)}else if("Feature"===r.type){if(Bo(r.geometry.type))return new ta(r,r.geometry)}else if(Bo(r.type))return new ta(r,r)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),r=e.canonicalID();if(null!=n&&null!=r){if("Point"===e.geometryType())return function(c,u,p){const g=[];for(const x of c)for(const M of x)g.push(X(M,u));const y=new Zo(g[0][1],"meters");return"Point"===p.type||"MultiPoint"===p.type||"LineString"===p.type?b1(g,!1,"Point"===p.type?[p.coordinates]:p.coordinates,"LineString"===p.type,y):"MultiLineString"===p.type?t2(g,!1,p.coordinates,y):"Polygon"===p.type||"MultiPolygon"===p.type?gs(g,!1,"Polygon"===p.type?[p.coordinates]:p.coordinates,y):null}(n,r,this.geometries);if("LineString"===e.geometryType())return function(c,u,p){const g=[];for(const x of c){const M=[];for(const E of x)M.push(X(E,u));g.push(M)}const y=new Zo(g[0][0][1],"meters");if("Point"===p.type||"MultiPoint"===p.type||"LineString"===p.type)return t2("Point"===p.type?[p.coordinates]:p.coordinates,"LineString"===p.type,g,y);if("MultiLineString"===p.type){let x=1/0;for(let M=0;M<p.coordinates.length;M++){const E=t2(p.coordinates[M],!0,g,y,x);if(isNaN(E))return E;if(0===(x=Math.min(x,E)))return x}return x}if("Polygon"===p.type||"MultiPolygon"===p.type){let x=1/0;for(let M=0;M<g.length;M++){const E=gs(g[M],!0,"Polygon"===p.type?[p.coordinates]:p.coordinates,y,x);if(isNaN(E))return E;if(0===(x=Math.min(x,E)))return x}return x}return null}(n,r,this.geometries);if("Polygon"===e.geometryType())return function(c,u,p){const g=[];for(const x of function(M,E){const A=M.length;if(A<=1)return[M];const O=[];let U,W;for(let ee=0;ee<A;ee++){const ae=v1(M[ee]);0!==ae&&(M[ee].area=Math.abs(ae),void 0===W&&(W=ae<0),W===ae<0?(U&&O.push(U),U=[M[ee]]):U.push(M[ee]))}return U&&O.push(U),O}(c)){const M=[];for(let E=0;E<x.length;++E)M.push(Ve(x[E],u));g.push(M)}const y=new Zo(g[0][0][0][1],"meters");if("Point"===p.type||"MultiPoint"===p.type||"LineString"===p.type)return gs("Point"===p.type?[p.coordinates]:p.coordinates,"LineString"===p.type,g,y);if("MultiLineString"===p.type){let x=1/0;for(let M=0;M<p.coordinates.length;M++){const E=gs(p.coordinates[M],!0,g,y,x);if(isNaN(E))return E;if(0===(x=Math.min(x,E)))return x}return x}return"Polygon"===p.type||"MultiPolygon"===p.type?function(x,M,E){let A=1/0;for(const O of x)for(const U of M){const W=ba(O,U,E,A);if(isNaN(W))return W;if(0===(A=Math.min(A,W)))return A}return A}("Polygon"===p.type?[p.coordinates]:p.coordinates,g,y):null}(n,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var c1=ta;function mo(t,e){switch(t){case"string":return to(e);case"number":return+e;case"boolean":return!!e;case"color":return Sr.parse(e);case"formatted":return Gs.fromString(to(e));case"resolvedImage":return Qn.fromString(to(e))}return e}function n2(t,e,n,r){return void 0!==r&&(t=r*Math.round(t/r)),void 0!==e&&t<e&&(t=e),void 0!==n&&t>n&&(t=n),t}class Wa{constructor(e,n,r){this.type=e,this.key=n,this.scope=r}static parse(e,n){let r=n.expectedType;if(null==r&&(r=rr),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const c=n.parse(e[1],1);if(!(c instanceof Oo))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const u=n.parse(e[2],2);return u instanceof Oo?new Wa(r,to(c.value),to(u.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Wa(r,to(c.value))}evaluate(e){const n=[this.key,this.scope,e.scope].filter(Boolean).join("\x1f"),r=e.getConfig(n);if(!r)return null;const{type:c,value:u,values:p,minValue:g,maxValue:y,stepValue:x}=r,M=r.default.evaluate(e);let E=M;if(u){const A=e.scope;e.scope=(A||"").split("\x1f").slice(1).join("\x1f"),E=u.evaluate(e),e.scope=A}return c&&(E=mo(c,E)),void 0===E||void 0===g&&void 0===y&&void 0===x||("number"==typeof E?E=n2(E,g,y,x):Array.isArray(E)&&(E=E.map(A=>"number"==typeof A?n2(A,g,y,x):A))),void 0!==u&&void 0!==E&&p&&!p.includes(E)&&(E=M,c&&(E=mo(c,E))),(c&&c!==this.type||void 0!==E&&as(E)!==this.type)&&(E=mo(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var La=Wa;function I1(t){if(t instanceof cr&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof co||t instanceof c1)return!1;let e=!0;return t.eachChild(n=>{e&&!I1(n)&&(e=!1)}),e}function wa(t){if(t instanceof cr&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!wa(n)&&(e=!1)}),e}function qa(t){if(t instanceof La)return!1;let e=!0;return t.eachChild(n=>{e&&!qa(n)&&(e=!1)}),e}function vt(t,e){if(t instanceof cr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(r=>{n&&!vt(r,e)&&(n=!1)}),n}class ft{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const r=e[1];return n.scope.has(r)?new ft(r,n.scope.get(r)):n.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var $e=ft;class Yt{constructor(e,n=[],r,c=new br,u=[],p,g){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=c,this.errors=u,this.expectedType=r,this._scope=p,this.options=g}parse(e,n,r,c,u={}){return n||r?this.concat(n,r,c)._parse(e,u):this._parse(e,u)}_parse(e,n){function r(c,u,p){return"assert"===p?new oo(u,[c]):"coerce"===p?new Fo(u,[c]):c}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c="string"==typeof e[0]?this.registry[e[0]]:void 0;if(c){let u=c.parse(e,this);if(!u)return null;if(this.expectedType){const p=this.expectedType,g=u.type;if("string"!==p.kind&&"number"!==p.kind&&"boolean"!==p.kind&&"object"!==p.kind&&"array"!==p.kind||"value"!==g.kind)if("color"!==p.kind&&"formatted"!==p.kind&&"resolvedImage"!==p.kind||"value"!==g.kind&&"string"!==g.kind){if(this.checkSubtype(p,g))return null}else u=r(u,p,n.typeAnnotation||"coerce");else u=r(u,p,n.typeAnnotation||"assert")}if(!(u instanceof Oo)&&"resolvedImage"!==u.type.kind&&Ui(u)){const p=new U1(this._scope,this.options);try{u=new Oo(u.type,u.evaluate(p))}catch(g){return this.error(g.message),null}}return u}return Fo.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,r){const c="number"==typeof e?this.path.concat(e):this.path,u=r?this.scope.concat(r):this.scope;return new Yt(this.registry,c,n||null,u,this.errors,this._scope,this.options)}error(e,...n){const r=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Fs(r,e))}checkSubtype(e,n){const r=eo(e,n);return r&&this.error(r),r}}var Pn=Yt;function Ui(t){if(t instanceof $e)return Ui(t.boundExpression);if(t instanceof cr&&"error"===t.name||t instanceof To||t instanceof co||t instanceof c1||t instanceof La)return!1;const e=t instanceof Fo||t instanceof oo;let n=!0;return t.eachChild(r=>{n=e?n&&Ui(r):n&&r instanceof Oo}),!!n&&I1(t)&&vt(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ys(t,e){const n=t.length-1;let r,c,u=0,p=n,g=0;for(;u<=p;)if(g=Math.floor((u+p)/2),r=t[g],c=t[g+1],r<=e){if(g===n||e<c)return g;u=g+1}else{if(!(r>e))throw new Nr("Input is not a number.");p=g-1}return 0}class na{constructor(e,n,r){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,u]of r)this.labels.push(c),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const r=n.parse(e[1],1,qn);if(!r)return null;const c=[];let u=null;n.expectedType&&"value"!==n.expectedType.kind&&(u=n.expectedType);for(let p=1;p<e.length;p+=2){const g=1===p?-1/0:e[p],y=e[p+1],x=p,M=p+1;if("number"!=typeof g)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(c.length&&c[c.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const E=n.parse(y,M,u);if(!E)return null;u=u||E.type,c.push([g,E])}return new na(u,r,c)}evaluate(e){const n=this.labels,r=this.outputs;if(1===n.length)return r[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return r[0].evaluate(e);const u=n.length;return c>=n[u-1]?r[u-1].evaluate(e):r[ys(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Da=na;const V1=.95047,ua=1.08883,v2=4/29,zo=6/29,l1=3*zo*zo,Zs=zo*zo*zo,X2=Math.PI/180,u1=180/Math.PI;function l2(t){return t>Zs?Math.pow(t,1/3):t/l1+v2}function I2(t){return t>zo?t*t*t:l1*(t-v2)}function V2(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Z(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function I(t){const e=Z(t.r),n=Z(t.g),r=Z(t.b),c=l2((.4124564*e+.3575761*n+.1804375*r)/V1),u=l2((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*u-16,a:500*(c-u),b:200*(u-l2((.0193339*e+.119192*n+.9503041*r)/ua)),alpha:t.a}}function L(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*I2(e),n=V1*I2(n),r=ua*I2(r),new Sr(V2(3.2404542*n-1.5371385*e-.4985314*r),V2(-.969266*n+1.8760108*e+.041556*r),V2(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function j(t,e,n){const r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const ie={forward:I,reverse:L,interpolate:function(t,e,n){return{l:Pi(t.l,e.l,n),a:Pi(t.a,e.a,n),b:Pi(t.b,e.b,n),alpha:Pi(t.alpha,e.alpha,n)}}},we={forward:function(t){const{l:e,a:n,b:r}=I(t),c=Math.atan2(r,n)*u1;return{h:c<0?c+360:c,c:Math.sqrt(n*n+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*X2,n=t.c;return L({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:j(t.h,e.h,n),c:Pi(t.c,e.c,n),l:Pi(t.l,e.l,n),alpha:Pi(t.alpha,e.alpha,n)}}};var Je=Object.freeze({__proto__:null,hcl:we,lab:ie});class yt{constructor(e,n,r,c,u){this.type=e,this.operator=n,this.interpolation=r,this.input=c,this.labels=[],this.outputs=[];for(const[p,g]of u)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,n,r,c){let u=0;if("exponential"===e.name)u=rn(n,e.base,r,c);else if("linear"===e.name)u=rn(n,1,r,c);else if("cubic-bezier"===e.name){const p=e.controlPoints;u=new hn(p[0],p[1],p[2],p[3]).solve(rn(n,1,r,c))}return u}static parse(e,n){let[r,c,u,...p]=e;if(!Array.isArray(c)||0===c.length)return n.error("Expected an interpolation type expression.",1);if("linear"===c[0])c={name:"linear"};else if("exponential"===c[0]){const x=c[1];if("number"!=typeof x)return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:x}}else{if("cubic-bezier"!==c[0])return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const x=c.slice(1);if(4!==x.length||x.some(M=>"number"!=typeof M||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,qn),!u)return null;const g=[];let y=null;"interpolate-hcl"===r||"interpolate-lab"===r?y=es:n.expectedType&&"value"!==n.expectedType.kind&&(y=n.expectedType);for(let x=0;x<p.length;x+=2){const M=p[x],E=p[x+1],A=x+3,O=x+4;if("number"!=typeof M)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(g.length&&g[g.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const U=n.parse(E,O,y);if(!U)return null;y=y||U.type,g.push([M,U])}return"number"===y.kind||"color"===y.kind||"array"===y.kind&&"number"===y.itemType.kind&&"number"==typeof y.N?new yt(y,r,c,u,g):n.error(`Type ${vs(y)} is not interpolatable.`)}evaluate(e){const n=this.labels,r=this.outputs;if(1===n.length)return r[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return r[0].evaluate(e);const u=n.length;if(c>=n[u-1])return r[u-1].evaluate(e);const p=ys(n,c),g=yt.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=r[p].evaluate(e),x=r[p+1].evaluate(e);return"interpolate"===this.operator?js[this.type.kind.toLowerCase()](y,x,g):"interpolate-hcl"===this.operator?we.reverse(we.interpolate(we.forward(y),we.forward(x),g)):ie.reverse(ie.interpolate(ie.forward(y),ie.forward(x),g))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)n.push(this.labels[r],this.outputs[r].serialize());return n}}function rn(t,e,n,r){const c=r-n,u=t-n;return 0===c?0:1===e?u/c:(Math.pow(e,u)-1)/(Math.pow(e,c)-1)}var mn=yt;class Jn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let r=null;const c=n.expectedType;c&&"value"!==c.kind&&(r=c);const u=[];for(const g of e.slice(1)){const y=n.parse(g,1+u.length,r,void 0,{typeAnnotation:"omit"});if(!y)return null;r=r||y.type,u.push(y)}const p=c&&u.some(g=>eo(c,g.type));return new Jn(p?rr:r,u)}evaluate(e){let n,r=null,c=0;for(const u of this.args){if(c++,r=u.evaluate(e),r&&r instanceof Qn&&!r.available&&(n||(n=r),r=null,c===this.args.length))return n;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Bn=Jn;class gi{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if("string"!=typeof p)return n.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);const g=n.parse(e[u+1],u+1);if(!g)return null;r.push([p,g])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,r);return c?new gi(r,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,r]of this.bindings)e.push(n,r.serialize());return e.push(this.result.serialize()),e}}var Zi=gi;class dr{constructor(e,n,r){this.type=e,this.index=n,this.input=r}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,qn),c=n.parse(e[2],2,_r(n.expectedType||rr));return r&&c?new dr(c.type.itemType,r,c):null}evaluate(e){const n=this.index.evaluate(e),r=this.input.evaluate(e);if(n<0)throw new Nr(`Array index out of bounds: ${n} < 0.`);if(n>=r.length)throw new Nr(`Array index out of bounds: ${n} > ${r.length-1}.`);if(n!==Math.floor(n))throw new Nr(`Array index must be an integer, but found ${n} instead.`);return r[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ji=dr;class wo{constructor(e,n){this.type=tr,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,rr),c=n.parse(e[2],2,rr);return r&&c?Ci(r.type,[tr,Yi,qn,ws,rr])?new wo(r,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${vs(r.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!As(n,["boolean","string","number","null"]))throw new Nr(`Expected first argument to be of type boolean, string, number or null, but found ${vs(as(n))} instead.`);if(!As(r,["string","array"]))throw new Nr(`Expected second argument to be of type array or string, but found ${vs(as(r))} instead.`);return r.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var No=wo;class Bs{constructor(e,n,r){this.type=qn,this.needle=e,this.haystack=n,this.fromIndex=r}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,rr),c=n.parse(e[2],2,rr);if(!r||!c)return null;if(!Ci(r.type,[tr,Yi,qn,ws,rr]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${vs(r.type)} instead`);if(4===e.length){const u=n.parse(e[3],3,qn);return u?new Bs(r,c,u):null}return new Bs(r,c)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!As(n,["boolean","string","number","null"]))throw new Nr(`Expected first argument to be of type boolean, string, number or null, but found ${vs(as(n))} instead.`);if(!As(r,["string","array"]))throw new Nr(`Expected second argument to be of type array or string, but found ${vs(as(r))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return r.indexOf(n,c)}return r.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ps=Bs;class xs{constructor(e,n,r,c,u,p){this.inputType=e,this.type=n,this.input=r,this.cases=c,this.outputs=u,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let r,c;n.expectedType&&"value"!==n.expectedType.kind&&(c=n.expectedType);const u={},p=[];for(let x=2;x<e.length-1;x+=2){let M=e[x];const E=e[x+1];Array.isArray(M)||(M=[M]);const A=n.concat(x);if(0===M.length)return A.error("Expected at least one branch label.");for(const U of M){if("number"!=typeof U&&"string"!=typeof U)return A.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return A.error("Numeric branch labels must be integer values.");if(r){if(A.checkSubtype(r,as(U)))return null}else r=as(U);if(void 0!==u[String(U)])return A.error("Branch labels must be unique.");u[String(U)]=p.length}const O=n.parse(E,x,c);if(!O)return null;c=c||O.type,p.push(O)}const g=n.parse(e[1],1,rr);if(!g)return null;const y=n.parse(e[e.length-1],e.length-1,c);return y?"value"!==g.type.kind&&n.concat(1).checkSubtype(r,g.type)?null:new xs(r,c,g,u,p,y):null}evaluate(e){const n=this.input.evaluate(e);return(as(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),r=[],c={};for(const p of n){const g=c[this.cases[p]];void 0===g?(c[this.cases[p]]=r.length,r.push([this.cases[p],[p]])):r[g][1].push(p)}const u=p=>"number"===this.inputType.kind?Number(p):p;for(const[p,g]of r)e.push(1===g.length?u(g[0]):g.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var uo=xs;class Uo{constructor(e,n,r){this.type=e,this.branches=n,this.otherwise=r}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let r;n.expectedType&&"value"!==n.expectedType.kind&&(r=n.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const g=n.parse(e[p],p,tr);if(!g)return null;const y=n.parse(e[p+1],p+1,r);if(!y)return null;c.push([g,y]),r=r||y.type}const u=n.parse(e[e.length-1],e.length-1,r);return u?new Uo(r,c,u):null}evaluate(e){for(const[n,r]of this.branches)if(n.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,r]of this.branches)e(n),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Za=Uo;class h1{constructor(e,n,r,c){this.type=e,this.input=n,this.beginIndex=r,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,rr),c=n.parse(e[2],2,qn);if(!r||!c)return null;if(!Ci(r.type,[_r(rr),Yi,rr]))return n.error(`Expected first argument to be of type array or string, but found ${vs(r.type)} instead`);if(4===e.length){const u=n.parse(e[3],3,qn);return u?new h1(r.type,r,c,u):null}return new h1(r.type,r,c)}evaluate(e){const n=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!As(n,["string","array"]))throw new Nr(`Expected first argument to be of type array or string, but found ${vs(as(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(r,c)}return n.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ha=h1;function fa(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function r2(t,e,n,r){return 0===r.compare(e,n)}function H2(t,e,n){const r="=="!==t&&"!="!==t;return class x_{constructor(u,p,g){this.type=tr,this.lhs=u,this.rhs=p,this.collator=g,this.hasUntypedArgument="value"===u.type.kind||"value"===p.type.kind}static parse(u,p){if(3!==u.length&&4!==u.length)return p.error("Expected two or three arguments.");const g=u[0];let y=p.parse(u[1],1,rr);if(!y)return null;if(!fa(g,y.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${vs(y.type)}'.`);let x=p.parse(u[2],2,rr);if(!x)return null;if(!fa(g,x.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${vs(x.type)}'.`);if(y.type.kind!==x.type.kind&&"value"!==y.type.kind&&"value"!==x.type.kind)return p.error(`Cannot compare types '${vs(y.type)}' and '${vs(x.type)}'.`);r&&("value"===y.type.kind&&"value"!==x.type.kind?y=new oo(x.type,[y]):"value"!==y.type.kind&&"value"===x.type.kind&&(x=new oo(y.type,[x])));let M=null;if(4===u.length){if("string"!==y.type.kind&&"string"!==x.type.kind&&"value"!==y.type.kind&&"value"!==x.type.kind)return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(u[3],3,Cs),!M)return null}return new x_(y,x,M)}evaluate(u){const p=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(r&&this.hasUntypedArgument){const y=as(p),x=as(g);if(y.kind!==x.kind||"string"!==y.kind&&"number"!==y.kind)throw new Nr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const y=as(p),x=as(g);if("string"!==y.kind||"string"!==x.kind)return e(u,p,g)}return this.collator?n(u,p,g,this.collator.evaluate(u)):e(u,p,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const J2=H2("==",function(t,e,n){return e===n},r2),gc=H2("!=",function(t,e,n){return e!==n},function(t,e,n,r){return!r2(0,e,n,r)}),Dl=H2("<",function(t,e,n){return e<n},function(t,e,n,r){return r.compare(e,n)<0}),$1=H2(">",function(t,e,n){return e>n},function(t,e,n,r){return r.compare(e,n)>0}),_c=H2("<=",function(t,e,n){return e<=n},function(t,e,n,r){return r.compare(e,n)<=0}),y2=H2(">=",function(t,e,n){return e>=n},function(t,e,n,r){return r.compare(e,n)>=0});class x2{constructor(e,n,r,c,u,p){this.type=Yi,this.number=e,this.locale=n,this.currency=r,this.unit=c,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const r=n.parse(e[1],1,qn);if(!r)return null;const c=e[2];if("object"!=typeof c||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let u=null;if(c.locale&&(u=n.parse(c.locale,1,Yi),!u))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,Yi),!p))return null;let g=null;if(c.unit&&(g=n.parse(c.unit,1,Yi),!g))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,qn),!y))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,qn),!x)?null:new x2(r,u,p,g,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class vc{constructor(e){this.type=qn,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=n.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?n.error(`Expected argument of type string or array, but found ${vs(r.type)} instead.`):new vc(r):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new Nr(`Expected value to be of type string or array, but found ${vs(as(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function P2(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Q2={"==":J2,"!=":gc,">":$1,"<":Dl,">=":y2,"<=":_c,array:oo,at:ji,boolean:oo,case:Za,coalesce:Bn,collator:To,format:_1,image:yo,in:No,"index-of":Ps,interpolate:mn,"interpolate-hcl":mn,"interpolate-lab":mn,length:vc,let:Zi,literal:Oo,match:uo,number:oo,"number-format":x2,object:oo,slice:ha,step:Da,string:oo,"to-boolean":Fo,"to-color":Fo,"to-number":Fo,"to-string":Fo,var:$e,within:co,distance:c1,config:La};function Vc(t,[e,n,r,c]){e=e.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);const u=c?c.evaluate(t):1,p=Ls(e,n,r,u);if(p)throw new Nr(p);return new Sr(e/255*u,n/255*u,r/255*u,u)}function Hc(t,[e,n,r,c]){e=e.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);const u=c?c.evaluate(t):1,p=(M=n,E=r,A=u,"number"==typeof(x=e)&&x>=0&&x<=360?"number"==typeof M&&M>=0&&M<=100&&"number"==typeof E&&E>=0&&E<=100?void 0===A||"number"==typeof A&&A>=0&&A<=1?null:`Invalid hsla value [${[x,M,E,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof A?[x,M,E,A]:[x,M,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof A?[x,M,E,A]:[x,M,E]).join(", ")}]: 'h' must be between 0 and 360.`);var x,M,E,A;if(p)throw new Nr(p);const g=`hsla(${e}, ${n}%, ${r}%, ${u})`,y=Sr.parse(g);if(!y)throw new Nr(`Failed to parse HSLA color: ${g}`);return y}function yc(t,e){return t in e}function Ca(t,e){const n=e[t];return void 0===n?null:n}function H1(t){return{type:t}}cr.register(Q2,{error:[{kind:"error"},[Yi],(t,[e])=>{throw new Nr(e.evaluate(t))}],typeof:[Yi,[rr],(t,[e])=>vs(as(e.evaluate(t)))],"to-rgba":[_r(qn,4),[es],(t,[e])=>e.evaluate(t).toArray()],rgb:[es,[qn,qn,qn],Vc],rgba:[es,[qn,qn,qn,qn],Vc],hsl:[es,[qn,qn,qn],Hc],hsla:[es,[qn,qn,qn,qn],Hc],has:{type:tr,overloads:[[[Yi],(t,[e])=>yc(e.evaluate(t),t.properties())],[[Yi,ho],(t,[e,n])=>yc(e.evaluate(t),n.evaluate(t))]]},get:{type:rr,overloads:[[[Yi],(t,[e])=>Ca(e.evaluate(t),t.properties())],[[Yi,ho],(t,[e,n])=>Ca(e.evaluate(t),n.evaluate(t))]]},"feature-state":[rr,[Yi],(t,[e])=>Ca(e.evaluate(t),t.featureState||{})],properties:[ho,[],t=>t.properties()],"geometry-type":[Yi,[],t=>t.geometryType()],id:[rr,[],t=>t.id()],zoom:[qn,[],t=>t.globals.zoom],pitch:[qn,[],t=>t.globals.pitch||0],"distance-from-center":[qn,[],t=>t.distanceFromCenter()],"measure-light":[qn,[Yi],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[qn,[],t=>t.globals.heatmapDensity||0],"line-progress":[qn,[],t=>t.globals.lineProgress||0],"raster-value":[qn,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[qn,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[qn,[],t=>t.globals.skyRadialProgress||0],accumulated:[rr,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[qn,H1(qn),(t,e)=>{let n=0;for(const r of e)n+=r.evaluate(t);return n}],"*":[qn,H1(qn),(t,e)=>{let n=1;for(const r of e)n*=r.evaluate(t);return n}],"-":{type:qn,overloads:[[[qn,qn],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[qn],(t,[e])=>-e.evaluate(t)]]},"/":[qn,[qn,qn],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[qn,[qn,qn],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[qn,[],()=>Math.LN2],pi:[qn,[],()=>Math.PI],e:[qn,[],()=>Math.E],"^":[qn,[qn,qn],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[qn,[qn],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[qn,[qn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[qn,[qn],(t,[e])=>Math.log(e.evaluate(t))],log2:[qn,[qn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[qn,[qn],(t,[e])=>Math.sin(e.evaluate(t))],cos:[qn,[qn],(t,[e])=>Math.cos(e.evaluate(t))],tan:[qn,[qn],(t,[e])=>Math.tan(e.evaluate(t))],asin:[qn,[qn],(t,[e])=>Math.asin(e.evaluate(t))],acos:[qn,[qn],(t,[e])=>Math.acos(e.evaluate(t))],atan:[qn,[qn],(t,[e])=>Math.atan(e.evaluate(t))],min:[qn,H1(qn),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[qn,H1(qn),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[qn,[qn],(t,[e])=>Math.abs(e.evaluate(t))],round:[qn,[qn],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[qn,[qn],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[qn,[qn],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[tr,[Yi,rr],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[tr,[rr],(t,[e])=>t.id()===e.value],"filter-type-==":[tr,[Yi],(t,[e])=>t.geometryType()===e.value],"filter-<":[tr,[Yi,rr],(t,[e,n])=>{const r=t.properties()[e.value],c=n.value;return typeof r==typeof c&&r<c}],"filter-id-<":[tr,[rr],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[tr,[Yi,rr],(t,[e,n])=>{const r=t.properties()[e.value],c=n.value;return typeof r==typeof c&&r>c}],"filter-id->":[tr,[rr],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[tr,[Yi,rr],(t,[e,n])=>{const r=t.properties()[e.value],c=n.value;return typeof r==typeof c&&r<=c}],"filter-id-<=":[tr,[rr],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[tr,[Yi,rr],(t,[e,n])=>{const r=t.properties()[e.value],c=n.value;return typeof r==typeof c&&r>=c}],"filter-id->=":[tr,[rr],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[tr,[rr],(t,[e])=>e.value in t.properties()],"filter-has-id":[tr,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[tr,[_r(Yi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[tr,[_r(rr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[tr,[Yi,_r(rr)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[tr,[Yi,_r(rr)],(t,[e,n])=>function(r,c,u,p){for(;u<=p;){const g=u+p>>1;if(c[g]===r)return!0;c[g]>r?p=g-1:u=g+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:tr,overloads:[[[tr,tr],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[H1(tr),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:tr,overloads:[[[tr,tr],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[H1(tr),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[tr,[tr],(t,[e])=>!e.evaluate(t)],"is-supported-script":[tr,[Yi],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Yi,[Yi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Yi,[Yi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Yi,H1(rr),(t,e)=>e.map(n=>to(n.evaluate(t))).join("")],"resolved-locale":[Yi,[Cs],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[qn,[qn,qn,rr],(t,e)=>{const[n,r,c]=e.map(p=>p.evaluate(t));if(n>r||n===r)return n;let u;if("string"==typeof c)u=function(p){let g=0;if(0===p.length)return g;for(let y=0;y<p.length;y++)g=(g<<5)-g+p.charCodeAt(y),g|=0;return g}(c);else{if("number"!=typeof c)throw new Nr(`Invalid seed input: ${c}`);u=c}return n+P2(u)()*(r-n)}]});var s2=Q2;function b2(t){return{result:"success",value:t}}function w1(t){return{result:"error",value:t}}function Pc(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function te(t){return"data-driven"===t["property-type"]}function P(t){return Pc(t.expression,"measure-light")}function D(t){return Pc(t.expression,"zoom")}function q(t){return!!t.expression&&t.expression.interpolated}function he(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Fe(t){return t}function bt(t,e){const n="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],c=r||!(r||void 0!==t.property),u=t.type||(q(e)?"exponential":"interval");if(n&&((t=sa({},t)).stops&&(t.stops=t.stops.map(x=>[x[0],Sr.parse(x[1])])),t.default=Sr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Je[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,g,y;if("exponential"===u)p=fi;else if("interval"===u)p=An;else if("categorical"===u){p=fn,g=Object.create(null);for(const x of t.stops)g[x[0]]=x[1];y=typeof t.stops[0][0]}else{if("identity"!==u)throw new Error(`Unknown function type "${u}"`);p=Vi}if(r){const x={},M=[];for(let O=0;O<t.stops.length;O++){const U=t.stops[O],W=U[0].zoom;void 0===x[W]&&(x[W]={zoom:W,type:t.type,property:t.property,default:t.default,stops:[]},M.push(W)),x[W].stops.push([U[0].value,U[1]])}const E=[];for(const O of M)E.push([x[O].zoom,bt(x[O],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:mn.interpolationFactor.bind(void 0,A),zoomStops:E.map(O=>O[0]),evaluate:({zoom:O},U)=>fi({stops:E,base:t.base},e,O).evaluate(O,U)}}if(c){const x="exponential"===u?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:mn.interpolationFactor.bind(void 0,x),zoomStops:t.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(t,e,M,g,y)}}return{kind:"source",evaluate(x,M){const E=M&&M.properties?M.properties[t.property]:void 0;return void 0===E?Mt(t.default,e.default):p(t,e,E,g,y)}}}function Mt(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function fn(t,e,n,r,c){return Mt(typeof n===c?r[n]:void 0,t.default,e.default)}function An(t,e,n){if("number"!==oa(n))return Mt(t.default,e.default);const r=t.stops.length;if(1===r||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const c=ys(t.stops.map(u=>u[0]),n);return t.stops[c][1]}function fi(t,e,n){const r=void 0!==t.base?t.base:1;if("number"!==oa(n))return Mt(t.default,e.default);const c=t.stops.length;if(1===c||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];const u=ys(t.stops.map(M=>M[0]),n),p=function(M,E,A,O){const U=O-A,W=M-A;return 0===U?0:1===E?W/U:(Math.pow(E,W)-1)/(Math.pow(E,U)-1)}(n,r,t.stops[u][0],t.stops[u+1][0]),g=t.stops[u][1],y=t.stops[u+1][1];let x=js[e.type]||Fe;if(t.colorSpace&&"rgb"!==t.colorSpace){const M=Je[t.colorSpace];x=(E,A)=>M.reverse(M.interpolate(M.forward(E),M.forward(A),p))}return"function"==typeof g.evaluate?{evaluate(...M){const E=g.evaluate.apply(void 0,M),A=y.evaluate.apply(void 0,M);if(void 0!==E&&void 0!==A)return x(E,A,p)}}:x(g,y,p)}function Vi(t,e,n){return"color"===e.type?n=Sr.parse(n):"formatted"===e.type?n=Gs.fromString(n.toString()):"resolvedImage"===e.type?n=Qn.fromString(n.toString()):oa(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Mt(n,t.default,e.default)}class Zr{constructor(e,n,r,c){var u;this.expression=e,this._warningHistory={},this._evaluator=new U1(r,c),this._defaultValue=n?"color"===(u=n).type&&(he(u.default)||Array.isArray(u.default))?new Sr(0,0,0,0):"color"===u.type?Sr.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,r,c,u,p,g,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=r,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,r,c,u,p,g,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=r||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null;try{const x=this.expression.evaluate(this._evaluator);if(null==x||"number"==typeof x&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Nr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Wr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in s2}function pr(t,e,n,r){const c=new Pn(s2,[],e?function(p){const g={color:es,string:Yi,number:qn,enum:Yi,boolean:tr,formatted:fo,resolvedImage:_a};return"array"===p.type?_r(g[p.value]||rr,p.length):g[p.type]}(e):void 0,void 0,void 0,n,r),u=c.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return u?b2(new Zr(u,e,n,r)):w1(c.errors)}class Fr{constructor(e,n,r){this.kind=e,this._styleExpression=n,this.isLightConstant=r,this.isStateDependent="constant"!==e&&!wa(n.expression),this.isConfigDependent=!qa(n.expression)}evaluateWithoutErrorHandling(e,n,r,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,c,u,p)}evaluate(e,n,r,c,u,p){return this._styleExpression.evaluate(e,n,r,c,u,p)}}class _s{constructor(e,n,r,c,u){this.kind=e,this.zoomStops=r,this._styleExpression=n,this.isStateDependent="camera"!==e&&!wa(n.expression),this.isLightConstant=u,this.isConfigDependent=!qa(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,r,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,c,u,p)}evaluate(e,n,r,c,u,p){return this._styleExpression.evaluate(e,n,r,c,u,p)}interpolationFactor(e,n,r){return this.interpolationType?mn.interpolationFactor(this.interpolationType,e,n,r):0}}function vr(t,e,n,r){if("error"===(t=pr(t,e,n,r)).result)return t;const c=t.value.expression,u=I1(c);if(!u&&!te(e))return w1([new Fs("","data expressions not supported")]);const p=vt(c,["zoom","pitch","distance-from-center"]);if(!p&&!D(e))return w1([new Fs("","zoom expressions not supported")]);const g=vt(c,["measure-light"]);if(!g&&!P(e))return w1([new Fs("","measure-light expression not supported")]);const y=e.expression&&e.expression.relaxZoomRestriction,x=da(c);return x||p||y?x instanceof Fs?w1([x]):x instanceof mn&&!q(e)?w1([new Fs("",'"interpolate" expressions cannot be used with this property')]):b2(x?new _s(u?"camera":"composite",t.value,x.labels,x instanceof mn?x.interpolation:void 0,g):new Fr(u?"constant":"source",t.value,g)):w1([new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ko{constructor(e,n){this._parameters=e,this._specification=n,sa(this,bt(this._parameters,this._specification))}static deserialize(e){return new ko(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function da(t){let e=null;if(t instanceof Zi)e=da(t.result);else if(t instanceof Bn){for(const n of t.args)if(e=da(n),e)break}else(t instanceof Da||t instanceof mn)&&t.input instanceof cr&&"zoom"===t.input.name&&(e=t);return e instanceof Fs||t.eachChild(n=>{const r=da(n);r instanceof Fs?e=r:e&&r&&e!==r&&(e=new Fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Ia=ia,Va=3;function ia(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var u=0;u<this.d*this.d;u++){var p=c[Va+u],g=c[Va+u+1];r.push(p===g?null:c.subarray(p,g))}var y=c[Va+r.length+1];this.keys=c.subarray(c[Va+r.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var x=0;x<this.d*this.d;x++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var M=n/e*t;this.min=-M,this.max=t+M}ia.prototype.insert=function(t,e,n,r,c){this._forEachCell(e,n,r,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(c)},ia.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ia.prototype._insertCell=function(t,e,n,r,c,u){this.cells[c].push(u)},ia.prototype.query=function(t,e,n,r,c){var u=this.min,p=this.max;if(t<=u&&e<=u&&p<=n&&p<=r&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,n,r,this._queryCell,g,{},c),g},ia.prototype._queryCell=function(t,e,n,r,c,u,p,g){var y=this.cells[c];if(null!==y)for(var x=this.keys,M=this.bboxes,E=0;E<y.length;E++){var A=y[E];if(void 0===p[A]){var O=4*A;(g?g(M[O+0],M[O+1],M[O+2],M[O+3]):t<=M[O+2]&&e<=M[O+3]&&n>=M[O+0]&&r>=M[O+1])?(p[A]=!0,u.push(x[A])):p[A]=!1}}},ia.prototype._forEachCell=function(t,e,n,r,c,u,p,g){for(var y=this._convertToCellCoord(t),x=this._convertToCellCoord(e),M=this._convertToCellCoord(n),E=this._convertToCellCoord(r),A=y;A<=M;A++)for(var O=x;O<=E;O++){var U=this.d*O+A;if((!g||g(this._convertFromCellCoord(A),this._convertFromCellCoord(O),this._convertFromCellCoord(A+1),this._convertFromCellCoord(O+1)))&&c.call(this,t,e,n,r,U,u,p,g))return}},ia.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ia.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ia.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Va+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var u=e,p=0;p<t.length;p++){var g=t[p];c[Va+p]=u,c.set(g,u),u+=g.length}return c[Va+t.length]=u,c.set(this.keys,u),c[Va+t.length+1]=u+=this.keys.length,c.set(this.bboxes,u),u+=this.bboxes.length,c.buffer};var jo=En(Ia);const P1={};function Xn(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),P1[e]={klass:t,omit:n.omit||[]}}Xn(Object,"Object"),jo.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},jo.deserialize=function(t){return new jo(t.buffer)},Object.defineProperty(jo,"name",{value:"Grid"}),Xn(jo,"Grid"),Xn(Sr,"Color"),Xn(Error,"Error"),Xn(Gs,"Formatted"),Xn(Vs,"FormattedSection"),Xn(ei,"AJAXError"),Xn(Qn,"ResolvedImage"),Xn(ko,"StylePropertyFunction"),Xn(Zr,"StyleExpression",{omit:["_evaluator"]}),Xn(_s,"ZoomDependentExpression"),Xn(Fr,"ZoomConstantExpression"),Xn(cr,"CompoundExpression",{omit:["_evaluate"]});for(const t in s2)P1[s2[t]._classRegistryKey]||Xn(s2[t],`Expression${t}`);function C1(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Nc(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Ts(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(C1(t)||Nc(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const r of t)n.push(Ts(r,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[r,c]of t.entries())n[r]=Ts(c);return n}if("object"==typeof t){const n=t.constructor,r=n._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const u in t)t.hasOwnProperty(u)&&(P1[r].omit.indexOf(u)>=0||(c[u]=Ts(t[u],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(c.$name=r),c}throw new Error("can't serialize object of type "+typeof t)}function Ya(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||C1(t)||Nc(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ya);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const c=new Map;for(const u of Object.keys(t))"$name"!==u&&c.set(u,Ya(t[u]));return c}const{klass:n}=P1[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const r=Object.create(n.prototype);for(const c of Object.keys(t))"$name"!==c&&(r[c]=Ya(t[c]));return r}throw new Error("can't deserialize object of type "+typeof t)}const ai={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function o2(t){for(const e of t)if(wr(e.charCodeAt(0)))return!0;return!1}function Ni(t){for(const e of t)if(!lr(e.charCodeAt(0)))return!1;return!0}function lr(t){return!(ai.Arabic(t)||ai["Arabic Supplement"](t)||ai["Arabic Extended-A"](t)||ai["Arabic Presentation Forms-A"](t)||ai["Arabic Presentation Forms-B"](t))}function wr(t){return!(746!==t&&747!==t&&(t<4352||!(ai["Bopomofo Extended"](t)||ai.Bopomofo(t)||ai["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ai["CJK Compatibility Ideographs"](t)||ai["CJK Compatibility"](t)||ai["CJK Radicals Supplement"](t)||ai["CJK Strokes"](t)||!(!ai["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||ai["CJK Unified Ideographs Extension A"](t)||ai["CJK Unified Ideographs"](t)||ai["Enclosed CJK Letters and Months"](t)||ai["Hangul Compatibility Jamo"](t)||ai["Hangul Jamo Extended-A"](t)||ai["Hangul Jamo Extended-B"](t)||ai["Hangul Jamo"](t)||ai["Hangul Syllables"](t)||ai.Hiragana(t)||ai["Ideographic Description Characters"](t)||ai.Kanbun(t)||ai["Kangxi Radicals"](t)||ai["Katakana Phonetic Extensions"](t)||ai.Katakana(t)&&12540!==t||!(!ai["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!ai["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ai["Unified Canadian Aboriginal Syllabics"](t)||ai["Unified Canadian Aboriginal Syllabics Extended"](t)||ai["Vertical Forms"](t)||ai["Yijing Hexagram Symbols"](t)||ai["Yi Syllables"](t)||ai["Yi Radicals"](t))))}function us(t){return!(wr(t)||(e=t,ai["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||ai["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||ai["Letterlike Symbols"](e)||ai["Number Forms"](e)||ai["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||ai["Control Pictures"](e)&&9251!==e||ai["Optical Character Recognition"](e)||ai["Enclosed Alphanumerics"](e)||ai["Geometric Shapes"](e)||ai["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ai["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ai["CJK Symbols and Punctuation"](e)||ai.Katakana(e)||ai["Private Use Area"](e)||ai["CJK Compatibility Forms"](e)||ai["Small Form Variants"](e)||ai["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Ao(t){return t>=1424&&t<=2303||ai["Arabic Presentation Forms-A"](t)||ai["Arabic Presentation Forms-B"](t)}function L1(t,e){return!(!e&&Ao(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ai.Khmer(t))}function f1(t){for(const e of t)if(Ao(e.charCodeAt(0)))return!0;return!1}const W1="deferred",k="loading",F="loaded";let V=null,$="unavailable",oe=null;const xe=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&($="error"),V&&V(t)};function Oe(){Ut.fire(new ds("pluginStateChange",{pluginStatus:$,pluginURL:oe}))}const Ut=new Os,zn=function(){return $},Li=function(){if($!==W1||!oe)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$=k,Oe(),oe&&Ht({url:oe},t=>{t?xe(t):($=F,Oe())})},_i={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$===F||null!=_i.applyArabicShaping,isLoading:()=>$===k,setState(t){$=t.pluginStatus,oe=t.pluginURL},isParsed:()=>null!=_i.applyArabicShaping&&null!=_i.processBidirectionalText&&null!=_i.processStyledBidirectionalText,getPluginURL:()=>oe};class or{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,r){for(const c of n)if(!L1(c.charCodeAt(0),r))return!1;return!0}(e,_i.isLoaded())}}class Go{constructor(e,n,r,c){this.property=e,this.value=n,this.expression=function(u,p,g,y){if(he(u))return new ko(u,p);if(Wr(u)||Array.isArray(u)&&u.length>0){const x=vr(u,p,g,y);if("error"===x.result)throw new Error(x.value.map(M=>`${M.key}: ${M.message}`).join(", "));return x.value}{let x=u;return"string"==typeof u&&"color"===p.type&&(x=Sr.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>x}}}(void 0===n?e.specification.default:n,e.specification,r,c)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,r){return this.property.possiblyEvaluate(this,e,n,r)}}class d1{constructor(e,n,r){this.property=e,this.value=new Go(e,void 0,n,r)}transitioned(e,n){return new N1(this.property,this.value,n,ti({},e.transition,this.transition),e.now)}untransitioned(){return new N1(this.property,this.value,null,{},0)}}class Ma{constructor(e,n,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=r,this.isConfigDependent=!1}getValue(e){return mi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new d1(this._values[e].property,this._scope,this._options)),this._values[e].value=new Go(this._values[e].property,null===n?void 0:mi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const r=this._properties.properties;if(e)for(const c in e){const u=e[c];if(Pe(c,"-transition")){const p=c.slice(0,-11);r[p]&&this.setTransition(p,u)}else r[c]&&this.setValue(c,u)}}getTransition(e){return mi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new d1(this._values[e].property)),this._values[e].transition=mi(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const r=this.getValue(n);void 0!==r&&(e[n]=r);const c=this.getTransition(n);void 0!==c&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const r=new Ha(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].transitioned(e,n._values[c]);return r}untransitioned(){const e=new Ha(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class N1{constructor(e,n,r,c,u){const p=c.delay||0,g=c.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+p,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=r)}possiblyEvaluate(e,n,r){const c=e.now||0,u=this.value.possiblyEvaluate(e,n,r),p=this.prior;if(p){if(c>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(c<this.begin)return p.possiblyEvaluate(e,n,r);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,r),u,Ze(g))}}return u}}class Ha{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,r){const c=new ec(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,n,r);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class tl{constructor(e,n,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=r,this.isConfigDependent=!1}getValue(e){return mi(this._values[e].value)}setValue(e,n){this._values[e]=new Go(this._values[e].property,null===n?void 0:mi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const r=this.getValue(n);void 0!==r&&(e[n]=r)}return e}possiblyEvaluate(e,n,r){const c=new ec(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,n,r);return c}}class N2{constructor(e,n,r){this.property=e,this.value=n,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,r,c){return this.property.evaluate(this.value,this.parameters,e,n,r,c)}}class ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class On{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,r){const c=js[this.specification.type];return c?c(e,n,r):e}}class zi{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,r,c){return new N2(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},r,c)}:e.expression,n)}interpolate(e,n,r){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new N2(this,{kind:"constant",value:void 0},e.parameters);const c=js[this.specification.type];return c?new N2(this,{kind:"constant",value:c(e.value.value,n.value.value,r)},e.parameters):e}evaluate(e,n,r,c,u,p){return"constant"===e.kind?e.value:e.evaluate(n,r,c,u,p)}}class xc{constructor(e){this.specification=e}possiblyEvaluate(e,n,r,c){return!!e.expression.evaluate(n,null,{},r,c)}interpolate(){return!1}}class Co{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new or(0,{});for(const r in e){const c=e[r];c.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new Go(c,void 0),p=this.defaultTransitionablePropertyValues[r]=new d1(c);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate(n)}}}function Il(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function k2(t){if(Array.isArray(t))return t.map(k2);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=k2(t[n]);return e}return Il(t)}Xn(zi,"DataDrivenProperty"),Xn(On,"DataConstantProperty"),Xn(xc,"ColorRampProperty");var Rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function L4(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!L4(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function u2(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};L4(t)||(t=tc(t));const n=t;let r=!0;try{r=function(x){if(!Vl(x))return x;let M=k2(x);return I4(M),M=D4(M),M}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const c=Rt[`filter_${e}`],u=pr(r,c);let p=null;if("error"===u.result)throw new Error(u.value.map(x=>`${x.key}: ${x.message}`).join(", "));p=(x,M,E)=>u.value.evaluate(x,M,{},E);let g=null,y=null;if(r!==n){const x=pr(n,c);if("error"===x.result)throw new Error(x.value.map(M=>`${M.key}: ${M.message}`).join(", "));g=(M,E,A,O,U)=>x.value.evaluate(M,E,{},A,void 0,void 0,O,U),y=!I1(x.value.expression)}return{filter:p,dynamicFilter:g||void 0,needGeometry:du(r),needFeature:!!y}}function D4(t){if(!Array.isArray(t))return t;const e=function(n){if(N6.has(n[0]))for(let r=1;r<n.length;r++)if(Vl(n[r]))return!0;return n}(t);return!0===e?e:e.map(n=>D4(n))}function I4(t){let e=!1;const n=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||Vl(t[r]),n.push(t[r+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||Vl(t[1]);for(let r=2;r<t.length-1;r+=2)n.push(t[r+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||Vl(t[1]);for(let r=1;r<t.length-1;r+=2)n.push(t[r+1])}e&&(t.length=0,t.push("any",...n));for(let r=1;r<t.length;r++)I4(t[r])}function Vl(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(Vl(t[n]))return!0;return!1}const N6=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fu(t,e){return t<e?-1:t>e?1:0}function du(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(du(t[e]))return!0;return!1}function tc(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?nl(t[1],t[2],"=="):"!="===e?D3(nl(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?nl(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(tc))):"all"===e?["all"].concat(t.slice(1).map(tc)):"none"===e?["all"].concat(t.slice(1).map(tc).map(D3)):"in"===e?V4(t[1],t.slice(2)):"!in"===e?D3(V4(t[1],t.slice(2))):"has"===e?H4(t[1]):"!has"!==e||D3(H4(t[1]));var n}function nl(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function V4(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(fu)]]:["filter-in-small",t,["literal",e]]}}function H4(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function D3(t){return["!",t]}const Hl="\x1f";function Pl(t,e){return e?`${t}${Hl}${e}`:t}const Nl="-transition";class q1 extends Os{constructor(e,n,r,c){if(super(),this.id=e.id,this.fqid=Pl(this.id,r),this.type=e.type,this.scope=r,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new tl(n.layout,this.scope,c),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Ma(n.paint,this.scope,c);for(const u in e.paint)this.setPaintProperty(u,e.paint[u]);for(const u in e.layout)this.setLayoutProperty(u,e.layout[u]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ec(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if("custom"===this.type&&"visibility"===e)return void(this.visibility=n);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,n),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Pe(e,Nl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const r=this._transitionablePaint,c=r._properties.properties;if(Pe(e,Nl)){const E=e.slice(0,-11);return c[E]&&r.setTransition(E,n||void 0),!1}if(!c[e])return!1;const u=r._values[e],p=u.value.isDataDriven(),g=u.value;r.setValue(e,n),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const y=r._values[e].value,x=y.isDataDriven(),M=Pe(e,"pattern")||"line-dasharray"===e;return x||p||M||this._handleOverridablePaintPropertyUpdate(e,g,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Bt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(void 0===e||"layout"===n&&!Object.keys(e).length||"paint"===n&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof N2&&te(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=u2(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const P4={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class I3{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class go{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function cs(t,e=1){let n=0,r=0;return{members:t.map(c=>{const u=P4[c.type].BYTES_PER_ELEMENT,p=n=kl(n,Math.max(e,u)),g=c.components||1;return r=Math.max(r,u),n+=u*g,{name:c.name,type:c.type,components:g,offset:p}}),size:kl(n,Math.max(r,e)),alignment:e}}function kl(t,e){return Math.ceil(t/e)*e}class R2 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=r,e}}R2.prototype.bytesPerElement=4,Xn(R2,"StructArrayLayout2i4");class Z1 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,r)}emplace(e,n,r,c){const u=3*e;return this.int16[u+0]=n,this.int16[u+1]=r,this.int16[u+2]=c,e}}Z1.prototype.bytesPerElement=6,Xn(Z1,"StructArrayLayout3i6");class bc extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,c)}emplace(e,n,r,c,u){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=r,this.int16[p+2]=c,this.int16[p+3]=u,e}}bc.prototype.bytesPerElement=8,Xn(bc,"StructArrayLayout4i8");class pu extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,r,c,u)}emplace(e,n,r,c,u,p){const g=5*e;return this.int16[g+0]=n,this.int16[g+1]=r,this.int16[g+2]=c,this.int16[g+3]=u,this.int16[g+4]=p,e}}pu.prototype.bytesPerElement=10,Xn(pu,"StructArrayLayout5i10");class N4 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,r,c,u,p,g)}emplace(e,n,r,c,u,p,g,y){const x=6*e,M=12*e,E=3*e;return this.int16[x+0]=n,this.int16[x+1]=r,this.uint8[M+4]=c,this.uint8[M+5]=u,this.uint8[M+6]=p,this.uint8[M+7]=g,this.float32[E+2]=y,e}}N4.prototype.bytesPerElement=12,Xn(N4,"StructArrayLayout2i4ub1f12");class O2 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,c)}emplace(e,n,r,c,u){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=r,this.float32[p+2]=c,this.float32[p+3]=u,e}}O2.prototype.bytesPerElement=16,Xn(O2,"StructArrayLayout4f16");class F2 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,r,c,u)}emplace(e,n,r,c,u,p){const g=6*e,y=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=r,this.uint16[g+2]=c,this.uint16[g+3]=u,this.float32[y+2]=p,e}}F2.prototype.bytesPerElement=12,Xn(F2,"StructArrayLayout4ui1f12");class kc extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,c)}emplace(e,n,r,c,u){const p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=r,this.uint16[p+2]=c,this.uint16[p+3]=u,e}}kc.prototype.bytesPerElement=8,Xn(kc,"StructArrayLayout4ui8");class il extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,r,c,u,p)}emplace(e,n,r,c,u,p,g){const y=6*e;return this.int16[y+0]=n,this.int16[y+1]=r,this.int16[y+2]=c,this.int16[y+3]=u,this.int16[y+4]=p,this.int16[y+5]=g,e}}il.prototype.bytesPerElement=12,Xn(il,"StructArrayLayout6i12");class rl extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g,y,x,M,E,A){const O=this.length;return this.resize(O+1),this.emplace(O,e,n,r,c,u,p,g,y,x,M,E,A)}emplace(e,n,r,c,u,p,g,y,x,M,E,A,O){const U=12*e;return this.int16[U+0]=n,this.int16[U+1]=r,this.int16[U+2]=c,this.int16[U+3]=u,this.uint16[U+4]=p,this.uint16[U+5]=g,this.uint16[U+6]=y,this.uint16[U+7]=x,this.int16[U+8]=M,this.int16[U+9]=E,this.int16[U+10]=A,this.int16[U+11]=O,e}}rl.prototype.bytesPerElement=24,Xn(rl,"StructArrayLayout4i4ui4i24");class h2 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,r,c,u,p)}emplace(e,n,r,c,u,p,g){const y=10*e,x=5*e;return this.int16[y+0]=n,this.int16[y+1]=r,this.int16[y+2]=c,this.float32[x+2]=u,this.float32[x+3]=p,this.float32[x+4]=g,e}}h2.prototype.bytesPerElement=20,Xn(h2,"StructArrayLayout3i3f20");class k4 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}k4.prototype.bytesPerElement=4,Xn(k4,"StructArrayLayout1ul4");class B2 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=r,e}}B2.prototype.bytesPerElement=4,Xn(B2,"StructArrayLayout2ui4");class R4 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g,y,x,M,E,A,O){const U=this.length;return this.resize(U+1),this.emplace(U,e,n,r,c,u,p,g,y,x,M,E,A,O)}emplace(e,n,r,c,u,p,g,y,x,M,E,A,O,U){const W=20*e,ee=10*e;return this.int16[W+0]=n,this.int16[W+1]=r,this.int16[W+2]=c,this.int16[W+3]=u,this.int16[W+4]=p,this.float32[ee+3]=g,this.float32[ee+4]=y,this.float32[ee+5]=x,this.float32[ee+6]=M,this.int16[W+14]=E,this.uint32[ee+8]=A,this.uint16[W+18]=O,this.uint16[W+19]=U,e}}R4.prototype.bytesPerElement=40,Xn(R4,"StructArrayLayout5i4f1i1ul2ui40");class sl extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,r,c,u,p,g)}emplace(e,n,r,c,u,p,g,y){const x=8*e;return this.int16[x+0]=n,this.int16[x+1]=r,this.int16[x+2]=c,this.int16[x+4]=u,this.int16[x+5]=p,this.int16[x+6]=g,this.int16[x+7]=y,e}}sl.prototype.bytesPerElement=16,Xn(sl,"StructArrayLayout3i2i2i16");class ol extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,r,c,u)}emplace(e,n,r,c,u,p){const g=4*e,y=8*e;return this.float32[g+0]=n,this.float32[g+1]=r,this.float32[g+2]=c,this.int16[y+6]=u,this.int16[y+7]=p,e}}ol.prototype.bytesPerElement=16,Xn(ol,"StructArrayLayout2f1f2i16");class O4 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,c)}emplace(e,n,r,c,u){const p=12*e,g=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=r,this.float32[g+1]=c,this.float32[g+2]=u,e}}O4.prototype.bytesPerElement=12,Xn(O4,"StructArrayLayout2ub2f12");class Pa extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,r)}emplace(e,n,r,c){const u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=r,this.uint16[u+2]=c,e}}Pa.prototype.bytesPerElement=6,Xn(Pa,"StructArrayLayout3ui6");class al extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae,be,Ee,Me,We){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae,be,Ee,Me,We)}emplace(e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae,be,Ee,Me,We,Re){const et=30*e,mt=15*e,Dt=60*e;return this.int16[et+0]=n,this.int16[et+1]=r,this.int16[et+2]=c,this.float32[mt+2]=u,this.float32[mt+3]=p,this.uint16[et+8]=g,this.uint16[et+9]=y,this.uint32[mt+5]=x,this.uint32[mt+6]=M,this.uint32[mt+7]=E,this.uint16[et+16]=A,this.uint16[et+17]=O,this.uint16[et+18]=U,this.float32[mt+10]=W,this.float32[mt+11]=ee,this.uint8[Dt+48]=ae,this.uint8[Dt+49]=be,this.uint8[Dt+50]=Ee,this.uint32[mt+13]=Me,this.int16[et+28]=We,this.uint8[Dt+58]=Re,e}}al.prototype.bytesPerElement=60,Xn(al,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Rl extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae,be,Ee,Me,We,Re,et,mt,Dt,Wt,Vt,un,yn,tn,gn,Kt){const pn=this.length;return this.resize(pn+1),this.emplace(pn,e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae,be,Ee,Me,We,Re,et,mt,Dt,Wt,Vt,un,yn,tn,gn,Kt)}emplace(e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae,be,Ee,Me,We,Re,et,mt,Dt,Wt,Vt,un,yn,tn,gn,Kt,pn){const Gn=20*e,wn=40*e,pi=80*e;return this.float32[Gn+0]=n,this.float32[Gn+1]=r,this.int16[wn+4]=c,this.int16[wn+5]=u,this.int16[wn+6]=p,this.int16[wn+7]=g,this.int16[wn+8]=y,this.int16[wn+9]=x,this.int16[wn+10]=M,this.int16[wn+11]=E,this.int16[wn+12]=A,this.uint16[wn+13]=O,this.uint16[wn+14]=U,this.uint16[wn+15]=W,this.uint16[wn+16]=ee,this.uint16[wn+17]=ae,this.uint16[wn+18]=be,this.uint16[wn+19]=Ee,this.uint16[wn+20]=Me,this.uint16[wn+21]=We,this.uint16[wn+22]=Re,this.uint16[wn+23]=et,this.uint16[wn+24]=mt,this.uint16[wn+25]=Dt,this.uint16[wn+26]=Wt,this.uint16[wn+27]=Vt,this.uint32[Gn+14]=un,this.float32[Gn+15]=yn,this.float32[Gn+16]=tn,this.float32[Gn+17]=gn,this.float32[Gn+18]=Kt,this.uint8[pi+76]=pn,e}}Rl.prototype.bytesPerElement=80,Xn(Rl,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ol extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Ol.prototype.bytesPerElement=4,Xn(Ol,"StructArrayLayout1f4");class wc extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,r,c,u)}emplace(e,n,r,c,u,p){const g=5*e;return this.float32[g+0]=n,this.float32[g+1]=r,this.float32[g+2]=c,this.float32[g+3]=u,this.float32[g+4]=p,e}}wc.prototype.bytesPerElement=20,Xn(wc,"StructArrayLayout5f20");class D1 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,r,c,u,p,g)}emplace(e,n,r,c,u,p,g,y){const x=7*e;return this.float32[x+0]=n,this.float32[x+1]=r,this.float32[x+2]=c,this.float32[x+3]=u,this.float32[x+4]=p,this.float32[x+5]=g,this.float32[x+6]=y,e}}D1.prototype.bytesPerElement=28,Xn(D1,"StructArrayLayout7f28");class Cc extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,r,c)}emplace(e,n,r,c,u){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=r,this.uint16[p+3]=c,this.uint16[p+4]=u,e}}Cc.prototype.bytesPerElement=12,Xn(Cc,"StructArrayLayout1ul3ui12");class V3 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}V3.prototype.bytesPerElement=2,Xn(V3,"StructArrayLayout1ui2");class nc extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,r)}emplace(e,n,r,c){const u=3*e;return this.float32[u+0]=n,this.float32[u+1]=r,this.float32[u+2]=c,e}}nc.prototype.bytesPerElement=12,Xn(nc,"StructArrayLayout3f12");class Na extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=r,e}}Na.prototype.bytesPerElement=8,Xn(Na,"StructArrayLayout2f8");class Mc extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee)}emplace(e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae){const be=16*e;return this.float32[be+0]=n,this.float32[be+1]=r,this.float32[be+2]=c,this.float32[be+3]=u,this.float32[be+4]=p,this.float32[be+5]=g,this.float32[be+6]=y,this.float32[be+7]=x,this.float32[be+8]=M,this.float32[be+9]=E,this.float32[be+10]=A,this.float32[be+11]=O,this.float32[be+12]=U,this.float32[be+13]=W,this.float32[be+14]=ee,this.float32[be+15]=ae,e}}Mc.prototype.bytesPerElement=64,Xn(Mc,"StructArrayLayout16f64");class cl extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,u,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,r,c,u,p,g)}emplace(e,n,r,c,u,p,g,y){const x=10*e,M=5*e;return this.uint16[x+0]=n,this.uint16[x+1]=r,this.uint16[x+2]=c,this.uint16[x+3]=u,this.float32[M+2]=p,this.float32[M+3]=g,this.float32[M+4]=y,e}}cl.prototype.bytesPerElement=20,Xn(cl,"StructArrayLayout4ui3f20");class H3 extends go{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}H3.prototype.bytesPerElement=1,Xn(H3,"StructArrayLayout1ub1");class F4 extends I3{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}F4.prototype.size=40;class B4 extends R4{get(e){return new F4(this,e)}}Xn(B4,"CollisionBoxArray");class mu extends I3{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}mu.prototype.size=60;class U4 extends al{get(e){return new mu(this,e)}}Xn(U4,"PlacedSymbolArray");class gu extends I3{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}gu.prototype.size=80;class j4 extends Rl{get(e){return new gu(this,e)}}Xn(j4,"SymbolInstanceArray");class _u extends Ol{getoffsetX(e){return this.float32[1*e+0]}}Xn(_u,"GlyphOffsetArray");class ll extends R2{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Xn(ll,"SymbolLineVertexArray");class P3 extends I3{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}P3.prototype.size=12;class Fl extends Cc{get(e){return new P3(this,e)}}Xn(Fl,"FeatureIndexArray");class Bl extends B2{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Xn(Bl,"FillExtrusionCentroidArray");const Ul=cs([{name:"a_pos",components:2,type:"Int16"}],4),G4=cs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ro{constructor(e=[]){this.segments=e}_prepareSegment(e,n,r,c){let u=this.segments[this.segments.length-1];return e>Ro.MAX_VERTEX_ARRAY_LENGTH&&Ii(`Max vertices per segment is ${Ro.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Ro.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==c)&&(u={vertexOffset:n,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==c&&(u.sortKey=c),this.segments.push(u)),u}prepareSegment(e,n,r,c){return this._prepareSegment(e,n.length,r.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,r,c){return new Ro([{vertexOffset:e,primitiveOffset:n,vertexLength:r,primitiveLength:c,vaos:{},sortKey:0}])}}function ul(t,e){return 256*(t=Ot(Math.floor(t),0,255))+Ot(Math.floor(e),0,255)}Ro.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xn(Ro,"SegmentVector");const N3=cs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),k3=cs([{name:"a_dash",components:4,type:"Uint16"}]);var U2={exports:{}},R3={exports:function(e,n){var r,c,u,p,g,y,x,M;for(c=e.length-(r=3&e.length),u=n,g=3432918353,y=461845907,M=0;M<c;)x=255&e.charCodeAt(M)|(255&e.charCodeAt(++M))<<8|(255&e.charCodeAt(++M))<<16|(255&e.charCodeAt(++M))<<24,++M,u=27492+(65535&(p=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&e.charCodeAt(M+2))<<16;case 2:x^=(255&e.charCodeAt(M+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(M)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}.exports,vu={exports:{}};vu.exports=function(e,n){for(var r,c=e.length,u=n^c,p=0;c>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var O3=R3,yu=vu.exports;U2.exports=O3,U2.exports.murmur3=O3,U2.exports.murmur2=yu;var $4=En(U2.exports);class jl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,r,c){this.ids.push(xu(e)),this.positions.push(n,r,c)}eachPosition(e,n){const r=xu(e);let c=0,u=this.ids.length-1;for(;c<u;){const p=c+u>>1;this.ids[p]>=r?u=p:c=p+1}for(;this.ids[c]===r;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){const r=new Float64Array(e.ids),c=new Uint32Array(e.positions);return W4(r,c,0,r.length-1),n&&(n.add(r.buffer),n.add(c.buffer)),{ids:r,positions:c}}static deserialize(e){const n=new jl;let r;n.ids=e.ids,n.positions=e.positions;for(const c of n.ids)c!==r&&n.uniqueIds.push(c),r=c;return n.indexed=!0,n}}function xu(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:$4(String(t))}function W4(t,e,n,r){for(;n<r;){const c=t[n+r>>1];let u=n-1,p=r+1;for(;;){do{u++}while(t[u]<c);do{p--}while(t[p]>c);if(u>=p)break;Gl(t,u,p),Gl(e,3*u,3*p),Gl(e,3*u+1,3*p+1),Gl(e,3*u+2,3*p+2)}p-n<r-p?(W4(t,e,n,p),n=p+1):(W4(t,e,p+1,r),r=p)}}function Gl(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}Xn(jl,"FeaturePositionMap");class j2{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Rc extends j2{constructor(e){super(e),this.current=0}set(e,n,r){this.fetchUniformLocation(e,n)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class M1 extends j2{constructor(e){super(e),this.current=0}set(e,n,r){this.fetchUniformLocation(e,n)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class w2 extends j2{constructor(e){super(e),this.current=[0,0]}set(e,n,r){this.fetchUniformLocation(e,n)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class bu extends j2{constructor(e){super(e),this.current=[0,0,0]}set(e,n,r){this.fetchUniformLocation(e,n)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class h extends j2{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,r){this.fetchUniformLocation(e,n)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class i extends j2{constructor(e){super(e),this.current=Sr.transparent}set(e,n,r){this.fetchUniformLocation(e,n)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const o=new Float32Array(16);class d extends j2{constructor(e){super(e),this.current=o}set(e,n,r){if(this.fetchUniformLocation(e,n)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let c=1;c<16;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const m=new Float32Array(9),v=new Float32Array(4);class b extends j2{constructor(e){super(e),this.current=v}set(e,n,r){if(this.fetchUniformLocation(e,n))for(let c=0;c<4;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function S(t){return[ul(255*t.r,255*t.g),ul(255*t.b,255*t.a)]}class z{constructor(e,n,r){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=r}setUniform(e,n,r,c,u){n.set(e,u,c.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new i(e):new M1(e)}}class H{constructor(e,n){this.uniformNames=n.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,r,c,u){const p="u_pattern"===u||"u_dash"===u?this.pattern:"u_pixel_ratio"===u?this.pixelRatio:null;p&&n.set(e,u,p)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new h(e):new M1(e)}}class R{constructor(e,n,r,c){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,r,c,u,p,g){const y=this.paintVertexArray.length,x=this.expression.evaluate(new or(0,{brightness:p}),n,{},u,c,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,n,r,c,u,p,g){const y=this.expression.evaluate({zoom:0,brightness:g},r,c,void 0,u);this._setPaintValue(e,n,y)}_setPaintValue(e,n,r){if("color"===this.type){const c=S(r);for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class B{constructor(e,n,r,c,u,p){this.expression=e,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=r,this.useIntegerZoom=c,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,r,c,u,p,g){const y=this.expression.evaluate(new or(this.zoom,{brightness:p}),n,{},u,c,g),x=this.expression.evaluate(new or(this.zoom+1,{brightness:p}),n,{},u,c,g),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,x)}updatePaintArray(e,n,r,c,u,p,g){const y=this.expression.evaluate({zoom:this.zoom,brightness:g},r,c,void 0,u),x=this.expression.evaluate({zoom:this.zoom+1,brightness:g},r,c,void 0,u);this._setPaintValue(e,n,y,x)}_setPaintValue(e,n,r,c){if("color"===this.type){const u=S(r),p=S(c);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,u[0],u[1],p[0],p[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,r,c);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,r,c,u){const p=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,g=Ot(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(e,u,g)}getBinding(e,n){return new M1(e)}}class Y{constructor(e,n,r,c,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=("array"===r?k3:N3).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new c}populatePaintArray(e,n,r){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],r)}updatePaintArray(e,n,r,c,u,p,g){this._setPaintValues(e,n,r.patterns&&r.patterns[this.layerId],p)}_setPaintValues(e,n,r,c){if(!c||!r)return;const u=c[r];if(!u)return;const{tl:p,br:g,pixelRatio:y}=u;for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,p[0],p[1],g[0],g[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Q{constructor(e,n,r=(()=>!0)){this.binders={},this._buffers=[];const c=[];for(const u in e.paint._values){const p=e.paint.get(u);if(!r(u)||!(p instanceof N2&&te(p.property.specification)))continue;const g=pe(u,e.type),y=p.value,x=p.property.specification.type,M=!!p.property.useIntegerZoom,E="line-dasharray"===u||u.endsWith("pattern"),A="line-dasharray"===u&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==y.kind||A)if("source"===y.kind||A||E){const O=Le(u,x,"source");this.binders[u]=E?new Y(y,g,x,O,e.id):new R(y,g,x,O),c.push(`/a_${u}`)}else{const O=Le(u,x,"composite");this.binders[u]=new B(y,g,x,M,n,O),c.push(`/z_${u}`)}else this.binders[u]=E?new H(y.value,g):new z(y.value,g,x),c.push(`/u_${u}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof R||n instanceof B?n.maxValue:0}populatePaintArrays(e,n,r,c,u,p,g){for(const y in this.binders){const x=this.binders[y];(x instanceof R||x instanceof B||x instanceof Y)&&x.populatePaintArray(e,n,r,c,u,p,g)}}setConstantPatternPositions(e){for(const n in this.binders){const r=this.binders[n];r instanceof H&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,n,r,c,u,p,g,y){let x=!1;const M=Object.keys(e),E=0!==M.length,A=E?M:n.uniqueIds;for(const O in this.binders){const U=this.binders[O];if((U instanceof R||U instanceof B||U instanceof Y)&&(!0===U.expression.isStateDependent||!1===U.expression.isLightConstant)){const W=u.paint.get(O);U.expression=W.value;for(const ee of A){const ae=e[ee.toString()];n.eachPosition(ee,(be,Ee,Me)=>{const We=c.feature(be);U.updatePaintArray(Ee,Me,We,ae,p,g,y)})}if(!E)for(const ee of r.uniqueIds){const ae=e[ee.toString()];r.eachPosition(ee,(be,Ee,Me)=>{const We=c.feature(be);U.updatePaintArray(Ee,Me,We,ae,p,g,y)})}x=!0}}return x}defines(){const e=[];for(const n in this.binders){const r=this.binders[n];(r instanceof z||r instanceof H)&&e.push(...r.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof R||r instanceof B||r instanceof Y)for(let c=0;c<r.paintVertexAttributes.length;c++)e.push(r.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof z||r instanceof H||r instanceof B)for(const c of r.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof z||c instanceof H||c instanceof B)for(const u of c.uniformNames)n.push({name:u,property:r,binding:c.getBinding(e,u)})}return n}setUniforms(e,n,r,c,u){for(const{name:p,property:g,binding:y}of r)this.binders[g].setUniform(e,y,u,c.get(g),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof R||n instanceof B||n instanceof Y)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const r=this.binders[n];(r instanceof R||r instanceof B||r instanceof Y)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof R||n instanceof B||n instanceof Y)&&n.destroy()}}}class le{constructor(e,n,r=(()=>!0)){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Q(c,n,r);this.needsUpload=!1,this._featureMap=new jl,this._featureMapWithoutIds=new jl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,r,c,u,p,g,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,c,u,p,g,y);void 0!==n.id?this._featureMap.add(n.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,r,c,u,p){for(const g of r)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,g,c,u,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ce={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function pe(t,e){return ce[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const re={"line-pattern":{source:F2,composite:F2},"fill-pattern":{source:F2,composite:F2},"fill-extrusion-pattern":{source:F2,composite:F2},"line-dasharray":{source:kc,composite:kc}},ve={color:{source:Na,composite:O2},number:{source:Ol,composite:Na}};function Le(t,e,n){const r=re[t];return r&&r[n]||ve[e][n]}Xn(z,"ConstantBinder"),Xn(H,"PatternConstantBinder"),Xn(R,"SourceExpressionBinder"),Xn(Y,"PatternCompositeBinder"),Xn(B,"CompositeExpressionBinder"),Xn(Q,"ProgramConfiguration",{omit:["_buffers"]}),Xn(le,"ProgramConfigurationSet");const Ce=Rn/Math.PI/2,ze=5,ge=6,Ie=16383,nt=[64,32,16],dt=-Ce,$t=Ce;function Ct(t,e,n,r=Ce){return n=Ye(n),[t*Math.sin(n)*r,-e*r,t*Math.cos(n)*r]}function en(t,e,n){return Ct(Math.cos(Ye(t)),Math.sin(Ye(t)),e,n)}const Jt=6371008.8,xn=2*Math.PI*Jt;class Lt{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Lt(Mi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,r=this.lat*n,c=e.lat*n,u=Math.sin(r)*Math.sin(c)+Math.cos(r)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Jt*Math.acos(Math.min(u,1))}toBounds(e=0){const n=360*e/40075017,r=n/Math.cos(Math.PI/180*this.lat);return new Zt({lng:this.lng-r,lat:this.lat-n},{lng:this.lng+r,lat:this.lat+n})}toEcef(e){return en(this.lat,this.lng,Ce+e*Ce/Jt)}static convert(e){if(e instanceof Lt)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Lt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Lt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Zt{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Lt?new Lt(e.lng,e.lat):Lt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Lt?new Lt(e.lng,e.lat):Lt.convert(e),this}extend(e){const n=this._sw,r=this._ne;let c,u;if(e instanceof Lt)c=e,u=e;else{if(!(e instanceof Zt))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Zt.convert(e)):this.extend(Lt.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Lt.convert(e)):this;if(c=e._sw,u=e._ne,!c||!u)return this}return n||r?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),r.lng=Math.max(u.lng,r.lng),r.lat=Math.max(u.lat,r.lat)):(this._sw=new Lt(c.lng,c.lat),this._ne=new Lt(u.lng,u.lat)),this}getCenter(){return new Lt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Lt(this.getWest(),this.getNorth())}getSouthEast(){return new Lt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:r}=Lt.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&c}static convert(e){return!e||e instanceof Zt?e:new Zt(e)}}var ut={};!function(n){function r(u,p,g){var y=c(256*u,256*(p=Math.pow(2,g)-p-1),g),x=c(256*(u+1),256*(p+1),g);return y[0]+","+y[1]+","+x[0]+","+x[1]}function c(u,p,g){var y=2*Math.PI*6378137/256/Math.pow(2,g);return[u*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}n.getURL=function(u,p,g,y,x,M){return M=M||{},u+"?"+["bbox="+r(g,y,x),"format="+(M.format||"image/png"),"service="+(M.service||"WMS"),"version="+(M.version||"1.1.1"),"request="+(M.request||"GetMap"),"srs="+(M.srs||"EPSG:3857"),"width="+(M.width||256),"height="+(M.height||256),"layers="+p].join("&")},n.getTileBBox=r,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})}(ut);var Nt=ut;class Cn{constructor(e,n,r){this.z=e,this.x=n,this.y=r,this.key=Yn(0,e,e,n,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const r=Nt.getTileBBox(this.x,this.y,this.z),c=function(u,p,g){let y,x="";for(let M=u;M>0;M--)y=1<<M-1,x+=(p&y?1:0)+(g&y?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Un{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Yn(e,n.z,n.z,n.x,n.y)}}class kn{constructor(e,n,r,c,u){this.overscaledZ=e,this.wrap=n,this.canonical=new Cn(r,+c,+u),this.key=0===n&&e===r?this.canonical.key:Yn(n,e,r,c,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new kn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new kn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Yn(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Yn(this.wrap*+n,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new kn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,r=2*this.canonical.x,c=2*this.canonical.y;return[new kn(n,this.wrap,n,r,c),new kn(n,this.wrap,n,r+1,c),new kn(n,this.wrap,n,r,c+1),new kn(n,this.wrap,n,r+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new kn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new kn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Un(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yn(t,e,n,r,c){const u=1<<Math.min(n,22);let p=u*(c%u)+r%u;return t&&n<22&&(p+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}const di=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new kn(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new kn(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new kn(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new kn(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Xn(Cn,"CanonicalTileID"),Xn(kn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ai=0,xi=25.5;function bi(t){return xn*Math.cos(t*Math.PI/180)}function ur(t){return(180+t)/360}function ar(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function yr(t,e){return t/bi(e)}function mr(t){return 360*t-180}function Yr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Is(t,e){return t*bi(Yr(e))}const xr=85.051129;function Us(t){return Math.cos(Ye(Ot(t,-xr,xr)))}function kr(t,e){const n=Ot(e,Ai,xi),r=Math.pow(2,n);return Us(t)*xn/(512*r)}function ts(t){return 1/Math.cos(t*Math.PI/180)}function Rr(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/Rn)/(1<<t.z)*2));return 80150034*n/(n*n+1)/Rn/(1<<t.z)}class Jr{constructor(e,n,r=0){this.x=+e,this.y=+n,this.z=+r}static fromLngLat(e,n=0){const r=Lt.convert(e);return new Jr(ur(r.lng),ar(r.lat),yr(n,r.lat))}toLngLat(){return new Lt(mr(this.x),Yr(this.y))}toAltitude(){return Is(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xn*ts(Yr(this.y))}}function Ys(t,e,n,r,c,u,p,g,y){const x=(e+r)/2,M=(n+c)/2,E=new Te(x,M);g(E),function(A,O,U,W,ee,ae){const be=U-ee,Ee=W-ae;return Math.abs((W-O)*be-(U-A)*Ee)/Math.hypot(be,Ee)}(E.x,E.y,u.x,u.y,p.x,p.y)>=y?(Ys(t,e,n,x,M,u,E,g,y),Ys(t,x,M,r,c,E,p,g,y)):t.push(p)}function ss(t,e,n){let r=t[0],c=r.x,u=r.y;e(r);const p=[r];for(let g=1;g<t.length;g++){const y=t[g],{x,y:M}=y;e(y),Ys(p,c,u,x,M,r,y,e,n),c=x,u=M,r=y}return p}function pa(t,e,n,r){if(r(e,n)){const c=e.add(n)._mult(.5);pa(t,e,c,r),pa(t,c,n,r)}else t.push(n)}function p1(t,e){let n=t[0];const r=[n];for(let c=1;c<t.length;c++){const u=t[c];pa(r,n,u,e),n=u}return r}const k1=Math.pow(2,14)-1,G2=-k1-1;function Y1(t,e){const n=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=Ot(n,G2,k1),t.y=Ot(r,G2,k1),(n<t.x||n>t.x+1||r<t.y||r>t.y+1)&&Ii("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ra(t,e,n){const r=t.loadGeometry(),c=t.extent,u=Rn/c;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:g,x:y,y:x,projection:M}=n,E=A=>{const O=mr((e.x+A.x/c)/p),U=Yr((e.y+A.y/c)/p),W=M.project(O,U);A.x=(W.x*g-y)*c,A.y=(W.y*g-x)*c};for(let A=0;A<r.length;A++)if(1!==t.type)r[A]=ss(r[A],E,1);else{const O=[];for(const U of r[A])U.x<0||U.x>=c||U.y<0||U.y>=c||(E(U),O.push(U));r[A]=O}}for(const p of r)for(const g of p)Y1(g,u);return r}function no(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ra(t):[]}}function ka(t,e,n,r,c){t.emplaceBack(2*e+(r+1)/2,2*n+(c+1)/2)}function m1(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class R1{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new R2,this.indexArray=new Pa,this.segments=new Ro,this.programConfigurations=new le(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,r,c){const u=this.layers[0],p=[];let g=null;"circle"===u.type&&(g=u.layout.get("circle-sort-key"));for(const{feature:x,id:M,index:E,sourceLayerIndex:A}of e){const O=this.layers[0]._featureFilter.needGeometry,U=no(x,O);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),U,r))continue;const W=g?g.evaluate(U,{},r):void 0,ee={id:M,properties:x.properties,type:x.type,sourceLayerIndex:A,index:E,geometry:O?U.geometry:ra(x,r,c),patterns:{},sortKey:W};p.push(ee)}g&&p.sort((x,M)=>x.sortKey-M.sortKey);let y=null;"globe"===c.projection.name&&(this.globeExtVertexArray=new il,y=c.projection);for(const x of p){const{geometry:M,index:E,sourceLayerIndex:A}=x,O=e[E].feature;this.addFeature(x,M,E,n.availableImages,r,y,n.brightness),n.featureIndex.insert(O,M,E,A,this.index)}}update(e,n,r,c,u){const p=0!==Object.keys(e).length;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,r,c,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ul.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,G4.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,r,c,u,p,g){for(const y of n)for(const x of y){const M=x.x,E=x.y;if(M<0||M>=Rn||E<0||E>=Rn)continue;if(p){const U=p.projectTilePoint(M,E,u),W=p.upVector(u,M,E),ee=this.globeExtVertexArray;m1(ee,U,W),m1(ee,U,W),m1(ee,U,W),m1(ee,U,W)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),O=A.vertexLength;ka(this.layoutVertexArray,M,E,-1,-1),ka(this.layoutVertexArray,M,E,1,-1),ka(this.layoutVertexArray,M,E,1,1),ka(this.layoutVertexArray,M,E,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},c,u,g)}}function C2(t,e){for(let n=0;n<t.length;n++)if(ic(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(ic(t,e[n]))return!0;return!!Tc(t,e)}function Sc(t,e,n){return!!ic(t,e)||!!B3(e,t,n)}function fl(t,e){if(1===t.length)return ql(e,t[0]);for(let n=0;n<e.length;n++){const r=e[n];for(let c=0;c<r.length;c++)if(ic(t,r[c]))return!0}for(let n=0;n<t.length;n++)if(ql(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Tc(t,e[n]))return!0;return!1}function F3(t,e,n){if(t.length>1){if(Tc(t,e))return!0;for(let r=0;r<e.length;r++)if(B3(e[r],t,n))return!0}for(let r=0;r<t.length;r++)if(B3(t[r],e,n))return!0;return!1}function Tc(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const r=t[n],c=t[n+1];for(let u=0;u<e.length-1;u++)if($l(r,c,e[u],e[u+1]))return!0}return!1}function $l(t,e,n,r){return Gi(t,n,r)!==Gi(e,n,r)&&Gi(t,e,n)!==Gi(t,e,r)}function B3(t,e,n){const r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(let c=1;c<e.length;c++)if(Wl(t,e[c-1],e[c])<r)return!0;return!1}function Wl(t,e,n){const r=e.distSqr(n);if(0===r)return t.distSqr(e);const c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function ql(t,e){let n,r,c,u=!1;for(let p=0;p<t.length;p++){n=t[p];for(let g=0,y=n.length-1;g<n.length;y=g++)r=n[g],c=n[y],r.y>e.y!=c.y>e.y&&e.x<(c.x-r.x)*(e.y-r.y)/(c.y-r.y)+r.x&&(u=!u)}return u}function ic(t,e){let n=!1;for(let r=0,c=t.length-1;r<t.length;c=r++){const u=t[r],p=t[c];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(n=!n)}return n}function td(t,e,n,r,c){for(const p of t)if(e<=p.x&&n<=p.y&&r>=p.x&&c>=p.y)return!0;const u=[new Te(e,n),new Te(e,c),new Te(r,c),new Te(r,n)];if(t.length>2)for(const p of u)if(ic(t,p))return!0;for(let p=0;p<t.length-1;p++)if(Ep(t[p],t[p+1],u))return!0;return!1}function Ep(t,e,n){const r=n[0],c=n[2];if(t.x<r.x&&e.x<r.x||t.x>c.x&&e.x>c.x||t.y<r.y&&e.y<r.y||t.y>c.y&&e.y>c.y)return!1;const u=Gi(t,e,n[0]);return u!==Gi(t,e,n[1])||u!==Gi(t,e,n[2])||u!==Gi(t,e,n[3])}function U3(t,e,n,r,c,u){let p=e.y-t.y,g=t.x-e.x;if(u=u||0){const y=p*p+g*g;if(0===y)return!0;const x=Math.sqrt(y);p/=x,g/=x}return!((n.x-t.x)*p+(n.y-t.y)*g-u<0||(r.x-t.x)*p+(r.y-t.y)*g-u<0||(c.x-t.x)*p+(c.y-t.y)*g-u<0)}function q4(t,e,n,r,c,u,p){return!(U3(t,e,r,c,u,p)||U3(e,n,r,c,u,p)||U3(n,t,r,c,u,p)||U3(r,c,t,e,n,p)||U3(c,u,t,e,n,p)||U3(u,r,t,e,n,p))}function Oc(t,e,n){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function j3(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function wu(t,e,n,r,c){if(!e[0]&&!e[1])return t;const u=Te.convert(e)._mult(c);"viewport"===n&&u._rotate(-r);const p=[];for(let g=0;g<t.length;g++)p.push(t[g].sub(u));return p}function nd(t,e,n,r){const c=Te.convert(t)._mult(r);return"viewport"===e&&c._rotate(-n),c}Xn(R1,"CircleBucket",{omit:["layers"]});const Ra=new Co({"circle-sort-key":new zi(Rt.layout_circle["circle-sort-key"]),visibility:new On(Rt.layout_circle.visibility)});var id={paint:new Co({"circle-radius":new zi(Rt.paint_circle["circle-radius"]),"circle-color":new zi(Rt.paint_circle["circle-color"]),"circle-blur":new zi(Rt.paint_circle["circle-blur"]),"circle-opacity":new zi(Rt.paint_circle["circle-opacity"]),"circle-translate":new On(Rt.paint_circle["circle-translate"]),"circle-translate-anchor":new On(Rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(Rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(Rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zi(Rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zi(Rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zi(Rt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new On(Rt.paint_circle["circle-emissive-strength"])}),layout:Ra},Ka={},ma={};Object.defineProperty(ma,"__esModule",{value:!0}),ma.setMatrixArrayType=function(t){ma.ARRAY_TYPE=rd=t},ma.toRadian=function(t){return t*Ap},ma.equals=function(t,e){return Math.abs(t-e)<=k6*Math.max(1,Math.abs(t),Math.abs(e))},ma.RANDOM=ma.ARRAY_TYPE=ma.EPSILON=void 0;var k6=1e-6;ma.EPSILON=k6;var rd=typeof Float32Array<"u"?Float32Array:Array;ma.ARRAY_TYPE=rd;var zp=Math.random;ma.RANDOM=zp;var Ap=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Mo={};function Cu(t){return(Cu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Mo,"__esModule",{value:!0}),Mo.create=function(){var t=new Zl.ARRAY_TYPE(4);return Zl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Mo.clone=function(t){var e=new Zl.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Mo.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Mo.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Mo.fromValues=function(t,e,n,r){var c=new Zl.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c},Mo.set=function(t,e,n,r,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=c,t},Mo.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Mo.invert=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=n*u-c*r;return p?(t[0]=u*(p=1/p),t[1]=-r*p,t[2]=-c*p,t[3]=n*p,t):null},Mo.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Mo.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Mo.multiply=Yl,Mo.rotate=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=r*y+u*g,t[1]=c*y+p*g,t[2]=r*-g+u*y,t[3]=c*-g+p*y,t},Mo.scale=function(t,e,n){var r=e[1],c=e[2],u=e[3],p=n[0],g=n[1];return t[0]=e[0]*p,t[1]=r*p,t[2]=c*g,t[3]=u*g,t},Mo.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t},Mo.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Mo.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Mo.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Mo.LDU=function(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]},Mo.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Mo.subtract=Mu,Mo.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Mo.equals=function(t,e){var n=t[0],r=t[1],c=t[2],u=t[3],p=e[0],g=e[1],y=e[2],x=e[3];return Math.abs(n-p)<=Zl.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(r-g)<=Zl.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(c-y)<=Zl.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-x)<=Zl.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Mo.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Mo.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},Mo.sub=Mo.mul=void 0;var Zl=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Cu(t)&&"function"!=typeof t)return{default:t};var n=Lp(void 0);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}(ma);function Lp(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Lp=function(r){return r?n:e})(t)}function Yl(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=n[0],y=n[1],x=n[2],M=n[3];return t[0]=r*g+u*y,t[1]=c*g+p*y,t[2]=r*x+u*M,t[3]=c*x+p*M,t}function Mu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Mo.mul=Yl,Mo.sub=Mu;var _o={};function Su(t){return(Su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(_o,"__esModule",{value:!0}),_o.create=function(){var t=new $2.ARRAY_TYPE(6);return $2.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},_o.clone=function(t){var e=new $2.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},_o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},_o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},_o.fromValues=function(t,e,n,r,c,u){var p=new $2.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=n,p[3]=r,p[4]=c,p[5]=u,p},_o.set=function(t,e,n,r,c,u,p){return t[0]=e,t[1]=n,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t},_o.invert=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=e[4],g=e[5],y=n*u-r*c;return y?(t[0]=u*(y=1/y),t[1]=-r*y,t[2]=-c*y,t[3]=n*y,t[4]=(c*g-u*p)*y,t[5]=(r*p-n*g)*y,t):null},_o.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},_o.multiply=od,_o.rotate=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=Math.sin(n),M=Math.cos(n);return t[0]=r*M+u*x,t[1]=c*M+p*x,t[2]=r*-x+u*M,t[3]=c*-x+p*M,t[4]=g,t[5]=y,t},_o.scale=function(t,e,n){var r=e[1],c=e[2],u=e[3],p=e[4],g=e[5],y=n[0],x=n[1];return t[0]=e[0]*y,t[1]=r*y,t[2]=c*x,t[3]=u*x,t[4]=p,t[5]=g,t},_o.translate=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=n[0],M=n[1];return t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=r*x+u*M+g,t[5]=c*x+p*M+y,t},_o.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t},_o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},_o.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},_o.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},_o.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},_o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},_o.subtract=Tu,_o.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},_o.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t},_o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},_o.equals=function(t,e){var n=t[0],r=t[1],c=t[2],u=t[3],p=t[4],g=t[5],y=e[0],x=e[1],M=e[2],E=e[3],A=e[4],O=e[5];return Math.abs(n-y)<=$2.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-x)<=$2.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(c-M)<=$2.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-E)<=$2.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(p-A)<=$2.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(g-O)<=$2.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))},_o.sub=_o.mul=void 0;var $2=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Su(t)&&"function"!=typeof t)return{default:t};var n=sd(void 0);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}(ma);function sd(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(sd=function(r){return r?n:e})(t)}function od(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=n[0],M=n[1],E=n[2],A=n[3],O=n[4],U=n[5];return t[0]=r*x+u*M,t[1]=c*x+p*M,t[2]=r*E+u*A,t[3]=c*E+p*A,t[4]=r*O+u*U+g,t[5]=c*O+p*U+y,t}function Tu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}_o.mul=od,_o.sub=Tu;var Es={};function G3(t){return(G3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Es,"__esModule",{value:!0}),Es.create=function(){var t=new W2.ARRAY_TYPE(9);return W2.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Es.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Es.clone=function(t){var e=new W2.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Es.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Es.fromValues=function(t,e,n,r,c,u,p,g,y){var x=new W2.ARRAY_TYPE(9);return x[0]=t,x[1]=e,x[2]=n,x[3]=r,x[4]=c,x[5]=u,x[6]=p,x[7]=g,x[8]=y,x},Es.set=function(t,e,n,r,c,u,p,g,y,x){return t[0]=e,t[1]=n,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t[6]=g,t[7]=y,t[8]=x,t},Es.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Es.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Es.invert=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=e[4],g=e[5],y=e[6],x=e[7],M=e[8],E=M*p-g*x,A=-M*u+g*y,O=x*u-p*y,U=n*E+r*A+c*O;return U?(t[0]=E*(U=1/U),t[1]=(-M*r+c*x)*U,t[2]=(g*r-c*p)*U,t[3]=A*U,t[4]=(M*n-c*y)*U,t[5]=(-g*n+c*u)*U,t[6]=O*U,t[7]=(-x*n+r*y)*U,t[8]=(p*n-r*u)*U,t):null},Es.adjoint=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=e[4],g=e[5],y=e[6],x=e[7],M=e[8];return t[0]=p*M-g*x,t[1]=c*x-r*M,t[2]=r*g-c*p,t[3]=g*y-u*M,t[4]=n*M-c*y,t[5]=c*u-n*g,t[6]=u*x-p*y,t[7]=r*y-n*x,t[8]=n*p-r*u,t},Es.determinant=function(t){var e=t[3],n=t[4],r=t[5],c=t[6],u=t[7],p=t[8];return t[0]*(p*n-r*u)+t[1]*(-p*e+r*c)+t[2]*(u*e-n*c)},Es.multiply=ad,Es.translate=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=e[8],A=n[0],O=n[1];return t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=g,t[5]=y,t[6]=A*r+O*p+x,t[7]=A*c+O*g+M,t[8]=A*u+O*y+E,t},Es.rotate=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=e[8],A=Math.sin(n),O=Math.cos(n);return t[0]=O*r+A*p,t[1]=O*c+A*g,t[2]=O*u+A*y,t[3]=O*p-A*r,t[4]=O*g-A*c,t[5]=O*y-A*u,t[6]=x,t[7]=M,t[8]=E,t},Es.scale=function(t,e,n){var r=n[0],c=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Es.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Es.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Es.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Es.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Es.fromQuat=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=n+n,g=r+r,y=c+c,x=n*p,M=r*p,E=r*g,A=c*p,O=c*g,U=c*y,W=u*p,ee=u*g,ae=u*y;return t[0]=1-E-U,t[3]=M-ae,t[6]=A+ee,t[1]=M+ae,t[4]=1-x-U,t[7]=O-W,t[2]=A-ee,t[5]=O+W,t[8]=1-x-E,t},Es.normalFromMat4=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=e[4],g=e[5],y=e[6],x=e[7],M=e[8],E=e[9],A=e[10],O=e[11],U=e[12],W=e[13],ee=e[14],ae=e[15],be=n*g-r*p,Ee=n*y-c*p,Me=n*x-u*p,We=r*y-c*g,Re=r*x-u*g,et=c*x-u*y,mt=M*W-E*U,Dt=M*ee-A*U,Wt=M*ae-O*U,Vt=E*ee-A*W,un=E*ae-O*W,yn=A*ae-O*ee,tn=be*yn-Ee*un+Me*Vt+We*Wt-Re*Dt+et*mt;return tn?(t[0]=(g*yn-y*un+x*Vt)*(tn=1/tn),t[1]=(y*Wt-p*yn-x*Dt)*tn,t[2]=(p*un-g*Wt+x*mt)*tn,t[3]=(c*un-r*yn-u*Vt)*tn,t[4]=(n*yn-c*Wt+u*Dt)*tn,t[5]=(r*Wt-n*un-u*mt)*tn,t[6]=(W*et-ee*Re+ae*We)*tn,t[7]=(ee*Me-U*et-ae*Ee)*tn,t[8]=(U*Re-W*Me+ae*be)*tn,t):null},Es.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Es.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Es.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Es.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Es.subtract=Z4,Es.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Es.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t},Es.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Es.equals=function(t,e){var n=t[0],r=t[1],c=t[2],u=t[3],p=t[4],g=t[5],y=t[6],x=t[7],M=t[8],E=e[0],A=e[1],O=e[2],U=e[3],W=e[4],ee=e[5],ae=e[6],be=e[7],Ee=e[8];return Math.abs(n-E)<=W2.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(r-A)<=W2.EPSILON*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(c-O)<=W2.EPSILON*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(u-U)<=W2.EPSILON*Math.max(1,Math.abs(u),Math.abs(U))&&Math.abs(p-W)<=W2.EPSILON*Math.max(1,Math.abs(p),Math.abs(W))&&Math.abs(g-ee)<=W2.EPSILON*Math.max(1,Math.abs(g),Math.abs(ee))&&Math.abs(y-ae)<=W2.EPSILON*Math.max(1,Math.abs(y),Math.abs(ae))&&Math.abs(x-be)<=W2.EPSILON*Math.max(1,Math.abs(x),Math.abs(be))&&Math.abs(M-Ee)<=W2.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ee))},Es.sub=Es.mul=void 0;var W2=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==G3(t)&&"function"!=typeof t)return{default:t};var n=Eu(void 0);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}(ma);function Eu(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Eu=function(r){return r?n:e})(t)}function ad(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=e[8],A=n[0],O=n[1],U=n[2],W=n[3],ee=n[4],ae=n[5],be=n[6],Ee=n[7],Me=n[8];return t[0]=A*r+O*p+U*x,t[1]=A*c+O*g+U*M,t[2]=A*u+O*y+U*E,t[3]=W*r+ee*p+ae*x,t[4]=W*c+ee*g+ae*M,t[5]=W*u+ee*y+ae*E,t[6]=be*r+Ee*p+Me*x,t[7]=be*c+Ee*g+Me*M,t[8]=be*u+Ee*y+Me*E,t}function Z4(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Es.mul=ad,Es.sub=Z4;var Ar={};function zu(t){return(zu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.create=function(){var t=new io.ARRAY_TYPE(16);return io.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Ar.clone=function(t){var e=new io.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Ar.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ar.fromValues=function(t,e,n,r,c,u,p,g,y,x,M,E,A,O,U,W){var ee=new io.ARRAY_TYPE(16);return ee[0]=t,ee[1]=e,ee[2]=n,ee[3]=r,ee[4]=c,ee[5]=u,ee[6]=p,ee[7]=g,ee[8]=y,ee[9]=x,ee[10]=M,ee[11]=E,ee[12]=A,ee[13]=O,ee[14]=U,ee[15]=W,ee},Ar.set=function(t,e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee){return t[0]=e,t[1]=n,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t[6]=g,t[7]=y,t[8]=x,t[9]=M,t[10]=E,t[11]=A,t[12]=O,t[13]=U,t[14]=W,t[15]=ee,t},Ar.identity=Y4,Ar.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],c=e[3],u=e[6],p=e[7],g=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=u,t[11]=e[14],t[12]=c,t[13]=p,t[14]=g}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Ar.invert=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=e[4],g=e[5],y=e[6],x=e[7],M=e[8],E=e[9],A=e[10],O=e[11],U=e[12],W=e[13],ee=e[14],ae=e[15],be=n*g-r*p,Ee=n*y-c*p,Me=n*x-u*p,We=r*y-c*g,Re=r*x-u*g,et=c*x-u*y,mt=M*W-E*U,Dt=M*ee-A*U,Wt=M*ae-O*U,Vt=E*ee-A*W,un=E*ae-O*W,yn=A*ae-O*ee,tn=be*yn-Ee*un+Me*Vt+We*Wt-Re*Dt+et*mt;return tn?(t[0]=(g*yn-y*un+x*Vt)*(tn=1/tn),t[1]=(c*un-r*yn-u*Vt)*tn,t[2]=(W*et-ee*Re+ae*We)*tn,t[3]=(A*Re-E*et-O*We)*tn,t[4]=(y*Wt-p*yn-x*Dt)*tn,t[5]=(n*yn-c*Wt+u*Dt)*tn,t[6]=(ee*Me-U*et-ae*Ee)*tn,t[7]=(M*et-A*Me+O*Ee)*tn,t[8]=(p*un-g*Wt+x*mt)*tn,t[9]=(r*Wt-n*un-u*mt)*tn,t[10]=(U*Re-W*Me+ae*be)*tn,t[11]=(E*Me-M*Re-O*be)*tn,t[12]=(g*Dt-p*Vt-y*mt)*tn,t[13]=(n*Vt-r*Dt+c*mt)*tn,t[14]=(W*Ee-U*We-ee*be)*tn,t[15]=(M*We-E*Ee+A*be)*tn,t):null},Ar.adjoint=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=e[4],g=e[5],y=e[6],x=e[7],M=e[8],E=e[9],A=e[10],O=e[11],U=e[12],W=e[13],ee=e[14],ae=e[15];return t[0]=g*(A*ae-O*ee)-E*(y*ae-x*ee)+W*(y*O-x*A),t[1]=-(r*(A*ae-O*ee)-E*(c*ae-u*ee)+W*(c*O-u*A)),t[2]=r*(y*ae-x*ee)-g*(c*ae-u*ee)+W*(c*x-u*y),t[3]=-(r*(y*O-x*A)-g*(c*O-u*A)+E*(c*x-u*y)),t[4]=-(p*(A*ae-O*ee)-M*(y*ae-x*ee)+U*(y*O-x*A)),t[5]=n*(A*ae-O*ee)-M*(c*ae-u*ee)+U*(c*O-u*A),t[6]=-(n*(y*ae-x*ee)-p*(c*ae-u*ee)+U*(c*x-u*y)),t[7]=n*(y*O-x*A)-p*(c*O-u*A)+M*(c*x-u*y),t[8]=p*(E*ae-O*W)-M*(g*ae-x*W)+U*(g*O-x*E),t[9]=-(n*(E*ae-O*W)-M*(r*ae-u*W)+U*(r*O-u*E)),t[10]=n*(g*ae-x*W)-p*(r*ae-u*W)+U*(r*x-u*g),t[11]=-(n*(g*O-x*E)-p*(r*O-u*E)+M*(r*x-u*g)),t[12]=-(p*(E*ee-A*W)-M*(g*ee-y*W)+U*(g*A-y*E)),t[13]=n*(E*ee-A*W)-M*(r*ee-c*W)+U*(r*A-c*E),t[14]=-(n*(g*ee-y*W)-p*(r*ee-c*W)+U*(r*y-c*g)),t[15]=n*(g*A-y*E)-p*(r*A-c*E)+M*(r*y-c*g),t},Ar.determinant=function(t){var e=t[0],n=t[1],r=t[2],c=t[3],u=t[4],p=t[5],g=t[6],y=t[7],x=t[8],M=t[9],E=t[10],A=t[11],O=t[12],U=t[13],W=t[14],ee=t[15];return(e*p-n*u)*(E*ee-A*W)-(e*g-r*u)*(M*ee-A*U)+(e*y-c*u)*(M*W-E*U)+(n*g-r*p)*(x*ee-A*O)-(n*y-c*p)*(x*W-E*O)+(r*y-c*g)*(x*U-M*O)},Ar.multiply=K4,Ar.translate=function(t,e,n){var r,c,u,p,g,y,x,M,E,A,O,U,W=n[0],ee=n[1],ae=n[2];return e===t?(t[12]=e[0]*W+e[4]*ee+e[8]*ae+e[12],t[13]=e[1]*W+e[5]*ee+e[9]*ae+e[13],t[14]=e[2]*W+e[6]*ee+e[10]*ae+e[14],t[15]=e[3]*W+e[7]*ee+e[11]*ae+e[15]):(c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=e[8],A=e[9],O=e[10],U=e[11],t[0]=r=e[0],t[1]=c,t[2]=u,t[3]=p,t[4]=g,t[5]=y,t[6]=x,t[7]=M,t[8]=E,t[9]=A,t[10]=O,t[11]=U,t[12]=r*W+g*ee+E*ae+e[12],t[13]=c*W+y*ee+A*ae+e[13],t[14]=u*W+x*ee+O*ae+e[14],t[15]=p*W+M*ee+U*ae+e[15]),t},Ar.scale=function(t,e,n){var r=n[0],c=n[1],u=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ar.rotate=function(t,e,n,r){var c,u,p,g,y,x,M,E,A,O,U,W,ee,ae,be,Ee,Me,We,Re,et,mt,Dt,Wt,Vt,un=r[0],yn=r[1],tn=r[2],gn=Math.hypot(un,yn,tn);return gn<io.EPSILON?null:(un*=gn=1/gn,yn*=gn,tn*=gn,c=Math.sin(n),u=Math.cos(n),y=e[1],x=e[2],M=e[3],A=e[5],O=e[6],U=e[7],ee=e[9],ae=e[10],be=e[11],Ee=un*un*(p=1-u)+u,Re=un*yn*p-tn*c,et=yn*yn*p+u,mt=tn*yn*p+un*c,Dt=un*tn*p+yn*c,Wt=yn*tn*p-un*c,Vt=tn*tn*p+u,t[0]=(g=e[0])*Ee+(E=e[4])*(Me=yn*un*p+tn*c)+(W=e[8])*(We=tn*un*p-yn*c),t[1]=y*Ee+A*Me+ee*We,t[2]=x*Ee+O*Me+ae*We,t[3]=M*Ee+U*Me+be*We,t[4]=g*Re+E*et+W*mt,t[5]=y*Re+A*et+ee*mt,t[6]=x*Re+O*et+ae*mt,t[7]=M*Re+U*et+be*mt,t[8]=g*Dt+E*Wt+W*Vt,t[9]=y*Dt+A*Wt+ee*Vt,t[10]=x*Dt+O*Wt+ae*Vt,t[11]=M*Dt+U*Wt+be*Vt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Ar.rotateX=function(t,e,n){var r=Math.sin(n),c=Math.cos(n),u=e[4],p=e[5],g=e[6],y=e[7],x=e[8],M=e[9],E=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*c+x*r,t[5]=p*c+M*r,t[6]=g*c+E*r,t[7]=y*c+A*r,t[8]=x*c-u*r,t[9]=M*c-p*r,t[10]=E*c-g*r,t[11]=A*c-y*r,t},Ar.rotateY=function(t,e,n){var r=Math.sin(n),c=Math.cos(n),u=e[0],p=e[1],g=e[2],y=e[3],x=e[8],M=e[9],E=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c-x*r,t[1]=p*c-M*r,t[2]=g*c-E*r,t[3]=y*c-A*r,t[8]=u*r+x*c,t[9]=p*r+M*c,t[10]=g*r+E*c,t[11]=y*r+A*c,t},Ar.rotateZ=function(t,e,n){var r=Math.sin(n),c=Math.cos(n),u=e[0],p=e[1],g=e[2],y=e[3],x=e[4],M=e[5],E=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c+x*r,t[1]=p*c+M*r,t[2]=g*c+E*r,t[3]=y*c+A*r,t[4]=x*c-u*r,t[5]=M*c-p*r,t[6]=E*c-g*r,t[7]=A*c-y*r,t},Ar.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Ar.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ar.fromRotation=function(t,e,n){var r,c,u,p=n[0],g=n[1],y=n[2],x=Math.hypot(p,g,y);return x<io.EPSILON?null:(p*=x=1/x,g*=x,y*=x,r=Math.sin(e),c=Math.cos(e),t[0]=p*p*(u=1-c)+c,t[1]=g*p*u+y*r,t[2]=y*p*u-g*r,t[3]=0,t[4]=p*g*u-y*r,t[5]=g*g*u+c,t[6]=y*g*u+p*r,t[7]=0,t[8]=p*y*u+g*r,t[9]=g*y*u-p*r,t[10]=y*y*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Ar.fromXRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ar.fromYRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ar.fromZRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ar.fromRotationTranslation=ld,Ar.fromQuat2=function(t,e){var n=new io.ARRAY_TYPE(3),r=-e[0],c=-e[1],u=-e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=r*r+c*c+u*u+p*p;return E>0?(n[0]=2*(g*p+M*r+y*u-x*c)/E,n[1]=2*(y*p+M*c+x*r-g*u)/E,n[2]=2*(x*p+M*u+g*c-y*r)/E):(n[0]=2*(g*p+M*r+y*u-x*c),n[1]=2*(y*p+M*c+x*r-g*u),n[2]=2*(x*p+M*u+g*c-y*r)),ld(t,e,n),t},Ar.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Ar.getScaling=Au,Ar.getRotation=function(t,e){var n=new io.ARRAY_TYPE(3);Au(n,e);var r=1/n[0],c=1/n[1],u=1/n[2],p=e[0]*r,g=e[1]*c,y=e[2]*u,x=e[4]*r,M=e[5]*c,E=e[6]*u,A=e[8]*r,O=e[9]*c,U=e[10]*u,W=p+M+U,ee=0;return W>0?(ee=2*Math.sqrt(W+1),t[3]=.25*ee,t[0]=(E-O)/ee,t[1]=(A-y)/ee,t[2]=(g-x)/ee):p>M&&p>U?(ee=2*Math.sqrt(1+p-M-U),t[3]=(E-O)/ee,t[0]=.25*ee,t[1]=(g+x)/ee,t[2]=(A+y)/ee):M>U?(ee=2*Math.sqrt(1+M-p-U),t[3]=(A-y)/ee,t[0]=(g+x)/ee,t[1]=.25*ee,t[2]=(E+O)/ee):(ee=2*Math.sqrt(1+U-p-M),t[3]=(g-x)/ee,t[0]=(A+y)/ee,t[1]=(E+O)/ee,t[2]=.25*ee),t},Ar.fromRotationTranslationScale=function(t,e,n,r){var c=e[0],u=e[1],p=e[2],g=e[3],y=c+c,x=u+u,M=p+p,E=c*y,A=c*x,O=c*M,U=u*x,W=u*M,ee=p*M,ae=g*y,be=g*x,Ee=g*M,Me=r[0],We=r[1],Re=r[2];return t[0]=(1-(U+ee))*Me,t[1]=(A+Ee)*Me,t[2]=(O-be)*Me,t[3]=0,t[4]=(A-Ee)*We,t[5]=(1-(E+ee))*We,t[6]=(W+ae)*We,t[7]=0,t[8]=(O+be)*Re,t[9]=(W-ae)*Re,t[10]=(1-(E+U))*Re,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Ar.fromRotationTranslationScaleOrigin=function(t,e,n,r,c){var u=e[0],p=e[1],g=e[2],y=e[3],x=u+u,M=p+p,E=g+g,A=u*x,O=u*M,U=u*E,W=p*M,ee=p*E,ae=g*E,be=y*x,Ee=y*M,Me=y*E,We=r[0],Re=r[1],et=r[2],mt=c[0],Dt=c[1],Wt=c[2],Vt=(1-(W+ae))*We,un=(O+Me)*We,yn=(U-Ee)*We,tn=(O-Me)*Re,gn=(1-(A+ae))*Re,Kt=(ee+be)*Re,pn=(U+Ee)*et,Gn=(ee-be)*et,wn=(1-(A+W))*et;return t[0]=Vt,t[1]=un,t[2]=yn,t[3]=0,t[4]=tn,t[5]=gn,t[6]=Kt,t[7]=0,t[8]=pn,t[9]=Gn,t[10]=wn,t[11]=0,t[12]=n[0]+mt-(Vt*mt+tn*Dt+pn*Wt),t[13]=n[1]+Dt-(un*mt+gn*Dt+Gn*Wt),t[14]=n[2]+Wt-(yn*mt+Kt*Dt+wn*Wt),t[15]=1,t},Ar.fromQuat=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=n+n,g=r+r,y=c+c,x=n*p,M=r*p,E=r*g,A=c*p,O=c*g,U=c*y,W=u*p,ee=u*g,ae=u*y;return t[0]=1-E-U,t[1]=M+ae,t[2]=A-ee,t[3]=0,t[4]=M-ae,t[5]=1-x-U,t[6]=O+W,t[7]=0,t[8]=A+ee,t[9]=O-W,t[10]=1-x-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ar.frustum=function(t,e,n,r,c,u,p){var g=1/(n-e),y=1/(c-r),x=1/(u-p);return t[0]=2*u*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*y,t[6]=0,t[7]=0,t[8]=(n+e)*g,t[9]=(c+r)*y,t[10]=(p+u)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*u*2*x,t[15]=0,t},Ar.perspectiveNO=X4,Ar.perspectiveZO=function(t,e,n,r,c){var u,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=c&&c!==1/0?(t[10]=c*(u=1/(r-c)),t[14]=c*r*u):(t[10]=-1,t[14]=-r),t},Ar.perspectiveFromFieldOfView=function(t,e,n,r){var c=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),g=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+g),x=2/(c+u);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=-(p-g)*y*.5,t[9]=(c-u)*x*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},Ar.orthoNO=dl,Ar.orthoZO=function(t,e,n,r,c,u,p){var g=1/(e-n),y=1/(r-c),x=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=x,t[11]=0,t[12]=(e+n)*g,t[13]=(c+r)*y,t[14]=u*x,t[15]=1,t},Ar.lookAt=function(t,e,n,r){var c,u,p,g,y,x,M,E,A,O,U=e[0],W=e[1],ee=e[2],ae=r[0],be=r[1],Ee=r[2],Me=n[0],We=n[1],Re=n[2];return Math.abs(U-Me)<io.EPSILON&&Math.abs(W-We)<io.EPSILON&&Math.abs(ee-Re)<io.EPSILON?Y4(t):(M=U-Me,E=W-We,A=ee-Re,c=be*(A*=O=1/Math.hypot(M,E,A))-Ee*(E*=O),u=Ee*(M*=O)-ae*A,p=ae*E-be*M,(O=Math.hypot(c,u,p))?(c*=O=1/O,u*=O,p*=O):(c=0,u=0,p=0),g=E*p-A*u,y=A*c-M*p,x=M*u-E*c,(O=Math.hypot(g,y,x))?(g*=O=1/O,y*=O,x*=O):(g=0,y=0,x=0),t[0]=c,t[1]=g,t[2]=M,t[3]=0,t[4]=u,t[5]=y,t[6]=E,t[7]=0,t[8]=p,t[9]=x,t[10]=A,t[11]=0,t[12]=-(c*U+u*W+p*ee),t[13]=-(g*U+y*W+x*ee),t[14]=-(M*U+E*W+A*ee),t[15]=1,t)},Ar.targetTo=function(t,e,n,r){var c=e[0],u=e[1],p=e[2],g=r[0],y=r[1],x=r[2],M=c-n[0],E=u-n[1],A=p-n[2],O=M*M+E*E+A*A;O>0&&(M*=O=1/Math.sqrt(O),E*=O,A*=O);var U=y*A-x*E,W=x*M-g*A,ee=g*E-y*M;return(O=U*U+W*W+ee*ee)>0&&(U*=O=1/Math.sqrt(O),W*=O,ee*=O),t[0]=U,t[1]=W,t[2]=ee,t[3]=0,t[4]=E*ee-A*W,t[5]=A*U-M*ee,t[6]=M*W-E*U,t[7]=0,t[8]=M,t[9]=E,t[10]=A,t[11]=0,t[12]=c,t[13]=u,t[14]=p,t[15]=1,t},Ar.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Ar.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Ar.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Ar.subtract=R6,Ar.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Ar.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},Ar.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Ar.equals=function(t,e){var n=t[0],r=t[1],c=t[2],u=t[3],p=t[4],g=t[5],y=t[6],x=t[7],M=t[8],E=t[9],A=t[10],O=t[11],U=t[12],W=t[13],ee=t[14],ae=t[15],be=e[0],Ee=e[1],Me=e[2],We=e[3],Re=e[4],et=e[5],mt=e[6],Dt=e[7],Wt=e[8],Vt=e[9],un=e[10],yn=e[11],tn=e[12],gn=e[13],Kt=e[14],pn=e[15];return Math.abs(n-be)<=io.EPSILON*Math.max(1,Math.abs(n),Math.abs(be))&&Math.abs(r-Ee)<=io.EPSILON*Math.max(1,Math.abs(r),Math.abs(Ee))&&Math.abs(c-Me)<=io.EPSILON*Math.max(1,Math.abs(c),Math.abs(Me))&&Math.abs(u-We)<=io.EPSILON*Math.max(1,Math.abs(u),Math.abs(We))&&Math.abs(p-Re)<=io.EPSILON*Math.max(1,Math.abs(p),Math.abs(Re))&&Math.abs(g-et)<=io.EPSILON*Math.max(1,Math.abs(g),Math.abs(et))&&Math.abs(y-mt)<=io.EPSILON*Math.max(1,Math.abs(y),Math.abs(mt))&&Math.abs(x-Dt)<=io.EPSILON*Math.max(1,Math.abs(x),Math.abs(Dt))&&Math.abs(M-Wt)<=io.EPSILON*Math.max(1,Math.abs(M),Math.abs(Wt))&&Math.abs(E-Vt)<=io.EPSILON*Math.max(1,Math.abs(E),Math.abs(Vt))&&Math.abs(A-un)<=io.EPSILON*Math.max(1,Math.abs(A),Math.abs(un))&&Math.abs(O-yn)<=io.EPSILON*Math.max(1,Math.abs(O),Math.abs(yn))&&Math.abs(U-tn)<=io.EPSILON*Math.max(1,Math.abs(U),Math.abs(tn))&&Math.abs(W-gn)<=io.EPSILON*Math.max(1,Math.abs(W),Math.abs(gn))&&Math.abs(ee-Kt)<=io.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Kt))&&Math.abs(ae-pn)<=io.EPSILON*Math.max(1,Math.abs(ae),Math.abs(pn))},Ar.sub=Ar.mul=Ar.ortho=Ar.perspective=void 0;var io=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==zu(t)&&"function"!=typeof t)return{default:t};var n=cd(void 0);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}(ma);function cd(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(cd=function(r){return r?n:e})(t)}function Y4(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function K4(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=e[8],A=e[9],O=e[10],U=e[11],W=e[12],ee=e[13],ae=e[14],be=e[15],Ee=n[0],Me=n[1],We=n[2],Re=n[3];return t[0]=Ee*r+Me*g+We*E+Re*W,t[1]=Ee*c+Me*y+We*A+Re*ee,t[2]=Ee*u+Me*x+We*O+Re*ae,t[3]=Ee*p+Me*M+We*U+Re*be,t[4]=(Ee=n[4])*r+(Me=n[5])*g+(We=n[6])*E+(Re=n[7])*W,t[5]=Ee*c+Me*y+We*A+Re*ee,t[6]=Ee*u+Me*x+We*O+Re*ae,t[7]=Ee*p+Me*M+We*U+Re*be,t[8]=(Ee=n[8])*r+(Me=n[9])*g+(We=n[10])*E+(Re=n[11])*W,t[9]=Ee*c+Me*y+We*A+Re*ee,t[10]=Ee*u+Me*x+We*O+Re*ae,t[11]=Ee*p+Me*M+We*U+Re*be,t[12]=(Ee=n[12])*r+(Me=n[13])*g+(We=n[14])*E+(Re=n[15])*W,t[13]=Ee*c+Me*y+We*A+Re*ee,t[14]=Ee*u+Me*x+We*O+Re*ae,t[15]=Ee*p+Me*M+We*U+Re*be,t}function ld(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=r+r,y=c+c,x=u+u,M=r*g,E=r*y,A=r*x,O=c*y,U=c*x,W=u*x,ee=p*g,ae=p*y,be=p*x;return t[0]=1-(O+W),t[1]=E+be,t[2]=A-ae,t[3]=0,t[4]=E-be,t[5]=1-(M+W),t[6]=U+ee,t[7]=0,t[8]=A+ae,t[9]=U-ee,t[10]=1-(M+O),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Au(t,e){var n=e[4],r=e[5],c=e[6],u=e[8],p=e[9],g=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,r,c),t[2]=Math.hypot(u,p,g),t}function X4(t,e,n,r,c){var u,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=c&&c!==1/0?(t[10]=(c+r)*(u=1/(r-c)),t[14]=2*c*r*u):(t[10]=-1,t[14]=-2*r),t}function dl(t,e,n,r,c,u,p){var g=1/(e-n),y=1/(r-c),x=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+n)*g,t[13]=(c+r)*y,t[14]=(p+u)*x,t[15]=1,t}function R6(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Ar.perspective=X4,Ar.ortho=dl,Ar.mul=K4,Ar.sub=R6;var gr={},Lr={};function O6(t){return(O6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.create=ud,Lr.clone=function(t){var e=new Ec.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Lr.length=hd,Lr.fromValues=function(t,e,n){var r=new Ec.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r},Lr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Lr.set=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},Lr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Lr.subtract=F6,Lr.multiply=Lu,Lr.divide=J4,Lr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Lr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Lr.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Lr.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Lr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Lr.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Lr.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},Lr.distance=B6,Lr.squaredDistance=fd,Lr.squaredLength=U6,Lr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Lr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Lr.normalize=function(t,e){var n=e[0],r=e[1],c=e[2],u=n*n+r*r+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},Lr.dot=dd,Lr.cross=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=n[0],g=n[1],y=n[2];return t[0]=c*y-u*g,t[1]=u*p-r*y,t[2]=r*g-c*p,t},Lr.lerp=function(t,e,n,r){var c=e[0],u=e[1],p=e[2];return t[0]=c+r*(n[0]-c),t[1]=u+r*(n[1]-u),t[2]=p+r*(n[2]-p),t},Lr.hermite=function(t,e,n,r,c,u){var p=u*u,g=p*(2*u-3)+1,y=p*(u-2)+u,x=p*(u-1),M=p*(3-2*u);return t[0]=e[0]*g+n[0]*y+r[0]*x+c[0]*M,t[1]=e[1]*g+n[1]*y+r[1]*x+c[1]*M,t[2]=e[2]*g+n[2]*y+r[2]*x+c[2]*M,t},Lr.bezier=function(t,e,n,r,c,u){var p=1-u,g=p*p,y=u*u,x=g*p,M=3*u*g,E=3*y*p,A=y*u;return t[0]=e[0]*x+n[0]*M+r[0]*E+c[0]*A,t[1]=e[1]*x+n[1]*M+r[1]*E+c[1]*A,t[2]=e[2]*x+n[2]*M+r[2]*E+c[2]*A,t},Lr.random=function(t,e){e=e||1;var n=2*Ec.RANDOM()*Math.PI,r=2*Ec.RANDOM()-1,c=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=r*e,t},Lr.transformMat4=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=n[3]*r+n[7]*c+n[11]*u+n[15];return t[0]=(n[0]*r+n[4]*c+n[8]*u+n[12])/(p=p||1),t[1]=(n[1]*r+n[5]*c+n[9]*u+n[13])/p,t[2]=(n[2]*r+n[6]*c+n[10]*u+n[14])/p,t},Lr.transformMat3=function(t,e,n){var r=e[0],c=e[1],u=e[2];return t[0]=r*n[0]+c*n[3]+u*n[6],t[1]=r*n[1]+c*n[4]+u*n[7],t[2]=r*n[2]+c*n[5]+u*n[8],t},Lr.transformQuat=function(t,e,n){var r=n[0],c=n[1],u=n[2],p=e[0],g=e[1],y=e[2],x=c*y-u*g,M=u*p-r*y,E=r*g-c*p,A=c*E-u*M,O=u*x-r*E,U=r*M-c*x,W=2*n[3];return M*=W,E*=W,O*=2,U*=2,t[0]=p+(x*=W)+(A*=2),t[1]=g+M+O,t[2]=y+E+U,t},Lr.rotateX=function(t,e,n,r){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[0],u[1]=c[1]*Math.cos(r)-c[2]*Math.sin(r),u[2]=c[1]*Math.sin(r)+c[2]*Math.cos(r),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Lr.rotateY=function(t,e,n,r){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[2]*Math.sin(r)+c[0]*Math.cos(r),u[1]=c[1],u[2]=c[2]*Math.cos(r)-c[0]*Math.sin(r),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Lr.rotateZ=function(t,e,n,r){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[0]*Math.cos(r)-c[1]*Math.sin(r),u[1]=c[0]*Math.sin(r)+c[1]*Math.cos(r),u[2]=c[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Lr.angle=function(t,e){var n=t[0],r=t[1],c=t[2],u=e[0],p=e[1],g=e[2],y=Math.sqrt(n*n+r*r+c*c)*Math.sqrt(u*u+p*p+g*g),x=y&&dd(t,e)/y;return Math.acos(Math.min(Math.max(x,-1),1))},Lr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Lr.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Lr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Lr.equals=function(t,e){var n=t[0],r=t[1],c=t[2],u=e[0],p=e[1],g=e[2];return Math.abs(n-u)<=Ec.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-p)<=Ec.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(c-g)<=Ec.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))},Lr.forEach=Lr.sqrLen=Lr.len=Lr.sqrDist=Lr.dist=Lr.div=Lr.mul=Lr.sub=void 0;var Ec=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==O6(t)&&"function"!=typeof t)return{default:t};var n=Kl(void 0);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}(ma);function Kl(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Kl=function(r){return r?n:e})(t)}function ud(){var t=new Ec.ARRAY_TYPE(3);return Ec.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function hd(t){return Math.hypot(t[0],t[1],t[2])}function F6(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Lu(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function J4(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function B6(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function fd(t,e){var n=e[0]-t[0],r=e[1]-t[1],c=e[2]-t[2];return n*n+r*r+c*c}function U6(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function dd(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Lr.sub=F6,Lr.mul=Lu,Lr.div=J4,Lr.dist=B6,Lr.sqrDist=fd,Lr.len=hd,Lr.sqrLen=U6;var Fc,Q4=(Fc=ud(),function(t,e,n,r,c,u){var p,g;for(e||(e=3),n||(n=0),g=r?Math.min(r*e+n,t.length):t.length,p=n;p<g;p+=e)Fc[0]=t[p],Fc[1]=t[p+1],Fc[2]=t[p+2],c(Fc,Fc,u),t[p]=Fc[0],t[p+1]=Fc[1],t[p+2]=Fc[2];return t});Lr.forEach=Q4;var Gr={};function pl(t){return(pl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.create=G6,Gr.clone=function(t){var e=new K1.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Gr.fromValues=function(t,e,n,r){var c=new K1.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c},Gr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Gr.set=function(t,e,n,r,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=c,t},Gr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Gr.subtract=pd,Gr.multiply=$6,Gr.divide=md,Gr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Gr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Gr.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Gr.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Gr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Gr.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Gr.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},Gr.distance=W6,Gr.squaredDistance=gd,Gr.length=e0,Gr.squaredLength=Du,Gr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Gr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Gr.normalize=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=n*n+r*r+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=n*p,t[1]=r*p,t[2]=c*p,t[3]=u*p,t},Gr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Gr.cross=function(t,e,n,r){var c=n[0]*r[1]-n[1]*r[0],u=n[0]*r[2]-n[2]*r[0],p=n[0]*r[3]-n[3]*r[0],g=n[1]*r[2]-n[2]*r[1],y=n[1]*r[3]-n[3]*r[1],x=n[2]*r[3]-n[3]*r[2],M=e[0],E=e[1],A=e[2],O=e[3];return t[0]=E*x-A*y+O*g,t[1]=-M*x+A*p-O*u,t[2]=M*y-E*p+O*c,t[3]=-M*g+E*u-A*c,t},Gr.lerp=function(t,e,n,r){var c=e[0],u=e[1],p=e[2],g=e[3];return t[0]=c+r*(n[0]-c),t[1]=u+r*(n[1]-u),t[2]=p+r*(n[2]-p),t[3]=g+r*(n[3]-g),t},Gr.random=function(t,e){var n,r,c,u,p,g;e=e||1;do{p=(n=2*K1.RANDOM()-1)*n+(r=2*K1.RANDOM()-1)*r}while(p>=1);do{g=(c=2*K1.RANDOM()-1)*c+(u=2*K1.RANDOM()-1)*u}while(g>=1);var y=Math.sqrt((1-p)/g);return t[0]=e*n,t[1]=e*r,t[2]=e*c*y,t[3]=e*u*y,t},Gr.transformMat4=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3];return t[0]=n[0]*r+n[4]*c+n[8]*u+n[12]*p,t[1]=n[1]*r+n[5]*c+n[9]*u+n[13]*p,t[2]=n[2]*r+n[6]*c+n[10]*u+n[14]*p,t[3]=n[3]*r+n[7]*c+n[11]*u+n[15]*p,t},Gr.transformQuat=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=n[0],g=n[1],y=n[2],x=n[3],M=x*r+g*u-y*c,E=x*c+y*r-p*u,A=x*u+p*c-g*r,O=-p*r-g*c-y*u;return t[0]=M*x+O*-p+E*-y-A*-g,t[1]=E*x+O*-g+A*-p-M*-y,t[2]=A*x+O*-y+M*-g-E*-p,t[3]=e[3],t},Gr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Gr.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Gr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Gr.equals=function(t,e){var n=t[0],r=t[1],c=t[2],u=t[3],p=e[0],g=e[1],y=e[2],x=e[3];return Math.abs(n-p)<=K1.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(r-g)<=K1.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(c-y)<=K1.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-x)<=K1.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Gr.forEach=Gr.sqrLen=Gr.len=Gr.sqrDist=Gr.dist=Gr.div=Gr.mul=Gr.sub=void 0;var K1=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==pl(t)&&"function"!=typeof t)return{default:t};var n=j6(void 0);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}(ma);function j6(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(j6=function(r){return r?n:e})(t)}function G6(){var t=new K1.ARRAY_TYPE(4);return K1.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function pd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function $6(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function md(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function W6(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function gd(t,e){var n=e[0]-t[0],r=e[1]-t[1],c=e[2]-t[2],u=e[3]-t[3];return n*n+r*r+c*c+u*u}function e0(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Du(t){var e=t[0],n=t[1],r=t[2],c=t[3];return e*e+n*n+r*r+c*c}Gr.sub=pd,Gr.mul=$6,Gr.div=md,Gr.dist=W6,Gr.sqrDist=gd,Gr.len=e0,Gr.sqrLen=Du;var Dp=function(){var t=G6();return function(e,n,r,c,u,p){var g,y;for(n||(n=4),r||(r=0),y=c?Math.min(c*n+r,e.length):e.length,g=r;g<y;g+=n)t[0]=e[g],t[1]=e[g+1],t[2]=e[g+2],t[3]=e[g+3],u(t,t,p),e[g]=t[0],e[g+1]=t[1],e[g+2]=t[2],e[g+3]=t[3];return e}}();function $3(t){return($3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Gr.forEach=Dp,Object.defineProperty(gr,"__esModule",{value:!0}),gr.create=Vu,gr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},gr.setAxisAngle=q6,gr.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>rc.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n},gr.getAngle=function(t,e){var n=Z6(t,e);return Math.acos(2*n*n-1)},gr.multiply=ml,gr.rotateX=function(t,e,n){n*=.5;var r=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=r*y+p*g,t[1]=c*y+u*g,t[2]=u*y-c*g,t[3]=p*y-r*g,t},gr.rotateY=function(t,e,n){n*=.5;var r=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=r*y-u*g,t[1]=c*y+p*g,t[2]=u*y+r*g,t[3]=p*y-c*g,t},gr.rotateZ=function(t,e,n){n*=.5;var r=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=r*y+c*g,t[1]=c*y-r*g,t[2]=u*y+p*g,t[3]=p*y-u*g,t},gr.calculateW=function(t,e){var n=e[0],r=e[1],c=e[2];return t[0]=n,t[1]=r,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-c*c)),t},gr.exp=sc,gr.ln=vd,gr.pow=function(t,e,n){return vd(t,e),Hp(t,t,n),sc(t,t),t},gr.slerp=t0,gr.random=function(t){var e=rc.RANDOM(),n=rc.RANDOM(),r=rc.RANDOM(),c=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=u*Math.sin(2*Math.PI*r),t[3]=u*Math.cos(2*Math.PI*r),t},gr.invert=function(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=n*n+r*r+c*c+u*u,g=p?1/p:0;return t[0]=-n*g,t[1]=-r*g,t[2]=-c*g,t[3]=u*g,t},gr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},gr.fromMat3=Vp,gr.fromEuler=function(t,e,n,r){var c=.5*Math.PI/180;e*=c,n*=c,r*=c;var u=Math.sin(e),p=Math.cos(e),g=Math.sin(n),y=Math.cos(n),x=Math.sin(r),M=Math.cos(r);return t[0]=u*y*M-p*g*x,t[1]=p*g*M+u*y*x,t[2]=p*y*x-u*g*M,t[3]=p*y*M+u*g*x,t},gr.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},gr.setAxes=gr.sqlerp=gr.rotationTo=gr.equals=gr.exactEquals=gr.normalize=gr.sqrLen=gr.squaredLength=gr.len=gr.length=gr.lerp=gr.dot=gr.scale=gr.mul=gr.add=gr.set=gr.copy=gr.fromValues=gr.clone=void 0;var rc=Iu(ma),Ip=Iu(Es),Bc=Iu(Lr),a2=Iu(Gr);function _d(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(_d=function(r){return r?n:e})(t)}function Iu(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==$3(t)&&"function"!=typeof t)return{default:t};var n=_d(e);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}function Vu(){var t=new rc.ARRAY_TYPE(4);return rc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function q6(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function ml(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=n[0],y=n[1],x=n[2],M=n[3];return t[0]=r*M+p*g+c*x-u*y,t[1]=c*M+p*y+u*g-r*x,t[2]=u*M+p*x+r*y-c*g,t[3]=p*M-r*g-c*y-u*x,t}function sc(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=Math.sqrt(n*n+r*r+c*c),g=Math.exp(u),y=p>0?g*Math.sin(p)/p:0;return t[0]=n*y,t[1]=r*y,t[2]=c*y,t[3]=g*Math.cos(p),t}function vd(t,e){var n=e[0],r=e[1],c=e[2],u=e[3],p=Math.sqrt(n*n+r*r+c*c),g=p>0?Math.atan2(p,u)/p:0;return t[0]=n*g,t[1]=r*g,t[2]=c*g,t[3]=.5*Math.log(n*n+r*r+c*c+u*u),t}function t0(t,e,n,r){var c,u,p,g,y,x=e[0],M=e[1],E=e[2],A=e[3],O=n[0],U=n[1],W=n[2],ee=n[3];return(u=x*O+M*U+E*W+A*ee)<0&&(u=-u,O=-O,U=-U,W=-W,ee=-ee),1-u>rc.EPSILON?(c=Math.acos(u),p=Math.sin(c),g=Math.sin((1-r)*c)/p,y=Math.sin(r*c)/p):(g=1-r,y=r),t[0]=g*x+y*O,t[1]=g*M+y*U,t[2]=g*E+y*W,t[3]=g*A+y*ee,t}function Vp(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var u=(c+1)%3,p=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*u+u]-e[3*p+p]+1),t[c]=.5*n,t[3]=(e[3*u+p]-e[3*p+u])*(n=.5/n),t[u]=(e[3*u+c]+e[3*c+u])*n,t[p]=(e[3*p+c]+e[3*c+p])*n}return t}gr.clone=a2.clone,gr.fromValues=a2.fromValues,gr.copy=a2.copy,gr.set=a2.set,gr.add=a2.add,gr.mul=ml;var Hp=a2.scale;gr.scale=Hp;var Z6=a2.dot;gr.dot=Z6,gr.lerp=a2.lerp;var Pp=a2.length;gr.length=Pp,gr.len=Pp;var Y6=a2.squaredLength;gr.squaredLength=Y6,gr.sqrLen=Y6;var Hu=a2.normalize;gr.normalize=Hu,gr.exactEquals=a2.exactEquals,gr.equals=a2.equals;var oc,Pu,yd,Np=(oc=Bc.create(),Pu=Bc.fromValues(1,0,0),yd=Bc.fromValues(0,1,0),function(t,e,n){var r=Bc.dot(e,n);return r<-.999999?(Bc.cross(oc,Pu,e),Bc.len(oc)<1e-6&&Bc.cross(oc,yd,e),Bc.normalize(oc,oc),q6(t,oc,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Bc.cross(oc,e,n),t[0]=oc[0],t[1]=oc[1],t[2]=oc[2],t[3]=1+r,Hu(t,t))});gr.rotationTo=Np;var M2,Nu,xd=(M2=Vu(),Nu=Vu(),function(t,e,n,r,c,u){return t0(M2,e,c,u),t0(Nu,n,r,u),t0(t,M2,Nu,2*u*(1-u)),t});gr.sqlerp=xd;var ac,kp=(ac=Ip.create(),function(t,e,n,r){return ac[0]=n[0],ac[3]=n[1],ac[6]=n[2],ac[1]=r[0],ac[4]=r[1],ac[7]=r[2],ac[2]=-e[0],ac[5]=-e[1],ac[8]=-e[2],Hu(t,Vp(t,ac))});gr.setAxes=kp;var Kr={};function n0(t){return(n0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.create=function(){var t=new X1.ARRAY_TYPE(8);return X1.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Kr.clone=function(t){var e=new X1.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Kr.fromValues=function(t,e,n,r,c,u,p,g){var y=new X1.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=r,y[4]=c,y[5]=u,y[6]=p,y[7]=g,y},Kr.fromRotationTranslationValues=function(t,e,n,r,c,u,p){var g=new X1.ARRAY_TYPE(8);g[0]=t,g[1]=e,g[2]=n,g[3]=r;var y=.5*c,x=.5*u,M=.5*p;return g[4]=y*r+x*n-M*e,g[5]=x*r+M*t-y*n,g[6]=M*r+y*e-x*t,g[7]=-y*t-x*e-M*n,g},Kr.fromRotationTranslation=ku,Kr.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Kr.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Kr.fromMat4=function(t,e){var n=Uc.create();bd.getRotation(n,e);var r=new X1.ARRAY_TYPE(3);return bd.getTranslation(r,e),ku(t,n,r),t},Kr.copy=K6,Kr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Kr.set=function(t,e,n,r,c,u,p,g,y){return t[0]=e,t[1]=n,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t[6]=g,t[7]=y,t},Kr.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Kr.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Kr.getTranslation=function(t,e){var n=e[4],r=e[5],c=e[6],u=e[7],p=-e[0],g=-e[1],y=-e[2],x=e[3];return t[0]=2*(n*x+u*p+r*y-c*g),t[1]=2*(r*x+u*g+c*p-n*y),t[2]=2*(c*x+u*y+n*g-r*p),t},Kr.translate=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=.5*n[0],y=.5*n[1],x=.5*n[2],M=e[4],E=e[5],A=e[6],O=e[7];return t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=p*g+c*x-u*y+M,t[5]=p*y+u*g-r*x+E,t[6]=p*x+r*y-c*g+A,t[7]=-r*g-c*y-u*x+O,t},Kr.rotateX=function(t,e,n){var r=-e[0],c=-e[1],u=-e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=g*p+M*r+y*u-x*c,A=y*p+M*c+x*r-g*u,O=x*p+M*u+g*c-y*r,U=M*p-g*r-y*c-x*u;return Uc.rotateX(t,e,n),t[4]=E*(p=t[3])+U*(r=t[0])+A*(u=t[2])-O*(c=t[1]),t[5]=A*p+U*c+O*r-E*u,t[6]=O*p+U*u+E*c-A*r,t[7]=U*p-E*r-A*c-O*u,t},Kr.rotateY=function(t,e,n){var r=-e[0],c=-e[1],u=-e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=g*p+M*r+y*u-x*c,A=y*p+M*c+x*r-g*u,O=x*p+M*u+g*c-y*r,U=M*p-g*r-y*c-x*u;return Uc.rotateY(t,e,n),t[4]=E*(p=t[3])+U*(r=t[0])+A*(u=t[2])-O*(c=t[1]),t[5]=A*p+U*c+O*r-E*u,t[6]=O*p+U*u+E*c-A*r,t[7]=U*p-E*r-A*c-O*u,t},Kr.rotateZ=function(t,e,n){var r=-e[0],c=-e[1],u=-e[2],p=e[3],g=e[4],y=e[5],x=e[6],M=e[7],E=g*p+M*r+y*u-x*c,A=y*p+M*c+x*r-g*u,O=x*p+M*u+g*c-y*r,U=M*p-g*r-y*c-x*u;return Uc.rotateZ(t,e,n),t[4]=E*(p=t[3])+U*(r=t[0])+A*(u=t[2])-O*(c=t[1]),t[5]=A*p+U*c+O*r-E*u,t[6]=O*p+U*u+E*c-A*r,t[7]=U*p-E*r-A*c-O*u,t},Kr.rotateByQuatAppend=function(t,e,n){var r=n[0],c=n[1],u=n[2],p=n[3],g=e[0],y=e[1],x=e[2],M=e[3];return t[0]=g*p+M*r+y*u-x*c,t[1]=y*p+M*c+x*r-g*u,t[2]=x*p+M*u+g*c-y*r,t[3]=M*p-g*r-y*c-x*u,t[4]=(g=e[4])*p+(M=e[7])*r+(y=e[5])*u-(x=e[6])*c,t[5]=y*p+M*c+x*r-g*u,t[6]=x*p+M*u+g*c-y*r,t[7]=M*p-g*r-y*c-x*u,t},Kr.rotateByQuatPrepend=function(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=n[0],y=n[1],x=n[2],M=n[3];return t[0]=r*M+p*g+c*x-u*y,t[1]=c*M+p*y+u*g-r*x,t[2]=u*M+p*x+r*y-c*g,t[3]=p*M-r*g-c*y-u*x,t[4]=r*(M=n[7])+p*(g=n[4])+c*(x=n[6])-u*(y=n[5]),t[5]=c*M+p*y+u*g-r*x,t[6]=u*M+p*x+r*y-c*g,t[7]=p*M-r*g-c*y-u*x,t},Kr.rotateAroundAxis=function(t,e,n,r){if(Math.abs(r)<X1.EPSILON)return K6(t,e);var c=Math.hypot(n[0],n[1],n[2]);r*=.5;var u=Math.sin(r),p=u*n[0]/c,g=u*n[1]/c,y=u*n[2]/c,x=Math.cos(r),M=e[0],E=e[1],A=e[2],O=e[3];t[0]=M*x+O*p+E*y-A*g,t[1]=E*x+O*g+A*p-M*y,t[2]=A*x+O*y+M*g-E*p,t[3]=O*x-M*p-E*g-A*y;var U=e[4],W=e[5],ee=e[6],ae=e[7];return t[4]=U*x+ae*p+W*y-ee*g,t[5]=W*x+ae*g+ee*p-U*y,t[6]=ee*x+ae*y+U*g-W*p,t[7]=ae*x-U*p-W*g-ee*y,t},Kr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},Kr.multiply=X6,Kr.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},Kr.lerp=function(t,e,n,r){var c=1-r;return Cd(e,n)<0&&(r=-r),t[0]=e[0]*c+n[0]*r,t[1]=e[1]*c+n[1]*r,t[2]=e[2]*c+n[2]*r,t[3]=e[3]*c+n[3]*r,t[4]=e[4]*c+n[4]*r,t[5]=e[5]*c+n[5]*r,t[6]=e[6]*c+n[6]*r,t[7]=e[7]*c+n[7]*r,t},Kr.invert=function(t,e){var n=r0(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},Kr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Kr.normalize=function(t,e){var n=r0(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,c=e[1]/n,u=e[2]/n,p=e[3]/n,g=e[4],y=e[5],x=e[6],M=e[7],E=r*g+c*y+u*x+p*M;t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=(g-r*E)/n,t[5]=(y-c*E)/n,t[6]=(x-u*E)/n,t[7]=(M-p*E)/n}return t},Kr.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Kr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Kr.equals=function(t,e){var n=t[0],r=t[1],c=t[2],u=t[3],p=t[4],g=t[5],y=t[6],x=t[7],M=e[0],E=e[1],A=e[2],O=e[3],U=e[4],W=e[5],ee=e[6],ae=e[7];return Math.abs(n-M)<=X1.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(r-E)<=X1.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(c-A)<=X1.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-O)<=X1.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(p-U)<=X1.EPSILON*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(g-W)<=X1.EPSILON*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(y-ee)<=X1.EPSILON*Math.max(1,Math.abs(y),Math.abs(ee))&&Math.abs(x-ae)<=X1.EPSILON*Math.max(1,Math.abs(x),Math.abs(ae))},Kr.sqrLen=Kr.squaredLength=Kr.len=Kr.length=Kr.dot=Kr.mul=Kr.setReal=Kr.getReal=void 0;var X1=ns(ma),Uc=ns(gr),bd=ns(Ar);function wd(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(wd=function(r){return r?n:e})(t)}function ns(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==n0(t)&&"function"!=typeof t)return{default:t};var n=wd(e);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}function ku(t,e,n){var r=.5*n[0],c=.5*n[1],u=.5*n[2],p=e[0],g=e[1],y=e[2],x=e[3];return t[0]=p,t[1]=g,t[2]=y,t[3]=x,t[4]=r*x+c*y-u*g,t[5]=c*x+u*p-r*y,t[6]=u*x+r*g-c*p,t[7]=-r*p-c*g-u*y,t}function K6(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function X6(t,e,n){var r=e[0],c=e[1],u=e[2],p=e[3],g=n[4],y=n[5],x=n[6],M=n[7],E=e[4],A=e[5],O=e[6],U=e[7],W=n[0],ee=n[1],ae=n[2],be=n[3];return t[0]=r*be+p*W+c*ae-u*ee,t[1]=c*be+p*ee+u*W-r*ae,t[2]=u*be+p*ae+r*ee-c*W,t[3]=p*be-r*W-c*ee-u*ae,t[4]=r*M+p*g+c*x-u*y+E*be+U*W+A*ae-O*ee,t[5]=c*M+p*y+u*g-r*x+A*be+U*ee+O*W-E*ae,t[6]=u*M+p*x+r*y-c*g+O*be+U*ae+E*ee-A*W,t[7]=p*M-r*g-c*y-u*x+U*be-E*W-A*ee-O*ae,t}Kr.getReal=Uc.copy,Kr.setReal=Uc.copy,Kr.mul=X6;var Cd=Uc.dot;Kr.dot=Cd;var J6=Uc.length;Kr.length=J6,Kr.len=J6;var r0=Uc.squaredLength;Kr.squaredLength=r0,Kr.sqrLen=r0;var Pr={};function s0(t){return(s0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.create=Rp,Pr.clone=function(t){var e=new Xl.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Pr.fromValues=function(t,e){var n=new Xl.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Pr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Pr.set=function(t,e,n){return t[0]=e,t[1]=n,t},Pr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Pr.subtract=eh,Pr.multiply=Ru,Pr.divide=gl,Pr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Pr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Pr.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Pr.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Pr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Pr.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Pr.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},Pr.distance=th,Pr.squaredDistance=Ou,Pr.length=o0,Pr.squaredLength=Md,Pr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Pr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Pr.normalize=function(t,e){var n=e[0],r=e[1],c=n*n+r*r;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},Pr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Pr.cross=function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},Pr.lerp=function(t,e,n,r){var c=e[0],u=e[1];return t[0]=c+r*(n[0]-c),t[1]=u+r*(n[1]-u),t},Pr.random=function(t,e){e=e||1;var n=2*Xl.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Pr.transformMat2=function(t,e,n){var r=e[0],c=e[1];return t[0]=n[0]*r+n[2]*c,t[1]=n[1]*r+n[3]*c,t},Pr.transformMat2d=function(t,e,n){var r=e[0],c=e[1];return t[0]=n[0]*r+n[2]*c+n[4],t[1]=n[1]*r+n[3]*c+n[5],t},Pr.transformMat3=function(t,e,n){var r=e[0],c=e[1];return t[0]=n[0]*r+n[3]*c+n[6],t[1]=n[1]*r+n[4]*c+n[7],t},Pr.transformMat4=function(t,e,n){var r=e[0],c=e[1];return t[0]=n[0]*r+n[4]*c+n[12],t[1]=n[1]*r+n[5]*c+n[13],t},Pr.rotate=function(t,e,n,r){var c=e[0]-n[0],u=e[1]-n[1],p=Math.sin(r),g=Math.cos(r);return t[0]=c*g-u*p+n[0],t[1]=c*p+u*g+n[1],t},Pr.angle=function(t,e){var n=t[0],r=t[1],c=e[0],u=e[1],p=Math.sqrt(n*n+r*r)*Math.sqrt(c*c+u*u);return Math.acos(Math.min(Math.max(p&&(n*c+r*u)/p,-1),1))},Pr.zero=function(t){return t[0]=0,t[1]=0,t},Pr.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Pr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Pr.equals=function(t,e){var n=t[0],r=t[1],c=e[0],u=e[1];return Math.abs(n-c)<=Xl.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=Xl.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))},Pr.forEach=Pr.sqrLen=Pr.sqrDist=Pr.dist=Pr.div=Pr.mul=Pr.sub=Pr.len=void 0;var Xl=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==s0(t)&&"function"!=typeof t)return{default:t};var n=Q6(void 0);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}(ma);function Q6(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Q6=function(r){return r?n:e})(t)}function Rp(){var t=new Xl.ARRAY_TYPE(2);return Xl.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function eh(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Ru(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function gl(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function th(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Ou(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function o0(t){return Math.hypot(t[0],t[1])}function Md(t){var e=t[0],n=t[1];return e*e+n*n}Pr.len=o0,Pr.sub=eh,Pr.mul=Ru,Pr.div=gl,Pr.dist=th,Pr.sqrDist=Ou,Pr.sqrLen=Md;var dm=function(){var t=Rp();return function(e,n,r,c,u,p){var g,y;for(n||(n=2),r||(r=0),y=c?Math.min(c*n+r,e.length):e.length,g=r;g<y;g+=n)t[0]=e[g],t[1]=e[g+1],u(t,t,p),e[g]=t[0],e[g+1]=t[1];return e}}();function Sd(t){return(Sd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Pr.forEach=dm,Object.defineProperty(Ka,"__esModule",{value:!0}),s.a7=Ka.vec4=s.N=Ka.vec3=Ka.vec2=Ka.quat2=s.bi=Ka.quat=s.a6=Ka.mat4=s.co=Ka.mat3=Ka.mat2d=s.b4=Ka.mat2=Ka.glMatrix=void 0;var pm=zc(ma);Ka.glMatrix=pm;var Op=zc(Mo);s.b4=Ka.mat2=Op;var Td=zc(_o);Ka.mat2d=Td;var mm=zc(Es);s.co=Ka.mat3=mm;var Fu=zc(Ar);s.a6=Ka.mat4=Fu;var W3=zc(gr);s.bi=Ka.quat=W3;var Fp=zc(Kr);Ka.quat2=Fp;var Ed=zc(Pr);Ka.vec2=Ed;var Bu=zc(Lr);s.N=Ka.vec3=Bu;var Bp=zc(Gr);function a0(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(a0=function(r){return r?n:e})(t)}function zc(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Sd(t)&&"function"!=typeof t)return{default:t};var n=a0(e);if(n&&n.has(t))return n.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,n&&n.set(t,r),r}s.a7=Ka.vec4=Bp;class nh{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,r){const c=s.N.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;const u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return r[0]=this.pos[0]+this.dir[0]*u,r[1]=this.pos[1]+this.dir[1]*u,r[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,r){if(s.N.equals(this.pos,e)||0===n)return r[0]=r[1]=r[2]=0,!1;const[c,u,p]=this.dir,g=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],M=c*c+u*u+p*p,E=2*(g*c+y*u+x*p),A=E*E-4*M*(g*g+y*y+x*x-n*n);if(A<0){const O=Math.max(-E/2,0),U=g+c*O,W=y+u*O,ee=x+p*O,ae=Math.hypot(U,W,ee);return r[0]=U*n/ae,r[1]=W*n/ae,r[2]=ee*n/ae,!1}{const O=(-E-Math.sqrt(A))/(2*M);if(O<0){const U=Math.hypot(g,y,x);return r[0]=g*n/U,r[1]=y*n/U,r[2]=x*n/U,!1}return r[0]=g+c*O,r[1]=y+u*O,r[2]=x+p*O,!0}}}class Uu{constructor(e,n,r,c,u){this.TL=e,this.TR=n,this.BR=r,this.BL=c,this.horizon=u}static fromInvProjectionMatrix(e,n,r){const c=[-1,1,1],u=[1,1,1],p=[1,-1,1],g=[-1,-1,1],y=s.N.transformMat4(c,c,e),x=s.N.transformMat4(u,u,e),M=s.N.transformMat4(p,p,e),E=s.N.transformMat4(g,g,e);return new Uu(y,x,M,E,n/r)}}function c0(t,e,n){let r=1/0,c=-1/0;const u=[];for(const p of t){s.N.sub(u,p,e);const g=s.N.dot(u,n);r=Math.min(r,g),c=Math.max(c,g)}return[r,c]}function zd(t,e){let n=!0;for(let r=0;r<t.planes.length;r++){const c=t.planes[r];let u=0;for(let p=0;p<e.length;p++)u+=s.N.dot(c,e[p])+c[3]>=0;if(0===u)return 0;u!==e.length&&(n=!1)}return n?2:1}function ju(t,e){for(const n of t.projections){const r=c0(e,t.points[0],n.axis);if(n.projection[1]<r[0]||n.projection[0]>r[1])return 0}return 1}function Ad(t,e){let n=0;const r=[0,0,0,0];for(let c=0;c<t.length;c++)r[0]=t[c][0],r[1]=t[c][1],r[2]=t[c][2],r[3]=1,s.a7.dot(r,e)>=0&&n++;return n}class Gu{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=vo.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.N.sub([],this.points[2],this.points[3]),s.N.sub([],this.points[0],this.points[3]),s.N.sub([],this.points[4],this.points[0]),s.N.sub([],this.points[5],this.points[1]),s.N.sub([],this.points[6],this.points[2]),s.N.sub([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const c=[0,-r[2],r[1]],u=[r[2],0,-r[0]];this.projections.push({axis:c,projection:c0(this.points,this.points[0],c)}),this.projections.push({axis:u,projection:c0(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,r,c){const u=Math.pow(2,r),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const M=s.a7.transformMat4([],x,e),E=1/M[3]/n*u;return s.a7.mul(M,M,[E,E,c?1/M[3]:E,E])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const M=s.N.sub([],p[x[0]],p[x[1]]),E=s.N.sub([],p[x[2]],p[x[1]]),A=s.N.normalize([],s.N.cross([],M,E)),O=-s.N.dot(A,p[x[1]]);return A.concat(O)}),y=[];for(let x=0;x<p.length;x++)y.push([p[x][0],p[x][1],p[x][2]]);return new Gu(y,g)}intersectsPrecise(e,n,r){for(let c=0;c<n.length;c++)if(!Ad(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!Ad(e,this.planes[c]))return 0;for(const c of r)for(const u of this.frustumEdges){const p=s.N.cross([],c,u),g=s.N.length(p);if(0===g)continue;s.N.scale(p,p,1/g);const y=c0(this.points,this.points[0],p),x=c0(e,this.points[0],p);if(y[0]>x[1]||x[0]>y[1])return 0}return 1}}class vo{static fromPoints(e){const n=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const c of e)s.N.min(n,n,c),s.N.max(r,r,c);return new vo(n,r)}static fromTileIdAndHeight(e,n,r){const c=1<<e.canonical.z,u=e.canonical.x,p=e.canonical.y;return new vo([u/c,p/c,n],[(u+1)/c,(p+1)/c,r])}static applyTransform(e,n){const r=e.getCorners();for(let c=0;c<r.length;++c)s.N.transformMat4(r[c],r[c],n);return vo.fromPoints(r)}static projectAabbCorners(e,n){const r=e.getCorners();for(let c=0;c<r.length;++c)s.N.transformMat4(r[c],r[c],n);return r}constructor(e,n){this.min=e,this.max=n,this.center=s.N.scale([],s.N.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],r=s.N.clone(this.min),c=s.N.clone(this.max);for(let u=0;u<n.length;u++)r[u]=n[u]?this.min[u]:this.center[u],c[u]=n[u]?this.center[u]:this.max[u];return c[2]=this.max[2],new vo(r,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zd(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zd(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?ju(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?ju(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Xn(vo,"Aabb");const ih=cs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$u}=ih,rh=cs([{name:"a_pos_3",components:3,type:"Int16"}]);var Ld=cs([{name:"a_pos",type:"Int16",components:2}]);function sh(t){return t*Ce/Jt}const q3=[new vo([dt,dt,dt],[$t,$t,$t]),new vo([dt,dt,dt],[0,0,$t]),new vo([0,dt,dt],[$t,0,$t]),new vo([dt,0,dt],[0,$t,$t]),new vo([0,0,dt],[$t,$t,$t])];function l0(t,e,n,r=!0){const c=s.N.scale([],t._camera.position,t.worldSize),u=[e,n,1,1];s.a7.transformMat4(u,u,t.pixelMatrixInverse),s.a7.scale(u,u,1/u[3]);const p=s.N.sub([],u,c),g=s.N.normalize([],p),y=t.globeMatrix,x=[y[12],y[13],y[14]],M=s.N.sub([],x,c),E=s.N.length(M),A=s.N.normalize([],M),O=t.worldSize/(2*Math.PI),U=s.N.dot(A,g),W=Math.asin(O/E);if(W<Math.acos(U)){if(!r)return null;const Vt=[],un=[];s.N.scale(Vt,g,E/U),s.N.normalize(un,s.N.sub(un,Vt,M)),s.N.normalize(g,s.N.add(g,M,s.N.scale(g,un,Math.tan(W)*E)))}const ee=[];new nh(c,g).closestPointOnSphere(x,O,ee);const ae=s.N.normalize([],He(y,0)),be=s.N.normalize([],He(y,1)),Ee=s.N.normalize([],He(y,2)),Me=s.N.dot(ae,ee),We=s.N.dot(be,ee),Re=s.N.dot(Ee,ee),et=Pt(Math.asin(-We/O));let mt=Pt(Math.atan2(Me,Re));mt=t.center.lng+function(Vt,un){const yn=(un-Vt+180)%360-180;return yn<-180?yn+360:yn}(t.center.lng,mt);const Dt=ur(mt),Wt=Ot(ar(et),0,1);return new Jr(Dt,Wt)}class Up{constructor(e,n,r){this.a=s.N.sub([],e,r),this.b=s.N.sub([],n,r),this.center=r;const c=s.N.normalize([],this.a),u=s.N.normalize([],this.b);this.angle=Math.acos(s.N.dot(c,u))}}function Wu(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(r,c,u,p){const g=Math.sin(u);return r*(Math.sin((1-p)*u)/g)+c*(Math.sin(p*u)/g)}(t.a[e],t.b[e],t.angle,Ot(n,0,1))+t.center[e]}function q2(t){if(t.z<=1)return q3[t.z+2*t.y+t.x];const e=Ql(Z3(t));return vo.fromPoints(e)}function jc(t,e,n){return s.N.scale(t,t,1-n),s.N.scaleAndAdd(t,t,e,n)}function u0(t,e,n){for(const r of t)s.N.transformMat4(r,r,e),s.N.scale(r,r,n)}function Jl(t,e,n,r){const c=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){const Dt=q2(n).getCorners();return u0(Dt,u,c),vo.fromPoints(Dt)}const p=Z3(n,r),g=Ql(p,Ce+sh(t._tileCoverLift));u0(g,u,c);const y=Number.MAX_VALUE,x=[-y,-y,-y],M=[y,y,y];if(p.contains(t.center)){for(const Vt of g)s.N.min(M,M,Vt),s.N.max(x,x,Vt);x[2]=0;const Dt=t.point,Wt=[Dt.x*c,Dt.y*c,0];return s.N.min(M,M,Wt),s.N.max(x,x,Wt),new vo(M,x)}if(t._tileCoverLift>0){for(const Dt of g)s.N.min(M,M,Dt),s.N.max(x,x,Dt);return new vo(M,x)}const E=[u[12]*c,u[13]*c,u[14]*c],A=p.getCenter(),O=Ot(t.center.lat,-xr,xr),U=Ot(A.lat,-xr,xr),W=ur(t.center.lng),ee=ar(O);let ae=W-ur(A.lng);const be=ee-ar(U);ae>.5?ae-=1:ae<-.5&&(ae+=1);let Ee=0;if(Math.abs(ae)>Math.abs(be))Ee=ae>=0?1:3;else{Ee=be>=0?0:2;const Dt=[u[4]*c,u[5]*c,u[6]*c],Wt=-Math.sin(Ye(be>=0?p.getSouth():p.getNorth()))*Ce;s.N.scaleAndAdd(E,E,Dt,Wt)}const Me=g[Ee],We=g[(Ee+1)%4],Re=new Up(Me,We,E),et=[Wu(Re,0)||Me[0],Wu(Re,1)||Me[1],Wu(Re,2)||Me[2]],mt=_l(t.zoom);if(mt>0){const Dt=function({x:Vt,y:un,z:yn},tn,gn,Kt,pn){const Gn=1/(1<<yn);let wn=Vt*Gn,pi=wn+Gn,ni=un*Gn,Ln=ni+Gn,$i=0;const wi=(wn+pi)/2-Kt;return wi>.5?$i=-1:wi<-.5&&($i=1),wn=((wn+$i)*tn-(Kt*=tn))*gn+Kt,pi=((pi+$i)*tn-Kt)*gn+Kt,ni=(ni*tn-(pn*=tn))*gn+pn,Ln=(Ln*tn-pn)*gn+pn,[[wn,Ln,0],[pi,Ln,0],[pi,ni,0],[wn,ni,0]]}(n,e,t._pixelsPerMercatorPixel,W,ee);for(let Vt=0;Vt<g.length;Vt++)jc(g[Vt],Dt[Vt],mt);const Wt=s.N.add([],Dt[Ee],Dt[(Ee+1)%4]);s.N.scale(Wt,Wt,.5),jc(et,Wt,mt)}for(const Dt of g)s.N.min(M,M,Dt),s.N.max(x,x,Dt);return M[2]=Math.min(Me[2],We[2]),s.N.min(M,M,et),s.N.max(x,x,et),new vo(M,x)}function Z3({x:t,y:e,z:n},r=!1){const c=1/(1<<n),u=new Lt(mr(t*c),e===(1<<n)-1&&r?-90:Yr((e+1)*c)),p=new Lt(mr((t+1)*c),0===e&&r?90:Yr(e*c));return new Zt(u,p)}function Ql(t,e=Ce){const n=Ye(t.getNorth()),r=Ye(t.getSouth()),c=Math.cos(n),u=Math.cos(r),p=Math.sin(n),g=Math.sin(r),y=t.getWest(),x=t.getEast();return[Ct(u,g,y,e),Ct(u,g,x,e),Ct(c,p,x,e),Ct(c,p,y,e)]}function e3(t,e,n,r){const c=1<<n.z,u=(t/Rn+n.x)/c;return en(Yr((e/Rn+n.y)/c),mr(u),r)}function t3({min:t,max:e}){return Ie/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const qu=new Float64Array(16);function Y3(t){const e=t3(t),n=s.a6.fromScaling(qu,[e,e,e]);return s.a6.translate(n,n,s.N.negate([],t.min))}function K3(t){const e=s.a6.fromTranslation(qu,t.min),n=1/t3(t);return s.a6.scale(e,e,[n,n,n])}function h0(t){const e=Rn/(2*Math.PI);return t/(2*Math.PI)/e}function oh(t,e){return Rn/(512*Math.pow(2,t))*t3(q2(e))}function f0(t,e,n,r,c){const u=h0(n),p=[t,e,-n/(2*Math.PI)],g=s.a6.identity(new Float64Array(16));return s.a6.translate(g,g,p),s.a6.scale(g,g,[u,u,u]),s.a6.rotateX(g,g,Ye(-c)),s.a6.rotateY(g,g,Ye(-r)),g}function _l(t){return Xt(ze,ge,t)}function Dd(t,e){const n=en(e.lat,e.lng),r=function(u){const p=en(u._center.lat,u._center.lng),g=s.N.fromValues(0,1,0);let y=s.N.cross([],g,p);const x=s.a6.fromRotation([],-u.angle,p);y=s.N.transformMat4(y,y,x),s.a6.fromRotation(x,-u._pitch,y);const M=s.N.normalize([],p);return s.N.scale(M,M,sh(u.cameraToCenterDistance/u.pixelsPerMeter)),s.N.transformMat4(M,M,x),s.N.add([],p,M)}(t),c=s.N.subtract([],r,n);return s.N.angle(c,n)}function Zu(t,e){return Dd(t,e)>Math.PI/2*1.01}const Id=Ye(85),Yu=Math.cos(Id),Vd=Math.sin(Id),jp=s.a6.create(),ah=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function f2(t,e,n,r,c,u,p,g,y){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(y*=t.pixelToTileUnitsFactor);const x=t.tileID.canonical,M=n.projection.upVectorScale(x,n.center.lat,n.worldSize).metersToTile;for(const E of e)for(const A of E){const O=A.add(g),U=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(O.x,O.y,!0):0,W=n.projection.projectTilePoint(O.x,O.y,x);if(U>0){const Ee=n.projection.upVector(x,O.x,O.y);W.x+=Ee[0]*M*U,W.y+=Ee[1]*M*U,W.z+=Ee[2]*M*U}const ee=u?O:Hd(W.x,W.y,W.z,r),ae=u?t.tilespaceRays.map(Ee=>ch(Ee,U)):t.queryGeometry.screenGeometry,be=s.a7.transformMat4([],[W.x,W.y,W.z,1],r);if(!p&&u?y*=be[3]/n.cameraToCenterDistance:p&&!u&&(y*=n.cameraToCenterDistance/be[3]),u){const Ee=Yr((A.y/Rn+x.y)/(1<<x.z));y/=n.projection.pixelsPerMeter(Ee,1)/yr(1,Ee)}if(Sc(ae,ee,y))return!0}return!1}function Hd(t,e,n,r){const c=s.a7.transformMat4([],[t,e,n,1],r);return new Te(c[0]/c[3],c[1]/c[3])}const Pd=s.N.fromValues(0,0,0),Gp=s.N.fromValues(0,0,1);function ch(t,e){const n=s.N.create();return Pd[2]=e,t.intersectsPlane(Pd,Gp,n),new Te(n[0],n[1])}class lh extends R1{}function Nd(t,{width:e,height:n},r,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*r)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*r);return t.width=e,t.height=n,t.data=c,t}function uh(t,e,n){const{width:r,height:c}=e;r===t.width&&c===t.height||(hh(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,c)},n),t.width=r,t.height=c,t.data=e.data)}function hh(t,e,n,r,c,u,p){if(0===c.width||0===c.height)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||r.x>e.width-c.width||r.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=t.data,y=e.data,x=4===u&&p;for(let M=0;M<c.height;M++){const E=((n.y+M)*t.width+n.x)*u,A=((r.y+M)*e.width+r.x)*u;if(x)for(let O=0;O<c.width;O++){const U=E+O*u+3,W=A+O*u;y[W+0]=255,y[W+1]=255,y[W+2]=255,y[W+3]=g[U]}else for(let O=0;O<c.width*u;O++)y[A+O]=g[E+O]}return e}Xn(lh,"HeatmapBucket",{omit:["layers"]});class Gc{constructor(e,n){Nd(this,e,1,n)}resize(e){uh(this,new Gc(e),1)}clone(){return new Gc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,r,c,u){hh(e,n,r,c,u,1)}}class c2{constructor(e,n){Nd(this,e,4,n)}resize(e){uh(this,new c2(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new c2({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,r,c,u,p){hh(e,n,r,c,u,4,p)}}class kd{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Xn(Gc,"AlphaImage"),Xn(c2,"RGBAImage");const fh=new Co({visibility:new On(Rt.layout_heatmap.visibility)});var $p={paint:new Co({"heatmap-radius":new zi(Rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zi(Rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(Rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xc(Rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(Rt.paint_heatmap["heatmap-opacity"])}),layout:fh};function X3(t){const e={},n=t.resolution||256,r=t.clips?t.clips.length:1,c=t.image||new c2({width:n,height:r}),u=(p,g,y)=>{e[t.evaluationKey]=y;const x=t.expression.evaluate(e);x&&(c.data[p+g+0]=Math.floor(255*x.r/x.a),c.data[p+g+1]=Math.floor(255*x.g/x.a),c.data[p+g+2]=Math.floor(255*x.b/x.a),c.data[p+g+3]=Math.floor(255*x.a))};if(t.clips)for(let p=0,g=0;p<r;++p,g+=4*n)for(let y=0,x=0;y<n;y++,x+=4){const M=y/(n-1),{start:E,end:A}=t.clips[p];u(g,x,E*(1-M)+A*M)}else for(let p=0,g=0;p<n;p++,g+=4)u(0,g,p/(n-1));return c}const Wp=new Co({visibility:new On(Rt.layout_hillshade.visibility)});var Rd={paint:new Co({"hillshade-illumination-direction":new On(Rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(Rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(Rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(Rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(Rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(Rt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new On(Rt.paint_hillshade["hillshade-emissive-strength"])}),layout:Wp};const qp=cs([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ac}=qp;var J3={exports:{}};function Ku(t,e,n){n=n||2;var r,c,u,p,g,y,x,M=e&&e.length,E=M?e[0]*n:t.length,A=Od(t,0,E,n,!0),O=[];if(!A||A.next===A.prev)return O;if(M&&(A=function(W,ee,ae,be){var Ee,Me,We,Re=[];for(Ee=0,Me=ee.length;Ee<Me;Ee++)(We=Od(W,ee[Ee]*be,Ee<Me-1?ee[Ee+1]*be:W.length,be,!1))===We.next&&(We.steiner=!0),Re.push(gm(We));for(Re.sort(Xp),Ee=0;Ee<Re.length;Ee++)ae=d0(Re[Ee],ae);return ae}(t,e,A,n)),t.length>80*n){r=u=t[0],c=p=t[1];for(var U=n;U<E;U+=n)(g=t[U])<r&&(r=g),(y=t[U+1])<c&&(c=y),g>u&&(u=g),y>p&&(p=y);x=0!==(x=Math.max(u-r,p-c))?32767/x:0}return n3(A,O,n,r,c,x,0),O}function Od(t,e,n,r,c){var u,p;if(c===Qu(t,e,n,r)>0)for(u=e;u<n;u+=r)p=g0(u,t[u],t[u+1],p);else for(u=n-r;u>=e;u-=r)p=g0(u,t[u],t[u+1],p);return p&&p0(p,p.next)&&($c(p),p=p.next),p}function vl(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!p0(r,r.next)&&0!==ga(r.prev,r,r.next))r=r.next;else{if($c(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function n3(t,e,n,r,c,u,p){if(t){!p&&u&&function(M,E,A,O){var U=M;do{0===U.z&&(U.z=i3(U.x,U.y,E,A,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next}while(U!==M);U.prevZ.nextZ=null,U.prevZ=null,function(W){var ee,ae,be,Ee,Me,We,Re,et,mt=1;do{for(ae=W,W=null,Me=null,We=0;ae;){for(We++,be=ae,Re=0,ee=0;ee<mt&&(Re++,be=be.nextZ);ee++);for(et=mt;Re>0||et>0&&be;)0!==Re&&(0===et||!be||ae.z<=be.z)?(Ee=ae,ae=ae.nextZ,Re--):(Ee=be,be=be.nextZ,et--),Me?Me.nextZ=Ee:W=Ee,Ee.prevZ=Me,Me=Ee;ae=be}Me.nextZ=null,mt*=2}while(We>1)}(U)}(t,r,c,u);for(var g,y,x=t;t.prev!==t.next;)if(g=t.prev,y=t.next,u?Yp(t,r,c,u):Zp(t))e.push(g.i/n|0),e.push(t.i/n|0),e.push(y.i/n|0),$c(t),t=y.next,x=y.next;else if((t=y)===x){p?1===p?n3(t=dh(vl(t),e,n),e,n,r,c,u,2):2===p&&Kp(t,e,n,r,c,u):n3(vl(t),e,n,r,c,u,1);break}}}function Zp(t){var e=t.prev,n=t,r=t.next;if(ga(e,n,r)>=0)return!1;for(var c=e.x,u=n.x,p=r.x,g=e.y,y=n.y,x=r.y,M=c<u?c<p?c:p:u<p?u:p,E=g<y?g<x?g:x:y<x?y:x,A=c>u?c>p?c:p:u>p?u:p,O=g>y?g>x?g:x:y>x?y:x,U=r.next;U!==e;){if(U.x>=M&&U.x<=A&&U.y>=E&&U.y<=O&&yl(c,g,u,y,p,x,U.x,U.y)&&ga(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Yp(t,e,n,r){var c=t.prev,u=t,p=t.next;if(ga(c,u,p)>=0)return!1;for(var g=c.x,y=u.x,x=p.x,M=c.y,E=u.y,A=p.y,O=g<y?g<x?g:x:y<x?y:x,U=M<E?M<A?M:A:E<A?E:A,W=g>y?g>x?g:x:y>x?y:x,ee=M>E?M>A?M:A:E>A?E:A,ae=i3(O,U,e,n,r),be=i3(W,ee,e,n,r),Ee=t.prevZ,Me=t.nextZ;Ee&&Ee.z>=ae&&Me&&Me.z<=be;){if(Ee.x>=O&&Ee.x<=W&&Ee.y>=U&&Ee.y<=ee&&Ee!==c&&Ee!==p&&yl(g,M,y,E,x,A,Ee.x,Ee.y)&&ga(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Me.x>=O&&Me.x<=W&&Me.y>=U&&Me.y<=ee&&Me!==c&&Me!==p&&yl(g,M,y,E,x,A,Me.x,Me.y)&&ga(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;Ee&&Ee.z>=ae;){if(Ee.x>=O&&Ee.x<=W&&Ee.y>=U&&Ee.y<=ee&&Ee!==c&&Ee!==p&&yl(g,M,y,E,x,A,Ee.x,Ee.y)&&ga(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Me&&Me.z<=be;){if(Me.x>=O&&Me.x<=W&&Me.y>=U&&Me.y<=ee&&Me!==c&&Me!==p&&yl(g,M,y,E,x,A,Me.x,Me.y)&&ga(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function dh(t,e,n){var r=t;do{var c=r.prev,u=r.next.next;!p0(c,u)&&ph(c,r,r.next,u)&&S2(c,u)&&S2(u,c)&&(e.push(c.i/n|0),e.push(r.i/n|0),e.push(u.i/n|0),$c(r),$c(r.next),r=t=u),r=r.next}while(r!==t);return vl(r)}function Kp(t,e,n,r,c,u){var p=t;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&_m(p,g)){var y=Q3(p,g);return p=vl(p,p.next),y=vl(y,y.next),n3(p,e,n,r,c,u,0),void n3(y,e,n,r,c,u,0)}g=g.next}p=p.next}while(p!==t)}function Xp(t,e){return t.x-e.x}function d0(t,e){var n=function(c,u){var p,g=u,y=c.x,x=c.y,M=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){var E=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(E<=y&&E>M&&(M=E,p=g.x<g.next.x?g:g.next,E===y))return p}g=g.next}while(g!==u);if(!p)return null;var A,O=p,U=p.x,W=p.y,ee=1/0;g=p;do{y>=g.x&&g.x>=U&&y!==g.x&&yl(x<W?y:M,x,U,W,x<W?M:y,x,g.x,g.y)&&(A=Math.abs(x-g.y)/(y-g.x),S2(g,c)&&(A<ee||A===ee&&(g.x>p.x||g.x===p.x&&Xu(p,g)))&&(p=g,ee=A)),g=g.next}while(g!==O);return p}(t,e);if(!n)return e;var r=Q3(n,t);return vl(r,r.next),vl(n,n.next)}function Xu(t,e){return ga(t.prev,t,e.prev)<0&&ga(e.next,t,t.next)<0}function i3(t,e,n,r,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function gm(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function yl(t,e,n,r,c,u,p,g){return(c-p)*(e-g)>=(t-p)*(u-g)&&(t-p)*(r-g)>=(n-p)*(e-g)&&(n-p)*(u-g)>=(c-p)*(r-g)}function _m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,r){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==r.i&&c.next.i!==r.i&&ph(c,c.next,n,r))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(S2(t,e)&&S2(e,t)&&function(n,r){var c=n,u=!1,p=(n.x+r.x)/2,g=(n.y+r.y)/2;do{c.y>g!=c.next.y>g&&c.next.y!==c.y&&p<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(u=!u),c=c.next}while(c!==n);return u}(t,e)&&(ga(t.prev,t,e.prev)||ga(t,e.prev,e))||p0(t,e)&&ga(t.prev,t,t.next)>0&&ga(e.prev,e,e.next)>0)}function ga(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function p0(t,e){return t.x===e.x&&t.y===e.y}function ph(t,e,n,r){var c=r3(ga(t,e,n)),u=r3(ga(t,e,r)),p=r3(ga(n,r,t)),g=r3(ga(n,r,e));return c!==u&&p!==g||!(0!==c||!m0(t,n,e))||!(0!==u||!m0(t,r,e))||!(0!==p||!m0(n,t,r))||!(0!==g||!m0(n,e,r))}function m0(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function r3(t){return t>0?1:t<0?-1:0}function S2(t,e){return ga(t.prev,t,t.next)<0?ga(t,e,t.next)>=0&&ga(t,t.prev,e)>=0:ga(t,e,t.prev)<0||ga(t,t.next,e)<0}function Q3(t,e){var n=new Ju(t.i,t.x,t.y),r=new Ju(e.i,e.x,e.y),c=t.next,u=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,r.next=n,n.prev=r,u.next=r,r.prev=u,r}function g0(t,e,n,r){var c=new Ju(t,e,n);return r?(c.next=r.next,c.prev=r,r.next.prev=c,r.next=c):(c.prev=c,c.next=c),c}function $c(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ju(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qu(t,e,n,r){for(var c=0,u=e,p=n-r;u<n;u+=r)c+=(t[p]-t[u])*(t[u+1]+t[p+1]),p=u;return c}J3.exports=Ku,J3.exports.default=Ku,Ku.deviation=function(t,e,n,r){var c=e&&e.length,u=Math.abs(Qu(t,0,c?e[0]*n:t.length,n));if(c)for(var p=0,g=e.length;p<g;p++)u-=Math.abs(Qu(t,e[p]*n,p<g-1?e[p+1]*n:t.length,n));var y=0;for(p=0;p<r.length;p+=3){var x=r[p]*n,M=r[p+1]*n,E=r[p+2]*n;y+=Math.abs((t[x]-t[E])*(t[M+1]-t[x+1])-(t[x]-t[M])*(t[E+1]-t[x+1]))}return 0===u&&0===y?0:Math.abs((y-u)/u)},Ku.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,c=0;c<t.length;c++){for(var u=0;u<t[c].length;u++)for(var p=0;p<e;p++)n.vertices.push(t[c][u][p]);c>0&&n.holes.push(r+=t[c-1].length)}return n};var _0=En(J3.exports);function mh(t,e){const n=t.length;if(n<=1)return[t];const r=[];let c,u;for(let p=0;p<n;p++){const g=Br(t[p]);0!==g&&(t[p].area=Math.abs(g),void 0===u&&(u=g<0),u===g<0?(c&&r.push(c),c=[t[p]]):c.push(t[p]))}if(c&&r.push(c),e>1)for(let p=0;p<r.length;p++)r[p].length<=e||(D2(r[p],e,1,r[p].length-1,Jp),r[p]=r[p].slice(0,e));return r}function Jp(t,e){return e.area-t.area}function s3(t,e,n){const r=n.patternDependencies;let c=!1;for(const u of e){const p=u.paint.get(`${t}-pattern`);p.isConstant()||(c=!0);const g=p.constantOr(null);g&&(c=!0,r[g]=!0)}return c}function gh(t,e,n,r,c){const u=c.patternDependencies;for(const p of e){const g=p.paint.get(`${t}-pattern`).value;if("constant"!==g.kind){let y=g.evaluate({zoom:r},n,{},c.availableImages);y=y&&y.name?y.name:y,u[y]=!0,n.patterns[p.id]=y}}return n}class Fd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new R2,this.indexArray=new Pa,this.indexArray2=new B2,this.programConfigurations=new le(e.layers,e.zoom),this.segments=new Ro,this.segments2=new Ro,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,r,c){this.hasPattern=s3("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:g,id:y,index:x,sourceLayerIndex:M}of e){const E=this.layers[0]._featureFilter.needGeometry,A=no(g,E);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),A,r))continue;const O=u?u.evaluate(A,{},r,n.availableImages):void 0,U={id:y,properties:g.properties,type:g.type,sourceLayerIndex:M,index:x,geometry:E?A.geometry:ra(g,r,c),patterns:{},sortKey:O};p.push(U)}u&&p.sort((g,y)=>g.sortKey-y.sortKey);for(const g of p){const{geometry:y,index:x,sourceLayerIndex:M}=g;if(this.hasPattern){const E=gh("fill",this.layers,g,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(g,y,x,r,{},n.availableImages,n.brightness);n.featureIndex.insert(e[x].feature,y,x,M,this.index)}}update(e,n,r,c,u){const p=0!==Object.keys(e).length;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,r,c,u)}addFeatures(e,n,r,c,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,r,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ac),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,r,c,u,p=[],g){for(const y of mh(n,500)){let x=0;for(const W of y)x+=W.length;const M=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),E=M.vertexLength,A=[],O=[];for(const W of y){if(0===W.length)continue;W!==y[0]&&O.push(A.length/2);const ee=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),ae=ee.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(ae+W.length-1,ae),A.push(W[0].x),A.push(W[0].y);for(let be=1;be<W.length;be++)this.layoutVertexArray.emplaceBack(W[be].x,W[be].y),this.indexArray2.emplaceBack(ae+be-1,ae+be),A.push(W[be].x),A.push(W[be].y);ee.vertexLength+=W.length,ee.primitiveLength+=W.length}const U=_0(A,O);for(let W=0;W<U.length;W+=3)this.indexArray.emplaceBack(E+U[W],E+U[W+1],E+U[W+2]);M.vertexLength+=x,M.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,c,g)}}Xn(Fd,"FillBucket",{omit:["layers","patternFeatures"]});const Qp=new Co({"fill-sort-key":new zi(Rt.layout_fill["fill-sort-key"]),visibility:new On(Rt.layout_fill.visibility)});var Bd={paint:new Co({"fill-antialias":new On(Rt.paint_fill["fill-antialias"]),"fill-opacity":new zi(Rt.paint_fill["fill-opacity"]),"fill-color":new zi(Rt.paint_fill["fill-color"]),"fill-outline-color":new zi(Rt.paint_fill["fill-outline-color"]),"fill-translate":new On(Rt.paint_fill["fill-translate"]),"fill-translate-anchor":new On(Rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new zi(Rt.paint_fill["fill-pattern"]),"fill-emissive-strength":new On(Rt.paint_fill["fill-emissive-strength"])}),layout:Qp};const e5=cs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),t5=cs([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),n5=cs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ud=cs([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),i5=cs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:_h}=e5;var e4={},r5=Vn,e6=t4;function t4(t,e,n,r,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=c,t.readFields(jd,this,e)}function jd(t,e,n){1==t?e.id=n.readVarint():2==t?function(r,c){for(var u=r.readVarint()+r.pos;r.pos<u;){var p=c._keys[r.readVarint()],g=c._values[r.readVarint()];c.properties[p]=g}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function s5(t){for(var e,n,r=0,c=0,u=t.length,p=u-1;c<u;p=c++)r+=((n=t[p]).x-(e=t[c]).x)*(e.y+n.y);return r}t4.types=["Unknown","Point","LineString","Polygon"],t4.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,c=0,u=0,p=0,g=[];t.pos<n;){if(c<=0){var y=t.readVarint();r=7&y,c=y>>3}if(c--,1===r||2===r)u+=t.readSVarint(),p+=t.readSVarint(),1===r&&(e&&g.push(e),e=[]),e.push(new r5(u,p));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&g.push(e),g},t4.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,c=0,u=0,p=1/0,g=-1/0,y=1/0,x=-1/0;t.pos<e;){if(r<=0){var M=t.readVarint();n=7&M,r=M>>3}if(r--,1===n||2===n)(c+=t.readSVarint())<p&&(p=c),c>g&&(g=c),(u+=t.readSVarint())<y&&(y=u),u>x&&(x=u);else if(7!==n)throw new Error("unknown command "+n)}return[p,y,g,x]},t4.prototype.toGeoJSON=function(t,e,n){var r,c,u=this.extent*Math.pow(2,n),p=this.extent*t,g=this.extent*e,y=this.loadGeometry(),x=t4.types[this.type];function M(O){for(var U=0;U<O.length;U++){var W=O[U];O[U]=[360*(W.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+g)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(r=0;r<y.length;r++)E[r]=y[r][0];M(y=E);break;case 2:for(r=0;r<y.length;r++)M(y[r]);break;case 3:for(y=function(O){var U=O.length;if(U<=1)return[O];for(var W,ee,ae=[],be=0;be<U;be++){var Ee=s5(O[be]);0!==Ee&&(void 0===ee&&(ee=Ee<0),ee===Ee<0?(W&&ae.push(W),W=[O[be]]):W.push(O[be]))}return W&&ae.push(W),ae}(y),r=0;r<y.length;r++)for(c=0;c<y[r].length;c++)M(y[r][c])}1===y.length?y=y[0]:x="Multi"+x;var A={type:"Feature",geometry:{type:x,coordinates:y},properties:this.properties};return"id"in this&&(A.id=this.id),A};var Gd=e6,$d=Wd;function Wd(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(o5,this,e),this.length=this._features.length}function o5(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(r){for(var c=null,u=r.readVarint()+r.pos;r.pos<u;){var p=r.readVarint()>>3;c=1===p?r.readString():2===p?r.readFloat():3===p?r.readDouble():4===p?r.readVarint64():5===p?r.readVarint():6===p?r.readSVarint():7===p?r.readBoolean():null}return c}(n))}Wd.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Gd(this._pbf,e,this.extent,this._keys,this._values)};var vh=$d;function qd(t,e,n){if(3===t){var r=new vh(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}var v0=e4.VectorTile=function(t,e){this.layers=t.readFields(qd,{},e)},yh=e4.VectorTileFeature=e6;function y0(t,e,n,r){const c=[],u=0===r?(p,g,y,x,M,E)=>{p.push(new Te(E,y+(E-g)/(x-g)*(M-y)))}:(p,g,y,x,M,E)=>{p.push(new Te(g+(E-y)/(M-y)*(x-g),E))};for(const p of t){const g=[];for(const y of p){if(y.length<=2)continue;const x=[];for(let A=0;A<y.length-1;A++){const O=y[A].x,U=y[A].y,W=y[A+1].x,ee=y[A+1].y,ae=0===r?O:U,be=0===r?W:ee;ae<e?be>e&&u(x,O,U,W,ee,e):ae>n?be<n&&u(x,O,U,W,ee,n):x.push(y[A]),be<e&&ae>=e&&u(x,O,U,W,ee,e),be>n&&ae<=n&&u(x,O,U,W,ee,n)}let M=y[y.length-1];const E=0===r?M.x:M.y;E>=e&&E<=n&&x.push(M),x.length&&(M=x[x.length-1],x[0].x===M.x&&x[0].y===M.y||x.push(x[0]),g.push(x))}g.length&&c.push(g)}return c}function xh(t,e){return t.x-e.x||t.y-e.y}function n4(t,e){return 0===xh(t.min,e.min)&&0===xh(t.max,e.max)}function Zd(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Yd(t,e,n){const r=1/Rn,c=1/(1<<n.canonical.z),u=(e.x*r+n.canonical.x)*c+n.wrap,p=(e.y*r+n.canonical.y)*c;return{min:new Te((t.x*r+n.canonical.x)*c+n.wrap,(t.y*r+n.canonical.y)*c),max:new Te(u,p)}}function bh(t,e,n){const r=1<<n.canonical.z,c=((e.x-n.wrap)*r-n.canonical.x)*Rn,u=(e.y*r-n.canonical.y)*Rn;return{min:new Te(((t.x-n.wrap)*r-n.canonical.x)*Rn,(t.y*r-n.canonical.y)*Rn),max:new Te(c,u)}}function Kd(t,e,n,r,c,u,p){const g=t.indices,y=t.vertices,x=[];for(let M=r;M<r+c;M+=3){const E=e[n[M+0]+u],A=e[n[M+1]+u],O=e[n[M+2]+u],U=Math.min(E.x,A.x,O.x),W=Math.max(E.x,A.x,O.x),ee=Math.min(E.y,A.y,O.y),ae=Math.max(E.y,A.y,O.y);x.length=0,t.grid.query(new Te(U,ee),new Te(W,ae),x);for(let be=0;be<x.length;be++){const Ee=x[be];if(q4(y[g[3*Ee+0]],y[g[3*Ee+1]],y[g[3*Ee+2]],E,A,O,p))return!0}}return!1}function Z2(t,e,n,r){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(r.canonical)||e.wrap!==r.wrap){if(n.vertices.length<t.vertices.length)return Z2(n,r,t,e);const u=e.canonical,p=r.canonical,g=Math.pow(2,p.z-u.z);c=t.vertices.map(y=>new Te(y.x*u.x*Rn*g-p.x*Rn,y.y*u.y*Rn*g-p.y*Rn))}return Kd(n,c,t.indices,0,t.indices.length,0,0)}e4.VectorTileLayer=$d;class i4{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const r=this.toIdx(e,n);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function O1(t,e,n,r){let c=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(r[p])<1e-15){if(n[p]<t[p]||n[p]>e[p])return null}else{const g=1/r[p];let y=(t[p]-n[p])*g,x=(e[p]-n[p])*g;if(y>x){const M=y;y=x,x=M}if(y>c&&(c=y),x<u&&(u=x),c>u)return null}return c}function xl(t,e,n,r,c,u,p,g,y,x,M){const E=r-t,A=c-e,O=u-n,U=p-t,W=g-e,ee=y-n,ae=M[1]*ee-M[2]*W,be=M[2]*U-M[0]*ee,Ee=M[0]*W-M[1]*U,Me=E*ae+A*be+O*Ee;if(Math.abs(Me)<1e-15)return null;const We=1/Me,Re=x[0]-t,et=x[1]-e,mt=x[2]-n,Dt=(Re*ae+et*be+mt*Ee)*We;if(Dt<0||Dt>1)return null;const Wt=et*O-mt*A,Vt=mt*E-Re*O,un=Re*A-et*E,yn=(M[0]*Wt+M[1]*Vt+M[2]*un)*We;return yn<0||Dt+yn>1?null:(U*Wt+W*Vt+ee*un)*We}function x0(t,e,n){return(t-e)/(n-e)}function d2(t,e,n,r,c,u,p,g,y){const x=1<<n,M=u-r,E=p-c,A=(t+1)/x*M+r,O=(e+0)/x*E+c,U=(e+1)/x*E+c;g[0]=(t+0)/x*M+r,g[1]=O,y[0]=A,y[1]=U}class t6{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(u){const p=Math.ceil(Math.log2(u.dim/8)),g=[];let y=Math.ceil(Math.pow(2,p));const x=1/y,M=(O,U,W,ee,ae)=>{const be=ee?1:0,Ee=(O+1)*W-be,Me=U*W,We=(U+1)*W-be;ae[0]=O*W,ae[1]=Me,ae[2]=Ee,ae[3]=We};let E=new i4(y);const A=[];for(let O=0;O<y*y;O++){M(O%y,Math.floor(O/y),x,!1,A);const U=T2(A[0],A[1],u),W=T2(A[2],A[1],u),ee=T2(A[2],A[3],u),ae=T2(A[0],A[3],u);E.minimums.push(Math.min(U,W,ee,ae)),E.maximums.push(Math.max(U,W,ee,ae)),E.leaves.push(1)}for(g.push(E),y/=2;y>=1;y/=2){const O=g[g.length-1];E=new i4(y);for(let U=0;U<y*y;U++){M(U%y,Math.floor(U/y),2,!0,A);const W=O.getElevation(A[0],A[1]),ee=O.getElevation(A[2],A[1]),ae=O.getElevation(A[2],A[3]),be=O.getElevation(A[0],A[3]),Ee=O.isLeaf(A[0],A[1]),Me=O.isLeaf(A[2],A[1]),We=O.isLeaf(A[2],A[3]),Re=O.isLeaf(A[0],A[3]),et=Math.min(W.min,ee.min,ae.min,be.min),mt=Math.max(W.max,ee.max,ae.max,be.max),Dt=Ee&&Me&&We&&Re;E.maximums.push(mt),E.minimums.push(et),E.leaves.push(mt-et<=5&&Dt?1:0)}g.push(E)}return g}(this.dem),r=n.length-1,c=n[r];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,r,0)}raycastRoot(e,n,r,c,u,p,g=1){return O1([e,n,-100],[r,c,this.maximums[0]*g],u,p)}raycast(e,n,r,c,u,p,g=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,n,r,c,u,p,g);if(null==y)return null;const x=[],M=[],E=[],A=[],O=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:U,t:W,nodex:ee,nodey:ae,depth:be}=O.pop();if(this.leaves[U]){d2(ee,ae,be,e,n,r,c,E,A);const Me=1<<be,We=(ee+0)/Me,Re=(ee+1)/Me,et=(ae+0)/Me,mt=(ae+1)/Me,Dt=T2(We,et,this.dem)*g,Wt=T2(Re,et,this.dem)*g,Vt=T2(Re,mt,this.dem)*g,un=T2(We,mt,this.dem)*g,yn=xl(E[0],E[1],Dt,A[0],E[1],Wt,A[0],A[1],Vt,u,p),tn=xl(A[0],A[1],Vt,E[0],A[1],un,E[0],E[1],Dt,u,p),gn=Math.min(null!==yn?yn:Number.MAX_VALUE,null!==tn?tn:Number.MAX_VALUE);if(gn!==Number.MAX_VALUE)return gn;{const Kt=s.N.scaleAndAdd([],u,p,W);if(o3(Dt,Wt,un,Vt,x0(Kt[0],E[0],A[0]),x0(Kt[1],E[1],A[1]))>=Kt[2])return W}continue}let Ee=0;for(let Me=0;Me<this._siblingOffset.length;Me++){d2((ee<<1)+this._siblingOffset[Me][0],(ae<<1)+this._siblingOffset[Me][1],be+1,e,n,r,c,E,A),E[2]=-100,A[2]=this.maximums[this.childOffsets[U]+Me]*g;const We=O1(E,A,u,p);if(null!=We){const Re=We;x[Me]=Re;let et=!1;for(let mt=0;mt<Ee&&!et;mt++)Re>=x[M[mt]]&&(M.splice(mt,0,Me),et=!0);et||(M[Ee]=Me),Ee++}}for(let Me=0;Me<Ee;Me++){const We=M[Me];O.push({idx:this.childOffsets[U]+We,t:x[We],nodex:(ee<<1)+this._siblingOffset[We][0],nodey:(ae<<1)+this._siblingOffset[We][1],depth:be+1})}}return null}_addNode(e,n,r){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,r,c,u){if(1===e[c].isLeaf(n,r))return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=c-1,g=e[p];let y=0,x=0;for(let M=0;M<this._siblingOffset.length;M++){const E=2*n+this._siblingOffset[M][0],A=2*r+this._siblingOffset[M][1],O=g.getElevation(E,A),U=g.isLeaf(E,A),W=this._addNode(O.min,O.max,U);U&&(y|=1<<M),x||(x=W)}for(let M=0;M<this._siblingOffset.length;M++)y&1<<M||this._construct(e,2*n+this._siblingOffset[M][0],2*r+this._siblingOffset[M][1],p,x+M)}}function o3(t,e,n,r,c,u){return Pi(Pi(t,n,u),Pi(e,r,u),c)}function T2(t,e,n){const r=n.dim,c=Ot(t*r-.5,0,r-1),u=Ot(e*r-.5,0,r-1),p=Math.floor(c),g=Math.floor(u),y=Math.min(p+1,r-1),x=Math.min(g+1,r-1);return o3(n.get(p,g),n.get(y,g),n.get(p,x),n.get(y,x),c-p,u-g)}const r4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function a3(t,e,n){return(256*t*256+256*e+n)/10-1e4}function c3(t,e,n){return 256*t+e+n/256-32768}class Wc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,r,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return Ii(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const u=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let y=0;y<u;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(u,y)]=p[this._idx(u-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,u)]=p[this._idx(y,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)]}const g="terrarium"===r?c3:a3;for(let y=0;y<p.length;++y){const x=4*y;this.floatView[y]=g(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=It.now()}_buildQuadTree(){this._tree=new t6(this)}get(e,n,r=!1){r&&(e=Ot(e,-1,this.dim),n=Ot(n,-1,this.dim));const c=this._idx(e,n);return this.floatView[c]}set(e,n,r){const c=this._idx(e,n),u=this.floatView[c];return this.floatView[c]=r,r-u}static getUnpackVector(e){return r4[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const r=[0,0,0,0],c=Wc.getUnpackVector(n);let u=Math.floor((e+c[3])/c[2]);return r[2]=u%256,u=Math.floor(u/256),r[1]=u%256,u=Math.floor(u/256),r[0]=u,r}getPixels(){return new kd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,u=n*this.dim+this.dim,p=r*this.dim,g=r*this.dim+this.dim;switch(n){case-1:c=u-1;break;case 1:u=c+1}switch(r){case-1:p=g-1;break;case 1:g=p+1}const y=-n*this.dim,x=-r*this.dim;for(let M=p;M<g;M++)for(let E=c;E<u;E++){const A=4*this._idx(E,M),O=4*this._idx(E+y,M+x);this.pixels[A+0]=e.pixels[O+0],this.pixels[A+1]=e.pixels[O+1],this.pixels[A+2]=e.pixels[O+2],this.pixels[A+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xn(Wc,"DEMData"),Xn(t6,"DemMinMaxQuadTree",{omit:["dem"]});class cc{constructor(e,n,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=r}static create(e,n,r){const c=r||e.findDEMTileFor(n);if(!c||!c.dem)return;const u=c.dem,p=c.tileID,g=1<<n.canonical.z-p.canonical.z;return new cc(c,u.dim/Rn/g,[(n.canonical.x/g-p.canonical.x)*u.dim,(n.canonical.y/g-p.canonical.y)*u.dim])}tileCoordToPixel(e,n){const r=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(r);return new Te(c,u)}getElevationAt(e,n,r,c){const u=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],g=Math.floor(u),y=Math.floor(p),x=this._dem;return c=!!c,r?Pi(Pi(x.get(g,y,c),x.get(g,y+1,c),p-y),Pi(x.get(g+1,y,c),x.get(g+1,y+1,c),p-y),u-g):x.get(g,y,c)}getElevationAtPixel(e,n,r){return this._dem.get(e,n,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yr(1,e)*this._dem.stride}}const l3=yh.types,s4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Xd=["fill-extrusion-flood-light-ground-radius"],Jd=Math.pow(2,13),wh=Math.pow(2,15)-1,Ch=new Te(0,1),qc=2147483648;function bl(t,e,n,r,c,u,p,g){t.emplaceBack((e<<1)+p,(n<<1)+u,(Math.floor(r*Jd)<<1)+c,Math.round(g))}function b0(t,e,n,r,c,u){t.emplaceBack(e.x,e.y,(n.x<<1)+r,(n.y<<1)+c,u)}function o4(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Mh{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Qd{constructor(){this.centroidXY=new Te(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Te(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Te(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Te(this.max.x-this.min.x,this.max.y-this.min.y)}}class e8{constructor(){this.acc=new Te(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,r){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((0===n.x||n.x===Rn)&&n.x===r.x)!=((0===n.y||n.y===Rn)&&n.y===r.y)&&this.processBorderOverlap(n,r),c&&this.checkBorderIntersection(n,r)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Pi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Rn!=e.x>Rn&&this.addBorderIntersection(1,Pi(n.y,e.y,(Rn-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Pi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Rn!=e.y>Rn&&this.addBorderIntersection(3,Pi(n.x,e.x,(Rn-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];n<r[0]&&(r[0]=n),n>r[1]&&(r[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,n.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,n.x),this.addBorderIntersection(r,e.x)}}centroid(){return 0===this.accCount?new Te(0,0):new Te(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function Sh(t,e){const n=t.add(e)._unit(),r=Ot(t.x*n.x+t.y*n.y,-1,1);var c,u,p;return c=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(c)))/4*wh*((u=t).x*(p=e).y-u.y*p.x<0?-1:1)}const a5=[t=>t.x<0,t=>t.x>Rn,t=>t.y<0,t=>t.y>Rn];function Th(t,e,n,r){const c=[4];if(0===r)return c;n._mult(r);const u=t.sub(n),p=e.sub(n),g=[t,e,u,p];for(let y=0;y<4;y++)for(const x of g)if(a5[y](x)){c.push(y);break}return c}class n6{constructor(e){this.vertexArray=new pu,this.indexArray=new Pa,this.programConfigurations=new le(e.layers,e.zoom,n=>Xd.includes(n)),this._segments=new Ro,this.hiddenByLandmarkVertexArray=new H3,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ro}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,n,r,c=!1){const u=e.length;if(u>2){let p=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const x=e[0],M=e[1];y=Sh(x.sub(e[u-1])._perp()._unit(),M.sub(x)._perp()._unit())}for(let x=0;x<u;x++){const M=x===u-1?0:x+1,E=e[x],A=e[M],O=e[M===u-1?0:M+1],U=A.sub(E)._perp()._unit(),W=Sh(U,O.sub(A)._perp()._unit()),ee=y,ae=W;if(C0(E,A,n)||c&&t8(E,n)&&t8(A,n)){y=W;continue}const be=g.vertexLength;b0(this.vertexArray,E,A,1,1,ee),b0(this.vertexArray,E,A,1,0,ee),b0(this.vertexArray,E,A,0,1,ae),b0(this.vertexArray,E,A,0,0,ae),g.vertexLength+=4;const Ee=Th(E,A,U,r);for(const Me of Ee)this._segmentToGroundQuads[p].push({id:be,region:Me}),this._segmentToRegionTriCounts[p][Me]+=2,g.primitiveLength+=2;y=W}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let r=0;r<n;r++)this._segmentToGroundQuads[r].sort((c,u)=>c.region-u.region);for(let r=0;r<n;r++){const c=this._segmentToGroundQuads[r],u=e[r],p=this._segmentToRegionTriCounts[r];p.reduce((y,x)=>y+x,0);let g=0;for(let y=0;y<=4;y++){const x=p[y];if(0!==x){let M=this.regionSegments[y];M||(M=this.regionSegments[y]=new Ro);const E={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+g,vertexLength:u.vertexLength,primitiveLength:x};M.get().push(E)}g+=x}for(let y=0;y<c.length;y++){const x=c[y].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,r,c,u,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,r,c,u,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,t5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,r,c,u,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,r,c,u,p)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const r=e.flags&qc?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Ud.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class a4{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Pa,this.footprintVertices=new R2,this.footprintSegments=[],this.layoutVertexArray=new bc,this.centroidVertexArray=new Bl,this.indexArray=new Pa,this.programConfigurations=new le(e.layers,e.zoom,n=>s4.includes(n)),this.segments=new Ro,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new n6(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,r,c){this.features=[],this.hasPattern=s3("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Rr(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:p,index:g,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,M=no(u,x);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),M,r))continue;const E={id:p,sourceLayerIndex:y,index:g,geometry:x?M.geometry:ra(u,r,c),properties:u.properties,type:u.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(gh("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,g,r,{},n.availableImages,c,n.brightness),n.featureIndex.insert(u,E.geometry,g,y,this.index,A)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,r,c,u,p){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,n,r,c,u,p)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,n,r,c,u){const p=0!==Object.keys(e).length;if(p&&!this.stateDependentLayers.length)return;const g=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,g,r,c,u),this.groundEffect.update(e,n,g,r,c,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_h),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,i5.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,n5.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,r,c,u,p,g,y){const x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,M=[new Te(0,0),new Te(Rn,Rn)],E=g.projection,A="globe"===E.name,O="Polygon"===l3[e.type],U=new e8;U.centroidDataIndex=this.centroidData.length;const W=new Qd,ee=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,ae=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);W.height=ae,W.vertexArrayOffset=this.layoutVertexArray.length,W.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new il);const be=mh(n,500);for(let mt=be.length-1;mt>=0;mt--){const Dt=be[mt];(0===Dt.length||(Ee=Dt[0]).every(Wt=>Wt.x<=0)||Ee.every(Wt=>Wt.x>=Rn)||Ee.every(Wt=>Wt.y<=0)||Ee.every(Wt=>Wt.y>=Rn))&&be.splice(mt,1)}var Ee;let Me;if(A)Me=s6(be,M,c);else{Me=[];for(const mt of be)Me.push({polygon:mt,bounds:M})}const We=O?this.edgeRadius:0,Re=We>0&&this.zoom<17,et=(mt,Dt)=>{if(0===mt.length)return!1;const Wt=mt[mt.length-1];return Dt.x===Wt.x&&Dt.y===Wt.y};for(const{polygon:mt,bounds:Dt}of Me){let Wt=0,Vt=0;for(const gn of mt)O&&!gn[0].equals(gn[gn.length-1])&&gn.push(gn[0]),Vt+=O?gn.length-1:gn.length;const un=this.segments.prepareSegment((O?5:4)*Vt,this.layoutVertexArray,this.indexArray);W.footprintSegIdx<0&&(W.footprintSegIdx=this.footprintSegments.length),W.polygonSegIdx<0&&(W.polygonSegIdx=this.polygonSegments.length);const yn={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},tn=new Mh;if(tn.vertexOffset=this.footprintVertices.length,tn.indexOffset=3*this.footprintIndices.length,tn.ringIndices=[],O){const gn=[],Kt=[];Wt=un.vertexLength;for(let Gn=0;Gn<mt.length;Gn++){const wn=mt[Gn];wn.length&&0!==Gn&&Kt.push(gn.length/2);const pi=[];let ni,Ln;ni=wn[1].sub(wn[0])._perp()._unit(),tn.ringIndices.push(wn.length-1);for(let $i=1;$i<wn.length;$i++){const wi=wn[$i],li=wn[$i===wn.length-1?1:$i+1],Mn=wi.clone();if(We){Ln=li.sub(wi)._perp()._unit();const ki=ni.add(Ln)._unit(),Dr=We*Math.min(4,1/(ni.x*ki.x+ni.y*ki.y));Mn.x+=Dr*ki.x,Mn.y+=Dr*ki.y,Mn.x=Math.round(Mn.x),Mn.y=Math.round(Mn.y),ni=Ln}!ee||0!==We&&!Re||et(pi,Mn)||pi.push(Mn),bl(this.layoutVertexArray,Mn.x,Mn.y,0,0,1,1,0),un.vertexLength++,this.footprintVertices.emplaceBack(wi.x,wi.y),gn.push(wi.x,wi.y),A&&o4(this.layoutVertexExtArray,E.projectTilePoint(Mn.x,Mn.y,c),E.upVector(c,Mn.x,Mn.y))}ee&&(0===We||Re)&&(0!==pi.length&&et(pi,pi[0])&&pi.pop(),this.groundEffect.addData(pi,Dt,x))}const pn=_0(gn,Kt);for(let Gn=0;Gn<pn.length;Gn+=3)this.footprintIndices.emplaceBack(tn.vertexOffset+pn[Gn+0],tn.vertexOffset+pn[Gn+1],tn.vertexOffset+pn[Gn+2]),this.indexArray.emplaceBack(Wt+pn[Gn],Wt+pn[Gn+2],Wt+pn[Gn+1]),un.primitiveLength++;tn.indexCount+=pn.length,tn.vertexCount+=this.footprintVertices.length-tn.vertexOffset}for(let gn=0;gn<mt.length;gn++){const Kt=mt[gn];U.startRing(W,Kt[0]);let pn=Kt.length>4&&M0(Kt[Kt.length-2],Kt[0],Kt[1]),Gn=We?i6(Kt[Kt.length-2],Kt[0],Kt[1],We):0;const wn=[];let pi,ni,Ln;ni=Kt[1].sub(Kt[0])._perp()._unit();let $i=!0;for(let wi=1,li=0;wi<Kt.length;wi++){let Mn=Kt[wi-1],ki=Kt[wi];const Dr=Kt[wi===Kt.length-1?1:wi+1];if(U.appendEdge(W,ki,Mn),C0(ki,Mn,Dt)){We&&(ni=Dr.sub(ki)._perp()._unit(),$i=!$i);continue}const Ki=ki.sub(Mn)._perp(),Tr=Ki.x/(Math.abs(Ki.x)+Math.abs(Ki.y)),fr=Ki.y>0?1:0,qr=Mn.dist(ki);if(li+qr>32768&&(li=0),We){Ln=Dr.sub(ki)._perp()._unit();let os=w0(Mn,ki,Dr,Eh(ni,Ln),We);isNaN(os)&&(os=0);const hs=ki.sub(Mn)._unit();Mn=Mn.add(hs.mult(Gn))._round(),ki=ki.add(hs.mult(-os))._round(),Gn=os,ni=Ln,ee&&this.zoom>=17&&(et(wn,Mn)||wn.push(Mn),et(wn,ki)||wn.push(ki))}const Mr=un.vertexLength,ks=Kt.length>4&&M0(Mn,ki,Dr);let is=S0(li,pn,$i);if(bl(this.layoutVertexArray,Mn.x,Mn.y,Tr,fr,0,0,is),bl(this.layoutVertexArray,Mn.x,Mn.y,Tr,fr,0,1,is),li+=qr,is=S0(li,ks,!$i),pn=ks,bl(this.layoutVertexArray,ki.x,ki.y,Tr,fr,0,0,is),bl(this.layoutVertexArray,ki.x,ki.y,Tr,fr,0,1,is),un.vertexLength+=4,this.indexArray.emplaceBack(Mr+0,Mr+1,Mr+2),this.indexArray.emplaceBack(Mr+1,Mr+3,Mr+2),un.primitiveLength+=2,We){const os=Wt+(1===wi?Kt.length-2:wi-2),hs=1===wi?Wt:os+1;if(this.indexArray.emplaceBack(Mr+1,os,Mr+3),this.indexArray.emplaceBack(os,hs,Mr+3),un.primitiveLength+=2,void 0===pi&&(pi=Mr),!C0(Dr,Kt[wi],Dt)){const Qr=wi===Kt.length-1?pi:un.vertexLength;this.indexArray.emplaceBack(Mr+2,Mr+3,Qr),this.indexArray.emplaceBack(Mr+3,Qr+1,Qr),this.indexArray.emplaceBack(Mr+3,hs,Qr+1),un.primitiveLength+=3}$i=!$i}if(A){const os=this.layoutVertexExtArray,hs=E.projectTilePoint(Mn.x,Mn.y,c),Qr=E.projectTilePoint(ki.x,ki.y,c),Ks=E.upVector(c,Mn.x,Mn.y),bs=E.upVector(c,ki.x,ki.y);o4(os,hs,Ks),o4(os,hs,Ks),o4(os,Qr,bs),o4(os,Qr,bs)}}O&&(Wt+=Kt.length-1),ee&&We&&this.zoom>=17&&(0!==wn.length&&et(wn,wn[0])&&wn.pop(),this.groundEffect.addData(wn,Dt,x,We>0))}this.footprintSegments.push(tn),yn.triangleCount=this.indexArray.length-yn.triangleArrayOffset,this.polygonSegments.push(yn),++W.footprintSegLen,++W.polygonSegLen}if(W.vertexCount=this.layoutVertexArray.length-W.vertexArrayOffset,W.groundVertexCount=this.groundEffect.vertexArray.length-W.groundVertexArrayOffset,0!==W.vertexCount){if(W.centroidXY=U.borders?Ch:this.encodeCentroid(U,W),this.centroidData.push(W),U.borders){this.featuresOnBorder.push(U);const mt=this.featuresOnBorder.length-1;for(let Dt=0;Dt<U.borders.length;Dt++)U.borders[Dt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Dt].push(mt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,c,y),this.groundEffect.addPaintPropertiesData(e,r,u,p,c,y),this.maxHeight=Math.max(this.maxHeight,ae)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,r)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const y=this.centroidData[g],x=+(y.min.y+y.max.y>Rn),M=2*x+(+(y.min.x+y.max.x>Rn)^x);for(let E=0;E<y.polygonSegLen;E++){const A=y.polygonSegIdx+E;e.push({centroidIdx:g,subtile:M,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const n=new Pa;e.sort((g,y)=>g.triangleSegmentIdx===y.triangleSegmentIdx?g.subtile-y.subtile:g.triangleSegmentIdx-y.triangleSegmentIdx);let r=0,c=0,u=0;for(const g of e){if(g.triangleSegmentIdx!==r)break;u++}const p=e.length;for(;c!==e.length;){r=e[c].triangleSegmentIdx;let g=0,y=c,x=c;for(let M=y;M<u&&e[M].subtile===g;M++)x++;for(;y!==u;){const M=e[y];g=M.subtile;const E=this.centroidData[M.centroidIdx].min.clone(),A=this.centroidData[M.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=y;U<x;U++){const W=e[U],ee=this.polygonSegments[W.polygonSegmentIdx],ae=this.centroidData[W.centroidIdx].min,be=this.centroidData[W.centroidIdx].max,Ee=this.indexArray.uint16;for(let Me=ee.triangleArrayOffset;Me<ee.triangleArrayOffset+ee.triangleCount;Me++)n.emplaceBack(Ee[3*Me],Ee[3*Me+1],Ee[3*Me+2]);O.primitiveLength+=ee.triangleCount,E.x=Math.min(E.x,ae.x),E.y=Math.min(E.y,ae.y),A.x=Math.max(A.x,be.x),A.y=Math.max(A.y,be.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:E,max:A}),y=x;for(let U=y;U<u&&e[U].subtile===e[y].subtile;U++)x++}c=u;for(let M=c;M<p&&e[M].triangleSegmentIdx===e[c].triangleSegmentIdx;M++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,r){let c=0,u=0;const p=1<<e.canonical.z;if(n){const W=n.getMinMaxForTile(e);W&&(c=W.min,u=W.max)}u+=this.maxHeight;const g=e.toUnwrapped();let y;const x=[g.canonical.x/p+g.wrap,g.canonical.y/p],M=[(g.canonical.x+1)/p+g.wrap,(g.canonical.y+1)/p],E=new Ro,A=(W,ee,ae)=>[W[0]*(1-ae[0])+ee[0]*ae[0],W[1]*(1-ae[1])+ee[1]*ae[1]],O=[],U=[];for(const W of this.triangleSubSegments){O[0]=W.min.x/Rn,O[1]=W.min.y/Rn,U[0]=W.max.x/Rn,U[1]=W.max.y/Rn;const ee=A(x,M,O),ae=A(x,M,U);if(0===new vo([ee[0],ee[1],c],[ae[0],ae[1],u]).intersectsPrecise(r)){y&&(E.segments.push(y),y=void 0);continue}const be=W.segment;y&&y.vertexOffset!==be.vertexOffset&&(E.segments.push(y),y=void 0),y?(y.vertexLength+=be.vertexLength,y.primitiveLength+=be.primitiveLength):y={vertexOffset:be.vertexOffset,primitiveLength:be.primitiveLength,vertexLength:be.vertexLength,primitiveOffset:be.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&E.segments.push(y),E}encodeCentroid(e,n){const r=e.centroid(),c=n.span(),u=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Te(Ot(r.x,1,Rn-1)<<3|u,Ot(r.y,1,Rn-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new Te(0,0);const n=e.borders,r=Number.MAX_VALUE;if(n[0][0]!==r||n[1][0]!==r){const c=n[0][0]!==r?0:1;return new Te(6|(n[0][0]!==r?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{const c=n[2][0]!==r?2:3;return new Te((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==r?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=qc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,c=e.flags&qc?Ch:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||u!==c.x){for(let p=n;p<r;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const r=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(u,p){if(u.length!==p.length)return!1;for(let g=0;g<u.length;g++)if(u[g].sourceId!==p[g].sourceId||!n4(u[g],p[g]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const u of this.centroidData)u.flags&=2147483647;const c=[];for(const u of this.activeReplacements){const p=Math.pow(2,u.footprintTileId.canonical.z-e.canonical.z);for(const g of this.centroidData)if(!(g.flags&qc||u.min.x>g.max.x||g.min.x>u.max.x||u.min.y>g.max.y||g.min.y>u.max.y))for(let y=0;y<g.footprintSegLen;y++){const x=this.footprintSegments[g.footprintSegIdx+y];if(c.length=0,zh(this.footprintVertices,x.vertexOffset,x.vertexCount,u.footprintTileId.canonical,e.canonical,c),Kd(u.footprint,c,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-p)){g.flags|=qc;break}}}for(const u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,r){let c=!1;for(let u=0;u<r.footprintSegLen;u++){const p=this.footprintSegments[r.footprintSegIdx+u];let g=0;for(const y of p.ringIndices){for(let x=g,M=y+g-1;x<y+g;M=x++){const E=this.footprintVertices.int16[2*(x+p.vertexOffset)+0],A=this.footprintVertices.int16[2*(x+p.vertexOffset)+1],O=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];A>n!=O>n&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-E)*(n-A)/(O-A)+E&&(c=!c)}g=y}}return c}getHeightAtTileCoord(e,n){let r=Number.NEGATIVE_INFINITY,c=!0;const u=4*(e+Rn)*Rn+(n+Rn);if(this.partLookup.hasOwnProperty(u)){const p=this.partLookup[u];return p?{height:p.height,hidden:!!(p.flags&qc)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>r&&(r=p.height,this.partLookup[u]=p,c=!!(p.flags&qc));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:c};this.partLookup[u]=void 0}}function Eh(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function i6(t,e,n,r){const c=e.sub(t)._perp()._unit(),u=n.sub(e)._perp()._unit();return w0(t,e,n,Eh(c,u),r)}function w0(t,e,n,r,c){const u=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(n)/3,c*u/r)}function C0(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function t8(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function M0(t,e,n){if(t.x<0||t.x>=Rn||e.x<0||e.x>=Rn||n.x<0||n.x>=Rn)return!1;const r=n.sub(e),c=r.perp(),u=t.sub(e);return(r.x*u.x+r.y*u.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(u.x*u.x+u.y*u.y))>-.866&&c.x*u.x+c.y*u.y<0}function S0(t,e,n){const r=e?2|t:-3&t;return n?1|r:-2&r}function r6(){const t=Math.PI/32,e=Math.tan(t),n=Jt;return n*Math.sqrt(1+2*e*e)-n}function s6(t,e,n){const r=1<<n.z,c=mr(n.x/r),u=mr((n.x+1)/r),p=Yr(n.y/r),g=Yr((n.y+1)/r);return function(y,x,M,E,A=0,O){const U=[];if(!y.length||!M||!E)return U;const W=(Re,et)=>{for(const mt of Re)U.push({polygon:mt,bounds:et})},ee=Math.ceil(Math.log2(M)),ae=Math.ceil(Math.log2(E)),be=ee-ae,Ee=[];for(let Re=0;Re<Math.abs(be);Re++)Ee.push(be>0?0:1);for(let Re=0;Re<Math.min(ee,ae);Re++)Ee.push(0),Ee.push(1);let Me=y;if(Me=y0(Me,x[0].y-A,x[1].y+A,1),Me=y0(Me,x[0].x-A,x[1].x+A,0),!Me.length)return U;const We=[];for(Ee.length?We.push({polygons:Me,bounds:x,depth:0}):W(Me,x);We.length;){const Re=We.pop(),et=Re.depth,mt=Ee[et],Dt=Re.bounds[0],Wt=Re.bounds[1],Vt=0===mt?Dt.x:Dt.y,un=0===mt?Wt.x:Wt.y,yn=O?O(mt,Vt,un):.5*(Vt+un),tn=y0(Re.polygons,Vt-A,yn+A,mt),gn=y0(Re.polygons,yn-A,un+A,mt);if(tn.length){const Kt=[Dt,new Te(0===mt?yn:Wt.x,1===mt?yn:Wt.y)];Ee.length>et+1?We.push({polygons:tn,bounds:Kt,depth:et+1}):W(tn,Kt)}if(gn.length){const Kt=[new Te(0===mt?yn:Dt.x,1===mt?yn:Dt.y),Wt];Ee.length>et+1?We.push({polygons:gn,bounds:Kt,depth:et+1}):W(gn,Kt)}}return U}(t,e,Math.ceil((u-c)/11.25),Math.ceil((p-g)/11.25),1,(y,x,M)=>{if(0===y)return.5*(x+M);{const E=Yr((n.y+x/Rn)/r);return(ar(.5*(Yr((n.y+M/Rn)/r)+E))*r-n.y)*Rn}})}function zh(t,e,n,r,c,u){const p=Math.pow(2,r.z-c.z);for(let g=0;g<n;g++){let y=t.int16[2*(g+e)+0],x=t.int16[2*(g+e)+1];y=(y+c.x*Rn)*p-r.x*Rn,x=(x+c.y*Rn)*p-r.y*Rn,u.push(new Te(y,x))}}Xn(a4,"FillExtrusionBucket",{omit:["layers","features"]}),Xn(Qd,"PartData"),Xn(Mh,"FootprintSegment"),Xn(e8,"BorderCentroidData"),Xn(n6,"GroundEffect");const n8=new Co({visibility:new On(Rt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new On(Rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var i8={paint:new Co({"fill-extrusion-opacity":new On(Rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zi(Rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(Rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(Rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zi(Rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zi(Rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zi(Rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(Rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new On(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new On(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new On(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new On(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new On(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new On(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new On(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new zi(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new zi(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new On(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new On(Rt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new On(Rt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new On(Rt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new On(Rt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:n8};class Zc extends Te{constructor(e,n,r){super(e,n),this.z=r}}function c4(t,e){return t.x*e.x+t.y*e.y}function r8(t,e){if(1===t.length){let n=0;const r=e[n++];let c;for(;!c||r.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const u=e[n],p=t[0],g=c.sub(r),y=u.sub(r),x=p.sub(r),M=c4(g,g),E=c4(g,y),A=c4(y,y),O=c4(x,g),U=c4(x,y),W=M*A-E*E,ee=(A*O-E*U)/W,ae=(M*U-E*O)/W,be=r.z*(1-ee-ae)+c.z*ee+u.z*ae;if(isFinite(be))return be}return 1/0}{let n=1/0;for(const r of e)n=Math.min(n,r.z);return n}}function Ah(t,e,n,r,c,u,p,g){const y=p*c.getElevationAt(t,e,!0,!0),x=0!==u[0],M=x?0===u[1]?p*(u[0]/7-450):p*function(E,A,O){const U=Math.floor(A[0]/8),W=Math.floor(A[1]/8),ee=10*(A[0]-8*U),ae=10*(A[1]-8*W),be=E.getElevationAt(U,W,!0,!0),Ee=E.getMeterToDEM(O),Me=Math.floor(.5*(ee*Ee-1)),We=Math.floor(.5*(ae*Ee-1)),Re=E.tileCoordToPixel(U,W),et=2*Me+1,mt=2*We+1,Dt=(Gn=et,wn=mt,[(gn=E).getElevationAtPixel(Kt=Re.x-Me,pn=Re.y-We,!0),gn.getElevationAtPixel(Kt+wn,pn,!0),gn.getElevationAtPixel(Kt,pn+wn,!0),gn.getElevationAtPixel(Kt+Gn,pn+wn,!0)]),Wt=Math.abs(Dt[0]-Dt[1]),Vt=Math.abs(Dt[2]-Dt[3]),un=Math.abs(Dt[0]-Dt[2])+Math.abs(Dt[1]-Dt[3]),yn=Math.min(.25,.5*Ee*(Wt+Vt)/et),tn=Math.min(.25,.5*Ee*un/mt);var gn,Kt,pn,Gn,wn;return be+Math.max(yn*ee,tn*ae)}(c,u,g):y;return{base:y+(0===n)?-1:n,top:x?Math.max(M+r,y+n+2):y+r}}const o6=cs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:s8}=o6,o8=cs([{name:"a_packed",components:4,type:"Float32"}]),{members:c5}=o8;class a6{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Gc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const r=this.getKey(e,n);return this.positions[r]}trim(){const e=this.width,n=this.height=ht(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,r){const c=[];let u=e.length%2==1?-e[e.length-1]*r:0,p=e[0]*r,g=!0;c.push({left:u,right:p,isDash:g,zeroLength:0===e[0]});let y=e[0];for(let x=1;x<e.length;x++){g=!g;const M=e[x];u=y*r,y+=M,p=y*r,c.push({left:u,right:p,isDash:g,zeroLength:0===M})}return c}addRoundDash(e,n,r){const c=n/2;for(let u=-r;u<=r;u++){const p=this.width*(this.nextRow+r+u);let g=0,y=e[g];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++g]);const M=Math.abs(x-y.left),E=Math.abs(x-y.right),A=Math.min(M,E);let O;const U=u/r*(c+1);if(y.isDash){const W=c-Math.abs(U);O=Math.sqrt(A*A+W*W)}else O=c-Math.sqrt(A*A+U*U);this.image.data[p+x]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){const x=e[y],M=e[y+1];x.zeroLength?e.splice(y,1):M&&M.isDash===x.isDash&&(M.left=x.left,e.splice(y,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const u=this.width*this.nextRow;let p=0,g=e[p];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++p]);const x=Math.abs(y-g.left),M=Math.abs(y-g.right),E=Math.min(x,M);this.image.data[u+y]=Math.max(0,Math.min(255,(g.isDash?E:-E)+n+128))}}addDash(e,n){const r=this.getKey(e,n);if(this.positions[r])return this.positions[r];const c="round"===n,u=c?7:0,p=2*u+1;if(this.nextRow+p>this.height)return Ii("LineAtlas out of space"),null;0===e.length&&e.push(1);let g=0;for(let M=0;M<e.length;M++)e[M]<0&&(Ii("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),g+=e[M];if(0!==g){const M=this.width/g,E=this.getDashRanges(e,this.width,M);c?this.addRoundDash(E,M,u):this.addRegularDash(E,"square"===n?.5*M:0)}const y=this.nextRow+u;this.nextRow+=p;const x={tl:[y,u],br:[g,0]};return this.positions[r]=x,x}}Xn(a6,"LineAtlas");const a8=yh.types,Lh=Math.cos(Math.PI/180*37.5);class u3{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new N4,this.layoutVertexArray2=new O2,this.indexArray=new Pa,this.programConfigurations=new le(e.layers,e.zoom),this.segments=new Ro,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,r,c){this.hasPattern=s3("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:M,id:E,index:A,sourceLayerIndex:O}of e){const U=this.layers[0]._featureFilter.needGeometry,W=no(M,U);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),W,r))continue;const ee=u?u.evaluate(W,{},r):void 0,ae={id:E,properties:M.properties,type:M.type,sourceLayerIndex:O,index:A,geometry:U?W.geometry:ra(M,r,c),patterns:{},sortKey:ee};p.push(ae)}u&&p.sort((M,E)=>M.sortKey-E.sortKey);const{lineAtlas:g,featureIndex:y}=n,x=this.addConstantDashes(g);for(const M of p){const{geometry:E,index:A,sourceLayerIndex:O}=M;if(x&&this.addFeatureDashes(M,g),this.hasPattern){const U=gh("line",this.layers,M,this.zoom,n);this.patternFeatures.push(U)}else this.addFeature(M,E,A,r,g.positions,n.availableImages,n.brightness);y.insert(e[A].feature,E,A,O,this.index)}}addConstantDashes(e){let n=!1;for(const r of this.layers){const c=r.paint.get("line-dasharray").value,u=r.layout.get("line-cap").value;if("constant"!==c.kind||"constant"!==u.kind)n=!0;else{const p=u.value,g=c.value;if(!g)continue;e.addDash(g,p)}}return n}addFeatureDashes(e,n){const r=this.zoom;for(const c of this.layers){const u=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if("constant"===u.kind&&"constant"===p.kind)continue;let g,y;if("constant"===u.kind){if(g=u.value,!g)continue}else g=u.evaluate({zoom:r},e);y="constant"===p.kind?p.value:p.evaluate({zoom:r},e),n.addDash(g,y),e.patterns[c.id]=n.getKey(g,y)}}update(e,n,r,c,u){const p=0!==Object.keys(e).length;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,r,c,u)}addFeatures(e,n,r,c,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,r,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,c5)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,s8),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,r,c,u,p,g){const y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),M=y.get("line-cap").evaluate(e,{}),E=y.get("line-miter-limit"),A=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of n)this.addLine(O,e,x,M,E,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,p,c,g)}addLine(e,n,r,c,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<e.length-1;ae++)this.totalDistance+=e[ae].dist(e[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g="Polygon"===a8[n.type];let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let x=0;for(;x<y-1&&e[x].equals(e[x+1]);)x++;if(y<(g?3:2))return;"bevel"===r&&(u=1.05);const M=this.overscaling<=16?15*Rn/(512*this.overscaling):0,E=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let A,O,U,W,ee;this.e1=this.e2=-1,g&&(A=e[y-2],ee=e[x].sub(A)._unit()._perp());for(let ae=x;ae<y;ae++){if(U=ae===y-1?g?e[x+1]:void 0:e[ae+1],U&&e[ae].equals(U))continue;ee&&(W=ee),A&&(O=A),A=e[ae],ee=U?U.sub(A)._unit()._perp():W,W=W||ee;let be=W.add(ee);0===be.x&&0===be.y||be._unit();const Ee=W.x*ee.x+W.y*ee.y,Me=be.x*ee.x+be.y*ee.y,We=0!==Me?1/Me:1/0,Re=2*Math.sqrt(2-2*Me),et=Me<Lh&&O&&U,mt=W.x*ee.y-W.y*ee.x>0;if(et&&ae>x){const Vt=A.dist(O);if(Vt>2*M){const un=A.sub(A.sub(O)._mult(M/Vt)._round());this.updateDistance(O,un),this.addCurrentVertex(un,W,0,0,E),O=un}}const Dt=O&&U;let Wt=Dt?r:g?"butt":c;if(Dt&&"round"===Wt&&(We<p?Wt="miter":We<=2&&(Wt="fakeround")),"miter"===Wt&&We>u&&(Wt="bevel"),"bevel"===Wt&&(We>2&&(Wt="flipbevel"),We<u&&(Wt="miter")),O&&this.updateDistance(O,A),"miter"===Wt)be._mult(We),this.addCurrentVertex(A,be,0,0,E);else if("flipbevel"===Wt){if(We>100)be=ee.mult(-1);else{const Vt=We*W.add(ee).mag()/W.sub(ee).mag();be._perp()._mult(Vt*(mt?-1:1))}this.addCurrentVertex(A,be,0,0,E),this.addCurrentVertex(A,be.mult(-1),0,0,E)}else if("bevel"===Wt||"fakeround"===Wt){const Vt=-Math.sqrt(We*We-1),un=mt?Vt:0,yn=mt?0:Vt;if(O&&this.addCurrentVertex(A,W,un,yn,E),"fakeround"===Wt){const tn=Math.round(180*Re/Math.PI/20);for(let gn=1;gn<tn;gn++){let Kt=gn/tn;if(.5!==Kt){const Gn=Kt-.5;Kt+=Kt*Gn*(Kt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Gn*Gn+(.848013+Ee*(.215638*Ee-1.06021)))}const pn=ee.sub(W)._mult(Kt)._add(W)._unit()._mult(mt?-1:1);this.addHalfVertex(A,pn.x,pn.y,!1,mt,0,E)}}U&&this.addCurrentVertex(A,ee,-un,-yn,E)}else if("butt"===Wt)this.addCurrentVertex(A,be,0,0,E);else if("square"===Wt){const Vt=O?1:-1;O||this.addCurrentVertex(A,be,Vt,Vt,E),this.addCurrentVertex(A,be,0,0,E),O&&this.addCurrentVertex(A,be,Vt,Vt,E)}else"round"===Wt&&(O&&(this.addCurrentVertex(A,W,0,0,E),this.addCurrentVertex(A,W,1,1,E,!0)),U&&(this.addCurrentVertex(A,ee,-1,-1,E,!0),this.addCurrentVertex(A,ee,0,0,E)));if(et&&ae<y-1){const Vt=A.dist(U);if(Vt>2*M){const un=A.add(U.sub(A)._mult(M/Vt)._round());this.updateDistance(A,un),this.addCurrentVertex(un,ee,0,0,E),A=un}}}}addCurrentVertex(e,n,r,c,u,p=!1){const g=n.y*c-n.x,y=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*r,n.y-n.x*r,p,!1,r,u),this.addHalfVertex(e,g,y,p,!0,-c,u)}addHalfVertex({x:e,y:n},r,c,u,p,g,y){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(p?1:0),Math.round(63*r)+128,Math.round(63*c)+128,1+(0===g?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),y.primitiveLength++),p?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Xn(u3,"LineBucket",{omit:["layers","patternFeatures"]});const c8=new Co({"line-cap":new zi(Rt.layout_line["line-cap"]),"line-join":new zi(Rt.layout_line["line-join"]),"line-miter-limit":new On(Rt.layout_line["line-miter-limit"]),"line-round-limit":new On(Rt.layout_line["line-round-limit"]),"line-sort-key":new zi(Rt.layout_line["line-sort-key"]),visibility:new On(Rt.layout_line.visibility)});var Dh={paint:new Co({"line-opacity":new zi(Rt.paint_line["line-opacity"]),"line-color":new zi(Rt.paint_line["line-color"]),"line-translate":new On(Rt.paint_line["line-translate"]),"line-translate-anchor":new On(Rt.paint_line["line-translate-anchor"]),"line-width":new zi(Rt.paint_line["line-width"]),"line-gap-width":new zi(Rt.paint_line["line-gap-width"]),"line-offset":new zi(Rt.paint_line["line-offset"]),"line-blur":new zi(Rt.paint_line["line-blur"]),"line-dasharray":new zi(Rt.paint_line["line-dasharray"]),"line-pattern":new zi(Rt.paint_line["line-pattern"]),"line-gradient":new xc(Rt.paint_line["line-gradient"]),"line-trim-offset":new On(Rt.paint_line["line-trim-offset"]),"line-emissive-strength":new On(Rt.paint_line["line-emissive-strength"]),"line-border-width":new zi(Rt.paint_line["line-border-width"]),"line-border-color":new zi(Rt.paint_line["line-border-color"])}),layout:c8};function c6(t,e,n){return e*(Rn/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function Ih(t,e){return 1/c6(t,1,e.tileZoom)}function Vh(t,e,n,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Hh=t=>{const e=[];l6(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function l6(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Ph=new class extends zi{possiblyEvaluate(t,e){return e=new or(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,r){return e=ti({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,r)}}(Dh.paint.properties["line-width"].specification);function T0(t,e){return e>0?e+2*t:t}Ph.useIntegerZoom=!0;const wl=cs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),l5=cs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),u5=cs([{name:"a_projected_pos",components:4,type:"Float32"}],4);cs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const u6=cs([{name:"a_z_offset",components:1,type:"Float32"}],4),h3=cs([{name:"a_texb",components:2,type:"Uint16"}]),Nh=cs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),h5=cs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);cs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const h6=cs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vm=cs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);cs([{name:"triangle",components:3,type:"Uint16"}]),cs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),cs([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),cs([{type:"Float32",name:"offsetX"}]),cs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var S1=24;const lc=128;function kh(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new or(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:r,interpolationType:c}=n;let u=0;for(;u<r.length&&r[u]<=t;)u++;u=Math.max(0,u-1);let p=u;for(;p<r.length&&r[p]<t+1;)p++;p=Math.min(r.length-1,p);const g=r[u],y=r[p];return"composite"===n.kind?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:y,minSize:n.evaluate(new or(g)),maxSize:n.evaluate(new or(y)),interpolationType:c}}}function E0(t,{uSize:e,uSizeT:n},{lowerSize:r,upperSize:c}){return"source"===t.kind?r/lc:"composite"===t.kind?Pi(r/lc,c/lc,n):e}function f3(t,e){let n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:c,minZoom:u,maxZoom:p}=t,g=c?Ot(mn.interpolationFactor(c,e,u,p),0,1):0;"camera"===t.kind?r=Pi(t.minSize,t.maxSize,g):n=g}return{uSizeT:n,uSize:r}}var T1=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:lc,evaluateSizeForFeature:E0,evaluateSizeForZoom:f3,getSizeData:kh});function Rh(t,e,n){return t.sections.forEach(r=>{r.text=function(c,u,p){const g=u.layout.get("text-transform").evaluate(p,{});return"uppercase"===g?c=c.toLocaleUpperCase():"lowercase"===g&&(c=c.toLocaleLowerCase()),_i.applyArabicShaping&&(c=_i.applyArabicShaping(c)),c}(r.text,e,n)}),t}const z0={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function f5(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Oh(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var d5={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,n,r,c){var u,p,g=8*c-r-1,y=(1<<g)-1,x=y>>1,M=-7,E=n?c-1:0,A=n?-1:1,O=t[e+E];for(E+=A,u=O&(1<<-M)-1,O>>=-M,M+=g;M>0;u=256*u+t[e+E],E+=A,M-=8);for(p=u&(1<<-M)-1,u>>=-M,M+=r;M>0;p=256*p+t[e+E],E+=A,M-=8);if(0===u)u=1-x;else{if(u===y)return p?NaN:1/0*(O?-1:1);p+=Math.pow(2,r),u-=x}return(O?-1:1)*p*Math.pow(2,u-r)},write:function(t,e,n,r,c,u){var p,g,y,x=8*u-c-1,M=(1<<x)-1,E=M>>1,A=23===c?Math.pow(2,-24)-Math.pow(2,-77):0,O=r?0:u-1,U=r?1:-1,W=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=M):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+E>=1?A/y:A*Math.pow(2,1-E))*y>=2&&(p++,y/=2),p+E>=M?(g=0,p=M):p+E>=1?(g=(e*y-1)*Math.pow(2,c),p+=E):(g=e*Math.pow(2,E-1)*Math.pow(2,c),p=0));c>=8;t[n+O]=255&g,O+=U,g/=256,c-=8);for(p=p<<c|g,x+=c;x>0;t[n+O]=255&p,O+=U,p/=256,x-=8);t[n+O-U]|=128*W}},Fh=Ns,l4=d5;function Ns(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ns.Varint=0,Ns.Fixed64=1,Ns.Bytes=2,Ns.Fixed32=5;var Bh=4294967296,l8=1/Bh,u4=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yc(t){return t.type===Ns.Bytes?t.readVarint()+t.pos:t.pos+1}function p5(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var c=n.pos-1;c>=t;c--)n.buf[c+r]=n.buf[c]}function Uh(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function jh(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Lc(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function m5(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function u8(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Dc(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function uc(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function hc(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function h8(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function h4(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function f4(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function f8(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ns.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),c=r>>3,u=this.pos;this.type=7&r,t(c,e,this),this.pos===u&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=h4(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=f8(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=h4(this.buf,this.pos)+h4(this.buf,this.pos+4)*Bh;return this.pos+=8,t},readSFixed64:function(){var t=h4(this.buf,this.pos)+f8(this.buf,this.pos+4)*Bh;return this.pos+=8,t},readFloat:function(){var t=l4.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=l4.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(c,u,p){var g,y,x=p.buf;if(g=(112&(y=x[p.pos++]))>>4,y<128||(g|=(127&(y=x[p.pos++]))<<3,y<128)||(g|=(127&(y=x[p.pos++]))<<10,y<128)||(g|=(127&(y=x[p.pos++]))<<17,y<128)||(g|=(127&(y=x[p.pos++]))<<24,y<128)||(g|=(1&(y=x[p.pos++]))<<31,y<128))return function d3(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(c,g,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&u4?u4.decode(this.buf.subarray(e,t)):function(n,r,c){for(var u="",p=r;p<c;){var g,y,x,M=n[p],E=null,A=M>239?4:M>223?3:M>191?2:1;if(p+A>c)break;1===A?M<128&&(E=M):2===A?128==(192&(g=n[p+1]))&&(E=(31&M)<<6|63&g)<=127&&(E=null):3===A?(y=n[p+2],128==(192&(g=n[p+1]))&&128==(192&y)&&((E=(15&M)<<12|(63&g)<<6|63&y)<=2047||E>=55296&&E<=57343)&&(E=null)):4===A&&(y=n[p+2],x=n[p+3],128==(192&(g=n[p+1]))&&128==(192&y)&&128==(192&x)&&((E=(15&M)<<18|(63&g)<<12|(63&y)<<6|63&x)<=65535||E>=1114112)&&(E=null)),null===E?(E=65533,A=1):E>65535&&(E-=65536,u+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),u+=String.fromCharCode(E),p+=A}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ns.Bytes)return t.push(this.readVarint(e));var n=Yc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ns.Bytes)return t.push(this.readSVarint());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ns.Bytes)return t.push(this.readBoolean());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ns.Bytes)return t.push(this.readFloat());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ns.Bytes)return t.push(this.readDouble());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ns.Bytes)return t.push(this.readFixed32());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ns.Bytes)return t.push(this.readSFixed32());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ns.Bytes)return t.push(this.readFixed64());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ns.Bytes)return t.push(this.readSFixed64());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ns.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ns.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ns.Fixed32)this.pos+=4;else{if(e!==Ns.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),f4(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),f4(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),f4(this.buf,-1&t,this.pos),f4(this.buf,Math.floor(t*l8),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),f4(this.buf,-1&t,this.pos),f4(this.buf,Math.floor(t*l8),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var r,c,u,g;if(e>=0?(r=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,c=c+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),u=r,(g=n).buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7),function(u,p){var g=(7&u)<<4;p.buf[p.pos++]|=g|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,c,u){for(var p,g,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!g){p>56319||y+1===c.length?(r[u++]=239,r[u++]=191,r[u++]=189):g=p;continue}if(p<56320){r[u++]=239,r[u++]=191,r[u++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(r[u++]=239,r[u++]=191,r[u++]=189,g=null);p<128?r[u++]=p:(p<2048?r[u++]=p>>6|192:(p<65536?r[u++]=p>>12|224:(r[u++]=p>>18|240,r[u++]=p>>12&63|128),r[u++]=p>>6&63|128),r[u++]=63&p|128)}return u}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&p5(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),l4.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),l4.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&p5(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Ns.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Uh,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,jh,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,u8,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Lc,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,m5,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Dc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,uc,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,hc,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,h8,e)},writeBytesField:function(t,e){this.writeTag(t,Ns.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ns.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ns.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ns.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ns.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ns.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ns.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ns.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ns.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ns.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var p3=En(Fh);const Gh=3;function $h(t,e,n){e.glyphs=[],1===t&&n.readMessage(A0,e)}function A0(t,e,n){if(3===t){const{id:r,bitmap:c,width:u,height:p,left:g,top:y,advance:x}=n.readMessage(g5,{});e.glyphs.push({id:r,bitmap:new Gc({width:u+2*Gh,height:p+2*Gh},c),metrics:{width:u,height:p,left:g,top:y,advance:x}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function g5(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}const Wh=Gh,p2={horizontal:1,vertical:2,horizontalOnly:3};class L0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const r=new L0;return r.scale=e||1,r.fontStack=n,r}static forImage(e){const n=new L0;return n.imageName=e,n}}class m3{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const r=new m3;for(let c=0;c<e.sections.length;c++){const u=e.sections[c];u.image?r.addImageSection(u):r.addTextSection(u,n)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,r){let c="";for(let u=0;u<n.length;u++){const p=n.charCodeAt(u+1)||null,g=n.charCodeAt(u-1)||null;c+=!r&&(p&&us(p)&&!z0[n[u+1]]||g&&us(g)&&!z0[n[u-1]])||!z0[n[u]]?n[u]:z0[n[u]]}return c}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&g3[this.text.charCodeAt(r)];r++)e++;let n=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&g3[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const r=new m3;return r.text=this.text.substring(e,n),r.sectionIndex=this.sectionIndex.slice(e,n),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(L0.forText(e.scale,e.fontStack||n));const r=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(r)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(0===n.length)return void Ii("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(L0.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function D0(t,e,n,r,c,u,p,g,y,x,M,E,A,O,U){const W=m3.fromFeature(t,c);E===p2.vertical&&W.verticalizePunctuation(A);let ee=[];const ae=function(Re,et,mt,Dt,Wt,Vt){if(!Re)return[];const un=[],yn=function(pn,Gn,wn,pi,ni,Ln){let $i=0;for(let wi=0;wi<pn.length();wi++){const li=pn.getSection(wi);$i+=qh(pn.getCodePoint(wi),li,pi,ni,Gn,Ln)}return $i/Math.max(1,Math.ceil($i/wn))}(Re,et,mt,Dt,Wt,Vt),tn=Re.text.indexOf("\u200b")>=0;let gn=0;for(let pn=0;pn<Re.length();pn++){const Gn=Re.getSection(pn),wn=Re.getCodePoint(pn);if(g3[wn]||(gn+=qh(wn,Gn,Dt,Wt,et,Vt)),pn<Re.length()-1){const pi=!((Kt=wn)<11904||!(ai["Bopomofo Extended"](Kt)||ai.Bopomofo(Kt)||ai["CJK Compatibility Forms"](Kt)||ai["CJK Compatibility Ideographs"](Kt)||ai["CJK Compatibility"](Kt)||ai["CJK Radicals Supplement"](Kt)||ai["CJK Strokes"](Kt)||ai["CJK Symbols and Punctuation"](Kt)||ai["CJK Unified Ideographs Extension A"](Kt)||ai["CJK Unified Ideographs"](Kt)||ai["Enclosed CJK Letters and Months"](Kt)||ai["Halfwidth and Fullwidth Forms"](Kt)||ai.Hiragana(Kt)||ai["Ideographic Description Characters"](Kt)||ai["Kangxi Radicals"](Kt)||ai["Katakana Phonetic Extensions"](Kt)||ai.Katakana(Kt)||ai["Vertical Forms"](Kt)||ai["Yi Radicals"](Kt)||ai["Yi Syllables"](Kt)));(d8[wn]||pi||Gn.imageName)&&un.push(I0(pn+1,gn,yn,un,Zh(wn,Re.getCodePoint(pn+1),pi&&tn),!1))}}var Kt;return d6(I0(Re.length(),gn,yn,un,0,!0))}(W,x,u,e,r,O),{processBidirectionalText:be,processStyledBidirectionalText:Ee}=_i;if(be&&1===W.sections.length){const Re=be(W.toString(),ae);for(const et of Re){const mt=new m3;mt.text=et,mt.sections=W.sections;for(let Dt=0;Dt<et.length;Dt++)mt.sectionIndex.push(0);ee.push(mt)}}else if(Ee){const Re=Ee(W.text,W.sectionIndex,ae);for(const et of Re){const mt=new m3;mt.text=et[0],mt.sectionIndex=et[1],mt.sections=W.sections,ee.push(mt)}}else ee=function(Re,et){const mt=[],Dt=Re.text;let Wt=0;for(const Vt of et)mt.push(Re.substring(Wt,Vt)),Wt=Vt;return Wt<Dt.length&&mt.push(Re.substring(Wt,Dt.length)),mt}(W,ae);const Me=[],We={positionedLines:Me,text:W.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Re,et,mt,Dt,Wt,Vt,un,yn,tn,gn,Kt,pn){let Gn=0,wn=0,pi=0;const ni="right"===yn?1:"left"===yn?0:.5;let Ln=!1;for(const Dr of Wt){const Ki=Dr.getSections();for(const Tr of Ki){if(Tr.imageName)continue;const fr=et[Tr.fontStack];if(fr&&(Ln=void 0!==fr.ascender&&void 0!==fr.descender,!Ln))break}if(!Ln)break}let $i=0;for(const Dr of Wt){Dr.trim();const Ki=Dr.getMaxScale(),Tr=(Ki-1)*S1,fr={positionedGlyphs:[],lineOffset:0};Re.positionedLines[$i]=fr;const qr=fr.positionedGlyphs;let Mr=0;if(!Dr.length()){wn+=Vt,++$i;continue}let ks=0,is=0;for(let hs=0;hs<Dr.length();hs++){const Qr=Dr.getSection(hs),Ks=Dr.getSectionIndex(hs),bs=Dr.getCodePoint(hs);let Lo=Qr.scale,Ko=null,Xa=null,Xs=null,Do=S1,Sa=0;const Ta=!(tn===p2.horizontal||!Kt&&!wr(bs)||Kt&&(g3[bs]||(wi=bs,ai.Arabic(wi)||ai["Arabic Supplement"](wi)||ai["Arabic Extended-A"](wi)||ai["Arabic Presentation Forms-A"](wi)||ai["Arabic Presentation Forms-B"](wi))));if(Qr.imageName){const Ja=Dt[Qr.imageName];if(!Ja)continue;Xs=Qr.imageName,Re.iconsInText=Re.iconsInText||!0,Xa=Ja.paddedRect;const Js=Ja.displaySize;Lo=Lo*S1/pn,Ko={width:Js[0],height:Js[1],left:0,top:-Wh,advance:Ta?Js[1]:Js[0],localGlyph:!1},Sa=Ln?-Ko.height*Lo:Ki*S1-17-Js[1]*Lo,Do=Ko.advance;const g2=(Ta?Js[0]:Js[1])*Lo-S1*Ki;g2>0&&g2>Mr&&(Mr=g2)}else{const Ja=mt[Qr.fontStack];if(!Ja)continue;Ja[bs]&&(Xa=Ja[bs]);const Js=et[Qr.fontStack];if(!Js)continue;const g2=Js.glyphs[bs];if(!g2)continue;if(Ko=g2.metrics,Do=8203!==bs?S1:0,Ln){const Qc=void 0!==Js.ascender?Math.abs(Js.ascender):0,J1=void 0!==Js.descender?Math.abs(Js.descender):0,g1=(Qc+J1)*Lo;ks<g1&&(ks=g1,is=(Qc-J1)/2*Lo),Sa=-Qc*Lo}else Sa=(Ki-Lo)*S1-17}Ta?(Re.verticalizable=!0,qr.push({glyph:bs,imageName:Xs,x:Gn,y:wn+Sa,vertical:Ta,scale:Lo,localGlyph:Ko.localGlyph,fontStack:Qr.fontStack,sectionIndex:Ks,metrics:Ko,rect:Xa}),Gn+=Do*Lo+gn):(qr.push({glyph:bs,imageName:Xs,x:Gn,y:wn+Sa,vertical:Ta,scale:Lo,localGlyph:Ko.localGlyph,fontStack:Qr.fontStack,sectionIndex:Ks,metrics:Ko,rect:Xa}),Gn+=Ko.advance*Lo+gn)}0!==qr.length&&(pi=Math.max(Gn-gn,pi),Ln?Yh(qr,ni,Mr,is,Vt*Ki/2):Yh(qr,ni,Mr,0,Vt/2)),Gn=0;const os=Vt*Ki+Mr;fr.lineOffset=Math.max(Mr,Tr),wn+=os,++$i}var wi;const li=wn,{horizontalAlign:Mn,verticalAlign:ki}=p6(un);(function(Dr,Ki,Tr,fr,qr,Mr){const ks=(Ki-Tr)*qr,is=-Mr*fr;for(const os of Dr)for(const hs of os.positionedGlyphs)hs.x+=ks,hs.y+=is})(Re.positionedLines,ni,Mn,ki,pi,li),Re.top+=-ki*li,Re.bottom=Re.top+li,Re.left+=-Mn*pi,Re.right=Re.left+pi,Re.hasBaseline=Ln}(We,e,n,r,ee,p,g,y,E,x,A,U),!function(Re){for(const et of Re)if(0!==et.positionedGlyphs.length)return!1;return!0}(Me)&&We}const g3={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},d8={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qh(t,e,n,r,c,u){if(e.imageName){const p=r[e.imageName];return p?p.displaySize[0]*e.scale*S1/u+c:0}{const p=n[e.fontStack],g=p&&p.glyphs[t];return g?g.metrics.advance*e.scale+c:0}}function f6(t,e,n,r){const c=Math.pow(t-e,2);return r?t<e?c/2:2*c:c+Math.abs(n)*n}function Zh(t,e,n){let r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function I0(t,e,n,r,c,u){let p=null,g=f6(e,n,c,u);for(const y of r){const x=f6(e-y.x,n,c,u)+y.badness;x<=g&&(p=y,g=x)}return{index:t,x:e,priorBreak:p,badness:g}}function d6(t){return t?d6(t.priorBreak).concat(t.index):[]}function p6(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Yh(t,e,n,r,c){if(!(e||n||r||c))return;const u=t.length-1,p=t[u],g=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=u;y++)t[y].x-=g,t[y].y+=n+r+c}function Kh(t,e,n,r){const{horizontalAlign:c,verticalAlign:u}=p6(r),p=n[0]-t.displaySize[0]*c,g=n[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:g,bottom:g+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function Xh(t,e,n,r,c,u){const p=t.imagePrimary;let g;if(p.content){const ee=p.content,ae=p.pixelRatio||1;g=[ee[0]/ae,ee[1]/ae,p.displaySize[0]-ee[2]/ae,p.displaySize[1]-ee[3]/ae]}const y=e.left*u,x=e.right*u;let M,E,A,O;"width"===n||"both"===n?(O=c[0]+y-r[3],E=c[0]+x+r[1]):(O=c[0]+(y+x-p.displaySize[0])/2,E=O+p.displaySize[0]);const U=e.top*u,W=e.bottom*u;return"height"===n||"both"===n?(M=c[1]+U-r[0],A=c[1]+W+r[2]):(M=c[1]+(U+W-p.displaySize[1])/2,A=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:E,bottom:A,left:O,collisionPadding:g}}class Ic extends Te{constructor(e,n,r,c,u){super(e,n),this.angle=c,this.z=r,void 0!==u&&(this.segment=u)}clone(){return new Ic(this.x,this.y,this.z,this.angle,this.segment)}}function Jh(t,e,n,r,c){if(void 0===e.segment)return!0;let u=e,p=e.segment+1,g=0;for(;g>-n/2;){if(p--,p<0)return!1;g-=t[p].dist(u),u=t[p]}g+=t[p].dist(t[p+1]),p++;const y=[];let x=0;for(;g<n/2;){const M=t[p],E=t[p+1];if(!E)return!1;let A=t[p-1].angleTo(M)-M.angleTo(E);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:A}),x+=A;g-y[0].distance>r;)x-=y.shift().angleDelta;if(x>c)return!1;p++,g+=M.dist(E)}return!0}function m6(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function p8(t,e,n){return t?.6*e*n:0}function m8(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function g8(t,e,n,r,c,u){const p=p8(n,c,u),g=m8(n,r)*u;let y=0;const x=m6(t)/2;for(let M=0;M<t.length-1;M++){const E=t[M],A=t[M+1],O=E.dist(A);if(y+O>x){const U=(x-y)/O,W=Pi(E.x,A.x,U),ee=Pi(E.y,A.y,U),ae=new Ic(W,ee,0,A.angleTo(E),M);return!p||Jh(t,ae,g,p,e)?ae:void 0}y+=O}}function _5(t,e,n,r,c,u,p,g,y){const x=p8(r,u,p),M=m8(r,c),E=M*p,A=0===t[0].x||t[0].x===y||0===t[0].y||t[0].y===y;return e-E<e/4&&(e=E+e/4),_8(t,A?e/2*g%e:(M/2+2*u)*p*g%e,e,x,n,E,A,!1,y)}function _8(t,e,n,r,c,u,p,g,y){const x=u/2,M=m6(t);let E=0,A=e-n,O=[];for(let U=0;U<t.length-1;U++){const W=t[U],ee=t[U+1],ae=W.dist(ee),be=ee.angleTo(W);for(;A+n<E+ae;){A+=n;const Ee=(A-E)/ae,Me=Pi(W.x,ee.x,Ee),We=Pi(W.y,ee.y,Ee);if(Me>=0&&Me<y&&We>=0&&We<y&&A-x>=0&&A+x<=M){const Re=new Ic(Me,We,0,be,U);r&&!Jh(t,Re,u,r,c)||O.push(Re)}}E+=ae}return g||O.length||p||(O=_8(t,E/2,n,r,c,u,p,!0,y)),O}function v8(t,e,n,r,c){const u=[];for(let p=0;p<t.length;p++){const g=t[p];let y;for(let x=0;x<g.length-1;x++){let M=g[x],E=g[x+1];M.x<e&&E.x<e||(M.x<e?M=new Te(e,M.y+(e-M.x)/(E.x-M.x)*(E.y-M.y))._round():E.x<e&&(E=new Te(e,M.y+(e-M.x)/(E.x-M.x)*(E.y-M.y))._round()),M.y<n&&E.y<n||(M.y<n?M=new Te(M.x+(n-M.y)/(E.y-M.y)*(E.x-M.x),n)._round():E.y<n&&(E=new Te(M.x+(n-M.y)/(E.y-M.y)*(E.x-M.x),n)._round()),M.x>=r&&E.x>=r||(M.x>=r?M=new Te(r,M.y+(r-M.x)/(E.x-M.x)*(E.y-M.y))._round():E.x>=r&&(E=new Te(r,M.y+(r-M.x)/(E.x-M.x)*(E.y-M.y))._round()),M.y>=c&&E.y>=c||(M.y>=c?M=new Te(M.x+(c-M.y)/(E.y-M.y)*(E.x-M.x),c)._round():E.y>=c&&(E=new Te(M.x+(c-M.y)/(E.y-M.y)*(E.x-M.x),c)._round()),y&&M.equals(y[y.length-1])||(y=[M],u.push(y)),y.push(E)))))}}return u}function y8(t){let e=0,n=0;for(const p of t)e+=p.w*p.h,n=Math.max(n,p.w);t.sort((p,g)=>g.h-p.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,u=0;for(const p of t)for(let g=r.length-1;g>=0;g--){const y=r[g];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,u=Math.max(u,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){const x=r.pop();g<r.length&&(r[g]=x)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(r.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h:u,fill:e/(c*u)||0}}Xn(Ic,"Anchor");const m2=1;class Qh{constructor(e,{pixelRatio:n,version:r,stretchX:c,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=u,this.content=p,this.version=r}get tl(){return[this.paddedRect.x+m2,this.paddedRect.y+m2]}get br(){return[this.paddedRect.x+this.paddedRect.w-m2,this.paddedRect.y+this.paddedRect.h-m2]}get displaySize(){return[(this.paddedRect.w-2*m2)/this.pixelRatio,(this.paddedRect.h-2*m2)/this.pixelRatio]}}class x8{constructor(e,n){const r={},c={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,r,u),this.addImages(n,c,u);const{w:p,h:g}=y8(u),y=new c2({width:p||1,height:g||1});for(const x in e){const M=e[x],E=r[x].paddedRect;c2.copy(M.data,y,{x:0,y:0},{x:E.x+m2,y:E.y+m2},M.data,M.sdf)}for(const x in n){const M=n[x],E=c[x].paddedRect,A=E.x+m2,O=E.y+m2,U=M.data.width,W=M.data.height;c2.copy(M.data,y,{x:0,y:0},{x:A,y:O},M.data),c2.copy(M.data,y,{x:0,y:W-1},{x:A,y:O-1},{width:U,height:1}),c2.copy(M.data,y,{x:0,y:0},{x:A,y:O+W},{width:U,height:1}),c2.copy(M.data,y,{x:U-1,y:0},{x:A-1,y:O},{width:1,height:W}),c2.copy(M.data,y,{x:0,y:0},{x:A+U,y:O},{width:1,height:W})}this.image=y,this.iconPositions=r,this.patternPositions=c}addImages(e,n,r){for(const c in e){const u=e[c],p={x:0,y:0,w:u.data.width+2*m2,h:u.data.height+2*m2};r.push(p),n[c]=new Qh(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const c in e.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,r),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,r),n)}patchUpdatedImage(e,n,r){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,u]=e.tl,p=!!Object.keys(this.patternPositions).length;r.update(n.data,{useMipmap:p},{x:c,y:u})}}Xn(Qh,"ImagePosition"),Xn(x8,"ImageAtlas");const d4=1e20;function b8(t,e,n,r,c,u,p,g,y){for(let x=e;x<e+r;x++)w8(t,n*u+x,u,c,p,g,y);for(let x=n;x<n+c;x++)w8(t,x*u+e,1,r,p,g,y)}function w8(t,e,n,r,c,u,p){u[0]=0,p[0]=-d4,p[1]=d4,c[0]=t[e];for(let g=1,y=0,x=0;g<r;g++){c[g]=t[e+g*n];const M=g*g;do{const E=u[y];x=(c[g]-c[E]+M-E*E)/(g-E)/2}while(x<=p[y]&&--y>-1);y++,u[y]=g,p[y]=x,p[y+1]=d4}for(let g=0,y=0;g<r;g++){for(;p[y+1]<g;)y++;const x=u[y],M=g-x;t[e+g*n]=c[x]+M*M}}const fc=2,ef={none:0,ideographs:1,all:2};class p4{constructor(e,n,r){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,r){const c=[],u=this.urls[n]||Et.GLYPHS_URL;for(const p in e)for(const g of e[p])c.push({stack:p,id:g});Wi(c,({stack:p,id:g},y)=>{let x=this.entries[p];x||(x=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=x.glyphs[g];if(void 0!==M)return void y(null,{stack:p,id:g,glyph:M});if(M=this._tinySDF(x,p,g),M)return x.glyphs[g]=M,void y(null,{stack:p,id:g,glyph:M});const E=Math.floor(g/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void y(null,{stack:p,id:g,glyph:M});let A=x.requests[E];A||(A=x.requests[E]=[],p4.loadGlyphRange(p,E,u,this.requestManager,(O,U)=>{if(U){x.ascender=U.ascender,x.descender=U.descender;for(const W in U.glyphs)this._doesCharSupportLocalGlyph(+W)||(x.glyphs[+W]=U.glyphs[+W]);x.ranges[E]=!0}for(const W of A)W(O,U);delete x.requests[E]})),A.push((O,U)=>{O?y(O):U&&y(null,{stack:p,id:g,glyph:U.glyphs[g]||null})})},(p,g)=>{if(p)r(p);else if(g){const y={};for(const{stack:x,id:M,glyph:E}of g)void 0===y[x]&&(y[x]={}),void 0===y[x].glyphs&&(y[x].glyphs={}),y[x].glyphs[M]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;r(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ef.none&&(this.localGlyphMode===ef.all?!!this.localFontFamily:!!this.localFontFamily&&(ai["CJK Unified Ideographs"](e)||ai["Hangul Syllables"](e)||ai.Hiragana(e)||ai.Katakana(e)||ai["CJK Symbols and Punctuation"](e)||ai["CJK Unified Ideographs Extension A"](e)||ai["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,r){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(r))return;let u=e.tinySDF;if(!u){let W="400";/bold/i.test(n)?W="900":/medium/i.test(n)?W="500":/light/i.test(n)&&(W="200"),u=e.tinySDF=new p4.TinySDF({fontFamily:c,fontWeight:W,fontSize:24*fc,buffer:3*fc,radius:8*fc}),u.fontWeight=W}if(this.localGlyphs[u.fontWeight][r])return this.localGlyphs[u.fontWeight][r];const p=String.fromCodePoint(r),{data:g,width:y,height:x,glyphWidth:M,glyphHeight:E,glyphLeft:A,glyphTop:O,glyphAdvance:U}=u.draw(p);return this.localGlyphs[u.fontWeight][r]={id:r,bitmap:new Gc({width:y,height:x},g),metrics:{width:M/fc,height:E/fc,left:A/fc,top:O/fc-27,advance:U/fc,localGlyph:!0}}}}p4.loadGlyphRange=function(t,e,n,r,c){const u=256*e,p=u+255,g=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${u}-${p}`),vn.Glyphs);Ht(g,(y,x)=>{if(y)c(y);else if(x){const M={},E=new p3(x).readFields($h,{});for(const A of E.glyphs)M[A.id]=A;c(null,{glyphs:M,ascender:E.ascender,descender:E.descender})}})},p4.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:r=.25,fontFamily:c="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=n;const g=this.size=t+4*e,y=this._createCanvas(g),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${p} ${u} ${t}px ${c}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:c,actualBoundingBoxRight:u}=this.ctx.measureText(t),p=Math.ceil(n),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-c))),y=Math.min(this.size-this.buffer,p+Math.ceil(r)),x=g+2*this.buffer,M=y+2*this.buffer,E=Math.max(x*M,0),A=new Uint8ClampedArray(E),O={data:A,width:x,height:M,glyphWidth:g,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(0===g||0===y)return O;const{ctx:U,buffer:W,gridInner:ee,gridOuter:ae}=this;U.clearRect(W,W,g,y),U.fillText(t,W,W+p);const be=U.getImageData(W,W,g,y);ae.fill(d4,0,E),ee.fill(0,0,E);for(let Ee=0;Ee<y;Ee++)for(let Me=0;Me<g;Me++){const We=be.data[4*(Ee*g+Me)+3]/255;if(0===We)continue;const Re=(Ee+W)*x+Me+W;if(1===We)ae[Re]=0,ee[Re]=d4;else{const et=.5-We;ae[Re]=et>0?et*et:0,ee[Re]=et<0?et*et:0}}b8(ae,0,0,x,M,x,this.f,this.v,this.z),b8(ee,W,W,g,y,x,this.f,this.v,this.z);for(let Ee=0;Ee<E;Ee++){const Me=Math.sqrt(ae[Ee])-Math.sqrt(ee[Ee]);A[Ee]=Math.round(255-255*(Me/this.radius+this.cutoff))}return O}};const Cl=m2;function C8(t,e,n,r){const c=[],u=t.imagePrimary,p=u.pixelRatio,g=u.paddedRect.w-2*Cl,y=u.paddedRect.h-2*Cl,x=t.right-t.left,M=t.bottom-t.top,E=u.stretchX||[[0,g]],A=u.stretchY||[[0,y]],O=(Vt,un)=>Vt+un[1]-un[0],U=E.reduce(O,0),W=A.reduce(O,0),ee=g-U,ae=y-W;let be=0,Ee=U,Me=0,We=W,Re=0,et=ee,mt=0,Dt=ae;if(u.content&&r){const Vt=u.content;be=V0(E,0,Vt[0]),Me=V0(A,0,Vt[1]),Ee=V0(E,Vt[0],Vt[2]),We=V0(A,Vt[1],Vt[3]),Re=Vt[0]-be,mt=Vt[1]-Me,et=Vt[2]-Vt[0]-Ee,Dt=Vt[3]-Vt[1]-We}const Wt=(Vt,un,yn,tn)=>{const gn=H0(Vt.stretch-be,Ee,x,t.left),Kt=P0(Vt.fixed-Re,et,Vt.stretch,U),pn=H0(un.stretch-Me,We,M,t.top),Gn=P0(un.fixed-mt,Dt,un.stretch,W),wn=H0(yn.stretch-be,Ee,x,t.left),pi=P0(yn.fixed-Re,et,yn.stretch,U),ni=H0(tn.stretch-Me,We,M,t.top),Ln=P0(tn.fixed-mt,Dt,tn.stretch,W),$i=new Te(gn,pn),wi=new Te(wn,pn),li=new Te(wn,ni),Mn=new Te(gn,ni),ki=new Te(Kt/p,Gn/p),Dr=new Te(pi/p,Ln/p),Ki=e*Math.PI/180;if(Ki){const is=Math.sin(Ki),os=Math.cos(Ki),hs=[os,-is,is,os];$i._matMult(hs),wi._matMult(hs),Mn._matMult(hs),li._matMult(hs)}const Tr=Vt.stretch+Vt.fixed,fr=yn.stretch+yn.fixed,qr=un.stretch+un.fixed,Mr=tn.stretch+tn.fixed,ks=t.imageSecondary;return{tl:$i,tr:wi,bl:Mn,br:li,texPrimary:{x:u.paddedRect.x+Cl+Tr,y:u.paddedRect.y+Cl+qr,w:fr-Tr,h:Mr-qr},texSecondary:ks?{x:ks.paddedRect.x+Cl+Tr,y:ks.paddedRect.y+Cl+qr,w:fr-Tr,h:Mr-qr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ki,pixelOffsetBR:Dr,minFontScaleX:et/p/x,minFontScaleY:Dt/p/M,isSDF:n}};if(r&&(u.stretchX||u.stretchY)){const Vt=tf(E,ee,U),un=tf(A,ae,W);for(let yn=0;yn<Vt.length-1;yn++){const tn=Vt[yn],gn=Vt[yn+1];for(let Kt=0;Kt<un.length-1;Kt++)c.push(Wt(tn,un[Kt],gn,un[Kt+1]))}}else c.push(Wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return c}function V0(t,e,n){let r=0;for(const c of t)r+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return r}function tf(t,e,n){const r=[{fixed:-Cl,stretch:0}];for(const[c,u]of t){const p=r[r.length-1];r.push({fixed:c-p.stretch,stretch:p.stretch}),r.push({fixed:c-p.stretch,stretch:p.stretch+(u-c)})}return r.push({fixed:e+Cl,stretch:n}),r}function H0(t,e,n,r){return t/e*n+r}function P0(t,e,n,r){return t-e*n/r}function M8(t,e,n,r){const c=e+t.positionedLines[r].lineOffset;return 0===r?n+c/2:n+(c+(e+t.positionedLines[r-1].lineOffset))/2}function S8(t,e=1,n=!1){let r=1/0,c=1/0,u=-1/0,p=-1/0;const g=t[0];for(let O=0;O<g.length;O++){const U=g[O];(!O||U.x<r)&&(r=U.x),(!O||U.y<c)&&(c=U.y),(!O||U.x>u)&&(u=U.x),(!O||U.y>p)&&(p=U.y)}const y=Math.min(u-r,p-c);let x=y/2;const M=new Ss([],nf);if(0===y)return new Te(r,c);for(let O=r;O<u;O+=y)for(let U=c;U<p;U+=y)M.push(new _3(O+x,U+x,x,t));let E=function(O){let U=0,W=0,ee=0;const ae=O[0];for(let be=0,Ee=ae.length,Me=Ee-1;be<Ee;Me=be++){const We=ae[be],Re=ae[Me],et=We.x*Re.y-Re.x*We.y;W+=(We.x+Re.x)*et,ee+=(We.y+Re.y)*et,U+=3*et}return new _3(W/U,ee/U,0,O)}(t),A=M.length;for(;M.length;){const O=M.pop();(O.d>E.d||!E.d)&&(E=O,n&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,A)),O.max-E.d<=e||(x=O.h/2,M.push(new _3(O.p.x-x,O.p.y-x,x,t)),M.push(new _3(O.p.x+x,O.p.y-x,x,t)),M.push(new _3(O.p.x-x,O.p.y+x,x,t)),M.push(new _3(O.p.x+x,O.p.y+x,x,t)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${E.d}`)),E.p}function nf(t,e){return e.max-t.max}class _3{constructor(e,n,r,c){this.p=new Te(e,n),this.h=r,this.d=function(u,p){let g=!1,y=1/0;for(let x=0;x<p.length;x++){const M=p[x];for(let E=0,A=M.length,O=A-1;E<A;O=E++){const U=M[E],W=M[O];U.y>u.y!=W.y>u.y&&u.x<(W.x-U.x)*(u.y-U.y)/(W.y-U.y)+U.x&&(g=!g),y=Math.min(y,Wl(u,U,W))}}return(g?1:-1)*Math.sqrt(y)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const N0=Number.POSITIVE_INFINITY,rf=Math.sqrt(2);function k0(t,[e,n]){let r=0,c=0;if(n===N0){e<0&&(e=0);const u=e/rf;switch(t){case"top-right":case"top-left":c=u-7;break;case"bottom-right":case"bottom-left":c=7-u;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":r=-u;break;case"top-left":case"bottom-left":r=u;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,c]}function Kc(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function v5(t,e,n,r,c,u,p,g,y,x,M,E,A,O,U){let W=u.textMaxSize.evaluate(e,{},E);void 0===W&&(W=p);const ee=t.layers[0].layout,ae=ee.get("icon-offset").evaluate(e,{},E),be=R0(n.horizontal)||n.vertical,Ee="globe"===A.name,Me=S1,We=p/Me,Re=t.tilePixelRatio*W/Me,et=(gn=t.overscaling,t.zoom>18&&gn>2&&(gn>>=1),Math.max(Rn/(512*gn),1)*ee.get("symbol-spacing")),mt=ee.get("text-padding")*t.tilePixelRatio,Dt=ee.get("icon-padding")*t.tilePixelRatio,Wt=Ye(ee.get("text-max-angle")),Vt="map"===ee.get("text-rotation-alignment")&&"point"!==ee.get("symbol-placement"),un="map"===ee.get("icon-rotation-alignment")&&"point"!==ee.get("symbol-placement"),yn=ee.get("symbol-placement"),tn=et/2;var gn;const Kt=ee.get("icon-text-fit").evaluate(e,{},E),pn=ee.get("icon-text-fit-padding").evaluate(e,{},E),Gn="none"!==Kt;let wn;!1===t.hasAnyIconTextFit&&Gn&&(t.hasAnyIconTextFit=!0),r&&Gn&&(t.allowVerticalPlacement&&n.vertical&&(wn=Xh(r,n.vertical,Kt,pn,ae,We)),be&&(r=Xh(r,be,Kt,pn,ae,We)));const pi=(ni,Ln,$i)=>{if(Ln.x<0||Ln.x>=Rn||Ln.y<0||Ln.y>=Rn)return;let wi=null;if(Ee){const{x:li,y:Mn,z:ki}=A.projectTilePoint(Ln.x,Ln.y,$i);wi={anchor:new Ic(li,Mn,ki,0,void 0),up:A.upVector($i,Ln.x,Ln.y)}}!function(li,Mn,ki,Dr,Ki,Tr,fr,qr,Mr,ks,is,os,hs,Qr,Ks,bs,Lo,Ko,Xa,Xs,Do,Sa,Ta,Ja,Js,g2,Qc){const J1=li.addToLineVertexArray(Mn,Dr);let g1,L2,H6,Yf,Y5,pp,mp,Kf=0,K5=0,lu=0,Xf=0,P6=-1,gp=-1;const Qa={};let _p=$4("");const el=ki?ki.anchor:Mn,Jf="none"!==Mr.layout.get("icon-text-fit").evaluate(Do,{},Js);let Qf=0,_2=0;if(void 0===Mr._unevaluatedLayout.getValue("text-radial-offset")?[Qf,_2]=Mr.layout.get("text-offset").evaluate(Do,{},Js).map(Q1=>Q1*S1):(Qf=Mr.layout.get("text-radial-offset").evaluate(Do,{},Js)*S1,_2=N0),li.allowVerticalPlacement&&Ki.vertical){const Q1=Ki.vertical;if(Ks)pp=O0(Q1),qr&&(mp=O0(qr));else{const e2=Mr.layout.get("text-rotate").evaluate(Do,{},Js)+90;H6=sf(ks,el,Mn,is,os,hs,Q1,Qr,e2,bs),qr&&(Yf=sf(ks,el,Mn,is,os,hs,qr,Ko,e2))}}if(Tr){const Q1=Mr.layout.get("icon-rotate").evaluate(Do,{},Js),e2=C8(Tr,Q1,Ta,Jf),z3=qr?C8(qr,Q1,Ta,Jf):void 0;L2=sf(ks,el,Mn,is,os,hs,Tr,Ko,Q1),Kf=4*e2.length;const ed=li.iconSizeData;let A3=null;"source"===ed.kind?(A3=[lc*Mr.layout.get("icon-size").evaluate(Do,{},Js)],A3[0]>E2&&Ii(`${li.layerIds[0]}: Value for "icon-size" is >= ${m4}. Reduce your "icon-size".`)):"composite"===ed.kind&&(A3=[lc*Sa.compositeIconSizes[0].evaluate(Do,{},Js),lc*Sa.compositeIconSizes[1].evaluate(Do,{},Js)],(A3[0]>E2||A3[1]>E2)&&Ii(`${li.layerIds[0]}: Value for "icon-size" is >= ${m4}. Reduce your "icon-size".`)),li.addSymbols(li.icon,e2,A3,Xs,Xa,Do,!1,ki,Mn,J1.lineStartIndex,J1.lineLength,-1,Ja,Js,g2,Qc),P6=li.icon.placedSymbolArray.length-1,z3&&(K5=4*z3.length,li.addSymbols(li.icon,z3,A3,Xs,Xa,Do,p2.vertical,ki,Mn,J1.lineStartIndex,J1.lineLength,-1,Ja,Js,g2,Qc),gp=li.icon.placedSymbolArray.length-1)}for(const Q1 in Ki.horizontal){const e2=Ki.horizontal[Q1];g1||(_p=$4(e2.text),Ks?Y5=O0(e2):g1=sf(ks,el,Mn,is,os,hs,e2,Qr,Mr.layout.get("text-rotate").evaluate(Do,{},Js),bs));const z3=1===e2.positionedLines.length;if(lu+=y5(li,ki,Mn,e2,fr,Mr,Ks,Do,bs,J1,Ki.vertical?p2.horizontal:p2.horizontalOnly,z3?Object.keys(Ki.horizontal):[Q1],Qa,P6,Sa,Ja,Js,g2),z3)break}Ki.vertical&&(Xf+=y5(li,ki,Mn,Ki.vertical,fr,Mr,Ks,Do,bs,J1,p2.vertical,["vertical"],Qa,gp,Sa,Ja,Js,g2));let Ll=-1;const uu=(Q1,e2)=>Q1?Math.max(Q1,e2):e2;Ll=uu(Y5,Ll),Ll=uu(pp,Ll),Ll=uu(mp,Ll);const X5=Ll>-1?1:0;li.glyphOffsetArray.length>=65535&&Ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Do.sortKey&&li.addToSortKeyRanges(li.symbolInstances.length,Do.sortKey),li.symbolInstances.emplaceBack(Mn.x,Mn.y,el.x,el.y,el.z,Qa.right>=0?Qa.right:-1,Qa.center>=0?Qa.center:-1,Qa.left>=0?Qa.left:-1,Qa.vertical>=0?Qa.vertical:-1,P6,gp,_p,void 0!==g1?g1:li.collisionBoxArray.length,void 0!==g1?g1+1:li.collisionBoxArray.length,void 0!==H6?H6:li.collisionBoxArray.length,void 0!==H6?H6+1:li.collisionBoxArray.length,void 0!==L2?L2:li.collisionBoxArray.length,void 0!==L2?L2+1:li.collisionBoxArray.length,Yf||li.collisionBoxArray.length,Yf?Yf+1:li.collisionBoxArray.length,is,lu,Xf,Kf,K5,X5,0,Qf,_2,Ll,0,Jf?1:0)}(t,Ln,wi,ni,n,r,c,wn,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,mt,Vt,y,0,Dt,un,ae,e,u,x,M,E,O,U)};if("line"===yn)for(const ni of v8(e.geometry,0,0,Rn,Rn)){const Ln=_5(ni,et,Wt,n.vertical||be,r,Me,Re,t.overscaling,Rn);for(const $i of Ln)be&&T8(t,be.text,tn,$i)||pi(ni,$i,E)}else if("line-center"===yn){for(const ni of e.geometry)if(ni.length>1){const Ln=g8(ni,Wt,n.vertical||be,r,Me,Re);Ln&&pi(ni,Ln,E)}}else if("Polygon"===e.type)for(const ni of mh(e.geometry,0)){const Ln=S8(ni,16);pi(ni[0],new Ic(Ln.x,Ln.y,0,0,void 0),E)}else if("LineString"===e.type)for(const ni of e.geometry)pi(ni,new Ic(ni[0].x,ni[0].y,0,0,void 0),E);else if("Point"===e.type)for(const ni of e.geometry)for(const Ln of ni)pi([Ln],new Ic(Ln.x,Ln.y,0,0,void 0),E)}const m4=255,E2=m4*lc;function y5(t,e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee,ae){const be=function(We,Re,et,mt,Dt,Wt,Vt,un){const yn=[];if(0===Re.positionedLines.length)return yn;const tn=mt.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,gn=function(pi){const ni=pi[0],Ln=pi[1],$i=ni*Ln;return $i>0?[ni,-Ln]:$i<0?[-ni,Ln]:0===ni?[Ln,ni]:[Ln,-ni]}(et);let Kt=Math.abs(Re.top-Re.bottom);for(const pi of Re.positionedLines)Kt-=pi.lineOffset;const pn=Re.positionedLines.length,Gn=Kt/pn;let wn=Re.top-et[1];for(let pi=0;pi<pn;++pi){const ni=Re.positionedLines[pi];wn=M8(Re,Gn,wn,pi);for(const Ln of ni.positionedGlyphs){if(!Ln.rect)continue;const $i=Ln.rect||{};let wi=Wh+1,li=!0,Mn=1,ki=0;if(Ln.imageName){const Xs=Vt[Ln.imageName];if(!Xs)continue;if(Xs.sdf){Ii("SDF images are not supported in formatted text and will be ignored.");continue}li=!1,Mn=Xs.pixelRatio,wi=m2/Mn}const Dr=(Dt||un)&&Ln.vertical,Ki=Ln.metrics.advance*Ln.scale/2,Tr=Ln.metrics,fr=Ln.rect;if(null===fr)continue;un&&Re.verticalizable&&(ki=Ln.imageName?Ki-Ln.metrics.width*Ln.scale/2:0);const qr=Dt?[Ln.x+Ki,Ln.y]:[0,0];let Mr=[0,0],ks=[0,0],is=!1;Dt||(Dr?(ks=[Ln.x+Ki+gn[0],Ln.y+gn[1]-ki],is=!0):Mr=[Ln.x+Ki+et[0],Ln.y+et[1]-ki]);const os=fr.w*Ln.scale/(Mn*(Ln.localGlyph?fc:1)),hs=fr.h*Ln.scale/(Mn*(Ln.localGlyph?fc:1));let Qr,Ks,bs,Lo;if(Dr){const Xs=Ln.y-wn,Do=new Te(-Ki,Ki-Xs),Sa=-Math.PI/2,Ta=new Te(...ks);Qr=new Te(-Ki+Mr[0],Mr[1]),Qr._rotateAround(Sa,Do)._add(Ta),Qr.x+=-Xs+Ki,Qr.y-=(Tr.left-wi)*Ln.scale;const Ja=Ln.imageName?Tr.advance*Ln.scale:S1*Ln.scale,Js=String.fromCodePoint(Ln.glyph);f5(Js)?Qr.x+=(1-wi)*Ln.scale:Oh(Js)?Qr.x+=Ja-Tr.height*Ln.scale+(-wi-1)*Ln.scale:Qr.x+=Ln.imageName||Tr.width+2*wi===fr.w&&Tr.height+2*wi===fr.h?(Ja-hs)/2:(Ja-(Tr.height+2*wi)*Ln.scale)/2,Ks=new Te(Qr.x,Qr.y-os),bs=new Te(Qr.x+hs,Qr.y),Lo=new Te(Qr.x+hs,Qr.y-os)}else{const Xs=(Tr.left-wi)*Ln.scale-Ki+Mr[0],Do=(-Tr.top-wi)*Ln.scale+Mr[1],Sa=Xs+os,Ta=Do+hs;Qr=new Te(Xs,Do),Ks=new Te(Sa,Do),bs=new Te(Xs,Ta),Lo=new Te(Sa,Ta)}if(tn){let Xs;Xs=Dt?new Te(0,0):is?new Te(gn[0],gn[1]):new Te(et[0],et[1]),Qr._rotateAround(tn,Xs),Ks._rotateAround(tn,Xs),bs._rotateAround(tn,Xs),Lo._rotateAround(tn,Xs)}const Ko=new Te(0,0),Xa=new Te(0,0);yn.push({tl:Qr,tr:Ks,bl:bs,br:Lo,texPrimary:$i,texSecondary:void 0,writingMode:Re.writingMode,glyphOffset:qr,sectionIndex:Ln.sectionIndex,isSDF:li,pixelOffsetTL:Ko,pixelOffsetBR:Xa,minFontScaleX:0,minFontScaleY:0})}}return yn}(0,r,y,u,p,g,c,t.allowVerticalPlacement),Ee=t.textSizeData;let Me=null;"source"===Ee.kind?(Me=[lc*u.layout.get("text-size").evaluate(g,{},ee)],Me[0]>E2&&Ii(`${t.layerIds[0]}: Value for "text-size" is >= ${m4}. Reduce your "text-size".`)):"composite"===Ee.kind&&(Me=[lc*U.compositeTextSizes[0].evaluate(g,{},ee),lc*U.compositeTextSizes[1].evaluate(g,{},ee)],(Me[0]>E2||Me[1]>E2)&&Ii(`${t.layerIds[0]}: Value for "text-size" is >= ${m4}. Reduce your "text-size".`)),t.addSymbols(t.text,be,Me,y,p,g,M,e,n,x.lineStartIndex,x.lineLength,O,W,ee,ae,!1);for(const We of E)A[We]=t.text.placedSymbolArray.length-1;return 4*be.length}function R0(t){for(const e in t)return t[e];return null}function sf(t,e,n,r,c,u,p,g,y,x){let M=p.top,E=p.bottom,A=p.left,O=p.right;const U=p.collisionPadding;if(U&&(A-=U[0],M-=U[1],O+=U[2],E+=U[3]),y){const W=new Te(A,M),ee=new Te(O,M),ae=new Te(A,E),be=new Te(O,E),Ee=Ye(y);let Me=new Te(0,0);x&&(Me=new Te(x[0],x[1])),W._rotateAround(Ee,Me),ee._rotateAround(Ee,Me),ae._rotateAround(Ee,Me),be._rotateAround(Ee,Me),A=Math.min(W.x,ee.x,ae.x,be.x),O=Math.max(W.x,ee.x,ae.x,be.x),M=Math.min(W.y,ee.y,ae.y,be.y),E=Math.max(W.y,ee.y,ae.y,be.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,A,M,O,E,g,r,c,u),t.length-1}function O0(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function T8(t,e,n,r){const c=t.compareText;if(e in c){const u=c[e];for(let p=u.length-1;p>=0;p--)if(r.dist(u[p])<n)return!0}else c[e]=[];return c[e].push(r),!1}function x5(t,e){const n=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),u=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),p=Math.sin(t._pitch)*u+c;return Math.min(1.01*p,c*(1/t._horizonShift))}function Vr(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),r=t.x*n,c=(t.x+1)*n,u=t.y*n,p=(t.y+1)*n,g=mr(r),y=mr(c),x=Yr(u),M=Yr(p),E=e.project(g,x),A=e.project(y,x),O=e.project(y,M),U=e.project(g,M);let W=Math.min(E.x,A.x,O.x,U.x),ee=Math.min(E.y,A.y,O.y,U.y),ae=Math.max(E.x,A.x,O.x,U.x),be=Math.max(E.y,A.y,O.y,U.y);const Ee=n/16;function Me(Re,et,mt,Dt,Wt,Vt){const un=(mt+Wt)/2,yn=(Dt+Vt)/2,tn=e.project(mr(un),Yr(yn)),gn=Math.max(0,W-tn.x,ee-tn.y,tn.x-ae,tn.y-be);W=Math.min(W,tn.x),ae=Math.max(ae,tn.x),ee=Math.min(ee,tn.y),be=Math.max(be,tn.y),gn>Ee&&(Me(Re,tn,mt,Dt,un,yn),Me(tn,et,un,yn,Wt,Vt))}Me(E,A,r,u,c,u),Me(A,O,c,u,c,p),Me(O,U,c,p,r,p),Me(U,E,r,p,r,u),W-=Ee,ee-=Ee,ae+=Ee,be+=Ee;const We=1/Math.max(ae-W,be-ee);return{scale:We,x:W*We,y:ee*We,x2:ae*We,y2:be*We,projection:e}}function E8(t,{x:e,y:n},r=0){return new Te(((e-r)*t.scale-t.x)*Rn,(n*t.scale-t.y)*Rn)}const z8=s.a6.identity(new Float32Array(16));class Ml{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Lt(0,0)}projectTilePoint(e,n,r){return{x:e,y:n,z:0}}locationPoint(e,n,r=!0){return e._coordinatePoint(e.locationCoordinate(n),r)}pixelsPerMeter(e,n){return yr(1,e)*n}pixelSpaceConversion(e,n,r){return 1}farthestPixelDistance(e){return x5(e,e.pixelsPerMeter)}pointCoordinate(e,n,r,c){const u=e.horizonLineFromTop(!1),p=new Te(n,Math.max(u,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,n,r){const c=new Te(n,r);if(e.elevation)return e.elevation.pointCoordinate(c);{const u=this.pointCoordinate(e,c.x,c.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const r=e.horizonLineFromTop();return n.y<r}createInversionMatrix(e,n){return z8}createTileMatrix(e,n,r){let c,u,p;const g=r.canonical,y=s.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Vr(g,this);c=1,u=x.x+r.wrap*x.scale,p=x.y,s.a6.scale(y,y,[c/x.scale,c/x.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(g.z),u=(g.x+Math.pow(2,g.z)*r.wrap)*c,p=g.y*c;return s.a6.translate(y,y,[u,p,0]),s.a6.scale(y,y,[c/Rn,c/Rn,1]),y}upVector(e,n,r){return[0,0,1]}upVectorScale(e,n,r){return{metersToTile:1}}}class g4 extends Ml{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,r]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Ye(n));this.n=(c+Math.sin(Ye(r)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:r,c,r0:u}=this,p=Ye(e-this.center[0]),g=Ye(n),y=Math.sqrt(c-2*r*Math.sin(g))/r;return{x:y*Math.sin(p*r),y:y*Math.cos(p*r)-u,z:0}}unproject(e,n){const{n:r,c,r0:u}=this,p=u+n;let g=Math.atan2(e,Math.abs(p))*Math.sign(p);p*r<0&&(g-=Math.PI*Math.sign(e)*Math.sign(p));const y=Ye(this.center[0])*r;g=Mi(g,-Math.PI-y,Math.PI-y);const x=Ot(Pt(g/r)+this.center[0],-180,180),M=Math.asin(Ot((c-(e*e+p*p)*r*r)/(2*r),-1,1)),E=Ot(Pt(M),-xr,xr);return new Lt(x,E)}}const _4=1.340264,Sl=-.081106,Tl=893e-6,$o=.003796,af=Math.sqrt(3)/2;class A8 extends Ml{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(af*Math.sin(n)),c=r*r,u=c*c*c;return{x:.5*(e*Math.cos(r)/(af*(_4+3*Sl*c+u*(7*Tl+9*$o*c)))/Math.PI+.5),y:1-.5*(r*(_4+Sl*c+u*(Tl+$o*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let r=n=(2*(1-n)-1)*Math.PI,c=r*r,u=c*c*c;for(let M,E,A,O=0;O<12&&(E=r*(_4+Sl*c+u*(Tl+$o*c))-n,A=_4+3*Sl*c+u*(7*Tl+9*$o*c),M=E/A,r=Ot(r-M,-Math.PI/3,Math.PI/3),c=r*r,u=c*c*c,!(Math.abs(M)<1e-12));++O);const p=af*e*(_4+3*Sl*c+u*(7*Tl+9*$o*c))/Math.cos(r),g=Math.asin(Math.sin(r)/af),y=Ot(180*p/Math.PI,-180,180),x=Ot(180*g/Math.PI,-xr,xr);return new Lt(y,x)}}class L8 extends Ml{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const r=360*(e-.5),c=Ot(360*(.5-n),-xr,xr);return new Lt(r,c)}}const v4=Math.PI/2;function F0(t){return Math.tan((v4+t)/2)}class D8 extends Ml{constructor(e){super(e),this.center=e.center||[0,30];const[n,r]=this.parallels=e.parallels||[30,30];let c=Ye(n),u=Ye(r);this.southernCenter=c+u<0,this.southernCenter&&(c=-c,u=-u);const p=Math.cos(c),g=F0(c);this.n=c===u?Math.sin(c):Math.log(p/Math.cos(u))/Math.log(F0(u)/g),this.f=p*Math.pow(F0(c),this.n)/this.n}project(e,n){n=Ye(n),this.southernCenter&&(n=-n),e=Ye(e-this.center[0]);const r=1e-6,{n:c,f:u}=this;u>0?n<-v4+r&&(n=-v4+r):n>v4-r&&(n=v4-r);const p=u/Math.pow(F0(n),c);let g=p*Math.sin(c*e),y=u-p*Math.cos(c*e);return g=.5*(g/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:g,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:r,f:c}=this,u=c-n,p=Math.sign(u),g=Math.sign(r)*Math.sqrt(e*e+u*u);let y=Math.atan2(e,Math.abs(u))*p;u*r<0&&(y-=Math.PI*Math.sign(e)*p);const x=Ot(Pt(y/r)+this.center[0],-180,180),M=Ot(Pt(2*Math.atan(Math.pow(c/g,1/r))-v4),-xr,xr);return new Lt(x,this.southernCenter?-M:M)}}class cf extends Ml{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:ur(e),y:ar(n),z:0}}unproject(e,n){const r=mr(e),c=Yr(n);return new Lt(r,c)}}const lf=Ye(xr);class uf extends Ml{project(e,n){const r=(n=Ye(n))*n,c=r*r;return{x:.5*((e=Ye(e))*(.8707-.131979*r+c*(c*(.003971*r-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+r*(.015085+c*(.028874*r-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let r=n=(2*(1-n)-1)*Math.PI,c=25,u=0,p=r*r;do{p=r*r;const x=p*p;u=(r*(1.007226+p*(.015085+x*(.028874*p-.044475-.005916*x)))-n)/(1.007226+p*(.045255+x*(.259866*p-.311325-.005916*11*x))),r=Ot(r-u,-lf,lf)}while(Math.abs(u)>1e-6&&--c>0);p=r*r;const g=Ot(Pt(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=Pt(r);return new Lt(g,y)}}const I8=Ye(xr);class b5 extends Ml{project(e,n){n=Ye(n),e=Ye(e);const r=Math.cos(n),c=2/Math.PI,u=Math.acos(r*Math.cos(e/2)),p=Math.sin(u)/u,g=.5*(e*c+2*r*Math.sin(e/2)/p)||0,y=.5*(n+Math.sin(n)/p)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let r=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,u=25;const p=1e-6;let g=0,y=0;do{const x=Math.cos(c),M=Math.sin(c),E=2*M*x,A=M*M,O=x*x,U=Math.cos(r/2),W=Math.sin(r/2),ee=2*U*W,ae=W*W,be=1-O*U*U,Ee=be?1/be:0,Me=be?Math.acos(x*U)*Math.sqrt(1/be):0,We=.5*(2*Me*x*W+2*r/Math.PI)-e,Re=.5*(Me*M+c)-n,et=.5*Ee*(O*ae+Me*x*U*A)+1/Math.PI,mt=Ee*(ee*E/4-Me*M*W),Dt=.125*Ee*(E*W-Me*M*O*ee),Wt=.5*Ee*(A*U+Me*ae*x)+.5,Vt=mt*Dt-Wt*et;g=(Re*mt-We*Wt)/Vt,y=(We*Dt-Re*et)/Vt,r=Ot(r-g,-Math.PI,Math.PI),c=Ot(c-y,-I8,I8)}while((Math.abs(g)>p||Math.abs(y)>p)&&--u>0);return new Lt(Pt(r),Pt(c))}}class y4 extends Ml{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ye(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:r,cosPhi:c}=this;return{x:Ye(e)*c*r+.5,y:-Math.sin(Ye(n))/c*r+.5,z:0}}unproject(e,n){const{scale:r,cosPhi:c}=this,u=-(n-.5)/r,p=Ot(Pt((e-.5)/r)/c,-180,180),g=Math.asin(Ot(u*c,-1,1)),y=Ot(Pt(g),-xr,xr);return new Lt(p,y)}}class w5 extends cf{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,r){const c=e3(e,n,r),u=Y3(q2(r));return s.N.transformMat4(c,c,u),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){const r=en(n.lat,n.lng),c=s.N.normalize([],r),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=yr(1,0)*Rn*u;s.N.scaleAndAdd(r,r,c,p);const g=s.a6.identity(new Float64Array(16));return s.a6.multiply(g,e.pixelMatrix,e.globeMatrix),s.N.transformMat4(r,r,g),new Te(r[0],r[1])}pixelsPerMeter(e,n){return yr(1,0)*n}pixelSpaceConversion(e,n,r){const c=yr(1,e)*n,u=Pi(yr(1,45)*n,c,r);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,r){const c=K3(q2(r.canonical));return s.a6.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){const{center:r}=e,c=Y3(q2(n));return s.a6.rotateY(c,c,Ye(r.lng)),s.a6.rotateX(c,c,Ye(r.lat)),s.a6.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,r,c){return l0(e,n,r,!0)||new Jr(0,0)}pointCoordinate3D(e,n,r){const c=this.pointCoordinate(e,n,r,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!l0(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(c,u){const p=c.cameraToCenterDistance,g=c._centerAltitude*u,y=c._camera,x=c._camera.forward(),M=s.N.add([],s.N.scale([],x,-p),[0,0,g]),E=c.worldSize/(2*Math.PI),A=[0,0,-E],O=c.width/c.height,U=Math.tan(c.fovAboveCenter),W=s.N.scale([],y.up(),U),ee=s.N.scale([],y.right(),U*O),ae=s.N.normalize([],s.N.add([],s.N.add([],x,W),ee)),be=[];let Ee;if(new nh(M,ae).closestPointOnSphere(A,E,be)){const Me=s.N.add([],be,A),We=s.N.sub([],Me,M);Ee=Math.cos(c.fovAboveCenter)*s.N.length(We)}else{const Me=s.N.sub([],M,A),We=s.N.sub([],A,M);s.N.normalize(We,We);const Re=s.N.length(Me)-E;Ee=Math.sqrt(Re*(Re+2*E));const et=Math.acos(Ee/(E+Re))-Math.acos(s.N.dot(x,We));Ee*=Math.cos(et)}return 1.01*Ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=_l(e.zoom);if(r>0){const c=x5(e,yr(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Pi(n,c+u*(1-Math.cos(p)),Math.pow(r,10))}return n}upVector(e,n,r){return e3(n,r,e,1)}upVectorScale(e){return{metersToTile:sh(t3(q2(e)))}}}function hf(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new cf(t);case"equirectangular":return new L8(t);case"naturalEarth":return new uf(t);case"equalEarth":return new A8(t);case"winkelTripel":return new b5(t);case"albers":return n?new y4(t):new g4(t);case"lambertConformalConic":return n?new y4(t):new D8(t);case"globe":return new w5(t)}throw new Error(`Invalid projection name: ${t.name}`)}const C5=yh.types,g6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function x4(t,e,n,r,c,u,p,g,y,x,M,E,A){const O=g?Math.min(E2,Math.round(g[0])):0,U=g?Math.min(E2,Math.round(g[1])):0;t.emplaceBack(e,n,Math.round(32*r),Math.round(32*c),u,p,(O<<1)+(y?1:0),U,16*x,16*M,256*E,256*A)}function B0(t,e,n){t.emplaceBack(e,n)}function U0(t,e,n,r,c,u,p){t.emplaceBack(e,n,r,c,u,p)}function j0(t,e,n,r,c){t.emplaceBack(e,n,r,c),t.emplaceBack(e,n,r,c),t.emplaceBack(e,n,r,c),t.emplaceBack(e,n,r,c)}function G0(t){for(const e of t.sections)if(f1(e.text))return!0;return!1}class El{constructor(e){this.layoutVertexArray=new rl,this.indexArray=new Pa,this.programConfigurations=e,this.segments=new Ro,this.dynamicLayoutVertexArray=new O2,this.opacityVertexArray=new k4,this.placedSymbolArray=new U4,this.iconTransitioningVertexArray=new B2,this.globeExtVertexArray=new h2,this.zOffsetVertexArray=new Ol}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,n,r,c,u){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,u5.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,g6,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,h3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,l5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,u6.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Xn(El,"SymbolBuffers");class ff{constructor(e,n,r){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new r,this.segments=new Ro,this.collisionVertexArray=new O4,this.collisionVertexArrayExt=new O2}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Nh.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,h5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xn(ff,"CollisionBuffers");class _6{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.a6.identity([]),this.placementViewportMatrix=s.a6.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kh(this.zoom,n["text-size"]),this.iconSizeData=kh(this.zoom,n["icon-size"]);const r=this.layers[0].layout,c=r.get("symbol-sort-key"),u=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==u&&void 0!==c.constantOr(1),this.sortFeaturesByY=("viewport-y"===u||"auto"===u&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(p=>p2[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new El(new le(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new El(new le(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new _u,this.lineVertexArray=new ll,this.symbolInstances=new j4}calculateGlyphDependencies(e,n,r,c,u){for(let p=0;p<e.length;p++){const g=e.codePointAt(p);if(void 0===g)break;if(n[g]=!0,c&&u&&g<=65535){const y=z0[e.charAt(p)];y&&(n[y.charCodeAt(0)]=!0)}}}populate(e,n,r,c){const u=this.layers[0],p=u.layout,g="globe"===this.projection.name,y=p.get("text-font"),x=p.get("text-field"),M=p.get("icon-image"),E=("constant"!==x.value.kind||x.value.value instanceof Gs&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&("constant"!==y.value.kind||y.value.value.length>0),A="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,O=p.get("symbol-sort-key");if(this.features=[],!E&&!A)return;const U=n.iconDependencies,W=n.glyphDependencies,ee=n.availableImages,ae=new or(this.zoom);for(const{feature:be,id:Ee,index:Me,sourceLayerIndex:We}of e){const Re=u._featureFilter.needGeometry,et=no(be,Re);if(!u._featureFilter.filter(ae,et,r))continue;if(Re||(et.geometry=ra(be,r,c)),g&&1!==be.type&&r.z<=5){const Vt=et.geometry,un=.98078528056,yn=(tn,gn)=>{const Kt=e3(tn.x,tn.y,r,1),pn=e3(gn.x,gn.y,r,1);return s.N.dot(Kt,pn)<un};for(let tn=0;tn<Vt.length;tn++)Vt[tn]=p1(Vt[tn],yn)}let mt,Dt;if(E){const Vt=u.getValueAndResolveTokens("text-field",et,r,ee),un=Gs.factory(Vt);G0(un)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===zn()||this.hasRTLText&&_i.isParsed())&&(mt=Rh(un,u,et))}if(A){const Vt=u.getValueAndResolveTokens("icon-image",et,r,ee);Dt=Vt instanceof Qn?Vt:Qn.fromString(Vt)}if(!mt&&!Dt)continue;const Wt=this.sortFeaturesByKey?O.evaluate(et,{},r):void 0;if(this.features.push({id:Ee,text:mt,icon:Dt,index:Me,sourceLayerIndex:We,geometry:et.geometry,properties:be.properties,type:C5[be.type],sortKey:Wt}),Dt&&(U[Dt.namePrimary]=!0,Dt.nameSecondary&&(U[Dt.nameSecondary]=!0)),mt){const Vt=y.evaluate(et,{},r).join(","),un="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(p2.vertical)>=0;for(const yn of mt.sections)if(yn.image)U[yn.image.namePrimary]=!0;else{const tn=o2(mt.toString()),gn=yn.fontStack||Vt,Kt=W[gn]=W[gn]||{};this.calculateGlyphDependencies(yn.text,Kt,un,this.allowVerticalPlacement,tn)}}}"line"===p.get("symbol-placement")&&(this.features=function(be){const Ee={},Me={},We=[];let Re=0;function et(Vt){We.push(be[Vt]),Re++}function mt(Vt,un,yn){const tn=Me[Vt];return delete Me[Vt],Me[un]=tn,We[tn].geometry[0].pop(),We[tn].geometry[0]=We[tn].geometry[0].concat(yn[0]),tn}function Dt(Vt,un,yn){const tn=Ee[un];return delete Ee[un],Ee[Vt]=tn,We[tn].geometry[0].shift(),We[tn].geometry[0]=yn[0].concat(We[tn].geometry[0]),tn}function Wt(Vt,un,yn){const tn=yn?un[0][un[0].length-1]:un[0][0];return`${Vt}:${tn.x}:${tn.y}`}for(let Vt=0;Vt<be.length;Vt++){const un=be[Vt],yn=un.geometry,tn=un.text?un.text.toString():null;if(!tn){et(Vt);continue}const gn=Wt(tn,yn),Kt=Wt(tn,yn,!0);if(gn in Me&&Kt in Ee&&Me[gn]!==Ee[Kt]){const pn=Dt(gn,Kt,yn),Gn=mt(gn,Kt,We[pn].geometry);delete Ee[gn],delete Me[Kt],Me[Wt(tn,We[Gn].geometry,!0)]=Gn,We[pn].geometry=null}else gn in Me?mt(gn,Kt,yn):Kt in Ee?Dt(gn,Kt,yn):(et(Vt),Ee[gn]=Re-1,Me[Kt]=Re-1)}return We.filter(Vt=>Vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((be,Ee)=>be.sortKey-Ee.sortKey)}update(e,n,r,c,u){const p=0!==Object.keys(e).length;if(p&&!this.stateDependentLayers.length)return;const g=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,g,r,c,u),this.icon.programConfigurations.updatePaintArrays(e,n,g,r,c,u)}updateZOffset(){const e=(u,p,g)=>{r+=p,r>u.length&&u.resize(r);for(let y=-p;y<0;y++)u.emplace(y+r,g)},n=(u,p,g)=>{c+=p,c>u.length&&u.resize(c);for(let y=-p;y<0;y++)u.emplace(y+c,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,c=0;for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:y,numIconVertices:x}=p,M=p.zOffset,E=x>0;if((g>0||y>0)&&(e(this.text.zOffsetVertexArray,g,M),e(this.text.zOffsetVertexArray,y,M)),E){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:O}=p;A>=0&&n(this.icon.zOffsetVertexArray,x,M),O>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:c,y:u}of n)this.lineVertexArray.emplaceBack(c,u);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,n,r,c,u,p,g,y,x,M,E,A,O,U,W,ee){const ae=e.indexArray,be=e.layoutVertexArray,Ee=e.globeExtVertexArray,Me=e.segments.prepareSegment(4*n.length,be,ae,this.canOverlap?p.sortKey:void 0),We=this.glyphOffsetArray.length,Re=Me.vertexLength,et=this.allowVerticalPlacement&&g===p2.vertical?Math.PI/2:0,mt=p.text&&p.text.sections;for(let Wt=0;Wt<n.length;Wt++){const{tl:Vt,tr:un,bl:yn,br:tn,texPrimary:gn,texSecondary:Kt,pixelOffsetTL:pn,pixelOffsetBR:Gn,minFontScaleX:wn,minFontScaleY:pi,glyphOffset:ni,isSDF:Ln,sectionIndex:$i}=n[Wt],wi=Me.vertexLength,li=ni[1];if(x4(be,x.x,x.y,Vt.x,li+Vt.y,gn.x,gn.y,r,Ln,pn.x,pn.y,wn,pi),x4(be,x.x,x.y,un.x,li+un.y,gn.x+gn.w,gn.y,r,Ln,Gn.x,pn.y,wn,pi),x4(be,x.x,x.y,yn.x,li+yn.y,gn.x,gn.y+gn.h,r,Ln,pn.x,Gn.y,wn,pi),x4(be,x.x,x.y,tn.x,li+tn.y,gn.x+gn.w,gn.y+gn.h,r,Ln,Gn.x,Gn.y,wn,pi),y){const{x:Mn,y:ki,z:Dr}=y.anchor,[Ki,Tr,fr]=y.up;U0(Ee,Mn,ki,Dr,Ki,Tr,fr),U0(Ee,Mn,ki,Dr,Ki,Tr,fr),U0(Ee,Mn,ki,Dr,Ki,Tr,fr),U0(Ee,Mn,ki,Dr,Ki,Tr,fr),j0(e.dynamicLayoutVertexArray,Mn,ki,Dr,et)}else j0(e.dynamicLayoutVertexArray,x.x,x.y,x.z,et);if(ee){const Mn=Kt||gn;B0(e.iconTransitioningVertexArray,Mn.x,Mn.y),B0(e.iconTransitioningVertexArray,Mn.x+Mn.w,Mn.y),B0(e.iconTransitioningVertexArray,Mn.x,Mn.y+Mn.h),B0(e.iconTransitioningVertexArray,Mn.x+Mn.w,Mn.y+Mn.h)}ae.emplaceBack(wi,wi+1,wi+2),ae.emplaceBack(wi+1,wi+2,wi+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ni[0]),Wt!==n.length-1&&$i===n[Wt+1].sectionIndex||e.programConfigurations.populatePaintArrays(be.length,p,p.index,{},O,U,W,mt&&mt[$i])}const Dt=y?y.anchor:x;e.placedSymbolArray.emplaceBack(Dt.x,Dt.y,Dt.z,x.x,x.y,We,this.glyphOffsetArray.length-We,Re,M,E,x.segment,r?r[0]:0,r?r[1]:0,c[0],c[1],g,0,!1,0,A,0)}_commitLayoutVertex(e,n,r,c,u,p,g){e.emplaceBack(n,r,c,u,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,n,r,c,u,p,g){const y=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),x=y.vertexLength,M=g.tileAnchorX,E=g.tileAnchorY;for(let O=0;O<4;O++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,n,e.padding,g.zOffset),this._commitLayoutVertex(r.layoutVertexArray,c,u,p,M,E,new Te(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,c,u,p,M,E,new Te(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,c,u,p,M,E,new Te(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,c,u,p,M,E,new Te(e.x1,e.y2)),y.vertexLength+=4;const A=r.indexArray;A.emplaceBack(x,x+1),A.emplaceBack(x+1,x+2),A.emplaceBack(x+2,x+3),A.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,r,c,u,p){for(let g=c;g<u;g++){const y=r.get(g),x=this.getSymbolInstanceTextSize(e,p,n,g);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,r,c,u,p){for(let g=c;g<u;g++){const y=r.get(g),x=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ff(sl,h6.members,B2),this.iconCollisionBox=new ff(sl,h6.members,B2);const r=f3(this.iconSizeData,e),c=f3(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,r,c){const u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=E0(this.textSizeData,e,u)/S1;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,r){const c=this.icon.placedSymbolArray.get(r),u=E0(this.iconSizeData,e,c);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,r,c){e.emplaceBack(n,-r,-r,c),e.emplaceBack(n,r,-r,c),e.emplaceBack(n,r,r,c),e.emplaceBack(n,-r,r,c)}_updateTextDebugCollisionBoxes(e,n,r,c,u,p){for(let g=c;g<u;g++){const y=r.get(g),x=this.getSymbolInstanceTextSize(e,p,n,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,r,c,u,p){for(let g=c;g<u;g++){const y=r.get(g),x=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=f3(this.iconSizeData,e),c=f3(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(r,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(r,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,r,c,u,p,g,y,x){const M={};if(n<r){const{x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me,featureIndex:We}=e.get(n);M.textBox={x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me},M.textFeatureIndex=We}if(c<u){const{x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me,featureIndex:We}=e.get(c);M.verticalTextBox={x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me},M.verticalTextFeatureIndex=We}if(p<g){const{x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me,featureIndex:We}=e.get(p);M.iconBox={x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me},M.iconFeatureIndex=We}if(y<x){const{x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me,featureIndex:We}=e.get(y);M.verticalIconBox={x1:E,y1:A,x2:O,y2:U,padding:W,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Me},M.verticalIconFeatureIndex=We}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const r=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const r=e.placedSymbolArray.get(n),c=r.vertexStartIndex+4*r.numGlyphs;for(let u=r.vertexStartIndex;u<c;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),r=Math.cos(e),c=[],u=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const y=this.symbolInstances.get(g);c.push(0|Math.round(n*y.tileAnchorX+r*y.tileAnchorY)),u.push(y.featureIndex)}return p.sort((g,y)=>c[g]-c[y]||u[y]-u[g]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===n?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const r=this.symbolInstances.get(n);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:x}=r;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xn(_6,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),_6.addDynamicAttributes=j0;const V8=new Co({"symbol-placement":new On(Rt.layout_symbol["symbol-placement"]),"symbol-spacing":new On(Rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(Rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zi(Rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(Rt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new On(Rt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new On(Rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(Rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(Rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(Rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new zi(Rt.layout_symbol["icon-size"]),"icon-text-fit":new zi(Rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zi(Rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new zi(Rt.layout_symbol["icon-image"]),"icon-rotate":new zi(Rt.layout_symbol["icon-rotate"]),"icon-padding":new On(Rt.layout_symbol["icon-padding"]),"icon-keep-upright":new On(Rt.layout_symbol["icon-keep-upright"]),"icon-offset":new zi(Rt.layout_symbol["icon-offset"]),"icon-anchor":new zi(Rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(Rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(Rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(Rt.layout_symbol["text-rotation-alignment"]),"text-field":new zi(Rt.layout_symbol["text-field"]),"text-font":new zi(Rt.layout_symbol["text-font"]),"text-size":new zi(Rt.layout_symbol["text-size"]),"text-max-width":new zi(Rt.layout_symbol["text-max-width"]),"text-line-height":new zi(Rt.layout_symbol["text-line-height"]),"text-letter-spacing":new zi(Rt.layout_symbol["text-letter-spacing"]),"text-justify":new zi(Rt.layout_symbol["text-justify"]),"text-radial-offset":new zi(Rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(Rt.layout_symbol["text-variable-anchor"]),"text-anchor":new zi(Rt.layout_symbol["text-anchor"]),"text-max-angle":new On(Rt.layout_symbol["text-max-angle"]),"text-writing-mode":new On(Rt.layout_symbol["text-writing-mode"]),"text-rotate":new zi(Rt.layout_symbol["text-rotate"]),"text-padding":new On(Rt.layout_symbol["text-padding"]),"text-keep-upright":new On(Rt.layout_symbol["text-keep-upright"]),"text-transform":new zi(Rt.layout_symbol["text-transform"]),"text-offset":new zi(Rt.layout_symbol["text-offset"]),"text-allow-overlap":new On(Rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(Rt.layout_symbol["text-ignore-placement"]),"text-optional":new On(Rt.layout_symbol["text-optional"]),visibility:new On(Rt.layout_symbol.visibility)});var v6={paint:new Co({"icon-opacity":new zi(Rt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new zi(Rt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new zi(Rt.paint_symbol["text-emissive-strength"]),"icon-color":new zi(Rt.paint_symbol["icon-color"]),"icon-halo-color":new zi(Rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new zi(Rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zi(Rt.paint_symbol["icon-halo-blur"]),"icon-translate":new On(Rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(Rt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new zi(Rt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new zi(Rt.paint_symbol["text-opacity"]),"text-color":new zi(Rt.paint_symbol["text-color"],{runtimeType:es,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new zi(Rt.paint_symbol["text-halo-color"]),"text-halo-width":new zi(Rt.paint_symbol["text-halo-width"]),"text-halo-blur":new zi(Rt.paint_symbol["text-halo-blur"]),"text-translate":new On(Rt.paint_symbol["text-translate"]),"text-translate-anchor":new On(Rt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new On(Rt.paint_symbol["icon-color-saturation"])}),layout:V8};class y6{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ws,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xn(y6,"FormatSectionOverride",{omit:["defaultValue"]});class $0 extends q1{constructor(e,n,r){super(e,v6,n,r)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const c=[];for(const u of r)c.indexOf(u)<0&&c.push(u);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,r,c){const u=this.layout.get(e).evaluate(n,{},r,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Wr(p.value)||!u?u:(g=n.properties,u.replace(/{([^{}]+)}/g,(x,M)=>M in g?String(g[M]):""));var g}createBucket(e){return new _6(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of v6.paint.overridableProperties){if(!$0.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),r=new y6(n),c=new Zr(r,n.property.specification,this.scope,this.options);let u=null;u="constant"===n.value.kind||"source"===n.value.kind?new Fr("source",c):new _s("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new N2(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&$0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const r=e.get("text-field"),c=v6.paint.properties[n];let u=!1;const p=g=>{for(const y of g)if(c.overrides&&c.overrides.hasOverride(y))return void(u=!0)};if("constant"===r.value.kind&&r.value.value instanceof Gs)p(r.value.value.sections);else if("source"===r.value.kind){const g=x=>{u||(x instanceof Oo&&as(x.value)===fo?p(x.value.sections):x instanceof _1?p(x.sections):x.eachChild(g))},y=r.value;y._styleExpression&&g(y._styleExpression.expression)}return u}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),n=0!==this.paint.get("text-opacity").constantOr(1),r=[];return e&&r.push("symbolIcon"),n&&r.push("symbolSDF"),r}getDefaultProgramParams(e,n){return{config:new Q(this,n),overrideFog:!1}}}const H8=new Co({visibility:new On(Rt.layout_background.visibility)});var P8={paint:new Co({"background-color":new On(Rt.paint_background["background-color"]),"background-pattern":new On(Rt.paint_background["background-pattern"]),"background-opacity":new On(Rt.paint_background["background-opacity"]),"background-emissive-strength":new On(Rt.paint_background["background-emissive-strength"])}),layout:H8};const M5=new Co({visibility:new On(Rt.layout_raster.visibility)});var S5={paint:new Co({"raster-opacity":new On(Rt.paint_raster["raster-opacity"]),"raster-color":new xc(Rt.paint_raster["raster-color"]),"raster-color-mix":new On(Rt.paint_raster["raster-color-mix"]),"raster-color-range":new On(Rt.paint_raster["raster-color-range"]),"raster-hue-rotate":new On(Rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(Rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(Rt.paint_raster["raster-brightness-max"]),"raster-saturation":new On(Rt.paint_raster["raster-saturation"]),"raster-contrast":new On(Rt.paint_raster["raster-contrast"]),"raster-resampling":new On(Rt.paint_raster["raster-resampling"]),"raster-fade-duration":new On(Rt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new On(Rt.paint_raster["raster-emissive-strength"]),"raster-array-band":new On(Rt.paint_raster["raster-array-band"]),"raster-elevation":new On(Rt.paint_raster["raster-elevation"])}),layout:M5},df=cs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class N8{constructor(e,n,r,c){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,r){const{width:c,height:u}=e,{context:p}=this,{gl:g}=p;if(g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!n||!1!==n.premultiply)),r||this.size&&this.size[0]===c&&this.size[1]===u){const{x:y,y:x}=r||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)g.texSubImage2D(g.TEXTURE_2D,0,y,x,g.RGBA,g.UNSIGNED_BYTE,e);else{let M=this.format,E=g.UNSIGNED_BYTE;this.format===g.R32F&&(M=g.RED,E=g.FLOAT),g.texSubImage2D(g.TEXTURE_2D,0,y,x,c,u,M,E,e.data)}}else if(this.size=[c,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===g.R8&&(y=g.RED),g.texImage2D(g.TEXTURE_2D,0,this.format,y,g.UNSIGNED_BYTE,e)}else{let y=this.format,x=this.format,M=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(y=g.DEPTH_COMPONENT16,M=g.UNSIGNED_SHORT),this.format===g.R8&&(x=g.RED),this.format===g.R32F&&(M=g.FLOAT,x=g.RED),g.texImage2D(g.TEXTURE_2D,0,y,c,u,0,x,M,e.data)}this.useMipmap=Boolean(n&&n.useMipmap),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,n,r=!1){const{context:c}=this,{gl:u}=c;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,r,c){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),this.wrapS=r),c!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class x6{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}function pf(t,e,n,r,c,u,p,g){const y=[t,e,1,n,r,1,c,u,1],x=[p,g,1],M=s.co.adjoint([],y),[E,A,O]=s.N.transformMat3(x,x,M);return s.co.multiply(y,y,[E,0,0,0,A,0,0,0,O])}function mf(t,e,n,r,c,u,p,g){const y=function(x,M,E,A,O,U,W,ee){const ae=pf(0,0,1,0,1,1,0,1),be=pf(x,M,E,A,O,U,W,ee),Ee=s.co.adjoint([],ae);return s.co.multiply(be,be,Ee)}(t,e,n,r,c,u,p,g);return[y[2]/y[8]/Rn,y[5]/y[8]/Rn]}function v3(t){return[t[0],Math.min(Math.max(t[1],-xr),xr)]}class k8 extends Os{constructor(e,n,r,c){super(),this.id=e,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ds("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ye(this.map._requestManager.transformRequest(this.url,vn.Image),(r,c)=>{this._imageRequest=null,this._loaded=!0,r?this.fire(new ro(r)):c&&(this.image=c instanceof HTMLImageElement?It.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new x6(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ds("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof x6||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],r=e[0][1];for(const u of e)u[1]>r&&(r=u[1]),u[1]<n&&(n=u[1]);const c=(r+n)/2;if(c>xr?this.onNorthPole=!0:c<-xr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(Jr.fromLngLat);this.tileID=function(p){let g=1/0,y=1/0,x=-1/0,M=-1/0;for(const W of p)g=Math.min(g,W.x),y=Math.min(y,W.y),x=Math.max(x,W.x),M=Math.max(M,W.y);const E=Math.max(x-g,M-y),A=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),O=Math.pow(2,A);let U=Math.floor((g+x)/2*O);return U>1&&(U-=1),new Cn(A,U,Math.floor((y+M)/2*O))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ds("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ae in this.tiles){const be=this.tiles[ae];"loaded"!==be.state&&(be.state="loaded",be.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=Vr(new Cn(0,0,0),this.map.transform.projection),r=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ae){const be=ae[1].x-ae[0].x,Ee=ae[1].y-ae[0].y,Me=ae[2].x-ae[1].x,We=ae[2].y-ae[1].y,Re=ae[3].x-ae[2].x,et=ae[3].y-ae[2].y,mt=ae[0].x-ae[3].x,Dt=ae[0].y-ae[3].y,Wt=be*We-Me*Ee,Vt=Me*et-Re*We,un=Re*Dt-mt*et,yn=mt*Ee-be*Dt;return Wt>0&&Vt>0&&un>0&&yn>0||Wt<0&&Vt<0&&un<0&&yn<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=Vr(this.tileID,this.map.transform.projection),[u,p,g,y]=this.coordinates.map(ae=>{const be=c.projection.project(ae[0],ae[1]);return E8(c,be)._round()});this.perspectiveTransform=mf(u.x,u.y,p.x,p.y,g.x,g.y,y.x,y.y);const x=this._boundsArray=new bc;x.emplaceBack(u.x,u.y,0,0),x.emplaceBack(p.x,p.y,Rn,0),x.emplaceBack(y.x,y.y,0,Rn),x.emplaceBack(g.x,g.y,Rn,Rn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,df.members),this.boundsSegments=Ro.simpleSegment(0,0,4,2);const M=[],E=[v3((A=this.coordinates)[0]),v3(A[1]),v3(A[2]),v3(A[3])];var A;const[O,U,W,ee]=function(ae){let be=ae[0][0],Ee=be,Me=ae[0][1],We=Me;for(let Re=1;Re<ae.length;Re++)ae[Re][0]<be?be=ae[Re][0]:ae[Re][0]>Ee&&(Ee=ae[Re][0]),ae[Re][1]<Me?Me=ae[Re][1]:ae[Re][1]>We&&(We=ae[Re][1]);return[be,Me,Ee-be,We-Me]}(E);{const ae=new bc,[be,Ee,Me,We]=function(pn){let Gn=pn[0].x,wn=Gn,pi=pn[0].y,ni=pi;for(let Ln=1;Ln<pn.length;Ln++)pn[Ln].x<Gn?Gn=pn[Ln].x:pn[Ln].x>wn&&(wn=pn[Ln].x),pn[Ln].y<pi?pi=pn[Ln].y:pn[Ln].y>ni&&(ni=pn[Ln].y);return[Gn,pi,wn-Gn,ni-pi]}(r),Re=pn=>[(pn.x-be)/Me,(pn.y-Ee)/We],[et,mt,Dt,Wt]=r.map(Re),Vt=function(pn,Gn,wn,pi,ni,Ln,$i,wi){const li=pf(0,0,1,0,1,1,0,1),Mn=pf(pn,Gn,wn,pi,ni,Ln,$i,wi),ki=s.co.adjoint([],Mn);return s.co.multiply(li,li,ki)}(et[0],et[1],mt[0],mt[1],Dt[0],Dt[1],Wt[0],Wt[1]);this.elevatedGlobePerspectiveTransform=mf(et[0],et[1],mt[0],mt[1],Dt[0],Dt[1],Wt[0],Wt[1]);const un=(pn,Gn)=>{M.push(pn.lng);const wn=Math.round((pn.lng-O)/W*Rn),pi=Math.round((pn.lat-U)/ee*Rn),ni=Re(Gn),Ln=s.N.transformMat3([],[ni[0],ni[1],1],Vt),$i=Math.round(Ln[0]/Ln[2]*Rn),wi=Math.round(Ln[1]/Ln[2]*Rn);ae.emplaceBack(wn,pi,$i,wi)},yn=r[3].x-r[0].x,tn=r[3].y-r[0].y,gn=r[2].x-r[1].x,Kt=r[2].y-r[1].y;for(let pn=0;pn<65;pn++){const Gn=pn/64,wn=[r[0].x+Gn*yn,r[0].y+Gn*tn],pi=[r[1].x+Gn*gn,r[1].y+Gn*Kt],ni=pi[0]-wn[0],Ln=pi[1]-wn[1];for(let $i=0;$i<65;$i++){const wi=$i/64,li={x:wn[0]+ni*wi,y:wn[1]+Ln*wi,z:0};un(n.projection.unproject(li.x,li.y),li)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ae,df.members)}{this.maxLongitudeTriangleSize=0;let ae=[],be=new Pa;const Ee=(Me,We,Re)=>{be.emplaceBack(Me,We,Re);const et=M[Me],mt=M[We],Dt=M[Re],Wt=Math.min(Math.min(et,mt),Dt),Vt=Math.max(Math.max(et,mt),Dt)-Wt;Vt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Vt),ae.push(Wt+Vt/2)};for(let Me=0;Me<64;Me++)for(let We=0;We<64;We++){const Re=65*Me+We,et=Re+1,mt=Re+65,Dt=mt+1;Ee(Re,mt,et),Ee(et,mt,Dt)}[ae,be]=function(Me,We){const Re=Array.from({length:Me.length},(Dt,Wt)=>Wt);Re.sort((Dt,Wt)=>Me[Dt]-Me[Wt]);const et=[],mt=new Pa;for(let Dt=0;Dt<Re.length;Dt++){const Wt=Re[Dt];et.push(Me[Wt]);const Vt=3*Wt,un=Vt+1;mt.emplaceBack(We.uint16[Vt],We.uint16[un],We.uint16[un+1])}return[et,mt]}(ae,be),this.elevatedGlobeTrianglesCenterLongitudes=ae,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(be)}this.elevatedGlobeSegments=Ro.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/Rn,0,ee/Rn,0,0,U,O,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const n=this.map.painter.context,r=n.gl;!this._dirty||this.texture instanceof x6||(this.texture?this.texture.update(this.image):(this.texture=new N8(n,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let c=(M=e+180)+360*Math.round((r[0]-M)/360);var M;const u=new Ro,p=(M,E)=>{u.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:n.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},g=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-c)<=g){const M=zt(r,0,r.length,c+g);return M===r.length||p(M,it(r,M+1,r.length,c+360-g)-M),u}c<r[0]&&(c+=360);const y=it(r,0,r.length,c-g);if(y===r.length)return p(0,r.length),u;p(0,y-0);const x=zt(r,y+1,r.length,c+g);return x!==r.length&&p(x,r.length-x),u}}const T5=(Math.pow(256,2)-1)/16907520;class b6 extends q1{constructor(e,n,r){super(e,S5,n,r),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof k8&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[r,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(c)||r===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=X3({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,c])}}const W0=new Co({visibility:new On(Rt["layout_raster-particle"].visibility)});var w6={paint:new Co({"raster-particle-array-band":new On(Rt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new On(Rt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new xc(Rt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new On(Rt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new On(Rt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new On(Rt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new On(Rt["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:W0};class R8 extends q1{constructor(e,n,r){super(e,w6,n,r),this._updateColorRamp(),this.onRemove=c=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&c.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=It.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=X3({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=It.now()}}class E5 extends q1{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const z5=new Co({visibility:new On(Rt.layout_sky.visibility)});var ym={paint:new Co({"sky-type":new On(Rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new On(Rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new On(Rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new On(Rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new On(Rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new xc(Rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new On(Rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new On(Rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new On(Rt.paint_sky["sky-opacity"])}),layout:z5};function C6(t,e,n){const r=[0,0,1],c=s.bi.identity([]);return s.bi.rotateY(c,c,n?-Ye(t)+Math.PI:Ye(t)),s.bi.rotateX(c,c,-Ye(e)),s.N.transformQuat(r,r,c),s.N.normalize(r,r)}var O8={paint:new Co({})};function F8(t,e){const n=zl(t.projection,t.zoom,t.width,t.height),r=function(u,p,g,y,x){const M=new Lt(g.lng-180*Al,g.lat),E=new Lt(g.lng+180*Al,g.lat),A=u.project(M.lng,M.lat),O=u.project(E.lng,E.lat),U=-Math.atan2(O.y-A.y,O.x-A.x),W=Jr.fromLngLat(g);W.y=Ot(W.y,-1+Al,1-Al);const ee=W.toLngLat(),ae=u.project(ee.lng,ee.lat),be=Jr.fromLngLat(ee);be.x+=Al;const Ee=be.toLngLat(),Me=u.project(Ee.lng,Ee.lat),We=U8(Me.x-ae.x,Me.y-ae.y,U),Re=Jr.fromLngLat(ee);Re.y+=Al;const et=Re.toLngLat(),mt=u.project(et.lng,et.lat),Dt=U8(mt.x-ae.x,mt.y-ae.y,U),Wt=Math.abs(We.x)/Math.abs(Dt.y),Vt=s.a6.identity([]);s.a6.rotateZ(Vt,Vt,-U*(1-(x?0:y)));const un=s.a6.identity([]);return s.a6.scale(un,un,[1,1-(1-Wt)*y,1]),un[4]=-Dt.x/Dt.y*y,s.a6.rotateZ(un,un,U),s.a6.multiply(un,Vt,un),un}(t.projection,0,t.center,n,e),c=B8(t);return s.a6.scale(r,r,[c,c,1]),r}function B8(t){const e=t.projection,n=zl(t.projection,t.zoom,t.width,t.height),r=M6(e,t.center),c=M6(e,Lt.convert(e.center));return Math.pow(2,r*n+(1-n)*c)}function zl(t,e,n,r,c=1/0){const u=t.range;if(!u)return 0;const p=Math.min(c,Math.max(n,r)),g=Math.log(p/1024)/Math.LN2;return Xt(u[0]+g,u[1]+g,e)}const Al=1/4e4;function M6(t,e){const n=Ot(e.lat,-xr,xr),r=new Lt(e.lng-180*Al,n),c=new Lt(e.lng+180*Al,n),u=t.project(r.lng,n),p=t.project(c.lng,n),g=Jr.fromLngLat(r),y=Jr.fromLngLat(c),x=p.x-u.x,M=p.y-u.y,E=y.x-g.x,A=y.y-g.y,O=Math.sqrt((E*E+A*A)/(x*x+M*M));return Math.log(O)/Math.LN2}function U8(t,e,n){const r=Math.cos(n),c=Math.sin(n);return{x:t*r-e*c,y:t*c+e*r}}function gf(t,e,n){s.a6.identity(t),s.a6.rotateZ(t,t,Ye(e[2])),s.a6.rotateX(t,t,Ye(e[0])),s.a6.rotateY(t,t,Ye(e[1])),s.a6.scale(t,t,n),s.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function q0(t,e,n,r,c,u,p,g){const y=[n[0]-e[0],n[1]-e[1],0],x=[r[0]-e[0],r[1]-e[1],0];if(s.N.length(y)<1e-12||s.N.length(x)<1e-12)return s.bi.identity(t);const M=s.N.cross([],y,x);s.N.normalize(M,M),s.N.subtract(x,r,e),y[2]=(u-c)*g,x[2]=(p-c)*g;const E=y;return s.N.cross(E,y,x),s.N.normalize(E,E),s.bi.rotationTo(t,M,E)}function S6(t,e,n=!1){const r=_l(e.zoom),c=function(u,p,g){const y=p.worldSize,x=[u[12],u[13],u[14]],M=Yr(x[1]/y),E=mr(x[0]/y),A=s.a6.identity([]),O=yr(1,M)*y,U=yr(1,0)*y*kr(M,p.zoom),W=1/h0(y);let ee=U*W;if(g){const Me=zl(p.projection,p.zoom,p.width,p.height,1024);ee=W*p.projection.pixelSpaceConversion(p.center.lat,y,Me)}const ae=en(M,E);s.N.add(ae,ae,s.N.scale([],s.N.normalize([],ae),O*ee*x[2]));const be=function(Me){const We=[Me[0],Me[1],Me[2]];let Re=[0,1,0];const et=s.N.cross([],Re,We);return s.N.cross(Re,We,et),0===s.N.squaredLength(Re)&&(Re=[0,1,0],s.N.cross(et,We,Re)),s.N.normalize(et,et),s.N.normalize(Re,Re),s.N.normalize(We,We),[et[0],et[1],et[2],0,Re[0],Re[1],Re[2],0,We[0],We[1],We[2],0,Me[0],Me[1],Me[2],1]}(ae);s.a6.scale(A,A,[ee,ee,ee*O]),s.a6.translate(A,A,[-x[0],-x[1],-x[2]]);const Ee=s.a6.multiply([],p.globeMatrix,be);return s.a6.multiply(Ee,Ee,A),s.a6.multiply(Ee,Ee,u),Ee}(t,e,n);return r>0?function(p,g,y){const x=(U,W,ee)=>{const ae=s.N.length(U),be=s.N.length(W),Ee=jc(U,W,ee);return s.N.scale(Ee,Ee,1/s.N.length(Ee)*Pi(ae,be,ee))},M=x([p[0],p[1],p[2]],[g[0],g[1],g[2]],y),E=x([p[4],p[5],p[6]],[g[4],g[5],g[6]],y),A=x([p[8],p[9],p[10]],[g[8],g[9],g[10]],y),O=jc([p[12],p[13],p[14]],[g[12],g[13],g[14]],y);return[M[0],M[1],M[2],0,E[0],E[1],E[2],0,A[0],A[1],A[2],0,O[0],O[1],O[2],1]}(c,function(p,g){const y=g.worldSize,x=yr(1,0)*y*kr(g.center.lat,g.zoom)/h0(y),M=yr(1,g.center.lat)*y,E=s.a6.identity([]);return s.a6.rotateY(E,E,Ye(g.center.lng)),s.a6.rotateX(E,E,Ye(g.center.lat)),s.a6.translate(E,E,[0,0,Ce]),s.a6.scale(E,E,[x,x,x*M]),s.a6.translate(E,E,[g.point.x-.5*y,g.point.y-.5*y,0]),s.a6.multiply(E,E,p),s.a6.multiply(E,g.globeMatrix,E)}(t,e),r):c}function j8(t,e,n,r){const c=vo.projectAabbCorners(r,n);let u=Number.MAX_VALUE,p=-1;for(let x=0;x<c.length;++x){const M=c[x];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<u&&(p=x,u=M[2])}const g=x=>new Te(c[x][0],c[x][1]);let y;switch(p){case 0:case 6:y=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:y=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:y=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:y=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(C2(t,y))return u}const _f=cs([{name:"a_pos_3f",components:3,type:"Float32"}]),G8=cs([{name:"a_color_3f",components:3,type:"Float32"}]),$8=cs([{name:"a_color_4f",components:4,type:"Float32"}]),vf=cs([{name:"a_uv_2f",components:2,type:"Float32"}]),A5=cs([{name:"a_normal_3f",components:3,type:"Float32"}]),L5=cs([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),D5=cs([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class T6{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class W8{constructor(){this.instancedDataArray=new Mc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class E6{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,r,c){this.tileToMeter=Rr(r);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:g,index:y,sourceLayerIndex:x}of e){const M=no(p,u);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),M,r))continue;const E={id:g,sourceLayerIndex:x,index:y,geometry:u?M.geometry:ra(p,r,c),properties:p.properties,type:p.type,patterns:{}},A=this.addFeature(E,E.geometry,M);A&&n.featureIndex.insert(p,E.geometry,y,x,this.index,this.instancesPerModel[A].instancedDataArray.length,Rn/32)}this.lookup=null}update(e,n,r,c){for(const u in this.instancesPerModel){const p=this.instancesPerModel[u];for(const g in e)p.idToFeaturesIndex.hasOwnProperty(g)&&this.evaluate(p.features[p.idToFeaturesIndex[g]],e[g],p,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const r=this.instancesPerModel[n];for(const c of r.features){const u=this.layers[0],p=c.feature,g=this.canonical,y=u.paint.get("model-rotation").evaluate(p,{},g),x=u.paint.get("model-scale").evaluate(p,{},g),M=u.paint.get("model-translation").evaluate(p,{},g);s.N.exactEquals(c.rotation,y)&&s.N.exactEquals(c.scale,x)&&s.N.exactEquals(c.translation,M)||(this.evaluate(c,c.featureStates,r,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const r=this.instancesPerModel[n];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,L5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const n=this.instancesPerModel[e];0!==n.instancedDataArray.length&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,r){const c=this.layers[0],u=c.layout.get("model-id").evaluate(r,{},this.canonical);if(!u)return Ii(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new W8);const p=this.instancesPerModel[u],g=p.instancedDataArray,y=new T6(r,g.length);for(const x of n)for(const M of x){if(M.x<0||M.x>=Rn||M.y<0||M.y>=Rn)continue;const E=(this.lookupDim-1)/Rn,A=this.lookupDim*(M.y*E|0)+M.x*E|0;if(this.lookup){if(0!==this.lookup[A])continue;this.lookup[A]=1}this.instanceCount++;const O=g.length;g.resize(O+1),p.instancesEvaluatedElevation.push(0),g.float32[16*O]=M.x,g.float32[16*O+1]=M.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),u}evaluate(e,n,r,c){const u=this.layers[0],p=e.feature,g=this.canonical,y=e.rotation=u.paint.get("model-rotation").evaluate(p,n,g),x=e.scale=u.paint.get("model-scale").evaluate(p,n,g),M=e.translation=u.paint.get("model-translation").evaluate(p,n,g),E=u.paint.get("model-color").evaluate(p,n,g);E.a=u.paint.get("model-color-mix-intensity").evaluate(p,n,g);const A=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),gf(A,y,x);const O=Math.round(100*E.a)+E.b/1.05;for(let U=0;U<e.instancedDataCount;++U){const W=e.instancedDataOffset+U,ee=16*W,ae=r.instancedDataArray.float32;let be=0;c&&(be=ae[ee+6]-r.instancesEvaluatedElevation[W]);const Ee=0|ae[ee+1];ae[ee]=(0|ae[ee])+E.r/1.05,ae[ee+1]=Ee+E.g/1.05,ae[ee+2]=O,ae[ee+3]=1/(g.z>10?this.tileToMeter:Rr(g,Ee)),ae[ee+4]=M[0],ae[ee+5]=M[1],ae[ee+6]=M[2]+be,ae[ee+7]=A[0],ae[ee+8]=A[1],ae[ee+9]=A[2],ae[ee+10]=A[4],ae[ee+11]=A[5],ae[ee+12]=A[6],ae[ee+13]=A[8],ae[ee+14]=A[9],ae[ee+15]=A[10],r.instancesEvaluatedElevation[W]=M[2]}}}Xn(E6,"ModelBucket",{omit:["layers"]}),Xn(W8,"PerModelAttributes"),Xn(T6,"ModelFeature");const I5=new Co({visibility:new On(Rt.layout_model.visibility),"model-id":new zi(Rt.layout_model["model-id"])});var V5={paint:new Co({"model-opacity":new On(Rt.paint_model["model-opacity"]),"model-rotation":new zi(Rt.paint_model["model-rotation"]),"model-scale":new zi(Rt.paint_model["model-scale"]),"model-translation":new zi(Rt.paint_model["model-translation"]),"model-color":new zi(Rt.paint_model["model-color"]),"model-color-mix-intensity":new zi(Rt.paint_model["model-color-mix-intensity"]),"model-type":new On(Rt.paint_model["model-type"]),"model-cast-shadows":new On(Rt.paint_model["model-cast-shadows"]),"model-receive-shadows":new On(Rt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new On(Rt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new zi(Rt.paint_model["model-emissive-strength"]),"model-roughness":new zi(Rt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new zi(Rt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new On(Rt.paint_model["model-cutoff-fade-range"])}),layout:I5};const y3=64,b4={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function yf(t,e,n,r,c,u,p,g,y,x=!1){const M=n.zoom,E=n.project(r),A=kr(r.lat,M),O=1/A;s.a6.identity(t),s.a6.translate(t,t,[E.x+p[0]*O,E.y+p[1]*O,p[2]]);let U=1,W=1;const ee=n.worldSize;if(x){if("mercator"===n.projection.name){let Me=0;n.elevation&&(Me=n.elevation.getAtPointOrZero(new Jr(E.x/ee,E.y/ee),0));const We=s.a7.transformMat4([],[E.x,E.y,Me,1],n.projMatrix)[3]/n.cameraToCenterDistance;U=We,W=We*kr(n.center.lat,M)}else if("globe"===n.projection.name){const Me=S6(t,n),We=s.a6.multiply([],n.projMatrix,Me),Re=[0,0,0,1];s.a7.transformMat4(Re,Re,We);const et=Re[3]/n.cameraToCenterDistance,mt=_l(M),Dt=n.projection.pixelsPerMeter(r.lat,ee)*kr(r.lat,M),Wt=n.projection.pixelsPerMeter(n.center.lat,ee)*kr(n.center.lat,M);U=et/Pi(Dt,Us(n.center.lat),mt),W=et*A/Dt,U*=Wt,W*=Wt}}else U=O;s.a6.scale(t,t,[U,U,W]);const ae=[...t],be=e.orientation,Ee=[];if(gf(Ee,[be[0]+c[0],be[1]+c[1],be[2]+c[2]],u),s.a6.multiply(t,ae,Ee),g&&n.elevation){let Me=0;const We=[];if(y&&n.elevation){Me=function(mt,Dt,Wt,Vt,un){const yn=Dt.elevation;if(!yn)return 0;const tn=vo.projectAabbCorners(Wt,Vt),gn=yr(1,un.lat)*Dt.worldSize,Kt=function(ki,Dr){const Ki=[0,0,1],Tr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const fr of Tr){const qr=ki[fr.corners[0]],Mr=ki[fr.corners[1]],ks=ki[fr.corners[2]],is=[Mr[0]-qr[0],Mr[1]-qr[1],Dr*(Mr[2]-qr[2])],os=s.N.cross(is,is,[ks[0]-qr[0],ks[1]-qr[1],Dr*(ks[2]-qr[2])]);s.N.normalize(os,os),fr.dotProductWithUp=s.N.dot(os,Ki)}return Tr.sort((fr,qr)=>fr.dotProductWithUp-qr.dotProductWithUp),Tr[0].corners}(tn,gn),pn=tn[Kt[0]],Gn=tn[Kt[1]],wn=tn[Kt[2]],pi=tn[Kt[3]],ni=yn.getAtPointOrZero(new Jr(pn[0]/Dt.worldSize,pn[1]/Dt.worldSize),0),Ln=yn.getAtPointOrZero(new Jr(Gn[0]/Dt.worldSize,Gn[1]/Dt.worldSize),0),$i=yn.getAtPointOrZero(new Jr(wn[0]/Dt.worldSize,wn[1]/Dt.worldSize),0),wi=yn.getAtPointOrZero(new Jr(pi[0]/Dt.worldSize,pi[1]/Dt.worldSize),0),li=(ni+wi)/2,Mn=(Ln+$i)/2;return li>Mn?Ln<$i?q0(mt,Gn,pi,pn,Ln,wi,ni,gn):q0(mt,wn,pn,pi,$i,ni,wi,gn):ni<wi?q0(mt,pn,Gn,wn,ni,Ln,$i,gn):q0(mt,pi,wn,Gn,wi,$i,Ln,gn),Math.max(li,Mn)}(We,n,e.aabb,t,r);const Re=s.a6.fromQuat([],We),et=s.a6.multiply([],Re,Ee);s.a6.multiply(t,ae,et)}else Me=n.elevation.getAtPointOrZero(new Jr(E.x/ee,E.y/ee),0);0!==Me&&(t[14]+=Me)}}function Z0(t,e,n=!1){t.uploaded||(t.gfxTexture=new N8(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function q8(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,_f.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,A5.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,vf.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?G8:$8).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,D5.members,!0)),t.segments=Ro.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const r=t.material;r.pbrMetallicRoughness.baseColorTexture&&Z0(r.pbrMetallicRoughness.baseColorTexture,e),r.pbrMetallicRoughness.metallicRoughnessTexture&&Z0(r.pbrMetallicRoughness.metallicRoughnessTexture,e),r.normalTexture&&Z0(r.normalTexture,e),r.occlusionTexture&&Z0(r.occlusionTexture,e,n),r.emissionTexture&&Z0(r.emissionTexture,e)}function Y0(t,e,n){if(t.meshes)for(const r of t.meshes)q8(r,e,n);if(t.children)for(const r of t.children)Y0(r,e,n)}function K0(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)K0(e)}function z6(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)z6(n)}class H5{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class P5{constructor(){this.tasks={},this.taskQueue=[],Ne(["process"],this),this.invoker=new H5(this.process),this.nextId=0}add(e,n){const r=this.nextId++,c=function({type:u,isSymbolTile:p,zoom:g}){return g=g||0,"message"===u?0:"maybePrepare"!==u||p?"parseTile"!==u||p?"parseTile"===u&&p?300-g:"maybePrepare"===u&&p?400-g:500:200-g:100-g}(n);if(0===c){Ur();try{e()}finally{}return null}return this.tasks[r]={fn:e,metadata:n,priority:c,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Ur();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const u=this.tasks[this.taskQueue[c]];u.priority<n&&(n=u.priority,e=c)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class A6{constructor(e,n,r){this.target=e,this.parent=n,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Ne(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new P5}send(e,n,r,c,u=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=p,this.callbacks[g]=r);const y=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!r,targetMapId:c,mustQueue:u,sourceMapId:this.mapId,data:Ts(n,y)},y),{cancel:()=>{r&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const n=e.data,r=n.id;if(r&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const c=this.cancelCallbacks[r];delete this.cancelCallbacks[r],c&&c.cancel()}else if(n.mustQueue||Ur()){const c=this.callbacks[r],u=this.scheduler.add(()=>this.processTask(r,n),c&&c.metadata||{type:"message"});u&&(this.cancelCallbacks[r]=u)}else this.processTask(r,n)}processTask(e,n){if(delete this.cancelCallbacks[e],"<response>"===n.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(n.error?r(Ya(n.error)):r(null,Ya(n.data)))}else{const r=new Set,c=n.hasCallback?(p,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Ts(p):null,data:Ts(g,r)},r)}:p=>{},u=Ya(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,c);else if(this.parent.getWorkerSource){const p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],u.source,u.scope)[p[1]](u,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let xf=(()=>{class t{constructor(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=rt();const c=this.workerPool.acquire(this.id);for(let u=0;u<c.length;u++){const p=new t.Actor(c[u],r,this.id);p.name=`Worker ${u}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,r,c){Wi(this.actors,(u,p)=>{u.send(n,r,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=A6,t})();var x3={workerUrl:"",workerClass:null,workerParams:void 0};function N5(){return null!=x3.workerClass?new x3.workerClass:new self.Worker(x3.workerUrl,x3.workerParams)}const X0="mapboxgl_preloaded_worker_pool";class b3{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<b3.workerCount;)this.workers.push(new N5);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[X0]}numActive(){return Object.keys(this.active).length}}let w4;function w3(){return w4||(w4=new b3),w4}b3.workerCount=2;let L6,bf,z2,C4,D6,dc=null;function wf(){return Ur()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:bf||Et.DRACO_URL}function Z8(){if(Ur()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(C4)return C4;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return C4=WebAssembly.validate(t)?Et.MESHOPT_SIMD_URL:Et.MESHOPT_URL,C4}const Cf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Y8={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},C3={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function K8(t,e,n){const r=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=r,n.json.bufferViews[r]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}const J0="KHR_draco_mesh_compression";function k5(t,e){const n=t.extensions&&t.extensions[J0];if(!n)return;const r=new z2.Decoder,c=X8(e,n.bufferView),u=new z2.Mesh;if(!r.DecodeArrayToMesh(c,c.byteLength,u))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[t.indices],g=Cf[p.componentType],y=p.count*g.BYTES_PER_ELEMENT,x=z2._malloc(y);g===Uint16Array?r.GetTrianglesUInt16Array(u,y,x):r.GetTrianglesUInt32Array(u,y,x),K8(z2.memory.buffer.slice(x,x+y),p,e),z2._free(x);for(const M of Object.keys(n.attributes)){const E=r.GetAttributeByUniqueId(u,n.attributes[M]),A=e.json.accessors[t.attributes[M]],O=Y8[A.componentType],U=A.count*C3[A.type]*Cf[A.componentType].BYTES_PER_ELEMENT,W=z2._malloc(U);r.GetAttributeDataArrayForAllPoints(u,E,z2[O],U,W),K8(z2.memory.buffer.slice(W,W+U),A,e),z2._free(W)}r.destroy(),u.destroy(),delete t.extensions[J0]}const M4="EXT_meshopt_compression";function Mf(t,e){if(!t.extensions||!t.extensions[M4])return;const n=t.extensions[M4],r=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);D6.decodeGltfBuffer(c,n.count,n.byteStride,r,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[M4]}const I6=1179937895,Sf=new TextDecoder("utf8");function Tf(t,e){return new URL(t,e).href}function Ef(t,e,n,r){return fetch(Tf(t.uri,r)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function X8(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function R5(t,e,n,r){if(t.uri){const c=Tf(t.uri,r);return fetch(c).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[n]=u})}if(void 0!==t.bufferView){const c=X8(e,t.bufferView),u=new Blob([c],{type:t.mimeType});return createImageBitmap(u).then(p=>{e.images[n]=p})}}function zf(t,e=0,n){const r={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===I6){const M=new Uint32Array(t,e);let E=2;const A=(M[E++]>>2)-3,O=M[E++]>>2;if(E++,r.json=JSON.parse(Sf.decode(M.subarray(E,E+O))),E+=O,E<A){const U=M[E++];E++;const W=e+(E<<2);r.buffers[0]=t.slice(W,W+U)}}else r.json=JSON.parse(Sf.decode(new Uint8Array(t,e)));const{buffers:c,images:u,meshes:p,extensionsUsed:g,bufferViews:y}=r.json;let x=Promise.resolve();if(c){const M=[];for(let E=0;E<c.length;E++){const A=c[E];A.uri?M.push(Ef(A,r,E,n)):r.buffers[E]||(r.buffers[E]=null)}x=Promise.all(M)}return x.then(()=>{const M=[],E=g&&g.includes(J0),A=g&&g.includes(M4);if(E&&M.push(function(){if(!z2)return L6||(L6=function(O){let U,W=null;function ee(){U=new Uint8Array(W.buffer)}function ae(){throw new Error("Unexpected Draco error.")}const be={a:{a:ae,d:function(Ee,Me,We){return U.copyWithin(Ee,Me,Me+We)},c:function(Ee){const Me=U.length,We=Math.max(Ee>>>0,Math.ceil(1.2*Me)),Re=Math.ceil((We-Me)/65536);try{return W.grow(Re),ee(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(O,be):O.then(Ee=>Ee.arrayBuffer()).then(Ee=>WebAssembly.instantiate(Ee,be))).then(Ee=>{const{Rb:Me,Qb:We,P:Re,T:et,X:mt,Ja:Dt,La:Wt,Qa:Vt,Va:un,Wa:yn,eb:tn,jb:gn,f:Kt,e:pn,yb:Gn,zb:wn,Ab:pi,Bb:ni,Db:Ln,Gb:$i}=Ee.instance.exports;W=pn;const wi=(()=>{let li=0,Mn=0,ki=0,Dr=0;return Ki=>{ki&&(Me(Dr),Me(li),Mn+=ki,ki=li=0),li||(Mn+=128,li=We(Mn));const Tr=Ki.length+7&-8;let fr=li;Tr>=Mn&&(ki=Tr,fr=Dr=We(Tr));for(let qr=0;qr<Ki.length;qr++)U[fr+qr]=Ki[qr];return fr}})();return ee(),Kt(),{memory:pn,_free:Me,_malloc:We,Mesh:class{constructor(){this.ptr=Re()}destroy(){et(this.ptr)}},Decoder:class{constructor(){this.ptr=Dt()}destroy(){gn(this.ptr)}DecodeArrayToMesh(li,Mn,ki){const Dr=wi(li),Ki=Wt(this.ptr,Dr,Mn,ki.ptr);return!!mt(Ki)}GetAttributeByUniqueId(li,Mn){return{ptr:Vt(this.ptr,li.ptr,Mn)}}GetTrianglesUInt16Array(li,Mn,ki){un(this.ptr,li.ptr,Mn,ki)}GetTrianglesUInt32Array(li,Mn,ki){yn(this.ptr,li.ptr,Mn,ki)}GetAttributeDataArrayForAllPoints(li,Mn,ki,Dr,Ki){tn(this.ptr,li.ptr,Mn.ptr,ki,Dr,Ki)}},DT_INT8:Gn(),DT_UINT8:wn(),DT_INT16:pi(),DT_UINT16:ni(),DT_UINT32:Ln(),DT_FLOAT32:$i()}})}(fetch(wf())),L6.then(O=>{z2=O,L6=void 0}))}()),A&&M.push(function(){if(D6)return;const O=function(U){let W;const ee=WebAssembly.instantiateStreaming(U,{}).then(Ee=>{W=Ee.instance,W.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},be={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ee,supported:!0,decodeGltfBuffer(Ee,Me,We,Re,et,mt){!function(Dt,Wt,Vt,un,yn,tn,gn){const Kt=Dt.exports.sbrk,pn=un+3&-4,Gn=Kt(pn*yn),wn=Kt(tn.length),pi=new Uint8Array(Dt.exports.memory.buffer);pi.set(tn,wn);const ni=Wt(Gn,un,yn,wn,tn.length);if(0===ni&&gn&&gn(Gn,pn,yn),Vt.set(pi.subarray(Gn,Gn+un*yn)),Kt(Gn-Kt(0)),0!==ni)throw new Error(`Malformed buffer data: ${ni}`)}(W,W.exports[be[et]],Ee,Me,We,Re,W.exports[ae[mt]])}}}(fetch(Z8()));return O.ready.then(()=>{D6=O})}()),u)for(let O=0;O<u.length;O++)M.push(R5(u[O],r,O,n));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(E&&p)for(const{primitives:O}of p)for(const U of O)k5(U,r);if(A&&p&&y)for(const O of y)Mf(O,r);return r})})}class J8{constructor(e,n,r){if(this.triangleCount=n.length/3,this.min=new Te(0,0),this.max=new Te(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===r)return;const c=e.map(M=>M.x),u=e.map(M=>M.y);this.min=new Te(Math.min(...c),Math.min(...u)),this.max=new Te(Math.max(...c),Math.max(...u));const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const g=Math.max(p.x,p.y)/r;this.cellsX=Math.max(1,Math.ceil(p.x/g)),this.cellsY=Math.max(1,Math.ceil(p.y/g)),this.xScale=1/g,this.yScale=1/g;const y=[];for(let M=0;M<this.triangleCount;M++){const E=e[n[3*M+0]].sub(this.min),A=e[n[3*M+1]].sub(this.min),O=e[n[3*M+2]].sub(this.min),U=Xc(Math.floor(Math.min(E.x,A.x,O.x)),this.xScale,this.cellsX),W=Xc(Math.floor(Math.max(E.x,A.x,O.x)),this.xScale,this.cellsX),ee=Xc(Math.floor(Math.min(E.y,A.y,O.y)),this.yScale,this.cellsY),ae=Xc(Math.floor(Math.max(E.y,A.y,O.y)),this.yScale,this.cellsY),be=new Te(0,0),Ee=new Te(0,0),Me=new Te(0,0),We=new Te(0,0);for(let Re=ee;Re<=ae;++Re){be.y=Ee.y=Re*g,Me.y=We.y=(Re+1)*g;for(let et=U;et<=W;++et)be.x=Me.x=et*g,Ee.x=We.x=(et+1)*g,(q4(E,A,O,be,Ee,We)||q4(E,A,O,be,We,Me))&&y.push({cellIdx:Re*this.cellsX+et,triIdx:M})}}if(0===y.length)return;y.sort((M,E)=>M.cellIdx-E.cellIdx||M.triIdx-E.triIdx);let x=0;for(;x<y.length;){const M=y[x].cellIdx,E={start:this.payload.length,len:0};for(;x<y.length&&y[x].cellIdx===M;)++E.len,this.payload.push(y[x++].triIdx);this.cells[M]=E}}query(e,n,r){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let y=0;y<this.lookup.length;y++)this.lookup[y]=0;const c=Xc(e.x-this.min.x,this.xScale,this.cellsX),u=Xc(n.x-this.min.x,this.xScale,this.cellsX),p=Xc(e.y-this.min.y,this.yScale,this.cellsY),g=Xc(n.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=g;y++)for(let x=c;x<=u;x++){const M=this.cells[y*this.cellsX+x];if(M)for(let E=0;E<M.len;E++){const A=this.payload[M.start+E],O=Math.floor(A/8),U=1<<A%8;if(!(this.lookup[O]&U)&&(this.lookup[O]|=U,r.push(A),r.length===this.triangleCount))return}}}}function Xc(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function S4(t,e){const n=t.json.bufferViews[e.bufferView],r=Cf[e.componentType];return new r(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==C3[e.type]*r.BYTES_PER_ELEMENT?n.byteStride/r.BYTES_PER_ELEMENT:C3[e.type]))}function Q0(t,e,n,r){const c=Cf[e.componentType],u=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),p=t.json.bufferViews[e.bufferView],g=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:C3[e.type],y=n.float32,x=y.length/n.capacity;for(let M=0,E=0;M<e.count*g;M+=g,E+=x)for(let A=0;A<x;A++)y[E+A]=r[M+A]*u;n._trim()}function O5(t,e,n){const r=t.indices,c=t.attributes,u={};u.indexArray=new Pa;const p=e.json.accessors[r],g=p.count/3;u.indexArray.reserve(g);const y=S4(e,p);for(let A=0;A<g;A++)u.indexArray.emplaceBack(y[3*A],y[3*A+1],y[3*A+2]);u.indexArray._trim(),u.vertexArray=new nc;const x=e.json.accessors[c.POSITION];u.vertexArray.reserve(x.count);const M=S4(e,x);for(let A=0;A<x.count;A++)u.vertexArray.emplaceBack(M[3*A],M[3*A+1],M[3*A+2]);if(u.vertexArray._trim(),u.aabb=new vo(x.min,x.max),u.centroid=function(A,O){const U=[0,0,0],W=A.length;if(W>0){for(let ee=0;ee<W;ee++){const ae=3*A[ee];U[0]+=O[ae],U[1]+=O[ae+1],U[2]+=O[ae+2]}U[0]/=W,U[1]/=W,U[2]/=W}return U}(y,M),void 0!==c.COLOR_0){const A=e.json.accessors[c.COLOR_0],O=C3[A.type],U=S4(e,A);u.colorArray=3===O?new nc:new O2,u.colorArray.resize(A.count),Q0(e,A,u.colorArray,U)}if(void 0!==c.NORMAL){u.normalArray=new nc;const A=e.json.accessors[c.NORMAL];u.normalArray.resize(A.count);const O=S4(e,A);Q0(e,A,u.normalArray,O)}if(void 0!==c.TEXCOORD_0&&n.length>0){u.texcoordArray=new Na;const A=e.json.accessors[c.TEXCOORD_0];u.texcoordArray.resize(A.count);const O=S4(e,A);Q0(e,A,u.texcoordArray,O)}if(void 0!==c._FEATURE_ID_RGBA4444){const A=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=S4(e,A))}void 0!==c._FEATURE_RGBA4444&&(u.featureData=new Uint32Array(S4(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const E=t.material;return u.material=function(A,O){const{emissiveFactor:U=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:ee=.5,normalTexture:ae,occlusionTexture:be,emissiveTexture:Ee,doubleSided:Me}=A,{baseColorFactor:We=[1,1,1,1],metallicFactor:Re=1,roughnessFactor:et=1,baseColorTexture:mt,metallicRoughnessTexture:Dt}=A.pbrMetallicRoughness||{},Wt=be?O[be.index]:void 0;if(be&&be.extensions&&be.extensions.KHR_texture_transform&&Wt){const Vt=be.extensions.KHR_texture_transform;Wt.offsetScale=[Vt.offset[0],Vt.offset[1],Vt.scale[0],Vt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Sr(...We),metallicFactor:Re,roughnessFactor:et,baseColorTexture:mt?O[mt.index]:void 0,metallicRoughnessTexture:Dt?O[Dt.index]:void 0},doubleSided:Me,emissiveFactor:U,alphaMode:W,alphaCutoff:ee,normalTexture:ae?O[ae.index]:void 0,occlusionTexture:Wt,emissionTexture:Ee?O[Ee.index]:void 0,defined:void 0===A.defined}}(void 0!==E?e.json.materials[E]:{defined:!1},n),u}function Q8(t,e,n){const{matrix:r,rotation:c,translation:u,scale:p,mesh:g,extras:y,children:x}=t,M={};if(M.matrix=r||s.a6.fromRotationTranslationScale([],c||[0,0,0,1],u||[0,0,0],p||[1,1,1]),void 0!==g){M.meshes=n[g];const E=M.anchor=[0,0];for(const A of M.meshes){const{min:O,max:U}=A.aabb;E[0]+=O[0]+U[0],E[1]+=O[1]+U[1]}E[0]=Math.floor(E[0]/M.meshes.length/2),E[1]=Math.floor(E[1]/M.meshes.length/2)}if(y&&(y.id&&(M.id=y.id),y.lights&&(M.lights=function(E){if(!E.length)return[];const A=function(ae){const be=atob(ae),Ee=new Uint8Array(be.length);for(let Me=0;Me<be.length;Me++)Ee[Me]=be.codePointAt(Me);return Ee}(E),O=[],U=A.length/24,W=new Uint16Array(A.buffer),ee=new Float32Array(A.buffer);for(let ae=0;ae<U;ae++){const be=W[2*ae*6]/30,Ee=W[2*ae*6+1]/30,Me=W[2*ae*6+10]/100,We=ee[6*ae+1],Re=ee[6*ae+2],et=ee[6*ae+3],mt=ee[6*ae+4],Dt=et-We,Wt=mt-Re,Vt=Math.hypot(Dt,Wt);O.push({pos:[We+.5*Dt,Re+.5*Wt,Ee],normal:[Wt/Vt,-Dt/Vt,0],width:Vt,height:be,depth:Me,points:[We,Re,et,mt]})}return O}(y.lights))),x){const E=[];for(const A of x)E.push(Q8(e.json.nodes[A],e,n));M.children=E}return M}function F5(t){if(0===t.vertices.length||0===t.indices.length)return null;const[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let p=1;p<t.vertices.length;++p){const g=t.vertices[p];e.x=Math.min(e.x,g.x),e.y=Math.min(e.y,g.y),n.x=Math.max(n.x,g.x),n.y=Math.max(n.y,g.y)}const r=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),c=Math.max(8,r),u=new J8(t.vertices,t.indices,c);return{vertices:t.vertices,indices:t.indices,grid:u,min:e,max:n}}function B5(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const n=e[0];if(!n||!Array.isArray(n)||0===n.length)return null;const r=[];for(const p of n){if(!Array.isArray(p)||2!==p.length)continue;const g=p[0],y=p[1];"number"==typeof g&&"number"==typeof y&&r.push(new Te(g,y))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let c=0;for(let p=0;p<r.length;p++){const g=r[p],y=r[(p+1)%r.length],x=r[(p+2)%r.length];c+=(g.x-y.x)*(x.y-y.y)-(x.x-y.x)*(g.y-y.y)}c>0&&r.reverse();const u=_0(r.flatMap(p=>[p.x,p.y]),[]);return 0===u.length?null:{vertices:r,indices:u}}function ep(t){const e=[],n=[];let r=0;for(const c of t){r=e.length;const u=c.vertexArray.float32,p=c.indexArray.uint16;for(let g=0;g<c.vertexArray.length;g++)e.push(new Te(u[3*g+0],u[3*g+1]));for(let g=0;g<3*c.indexArray.length;g++)n.push(p[g]+r)}if(n.length%3!=0)return null;for(let c=0;c<n.length;c+=3){const u=e[n[c+0]],p=e[n[c+1]],g=e[n[c+2]];(u.x-p.x)*(g.y-p.y)-(g.x-p.x)*(u.y-p.y)>0&&([n[c+1],n[c+2]]=[n[c+2],n[c+1]])}return{vertices:e,indices:n}}function Af(t){const n=function(y,x){const M=[];for(const E of y.json.meshes){const A=[];for(const O of E.primitives)A.push(O5(O,y,x));M.push(A)}return M}(t,function(y,x){const M=[],E=WebGL2RenderingContext;if(y.json.textures)for(const A of y.json.textures){const O={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};void 0!==A.sampler&&Object.assign(O,y.json.samplers[A.sampler]),M.push({image:x[A.source],sampler:O,uploaded:!1})}return M}(t,t.images)),{scenes:r,scene:c,nodes:u}=t.json,p=r?r[c||0].nodes:u,g=[];for(const y of p)g.push(Q8(u[y],t,n));return function(y,x,M){const E={},A=new Set;for(let O=0;O<y.length;O++){const U=M[x[O]];if(!U.extras)continue;const W=U.extras["mapbox:footprint:version"],ee=U.extras["mapbox:footprint:id"];(W||ee)&&A.add(O),"1.0.0"===W&&ee&&(E[ee]=O)}for(let O=0;O<y.length;O++){if(A.has(O))continue;const U=y[O],W=M[x[O]];if(!W.extras)continue;let ee=null;U.id in E&&(ee=ep(y[E[U.id]].meshes)),ee||(ee=B5(W)),ee&&(U.footprint=F5(ee))}if(A.size>0){const O=Array.from(A.values()).sort((U,W)=>U-W);for(let U=O.length-1;U>=0;U--)y.splice(O[U],1)}}(g,p,t.json.nodes),g}function Lf(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,r=t.aabb.min[1]-1,c=y3/(t.aabb.max[0]-n+2),u=y3/(t.aabb.max[1]-r+2);for(let p=0;p<e.length;p+=3){const g=e[p+2],y=(e[p+0]-n)*c|0,x=(e[p+1]-r)*u|0;g>t.heightmap[x*y3+y]&&(t.heightmap[x*y3+y]=g)}}function tp(t,e){const n={};n.indexArray=new Pa,n.indexArray.reserve(4*t.length),n.vertexArray=new nc,n.vertexArray.reserve(10*t.length),n.colorArray=new O2,n.vertexArray.reserve(10*t.length);let r=0;for(const p of t){const g=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],x=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(x+.01),E=s.N.scaleAndAdd([],p.pos,y,M/2),A=s.N.scaleAndAdd([],p.pos,y,-M/2),O=[E[0],E[1],E[2]+p.height],U=[A[0],A[1],A[2]+p.height],W=s.N.scaleAndAdd([],p.normal,y,x);s.N.scale(W,W,g);const ee=s.N.scaleAndAdd([],p.normal,y,-x);s.N.scale(ee,ee,g),s.N.add(W,E,W),s.N.add(ee,A,ee),E[2]+=.1,A[2]+=.1,n.vertexArray.emplaceBack(W[0],W[1],W[2]),n.vertexArray.emplaceBack(ee[0],ee[1],ee[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]),n.vertexArray.emplaceBack(U[0],U[1],U[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(W[0],W[1],W[2]),n.vertexArray.emplaceBack(ee[0],ee[1],ee[2]);const ae=M/g/2;n.colorArray.emplaceBack(-ae-x,-1,ae,.8),n.colorArray.emplaceBack(ae+x,-1,ae,.8),n.colorArray.emplaceBack(-ae,0,ae,1.3),n.colorArray.emplaceBack(ae,0,ae,1.3),n.colorArray.emplaceBack(ae+x,-.8,ae,.7),n.colorArray.emplaceBack(ae+x,-.8,ae,.7),n.colorArray.emplaceBack(0,0,ae,1.3),n.colorArray.emplaceBack(0,0,ae,1.3),n.colorArray.emplaceBack(ae+x,-1.2,ae,.8),n.colorArray.emplaceBack(ae+x,-1.2,ae,.8),n.indexArray.emplaceBack(6+r,4+r,8+r),n.indexArray.emplaceBack(7+r,9+r,5+r),n.indexArray.emplaceBack(0+r,1+r,2+r),n.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const c={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Sr.white,c.pbrMetallicRoughness=u,n.material=c,n.aabb=new vo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Xn(J8,"TriangleGridIndex");class V6{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const r=e[n];this._stringToNumber[r]=n,this._numberToString[n]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const U5=["tile","layer","source","sourceLayer","state"];class np{constructor(e,n,r,c,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=r,this._y=c,this.properties=e.properties,this.id=u}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of U5)void 0!==this[n]&&(e[n]=this[n]);return e}}class Df{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new jo(Rn,16,0),this.featureIndexArray=new Fl,this.promoteId=n,this.is3DTile=!1}insert(e,n,r,c,u,p=0,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,c,u,p);const x=this.grid;for(let M=0;M<n.length;M++){const E=n[M],A=[1/0,1/0,-1/0,-1/0];for(let O=0;O<E.length;O++){const U=E[O];A[0]=Math.min(A[0],U.x),A[1]=Math.min(A[1],U.y),A[2]=Math.max(A[2],U.x),A[3]=Math.max(A[3],U.y)}0!==g&&(A[0]-=g,A[1]-=g,A[2]+=g,A[3]+=g),A[0]<Rn&&A[1]<Rn&&A[2]>=0&&A[3]>=0&&x.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new v0(new p3(this.rawTileData)).layers,this.sourceLayerCoder=new V6(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,r,c){this.loadVTLayers();const u=e.params||{},p=u2(u.filter),g=e.tileResult,y=e.transform,x=g.bufferedTilespaceBounds,M=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(U,W,ee,ae)=>td(g.bufferedTilespaceGeometry,U,W,ee,ae));M.sort(j5);let E=null;y.elevation&&M.length>0&&(E=cc.create(y.elevation,this.tileID));const A={};let O;for(let U=0;U<M.length;U++){const W=M[U];if(W===O)continue;O=W;const ee=this.featureIndexArray.get(W);let ae=null;if(this.is3DTile){const be=this.bucketLayerIDs[0][0],Ee=n[be];if("model"!==Ee.type)continue;const{queryFeature:Me,intersectionZ:We}=Ee.queryIntersectsMatchingFeature(g,ee.featureIndex,p,y);Me&&this.appendToResult(A,be,ee.featureIndex,Me,We)}else this.loadMatchingFeature(A,ee,p,u.layers,u.availableImages,n,r,c,(be,Ee,Me,We=0)=>(ae||(ae=ra(be,this.tileID.canonical,e.tileTransform)),Ee.queryIntersectsFeature(g,be,Me,ae,this.z,e.transform,e.pixelPosMatrix,E,We)))}return A}loadMatchingFeature(e,n,r,c,u,p,g,y,x){const{featureIndex:M,bucketIndex:E,sourceLayerIndex:A,layoutVertexArrayOffset:O}=n,U=this.bucketLayerIDs[E];if(c&&!function(be,Ee){for(let Me=0;Me<be.length;Me++)if(Ee.indexOf(be[Me])>=0)return!0;return!1}(c,U))return;const W=this.sourceLayerCoder.decode(A),ee=this.vtLayers[W].feature(M);if(r.needGeometry){const be=no(ee,!0);if(!r.filter(new or(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!r.filter(new or(this.tileID.overscaledZ),ee))return;const ae=this.getId(ee,W);for(let be=0;be<U.length;be++){const Ee=U[be];if(c&&c.indexOf(Ee)<0)continue;const Me=p[Ee];if(!Me)continue;let We={};void 0!==ae&&y&&(We=y.getState(Me.sourceLayer||"_geojsonTileLayer",ae));const Re=!x||x(ee,Me,We,O);if(!Re)continue;const et=new np(ee,this.z,this.x,this.y,ae),mt=ti({},g[Ee]);mt.paint=ip(mt.paint,Me.paint,ee,We,u),mt.layout=ip(mt.layout,Me.layout,ee,We,u),et.layer=mt,this.appendToResult(e,Ee,M,et,Re)}}appendToResult(e,n,r,c,u){let p=e[n];void 0===p&&(p=e[n]=[]),p.push({featureIndex:r,feature:c,intersectionZ:u})}lookupSymbolFeatures(e,n,r,c,u,p,g,y){const x={};this.loadVTLayers();const M=u2(u);for(const E of e)this.loadMatchingFeature(x,{bucketIndex:r,sourceLayerIndex:c,featureIndex:E,layoutVertexArrayOffset:0},M,p,g,y,n);return x}loadFeature(e){const{featureIndex:n,sourceLayerIndex:r}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(r),u=this.vtFeatures[c];if(u[n])return u[n];const p=this.vtLayers[c].feature(n);return u[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const r of n)if(e===r)return!0;return!1}getId(e,n){let r=e.id;if(this.promoteId){const c="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=c&&(r=e.properties[c]),"boolean"==typeof r&&(r=Number(r))}return r}}function ip(t,e,n,r,c){return Ke(t,(u,p)=>{const g=e instanceof ec?e.get(p):null;return g&&g.evaluate?g.evaluate(n,r,c):g})}function j5(t,e){return e-t}Xn(Df,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const If=new Float32Array(262144),pc=new Uint8Array(262144);function Vf(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,Vf(n));return e}function Hf(t,e,n){if(t.meshes)for(const r of t.meshes)r.aabb.min[0]!==1/0&&n.insert(e,r.aabb.min[0],r.aabb.min[1],r.aabb.max[0],r.aabb.max[1]);if(t.children)for(const r of t.children)Hf(r,e,n)}const eu=["","wall","door","roof","window","lamp","logo"];class Pf{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Vf(e)}}}getLocalBounds(){if(!this.node.meshes)return new vo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new vo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==e&&n.encapsulate(r.aabb),e++;this.aabb=n}return this.aabb}}class tu{constructor(e,n,r,c,u,p){this.id=n,this.modelTraits|=b4.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=b4.HasMapboxMeshFeatures),c&&(this.modelTraits|=b4.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const g of e)this.nodesInfo.push(new Pf(g)),Hf(g,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const r of n){const c=r.node;this.uploaded?this.updatePbrBuffer(c):Y0(c,e,!0)}for(const r of n)K0(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),n=!0);return n}needsReEvaluation(e,n,r){const c=e.transform.projectionOptions,u=e.style.getBrightness(),p=this.brightness!==u;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||T4(r.paint.get("model-color").value,p)||T4(r.paint.get("model-color-mix-intensity").value,p)||T4(r.paint.get("model-roughness").value,p)||T4(r.paint.get("model-emissive-strength").value,p)||T4(r.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=c,this.brightness=u,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),c=this.id.canonical;for(const u of r){const p=u.feature;u.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e){const n=this.getNodesInfo();for(const r of n){if(!r.node.meshes)continue;const c=r.feature,u=r.node.meshes&&r.node.meshes[0].featureData,p=r.evaluatedColor[2],g=r.evaluatedRMEA[2],y=this.id.canonical;if(r.hasTranslucentParts=!1,u){for(let x=0;x<eu.length;x++){const M=eu[x];M.length&&(c.properties.part=M);const E=e.paint.get("model-color").evaluate(c,{},y),A=e.paint.get("model-color-mix-intensity").evaluate(c,{},y);r.evaluatedColor[x]=[E.r,E.g,E.b,A],r.evaluatedRMEA[x][0]=e.paint.get("model-roughness").evaluate(c,{},y),r.evaluatedRMEA[x][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y),r.evaluatedRMEA[x][3]=E.a,r.emissionHeightBasedParams[x]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},y),!r.hasTranslucentParts&&E.a<1&&(r.hasTranslucentParts=!0)}delete c.properties.part,xm(r,p!==r.evaluatedColor[2]||g!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y);r.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},y),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,r,c){const u=e.findDEMTileFor(r);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const p=cc.create(e,r,u);if(!p)return;this.modelTraits&b4.HasMapboxMeshFeatures&&this.updateDEM(e,p,r,c);for(const g of this.getNodesInfo()){const y=g.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const x=y.footprint.vertices;let M=p.getElevationAt(x[0].x,x[0].y,!0,!0);for(let E=1;E<x.length;E++)M=Math.min(M,p.getElevationAt(x[E].x,x[E].y,!0,!0));y.elevation=M}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,r,c){let u=n._dem._modifiedForSources[c];if(void 0===u&&(n._dem._modifiedForSources[c]=[],u=n._dem._modifiedForSources[c]),u.includes(r.canonical))return;const p=n._dem.dim;u.push(r.canonical);let g=!1;for(const y of this.getNodesInfo()){const x=y.node;if(!x.footprint||!x.footprint.grid)continue;const M=x.footprint.grid,E=n.tileCoordToPixel(M.min.x,M.min.y),A=n.tileCoordToPixel(M.max.x,M.max.y),O=Math.min(Math.min(p-A.y,E.x),Math.min(E.y,p-A.x));if(O<0)continue;const U=Ot(O,2,5);let W=Math.max(0,E.x-U),ee=Math.max(0,E.y-U),ae=Math.min(A.x+U,p-1),be=Math.min(A.y+U,p-1);for(let Re=ee;Re<=be;++Re)for(let et=W;et<=ae;++et)pc[Re*p+et]=255;let Ee=0,Me=0;for(let Re=0;Re<M.cellsY;++Re)for(let et=0;et<M.cellsX;++et){if(!M.cells[Re*M.cellsX+et])continue;const mt=n.tileCoordToPixel(M.min.x+et/M.xScale,M.min.y+Re/M.yScale),Dt=n.tileCoordToPixel(M.min.x+(et+1)/M.xScale,M.min.y+(Re+1)/M.yScale);for(let Wt=mt.y;Wt<=Math.min(Dt.y+1,p-1);++Wt)for(let Vt=mt.x;Vt<=Math.min(Dt.x+1,p-1);++Vt)255===pc[Wt*p+Vt]&&(pc[Wt*p+Vt]=0,Ee+=n.getElevationAtPixel(Vt,Wt),Me++)}const We=Ee/Me;W=Math.max(1,E.x-U),ee=Math.max(1,E.y-U),ae=Math.min(A.x+U,p-2),be=Math.min(A.y+U,p-2),g=!0;for(let Re=ee;Re<=be;++Re)for(let et=W;et<=ae;++et)0===pc[Re*p+et]&&(If[Re*p+et]=n._dem.set(et,Re,We));for(let Re=1;Re<U;++Re){W=Math.max(1,E.x-Re),ee=Math.max(1,E.y-Re),ae=Math.min(A.x+Re,p-2),be=Math.min(A.y+Re,p-2);for(let et=ee;et<=be;++et)for(let mt=W;mt<=ae;++mt){const Dt=et*p+mt;if(255===pc[Dt]){let Wt=0,Vt=0,un=-1,yn=-1;for(let tn=-1;tn<=1;++tn)for(let gn=-1;gn<=1;++gn){const Kt=(et+tn)*p+mt+gn;if(pc[Kt]>=Re)continue;const pn=If[Kt],Gn=Math.abs(pn);Gn>Vt&&(Wt=pn,Vt=Gn,un=gn,yn=tn)}if(Vt>.1){const tn=1-(Re+.5*Math.abs(un*yn))/U;let gn=n._dem.get(mt,et)+Wt*tn;const Kt=n._dem.get(mt+un,et+yn),pn=n._dem.get(mt-un,et-yn,!0);(gn-Kt)*(gn-pn)>0&&(gn=(Kt+pn)/2),If[Dt]=n._dem.set(mt,et,gn),pc[Dt]=Re}}}}}g&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=It.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)K0(n.node),z6(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const r=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const p=c[u].node;c[u].hiddenByReplacement=!!p.footprint&&!r.find(g=>g.footprint===p.footprint)}}getHeightAtTileCoord(e,n){const r=this.getNodesInfo(),c=[];for(let u=0;u<this.nodesInfo.length;u++){const p=r[u],g=p.node.meshes[0];if(e<g.aabb.min[0]||n<g.aabb.min[1]||e>g.aabb.max[0]||n>g.aabb.max[1])continue;const y=(e-g.aabb.min[0])/(g.aabb.max[0]-g.aabb.min[0])*y3|0,x=Math.min(63,(n-g.aabb.min[1])/(g.aabb.max[1]-g.aabb.min[1])*y3|0)*y3+Math.min(63,y);if(!(g.heightmap[x]<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:g.heightmap[x],maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new Te(e,n),new Te(e,n),c),c.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function T4(t,e){return!t.isLightConstant&&e}function rp(t,e,n,r,c,u,p,g){let y=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;n[3]>0&&(y=Pi(y,255*n[0],n[3]),x=Pi(x,255*n[1],n[3]),M=Pi(M,255*n[2],n[3]));const E=y<<8|x,A=M<<8|Math.floor(255*r[3]),O=function(Re){const et=Ot(Re,0,2);return Math.min(Math.round(.5*et*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],U=Ot(c[0],0,1),W=Ot(c[1],0,1),ee=Ot(c[2],0,1),ae=Ot(c[3],0,1);let be,Ee,Me,We;if(U!==W&&p!==u&&W!==U){const Re=p-u;Ee=1/(Re*(W-U)),Me=-(u+Re*U)/(Re*(W-U));const et=Ot(c[4],-1,1);We=Math.pow(10,et),be=255*ee<<8|255*ae}else be=65535,Ee=0,Me=1,We=1;if(t.emplaceBack(E,A,O,be,Ee,Me,We),g){const Re=g.length;g.clear();for(let et=0;et<Re;et++)g.emplaceBack(E,A,O,be,Ee,Me,We)}}function xm(t,e,n){const r=t.node;let c=0;const u=n&b4.HasMeshoptCompression;for(const p of r.meshes){if(r.lights&&r.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new cl,p.featureArray.reserve(p.featureData.length);let g=e;for(const y of p.featureData){const x=u?65535&y:y>>16&65535,M=u?y>>16&65535:65535&y,E=(15&M)<8?15&M:0,A=t.evaluatedRMEA[E],O=t.evaluatedColor[E],U=t.emissionHeightBasedParams[E];let W;if(g&&2===E&&r.lights&&(W=new cl,W.resize(10*r.lights.length)),rp(p.featureArray,x,O,A,U,p.aabb.min[2],p.aabb.max[2],W),W&&g){g=!1;const ee=r.meshes[r.lightMeshIndex];ee.featureArray=W,ee.featureArray._trim()}}p.featureArray._trim(),c++}}function Nf(t,e,n,r){const c=1<<t.z;e.lat=Yr((r/Rn+t.y)/c),e.lng=mr((n/Rn+t.x)/c)}Xn(tu,"Tiled3dModelBucket",{omit:["layers"]}),Xn(Pf,"Tiled3dModelFeature");const sp={circle:class extends q1{constructor(t,e,n){super(t,id,e,n)}createBucket(t){return new R1(t)}queryRadius(t){const e=t;return Oc("circle-radius",this,e)+Oc("circle-stroke-width",this,e)+j3(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,r,c,u,p,g){const y=nd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return f2(t,r,u,p,g,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),y,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const n=ah(this);return{config:new Q(this,e),defines:n,overrideFog:!1}}},heatmap:class extends q1{createBucket(t){return new lh(t)}constructor(t,e,n){super(t,$p,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=X3({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Oc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,r,c,u,p,g){const y=this.paint.get("heatmap-radius").evaluate(e,n);return f2(t,r,u,p,g,!0,!0,new Te(0,0),y)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return"heatmap"===t?{config:new Q(this,e),overrideFog:!1}:{}}},hillshade:class extends q1{constructor(t,e,n){super(t,Rd,e,n)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends q1{constructor(t,e,n){super(t,Bd,e,n)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new Q(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Fd(t)}queryRadius(){return j3(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,r,c,u){return!t.queryGeometry.isAboveHorizon&&fl(wu(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends q1{constructor(t,e,n){super(t,i8,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new a4(t)}queryRadius(){return j3(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,r,c,u,p,g,y){const x=nd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,n),E=this.paint.get("fill-extrusion-base").evaluate(e,n),A=[0,0],O=g&&u.elevation,U=u.elevation?u.elevation.exaggeration():1,W=t.tile.getBucket(this);if(O&&W instanceof a4){const Me=W.centroidVertexArray,We=y+1;We<Me.length&&(A[0]=Me.geta_centroid_pos0(We),A[1]=Me.geta_centroid_pos1(We))}if(0===A[0]&&1===A[1])return!1;"globe"===u.projection.name&&(r=s6([r],[new Te(0,0),new Te(Rn,Rn)],t.tileID.canonical).map(Me=>Me.polygon).flat());const ee=O?g:null,[ae,be]=(We=r,Re=E,et=M,mt=x,Dt=p,Wt=ee,Vt=A,un=U,yn=u.center.lat,"globe"===(Me=u).projection.name?function(gn,Kt,pn,Gn,wn,pi,ni,Ln,$i,wi,li){const Mn=[],ki=[],Dr=gn.projection.upVectorScale(li,gn.center.lat,gn.worldSize).metersToTile,Ki=[0,0,0,1],Tr=[0,0,0,1],fr=(Mr,ks,is,os)=>{Mr[0]=ks,Mr[1]=is,Mr[2]=os,Mr[3]=1},qr=r6();pn>0&&(pn+=qr),Gn+=qr;for(const Mr of Kt){const ks=[],is=[];for(const os of Mr){const hs=os.x+wn.x,Qr=os.y+wn.y,Ks=gn.projection.projectTilePoint(hs,Qr,li),bs=gn.projection.upVector(li,os.x,os.y);let Lo=pn,Ko=Gn;if(ni){const Xa=Ah(hs,Qr,pn,Gn,ni,Ln,$i,wi);Lo+=Xa.base,Ko+=Xa.top}0!==pn?fr(Ki,Ks.x+bs[0]*Dr*Lo,Ks.y+bs[1]*Dr*Lo,Ks.z+bs[2]*Dr*Lo):fr(Ki,Ks.x,Ks.y,Ks.z),fr(Tr,Ks.x+bs[0]*Dr*Ko,Ks.y+bs[1]*Dr*Ko,Ks.z+bs[2]*Dr*Ko),s.N.transformMat4(Ki,Ki,pi),s.N.transformMat4(Tr,Tr,pi),ks.push(new Zc(Ki[0],Ki[1],Ki[2])),is.push(new Zc(Tr[0],Tr[1],Tr[2]))}Mn.push(ks),ki.push(is)}return[Mn,ki]}(Me,We,Re,et,mt,Dt,Wt,Vt,un,yn,t.tileID.canonical):Wt?function(gn,Kt,pn,Gn,wn,pi,ni,Ln,$i){const wi=[],li=[],Mn=[0,0,0,1];for(const ki of gn){const Dr=[],Ki=[];for(const Tr of ki){const fr=Tr.x+Gn.x,qr=Tr.y+Gn.y,Mr=Ah(fr,qr,Kt,pn,pi,ni,Ln,$i);Mn[0]=fr,Mn[1]=qr,Mn[2]=Mr.base,Mn[3]=1,s.a7.transformMat4(Mn,Mn,wn),Mn[3]=Math.max(Mn[3],1e-5);const ks=new Zc(Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]);Mn[0]=fr,Mn[1]=qr,Mn[2]=Mr.top,Mn[3]=1,s.a7.transformMat4(Mn,Mn,wn),Mn[3]=Math.max(Mn[3],1e-5);const is=new Zc(Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]);Dr.push(ks),Ki.push(is)}wi.push(Dr),li.push(Ki)}return[wi,li]}(We,Re,et,mt,Dt,Wt,Vt,un,yn):function(gn,Kt,pn,Gn,wn){const pi=[],ni=[],Ln=wn[8]*Kt,$i=wn[9]*Kt,wi=wn[10]*Kt,li=wn[11]*Kt,Mn=wn[8]*pn,ki=wn[9]*pn,Dr=wn[10]*pn,Ki=wn[11]*pn;for(const Tr of gn){const fr=[],qr=[];for(const Mr of Tr){const ks=Mr.x+Gn.x,is=Mr.y+Gn.y,os=wn[0]*ks+wn[4]*is+wn[12],hs=wn[1]*ks+wn[5]*is+wn[13],Qr=wn[2]*ks+wn[6]*is+wn[14],Ks=wn[3]*ks+wn[7]*is+wn[15],bs=os+Ln,Lo=hs+$i,Ko=Qr+wi,Xa=Math.max(Ks+li,1e-5),Xs=os+Mn,Do=hs+ki,Sa=Qr+Dr,Ta=Math.max(Ks+Ki,1e-5);fr.push(new Zc(bs/Xa,Lo/Xa,Ko/Xa)),qr.push(new Zc(Xs/Ta,Do/Ta,Sa/Ta))}pi.push(fr),ni.push(qr)}return[pi,ni]}(We,Re,et,mt,Dt)),Ee=t.queryGeometry;var Me,We,Re,et,mt,Dt,Wt,Vt,un,yn;return function(Me,We,Re){let et=1/0;fl(Re,We)&&(et=r8(Re,We[0]));for(let mt=0;mt<We.length;mt++){const Dt=We[mt],Wt=Me[mt];for(let Vt=0;Vt<Dt.length-1;Vt++){const un=Dt[Vt],yn=[un,Dt[Vt+1],Wt[Vt+1],Wt[Vt],un];C2(Re,yn)&&(et=Math.min(et,r8(Re,yn)))}}return et!==1/0&&et}(ae,be,Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry)}},line:class extends q1{constructor(t,e,n){super(t,Dh,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Da,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Ph.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new u3(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const n=Hh(this);return{config:new Q(this,e),defines:n,overrideFog:!1}}queryRadius(t){const e=t,n=T0(Oc("line-width",this,e),Oc("line-gap-width",this,e)),r=Oc("line-offset",this,e);return n/2+Math.abs(r)+j3(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,r,c,u){if(t.queryGeometry.isAboveHorizon)return!1;const p=wu(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*T0(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(r=function(x,M){const E=[],A=new Te(0,0);for(let O=0;O<x.length;O++){const U=x[O],W=[];for(let ee=0;ee<U.length;ee++){const ae=U[ee],be=U[ee+1],Ee=0===ee?A:ae.sub(U[ee-1])._unit()._perp(),Me=ee===U.length-1?A:be.sub(ae)._unit()._perp(),We=Ee._add(Me)._unit();We._mult(1/(We.x*Me.x+We.y*Me.y)),W.push(We._mult(M)._add(ae))}E.push(W)}return E}(r,y*t.pixelToTileUnitsFactor)),function(x,M,E){for(let A=0;A<M.length;A++){const O=M[A];if(x.length>=3)for(let U=0;U<O.length;U++)if(ic(x,O[U]))return!0;if(F3(x,O,E))return!0}return!1}(p,r,g)}isTileClipped(){return!0}},symbol:$0,background:class extends q1{constructor(t,e,n){super(t,P8,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:b6,"raster-particle":R8,sky:class extends q1{constructor(t,e,n){super(t,ym,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=X3({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),c=!r,u=t.style.light,p=u.properties.get("position");return c&&"viewport"===u.properties.get("anchor")&&Ii("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?C6(p.azimuthal,90-p.polar,e):C6(r[0],90-r[1],e)}const n=this.paint.get("sky-gradient-center");return C6(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends q1{constructor(t,e,n){super(t,O8,e)}},model:class extends q1{constructor(t,e,n){super(t,V5,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new E6(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof tu?Rn-1:0}queryIntersectsFeature(t,e,n,r,c,u){if(!this.modelManager)return!1;const p=this.modelManager,g=t.tile.getBucket(this);if(!(g&&g instanceof E6))return!1;const y=g;for(const x in y.instancesPerModel){const M=y.instancesPerModel[x];if(M.idToFeaturesIndex.hasOwnProperty(e.id)){const E=M.features[M.idToFeaturesIndex[e.id]],A=p.getModel(x,this.scope);if(!A)return!1;let O=s.a6.create();const U=new Lt(0,0),W=y.canonical;let ee=Number.MAX_VALUE;for(let ae=0;ae<E.instancedDataCount;++ae){const be=16*(E.instancedDataOffset+ae),Ee=M.instancedDataArray.float32,Me=[Ee[be+4],Ee[be+5],Ee[be+6]];Nf(W,U,Ee[be],0|Ee[be+1]),yf(O,A,u,U,E.rotation,E.scale,Me,!1,!1,!1),"globe"===u.projection.name&&(O=S6(O,u));const We=s.a6.multiply([],u.projMatrix,O),Re=t.queryGeometry,et=j8(Re.isPointQuery()?Re.screenBounds:Re.screenGeometry,u,We,A.aabb);null!=et&&(ee=Math.min(et,ee))}return ee!==Number.MAX_VALUE&&ee}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof _s}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,r){const c=t.tile,u=c.getBucket(this);let p=null,g=Number.MAX_VALUE;if(!(u&&u instanceof tu))return{queryFeature:p,intersectionZ:g};const y=u.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new or(c.tileID.overscaledZ),y.feature,c.tileID.canonical))return{queryFeature:p,intersectionZ:g};const x=y.node,M=r.calculatePosMatrix(c.tileID.toUnwrapped(),r.worldSize),E=y.evaluatedScale;let A=0;r.elevation&&x.elevation&&(A=x.elevation*r.elevation.exaggeration()),s.a6.translate(M,M,[(x.anchor?x.anchor[0]:0)*(E[0]-1),(x.anchor?x.anchor[1]:0)*(E[1]-1),A]),s.a6.scale(M,M,E),s.a6.multiply(M,M,x.matrix);const O=t.queryGeometry,U=O.isPointQuery()?O.screenBounds:O.screenGeometry,W=function(ae){const be=s.a6.multiply([],M,ae.matrix),Ee=s.a6.multiply(be,r.expandedFarZProjMatrix,be);for(let Me=0;Me<ae.meshes.length;++Me){const We=ae.meshes[Me];if(Me===ae.lightMeshIndex)continue;const Re=j8(U,r,Ee,We.aabb);null!=Re&&(g=Math.min(Re,g))}if(ae.children)for(const Me of ae.children)W(Me)};if(W(x),g===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:g};const ee=new Lt(0,0);return Nf(c.tileID.canonical,ee,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[ee.lng,ee.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:g}}}},Cr={read:function(t,e){return t.readFields(Cr._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){1===t?e.header_length=n.readFixed32():2===t?e.x=n.readVarint():3===t?e.y=n.readVarint():4===t?e.z=n.readVarint():5===t&&e.layers.push(Cr.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Cr.Filter.read=function(t,e){return t.readFields(Cr.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Cr.Filter._readField=function(t,e,n){1===t?(e.delta_filter=Cr.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):2===t?(e.zigzag_filter=Cr.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):3===t?(e.bitshuffle_filter=Cr.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):4===t&&(e.byteshuffle_filter=Cr.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},Cr.Filter.Delta={},Cr.Filter.Delta.read=function(t,e){return t.readFields(Cr.Filter.Delta._readField,{block_size:0},e)},Cr.Filter.Delta._readField=function(t,e,n){1===t&&(e.block_size=n.readVarint())},Cr.Filter.Zigzag={},Cr.Filter.Zigzag.read=function(t,e){return t.readFields(Cr.Filter.Zigzag._readField,{},e)},Cr.Filter.Zigzag._readField=function(t,e,n){},Cr.Filter.BitShuffle={},Cr.Filter.BitShuffle.read=function(t,e){return t.readFields(Cr.Filter.BitShuffle._readField,{},e)},Cr.Filter.BitShuffle._readField=function(t,e,n){},Cr.Filter.ByteShuffle={},Cr.Filter.ByteShuffle.read=function(t,e){return t.readFields(Cr.Filter.ByteShuffle._readField,{},e)},Cr.Filter.ByteShuffle._readField=function(t,e,n){},Cr.Codec={},Cr.Codec.read=function(t,e){return t.readFields(Cr.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Cr.Codec._readField=function(t,e,n){1===t?(e.gzip_data=Cr.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):2===t?(e.jpeg_image=Cr.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):3===t?(e.webp_image=Cr.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):4===t&&(e.png_image=Cr.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},Cr.Codec.GzipData={},Cr.Codec.GzipData.read=function(t,e){return t.readFields(Cr.Codec.GzipData._readField,{},e)},Cr.Codec.GzipData._readField=function(t,e,n){},Cr.Codec.JpegImage={},Cr.Codec.JpegImage.read=function(t,e){return t.readFields(Cr.Codec.JpegImage._readField,{},e)},Cr.Codec.JpegImage._readField=function(t,e,n){},Cr.Codec.WebpImage={},Cr.Codec.WebpImage.read=function(t,e){return t.readFields(Cr.Codec.WebpImage._readField,{},e)},Cr.Codec.WebpImage._readField=function(t,e,n){},Cr.Codec.PngImage={},Cr.Codec.PngImage.read=function(t,e){return t.readFields(Cr.Codec.PngImage._readField,{},e)},Cr.Codec.PngImage._readField=function(t,e,n){},Cr.DataIndexEntry={},Cr.DataIndexEntry.read=function(t,e){return t.readFields(Cr.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Cr.DataIndexEntry._readField=function(t,e,n){1===t?e.first_byte=n.readFixed64():2===t?e.last_byte=n.readFixed64():3===t?e.filters.push(Cr.Filter.read(n,n.readVarint()+n.pos)):4===t?e.codec=Cr.Codec.read(n,n.readVarint()+n.pos):5===t?e.offset=n.readFloat():6===t?e.scale=n.readFloat():7===t&&e.bands.push(n.readString())},Cr.Layer={},Cr.Layer.read=function(t,e){return t.readFields(Cr.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Cr.Layer._readField=function(t,e,n){1===t?e.version=n.readVarint():2===t?e.name=n.readString():3===t?e.units=n.readString():4===t?e.tilesize=n.readVarint():5===t?e.buffer=n.readVarint():6===t?e.pixel_format=n.readVarint():7===t&&e.data_index.push(Cr.DataIndexEntry.read(n,n.readVarint()+n.pos))};const mc={read:function(t,e){return t.readFields(mc._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){2===t?(e.uint32_values=mc.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):3===t&&(e.fixed32_values=mc.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};mc.Uint32Values.read=function(t,e){return t.readFields(mc.Uint32Values._readField,{values:[]},e)},mc.Uint32Values._readField=function(t,e,n){1===t&&(e.readValuesInto=function(r){if(2!==r.type)throw new Error(`Unsupported pbf type "${r.type}"`);const c=2===(p=r).type?p.readVarint()+p.pos:p.pos+1,u=r.pos;var p;return r.pos=c,function(p){r.pos=u;let g=0;for(;r.pos<c;){const y=r.readVarint();p[g++]=y}return p}}(n))},mc.Fixed32Values={},mc.Fixed32Values.read=function(t,e){return t.readFields(mc.Fixed32Values._readField,{values:[]},e)},mc.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class op{constructor(e=0,n=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=r,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const n=this.items[e];delete this.items[e],this.size--,null!==n.prev&&(n.prev.next=n.next),null!==n.next&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){const n=this.first;delete this.items[n.key],0==--this.size?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){const r=this.items[e];this.ttl>0&&r.expiry<=Date.now()?this.delete(e):(n=r.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){const e=[];let n=this.first;for(;null!==n;)e.push(n.key),n=n.next;return e}set(e,n,r=!1,c=this.resetTtl){let u;if(r||this.has(e)){if(u=this.items[e],u.value=n,!1===r&&c&&(u.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==u){const p=this.last,g=u.next,y=u.prev;this.first===u&&(this.first=u.next),u.next=null,u.prev=this.last,p.next=u,null!==y&&(y.next=g),null!==g&&(g.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),u=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},1==++this.size?this.first=u:this.last.next=u;return this.last=u,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function nu(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let r=2;r>=1;r--){const c=1===r?1:0,u=2===r?1:0;for(let p=0;p<e[0];p++){const g=e[1]*p;for(let y=c;y<e[1];y++){const x=e[2]*(y+g);for(let M=u;M<e[2];M++){const E=e[3]*(M+x);for(let A=0;A<e[3];A++){const O=E+A;t[O]+=t[O-n]}}}}n*=e[r]}return t}function G5(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function kf(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){const r=t[n],c=t[n+1];t[n]=(240&r)>>4|(61440&r)>>8|(240&c)<<4|61440&c,t[n+1]=15&r|(3840&r)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){const r=t[n],c=t[n+1],u=t[n+2],p=t[n+3];t[n+0]=(192&r)>>6|(192&c)>>4|(192&u)>>2|192&p,t[n+1]=(48&r)>>4|(48&c)>>2|48&u|(48&p)<<2,t[n+2]=(12&r)>>2|12&c|(12&u)<<2|(12&p)<<4,t[n+3]=3&r|(3&c)<<2|(3&u)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class F1 extends Error{constructor(e){super(e),this.name="MRTError"}}var A2=Uint8Array,Jc=Uint16Array,iu=Int32Array,Rf=new A2([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ap=new A2([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$5=new A2([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E4=function(t,e){for(var n=new Jc(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var c=new iu(n[30]);for(r=1;r<30;++r)for(var u=n[r];u<n[r+1];++u)c[u]=u-n[r]<<5|r;return{b:n,r:c}},ru=E4(Rf,2),Of=ru.b,W5=ru.r;Of[28]=258,W5[258]=28;for(var cp=E4(ap,0).b,su=new Jc(32768),Wo=0;Wo<32768;++Wo){var M3=(43690&Wo)>>1|(21845&Wo)<<1;su[Wo]=((65280&(M3=(61680&(M3=(52428&M3)>>2|(13107&M3)<<2))>>4|(3855&M3)<<4))>>8|(255&M3)<<8)>>1}var S3=function(t,e,n){for(var r=t.length,c=0,u=new Jc(e);c<r;++c)t[c]&&++u[t[c]-1];var p,g=new Jc(e);for(c=1;c<e;++c)g[c]=g[c-1]+u[c-1]<<1;if(n){p=new Jc(1<<e);var y=15-e;for(c=0;c<r;++c)if(t[c])for(var x=c<<4|t[c],M=e-t[c],E=g[t[c]-1]++<<M,A=E|(1<<M)-1;E<=A;++E)p[su[E]>>y]=x}else for(p=new Jc(r),c=0;c<r;++c)t[c]&&(p[c]=su[g[t[c]-1]++]>>15-t[c]);return p},T3=new A2(288);for(Wo=0;Wo<144;++Wo)T3[Wo]=8;for(Wo=144;Wo<256;++Wo)T3[Wo]=9;for(Wo=256;Wo<280;++Wo)T3[Wo]=7;for(Wo=280;Wo<288;++Wo)T3[Wo]=8;var Ff=new A2(32);for(Wo=0;Wo<32;++Wo)Ff[Wo]=5;var ou=S3(T3,9,1),Bf=S3(Ff,5,1),Uf=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Y2=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},jf=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},q5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],K2=function(t,e,n){var r=new Error(e||q5[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,K2),!n)throw r;return r},Gf=new A2(0),$f=typeof TextDecoder<"u"&&new TextDecoder;try{$f.decode(Gf,{stream:!0})}catch{}const lp={gzip_data:"gzip"},up={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},hp={uint32:1,uint16:2,uint8:4},Z5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class Wf{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const n=new Uint8Array(e),r=new DataView(e);if(13!==n[0])throw new F1("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),r=this.getHeaderLength(e);if(n.length<r)throw new F1(`Expected header with length >= ${r} but got buffer of length ${n.length}`);const c=new p3(n.subarray(0,r)),u=Cr.read(c);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new F1(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new fp(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],r=this.getLayer(e.layerName);for(let c=0;c<r.dataIndex.length;c++){const u=r.dataIndex[c],p=u.first_byte-e.firstByte,g=u.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||r._blocksInProgress.has(c))continue;const y={layerName:r.name,firstByte:p,lastByte:g,pixelFormat:r.pixelFormat,blockIndex:c,blockShape:[u.bands.length].concat(r.bandShape),buffer:r.buffer,codec:u.codec.codec,filters:u.filters.map(x=>x.filter)};r._blocksInProgress.add(c),n.push(y)}return new dp(n,()=>{n.forEach(c=>r._blocksInProgress.delete(c.blockIndex))},(c,u)=>{if(n.forEach(p=>r._blocksInProgress.delete(p.blockIndex)),c)throw c;u.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class fp{constructor({version:e,name:n,units:r,tilesize:c,pixel_format:u,buffer:p,data_index:g},y){if(this.version=e,1!==this.version)throw new F1(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=r,this.tileSize=c,this.buffer=p,this.pixelFormat=up[u],this.dataIndex=g,this.bandShape=[c+2*p,c+2*p,hp[this.pixelFormat]],this._decodedBlocks=function(x=1e3,M=0,E=!1){if(isNaN(x)||x<0)throw new TypeError("Invalid max value");if(isNaN(M)||M<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof E)throw new TypeError("Invalid resetTtl value");return new op(x,M,E)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[r,c]of this.dataIndex.entries()){for(const[u,p]of c.bands.entries())if(p===e)return{bandIndex:n+u,blockIndex:r,blockBandIndex:u};n+=c.bands.length}break;case"number":for(const[r,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new F1(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new F1(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,r=-1/0,c=1/0,u=-1/0;for(const p of e){const{blockIndex:g}=this.getBlockForBand(p);if(g<0)throw new F1(`Invalid band: ${JSON.stringify(p)}`);const y=this.dataIndex[g];c=Math.min(c,g),u=Math.max(u,g),n=Math.min(n,y.first_byte),r=Math.max(r,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:r,firstBlock:c,lastBlock:u}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:r}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new F1(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[n],p=this.bandShape.reduce((x,M)=>x*M,1),g=r*p,y=c.subarray(g,g+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:u.offset,scale:u.scale}}}class dp{constructor(e,n,r){this.tasks=e,this._onCancel=n,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}Wf.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{const{layerName:r,firstByte:c,lastByte:u,pixelFormat:p,blockShape:g,blockIndex:y,filters:x,codec:M}=n,E=new Uint8Array(t).subarray(c,u+1),A=new Uint32Array(g[0]*g[1]*g[2]);let O;if("gzip_data"!==M)throw new Error(`Unhandled codec: ${M}`);return O=function(U,W){if(!globalThis.DecompressionStream&&"gzip_data"===W)return Promise.resolve(((Ee=function(Re){31==Re[0]&&139==Re[1]&&8==Re[2]||K2(6,"invalid gzip data");var et=Re[3],mt=10;4&et&&(mt+=2+(Re[10]|Re[11]<<8));for(var Dt=(et>>3&1)+(et>>4&1);Dt>0;Dt-=!Re[mt++]);return mt+(2&et)}(be=U))+8>be.length&&K2(6,"invalid gzip data"),function(Re,et,mt,Dt){var Wt=Re.length;if(!Wt||et.f&&!et.l)return mt||new A2(0);var Vt=!mt,un=Vt||2!=et.i,yn=et.i;Vt&&(mt=new A2(3*Wt));var J1,g1,L2,tn=function(J1){var g1=mt.length;if(J1>g1){var L2=new A2(Math.max(2*g1,J1));L2.set(mt),mt=L2}},gn=et.f||0,Kt=et.p||0,pn=et.b||0,Gn=et.l,wn=et.d,pi=et.m,ni=et.n,Ln=8*Wt;do{if(!Gn){gn=Y2(Re,Kt,1);var $i=Y2(Re,Kt+1,3);if(Kt+=3,!$i){var wi=Re[(is=4+((Kt+7)/8|0))-4]|Re[is-3]<<8,li=is+wi;if(li>Wt){yn&&K2(0);break}un&&tn(pn+wi),mt.set(Re.subarray(is,li),pn),et.b=pn+=wi,et.p=Kt=8*li,et.f=gn;continue}if(1==$i)Gn=ou,wn=Bf,pi=9,ni=5;else if(2==$i){var Mn=Y2(Re,Kt,31)+257,ki=Y2(Re,Kt+10,15)+4,Dr=Mn+Y2(Re,Kt+5,31)+1;Kt+=14;for(var Ki=new A2(Dr),Tr=new A2(19),fr=0;fr<ki;++fr)Tr[$5[fr]]=Y2(Re,Kt+3*fr,7);Kt+=3*ki;var qr=Uf(Tr),Mr=(1<<qr)-1,ks=S3(Tr,qr,1);for(fr=0;fr<Dr;){var is,os=ks[Y2(Re,Kt,Mr)];if(Kt+=15&os,(is=os>>4)<16)Ki[fr++]=is;else{var hs=0,Qr=0;for(16==is?(Qr=3+Y2(Re,Kt,3),Kt+=2,hs=Ki[fr-1]):17==is?(Qr=3+Y2(Re,Kt,7),Kt+=3):18==is&&(Qr=11+Y2(Re,Kt,127),Kt+=7);Qr--;)Ki[fr++]=hs}}var Ks=Ki.subarray(0,Mn),bs=Ki.subarray(Mn);pi=Uf(Ks),ni=Uf(bs),Gn=S3(Ks,pi,1),wn=S3(bs,ni,1)}else K2(1);if(Kt>Ln){yn&&K2(0);break}}un&&tn(pn+131072);for(var Lo=(1<<pi)-1,Ko=(1<<ni)-1,Xa=Kt;;Xa=Kt){var Xs=(hs=Gn[jf(Re,Kt)&Lo])>>4;if((Kt+=15&hs)>Ln){yn&&K2(0);break}if(hs||K2(2),Xs<256)mt[pn++]=Xs;else{if(256==Xs){Xa=Kt,Gn=null;break}var Do=Xs-254;Xs>264&&(Do=Y2(Re,Kt,(1<<(Ja=Rf[fr=Xs-257]))-1)+Of[fr],Kt+=Ja);var Sa=wn[jf(Re,Kt)&Ko],Ta=Sa>>4;if(Sa||K2(3),Kt+=15&Sa,bs=cp[Ta],Ta>3){var Ja=ap[Ta];bs+=jf(Re,Kt)&(1<<Ja)-1,Kt+=Ja}if(Kt>Ln){yn&&K2(0);break}un&&tn(pn+131072);var Js=pn+Do;if(pn<bs){var g2=0-bs,Qc=Math.min(bs,Js);for(g2+pn<0&&K2(3);pn<Qc;++pn)mt[pn]=undefined[g2+pn]}for(;pn<Js;++pn)mt[pn]=mt[pn-bs]}}et.l=Gn,et.p=Xa,et.b=pn,et.f=gn,Gn&&(gn=1,et.m=pi,et.d=wn,et.n=ni)}while(!gn);return pn!=mt.length&&Vt?(J1=mt,(null==(g1=0)||g1<0)&&(g1=0),(null==(L2=pn)||L2>J1.length)&&(L2=J1.length),new A2(J1.subarray(g1,L2))):mt.subarray(0,pn)}(be.subarray(Ee,-8),{i:2},new A2(((ee=be)[(ae=ee.length)-4]|ee[ae-3]<<8|ee[ae-2]<<16|ee[ae-1]<<24)>>>0))));var ee,ae,be,Ee;const Me=lp[W];if(!Me)throw new Error(`Unhandled codec: ${W}`);const We=new globalThis.DecompressionStream(Me);return new Response(new Blob([U]).stream().pipeThrough(We)).arrayBuffer().then(Re=>new Uint8Array(Re))}(E,M).then(U=>{const W=mc.read(new p3(U));if("uint32_values"===W.values)return W.uint32_values.readValuesInto(A),new Z5[p](A.buffer);throw new Error(`Unhandled numeric data "${W.values}"`)}),O.then(U=>{for(let W=x.length-1;W>=0;W--)switch(x[W]){case"delta_filter":nu(U,g);break;case"zigzag_filter":G5(U);break;case"bitshuffle_filter":kf(U,p);break;default:throw new Error(`Unhandled filter "${x[W]}"`)}return{layerName:r,blockIndex:y,data:U}}).catch(U=>{throw U})}))},Xn(dp,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const qf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class z4{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,r]=new Uint8Array(e,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const c=r>>4;if(1!==c)throw new Error(`Got v${c} data when expected v1.`);const u=qf[15&r];if(!u)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new z4(g,p,u,e)}constructor(e,n=64,r=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=qf.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-g%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${r}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+g+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=n,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return B1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:g}=this,y=[0,u.length-1,0],x=[];for(;y.length;){const M=y.pop()||0,E=y.pop()||0,A=y.pop()||0;if(E-A<=g){for(let ee=A;ee<=E;ee++){const ae=p[2*ee],be=p[2*ee+1];ae>=e&&ae<=r&&be>=n&&be<=c&&x.push(u[ee])}continue}const O=A+E>>1,U=p[2*O],W=p[2*O+1];U>=e&&U<=r&&W>=n&&W<=c&&x.push(u[O]),(0===M?e<=U:n<=W)&&(y.push(A),y.push(O-1),y.push(1-M)),(0===M?r>=U:c>=W)&&(y.push(O+1),y.push(E),y.push(1-M))}return x}within(e,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:u,nodeSize:p}=this,g=[0,c.length-1,0],y=[],x=r*r;for(;g.length;){const M=g.pop()||0,E=g.pop()||0,A=g.pop()||0;if(E-A<=p){for(let ee=A;ee<=E;ee++)cu(u[2*ee],u[2*ee+1],e,n)<=x&&y.push(c[ee]);continue}const O=A+E>>1,U=u[2*O],W=u[2*O+1];cu(U,W,e,n)<=x&&y.push(c[O]),(0===M?e-r<=U:n-r<=W)&&(g.push(A),g.push(O-1),g.push(1-M)),(0===M?e+r>=U:n+r>=W)&&(g.push(O+1),g.push(E),g.push(1-M))}return y}}function B1(t,e,n,r,c,u){if(c-r<=n)return;const p=r+c>>1;E3(t,e,p,r,c,u),B1(t,e,n,r,p-1,1-u),B1(t,e,n,p+1,c,1-u)}function E3(t,e,n,r,c,u){for(;c>r;){if(c-r>600){const x=c-r+1,M=n-r+1,E=Math.log(x),A=.5*Math.exp(2*E/3),O=.5*Math.sqrt(E*A*(x-A)/x)*(M-x/2<0?-1:1);E3(t,e,n,Math.max(r,Math.floor(n-M*A/x+O)),Math.min(c,Math.floor(n+(x-M)*A/x+O)),u)}const p=e[2*n+u];let g=r,y=c;for(au(t,e,r,n),e[2*c+u]>p&&au(t,e,r,c);g<y;){for(au(t,e,g,y),g++,y--;e[2*g+u]<p;)g++;for(;e[2*y+u]>p;)y--}e[2*r+u]===p?au(t,e,r,y):(y++,au(t,e,y,c)),y<=n&&(r=y+1),n<=y&&(c=y-1)}}function au(t,e,n,r){Zf(t,n,r),Zf(e,2*n,2*r),Zf(e,2*n+1,2*r+1)}function Zf(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function cu(t,e,n,r){const c=t-n,u=e-r;return c*c+u*u}s.$=E8,s.A=he,s.B=P,s.C=cr,s.D=Rt,s.E=Os,s.F=Co,s.G=On,s.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Hr(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Pi(t.x,e.x,n),y:Pi(t.y,e.y,n),z:Pi(t.z,e.z,n),azimuthal:Pi(t.azimuthal,e.azimuthal,n),polar:Pi(t.polar,e.polar,n)}}},s.I=Qh,s.J=Ma,s.K=or,s.L=Jr,s.M=class{constructor(t,e,n,r){this.id=t,this.position=null!=e?new Lt(e[0],e[1]):new Lt(0,0),this.orientation=n??[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new vo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(s.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(const n of t.meshes){const r=vo.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(r)}if(t.children)for(const n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){const t=s.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,r,c,u,p=!1){yf(this.matrix,this,t.transform,this.position,e,n,r,c,u,p)}upload(t){if(!this.uploaded){for(const e of this.nodes)Y0(e,t);for(const e of this.nodes)K0(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)z6(t)}},s.O=Xt,s.P=Te,s.Q=ec,s.R=vn,s.S=_l,s.T=N8,s.U=Pi,s.V=Rn,s.W=Io,s.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,r]){const c=Hr([1,n,r]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Pi(t.x,e.x,n),y:Pi(t.y,e.y,n),z:Pi(t.z,e.z,n)}}},s.Y=function(t,e,n=0,r=!0){const c=new Te(n,n),u=t.sub(c),p=e.add(c),g=[u,new Te(p.x,u.y),p,new Te(u.x,p.y)];return r&&g.push(u.clone()),g},s.Z=_s,s._=function(t,e){const n=[];for(let r=0;r<t.length;r++){const c=Mi(r-1,-1,t.length-1),u=Mi(r+1,-1,t.length-1),p=t[r],g=t[u],y=t[c].sub(p).unit(),x=g.sub(p).unit(),M=x.angleWithSep(y.x,y.y),E=y.add(x).unit().mult(-1*e/Math.sin(M/2));n.push(p.add(E))}return n},s.a=ro,s.a$=function(t){const e=[];for(const n in t)e.push(t[n]);return e},s.a0=td,s.a1=function(t,e,n=0){return s.N.fromValues(((e.x-n)*t.scale-t.x)*Rn,(e.y*t.scale-t.y)*Rn,Is(e.z,e.y))},s.a2=nh,s.a3=c6,s.a4=function(t){let e=1/0,n=1/0,r=-1/0,c=-1/0;for(const u of t)e=Math.min(e,u.x),n=Math.min(n,u.y),r=Math.max(r,u.x),c=Math.max(c,u.y);return{min:new Te(e,n),max:new Te(r,c)}},s.a5=ur,s.a8=ic,s.a9=ss,s.aA=P2,s.aB=Ro,s.aC=rt,s.aD=B4,s.aE=_6,s.aF=function(){_i.isLoading()||_i.isLoaded()||"deferred"!==zn()||Li()},s.aG=u2,s.aH=no,s.aI=np,s.aJ=Si,s.aK=u3,s.aL=Fd,s.aM=ra,s.aN=R2,s.aO=V3,s.aP=Ld,s.aQ=_0,s.aR=df,s.aS=function(t,e){const n=_l(e.zoom);if(0===n)return q2(t);const r=Z3(t),c=Ql(r),u=ur(r.getWest())*e.worldSize,p=ur(r.getEast())*e.worldSize,g=ar(r.getNorth())*e.worldSize,y=ar(r.getSouth())*e.worldSize,x=[u,g,0],M=[p,g,0],E=[u,y,0],A=[p,y,0],O=s.a6.invert([],e.globeMatrix);return s.N.transformMat4(x,x,O),s.N.transformMat4(M,M,O),s.N.transformMat4(E,E,O),s.N.transformMat4(A,A,O),c[0]=jc(c[0],E,n),c[1]=jc(c[1],A,n),c[2]=jc(c[2],M,n),c[3]=jc(c[3],x,n),vo.fromPoints(c)},s.aT=Y3,s.aU=e3,s.aV=jc,s.aW=Z1,s.aX=rh,s.aY=Ne,s.aZ=Wf,s.a_=Ht,s.aa=Ot,s.ab=Ce,s.ac=function(t,e){const n={};for(let r=0;r<e.length;r++){const c=e[r];c in t&&(n[c]=t[c])}return n},s.ad=Zt,s.ae=ar,s.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,r){const c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){const[u,p]=c.result;return this.scheduler?this.scheduler.add(()=>{r(u,p)},e):r(u,p),()=>{}}return c.callbacks.push(r),c.cancel||(c.cancel=n((u,p)=>{c.result=[u,p];for(const g of c.callbacks)this.scheduler?this.scheduler.add(()=>{g(u,p)},e):g(u,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(u=>u!==r),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},s.ag=Pl,s.ah=function(t,e,n){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const u=Ht(t.request,(p,g,y,x)=>{p?c(p):g&&c(null,{vectorTile:n?void 0:new v0(new p3(g)),rawData:g,cacheControl:y,expires:x})});return()=>{u.cancel(),c()}},e)},s.ai=function(t){hr++,hr>$n&&(t.getActor().send("enforceCacheSizeLimit",Qt),hr=0)},s.aj=Nn,s.ak=At,s.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.am=kn,s.an=b6,s.ao=R8,s.ap=k8,s.aq=function(t,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let r=0;r<t.length;r++){const c=document.createElement("source");an(t[r])||(n.crossOrigin="Anonymous"),c.src=t[r],n.appendChild(c)}return{cancel:()=>{}}},s.ar=x6,s.as=Vr,s.at=mr,s.au=Yr,s.av=bc,s.aw=Pa,s.ax=Sr,s.ay=cs,s.az=nc,s.b=ds,s.b$=xe,s.b0=function(t,e){const n=[];for(const r in t)r in e||n.push(r);return n},s.b1=Wi,s.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.b3=function(t,e){const{x:n,y:r}=t.point,c=f0(n,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return s.a6.multiply(c,c,K3(q2(e)))},s.b5=f3,s.b6=p2,s.b7=E0,s.b8=function(t,e,n,r,c){const u=5*e+2;t.float32[u+0]=n,t.float32[u+1]=r,t.float32[u+2]=c},s.b9=j0,s.bA=zl,s.bB=F8,s.bC=function(t){const e=F8(t,!0);return s.b4.invert([],[e[0],e[1],e[4],e[5]])},s.bD=Uu,s.bE=function(t){const{x:e,y:n}=t.point,{lng:r,lat:c}=t._center;return f0(e,n,t.worldSize,r,c)},s.bF=Pt,s.bG=ze,s.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return je[e]},s.bI=45,s.bJ=bi,s.bK=d,s.bL=w2,s.bM=bu,s.bN=M1,s.bO=Rc,s.bP=h,s.bQ=function(t,e,n){const r=Math.sqrt(t*t+e*e+n*n),c=r>0?Math.acos(n/r)*Ue:0;let u=0!==t||0!==e?Math.atan2(-e,-t)*Ue+90:0;return u<0&&(u+=360),[r,u,c]},s.bR=Rr,s.bS=vo,s.bT=Hr,s.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},s.bV=function(t){return t({pluginStatus:$,pluginURL:oe}),Ut.on("pluginStateChange",t),t},s.bW=xf,s.bX=w3,s.bY=p4,s.bZ=ef,s.b_=Oi,s.ba=v8,s.bb=C2,s.bc=S1,s.bd=k0,s.be=Kc,s.bf=p6,s.bg=z4,s.bh=Mi,s.bj=Ye,s.bk=He,s.bl=yr,s.bm=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},s.bn=Lt,s.bo=hf,s.bp=Un,s.bq=Gu,s.br=B8,s.bs=Cn,s.bt=Jl,s.bu=function(t,e,n,r,c,u,p,g,y){if("globe"===y.name)return Jl(t,e,new Cn(n,r,c),!1);const x=Vr({z:n,x:r,y:c},y);return new vo([(u+x.x/x.scale)*e,e*(x.y/x.scale),p],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),g])},s.bv=function(t,e,n){let r=0;for(let c=0;c<2;++c){const u=n?n[c]:0;t[c]>u&&(r+=(t[c]-u)*(t[c]-u)),e[c]<u&&(r+=(u-e[c])*(u-e[c]))}return r},s.bw=xr,s.bx=ge,s.by=function(t){const e=s.a6.identity(new Float64Array(16));s.a6.multiply(e,t.pixelMatrix,t.globeMatrix);const n=[0,dt,0],r=[0,$t,0];return s.N.transformMat4(n,n,e),s.N.transformMat4(r,r,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Zu(t,new Lt(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Zu(t,new Lt(t.center.lat,-90))]},s.bz=function(t,e){const{scale:n}=t.tileTransform,r=n*Rn/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return s.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[r,r])},s.c=Af,s.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.c0=gt,s.c1=mi,s.c2=function(t,e,n){return"custom"===t.type?new E5(t,e):new sp[t.type](t,e,n)},s.c3=function(t){const e=t.indexOf(Hl);return e>=0?t.slice(0,e):t},s.c4=function(t){return t.indexOf(Hl)>=0},s.c5=function(t){const e=t.indexOf(Hl);return e>=0?t.slice(e+1):""},s.c6=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.c7=Bt,s.c8=Ut,s.c9=kt,s.cA=Hh,s.cB=(t,e,n,r,c,u)=>{const p=t.transform;return{u_matrix:Vh(t,e,n,r),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:Ih(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},s.cC=(t,e,n,r,c,u,p)=>{const g=t.transform,y=g.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Vh(t,e,n,r),u_pixels_to_tile_units:y,u_device_pixel_ratio:u,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:l6(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ih(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:n.paint.get("line-emissive-strength")}},s.cD=ht,s.cE=X3,s.cF=r6,s.cG=di,s.cH=a4,s.cI=qc,s.cJ=450,s.cK=7,s.cL=T5,s.cM=256,s.cN=K3,s.cO=wc,s.cP=D1,s.cQ=function(t,e,n,r,c){return Ot((t-e)/(n-e)*(c-r)+r,r,c)},s.cR=kr,s.cS=S6,s.cT=[1,1,1],s.cU=cc,s.cV=b4,s.cW=B2,s.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=Yd(new Te(0,0),new Te(Rn,Rn),t),n=[];for(const r of this._activeRegions){if(r.hiddenByOverlap||!Zd(e,r))continue;const c=bh(r.min,r.max,t);n.push({min:c.min,max:c.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const r of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(r).buckets[e.layer];if(c)for(const u of c.getNodesInfo()){const p=u.node;p.footprint&&n.push({footprint:p.footprint,id:r.toUnwrapped()})}}return n}})))}_addSource(t){const e=t.getFootprints();if(0!==e.length){for(const n of e){if(!n.footprint)continue;const r=Yd(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:r.min,max:r.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||xh(e.min,n.min)||xh(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){const r=this._activeRegions[e],c=this._prevRegions[n];t=r.priority!==c.priority||!n4(r,c),++e,++n}}if(t){++this._updateTime;const e=n=>{const r=this._activeRegions;if(n>=r.length)return n;const c=r[n].priority;for(;n<r.length&&r[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,r=e(n);for(;n!==r;){let c=n;const u=n;for(;c!==r;){const p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let g=0;g<u;g++){const y=this._activeRegions[g];if(!y.hiddenByOverlap&&Zd(p,y)&&(p.hiddenByOverlap=Z2(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++c}n=r,r=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},s.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const n=new R2,r=new Pa,c=[],u=t+1+2,p=e[0]+1,g=e[0]+1+(1+e.length),y=(x,M,E)=>{let A=x===u-1?x-2:0===x?x:x-1;return A+=E?24575:0,[A,M]};for(let x=0;x<u;++x)n.emplaceBack(...y(x,0,!0));for(let x=0;x<p;++x)for(let M=0;M<u;++M)n.emplaceBack(...y(M,x,(0===M||M===u-1)&&!0));for(let x=0;x<e.length;++x){const M=e[x];for(let E=0;E<u;++E)n.emplaceBack(...y(E,M,!0))}for(let x=0;x<e.length;++x){const M=r.length,E=e[x]+1+2,A=new Pa;for(let W=0;W<E-1;W++){const ee=W===E-2,ae=ee?u*(g-e.length+x-W):u;for(let be=0;be<u-1;be++){const Ee=W*u+be;0===W||ee||0===be||be===u-2?(A.emplaceBack(Ee+1,Ee,Ee+ae),A.emplaceBack(Ee+ae,Ee+ae+1,Ee+1)):(r.emplaceBack(Ee+1,Ee,Ee+ae),r.emplaceBack(Ee+ae,Ee+ae+1,Ee+1))}}const O=Ro.simpleSegment(0,M,n.length,r.length-M);for(let W=0;W<A.uint16.length;W+=3)r.emplaceBack(A.uint16[W],A.uint16[W+1],A.uint16[W+2]);const U=Ro.simpleSegment(0,M,n.length,r.length-M);c.push({withoutSkirts:O,withSkirts:U})}return{vertices:n,indices:r,segments:c}}_createGrid(t){const e=this._fillGridMeshWithLods(64,nt);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Ld.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Pa;for(let p=0;p<=64;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new wc,r=new wc,c=new wc,u=new wc;this._poleSegments=[];for(let p=0,g=0;p<ze;p++){const y=360/(1<<p);n.emplaceBack(0,-Ce,0,.5,0),r.emplaceBack(0,-Ce,0,.5,1),c.emplaceBack(0,-Ce,0,.5,.5),u.emplaceBack(0,-Ce,0,.5,.5);for(let x=0;x<=64;x++){let M=x/64,E=0;const A=Pi(0,y,M),[O,U,W]=Ct(Yu,Vd,A,Ce);n.emplaceBack(O,U,W,M,E),r.emplaceBack(O,U,W,M,1-E);const ee=Ye(A);M=.5+.5*Math.sin(ee),E=.5+.5*Math.cos(ee),c.emplaceBack(O,U,W,M,E),u.emplaceBack(O,U,W,M,1-E)}this._poleSegments.push(Ro.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,$u,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,$u,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,$u,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,$u,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},s.cZ=function(t){return Qs.has(t)},s.c_=ot,s.ca=i,s.cb=class extends j2{constructor(t){super(t),this.current=m}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let r=0;r<9;r++)if(n[r]!==this.current[r]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},s.cc=Ze,s.cd=function(t,e,n){const r=_l(n.zoom),c=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!c&&!u},s.ce=function(t){const e=t.pixelsPerMeter,n=e/yr(1,t.center.lat),r=s.a6.identity(new Float64Array(16));return s.a6.translate(r,r,[t.point.x,t.point.y,0]),s.a6.scale(r,r,[n,n,e]),Float32Array.from(r)},s.cf=Z3,s.cg=function(t){const e=xr-5;t=Ot(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Ye(t))),3);return Math.round(n*(nt.length-1))},s.ch=function(t,e,n,r){const c=e.getNorth(),u=e.getSouth(),p=e.getWest(),g=e.getEast(),y=1<<t.z,x=g-p,M=c-u,E=x/64,A=-M/nt[n],O=[0,E,0,A,0,0,c,p,0];if(t.z>0){const U=180/r;s.co.multiply(O,O,[U/x+1,0,0,0,U/M+1,0,-.5*U/E,.5*U/A,1])}return O[2]=y,O[5]=t.x,O[8]=t.y,O},s.ci=q2,s.cj=function(t,e,n){const r=s.a6.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return s.a6.rotateY(r,n.globeMatrix,c),Float32Array.from(r)},s.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,r=1<<n,c=Math.floor(t.x),u=Math.floor((t.x-c)*r),p=Math.floor(t.y*r),g=this.findDEMTileFor(new kn(n,c,n,u,p));return!(!g||!g.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const c=r.getSource().maxzoom,u=1<<c,p=Math.floor(t.x),g=t.x-p,y=new kn(c,p,c,Math.floor(g*u),Math.floor(t.y*u)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;const M=x.dem,E=1<<x.tileID.canonical.z,A=(g*E-x.tileID.canonical.x)*M.dim,O=(t.y*E-x.tileID.canonical.y)*M.dim,U=Math.floor(A),W=Math.floor(O);return(n?this.exaggeration():1)*Pi(Pi(M.get(U,W),M.get(U,W+1),O-W),Pi(M.get(U+1,W),M.get(U+1,W+1),O-W),A-U)}getAtTileOffset(t,e,n){const r=1<<t.canonical.z;return this.getAtPointOrZero(new Jr(t.wrap+(t.canonical.x+e/Rn)/r,(t.canonical.y+n/Rn)/r))}getAtTileOffsetFunc(t,e,n,r){return c=>{const u=this.getAtTileOffset(t,c.x,c.y),p=r.upVector(t.canonical,c.x,c.y),g=r.upVectorScale(t.canonical,e,n).metersToTile;return s.N.scale(p,p,u*g),p}}getForTilePoints(t,e,n,r){if(this.isUsingMockSource())return!1;const c=cc.create(this,t,r);return!!c&&(e.forEach(u=>{u[2]=this.exaggeration()*c.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,r=e.tileID,c=1<<t.canonical.z-r.canonical.z;let u=t.canonical.x/c-r.canonical.x,p=t.canonical.y/c-r.canonical.y,g=0;for(let y=0;y<t.canonical.z-r.canonical.z&&!n.leaves[g];y++){u*=2,p*=2;const x=2*Math.floor(p)+Math.floor(u);g=n.childOffsets[g]+x,u%=1,p%=1}return{min:this.exaggeration()*n.minimums[g],max:this.exaggeration()*n.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,n=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const c of t){const u=this.getMinMaxForTile(c.tileID);u&&(n=Math.min(n,u.min),r=Math.max(r,u.max),e=!0)}return e?{min:n,max:r}:null}},s.cl=sh,s.cm=kd,s.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},s.cp=oh,s.cq=256,s.cr=function(t,e){const n=[0,0,0],r=Y3(q2(e.canonical));return s.N.transformMat4(n,n,r),s.N.transformMat4(n,n,t),n},s.cs=t=>({u_camera_to_center_distance:new M1(t),u_extrude_scale:new b(t),u_device_pixel_ratio:new M1(t),u_matrix:new d(t),u_inv_rot_matrix:new d(t),u_merc_center:new w2(t),u_tile_id:new bu(t),u_zoom_transition:new M1(t),u_up_dir:new bu(t),u_emissive_strength:new M1(t)}),s.ct=t=>({u_matrix:new d(t),u_pixels_to_tile_units:new b(t),u_device_pixel_ratio:new M1(t),u_units_to_pixels:new w2(t),u_dash_image:new Rc(t),u_gradient_image:new Rc(t),u_image_height:new M1(t),u_texsize:new w2(t),u_tile_units_to_pixels:new M1(t),u_alpha_discard_threshold:new M1(t),u_trim_offset:new w2(t),u_emissive_strength:new M1(t)}),s.cu=t=>({u_matrix:new d(t),u_texsize:new w2(t),u_pixels_to_tile_units:new b(t),u_device_pixel_ratio:new M1(t),u_image:new Rc(t),u_units_to_pixels:new w2(t),u_tile_units_to_pixels:new M1(t),u_alpha_discard_threshold:new M1(t),u_trim_offset:new w2(t)}),s.cv=ol,s.cw=vm,s.cx=T1,s.cy=ah,s.cz=(t,e,n,r,c,u)=>{const p=t.transform,g="globe"===p.projection.name;let y;if("map"===u.paint.get("circle-pitch-alignment"))if(g){const M=oh(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([M,0,0,M])}else y=p.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const x={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:It.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:jp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(g){x.u_inv_rot_matrix=r,x.u_merc_center=c,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=_l(p.zoom);const M=c[0]*Rn,E=c[1]*Rn;x.u_up_dir=p.projection.upVector(new Cn(0,0,0),M,E)}return x},s.d=ye,s.d0=pt,s.d1=ts,s.d2=en,s.d3=function([t,e,n]){const r=Math.hypot(t,e,n),c=Math.atan2(t,n),u=.5*Math.PI-Math.acos(-e/r);return new Lt(Pt(c),Pt(u))},s.d4=Jt,s.d5=Et,s.d6=Zu,s.d7=Dd,s.d8=function(t){const e=[0,0,0],n=s.a6.identity(new Float64Array(16));return s.a6.multiply(n,t.pixelMatrix,t.globeMatrix),s.N.transformMat4(e,e,n),new Te(e[0],e[1])},s.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(null==sn){const r=n.navigator?n.navigator.userAgent:null;sn=!!n.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return sn}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dA=fc,s.dB=V6,s.dC=Df,s.dD=a6,s.dE=Ke,s.dF=x8,s.dG=function(t,e,n,r,c,u,p,g,y,x,M){t.createArrays(),t.tilePixelRatio=Rn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const E=t.layers[0].layout,A=t.layers[0]._unevaluatedLayout._values,O={};if("composite"===t.textSizeData.kind){const{minZoom:ae,maxZoom:be}=t.textSizeData;O.compositeTextSizes=[A["text-size"].possiblyEvaluate(new or(ae),g),A["text-size"].possiblyEvaluate(new or(be),g)]}if("composite"===t.iconSizeData.kind){const{minZoom:ae,maxZoom:be}=t.iconSizeData;O.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new or(ae),g),A["icon-size"].possiblyEvaluate(new or(be),g)]}O.layoutTextSize=A["text-size"].possiblyEvaluate(new or(y+1),g),O.layoutIconSize=A["icon-size"].possiblyEvaluate(new or(y+1),g),O.textMaxSize=A["text-size"].possiblyEvaluate(new or(18),g);const U="map"===E.get("text-rotation-alignment")&&"point"!==E.get("symbol-placement"),W=E.get("text-size");let ee=!1;for(const ae of t.features)if(ae.icon&&ae.icon.nameSecondary){ee=!0;break}for(const ae of t.features){const be=E.get("text-font").evaluate(ae,{},g).join(","),Ee=W.evaluate(ae,{},g),Me=O.layoutTextSize.evaluate(ae,{},g),We=(O.layoutIconSize.evaluate(ae,{},g),{horizontal:{},vertical:void 0}),Re=ae.text;let et,mt=[0,0];if(Re){const Vt=Re.toString(),un=E.get("text-letter-spacing").evaluate(ae,{},g)*S1,yn=E.get("text-line-height").evaluate(ae,{},g)*S1,tn=Ni(Vt)?un:0,gn=E.get("text-anchor").evaluate(ae,{},g),Kt=E.get("text-variable-anchor");if(!Kt){const ni=E.get("text-radial-offset").evaluate(ae,{},g);mt=ni?k0(gn,[ni*S1,N0]):E.get("text-offset").evaluate(ae,{},g).map(Ln=>Ln*S1)}let pn=U?"center":E.get("text-justify").evaluate(ae,{},g);const Gn="point"===E.get("symbol-placement"),wn=Gn?E.get("text-max-width").evaluate(ae,{},g)*S1:1/0,pi=ni=>{t.allowVerticalPlacement&&o2(Vt)&&(We.vertical=D0(Re,e,n,c,be,wn,yn,gn,ni,tn,mt,p2.vertical,!0,Me,Ee))};if(!U&&Kt){const ni="auto"===pn?Kt.map($i=>Kc($i)):[pn];let Ln=!1;for(let $i=0;$i<ni.length;$i++){const wi=ni[$i];if(!We.horizontal[wi])if(Ln)We.horizontal[wi]=We.horizontal[0];else{const li=D0(Re,e,n,c,be,wn,yn,"center",wi,tn,mt,p2.horizontal,!1,Me,Ee);li&&(We.horizontal[wi]=li,Ln=1===li.positionedLines.length)}}pi("left")}else{if("auto"===pn&&(pn=Kc(gn)),Gn||E.get("text-writing-mode").indexOf("horizontal")>=0||!o2(Vt)){const ni=D0(Re,e,n,c,be,wn,yn,gn,pn,tn,mt,p2.horizontal,!1,Me,Ee);ni&&(We.horizontal[pn]=ni)}pi(Gn?"left":pn)}}let Dt=!1;if(ae.icon&&ae.icon.namePrimary){const Vt=r[ae.icon.namePrimary];Vt&&(et=Kh(c[ae.icon.namePrimary],ae.icon.nameSecondary?c[ae.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(ae,{},g),E.get("icon-anchor").evaluate(ae,{},g)),Dt=Vt.sdf,void 0===t.sdfIcons?t.sdfIcons=Vt.sdf:t.sdfIcons!==Vt.sdf&&Ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Vt.pixelRatio!==t.pixelRatio||0!==E.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const Wt=R0(We.horizontal)||We.vertical;t.iconsInText||(t.iconsInText=!!Wt&&Wt.iconsInText),(Wt||et)&&v5(t,ae,We,et,r,O,Me,0,mt,Dt,p,g,x,M,ee)}u&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},s.dH=v0,s.dI=p3,s.dJ=Wc,s.dK=En,s.dL=yh,s.dM=e4,s.dN=Vn,s.dO=Fh,s.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==I6){const n=new Uint32Array(t,0,7),[,,r,c,u,p]=n;e=n.byteLength+c+u+p+u,(r!==t.byteLength||e>=t.byteLength)&&Ii("Invalid b3dm header information.")}return zf(t,e)},s.dQ=function(t,e){const n=Af(t);for(const r of n){for(const c of r.meshes)Lf(c);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(tp(r.lights,e)))}return n},s.dR=tu,s.dS=A6,s.dT=_i,s.dU=function(t){Hi(),Wn&&Wn.then(e=>{e.keys().then(n=>{for(let r=0;r<n.length-t;r++)e.delete(n[r])})})},s.da=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ke,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!gt(t))return t;const n=Se(t);return n.params.push(`sdk=js-${ct}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!gt(t))return t;const n=Se(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!gt(t))return t;const n=Se(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,r){if(!gt(t))return t;const c=Se(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),r&&c.params.push(`worldview=${r}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,r){const c=Se(t);return gt(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||r)):(c.path+=`${e}${n}`,at(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!gt(t))return t;const r=Se(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==r.authority&&512===n?"@2x":""}${ri.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${Et.RASTER_URL_PREFIX}${r.path}`:"rasterarrays"===r.authority?r.path=`/${Et.RASTERARRAYS_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${Et.TILE_URL_VERSION}${r.path}`);const c=this._customAccessToken||function(u){for(const p of u){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(r.params)||Et.ACCESS_TOKEN;return Et.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,c)}canonicalizeTileURL(t,e){const n=Se(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+=`raster/${n.path.replace(`/${Et.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?r+=`rasterarrays/${n.path.replace(`/${Et.RASTERARRAYS_URL_PREFIX}/`,"")}`:r+=`tiles/${n.path.replace(`/${Et.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(u=>!u.match(/^access_token=/))),c.length&&(r+=`?${c.join("&")}`),r}canonicalizeTileset(t,e){const n=!!e&&gt(e),r=[];for(const c of t.tiles||[])qt(c)?r.push(this.canonicalizeTileURL(c,n)):r.push(c);return r}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Se(Et.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!Et.REQUIRE_ACCESS_TOKEN)return at(t);if(e=e||Et.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>-1===c.indexOf("access_token")),t.params.push(`access_token=${e||""}`),at(t)}},s.db=function(t,e){e?Qs.add(t):Qs.delete(t)},s.dc=ri,s.dd=rs,s.de=zs,s.df=J,s.dg=si,s.dh=function(t){Qs.delete(t)},s.di=Er,s.dj=Ei,s.dk=ct,s.dl=function(t,e){Qt=t,$n=e},s.dm=function(t,e,n=!1){if($===W1||$===k||$===F)throw new Error("setRTLTextPlugin cannot be called multiple times.");oe=It.resolveURL(t),$=W1,V=e,Oe(),n||Li()},s.dn=zn,s.dp=function(){w3().acquire(X0)},s.dq=function(){const t=w4;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(X0),w4=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dr=b3,s.ds=function(t){const e=Fi();if(!e)return;const n=e.delete(Hn);t&&n.catch(t).then(()=>t())},s.dt=x3,s.du=wf,s.dv=function(t){bf=It.resolveURL(t),dc||(dc=new xf(w3(),new Os)),dc.broadcast("setDracoUrl",bf)},s.dw=Z8,s.dx=function(t){C4=It.resolveURL(t),dc||(dc=new xf(w3(),new Os)),dc.broadcast("setMeshoptUrl",C4)},s.dy=Xn,s.dz=Gc,s.e=ti,s.f=It,s.g=function(t,e){return kt(ti(t,{type:"json"}),e)},s.h=c2,s.i=oa,s.j=sa,s.k=te,s.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>zf(e,0,t))},s.m=D,s.n=Wr,s.o=k2,s.p=y8,s.q=vr,s.r=pr,s.s=q,s.t=wa,s.u=Il,s.v=vt,s.w=Ii,s.x=I1,s.z=L4}),De(0,function(s){function ct(sn){const me=sn?sn.url.toString():void 0;return me?performance.getEntriesByName(me):[]}function de(sn){if("number"==typeof sn||"boolean"==typeof sn||"string"==typeof sn||null==sn)return JSON.stringify(sn);if(Array.isArray(sn)){let He="[";for(const it of sn)He+=`${de(it)},`;return`${He}]`}let me="{";for(const He of Object.keys(sn).sort())me+=`${He}:${de(sn[He])},`;return`${me}}`}function Et(sn){let me="";for(const He of s.b2)me+=`/${de(sn[He])}`;return me}class qt{constructor(me){this.keyCache={},this._layers={},this._layerConfigs={},me&&this.replace(me)}replace(me,He){this._layerConfigs={},this._layers={},this.update(me,[],He)}update(me,He,it){this._options=it;for(const At of me)this._layerConfigs[At.id]=At,(this._layers[At.id]=s.c2(At,this.scope,this._options)).compileFilter(),this.keyCache[At.id]&&delete this.keyCache[At.id];for(const At of He)delete this.keyCache[At],delete this._layerConfigs[At],delete this._layers[At];this.familiesBySource={};const zt=function(At,It){const Hn={};for(let $n=0;$n<At.length;$n++){const Wn=It&&It[At[$n].id]||Et(At[$n]);It&&(It[At[$n].id]=Wn);let Zn=Hn[Wn];Zn||(Zn=Hn[Wn]=[]),Zn.push(At[$n])}const Qt=[];for(const $n in Hn)Qt.push(Hn[$n]);return Qt}(s.a$(this._layerConfigs),this.keyCache);for(const At of zt){const It=At.map(Fi=>this._layers[Fi.id]),Hn=It[0];if("none"===Hn.visibility)continue;const Qt=Hn.source||"";let $n=this.familiesBySource[Qt];$n||($n=this.familiesBySource[Qt]={});const Wn=Hn.sourceLayer||"_geojsonTileLayer";let Zn=$n[Wn];Zn||(Zn=$n[Wn]=[]),Zn.push(It)}}}const gt=1*s.dA;class jt{constructor(me){const He={},it=[];for(const Hn in me){const Qt=me[Hn],$n=He[Hn]={};for(const Wn in Qt.glyphs){const Zn=Qt.glyphs[+Wn];if(!Zn||0===Zn.bitmap.width||0===Zn.bitmap.height)continue;const Fi=Zn.metrics.localGlyph?gt:1,Hi={x:0,y:0,w:Zn.bitmap.width+2*Fi,h:Zn.bitmap.height+2*Fi};it.push(Hi),$n[Wn]=Hi}}const{w:zt,h:At}=s.p(it),It=new s.dz({width:zt||1,height:At||1});for(const Hn in me){const Qt=me[Hn];for(const $n in Qt.glyphs){const Wn=Qt.glyphs[+$n];if(!Wn||0===Wn.bitmap.width||0===Wn.bitmap.height)continue;const Zn=He[Hn][$n],Fi=Wn.metrics.localGlyph?gt:1;s.dz.copy(Wn.bitmap,It,{x:0,y:0},{x:Zn.x+Fi,y:Zn.y+Fi},Wn.bitmap)}}this.image=It,this.positions=He}}s.dy(jt,"GlyphAtlas");class wt{constructor(me){this.tileID=new s.am(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),this.tileZoom=me.tileZoom,this.uid=me.uid,this.zoom=me.zoom,this.canonical=me.tileID.canonical,this.pixelRatio=me.pixelRatio,this.tileSize=me.tileSize,this.source=me.source,this.scope=me.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=me.showCollisionBoxes,this.collectResourceTiming=!!me.collectResourceTiming,this.promoteId=me.promoteId,this.isSymbolTile=me.isSymbolTile,this.tileTransform=s.as(me.tileID.canonical,me.projection),this.projection=me.projection,this.brightness=me.brightness,this.extraShadowCaster=!!me.extraShadowCaster}parse(me,He,it,zt,At){this.status="parsing",this.data=me,this.collisionBoxArray=new s.aD;const It=new s.dB(Object.keys(me.layers).sort()),Hn=new s.dC(this.tileID,this.promoteId);Hn.bucketLayerIDs=[];const Qt={},$n=new s.dD(256,256),Wn={featureIndex:Hn,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:$n,availableImages:it,brightness:this.brightness},Zn=He.familiesBySource[this.source];for(const Qi in Zn){const Ir=me.layers[Qi];if(!Ir)continue;let cn=!1,Be=!1,Tt=!1;for(const ei of Zn[Qi])"symbol"===ei[0].type?cn=!0:Be=!0,ei[0].is3D()&&"model"!==ei[0].type&&(Tt=!0);if(this.extraShadowCaster&&!Tt||!0===this.isSymbolTile&&!cn||!1===this.isSymbolTile&&!Be)continue;1===Ir.version&&s.w(`Vector tile source "${this.source}" layer "${Qi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const In=It.encode(Qi),vn=[];for(let ei=0;ei<Ir.length;ei++){const Oi=Ir.feature(ei),kt=Hn.getId(Oi,Qi);vn.push({feature:Oi,id:kt,index:ei,sourceLayerIndex:In})}for(const ei of Zn[Qi]){const Oi=ei[0];(!this.extraShadowCaster||Oi.is3D()&&"model"!==Oi.type)&&(void 0!==this.isSymbolTile&&"symbol"===Oi.type!==this.isSymbolTile||Oi.minzoom&&this.zoom<Math.floor(Oi.minzoom)||Oi.maxzoom&&this.zoom>=Oi.maxzoom||"none"!==Oi.visibility&&(Gt(ei,this.zoom,Wn.brightness,it),(Qt[Oi.id]=Oi.createBucket({index:Hn.bucketLayerIDs.length,layers:ei,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source,projection:this.projection.spec})).populate(vn,Wn,this.tileID.canonical,this.tileTransform),Hn.bucketLayerIDs.push(ei.map(kt=>kt.id))))}}let Fi,Hi,Xr,Ti;$n.trim();const hr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ri=()=>{if(Fi)return this.status="done",At(Fi);if(this.extraShadowCaster)this.status="done",At(null,{buckets:s.a$(Qt).filter(Qi=>!Qi.isEmpty()),featureIndex:Hn,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Wn.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Hi&&Xr&&Ti){const Qi=new jt(Hi),Ir=new s.dF(Xr,Ti);for(const cn in Qt){const Be=Qt[cn];Be instanceof s.aE?(Gt(Be.layers,this.zoom,Wn.brightness,it),s.dG(Be,Hi,Qi.positions,Xr,Ir.iconPositions,this.showCollisionBoxes,it,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Be.hasPattern&&(Be instanceof s.aK||Be instanceof s.aL||Be instanceof s.cH)&&(Gt(Be.layers,this.zoom,Wn.brightness,it),Be.addFeatures(Wn,this.tileID.canonical,Ir.patternPositions,it,this.tileTransform,this.brightness))}this.status="done",At(null,{buckets:s.a$(Qt).filter(cn=>!cn.isEmpty()),featureIndex:Hn,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qi.image,lineAtlas:$n,imageAtlas:Ir,brightness:Wn.brightness})}};if(!this.extraShadowCaster){const Qi=s.dE(Wn.glyphDependencies,Be=>Object.keys(Be).map(Number));Object.keys(Qi).length?zt.send("getGlyphs",{uid:this.uid,stacks:Qi,scope:this.scope},(Be,Tt)=>{Fi||(Fi=Be,Hi=Tt,ri())},void 0,!1,hr):Hi={};const Ir=Object.keys(Wn.iconDependencies);Ir.length?zt.send("getImages",{icons:Ir,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Be,Tt)=>{Fi||(Fi=Be,Xr=Tt,ri())},void 0,!1,hr):Xr={};const cn=Object.keys(Wn.patternDependencies);cn.length?zt.send("getImages",{icons:cn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Be,Tt)=>{Fi||(Fi=Be,Ti=Tt,ri())},void 0,!1,hr):Ti={}}ri()}}function Gt(sn,me,He,it){const zt=new s.K(me,{brightness:He});for(const At of sn)At.recalculate(zt,it)}class Kn extends s.E{constructor(me,He,it,zt,At,It){super(),this.actor=me,this.layerIndex=He,this.availableImages=it,this.loadVectorData=At||s.ah,this.loading={},this.loaded={},this.deduped=new s.af(me.scheduler),this.isSpriteLoaded=zt,this.scheduler=me.scheduler,this.brightness=It}loadTile(me,He){const it=me.uid,zt=me&&me.request,At=zt&&zt.collectResourceTiming,It=this.loading[it]=new wt(me);It.abort=this.loadVectorData(me,(Hn,Qt)=>{const $n=!this.loading[it];if(delete this.loading[it],$n||Hn||!Qt)return It.status="done",$n||(this.loaded[it]=It),He(Hn);const Wn=Qt.rawData,Zn={};Qt.expires&&(Zn.expires=Qt.expires),Qt.cacheControl&&(Zn.cacheControl=Qt.cacheControl),It.vectorTile=Qt.vectorTile||new s.dH(new s.dI(Wn));const Fi=()=>{It.parse(It.vectorTile,this.layerIndex,this.availableImages,this.actor,(Hi,Xr)=>{if(Hi||!Xr)return He(Hi);const Ti={};if(At){const hr=ct(zt);hr.length>0&&(Ti.resourceTiming=JSON.parse(JSON.stringify(hr)))}He(null,s.e({rawTileData:Wn.slice(0)},Xr,Zn,Ti))})};this.isSpriteLoaded?Fi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Fi,{type:"parseTile",isSymbolTile:me.isSymbolTile,zoom:me.tileZoom}):Fi()}),this.loaded=this.loaded||{},this.loaded[it]=It})}reloadTile(me,He){const it=this.loaded,zt=me.uid,At=this;if(it&&it[zt]){const It=it[zt];It.showCollisionBoxes=me.showCollisionBoxes,It.projection=me.projection,It.brightness=me.brightness,It.tileTransform=s.as(me.tileID.canonical,me.projection),It.extraShadowCaster=me.extraShadowCaster;const Hn=(Qt,$n)=>{const Wn=It.reloadCallback;Wn&&(delete It.reloadCallback,It.parse(It.vectorTile,At.layerIndex,this.availableImages,At.actor,Wn)),He(Qt,$n)};"parsing"===It.status?It.reloadCallback=Hn:"done"===It.status&&(It.vectorTile?It.parse(It.vectorTile,this.layerIndex,this.availableImages,this.actor,Hn):Hn())}else He(null,void 0)}abortTile(me,He){const it=me.uid,zt=this.loading[it];zt&&(zt.abort&&zt.abort(),delete this.loading[it]),He()}removeTile(me,He){const it=this.loaded,zt=me.uid;it&&it[zt]&&delete it[zt],He()}}class Sn{loadTile(me,He){const{uid:it,encoding:zt,rawImageData:At,padding:It}=me,Hn=ImageBitmap&&At instanceof ImageBitmap?this.getImageData(At,It):At;He(null,new s.dJ(it,Hn,zt,It<1))}getImageData(me,He){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(me.width,me.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=me.width,this.offscreenCanvas.height=me.height,this.offscreenCanvasContext.drawImage(me,0,0,me.width,me.height);const it=this.offscreenCanvasContext.getImageData(-He,-He,me.width+2*He,me.height+2*He);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),it}}class En{decodeRasterArray({task:me,buffer:He},it){s.aZ.performDecoding(He,me).then(zt=>{it(null,zt)},zt=>{it(zt)})}}function dn(sn,me){if(0!==sn.length){ii(sn[0],me);for(var He=1;He<sn.length;He++)ii(sn[He],!me)}}function ii(sn,me){for(var He=0,it=0,zt=0,At=sn.length,It=At-1;zt<At;It=zt++){var Hn=(sn[zt][0]-sn[It][0])*(sn[It][1]+sn[zt][1]),Qt=He+Hn;it+=Math.abs(He)>=Math.abs(Hn)?He-Qt+Hn:Hn-Qt+He,He=Qt}He+it>=0!=!!me&&sn.reverse()}var hn=s.dK(function sn(me,He){var it,zt=me&&me.type;if("FeatureCollection"===zt)for(it=0;it<me.features.length;it++)sn(me.features[it],He);else if("GeometryCollection"===zt)for(it=0;it<me.geometries.length;it++)sn(me.geometries[it],He);else if("Feature"===zt)sn(me.geometry,He);else if("Polygon"===zt)dn(me.coordinates,He);else if("MultiPolygon"===zt)for(it=0;it<me.coordinates.length;it++)dn(me.coordinates[it],He);return me});const Vn=s.dL.prototype.toGeoJSON;let Te=class{constructor(sn){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.V,this.length=sn.length,this._features=sn}feature(sn){return new class{constructor(sn){this._feature=sn,this.extent=s.V,this.type=sn.type,this.properties=sn.tags,"id"in sn&&!isNaN(sn.id)&&(this.id=parseInt(sn.id,10))}loadGeometry(){if(1===this._feature.type){const sn=[];for(const me of this._feature.geometry)sn.push([new s.P(me[0],me[1])]);return sn}{const sn=[];for(const me of this._feature.geometry){const He=[];for(const it of me)He.push(new s.P(it[0],it[1]));sn.push(He)}return sn}}toGeoJSON(sn,me,He){return Vn.call(this,sn,me,He)}}(this._features[sn])}};var _t={exports:{}},Ue=s.dN,Ye=s.dM.VectorTileFeature,Pt=je;function je(sn,me){this.options=me||{},this.features=sn,this.length=sn.length}function Ze(sn,me){this.id="number"==typeof sn.id?sn.id:void 0,this.type=sn.type,this.rawGeometry=1===sn.type?[sn.geometry]:sn.geometry,this.properties=sn.tags,this.extent=me||4096}je.prototype.feature=function(sn){return new Ze(this.features[sn],this.options.extent)},Ze.prototype.loadGeometry=function(){var sn=this.rawGeometry;this.geometry=[];for(var me=0;me<sn.length;me++){for(var He=sn[me],it=[],zt=0;zt<He.length;zt++)it.push(new Ue(He[zt][0],He[zt][1]));this.geometry.push(it)}return this.geometry},Ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var sn=this.geometry,me=1/0,He=-1/0,it=1/0,zt=-1/0,At=0;At<sn.length;At++)for(var It=sn[At],Hn=0;Hn<It.length;Hn++){var Qt=It[Hn];me=Math.min(me,Qt.x),He=Math.max(He,Qt.x),it=Math.min(it,Qt.y),zt=Math.max(zt,Qt.y)}return[me,it,He,zt]},Ze.prototype.toGeoJSON=Ye.prototype.toGeoJSON;var ot=s.dO,pt=Pt;function Ot(sn){var me=new ot;return function(He,it){for(var zt in He.layers)it.writeMessage(3,Xt,He.layers[zt])}(sn,me),me.finish()}function Xt(sn,me){var He;me.writeVarintField(15,sn.version||1),me.writeStringField(1,sn.name||""),me.writeVarintField(5,sn.extent||4096);var it={keys:[],values:[],keycache:{},valuecache:{}};for(He=0;He<sn.length;He++)it.feature=sn.feature(He),me.writeMessage(2,Mi,it);var zt=it.keys;for(He=0;He<zt.length;He++)me.writeStringField(3,zt[He]);var At=it.values;for(He=0;He<At.length;He++)me.writeMessage(4,xt,At[He])}function Mi(sn,me){var He=sn.feature;void 0!==He.id&&me.writeVarintField(1,He.id),me.writeMessage(2,Wi,sn),me.writeVarintField(3,He.type),me.writeMessage(4,rt,He)}function Wi(sn,me){var He=sn.feature,it=sn.keys,zt=sn.values,At=sn.keycache,It=sn.valuecache;for(var Hn in He.properties){var Qt=He.properties[Hn],$n=At[Hn];if(null!==Qt){void 0===$n&&(it.push(Hn),At[Hn]=$n=it.length-1),me.writeVarint($n);var Wn=typeof Qt;"string"!==Wn&&"boolean"!==Wn&&"number"!==Wn&&(Qt=JSON.stringify(Qt));var Zn=Wn+":"+Qt,Fi=It[Zn];void 0===Fi&&(zt.push(Qt),It[Zn]=Fi=zt.length-1),me.writeVarint(Fi)}}}function ti(sn,me){return(me<<3)+(7&sn)}function Tn(sn){return sn<<1^sn>>31}function rt(sn,me){for(var He=sn.loadGeometry(),it=sn.type,zt=0,At=0,It=He.length,Hn=0;Hn<It;Hn++){var Qt=He[Hn],$n=1;1===it&&($n=Qt.length),me.writeVarint(ti(1,$n));for(var Wn=3===it?Qt.length-1:Qt.length,Zn=0;Zn<Wn;Zn++){1===Zn&&1!==it&&me.writeVarint(ti(2,Wn-1));var Fi=Qt[Zn].x-zt,Hi=Qt[Zn].y-At;me.writeVarint(Tn(Fi)),me.writeVarint(Tn(Hi)),zt+=Fi,At+=Hi}3===it&&me.writeVarint(ti(7,1))}}function xt(sn,me){var He=typeof sn;"string"===He?me.writeStringField(1,sn):"boolean"===He?me.writeBooleanField(7,sn):"number"===He&&(sn%1!=0?me.writeDoubleField(3,sn):sn<0?me.writeSVarintField(6,sn):me.writeVarintField(5,sn))}_t.exports=Ot,_t.exports.fromVectorTileJs=Ot,_t.exports.fromGeojsonVt=function(sn,me){me=me||{};var He={};for(var it in sn)He[it]=new pt(sn[it].features,me),He[it].name=it,He[it].version=me.version,He[it].extent=me.extent;return Ot({layers:He})},_t.exports.GeoJSONWrapper=pt;var ht=s.dK(_t.exports);const st={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:sn=>sn},Ne=Math.fround||(Pe=new Float32Array(1),sn=>(Pe[0]=+sn,Pe[0]));var Pe;const Ke=3,Bt=5,mi=6;class Di{constructor(me){this.options=Object.assign(Object.create(st),me),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(me){const{log:He,minZoom:it,maxZoom:zt}=this.options;He&&console.time("total time");const At=`prepare ${me.length} points`;He&&console.time(At),this.points=me;const It=[];for(let Qt=0;Qt<me.length;Qt++){const $n=me[Qt];if(!$n.geometry)continue;const[Wn,Zn]=$n.geometry.coordinates,Fi=Ne(Br(Wn)),Hi=Ne(Hr(Zn));It.push(Fi,Hi,1/0,Qt,-1,1),this.options.reduce&&It.push(0)}let Hn=this.trees[zt+1]=this._createTree(It);He&&console.timeEnd(At);for(let Qt=zt;Qt>=it;Qt--){const $n=+Date.now();Hn=this.trees[Qt]=this._createTree(this._cluster(Hn,Qt)),He&&console.log("z%d: %d clusters in %dms",Qt,Hn.numItems,+Date.now()-$n)}return He&&console.timeEnd("total time"),this}getClusters(me,He){let it=((me[0]+180)%360+360)%360-180;const zt=Math.max(-90,Math.min(90,me[1]));let At=180===me[2]?180:((me[2]+180)%360+360)%360-180;const It=Math.max(-90,Math.min(90,me[3]));if(me[2]-me[0]>=360)it=-180,At=180;else if(it>At){const Zn=this.getClusters([it,zt,180,It],He),Fi=this.getClusters([-180,zt,At,It],He);return Zn.concat(Fi)}const Hn=this.trees[this._limitZoom(He)],Qt=Hn.range(Br(it),Hr(It),Br(At),Hr(zt)),$n=Hn.data,Wn=[];for(const Zn of Qt){const Fi=this.stride*Zn;Wn.push($n[Fi+Bt]>1?Ii($n,Fi,this.clusterProps):this.points[$n[Fi+Ke]])}return Wn}getChildren(me){const He=this._getOriginId(me),it=this._getOriginZoom(me),zt="No cluster with the specified id.",At=this.trees[it];if(!At)throw new Error(zt);const It=At.data;if(He*this.stride>=It.length)throw new Error(zt);const Hn=this.options.radius/(this.options.extent*Math.pow(2,it-1)),Qt=At.within(It[He*this.stride],It[He*this.stride+1],Hn),$n=[];for(const Wn of Qt){const Zn=Wn*this.stride;It[Zn+4]===me&&$n.push(It[Zn+Bt]>1?Ii(It,Zn,this.clusterProps):this.points[It[Zn+Ke]])}if(0===$n.length)throw new Error(zt);return $n}getLeaves(me,He,it){const zt=[];return this._appendLeaves(zt,me,He=He||10,it=it||0,0),zt}getTile(me,He,it){const zt=this.trees[this._limitZoom(me)],At=Math.pow(2,me),{extent:It,radius:Hn}=this.options,Qt=Hn/It,$n=(it-Qt)/At,Wn=(it+1+Qt)/At,Zn={features:[]};return this._addTileFeatures(zt.range((He-Qt)/At,$n,(He+1+Qt)/At,Wn),zt.data,He,it,At,Zn),0===He&&this._addTileFeatures(zt.range(1-Qt/At,$n,1,Wn),zt.data,At,it,At,Zn),He===At-1&&this._addTileFeatures(zt.range(0,$n,Qt/At,Wn),zt.data,-1,it,At,Zn),Zn.features.length?Zn:null}getClusterExpansionZoom(me){let He=this._getOriginZoom(me)-1;for(;He<=this.options.maxZoom;){const it=this.getChildren(me);if(He++,1!==it.length)break;me=it[0].properties.cluster_id}return He}_appendLeaves(me,He,it,zt,At){const It=this.getChildren(He);for(const Hn of It){const Qt=Hn.properties;if(Qt&&Qt.cluster?At+Qt.point_count<=zt?At+=Qt.point_count:At=this._appendLeaves(me,Qt.cluster_id,it,zt,At):At<zt?At++:me.push(Hn),me.length===it)break}return At}_createTree(me){const He=new s.bg(me.length/this.stride|0,this.options.nodeSize,Float32Array);for(let it=0;it<me.length;it+=this.stride)He.add(me[it],me[it+1]);return He.finish(),He.data=me,He}_addTileFeatures(me,He,it,zt,At,It){for(const Hn of me){const Qt=Hn*this.stride,$n=He[Qt+Bt]>1;let Wn,Zn,Fi;if($n)Wn=Gi(He,Qt,this.clusterProps),Zn=He[Qt],Fi=He[Qt+1];else{const Ti=this.points[He[Qt+Ke]];Wn=Ti.properties;const[hr,ri]=Ti.geometry.coordinates;Zn=Br(hr),Fi=Hr(ri)}const Hi={type:1,geometry:[[Math.round(this.options.extent*(Zn*At-it)),Math.round(this.options.extent*(Fi*At-zt))]],tags:Wn};let Xr;Xr=$n||this.options.generateId?He[Qt+Ke]:this.points[He[Qt+Ke]].id,void 0!==Xr&&(Hi.id=Xr),It.features.push(Hi)}}_limitZoom(me){return Math.max(this.options.minZoom,Math.min(Math.floor(+me),this.options.maxZoom+1))}_cluster(me,He){const{radius:it,extent:zt,reduce:At,minPoints:It}=this.options,Hn=it/(zt*Math.pow(2,He)),Qt=me.data,$n=[],Wn=this.stride;for(let Zn=0;Zn<Qt.length;Zn+=Wn){if(Qt[Zn+2]<=He)continue;Qt[Zn+2]=He;const Fi=Qt[Zn],Hi=Qt[Zn+1],Xr=me.within(Qt[Zn],Qt[Zn+1],Hn),Ti=Qt[Zn+Bt];let hr=Ti;for(const ri of Xr){const Qi=ri*Wn;Qt[Qi+2]>He&&(hr+=Qt[Qi+Bt])}if(hr>Ti&&hr>=It){let ri,Qi=Fi*Ti,Ir=Hi*Ti,cn=-1;const Be=(Zn/Wn<<5)+(He+1)+this.points.length;for(const Tt of Xr){const In=Tt*Wn;if(Qt[In+2]<=He)continue;Qt[In+2]=He;const vn=Qt[In+Bt];Qi+=Qt[In]*vn,Ir+=Qt[In+1]*vn,Qt[In+4]=Be,At&&(ri||(ri=this._map(Qt,Zn,!0),cn=this.clusterProps.length,this.clusterProps.push(ri)),At(ri,this._map(Qt,In)))}Qt[Zn+4]=Be,$n.push(Qi/hr,Ir/hr,1/0,Be,-1,hr),At&&$n.push(cn)}else{for(let ri=0;ri<Wn;ri++)$n.push(Qt[Zn+ri]);if(hr>1)for(const ri of Xr){const Qi=ri*Wn;if(!(Qt[Qi+2]<=He)){Qt[Qi+2]=He;for(let Ir=0;Ir<Wn;Ir++)$n.push(Qt[Qi+Ir])}}}}return $n}_getOriginId(me){return me-this.points.length>>5}_getOriginZoom(me){return(me-this.points.length)%32}_map(me,He,it){if(me[He+Bt]>1){const It=this.clusterProps[me[He+mi]];return it?Object.assign({},It):It}const zt=this.points[me[He+Ke]].properties,At=this.options.map(zt);return it&&At===zt?Object.assign({},At):At}}function Ii(sn,me,He){return{type:"Feature",id:sn[me+Ke],properties:Gi(sn,me,He),geometry:{type:"Point",coordinates:[(it=sn[me],360*(it-.5)),Ur(sn[me+1])]}};var it}function Gi(sn,me,He){const it=sn[me+Bt],zt=it>=1e4?`${Math.round(it/1e3)}k`:it>=1e3?Math.round(it/100)/10+"k":it,At=sn[me+mi],It=-1===At?{}:Object.assign({},He[At]);return Object.assign(It,{cluster:!0,cluster_id:sn[me+Ke],point_count:it,point_count_abbreviated:zt})}function Br(sn){return sn/360+.5}function Hr(sn){const me=Math.sin(sn*Math.PI/180),He=.5-.25*Math.log((1+me)/(1-me))/Math.PI;return He<0?0:He>1?1:He}function Ur(sn){const me=(180-360*sn)*Math.PI/180;return 360*Math.atan(Math.exp(me))/Math.PI-90}var Si={exports:{}};Si.exports=function(){function sn(kt,Ht,an,_n){for(var qe,Ge=_n,ye=an-Ht>>1,ke=an-Ht,J=kt[Ht],_e=kt[Ht+1],Se=kt[an],at=kt[an+1],St=Ht+3;St<an;St+=3){var nn=me(kt[St],kt[St+1],J,_e,Se,at);if(nn>Ge)qe=St,Ge=nn;else if(nn===Ge){var bn=Math.abs(St-ye);bn<ke&&(qe=St,ke=bn)}}Ge>_n&&(qe-Ht>3&&sn(kt,Ht,qe,_n),kt[qe+2]=Ge,an-qe>3&&sn(kt,qe,an,_n))}function me(kt,Ht,an,_n,qe,Ge){var ye=qe-an,ke=Ge-_n;if(0!==ye||0!==ke){var J=((kt-an)*ye+(Ht-_n)*ke)/(ye*ye+ke*ke);J>1?(an=qe,_n=Ge):J>0&&(an+=ye*J,_n+=ke*J)}return(ye=kt-an)*ye+(ke=Ht-_n)*ke}function He(kt,Ht,an,_n){var qe={id:void 0===kt?null:kt,type:Ht,geometry:an,tags:_n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var ye=Ge.geometry,ke=Ge.type;if("Point"===ke||"MultiPoint"===ke||"LineString"===ke)it(Ge,ye);else if("Polygon"===ke||"MultiLineString"===ke)for(var J=0;J<ye.length;J++)it(Ge,ye[J]);else if("MultiPolygon"===ke)for(J=0;J<ye.length;J++)for(var _e=0;_e<ye[J].length;_e++)it(Ge,ye[J][_e])}(qe),qe}function it(kt,Ht){for(var an=0;an<Ht.length;an+=3)kt.minX=Math.min(kt.minX,Ht[an]),kt.minY=Math.min(kt.minY,Ht[an+1]),kt.maxX=Math.max(kt.maxX,Ht[an]),kt.maxY=Math.max(kt.maxY,Ht[an+1])}function zt(kt,Ht,an,_n){if(Ht.geometry){var qe=Ht.geometry.coordinates,Ge=Ht.geometry.type,ye=Math.pow(an.tolerance/((1<<an.maxZoom)*an.extent),2),ke=[],J=Ht.id;if(an.promoteId?J=Ht.properties[an.promoteId]:an.generateId&&(J=_n||0),"Point"===Ge)At(qe,ke);else if("MultiPoint"===Ge)for(var _e=0;_e<qe.length;_e++)At(qe[_e],ke);else if("LineString"===Ge)It(qe,ke,ye,!1);else if("MultiLineString"===Ge){if(an.lineMetrics){for(_e=0;_e<qe.length;_e++)It(qe[_e],ke=[],ye,!1),kt.push(He(J,"LineString",ke,Ht.properties));return}Hn(qe,ke,ye,!1)}else if("Polygon"===Ge)Hn(qe,ke,ye,!0);else{if("MultiPolygon"!==Ge){if("GeometryCollection"===Ge){for(_e=0;_e<Ht.geometry.geometries.length;_e++)zt(kt,{id:J,geometry:Ht.geometry.geometries[_e],properties:Ht.properties},an,_n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<qe.length;_e++){var Se=[];Hn(qe[_e],Se,ye,!0),ke.push(Se)}}kt.push(He(J,Ge,ke,Ht.properties))}}function At(kt,Ht){Ht.push(Qt(kt[0])),Ht.push($n(kt[1])),Ht.push(0)}function It(kt,Ht,an,_n){for(var qe,Ge,ye=0,ke=0;ke<kt.length;ke++){var J=Qt(kt[ke][0]),_e=$n(kt[ke][1]);Ht.push(J),Ht.push(_e),Ht.push(0),ke>0&&(ye+=_n?(qe*_e-J*Ge)/2:Math.sqrt(Math.pow(J-qe,2)+Math.pow(_e-Ge,2))),qe=J,Ge=_e}var Se=Ht.length-3;Ht[2]=1,sn(Ht,0,Se,an),Ht[Se+2]=1,Ht.size=Math.abs(ye),Ht.start=0,Ht.end=Ht.size}function Hn(kt,Ht,an,_n){for(var qe=0;qe<kt.length;qe++){var Ge=[];It(kt[qe],Ge,an,_n),Ht.push(Ge)}}function Qt(kt){return kt/360+.5}function $n(kt){var Ht=Math.sin(kt*Math.PI/180),an=.5-.25*Math.log((1+Ht)/(1-Ht))/Math.PI;return an<0?0:an>1?1:an}function Wn(kt,Ht,an,_n,qe,Ge,ye,ke){if(_n/=Ht,Ge>=(an/=Ht)&&ye<_n)return kt;if(ye<an||Ge>=_n)return null;for(var J=[],_e=0;_e<kt.length;_e++){var Se=kt[_e],at=Se.geometry,St=Se.type,nn=0===qe?Se.minX:Se.minY,bn=0===qe?Se.maxX:Se.maxY;if(nn>=an&&bn<_n)J.push(Se);else if(!(bn<an||nn>=_n)){var Dn=[];if("Point"===St||"MultiPoint"===St)Zn(at,Dn,an,_n,qe);else if("LineString"===St)Fi(at,Dn,an,_n,qe,!1,ke.lineMetrics);else if("MultiLineString"===St)Xr(at,Dn,an,_n,qe,!1);else if("Polygon"===St)Xr(at,Dn,an,_n,qe,!0);else if("MultiPolygon"===St)for(var Nn=0;Nn<at.length;Nn++){var Ei=[];Xr(at[Nn],Ei,an,_n,qe,!0),Ei.length&&Dn.push(Ei)}if(Dn.length){if(ke.lineMetrics&&"LineString"===St){for(Nn=0;Nn<Dn.length;Nn++)J.push(He(Se.id,St,Dn[Nn],Se.tags));continue}"LineString"!==St&&"MultiLineString"!==St||(1===Dn.length?(St="LineString",Dn=Dn[0]):St="MultiLineString"),"Point"!==St&&"MultiPoint"!==St||(St=3===Dn.length?"Point":"MultiPoint"),J.push(He(Se.id,St,Dn,Se.tags))}}}return J.length?J:null}function Zn(kt,Ht,an,_n,qe){for(var Ge=0;Ge<kt.length;Ge+=3){var ye=kt[Ge+qe];ye>=an&&ye<=_n&&(Ht.push(kt[Ge]),Ht.push(kt[Ge+1]),Ht.push(kt[Ge+2]))}}function Fi(kt,Ht,an,_n,qe,Ge,ye){for(var ke,J,_e=Hi(kt),Se=0===qe?hr:ri,at=kt.start,St=0;St<kt.length-3;St+=3){var nn=kt[St],bn=kt[St+1],Dn=kt[St+2],Nn=kt[St+3],Ei=kt[St+4],si=0===qe?nn:bn,er=0===qe?Nn:Ei,rs=!1;ye&&(ke=Math.sqrt(Math.pow(nn-Nn,2)+Math.pow(bn-Ei,2))),si<an?er>an&&(J=Se(_e,nn,bn,Nn,Ei,an),ye&&(_e.start=at+ke*J)):si>_n?er<_n&&(J=Se(_e,nn,bn,Nn,Ei,_n),ye&&(_e.start=at+ke*J)):Ti(_e,nn,bn,Dn),er<an&&si>=an&&(J=Se(_e,nn,bn,Nn,Ei,an),rs=!0),er>_n&&si<=_n&&(J=Se(_e,nn,bn,Nn,Ei,_n),rs=!0),!Ge&&rs&&(ye&&(_e.end=at+ke*J),Ht.push(_e),_e=Hi(kt)),ye&&(at+=ke)}var Er=kt.length-3;nn=kt[Er],bn=kt[Er+1],Dn=kt[Er+2],(si=0===qe?nn:bn)>=an&&si<=_n&&Ti(_e,nn,bn,Dn),Er=_e.length-3,Ge&&Er>=3&&(_e[Er]!==_e[0]||_e[Er+1]!==_e[1])&&Ti(_e,_e[0],_e[1],_e[2]),_e.length&&Ht.push(_e)}function Hi(kt){var Ht=[];return Ht.size=kt.size,Ht.start=kt.start,Ht.end=kt.end,Ht}function Xr(kt,Ht,an,_n,qe,Ge){for(var ye=0;ye<kt.length;ye++)Fi(kt[ye],Ht,an,_n,qe,Ge,!1)}function Ti(kt,Ht,an,_n){kt.push(Ht),kt.push(an),kt.push(_n)}function hr(kt,Ht,an,_n,qe,Ge){var ye=(Ge-Ht)/(_n-Ht);return kt.push(Ge),kt.push(an+(qe-an)*ye),kt.push(1),ye}function ri(kt,Ht,an,_n,qe,Ge){var ye=(Ge-an)/(qe-an);return kt.push(Ht+(_n-Ht)*ye),kt.push(Ge),kt.push(1),ye}function Qi(kt,Ht){for(var an=[],_n=0;_n<kt.length;_n++){var qe,Ge=kt[_n],ye=Ge.type;if("Point"===ye||"MultiPoint"===ye||"LineString"===ye)qe=Ir(Ge.geometry,Ht);else if("MultiLineString"===ye||"Polygon"===ye){qe=[];for(var ke=0;ke<Ge.geometry.length;ke++)qe.push(Ir(Ge.geometry[ke],Ht))}else if("MultiPolygon"===ye)for(qe=[],ke=0;ke<Ge.geometry.length;ke++){for(var J=[],_e=0;_e<Ge.geometry[ke].length;_e++)J.push(Ir(Ge.geometry[ke][_e],Ht));qe.push(J)}an.push(He(Ge.id,ye,qe,Ge.tags))}return an}function Ir(kt,Ht){var an=[];an.size=kt.size,void 0!==kt.start&&(an.start=kt.start,an.end=kt.end);for(var _n=0;_n<kt.length;_n+=3)an.push(kt[_n]+Ht,kt[_n+1],kt[_n+2]);return an}function cn(kt,Ht){if(kt.transformed)return kt;var an,_n,qe,Ge=1<<kt.z,ye=kt.x,ke=kt.y;for(an=0;an<kt.features.length;an++){var J=kt.features[an],_e=J.geometry,Se=J.type;if(J.geometry=[],1===Se)for(_n=0;_n<_e.length;_n+=2)J.geometry.push(Be(_e[_n],_e[_n+1],Ht,Ge,ye,ke));else for(_n=0;_n<_e.length;_n++){var at=[];for(qe=0;qe<_e[_n].length;qe+=2)at.push(Be(_e[_n][qe],_e[_n][qe+1],Ht,Ge,ye,ke));J.geometry.push(at)}}return kt.transformed=!0,kt}function Be(kt,Ht,an,_n,qe,Ge){return[Math.round(an*(kt*_n-qe)),Math.round(an*(Ht*_n-Ge))]}function Tt(kt,Ht,an,_n,qe){for(var Ge=Ht===qe.maxZoom?0:qe.tolerance/((1<<Ht)*qe.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:an,y:_n,z:Ht,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<kt.length;ke++){ye.numFeatures++,In(ye,kt[ke],Ge,qe);var J=kt[ke].minX,_e=kt[ke].minY,Se=kt[ke].maxX,at=kt[ke].maxY;J<ye.minX&&(ye.minX=J),_e<ye.minY&&(ye.minY=_e),Se>ye.maxX&&(ye.maxX=Se),at>ye.maxY&&(ye.maxY=at)}return ye}function In(kt,Ht,an,_n){var qe=Ht.geometry,Ge=Ht.type,ye=[];if("Point"===Ge||"MultiPoint"===Ge)for(var ke=0;ke<qe.length;ke+=3)ye.push(qe[ke]),ye.push(qe[ke+1]),kt.numPoints++,kt.numSimplified++;else if("LineString"===Ge)vn(ye,qe,kt,an,!1,!1);else if("MultiLineString"===Ge||"Polygon"===Ge)for(ke=0;ke<qe.length;ke++)vn(ye,qe[ke],kt,an,"Polygon"===Ge,0===ke);else if("MultiPolygon"===Ge)for(var J=0;J<qe.length;J++){var _e=qe[J];for(ke=0;ke<_e.length;ke++)vn(ye,_e[ke],kt,an,!0,0===ke)}if(ye.length){var Se=Ht.tags||null;if("LineString"===Ge&&_n.lineMetrics){for(var at in Se={},Ht.tags)Se[at]=Ht.tags[at];Se.mapbox_clip_start=qe.start/qe.size,Se.mapbox_clip_end=qe.end/qe.size}var St={geometry:ye,type:"Polygon"===Ge||"MultiPolygon"===Ge?3:"LineString"===Ge||"MultiLineString"===Ge?2:1,tags:Se};null!==Ht.id&&(St.id=Ht.id),kt.features.push(St)}}function vn(kt,Ht,an,_n,qe,Ge){var ye=_n*_n;if(_n>0&&Ht.size<(qe?ye:_n))an.numPoints+=Ht.length/3;else{for(var ke=[],J=0;J<Ht.length;J+=3)(0===_n||Ht[J+2]>ye)&&(an.numSimplified++,ke.push(Ht[J]),ke.push(Ht[J+1])),an.numPoints++;qe&&function(_e,Se){for(var at=0,St=0,nn=_e.length,bn=nn-2;St<nn;bn=St,St+=2)at+=(_e[St]-_e[bn])*(_e[St+1]+_e[bn+1]);if(at>0===Se)for(St=0,nn=_e.length;St<nn/2;St+=2){var Dn=_e[St],Nn=_e[St+1];_e[St]=_e[nn-2-St],_e[St+1]=_e[nn-1-St],_e[nn-2-St]=Dn,_e[nn-1-St]=Nn}}(ke,Ge),kt.push(ke)}}function ei(kt,Ht){var an=(Ht=this.options=function(qe,Ge){for(var ye in Ge)qe[ye]=Ge[ye];return qe}(Object.create(this.options),Ht)).debug;if(an&&console.time("preprocess data"),Ht.maxZoom<0||Ht.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ht.promoteId&&Ht.generateId)throw new Error("promoteId and generateId cannot be used together.");var qe,Ge,ye,ke,J,_e,_n=function(qe,Ge){var ye=[];if("FeatureCollection"===qe.type)for(var ke=0;ke<qe.features.length;ke++)zt(ye,qe.features[ke],Ge,ke);else zt(ye,"Feature"===qe.type?qe:{geometry:qe},Ge);return ye}(kt,Ht);this.tiles={},this.tileCoords=[],an&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ht.indexMaxZoom,Ht.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(qe=_n,Ge=Ht,ye=Ge.buffer/Ge.extent,ke=qe,J=Wn(qe,1,-1-ye,ye,0,-1,2,Ge),_e=Wn(qe,1,1-ye,2+ye,0,-1,2,Ge),(J||_e)&&(ke=Wn(qe,1,-ye,1+ye,0,-1,2,Ge)||[],J&&(ke=Qi(J,1).concat(ke)),_e&&(ke=ke.concat(Qi(_e,-1)))),_n=ke).length&&this.splitTile(_n,0,0,0),an&&(_n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Oi(kt,Ht,an){return 32*((1<<kt)*an+Ht)+kt}return ei.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ei.prototype.splitTile=function(kt,Ht,an,_n,qe,Ge,ye){for(var ke=[kt,Ht,an,_n],J=this.options,_e=J.debug;ke.length;){_n=ke.pop(),an=ke.pop(),Ht=ke.pop(),kt=ke.pop();var Se=1<<Ht,at=Oi(Ht,an,_n),St=this.tiles[at];if(!St&&(_e>1&&console.time("creation"),St=this.tiles[at]=Tt(kt,Ht,an,_n,J),this.tileCoords.push({z:Ht,x:an,y:_n}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ht,an,_n,St.numFeatures,St.numPoints,St.numSimplified),console.timeEnd("creation"));var nn="z"+Ht;this.stats[nn]=(this.stats[nn]||0)+1,this.total++}if(St.source=kt,qe){if(Ht===J.maxZoom||Ht===qe)continue;var bn=1<<qe-Ht;if(an!==Math.floor(Ge/bn)||_n!==Math.floor(ye/bn))continue}else if(Ht===J.indexMaxZoom||St.numPoints<=J.indexMaxPoints)continue;if(St.source=null,0!==kt.length){_e>1&&console.time("clipping");var Dn,Nn,Ei,si,er,rs,Er=.5*J.buffer/J.extent,zs=.5-Er,Qs=.5+Er,zr=1+Er;Dn=Nn=Ei=si=null,er=Wn(kt,Se,an-Er,an+Qs,0,St.minX,St.maxX,J),rs=Wn(kt,Se,an+zs,an+zr,0,St.minX,St.maxX,J),kt=null,er&&(Dn=Wn(er,Se,_n-Er,_n+Qs,1,St.minY,St.maxY,J),Nn=Wn(er,Se,_n+zs,_n+zr,1,St.minY,St.maxY,J),er=null),rs&&(Ei=Wn(rs,Se,_n-Er,_n+Qs,1,St.minY,St.maxY,J),si=Wn(rs,Se,_n+zs,_n+zr,1,St.minY,St.maxY,J),rs=null),_e>1&&console.timeEnd("clipping"),ke.push(Dn||[],Ht+1,2*an,2*_n),ke.push(Nn||[],Ht+1,2*an,2*_n+1),ke.push(Ei||[],Ht+1,2*an+1,2*_n),ke.push(si||[],Ht+1,2*an+1,2*_n+1)}}},ei.prototype.getTile=function(kt,Ht,an){var _n=this.options,qe=_n.extent,Ge=_n.debug;if(kt<0||kt>24)return null;var ye=1<<kt,ke=Oi(kt,Ht=(Ht%ye+ye)%ye,an);if(this.tiles[ke])return cn(this.tiles[ke],qe);Ge>1&&console.log("drilling down to z%d-%d-%d",kt,Ht,an);for(var J,_e=kt,Se=Ht,at=an;!J&&_e>0;)_e--,Se=Math.floor(Se/2),at=Math.floor(at/2),J=this.tiles[Oi(_e,Se,at)];return J&&J.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",_e,Se,at),Ge>1&&console.time("drilling down"),this.splitTile(J.source,_e,Se,at,kt,Ht,an),Ge>1&&console.timeEnd("drilling down"),this.tiles[ke]?cn(this.tiles[ke],qe):null):null},function(kt,Ht){return new ei(kt,Ht)}}();var Xi=s.dK(Si.exports);function Rs(sn,me){const He=sn.tileID.canonical;if(!this._geoJSONIndex)return me(null,null);const it=this._geoJSONIndex.getTile(He.z,He.x,He.y);if(!it)return me(null,null);const zt=new Te(it.features);let At=ht(zt);0===At.byteOffset&&At.byteLength===At.buffer.byteLength||(At=new Uint8Array(At)),me(null,{vectorTile:zt,rawData:At.buffer})}class $r extends Kn{constructor(me,He,it,zt,At,It){super(me,He,it,zt,Rs,It),At&&(this.loadGeoJSON=At)}loadData(me,He){const it=me&&me.request,zt=it&&it.collectResourceTiming;this.loadGeoJSON(me,(At,It)=>{if(At||!It)return He(At);if("object"!=typeof It)return He(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`));{hn(It,!0);try{if(me.filter){const Qt=s.r(me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Qt.result)throw new Error(Qt.value.map(Wn=>`${Wn.key}: ${Wn.message}`).join(", "));It={type:"FeatureCollection",features:It.features.filter(Wn=>Qt.value.evaluate({zoom:0},Wn))}}this._geoJSONIndex=me.cluster?new Di(function({superclusterOptions:Qt,clusterProperties:$n}){if(!$n||!Qt)return Qt;const Wn={},Zn={},Fi={accumulated:null,zoom:0},Hi={properties:null},Xr=Object.keys($n);for(const Ti of Xr){const[hr,ri]=$n[Ti],Qi=s.r(ri),Ir=s.r("string"==typeof hr?[hr,["accumulated"],["get",Ti]]:hr);Wn[Ti]=Qi.value,Zn[Ti]=Ir.value}return Qt.map=Ti=>{Hi.properties=Ti;const hr={};for(const ri of Xr)hr[ri]=Wn[ri].evaluate(Fi,Hi);return hr},Qt.reduce=(Ti,hr)=>{Hi.properties=hr;for(const ri of Xr)Fi.accumulated=Ti[ri],Ti[ri]=Zn[ri].evaluate(Fi,Hi)},Qt}(me)).load(It.features):Xi(It,me.geojsonVtOptions)}catch(Qt){return He(Qt)}this.loaded={};const Hn={};if(zt){const Qt=ct(it);Qt&&(Hn.resourceTiming={},Hn.resourceTiming[me.source]=JSON.parse(JSON.stringify(Qt)))}He(null,Hn)}})}reloadTile(me,He){const it=this.loaded;return it&&it[me.uid]?super.reloadTile(me,He):this.loadTile(me,He)}loadGeoJSON(me,He){if(me.request)s.g(me.request,He);else{if("string"!=typeof me.data)return He(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`));try{return He(null,JSON.parse(me.data))}catch{return He(new Error(`Input data given to '${me.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(me,He){try{He(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(it){He(it)}}getClusterChildren(me,He){try{He(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(it){He(it)}}getClusterLeaves(me,He){try{He(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(it){He(it)}}}class Ji{constructor(me,He){this.tileID=new s.am(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),this.tileZoom=me.tileZoom,this.uid=me.uid,this.zoom=me.zoom,this.canonical=me.tileID.canonical,this.pixelRatio=me.pixelRatio,this.tileSize=me.tileSize,this.source=me.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=me.projection,this.brightness=He}parse(me,He,it,zt){this.status="parsing";const At=new s.am(it.tileID.overscaledZ,it.tileID.wrap,it.tileID.canonical.z,it.tileID.canonical.x,it.tileID.canonical.y),It={},Hn=He.familiesBySource[it.source],Qt=new s.dC(At,it.promoteId);return Qt.bucketLayerIDs=[],Qt.is3DTile=!0,s.dP(me).then($n=>{if(!$n)return zt(new Error("Could not parse tile"));const Wn=s.dQ($n,1/s.bR(it.tileID.canonical)),Zn=$n.json.extensionsUsed&&$n.json.extensionsUsed.includes("MAPBOX_mesh_features")||$n.json.asset.extras&&$n.json.asset.extras.MAPBOX_mesh_features,Fi=$n.json.extensionsUsed&&$n.json.extensionsUsed.includes("EXT_meshopt_compression"),Hi=new s.K(this.zoom,{brightness:this.brightness});for(const Xr in Hn)for(const Ti of Hn[Xr]){const hr=Ti[0];Qt.bucketLayerIDs.push(Ti.map(Qi=>Qi.id)),hr.recalculate(Hi,[]);const ri=new s.dR(Wn,At,Zn,Fi,this.brightness,Qt);Zn||(ri.needsUpload=!0),It[hr.fqid]=ri,ri.evaluate(hr)}this.status="done",zt(null,{buckets:It,featureIndex:Qt})}).catch($n=>zt(new Error($n.message)))}}class ir{constructor(me,He,it,zt,At,It){this.actor=me,this.layerIndex=He,this.brightness=It,this.loading={},this.loaded={}}loadTile(me,He){const it=me.uid,zt=this.loading[it]=new Ji(me,this.brightness);s.a_(me.request,(At,It)=>{const Hn=!this.loading[it];return delete this.loading[it],Hn||At?(zt.status="done",Hn||(this.loaded[it]=zt),He(At)):It&&0!==It.byteLength?void zt.parse(It,this.layerIndex,me,(Qt,$n)=>{zt.status="done",this.loaded=this.loaded||{},this.loaded[it]=zt,Qt||!$n?He(Qt):He(null,$n)}):(zt.status="done",this.loaded[it]=zt,He())})}reloadTile(me,He){const it=this.loaded,zt=me.uid;if(it&&it[zt]){const At=it[zt];At.projection=me.projection,At.brightness=me.brightness;const It=(Hn,Qt)=>{At.reloadCallback&&(delete At.reloadCallback,this.loadTile(me,He)),He(Hn,Qt)};"parsing"===At.status?At.reloadCallback=It:"done"===At.status&&this.loadTile(me,He)}}abortTile(me,He){const it=me.uid;this.loading[it]&&delete this.loading[it],He()}removeTile(me,He){const it=this.loaded,zt=me.uid;it&&it[zt]&&delete it[zt],He()}}class jr{constructor(me){this.self=me,this.actor=new s.dS(me,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.bo({name:"mercator"}),this.workerSourceTypes={vector:Kn,geojson:$r,"batched-model":ir},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(He,it)=>{if(this.workerSourceTypes[He])throw new Error(`Worker source with name "${He}" already registered.`);this.workerSourceTypes[He]=it},this.self.registerRTLTextPlugin=He=>{if(s.dT.isParsed())throw new Error("RTL text plugin already registered.");s.dT.applyArabicShaping=He.applyArabicShaping,s.dT.processBidirectionalText=He.processBidirectionalText,s.dT.processStyledBidirectionalText=He.processStyledBidirectionalText}}clearCaches(me,He,it){delete this.layerIndexes[me],delete this.availableImages[me],delete this.workerSources[me],delete this.demWorkerSources[me],delete this.rasterArrayWorkerSource,it()}checkIfReady(me,He,it){it()}setReferrer(me,He){this.referrer=He}spriteLoaded(me,{scope:He,isLoaded:it}){if(this.isSpriteLoaded[me]||(this.isSpriteLoaded[me]={}),this.isSpriteLoaded[me][He]=it,this.workerSources[me]&&this.workerSources[me][He])for(const zt in this.workerSources[me][He]){const At=this.workerSources[me][He][zt];for(const It in At)At[It]instanceof Kn&&(At[It].isSpriteLoaded=it,At[It].fire(new s.b("isSpriteLoaded")))}}setImages(me,{scope:He,images:it},zt){if(this.availableImages[me]||(this.availableImages[me]={}),this.availableImages[me][He]=it,this.workerSources[me]&&this.workerSources[me][He]){for(const At in this.workerSources[me][He]){const It=this.workerSources[me][He][At];for(const Hn in It)It[Hn].availableImages=it}zt()}else zt()}setProjection(me,He){this.projections[me]=s.bo(He)}setBrightness(me,He,it){this.brightness=He,it()}setLayers(me,He,it){this.getLayerIndex(me,He.scope).replace(He.layers,He.options),it()}updateLayers(me,He,it){this.getLayerIndex(me,He.scope).update(He.layers,He.removedIds,He.options),it()}loadTile(me,He,it){He.projection=this.projections[me]||this.defaultProjection,this.getWorkerSource(me,He.type,He.source,He.scope).loadTile(He,it)}loadDEMTile(me,He,it){this.getDEMWorkerSource(me,He.source,He.scope).loadTile(He,it)}decodeRasterArray(me,He,it){this.getRasterArrayWorkerSource().decodeRasterArray(He,it)}reloadTile(me,He,it){He.projection=this.projections[me]||this.defaultProjection,this.getWorkerSource(me,He.type,He.source,He.scope).reloadTile(He,it)}abortTile(me,He,it){this.getWorkerSource(me,He.type,He.source,He.scope).abortTile(He,it)}removeTile(me,He,it){this.getWorkerSource(me,He.type,He.source,He.scope).removeTile(He,it)}removeSource(me,He,it){if(!(this.workerSources[me]&&this.workerSources[me][He.scope]&&this.workerSources[me][He.scope][He.type]&&this.workerSources[me][He.scope][He.type][He.source]))return;const zt=this.workerSources[me][He.scope][He.type][He.source];delete this.workerSources[me][He.scope][He.type][He.source],void 0!==zt.removeSource?zt.removeSource(He,it):it()}loadWorkerSource(me,He,it){try{this.self.importScripts(He.url),it()}catch(zt){it(zt.toString())}}syncRTLPluginState(me,He,it){try{s.dT.setState(He);const zt=s.dT.getPluginURL();if(s.dT.isLoaded()&&!s.dT.isParsed()&&null!=zt){this.self.importScripts(zt);const At=s.dT.isParsed();it(At?void 0:new Error(`RTL Text Plugin failed to import scripts from ${zt}`),At)}}catch(zt){it(zt.toString())}}setDracoUrl(me,He){this.dracoUrl=He}getAvailableImages(me,He){this.availableImages[me]||(this.availableImages[me]={});let it=this.availableImages[me][He];return it||(it=[]),it}getLayerIndex(me,He){this.layerIndexes[me]||(this.layerIndexes[me]={});let it=this.layerIndexes[me][He];return it||(it=this.layerIndexes[me][He]=new qt,it.scope=He),it}getWorkerSource(me,He,it,zt){return this.workerSources[me]||(this.workerSources[me]={}),this.workerSources[me][zt]||(this.workerSources[me][zt]={}),this.workerSources[me][zt][He]||(this.workerSources[me][zt][He]={}),this.isSpriteLoaded[me]||(this.isSpriteLoaded[me]={}),this.workerSources[me][zt][He][it]||(this.workerSources[me][zt][He][it]=new this.workerSourceTypes[He]({send:(It,Hn,Qt,$n,Wn,Zn)=>{this.actor.send(It,Hn,Qt,me,Wn,Zn)},scheduler:this.actor.scheduler},this.getLayerIndex(me,zt),this.getAvailableImages(me,zt),this.isSpriteLoaded[me][zt],void 0,this.brightness)),this.workerSources[me][zt][He][it]}getDEMWorkerSource(me,He,it){return this.demWorkerSources[me]||(this.demWorkerSources[me]={}),this.demWorkerSources[me][it]||(this.demWorkerSources[me][it]={}),this.demWorkerSources[me][it][He]||(this.demWorkerSources[me][it][He]=new Sn),this.demWorkerSources[me][it][He]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new En),this.rasterArrayWorkerSource}enforceCacheSizeLimit(me,He){s.dU(He)}getWorkerPerformanceMetrics(me,He,it){it(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new jr(self)),jr}),De(0,function(s){function ct(h,i){if(Array.isArray(h)){if(!Array.isArray(i)||h.length!==i.length)return!1;for(let o=0;o<h.length;o++)if(!ct(h[o],i[o]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==i){if("object"!=typeof i||Object.keys(h).length!==Object.keys(i).length)return!1;for(const o in h)if(!ct(h[o],i[o]))return!1;return!0}return h===i}var de=Et;function Et(h){return i=h,!(typeof window>"u"||typeof document>"u"||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,m,v=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(v);try{m=new Worker(b),d=!0}catch{d=!1}return m&&m.terminate(),URL.revokeObjectURL(b),d}()||!function(){var d=document.createElement("canvas");d.width=d.height=1;var m=d.getContext("2d");if(!m)return!1;var v=m.getImageData(0,0,1,1);return v&&v.width===d.width}()||(void 0===qt[o=i&&i.failIfMajorPerformanceCaveat]&&(qt[o]=function(d){var m,b,S,z,v=(b=d,S=document.createElement("canvas"),(z=Object.create(Et.webGLContextAttributes)).failIfMajorPerformanceCaveat=b,S.getContext("webgl2",z));if(!v)return!1;try{m=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!m||v.isContextLost())&&(v.shaderSource(m,"void main() {}"),v.compileShader(m),!0===v.getShaderParameter(m,v.COMPILE_STATUS))}(o)),!qt[o]||document.documentMode));var i,o}var qt={};function gt(h,i,o){const d=document.createElement(h);return null!=i&&(d.className=i),o&&o.appendChild(d),d}function jt(h,i,o){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const m of Object.keys(i))d.setAttributeNS(null,m,String(i[m]));return o&&o.appendChild(d),d}Et.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const wt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Gt=wt&&void 0!==wt.userSelect?"userSelect":"WebkitUserSelect";let Kn;function Sn(){wt&&Gt&&(Kn=wt[Gt],wt[Gt]="none")}function En(){wt&&Gt&&(wt[Gt]=Kn)}function dn(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",dn,!0)}function ii(){window.addEventListener("click",dn,!0),window.setTimeout(()=>{window.removeEventListener("click",dn,!0)},0)}function hn(h,i){const o=h.getBoundingClientRect();return Te(h,o,i)}function Vn(h,i){const o=h.getBoundingClientRect(),d=[];for(let m=0;m<i.length;m++)d.push(Te(h,o,i[m]));return d}function hi(h){return void 0!==window.InstallTrigger&&2===h.button&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Te(h,i,o){const d=h.offsetWidth===i.width?1:h.offsetWidth/i.width;return new s.P((o.clientX-i.left)*d,(o.clientY-i.top)*d)}class _t{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,o){this._updatedSourceCaches[i]=o,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const o=i.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(i.id),this.setDirty()}removeLayer(i){const o=i.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][i.id]=i,this._updatedLayers[o].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const o in this._updatedLayers)i[o]=i[o]||{},i[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)i[o]=i[o]||{},i[o].removedIds=Object.keys(this._removedLayers[o]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Ue extends s.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,o){return s.l(this.requestManager.transformRequest(o,s.R.Model).url).then(d=>{if(!d)return;const m=s.c(d),v=new s.M(i,void 0,void 0,m);return v.computeBoundsAndApplyParent(),v}).catch(d=>{this.fire(new s.a(new Error(`Could not load model ${i} from ${o}: ${d.message}`)))})}load(i,o){this.models[o]||(this.models[o]={});const d=Object.keys(i);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+d.length;const m=[];for(const v of d)m.push(this.loadModel(v,i[v]));Promise.allSettled(m).then(v=>{for(let b=0;b<v.length;b++){const{status:S,value:z}=v[b];"fulfilled"===S&&z&&(this.models[o][d[b]]=z)}this.numModelsLoading[o]-=d.length,this.fire(new s.b("data",{dataType:"style"}))}).catch(v=>{this.fire(new s.a(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,o){return!!this.getModel(i,o)}getModel(i,o){return this.models[o]||(this.models[o]={}),this.models[o][i]}addModel(i,o,d){this.models[d]||(this.models[d]={}),this.hasModel(i,d)&&this.removeModel(i,d),this.load({[i]:this.requestManager.normalizeModelURL(o)},d)}addModels(i,o){const d={};for(const m in i)d[m]=this.requestManager.normalizeModelURL(i[m]);this.load(d,o)}removeModel(i,o){this.models[o]||(this.models[o]={});const d=this.models[o][i];delete this.models[o][i],d.destroy()}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,o){this.models[o]||(this.models[o]={});for(const d in this.models[o])this.models[o][d].upload(i.context)}}class Ye{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,d){const m=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},s.e(this.stateChanges[i][m],d),null===this.deletedStates[i]){this.deletedStates[i]={};for(const v in this.state[i])v!==m&&(this.deletedStates[i][v]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][m]){this.deletedStates[i][m]={};for(const v in this.state[i][m])d[v]||(this.deletedStates[i][m][v]=null)}else for(const v in d)this.deletedStates[i]&&this.deletedStates[i][m]&&null===this.deletedStates[i][m][v]&&delete this.deletedStates[i][m][v]}removeFeatureState(i,o,d){if(null===this.deletedStates[i])return;const m=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},d&&void 0!==o)null!==this.deletedStates[i][m]&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][d]=null);else if(void 0!==o)if(this.stateChanges[i]&&this.stateChanges[i][m])for(d in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][d]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,o){const d=String(o),m=s.e({},(this.state[i]||{})[d],(this.stateChanges[i]||{})[d]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const v=this.deletedStates[i][o];if(null===v)return{};for(const b in v)delete m[b]}return m}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),s.e(this.state[m][b],this.stateChanges[m][b]),v[b]=this.state[m][b];d[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(null===this.deletedStates[m])for(const b in this.state[m])v[b]={},this.state[m][b]={};else for(const b in this.deletedStates[m]){if(null===this.deletedStates[m][b])this.state[m][b]={};else if(this.state[m][b])for(const S of Object.keys(this.deletedStates[m][b]))delete this.state[m][b][S];v[b]=this.state[m][b]}d[m]=d[m]||{},s.e(d[m],v)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const m in i)i[m].setFeatureState(d,o)}}function Pt(h){const{userImage:i}=h;return!!(i&&i.render&&i.render())&&(h.data.replace(new Uint8Array(i.data.buffer)),!0)}class je extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new s.h({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,o){if(this.loaded[o]!==i&&(this.loaded[o]=i,i)){for(const{ids:d,callback:m}of this.requestors)this._notify(d,o,m);this.requestors=[]}}hasImage(i,o){return!!this.getImage(i,o)}getImage(i,o){return this.images[o][i]}addImage(i,o,d){this._validate(i,d)&&(this.images[o][i]=d)}_validate(i,o){let d=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "stretchX" value`))),d=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "stretchY" value`))),d=!1),this._validateContent(o.content,o)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "content" value`))),d=!1),d}_validateStretch(i,o){if(!i)return!0;let d=0;for(const m of i){if(m[0]<d||m[1]<m[0]||o<m[1])return!1;d=m[1]}return!0}_validateContent(i,o){return!(i&&(4!==i.length||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o,d){d.version=this.images[o][i].version+1,this.images[o][i]=d,this.updatedImages[o][i]=!0}removeImage(i,o){const d=this.images[o][i];delete this.images[o][i],delete this.patterns[o][i],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,o,d){let m=!0;const v=!!this.loaded[o];if(!v)for(const b of i)this.images[o][b]||(m=!1);v||m?this._notify(i,o,d):this.requestors.push({ids:i,scope:o,callback:d})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,o,d){const m={};for(const v of i){this.images[o][v]||this.fire(new s.b("styleimagemissing",{id:v}));const b=this.images[o][v];b?m[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:s.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,m)}getPixelSize(i){const{width:o,height:d}=this.atlasImage[i];return{width:o,height:d}}getPattern(i,o){const d=this.patterns[o][i],m=this.getImage(i,o);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new s.I(v,m);this.patterns[o][i]={bin:v,position:b}}return this._updatePatternAtlas(o),this.patterns[o][i].position}bind(i,o){const d=i.gl;let m=this.atlasTexture[o];m?this.dirty&&(m.update(this.atlasImage[o]),this.dirty=!1):(m=new s.T(i,this.atlasImage[o],d.RGBA),this.atlasTexture[o]=m),m.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(i){const o=[];for(const b in this.patterns[i])o.push(this.patterns[i][b].bin);const{w:d,h:m}=s.p(o),v=this.atlasImage[i];v.resize({width:d||1,height:m||1});for(const b in this.patterns[i]){const{bin:S}=this.patterns[i][b],z=S.x+1,H=S.y+1,R=this.images[i][b].data,B=R.width,Y=R.height;s.h.copy(R,v,{x:0,y:0},{x:z,y:H},{width:B,height:Y}),s.h.copy(R,v,{x:0,y:Y-1},{x:z,y:H-1},{width:B,height:1}),s.h.copy(R,v,{x:0,y:0},{x:z,y:H+Y},{width:B,height:1}),s.h.copy(R,v,{x:B-1,y:0},{x:z-1,y:H},{width:1,height:Y}),s.h.copy(R,v,{x:0,y:0},{x:z+B,y:H},{width:1,height:Y})}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,o){for(const d of i){if(this.callbackDispatchedThisFrame[o][d])continue;this.callbackDispatchedThisFrame[o][d]=!0;const m=this.images[o][d];Pt(m)&&this.updateImage(d,o,m)}}}class Ze{constructor(i,o,d,m){this.message=(i?`${i}: `:"")+d,m&&(this.identifier=m),null!=o&&o.__line__&&(this.line=o.__line__)}}class ot extends Ze{}function pt(h){const i=h.key,o=h.value,d=h.valueSpec||{},m=h.objectElementValidators||{},v=h.style,b=h.styleSpec;let S=[];const z=s.i(o);if("object"!==z)return[new Ze(i,o,`object expected, ${z} found`)];for(const H in o){const R=H.split(".")[0];let B;m[R]?B=m[R]:d[R]?B=Xi:m["*"]?B=m["*"]:d["*"]&&(B=Xi),B?S=S.concat(B({key:(i&&`${i}.`)+H,value:o[H],valueSpec:d[R]||d["*"],style:v,styleSpec:b,object:o,objectKey:H},o)):S.push(new ot(i,o[H],`unknown property "${H}"`))}for(const H in d)m[H]||d[H].required&&void 0===d[H].default&&void 0===o[H]&&S.push(new Ze(i,o,`missing required property "${H}"`));return S}function Ot(h){const i=h.value,o=h.valueSpec,d=h.style,m=h.styleSpec,v=h.key,b=h.arrayElementValidator||Xi;if("array"!==s.i(i))return[new Ze(v,i,`array expected, ${s.i(i)} found`)];if(o.length&&i.length!==o.length)return[new Ze(v,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new Ze(v,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let S={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};m.$version<7&&(S.function=o.function),"object"===s.i(o.value)&&(S=o.value);let z=[];for(let H=0;H<i.length;H++)z=z.concat(b({array:i,arrayIndex:H,value:i[H],valueSpec:S,style:d,styleSpec:m,key:`${v}[${H}]`},!0));return z}function Xt(h){const i=h.key,o=h.value,d=h.valueSpec;let m=s.i(o);if("number"===m&&o!=o&&(m="NaN"),"number"!==m)return[new Ze(i,o,`number expected, ${m} found`)];if("minimum"in d){let v=d.minimum;if("array"===s.i(d.minimum)&&(v=d.minimum[h.arrayIndex]),o<v)return[new Ze(i,o,`${o} is less than the minimum value ${v}`)]}if("maximum"in d){let v=d.maximum;if("array"===s.i(d.maximum)&&(v=d.maximum[h.arrayIndex]),o>v)return[new Ze(i,o,`${o} is greater than the maximum value ${v}`)]}return[]}function Mi(h){const i=h.valueSpec,o=s.u(h.value.type);let d,m,v,b={};const S="categorical"!==o&&void 0===h.value.property,z=!S,H="array"===s.i(h.value.stops)&&"array"===s.i(h.value.stops[0])&&"object"===s.i(h.value.stops[0][0]),R=pt({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Q){if("identity"===o)return[new Ze(Q.key,Q.value,'identity function may not have a "stops" property')];let le=[];const ce=Q.value;return le=le.concat(Ot({key:Q.key,value:ce,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:B})),"array"===s.i(ce)&&0===ce.length&&le.push(new Ze(Q.key,ce,"array must have at least one stop")),le},default:function(Q){return Xi({key:Q.key,value:Q.value,valueSpec:i,style:Q.style,styleSpec:Q.styleSpec})}}});return"identity"===o&&S&&R.push(new Ze(h.key,h.value,'missing required property "property"')),"identity"===o||h.value.stops||R.push(new Ze(h.key,h.value,'missing required property "stops"')),"exponential"===o&&h.valueSpec.expression&&!s.s(h.valueSpec)&&R.push(new Ze(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(z&&!s.k(h.valueSpec)?R.push(new Ze(h.key,h.value,"property functions not supported")):S&&!s.m(h.valueSpec)&&R.push(new Ze(h.key,h.value,"zoom functions not supported"))),"categorical"!==o&&!H||void 0!==h.value.property||R.push(new Ze(h.key,h.value,'"property" property is required')),R;function B(Q){let le=[];const ce=Q.value,pe=Q.key;if("array"!==s.i(ce))return[new Ze(pe,ce,`array expected, ${s.i(ce)} found`)];if(2!==ce.length)return[new Ze(pe,ce,`array length 2 expected, length ${ce.length} found`)];if(H){if("object"!==s.i(ce[0]))return[new Ze(pe,ce,`object expected, ${s.i(ce[0])} found`)];if(void 0===ce[0].zoom)return[new Ze(pe,ce,"object stop key must have zoom")];if(void 0===ce[0].value)return[new Ze(pe,ce,"object stop key must have value")];const re=s.u(ce[0].zoom);if("number"!=typeof re)return[new Ze(pe,ce[0].zoom,"stop zoom values must be numbers")];if(v&&v>re)return[new Ze(pe,ce[0].zoom,"stop zoom values must appear in ascending order")];re!==v&&(v=re,m=void 0,b={}),le=le.concat(pt({key:`${pe}[0]`,value:ce[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:Xt,value:Y}}))}else le=le.concat(Y({key:`${pe}[0]`,value:ce[0],valueSpec:{},style:Q.style,styleSpec:Q.styleSpec},ce));return s.n(s.o(ce[1]))?le.concat([new Ze(`${pe}[1]`,ce[1],"expressions are not allowed in function stops.")]):le.concat(Xi({key:`${pe}[1]`,value:ce[1],valueSpec:i,style:Q.style,styleSpec:Q.styleSpec}))}function Y(Q,le){const ce=s.i(Q.value),pe=s.u(Q.value),re=null!==Q.value?Q.value:le;if(d){if(ce!==d)return[new Ze(Q.key,re,`${ce} stop domain type must match previous stop domain type ${d}`)]}else d=ce;if("number"!==ce&&"string"!==ce&&"boolean"!==ce&&"number"!=typeof pe&&"string"!=typeof pe&&"boolean"!=typeof pe)return[new Ze(Q.key,re,"stop domain value must be a number, string, or boolean")];if("number"!==ce&&"categorical"!==o){let ve=`number expected, ${ce} found`;return s.k(i)&&void 0===o&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ze(Q.key,re,ve)]}return"categorical"!==o||"number"!==ce||"number"==typeof pe&&isFinite(pe)&&Math.floor(pe)===pe?"categorical"!==o&&"number"===ce&&"number"==typeof pe&&"number"==typeof m&&void 0!==m&&pe<m?[new Ze(Q.key,re,"stop domain values must appear in ascending order")]:(m=pe,"categorical"===o&&pe in b?[new Ze(Q.key,re,"stop domain values must be unique")]:(b[pe]=!0,[])):[new Ze(Q.key,re,`integer expected, found ${String(pe)}`)]}}function Wi(h){const i=("property"===h.expressionContext?s.q:s.r)(s.o(h.value),h.valueSpec);if("error"===i.result)return i.value.map(d=>new Ze(`${h.key}${d.key}`,h.value,d.message));const o=i.value.expression||i.value._styleExpression.expression;if("property"===h.expressionContext&&"text-font"===h.propertyKey&&!o.outputDefined())return[new Ze(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===h.expressionContext&&"layout"===h.propertyType&&!s.t(o))return[new Ze(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===h.expressionContext)return ti(o,h);if(h.expressionContext&&0===h.expressionContext.indexOf("cluster")){if(!s.v(o,["zoom","feature-state"]))return[new Ze(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===h.expressionContext&&!s.x(o))return[new Ze(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ti(h,i){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const m of i.valueSpec.expression.parameters)o.delete(m);if(0===o.size)return[];const d=[];return h instanceof s.C&&o.has(h.name)?[new Ze(i.key,i.value,`["${h.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(h.eachChild(m=>{d.push(...ti(m,i))}),d)}function Tn(h){const i=h.key,o=h.value,d=h.valueSpec,m=[];return Array.isArray(d.values)?-1===d.values.indexOf(s.u(o))&&m.push(new Ze(i,o,`expected one of [${d.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(d.values).indexOf(s.u(o))&&m.push(new Ze(i,o,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(o)} found`)),m}function rt(h){return s.z(s.o(h.value))?Wi(s.j({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):xt(h)}function xt(h){const i=h.value,o=h.key;if("array"!==s.i(i))return[new Ze(o,i,`array expected, ${s.i(i)} found`)];const d=h.styleSpec;let m,v=[];if(i.length<1)return[new Ze(o,i,"filter array must have at least 1 element")];switch(v=v.concat(Tn({key:`${o}[0]`,value:i[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),s.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===s.u(i[1])&&v.push(new Ze(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&v.push(new Ze(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=s.i(i[1]),"string"!==m&&v.push(new Ze(`${o}[1]`,i[1],`string expected, ${m} found`)));for(let b=2;b<i.length;b++)m=s.i(i[b]),"$type"===s.u(i[1])?v=v.concat(Tn({key:`${o}[${b}]`,value:i[b],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&v.push(new Ze(`${o}[${b}]`,i[b],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)v=v.concat(xt({key:`${o}[${b}]`,value:i[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":m=s.i(i[1]),2!==i.length?v.push(new Ze(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==m&&v.push(new Ze(`${o}[1]`,i[1],`string expected, ${m} found`))}return v}function ht(h,i){const o=h.key,d=h.style,m=h.layer,v=h.styleSpec,b=h.value,S=h.objectKey,z=v[`${i}_${h.layerType}`];if(!z)return[];const H=S.match(/^(.*)-transition$/);if("paint"===i&&H&&z[H[1]]&&z[H[1]].transition)return Xi({key:o,value:b,valueSpec:v.transition,style:d,styleSpec:v});const R=h.valueSpec||z[S];if(!R)return[new ot(o,b,`unknown property "${S}"`)];let B;if("string"===s.i(b)&&s.k(R)&&!R.tokens&&(B=/^{([^}]+)}$/.exec(b))){const Q=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new Ze(o,b,`"${S}" does not support interpolation syntax\nUse an identity property function instead: ${Q}.`)]}const Y=[];if("symbol"===h.layerType)"text-field"!==S||!d||d.glyphs||d.imports||Y.push(new Ze(o,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===S&&s.A(s.o(b))&&"identity"===s.u(b.type)&&Y.push(new Ze(o,b,'"text-font" does not support identity functions'));else if("model"===h.layerType&&"paint"===i&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&s.k(R)&&(s.B(R)||s.m(R))){const Q=s.q(s.o(b),R),le=Q.value.expression||Q.value._styleExpression.expression;le&&!s.v(le,["measure-light"])&&("model-emissive-strength"===S&&s.x(le)&&s.t(le)||Y.push(new Ze(o,b,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Y.concat(Xi({key:h.key,value:b,valueSpec:R,style:d,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:S}))}function st(h){return ht(h,"paint")}function Ne(h){return ht(h,"layout")}function Pe(h){let i=[];const o=h.value,d=h.key,m=h.style,v=h.styleSpec;o.type||o.ref||i.push(new Ze(d,o,'either "type" or "ref" is required'));let b=s.u(o.type);const S=s.u(o.ref);if(o.id){const z=s.u(o.id);for(let H=0;H<h.arrayIndex;H++){const R=m.layers[H];s.u(R.id)===z&&i.push(new Ze(d,o.id,`duplicate layer id "${o.id}", previously used at line ${R.id.__line__}`))}}if("ref"in o){let z;["type","source","source-layer","filter","layout"].forEach(H=>{H in o&&i.push(new Ze(d,o[H],`"${H}" is prohibited for ref layers`))}),m.layers.forEach(H=>{s.u(H.id)===S&&(z=H)}),z?z.ref?i.push(new Ze(d,o.ref,"ref cannot reference another ref layer")):b=s.u(z.type):"string"==typeof S&&i.push(new Ze(d,o.ref,`ref layer "${S}" not found`))}else if("background"!==b&&"sky"!==b&&"slot"!==b)if(o.source){const z=m.sources&&m.sources[o.source],H=z&&s.u(z.type);z?"vector"===H&&"raster"===b?i.push(new Ze(d,o.source,`layer "${o.id}" requires a raster source`)):"raster"===H&&"raster"!==b?i.push(new Ze(d,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==H||o["source-layer"]?"raster-dem"===H&&"hillshade"!==b?i.push(new Ze(d,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==H||["raster","raster-particle"].includes(b)?"line"!==b||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||"geojson"===H&&z.lineMetrics?"raster-particle"===b&&"raster-array"!==H&&i.push(new Ze(d,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):i.push(new Ze(d,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Ze(d,o.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new Ze(d,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new Ze(d,o.source,`source "${o.source}" not found`))}else i.push(new Ze(d,o,'missing required property "source"'));return i=i.concat(pt({key:d,value:o,valueSpec:v.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xi({key:`${d}.type`,value:o.type,valueSpec:v.layer.type,style:h.style,styleSpec:h.styleSpec,object:o,objectKey:"type"}),filter:z=>rt(s.j({layerType:b},z)),layout:z=>pt({layer:o,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":H=>Ne(s.j({layerType:b},H))}}),paint:z=>pt({layer:o,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":H=>st(s.j({layerType:b,layer:o},H))}})}})),i}function Ke(h){const i=h.value,o=h.key,d=s.i(i);return"string"!==d?[new Ze(o,i,`string expected, ${d} found`)]:[]}const Bt={promoteId:function({key:h,value:i}){if("string"===s.i(i))return Ke({key:h,value:i});{const o=[];for(const d in i)o.push(...Ke({key:`${h}.${d}`,value:i[d]}));return o}}};function mi(h){const i=h.value,o=h.key,d=h.styleSpec,m=h.style;if(!i.type)return[new Ze(o,i,'"type" is required')];const v=s.u(i.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(i.url||i.tiles||b.push(new ot(o,i,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(pt({key:o,value:i,valueSpec:d[`source_${v.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Bt})),b;case"geojson":if(b=pt({key:o,value:i,valueSpec:d.source_geojson,style:m,styleSpec:d,objectElementValidators:Bt}),i.cluster)for(const S in i.clusterProperties){const[z,H]=i.clusterProperties[S],R="string"==typeof z?[z,["accumulated"],["get",S]]:z;b.push(...Wi({key:`${o}.${S}.map`,value:H,expressionContext:"cluster-map"})),b.push(...Wi({key:`${o}.${S}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return b;case"video":return pt({key:o,value:i,valueSpec:d.source_video,style:m,styleSpec:d});case"image":return pt({key:o,value:i,valueSpec:d.source_image,style:m,styleSpec:d});case"canvas":return[new Ze(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tn({key:`${o}.type`,value:i.type,valueSpec:{values:Di(d)},style:m,styleSpec:d})}}function Di(h){return h.source.reduce((i,o)=>{const d=h[o];return"enum"===d.type.type&&(i=i.concat(Object.keys(d.type.values))),i},[])}function Ii(h){const i=h.value;let o=[];if(!i)return o;const d=s.i(i);return"string"!==d?(o=o.concat([new Ze(h.key,i,`string expected, "${d}" found`)]),o):(function(m){const v=-1===m.indexOf("://");try{return new URL(m,v?"http://example.com":void 0),!0}catch{return!1}}(i)||(o=o.concat([new Ze(h.key,i,`invalid url "${i}"`)])),o)}function Gi(h){const i=h.value,o=h.styleSpec,d=o.light,m=h.style;let v=[];const b=s.i(i);if(void 0===i)return v;if("object"!==b)return v=v.concat([new Ze("light",i,`object expected, ${b} found`)]),v;for(const S in i){const z=S.match(/^(.*)-transition$/);v=v.concat(z&&d[z[1]]&&d[z[1]].transition?Xi({key:S,value:i[S],valueSpec:o.transition,style:m,styleSpec:o}):d[S]?Xi({key:S,value:i[S],valueSpec:d[S],style:m,styleSpec:o}):[new Ze(S,i[S],`unknown property "${S}"`)])}return v}function Br(h){const i=h.value;let o=[];if(!i)return o;const d=s.i(i);if("object"!==d)return o=o.concat([new Ze("light-3d",i,`object expected, ${d} found`)]),o;const m=h.styleSpec,v=m["light-3d"],b=h.key,S=h.style,z=h.style.lights;for(const B of["type","id"])if(!(B in i))return o=o.concat([new Ze("light-3d",i,`missing property ${B} on light`)]),o;if(i.type&&z)for(let B=0;B<h.arrayIndex;B++){const Y=s.u(i.type),Q=z[B];s.u(Q.type)===Y&&o.push(new Ze(b,i.id,`duplicate light type "${i.type}", previously defined at line ${Q.id.__line__}`))}const H=`properties_light_${i.type}`;if(!(H in m))return o=o.concat([new Ze("light-3d",i,`Invalid light type ${i.type}`)]),o;const R=m[H];for(const B in i)if("properties"===B){const Y=i[B],Q=s.i(Y);if("object"!==Q)return o=o.concat([new Ze("properties",Y,`object expected, ${Q} found`)]),o;for(const le in Y)o=o.concat(R[le]?Xi({key:le,value:Y[le],valueSpec:R[le],style:S,styleSpec:m}):[new ot(h.key,Y[le],`unknown property "${le}"`)])}else{const Y=B.match(/^(.*)-transition$/);o=o.concat(Y&&v[Y[1]]&&v[Y[1]].transition?Xi({key:B,value:i[B],valueSpec:m.transition,style:S,styleSpec:m}):v[B]?Xi({key:B,value:i[B],valueSpec:v[B],style:S,styleSpec:m}):[new ot(B,i[B],`unknown property "${B}"`)])}return o}function Hr(h){const i=h.value,o=h.key,d=h.style,m=h.styleSpec,v=m.terrain;let b=[];const S=s.i(i);if(void 0===i||"null"===S)return b;if("object"!==S)return b=b.concat([new Ze("terrain",i,`object expected, ${S} found`)]),b;for(const z in i){const H=z.match(/^(.*)-transition$/);b=b.concat(H&&v[H[1]]&&v[H[1]].transition?Xi({key:z,value:i[z],valueSpec:m.transition,style:d,styleSpec:m}):v[z]?Xi({key:z,value:i[z],valueSpec:v[z],style:d,styleSpec:m}):[new ot(z,i[z],`unknown property "${z}"`)])}if(i.source){const z=d.sources&&d.sources[i.source],H=z&&s.u(z.type);z?"raster-dem"!==H&&b.push(new Ze(o,i.source,`terrain cannot be used with a source of type ${String(H)}, it only be used with a "raster-dem" source type`)):b.push(new Ze(o,i.source,`source "${i.source}" not found`))}else b.push(new Ze(o,i,'terrain is missing required property "source"'));return b}function Ur(h){const i=h.value,o=h.style,d=h.styleSpec,m=d.fog;let v=[];const b=s.i(i);if(void 0===i)return v;if("object"!==b)return v=v.concat([new Ze("fog",i,`object expected, ${b} found`)]),v;for(const S in i){const z=S.match(/^(.*)-transition$/);v=v.concat(z&&m[z[1]]&&m[z[1]].transition?Xi({key:S,value:i[S],valueSpec:d.transition,style:o,styleSpec:d}):m[S]?Xi({key:S,value:i[S],valueSpec:m[S],style:o,styleSpec:d}):[new ot(S,i[S],`unknown property "${S}"`)])}return v}const Si={"*":()=>[],array:Ot,boolean:function(h){const i=h.value,o=h.key,d=s.i(i);return"boolean"!==d?[new Ze(o,i,`boolean expected, ${d} found`)]:[]},number:Xt,color:function(h){const i=h.key,o=h.value,d=s.i(o);return"string"!==d?[new Ze(i,o,`color expected, ${d} found`)]:null===s.y(o)?[new Ze(i,o,`color expected, "${o}" found`)]:[]},enum:Tn,filter:rt,function:Mi,layer:Pe,object:pt,source:mi,model:Ii,light:Gi,"light-3d":Br,terrain:Hr,fog:Ur,string:Ke,formatted:function(h){return 0===Ke(h).length?[]:Wi(h)},resolvedImage:function(h){return 0===Ke(h).length?[]:Wi(h)},projection:function(h){const i=h.value,o=h.styleSpec,d=o.projection,m=h.style;let v=[];const b=s.i(i);if("object"===b)for(const S in i)v=v.concat(Xi({key:S,value:i[S],valueSpec:d[S],style:m,styleSpec:o}));else"string"!==b&&(v=v.concat([new Ze("projection",i,`object or string expected, ${b} found`)]));return v},import:function(h){const{value:i,styleSpec:o}=h,{data:d,...m}=i;Object.defineProperty(m,"__line__",{value:i.__line__,enumerable:!1});let v=pt(s.j({},h,{value:m,valueSpec:o.import}));return""===s.u(m.id)&&v.push(new Ze(`${h.key}.id`,m,"import id can't be an empty string")),d&&(v=v.concat($r(d,o,{key:`${h.key}.data`}))),v}};function Xi(h,i=!1){const o=h.value,d=h.valueSpec,m=h.styleSpec;if(d.expression&&s.A(s.u(o)))return Mi(h);if(d.expression&&s.n(s.o(o)))return Wi(h);if(d.type&&Si[d.type]){const v=Si[d.type](h);return!0===i&&v.length>0&&"array"===s.i(h.value)?Wi(h):v}return pt(s.j({},h,{valueSpec:d.type?m[d.type]:d}))}function Rs(h){const i=h.value,o=h.key,d=Ke(h);return d.length||(-1===i.indexOf("{fontstack}")&&d.push(new Ze(o,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&d.push(new Ze(o,i,'"glyphs" url must include a "{range}" token'))),d}function $r(h,i=s.D,o={}){return Xi({key:o.key||"",value:h,valueSpec:i.$root,styleSpec:i,style:h,objectElementValidators:{glyphs:Rs,"*":()=>[]}})}function Ji(h,i=s.D){return Qt($r(h,i))}const ir=h=>Qt(mi(h)),jr=h=>Qt(Gi(h)),sn=h=>Qt(Br(h)),me=h=>Qt(Hr(h)),He=h=>Qt(Ur(h)),it=h=>Qt(Pe(h)),zt=h=>Qt(rt(h)),At=h=>Qt(st(h)),It=h=>Qt(Ne(h)),Hn=h=>Qt(Ii(h));function Qt(h){return h.slice().sort((i,o)=>i.line&&o.line?i.line-o.line:0)}function $n(h,i){let o=!1;if(i&&i.length)for(const d of i)d instanceof ot?s.w(d.message):(h.fire(new s.a(new Error(d.message))),o=!0);return o}const Wn=new s.F({anchor:new s.G(s.D.light.anchor),position:new s.H(s.D.light.position),color:new s.G(s.D.light.color),intensity:new s.G(s.D.light.intensity)});class Zn extends s.E{constructor(i,o="flat"){super(),this._transitionable=new s.J(Wn),this.setLight(i,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o,d={}){this._validate(jr,i,d)||(this._transitionable.setTransitionOrValue(i),this.id=o)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,d){return(!d||!1!==d.validate)&&$n(this,i.call(Ji,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.D})))}}const Fi=new s.F({source:new s.G(s.D.terrain.source),exaggeration:new s.G(s.D.terrain.exaggeration)});let Hi=class extends s.E{constructor(h,i,o,d){super(),this.scope=o,this._transitionable=new s.J(Fi,o,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(h,i){this._transitionable.setTransitionOrValue(h,i)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new s.K(h)).get("exaggeration")}isZoomDependent(){const h=this._transitionable._values.exaggeration;return null!=h&&null!=h.value&&null!=h.value.expression&&h.value.expression instanceof s.Z}};const Xr=45,Ti=65,hr=.05;function ri(h,i,o,d){const m=s.O(Xr,Ti,o),[v,b]=Qi(h,d);let S=1-Math.min(1,Math.exp((i-v)/(b-v)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*h.alpha}function Qi(h,i){const o=.5/Math.tan(.5*i);return[h.range[0]+o,h.range[1]+o]}function Ir(h,i,o,d,m){const v=s.N.transformMat4([],[i,o,d],m.mercatorFogMatrix);return ri(h,s.N.length(v),m.pitch,m._fov)}function cn(h,i,o,d,m,v,b){const S=[[o,d,0],[m,d,0],[m,v,0],[o,v,0]];let z=Number.MAX_VALUE,H=-Number.MAX_VALUE;for(const R of S){const B=s.N.transformMat4([],R,i),Y=s.N.length(B);z=Math.min(z,Y),H=Math.max(H,Y)}return[ri(h,z,b.pitch,b._fov),ri(h,H,b.pitch,b._fov)]}const Be=new s.F({range:new s.G(s.D.fog.range),color:new s.G(s.D.fog.color),"high-color":new s.G(s.D.fog["high-color"]),"space-color":new s.G(s.D.fog["space-color"]),"horizon-blend":new s.G(s.D.fog["horizon-blend"]),"star-intensity":new s.G(s.D.fog["star-intensity"]),"vertical-range":new s.G(s.D.fog["vertical-range"])});class Tt extends s.E{constructor(i,o,d,m){super(),this._transitionable=new s.J(Be,d,new Map(m)),this.set(i,m),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new s.Q(Be)}get state(){const i=this._transform,o="globe"===i.projection.name,d=s.S(i.zoom),m=this.properties.get("range"),v=[.5,3];return{range:o?[s.U(v[0],m[0],d),s.U(v[1],m[1],d)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o,d={}){if(this._validate(He,i,d))return;const m=s.e({},i);for(const v of Object.keys(s.D.fog))void 0===m[v]&&(m[v]=s.D.fog[v].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:s.O(Xr,Ti,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(d,m,v){const b=s.L.fromLngLat(m),S=v.elevation?v.elevation.getAtPointOrZero(b):0;return Ir(d,b.x,b.y,S,v)}(this.state,i,o):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(i.toUnwrapped());return cn(this.state,o,0,0,s.V,s.V,this._transform)}getOpacityForBounds(i,o,d,m,v){return this._transform.projection.supportsFog?cn(this.state,i,o,d,m,v,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Qi(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const d of o){const m=i.points[d];let v;if(m[2]>=0)v=m;else{const b=i.points[d-4];v=s.W(b,m,b[2]/(b[2]-m[2]))}if(Ir(this.state,v[0],v[1],0,this._transform)>=hr)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,d){return(!d||!1!==d.validate)&&$n(this,i.call(Ji,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.D})))}}class In extends s.E{constructor(i,o,d,m){super(),this.scope=d,this._options=i,this.properties=new s.Q(o),this._transitionable=new s.J(o,d,new Map(m)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,o){this._options=i,this._transitionable.setTransitionOrValue(i.properties,o)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const vn=new s.F({color:new s.G(s.D.properties_light_ambient.color),intensity:new s.G(s.D.properties_light_ambient.intensity)}),ei=new s.F({direction:new s.X(s.D.properties_light_directional.direction),color:new s.G(s.D.properties_light_directional.color),intensity:new s.G(s.D.properties_light_directional.intensity),"cast-shadows":new s.G(s.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.G(s.D.properties_light_directional["shadow-intensity"])});class Oi{constructor(i,o,d,m){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(i,o){let d,m;if(i instanceof s.P||"number"==typeof i[0]){const v=s.P.convert(i);d=[v],m=o.isPointAboveHorizon(v)}else{const v=s.P.convert(i[0]),b=s.P.convert(i[1]);d=[v,b],m=s.Y(v,b).every(S=>o.isPointAboveHorizon(S))}return new Oi(d,o.getCameraPoint(),m,o)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return s.Y(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],d=1===this.screenBounds.length?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],m=s.Y(o,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(m[3]=this.cameraPoint)),s._(m,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],d=1===this.screenBounds.length?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],m=s.Y(o,d,i),v=this.cameraPoint.clone();switch(3*((v.y>o.y)+(v.y>d.y))+((v.x>o.x)+(v.x>d.x))){case 0:m[0]=v,m[4]=v.clone();break;case 1:m.splice(1,0,v);break;case 2:m[1]=v;break;case 3:m.splice(4,0,v);break;case 5:m.splice(2,0,v);break;case 6:m[3]=v;break;case 7:m.splice(3,0,v);break;case 8:m[2]=v}return m}containsTile(i,o,d,m=0){const v=i.queryPadding/o._pixelsPerMercatorPixel+1,b=d?this._bufferedCameraMercator(v,o):this._bufferedScreenMercator(v,o);let S=i.tileID.wrap+(b.unwrapped?m:0);const z=b.polygon.map(pe=>s.$(i.tileTransform,pe,S));if(!s.a0(z,0,0,s.V,s.V))return;S=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const H=this.screenGeometryMercator.polygon.map(pe=>s.a1(i.tileTransform,pe,S)),R=H.map(pe=>new s.P(pe[0],pe[1])),B=o.getFreeCameraOptions().position||new s.L(0,0,0),Y=s.a1(i.tileTransform,B,S),Q=H.map(pe=>{const re=s.N.sub(pe,pe,Y);return s.N.normalize(re,re),new s.a2(Y,re)}),le=s.a3(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:Q,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(ce=s.a4(z),ce.min.x=s.aa(ce.min.x,0,s.V),ce.min.y=s.aa(ce.min.y,0,s.V),ce.max.x=s.aa(ce.max.x,0,s.V),ce.max.y=s.aa(ce.max.y,0,s.V),ce),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:le};var ce}_bufferedScreenMercator(i,o){const d=an(i);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let m;return m="globe"===o.projection.name?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(i,o){const d=an(i);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let m;return m="globe"===o.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[d]=m,m}}_projectAndResample(i,o){const d=function(v,b){const S=s.a6.multiply([],b.pixelMatrix,b.globeMatrix),z=[0,-s.ab,0,1],H=[0,s.ab,0,1],R=[0,0,0,1];s.a7.transformMat4(z,z,S),s.a7.transformMat4(H,H,S),s.a7.transformMat4(R,R,S);const B=new s.P(z[0]/z[3],z[1]/z[3]),Y=new s.P(H[0]/H[3],H[1]/H[3]),Q=s.a8(v,B)&&z[3]<R[3],le=s.a8(v,Y)&&H[3]<R[3];if(!Q&&!le)return null;const ce=function(Ie,Qe,nt){for(let dt=1;dt<Ie.length;dt++){const $t=Ht(Qe.pointCoordinate3D(Ie[dt-1]).x),Ct=Ht(Qe.pointCoordinate3D(Ie[dt]).x);if(nt<0){if($t<Ct)return{idx:dt,t:-$t/(Ct-1-$t)}}else if(Ct<$t)return{idx:dt,t:(1-$t)/(Ct+1-$t)}}return null}(v,b,Q?-1:1);if(!ce)return null;const{idx:pe,t:re}=ce;let ve=pe>1?kt(v.slice(0,pe),b):[],Le=pe<v.length?kt(v.slice(pe),b):[];ve=ve.map(Ie=>new s.P(Ht(Ie.x),Ie.y)),Le=Le.map(Ie=>new s.P(Ht(Ie.x),Ie.y));const Ce=[...ve];0===Ce.length&&Ce.push(Le[Le.length-1]);const ze=s.U(Ce[Ce.length-1].y,(0===Le.length?ve[0]:Le[0]).y,re);let ge;return ge=Q?[new s.P(0,ze),new s.P(0,0),new s.P(1,0),new s.P(1,ze)]:[new s.P(1,ze),new s.P(1,1),new s.P(0,1),new s.P(0,ze)],Ce.push(...ge),0===Le.length?Ce.push(ve[0]):Ce.push(...Le),{polygon:Ce.map(Ie=>new s.L(Ie.x,Ie.y)),unwrapped:!1}}(i,o);if(d)return d;const m=function(v,b){let S=!1,z=-1/0,H=0;for(let B=0;B<v.length-1;B++)v[B].x>z&&(z=v[B].x,H=B);for(let B=0;B<v.length-1;B++){const Y=(H+B)%(v.length-1),Q=v[Y],le=v[Y+1];Math.abs(Q.x-le.x)>.5&&(Q.x<le.x?(Q.x+=1,0===Y&&(v[v.length-1].x+=1)):(le.x+=1,Y+1===v.length-1&&(v[0].x+=1)),S=!0)}const R=s.a5(b.center.lng);return S&&R<Math.abs(R-1)&&v.forEach(B=>{B.x-=1}),{polygon:v,unwrapped:S}}(kt(i,o).map(v=>new s.P(Ht(v.x),v.y)),o);return{polygon:m.polygon.map(v=>new s.L(v.x,v.y)),unwrapped:m.unwrapped}}}function kt(h,i){return s.a9(h,o=>{const d=i.pointCoordinate3D(o);o.x=d.x,o.y=d.y},1/256)}function Ht(h){return h<0?1+h%1:h%1}function an(h){return 100*h|0}function _n(h,i,o,d,m){const v=function(b,S){if(b)return m(b);if(S){h.url&&S.tiles&&h.tiles&&delete h.tiles;const z=s.ac(s.e(S,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(z.vectorLayers=S.vector_layers,z.vectorLayerIds=z.vectorLayers.map(H=>H.id)),S.raster_layers&&(z.rasterLayers=S.raster_layers,z.rasterLayerIds=z.rasterLayers.map(H=>H.id)),z.tiles=i.canonicalizeTileset(z,h.url),m(null,z)}};return h.url?s.g(i.transformRequest(i.normalizeSourceURL(h.url,null,o,d),s.R.Source),v):s.f.frame(()=>v(null,h))}class qe{constructor(i,o,d){this.bounds=s.ad.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=d||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),d=Math.floor(s.a5(this.bounds.getWest())*o),m=Math.floor(s.ae(this.bounds.getNorth())*o),v=Math.ceil(s.a5(this.bounds.getEast())*o),b=Math.ceil(s.ae(this.bounds.getSouth())*o);return i.x>=d&&i.x<v&&i.y>=m&&i.y<b}}class Ge extends s.E{constructor(i,o,d,m){if(super(),this.id=i,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.ac(o,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new s.af}load(i){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=_n(this._options,this.map._requestManager,o,d,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&2!==d.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new s.a(m))):v&&(s.e(this,v),v.bounds&&(this.tileBounds=new qe(v.bounds,this.minzoom,this.maxzoom)),s.aj(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(m)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}loadTile(i,o){const d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(d,s.R.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster};if(m.request.collectResourceTiming=this._collectResourceTiming,i.actor&&"expired"!==i.state)"loading"===i.state?i.reloadCallback=o:i.request=i.actor.send("reloadTile",m,v.bind(this));else if(i.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",m,v.bind(this),void 0,!0);else{const b=s.ah.call({deduped:this._deduped},m,(S,z)=>{S||!z?v.call(this,S):(m.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},i.actor&&i.actor.send("loadTile",m,v.bind(this),void 0,!0))},!0);i.request={cancel:b}}function v(b,S){return delete i.request,i.aborted?o(null):b&&404!==b.status?o(b):(S&&S.resourceTiming&&(i.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&i.setExpiryData(S),i.loadVectorData(S,this.map.painter),s.ai(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ye extends s.E{constructor(i,o,d,m){super(),this.id=i,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},o),s.e(this,s.ac(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._tileJSONRequest=_n(this._options,this.map._requestManager,null,null,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new s.a(o)):d&&(s.e(this,d),d.bounds&&(this.tileBounds=new qe(d.bounds,this.minzoom,this.maxzoom)),s.aj(d.tiles),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const d=s.f.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);i.request=s.d(this.map._requestManager.transformRequest(m,s.R.Tile),(v,b,S,z)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):v?(i.state="errored",o(v)):b?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:z}),i.setTexture(b,this.map.painter),i.state="loaded",s.ai(this.dispatcher),void o(null)):o(null)))}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&i.texture instanceof s.T?(i.destroy(!0),i.texture&&i.texture instanceof s.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ke extends ye{constructor(i,o,d,m){super(i,o,d,m),this.type="raster-array",this.maxzoom=22,this._options=s.e({type:"raster-array"},o)}triggerRepaint(i){const o=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);o&&o.enabled&&d&&o._clearRenderCacheForTile(d.id,i.tileID),this.map.triggerRepaint()}loadTile(i,o){const d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(d,s.R.Tile);i.requestParams=m,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(v,b,S,z)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):v?20===v.code?void 0:(i.state="errored",o(v)):(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:z}),i.state="empty",void o(null))))}unloadTile(i){const o=i.texture;o&&o instanceof s.T?(i.destroy(!0),this.map.painter.saveTileTexture(o)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,o,d){i._isHeaderLoaded&&("empty"!==i.state&&(i.state="reloading"),i.fetchBand(o,d,(m,v)=>{if(m)return i.state="errored",this.fire(new s.a(m)),void this.triggerRepaint(i);v&&(i.setTexture(v,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:v})=>v===i),d=o&&o.fields,m=d&&d.bands&&d.bands;return m?m[0]:0}getTextureDescriptor(i,o,d){if(!i)return;const m=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let v=null;o instanceof s.an?v=o.paint.get("raster-array-band"):o instanceof s.ao&&(v=o.paint.get("raster-particle-array-band"));const b=v||this.getInitialBand(m);if(null!=b)if(i.textureDescriptor){if(!i.updateNeeded(m,b)||d)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,m,b)}}const J=32,_e=33,Se=new Uint16Array(8184);for(let h=0;h<2046;h++){let i=h+2,o=0,d=0,m=0,v=0,b=0,S=0;for(1&i?m=v=b=J:o=d=S=J;(i>>=1)>1;){const H=o+m>>1,R=d+v>>1;1&i?(m=o,v=d,o=b,d=S):(o=m,d=v,m=b,v=S),b=H,S=R}const z=4*h;Se[z+0]=o,Se[z+1]=d,Se[z+2]=m,Se[z+3]=v}const at=new Uint16Array(2178),St=new Uint8Array(1089),nn=new Uint16Array(1089);function bn(h){return 0===h?-.03125:32===h?.03125:0}let Dn=(()=>{class h{constructor(o,d,m,v){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||v||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++;const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return h.uniqueIdxCounter=0,h})();const Nn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ei{constructor(i,o,d,m,v,b){this.length=o.length,this.attributes=d,this.itemSize=o.bytesPerElement,this.dynamicDraw=m,this.instanceCount=b,this.context=i;const S=i.gl;this.buffer=S.createBuffer(),i.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||v||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let d=0;d<this.attributes.length;d++){const m=o.attributes[this.attributes[d].name];void 0!==m&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,o,d){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],b=o.attributes[v.name];void 0!==b&&i.vertexAttribPointer(b,v.components,i[Nn[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(i,o,d){for(let m=0;m<this.attributes.length;m++){const v=o.attributes[this.attributes[m].name];void 0!==v&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(v,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class si{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class er extends si{getDefault(){return s.ax.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class rs extends si{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Er extends si{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class zs extends si{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Qs extends si{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class zr extends si{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class ls extends si{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class ds extends si{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class ro extends si{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class Os extends si{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class e1 extends si{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class Oa extends si{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class qo extends si{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class So extends si{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class vi extends si{getDefault(){return s.ax.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class qi extends si{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Sr extends si{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class Pi extends si{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Io extends si{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let js=class extends si{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class sa extends si{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class ps extends si{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Fs extends si{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Vo extends si{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class br extends si{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class ws extends si{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class qn extends si{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Yi extends si{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class tr extends si{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class es extends si{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class ho extends si{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class rr extends si{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Cs extends rr{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class fo extends rr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class _a extends rr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class _r extends fo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class vs{constructor(i,o,d,m,v){this.context=i,this.width=o,this.height=d;const b=this.framebuffer=i.gl.createFramebuffer();m&&(this.colorAttachment=new Cs(i,b)),v&&(this.depthAttachmentType=v,this.depthAttachment="renderbuffer"===v?new fo(i,b):new _a(i,b))}destroy(){const i=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&i.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&i.deleteTexture(o)}i.deleteFramebuffer(this.framebuffer)}}class ci{constructor(i,o,d){this.func=i,this.mask=o,this.range=d}}ci.ReadOnly=!1,ci.ReadWrite=!0,ci.disabled=new ci(519,ci.ReadOnly,[0,1]);class Ci{constructor(i,o,d,m,v,b){this.test=i,this.ref=o,this.mask=d,this.fail=m,this.depthFail=v,this.pass=b}}Ci.disabled=new Ci({func:519,mask:0},0,0,7680,7680,7680);class Bi{constructor(i,o,d,m){this.blendFunction=i,this.blendColor=o,this.mask=d,this.blendEquation=m}}Bi.Replace=[1,0,1,0],Bi.disabled=new Bi(Bi.Replace,s.ax.transparent,[!1,!1,!1,!1]),Bi.unblended=new Bi(Bi.Replace,s.ax.transparent,[!0,!0,!0,!0]),Bi.alphaBlended=new Bi([1,771,1,771],s.ax.transparent,[!0,!0,!0,!0]),Bi.multiply=new Bi([774,0,774,0],s.ax.transparent,[!0,!0,!0,!0]);class Qn{constructor(i,o,d){this.enable=i,this.mode=o,this.frontFace=d}}Qn.disabled=new Qn(!1,1029,2305),Qn.backCCW=new Qn(!0,1029,2305),Qn.backCW=new Qn(!0,1029,2304),Qn.frontCW=new Qn(!0,1028,2304),Qn.frontCCW=new Qn(!0,1028,2305);class Ls{constructor(i,o){this.gl=i,this.clearColor=new er(this),this.clearDepth=new rs(this),this.clearStencil=new Er(this),this.colorMask=new zs(this),this.depthMask=new Qs(this),this.stencilMask=new zr(this),this.stencilFunc=new ls(this),this.stencilOp=new ds(this),this.stencilTest=new ro(this),this.depthRange=new Os(this),this.depthTest=new e1(this),this.depthFunc=new Oa(this),this.blend=new qo(this),this.blendFunc=new So(this),this.blendColor=new vi(this),this.blendEquation=new qi(this),this.cullFace=new Sr(this),this.cullFaceSide=new Pi(this),this.frontFace=new Io(this),this.program=new js(this),this.activeTexture=new sa(this),this.viewport=new ps(this),this.bindFramebuffer=new Fs(this),this.bindRenderbuffer=new Vo(this),this.bindTexture=new br(this),this.bindVertexBuffer=new ws(this),this.bindElementBuffer=new qn(this),this.bindVertexArrayOES=new Yi(this),this.pixelStoreUnpack=new tr(this),this.pixelStoreUnpackPremultiplyAlpha=new es(this),this.pixelStoreUnpackFlipY=new ho(this),this.options=o?{...o}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o,d){return new Dn(this,i,o,d)}createVertexBuffer(i,o,d,m,v){return new Ei(this,i,o,d,m,v)}createRenderbuffer(i,o,d){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,i,o,d),this.bindRenderbuffer.set(null),v}createFramebuffer(i,o,d,m){return new vs(this,i,o,d,m)}clear({color:i,depth:o,stencil:d,colorMask:m}){const v=this.gl;let b=0;i&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(m||[!0,!0,!0,!0])),void 0!==o&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),void 0!==d&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),v.clear(b)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){ct(i.blendFunction,Bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var so=s.ay([{name:"a_pos",type:"Float32",components:3}]);class as{constructor(i,o,d,m){const v={width:d[0],height:d[1],data:null},b=i.gl;this.targetColorTexture=new s.T(i,v,b.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new s.T(i,v,b.RGBA,{useMipmap:!1}),this.context=i,this.setNumParticles(o,m),this.lastInvalidatedAt=0}setNumParticles(i,o){if(this.numParticles===o)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const d=new s.az;d.reserve(Math.round(o));const m=s.aA(i.key);for(let v=0;v<o;v++)d.emplaceBack(m(),m(),m());this.particleVertices0=this.context.createVertexBuffer(d,so.members,!0),this.particleVertices1=this.context.createVertexBuffer(d,so.members,!0),this.particleSegment=s.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=o}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=s.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const to={type:2,extent:s.V,loadGeometry:()=>[[new s.P(0,0),new s.P(s.V+1,0),new s.P(s.V+1,s.V+1),new s.P(0,s.V+1),new s.P(0,0)]]};class $s{constructor(i,o,d,m,v){this.tileID=i,this.uid=s.aC(),this.uses=0,this.tileSize=o,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(i){const o=i+this.timeAdded;o<s.f.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=s.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,o,d){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,v){const b={};if(!v)return b;for(const S of m){const z=S.layerIds.map(H=>v.getLayer(H)).filter(Boolean);if(0!==z.length){S.layers=z,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(H=>z.filter(R=>R.id===H)[0]));for(const H of z)b[H.fqid]=S}}return b}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof s.aE){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof s.aE&&v.hasRTLText){this.hasRTLText=!0,s.aF();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m],b=o.style.getOwnLayer(m);if(!b)continue;const S=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,S)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new s.aD}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const m in this.buckets){const v=this.buckets[m];v.uploadPending()&&v.upload(i)}const o=i.gl,d=this.imageAtlas;if(d&&!d.uploaded){const m=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new s.T(i,d.image,o.RGBA,{useMipmap:m}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(i,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(i,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(i,o,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,d),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=o.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this._lastUpdatedBrightness=m,this.updateBuckets(void 0,o)))}queryRenderedFeatures(i,o,d,m,v,b,S,z){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:S,transform:b,params:v,tileTransform:this.tileTransform},i,o,d):{}}querySourceFeatures(i,o){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),v=o?o.sourceLayer:"",b=m._geojsonTileLayer||m[v];if(!b)return;const S=s.aG(o&&o.filter),{z,x:H,y:R}=this.tileID.canonical,B={z,x:H,y:R};for(let Y=0;Y<b.length;Y++){const Q=b.feature(Y);if(S.needGeometry){const pe=s.aH(Q,!0);if(!S.filter(new s.K(this.tileID.overscaledZ),pe,this.tileID.canonical))continue}else if(!S.filter(new s.K(this.tileID.overscaledZ),Q))continue;const le=d.getId(Q,v),ce=new s.aI(Q,z,H,R,le);ce.tile=B,i.push(ce)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const i in this.buckets)if(this.buckets[i].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const d=s.aJ(i.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(o)if(this.expirationTime<o)m=!0;else{const v=this.expirationTime-o;v?this.expirationTime=d+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(i).length&&o&&this.updateBuckets(i,o)}updateBuckets(i,o){if(!this.latestFeatureIndex)return;const d=this.latestFeatureIndex.loadVTLayers(),m=o.style.listImages(),v=o.style.getBrightness();for(const b in this.buckets){if(!o.style.hasLayer(b))continue;const S=this.buckets[b],z=S.layers[0].sourceLayer||"_geojsonTileLayer",H=d[z];let R={};if(i&&(R=i[z],!H||!R||0===Object.keys(R).length))continue;if(S.update(R,H,m,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),S instanceof s.aK||S instanceof s.aL){const Y=o.style.getOwnSourceCache(S.layers[0].source);o._terrain&&o._terrain.enabled&&Y&&S.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(Y.id,this.tileID)}const B=o&&o.style&&o.style.getOwnLayer(b);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(S)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=s.f.now()+i}setTexture(i,o){const d=o.context,m=d.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i,{useMipmap:!0}):(this.texture=new s.T(d,i,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(i,o){const d={};for(const m of o)d[m]=!0;this.dependencies[i]=d}hasDependency(i,o){for(const d of i){const m=this.dependencies[d];if(m)for(const v of o)if(m[v])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,o){if(!o||"mercator"===o.name||this._tileDebugBuffer)return;const d=s.aM(to,this.tileID.canonical,this.tileTransform)[0],m=new s.aN,v=new s.aO;for(let b=0;b<d.length;b++){const{x:S,y:z}=d[b];m.emplaceBack(S,z),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(v),this._tileDebugBuffer=i.createVertexBuffer(m,s.aP.members),this._tileDebugSegments=s.aB.simpleSegment(0,0,m.length,v.length)}_makeTileBoundsBuffers(i,o){if(this._tileBoundsBuffer||!o||"mercator"===o.name)return;const d=s.aM(to,this.tileID.canonical,this.tileTransform)[0];let m,v;if(this.isRaster){const b=function(S,z){const H=s.as(S,z),R=Math.pow(2,S.z);for(let pe=0;pe<_e;pe++)for(let re=0;re<_e;re++){const ve=s.at((S.x+(re+bn(re))/J)/R),Le=s.au((S.y+(pe+bn(pe))/J)/R),Ce=z.project(ve,Le),ze=pe*_e+re;at[2*ze+0]=Math.round((Ce.x*H.scale-H.x)*s.V),at[2*ze+1]=Math.round((Ce.y*H.scale-H.y)*s.V)}St.fill(0),nn.fill(0);for(let pe=2045;pe>=0;pe--){const re=4*pe,ve=Se[re+0],Le=Se[re+1],Ce=Se[re+2],ze=Se[re+3],ge=ve+Ce>>1,Ie=Le+ze>>1,Qe=ge+Ie-Le,nt=Ie+ve-ge,dt=Le*_e+ve,$t=ze*_e+Ce,Ct=Ie*_e+ge,en=Math.hypot((at[2*dt+0]+at[2*$t+0])/2-at[2*Ct+0],(at[2*dt+1]+at[2*$t+1])/2-at[2*Ct+1])>=16;St[Ct]=St[Ct]||(en?1:0),pe<1022&&(St[Ct]=St[Ct]||St[(Le+nt>>1)*_e+(ve+Qe>>1)]||St[(ze+nt>>1)*_e+(Ce+Qe>>1)])}const B=new s.av,Y=new s.aw;let Q=0;function le(pe,re){const ve=re*_e+pe;return 0===nn[ve]&&(B.emplaceBack(at[2*ve+0],at[2*ve+1],pe*s.V/J,re*s.V/J),nn[ve]=++Q),nn[ve]-1}function ce(pe,re,ve,Le,Ce,ze){const ge=pe+ve>>1,Ie=re+Le>>1;if(Math.abs(pe-Ce)+Math.abs(re-ze)>1&&St[Ie*_e+ge])ce(Ce,ze,pe,re,ge,Ie),ce(ve,Le,Ce,ze,ge,Ie);else{const Qe=le(pe,re),nt=le(ve,Le),dt=le(Ce,ze);Y.emplaceBack(Qe,nt,dt)}}return ce(0,0,J,J,J,0),ce(J,J,0,0,0,J),{vertices:B,indices:Y}}(this.tileID.canonical,o);m=b.vertices,v=b.indices}else{m=new s.av,v=new s.aw;for(const{x:S,y:z}of d)m.emplaceBack(S,z,0,0);const b=s.aQ(m.int16,void 0,4);for(let S=0;S<b.length;S+=3)v.emplaceBack(b[S],b[S+1],b[S+2])}this._tileBoundsBuffer=i.createVertexBuffer(m,s.aR.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(v),this._tileBoundsSegments=s.aB.simpleSegment(0,0,m.length,v.length)}_makeGlobeTileDebugBuffers(i,o){const d=o.projection;if(!d||"globe"!==d.name||o.freezeTileCoverage)return;const m=this.tileID.canonical,v=s.aS(m,o),b=s.aT(v),S=s.S(o.zoom);let z;S>0&&(z=s.a6.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,m,o,b,z,S),this._makeGlobeTileDebugTextBuffer(i,m,o,b,z,S)}_globePoint(i,o,d,m,v,b,S){let z=s.aU(i,o,d);if(b){const H=1<<d.z,R=s.a5(m.center.lng),B=s.ae(m.center.lat),Y=(d.x+.5)/H-R;let Q=0;Y>.5?Q=-1:Y<-.5&&(Q=1);let le=(i/s.V+d.x)/H+Q,ce=(o/s.V+d.y)/H;le=(le-R)*m._pixelsPerMercatorPixel+R,ce=(ce-B)*m._pixelsPerMercatorPixel+B;const pe=[le*m.worldSize,ce*m.worldSize,0];s.N.transformMat4(pe,pe,b),z=s.aV(z,pe,S)}return s.N.transformMat4(z,z,v)}_makeGlobeTileDebugBorderBuffer(i,o,d,m,v,b){const S=new s.aN,z=new s.aO,H=new s.aW,R=(Y,Q,le,ce,pe)=>{const re=(le-Y)/(pe-1),ve=(ce-Q)/(pe-1),Le=S.length;for(let Ce=0;Ce<pe;Ce++){const ze=Y+Ce*re,ge=Q+Ce*ve;S.emplaceBack(ze,ge);const Ie=this._globePoint(ze,ge,o,d,m,v,b);H.emplaceBack(Ie[0],Ie[1],Ie[2]),z.emplaceBack(Le+Ce)}},B=s.V;R(0,0,B,0,16),R(B,0,B,B,16),R(B,B,0,B,16),R(0,B,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(z),this._tileDebugBuffer=i.createVertexBuffer(S,s.aP.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(H,s.aX.members),this._tileDebugSegments=s.aB.simpleSegment(0,0,S.length,z.length)}_makeGlobeTileDebugTextBuffer(i,o,d,m,v,b){const S=s.V/4,z=new s.aN,H=new s.aw,R=new s.aW,B=25;H.reserve(32),z.reserve(B),R.reserve(B);const Y=(Q,le)=>B*Q+le;for(let Q=0;Q<B;Q++){const le=Q*S;for(let ce=0;ce<B;ce++){const pe=ce*S;z.emplaceBack(pe,le);const re=this._globePoint(pe,le,o,d,m,v,b);R.emplaceBack(re[0],re[1],re[2])}}for(let Q=0;Q<4;Q++)for(let le=0;le<4;le++){const ce=Y(Q,le),pe=Y(Q,le+1),re=Y(Q+1,le),ve=Y(Q+1,le+1);H.emplaceBack(ce,pe,re),H.emplaceBack(re,pe,ve)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(H),this._tileDebugTextBuffer=i.createVertexBuffer(z,s.aP.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(R,s.aX.members),this._tileDebugTextSegments=s.aB.simpleSegment(0,0,B,32)}destroy(i=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const Oo={vector:Ge,raster:ye,"raster-dem":class extends ye{constructor(h,i,o,d){super(h,i,o,d),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(h,i){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,v){m&&(h.state="errored",i(m)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",i(null))}h.request=s.d(this.map._requestManager.transformRequest(o,s.R.Tile),function(m,v,b,S){if(delete h.request,h.aborted)h.state="unloaded",i(null);else if(m)h.state="errored",i(m);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:S});const z=ImageBitmap&&v instanceof ImageBitmap&&s.ak(),H=1-(v.width-s.al(v.width))/2;H<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const R=z?v:s.f.getImageData(v,H),B={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:H};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",B,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const i=h.canonical,o=Math.pow(2,i.z),d=(i.x-1+o)%o,m=0===i.x?h.wrap-1:h.wrap,v=(i.x+1+o)%o,b=i.x+1===o?h.wrap+1:h.wrap,S={};return S[new s.am(h.overscaledZ,m,i.z,d,i.y).key]={backfilled:!1},S[new s.am(h.overscaledZ,b,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(S[new s.am(h.overscaledZ,m,i.z,d,i.y-1).key]={backfilled:!1},S[new s.am(h.overscaledZ,h.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new s.am(h.overscaledZ,b,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<o&&(S[new s.am(h.overscaledZ,m,i.z,d,i.y+1).key]={backfilled:!1},S[new s.am(h.overscaledZ,h.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new s.am(h.overscaledZ,b,i.z,v,i.y+1).key]={backfilled:!1}),S}},"raster-array":ke,geojson:class extends s.E{constructor(h,i,o,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(d),this._data=i.data,this._options=s.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const m=s.V/this.tileSize;this.workerOptions=s.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*m,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*m,extent:s.V,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.V,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*m,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},i),this}getClusterChildren(h,i){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},i),this}getClusterLeaves(h,i,o,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:i,offset:o},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.b("dataloading",{dataType:"source"})),this._loaded=!1;const h=s.e({},this.workerOptions);h.scope=this.scope;const i=this._data;"string"==typeof i?(h.request=this.map._requestManager.transformRequest(s.f.resolveURL(i),s.R.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(o,d)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new s.a(o));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(m.resourceTiming=d.resourceTiming[this.id]),this.fire(new s.b("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,i){const o=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};h.request=this.actor.send(o,d,(m,v)=>(delete h.request,h.destroy(),h.aborted?i(null):m?i(m):(h.loadVectorData(v,this.map.painter,"reloadTile"===o),i(null))),void 0,"loadTile"===o)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.ap{constructor(h,i,o,d){super(h,i,o,d),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const i of h.urls)this.urls.push(this.map._requestManager.transformRequest(i,s.R.Source).url);s.aq(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new s.a(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const i=this.video.seekable;h<i.start(0)||h>i.end(0)?this.fire(new s.a(new Ze(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,i=h.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(h,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.ap,model:class extends s.E{constructor(h,i,o,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const h=[];for(const i in this._options.models){const o=this._options.models[i],d=s.l(this.map._requestManager.transformRequest(o.uri,s.R.Model).url).then(m=>{if(!m)return;const v=s.c(m),b=new s.M(i,o.position,o.orientation,v);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(m=>{this.fire(new s.a(new Error(`Could not load model ${i} from ${o.uri}: ${m.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new s.a(new Error(`Could not load models: ${i.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,i){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(h,i,o,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=_n(this._options,this.map._requestManager,i,o,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&2!==o.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new s.a(d))):m&&(s.e(this,m),m.bounds&&(this.tileBounds=new qe(m.bounds,this.minzoom,this.maxzoom)),s.aj(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,i){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(o,s.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(h.actor&&"expired"!==h.state)if("loading"===h.state)h.reloadCallback=i;else{if(h.buckets){const v=Object.values(h.buckets);for(const b of v)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,m.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,m.bind(this),void 0,!0);function m(v,b){return h.aborted?i(null):v&&404!==v.status?i(v):(b&&(b.resourceTiming&&(h.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&h.setExpiryData(b),h.buckets={...h.buckets,...b.buckets},b.featureIndex&&(h.latestFeatureIndex=b.featureIndex)),h.state="loaded",void i(null))}}serialize(){return s.e({},this._options)}},canvas:class extends s.ap{constructor(h,i,o,d){super(h,i,o,d),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(m=>!Array.isArray(m)||2!==m.length||m.some(v=>"number"!=typeof v))||this.fire(new s.a(new Ze(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a(new Ze(`sources.${h}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new s.a(new Ze(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new s.a(new Ze(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a(new Ze(`sources.${h}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof s.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends s.E{constructor(h,i,o,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qe(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),s.e(this,s.ac(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:i,y:o,z:d}=h.canonical;return this._implementation.hasTile({x:i,y:o,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,i){const{x:o,y:d,z:m}=h.tileID.canonical,v=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:o,y:d,z:m},{signal:v.signal})).then(function(b){return delete h.request,h.aborted?(h.state="unloaded",i(null)):void 0===b?(h.state="errored",i(null)):null===b?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",i(null)):(S=b)instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement?(this.loadTileData(h,b),h.state="loaded",void i(null)):(h.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var S}.bind(this)).catch(b=>{20!==b.code&&(h.state="errored",i(b))}),h.request.cancel=()=>v.abort()}loadTileData(h,i){h.setTexture(i,this._map.painter)}unloadTile(h,i){if(h.texture&&h.texture instanceof s.T?(h.destroy(!0),h.texture&&h.texture instanceof s.T&&this._map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:o,y:d,z:m}=h.tileID.canonical;this._implementation.unloadTile({x:o,y:d,z:m})}i()}abortTile(h,i){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=s.ag(this.id,this.scope);this._map.style.clearSource(h)}_update(){this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}}},Nr=function(h,i,o,d){const m=new Oo[i.type](h,i,o,d);if(m.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${m.id}`);return s.aY(["load","abort","unload","serialize","prepare"],m),m};function Ms(h,i){const o=s.a6.identity([]);return s.a6.scale(o,o,[.5*h.width,.5*-h.height,1]),s.a6.translate(o,o,[1,-1,0]),s.a6.multiply(o,o,h.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}function Fa(h,i,o,d,m,v,b,S=!1){const z=h.tilesIn(d,b,S);z.sort(_1);const H=[];for(const B of z)H.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,o,h._state,B,m,v,Ms(h.transform,B.tile.tileID),S)});const R=function(B){const Y={},Q={};for(const le of B){const ce=le.queryResults,pe=le.wrappedTileID,re=Q[pe]=Q[pe]||{};for(const ve in ce){const Le=ce[ve],Ce=re[ve]=re[ve]||{},ze=Y[ve]=Y[ve]||[];for(const ge of Le)Ce[ge.featureIndex]||(Ce[ge.featureIndex]=!0,ze.push(ge))}}return Y}(H);for(const B in R)R[B].forEach(Y=>{const Q=Y.feature,le=Q.layer;le&&"background"!==le.type&&"sky"!==le.type&&"slot"!==le.type&&(Q.source=le.source,le["source-layer"]&&(Q.sourceLayer=le["source-layer"]),Q.state=void 0!==Q.id?h.getFeatureState(le["source-layer"],Q.id):{})});return R}function oo(h,i){const o=h.getRenderableIds().map(v=>h.getTileByID(v)),d=[],m={};for(let v=0;v<o.length;v++){const b=o[v],S=b.tileID.canonical.key;m[S]||(m[S]=!0,b.querySourceFeatures(d,i))}return d}function _1(h,i){const o=h.tileID,d=i.tileID;return o.overscaledZ-d.overscaledZ||o.canonical.y-d.canonical.y||o.wrap-d.wrap||o.canonical.x-d.canonical.x}class yo extends $s{constructor(i,o,d,m,v){super(i,o,d,m,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,o){const d=o.context,m=d.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i,{useMipmap:!1,premultiply:!1}):this.texture=new s.T(d,i,m.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,o){const d=this._mrt=new s.aZ(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=s.a_(m,(v,b,S,z)=>{if(v)o(v);else try{const H=d.getHeaderLength(b);if(H>i)return void(this.request=this.fetchHeader(H,o));d.parseHeader(b),this._isHeaderLoaded=!0;let R=0;for(const B of Object.values(d.layers))R=Math.max(R,B.dataIndex[B.dataIndex.length-1].last_byte);b.byteLength>=R&&(this.entireBuffer=b),o(null,this.entireBuffer||b,S,z)}catch(H){o(H)}}),this.request}fetchBand(i,o,d){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void d(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void d(new Error("Can't fetch tile band without an actor"));let b;const S=(B,Y)=>{b.complete(B,Y),B?d(B):(this.updateTextureDescriptor(i,o),d(null,this.textureDescriptor&&this.textureDescriptor.img))},z=(B,Y)=>{if(B)return d(B);const Q=v.send("decodeRasterArray",{buffer:Y,task:b},S,void 0,!0);this._workQueue.push(()=>{Q&&Q.cancel(),b.cancel()})},H=m.getLayer(i);if(!H)return void d(new Error(`Unknown sourceLayer "${i}"`));if(H.hasDataForBand(o))return this.updateTextureDescriptor(i,o),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const R=H.getDataRange([o]);if(b=m.createDecodingTask(R),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)z(null,this.entireBuffer.slice(R.firstByte,R.lastByte+1));else{const B=Object.assign({},this.requestParams,{headers:{Range:`bytes=${R.firstByte}-${R.lastByte}`}}),Y=s.a_(B,z);this._fetchQueue.push(()=>{Y.cancel(),b.cancel()})}else d(null)}updateNeeded(i,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==i)&&"errored"!==this.state}updateTextureDescriptor(i,o){if(!this._mrt)return;const d=this._mrt.getLayer(i);if(!d||!d.hasBand(o)||!d.hasDataForBand(o))return;const{bytes:m,tileSize:v,buffer:b,offset:S,scale:z}=d.getBandView(o),H=v+2*b,R={data:m,width:H,height:H},B=this.texture;B&&B instanceof s.T&&B.update(R,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:i,band:o,img:R,buffer:b,offset:S,tileSize:v,format:d.pixelFormat,mix:[z,256*z,65536*z,16777216*z]}}}class oa{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,d){const m=i.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const v={value:o,timeout:void 0};if(void 0!==d&&(v.timeout=setTimeout(()=>{this.remove(i,v)},d)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const d=i.wrapped().key,m=void 0===o?0:this.data[d].indexOf(o),v=this.data[d][m];return this.data[d].splice(m,1),v.timeout&&clearTimeout(v.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const d in this.data)for(const m of this.data[d])i(m.value)||o.push(m);for(const d of o)this.remove(d.value.tileID,d)}}class za extends s.E{constructor(i,o,d){super(),this.id=i,this._onlySymbols=d,o.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new oa(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ye,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const o=this._tiles[i];if("errored"!==o.state&&("loaded"!==o.state||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,o){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,o)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const d=this._tiles[o];d.upload(i),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.a$(this._tiles).map(i=>i.tileID).sort(t1).map(i=>i.key)}getRenderableIds(i,o){const d=[];for(const m in this._tiles)this._isIdRenderable(+m,i,o)&&d.push(this._tiles[m]);return i?d.sort((m,v)=>{const b=m.tileID,S=v.tileID,z=new s.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),H=new s.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-S.overscaledZ||H.y-z.y||H.x-z.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(t1).map(m=>m.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o,d){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())&&(d||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,o){const d=this._tiles[i];d&&("loading"!==d.state&&(d.state=o),this._loadTile(d,this._tileLoaded.bind(this,d,i,o)))}_tileLoaded(i,o,d,m){if(m)if(i.state="errored",404!==m.status)this._source.fire(new s.a(m,{tile:i}));else{if(!(i.tileID.key in this._loadedParentTiles))return void this._source.fire(new s.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=s.f.now(),"expired"===d&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new s.b("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const o=this.getRenderableIds();for(let m=0;m<o.length;m++){const v=o[m];if(i.neighboringTiles&&i.neighboringTiles[v]){const b=this.getTileByID(v);d(i,b),d(b,i)}}function d(m,v){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-m.tileID.canonical.x;const S=v.tileID.canonical.y-m.tileID.canonical.y,z=Math.pow(2,m.tileID.canonical.z),H=v.tileID.key;0===b&&0===S||Math.abs(S)>1||(Math.abs(b)>1&&(1===Math.abs(b+z)?b+=z:1===Math.abs(b-z)&&(b-=z)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,b,S),m.neighboringTiles&&m.neighboringTiles[H]&&(m.neighboringTiles[H].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,d,m){for(const v in this._tiles){let b=this._tiles[v];if(m[v]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>d)continue;let S=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){const H=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[H.key],b&&b.hasData()&&(S=H)}let z=S;for(;z.overscaledZ>o;)if(z=z.scaledTo(z.overscaledZ-1),i[z.key]){m[S.key]=S;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const d=this._loadedParentTiles[i.key];return d&&d.tileID.overscaledZ>=o?d:null}for(let d=i.overscaledZ-1;d>=o;d--){const m=i.scaledTo(d),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,o){o=o||this._source.tileSize;const d=Math.ceil(i.width/o)+1,m=Math.ceil(i.height/o)+1,v=Math.floor(d*m*5),b="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,v):v,S="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(S)}handleWrapJump(i){const o=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,o){const d={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+o),d[v.tileID.key]=v}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(i,o,d,m){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let v;if(this.updateCacheSize(i,o),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)v=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new s.am(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(0!==this.tileCoverLift){const z=i.clone();z.tileCoverLift=this.tileCoverLift,v=z.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===i.projection.name&&(v.push(new s.am(1,0,1,0,0)),v.push(new s.am(1,0,1,1,0)),v.push(new s.am(1,0,1,0,1)),v.push(new s.am(1,0,1,1,1)))}else v=i.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(v=v.filter(z=>this._source.hasTile(z)));else v=[];if(v.length>0&&this.castsShadows&&m&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Fo(this._source.type)){const z=i.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),H=Math.min(z,this._source.maxzoom),R=i.extendTileCoverForShadows(v,m,H);for(const B of R)this._shadowCasterTiles[B.key]=!0,v.push(B)}const b=this._updateRetainedTiles(v);if(Fo(this._source.type)&&0!==v.length){const z={},H={},R=Object.keys(b);for(const Y of R){const Q=b[Y],le=this._tiles[Y];if(!le||le.fadeEndTime&&le.fadeEndTime<=s.f.now())continue;const ce=this.findLoadedParent(Q,Math.max(Q.overscaledZ-za.maxOverzooming,this._source.minzoom));ce&&(this._addTile(ce.tileID),z[ce.tileID.key]=ce.tileID),H[Y]=Q}const B=v[v.length-1].overscaledZ;for(const Y in this._tiles){const Q=this._tiles[Y];if(b[Y]||!Q.hasData())continue;let le=Q.tileID;for(;le.overscaledZ>B;){le=le.scaledTo(le.overscaledZ-1);const ce=this._tiles[le.key];if(ce&&ce.hasData()&&H[le.key]){b[Y]=Q.tileID;break}}}for(const Y in z)b[Y]||(this._coveredTiles[Y]=!0,b[Y]=z[Y])}for(const z in b)this._tiles[z].clearFadeHold();const S=s.b0(this._tiles,b);for(const z of S){const H=this._tiles[z];H.hasSymbolBuckets&&!H.holdingForFade()?H.setHoldDuration(this.map._fadeDuration):H.hasSymbolBuckets&&!H.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const o={};if(0===i.length)return o;const d={},m=i.reduce((H,R)=>Math.min(H,R.overscaledZ),1/0),v=i[0].overscaledZ,b=Math.max(v-za.maxOverzooming,this._source.minzoom),S=Math.max(v+za.maxUnderzooming,this._source.minzoom),z={};for(const H of i){const R=this._addTile(H);o[H.key]=H,R.hasData()||m<this._source.maxzoom&&(z[H.key]=H)}this._retainLoadedChildren(z,m,S,o);for(const H of i){let R=this._tiles[H.key];if(R.hasData())continue;if(H.canonical.z>=this._source.maxzoom){const Y=H.children(this._source.maxzoom)[0],Q=this.getTile(Y);if(Q&&Q.hasData()){o[Y.key]=Y;continue}}else{const Y=H.children(this._source.maxzoom);if(o[Y[0].key]&&o[Y[1].key]&&o[Y[2].key]&&o[Y[3].key])continue}let B=R.wasRequested();for(let Y=H.overscaledZ-1;Y>=b;--Y){const Q=H.scaledTo(Y);if(d[Q.key]||(d[Q.key]=!0,R=this.getTile(Q),!R&&B&&(R=this._addTile(Q)),R&&(o[Q.key]=Q,B=R.wasRequested(),R.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let d,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}o.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;m=v}for(const v of o)this._loadedParentTiles[v]=d}}_addTile(i){let o=this._tiles[i.key];if(o)return!0!==o.isExtraShadowCaster||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const d=Boolean(o);if(!d){const m=this.map?this.map.painter:null,v=this._source.tileSize*i.overscaleFactor();o="raster-array"===this._source.type?new yo(i,v,this.transform.tileZoom,m,this._isRaster):new $s(i,v,this.transform.tileZoom,m,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,i.key,o.state))}return o?(o.uses++,this._tiles[i.key]=o,d||this._source.fire(new s.b("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const d=o.getExpiryTimeout();d&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},d))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&"reloading"!==o.state||"empty"===o.state?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,o,d){const m=[],v=this.transform;if(!v)return m;const b="globe"===v.projection.name,S=s.a5(v.center.lng);for(const z in this._tiles){const H=this._tiles[z];if(d&&H.clearQueryDebugViz(),H.holdingForFade())continue;let R;if(b){const B=H.tileID.canonical;if(0===B.z){const Y=[Math.abs(s.aa(S,...Xo(B,-1))-S),Math.abs(s.aa(S,...Xo(B,1))-S)];R=[0,2*Y.indexOf(Math.min(...Y))-1]}else{const Y=[Math.abs(s.aa(S,...Xo(B,-1))-S),Math.abs(s.aa(S,...Xo(B,0))-S),Math.abs(s.aa(S,...Xo(B,1))-S)];R=[Y.indexOf(Math.min(...Y))-1]}}else R=[0];for(const B of R){const Y=i.containsTile(H,v,o,B);Y&&m.push(Y)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,o){const d=this.getRenderableIds(i,o).map(v=>this._tiles[v].tileID),m="globe"===this.transform.projection.name;for(const v of d)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=m?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return d}sortCoordinatesByDistance(i){const o=i.slice(),d=this.transform._camera.position,m=this.transform._camera.forward(),v={};for(const b of o){const S=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*S+b.wrap-d[0])*m[0]+((b.canonical.y+.5)*S-d[1])*m[1]-d[2]*m[2]}return o.sort((b,S)=>v[b.key]-v[S.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Fo(this._source.type))for(const i in this._tiles){const o=this._tiles[i];if(void 0!==o.fadeEndTime&&o.fadeEndTime>=s.f.now())return!0}return!1}setFeatureState(i,o,d){this._state.updateState(i=i||"_geojsonTileLayer",o,d)}removeFeatureState(i,o,d){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,d)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,d){const m=this._tiles[i];m&&m.setDependencies(o,d)}reloadTilesForDependencies(i,o){for(const d in this._tiles)this._tiles[d].hasDependency(i,o)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(i,o))}_preloadTiles(i,o){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(i,o))};return void this._source.on("data",z)}const d=new Map,m=Array.isArray(i)?i:[i],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const z of m){const H=z.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of H)d.set(R.key,R);this.usedForTerrain&&z.updateElevation(!1)}const S=Array.from(d.values());s.b1(S,(z,H)=>{const R=new $s(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,B=>{"raster-dem"===this._source.type&&R.dem&&this._backfillDEM(R),H(B,R)})},o)}}function t1(h,i){const o=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*i.wrap)-+(i.wrap<0);return h.overscaledZ-i.overscaledZ||d-o||i.canonical.y-h.canonical.y||i.canonical.x-h.canonical.x}function Fo(h){return"raster"===h||"image"===h||"video"===h||"custom"===h}function Xo(h,i){const o=1<<h.z;return[h.x/o+i,(h.x+1)/o+i]}za.maxOverzooming=10,za.maxUnderzooming=3;class U1{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];for(const d in this.style._mergedLayers){const m=this.style._mergedLayers[d];if("fill-extrusion"===m.type)this.layers.push({layer:m,visible:false,visibilityChanged:false});else if("model"===m.type){const v=this.style.getLayerSource(m);v&&"batched-model"===v.type&&this.layers.push({layer:m,visible:false,visibilityChanged:false})}}}onNewFrame(i){this.layersGotHidden=!1;for(const o of this.layers){const d=o.layer;let m=!1;"fill-extrusion"===d.type?m=!d.isHidden(i)&&d.paint.get("fill-extrusion-opacity")>0:"model"===d.type&&(m=!d.isHidden(i)&&d.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!m&&o.visible,o.visible=m}}updateZOffset(i,o){this.currentBuildingBuckets=[];for(const m of this.layers){const v=m.layer,b=this.style.getLayerSourceCache(v);let S=1;"fill-extrusion"===v.type&&(S=m.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let z=b?b.getTile(o):null;if(!z&&b&&o.canonical.z>b.getSource().minzoom){let H=o.scaledTo(Math.min(b.getSource().maxzoom,o.overscaledZ-1));for(;H.overscaledZ>=b.getSource().minzoom&&(z=b.getTile(H),!z&&0!==H.overscaledZ);)H=H.scaledTo(H.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:z?z.getBucket(v):null,tileID:z?z.tileID:o,verticalScale:S})}i.hasAnyZOffset=!1;let d=!1;for(let m=0;m<i.symbolInstances.length;m++){const v=i.symbolInstances.get(m),b=v.zOffset,S=this._getHeightAtTileOffset(o,v.tileAnchorX,v.tileAnchorY);v.zOffset=S!==Number.NEGATIVE_INFINITY?S:b,d||b===v.zOffset||(d=!0),i.hasAnyZOffset||0===v.zOffset||(i.hasAnyZOffset=!0)}d&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,o,d,m){let v=o,b=d;if(i.canonical.z!==m.canonical.z){const S=m.canonical,z=1/(1<<i.canonical.z-S.z);v=(o+i.canonical.x*s.V)*z-S.x*s.V|0,b=(d+i.canonical.y*s.V)*z-S.y*s.V|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(i,o,d){let m,v;for(let b=0;b<this.layers.length;++b){if("fill-extrusion"!==this.layers[b].layer.type)continue;const{bucket:S,tileID:z,verticalScale:H}=this.currentBuildingBuckets[b];if(!S)continue;const{tileX:R,tileY:B}=this._mapCoordToOverlappingTile(i,o,d,z),Y=S.getHeightAtTileCoord(R,B);Y&&void 0!==Y.height&&(Y.hidden?m=Y.height:v=Math.max(Y.height*H,v||0))}if(void 0!==v)return v;for(let b=0;b<this.layers.length;++b){const S=this.layers[b];if("model"!==S.layer.type||!S.visible)continue;const{bucket:z,tileID:H}=this.currentBuildingBuckets[b];if(!z)continue;const{tileX:R,tileY:B}=this._mapCoordToOverlappingTile(i,o,d,H),Y=z.getHeightAtTileCoord(R,B);if(Y&&!Y.hidden)return void 0===Y.height&&void 0!==m?Math.min(Y.maxHeight,m)*Y.verticalScale:(Y.height||0)*Y.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Jo(h,i){const o={};for(const d in h)"ref"!==d&&(o[d]=h[d]);return s.b2.forEach(d=>{d in i&&(o[d]=i[d])}),o}function va(h){h=h.slice();const i=Object.create(null);for(let o=0;o<h.length;o++)i[h[o].id]=h[o];for(let o=0;o<h.length;o++)"ref"in h[o]&&(h[o]=Jo(h[o],i[h[o].ref]));return h}const cr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function To(h,i,o){o.push({command:cr.addSource,args:[h,i[h]]})}function Ba(h,i,o){i.push({command:cr.removeSource,args:[h]}),o[h]=!0}function D2(h,i,o,d){Ba(h,o,d),To(h,i,o)}function v1(h,i,o){let d;for(d in h[o])if(h[o].hasOwnProperty(d)&&"data"!==d&&!ct(h[o][d],i[o][d]))return!1;for(d in i[o])if(i[o].hasOwnProperty(d)&&"data"!==d&&!ct(h[o][d],i[o][d]))return!1;return!0}function Qo(h,i,o,d,m,v){let b;for(b in i=i||{},h=h||{})h.hasOwnProperty(b)&&(ct(h[b],i[b])||o.push({command:v,args:[d,b,i[b],m]}));for(b in i)i.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(ct(h[b],i[b])||o.push({command:v,args:[d,b,i[b],m]}))}function ao(h){return h.id}function Ua(h,i){return h[i.id]=i,h}class Ho{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=s.aa(i,0,1);let o=1,d=this._distances[o];const m=i*this.paddedLength+this.padding;for(;d<m&&o<this._distances.length;)d=this._distances[++o];const v=o-1,b=this._distances[v],S=d-b,z=S>0?(m-b)/S:0;return this.points[v].mult(1-z).add(this.points[o].mult(z))}}class j1{constructor(i,o,d){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/d),this.yCellCount=Math.ceil(o/d);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,d,m,v){this._forEachCell(o,d,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(i,o,d,m){this._forEachCell(o-m,d-m,o+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(d),this.circles.push(m)}_insertBoxCell(i,o,d,m,v,b){this.boxCells[v].push(b)}_insertCircleCell(i,o,d,m,v,b){this.circleCells[v].push(b)}_query(i,o,d,m,v,b){if(d<0||i>this.width||m<0||o>this.height)return!v&&[];const S=[];if(i<=0&&o<=0&&this.width<=d&&this.height<=m){if(v)return!0;for(let z=0;z<this.boxKeys.length;z++)S.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const H=this.circles[3*z],R=this.circles[3*z+1],B=this.circles[3*z+2];S.push({key:this.circleKeys[z],x1:H-B,y1:R-B,x2:H+B,y2:R+B})}return b?S.filter(b):S}return this._forEachCell(i,o,d,m,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?S.length>0:S}_queryCircle(i,o,d,m,v){const b=i-d,S=i+d,z=o-d,H=o+d;if(S<0||b>this.width||H<0||z>this.height)return!m&&[];const R=[];return this._forEachCell(b,z,S,H,this._queryCellCircle,R,{hitTest:m,circle:{x:i,y:o,radius:d},seenUids:{box:{},circle:{}}},v),m?R.length>0:R}query(i,o,d,m,v){return this._query(i,o,d,m,!1,v)}hitTest(i,o,d,m,v){return this._query(i,o,d,m,!0,v)}hitTestCircle(i,o,d,m){return this._queryCircle(i,o,d,!0,m)}_queryCell(i,o,d,m,v,b,S,z){const H=S.seenUids,R=this.boxCells[v];if(null!==R){const Y=this.bboxes;for(const Q of R)if(!H.box[Q]){H.box[Q]=!0;const le=4*Q;if(i<=Y[le+2]&&o<=Y[le+3]&&d>=Y[le+0]&&m>=Y[le+1]&&(!z||z(this.boxKeys[Q]))){if(S.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[Q],x1:Y[le],y1:Y[le+1],x2:Y[le+2],y2:Y[le+3]})}}}const B=this.circleCells[v];if(null!==B){const Y=this.circles;for(const Q of B)if(!H.circle[Q]){H.circle[Q]=!0;const le=3*Q;if(this._circleAndRectCollide(Y[le],Y[le+1],Y[le+2],i,o,d,m)&&(!z||z(this.circleKeys[Q]))){if(S.hitTest)return b.push(!0),!0;{const ce=Y[le],pe=Y[le+1],re=Y[le+2];b.push({key:this.circleKeys[Q],x1:ce-re,y1:pe-re,x2:ce+re,y2:pe+re})}}}}}_queryCellCircle(i,o,d,m,v,b,S,z){const H=S.circle,R=S.seenUids,B=this.boxCells[v];if(null!==B){const Q=this.bboxes;for(const le of B)if(!R.box[le]){R.box[le]=!0;const ce=4*le;if(this._circleAndRectCollide(H.x,H.y,H.radius,Q[ce+0],Q[ce+1],Q[ce+2],Q[ce+3])&&(!z||z(this.boxKeys[le])))return b.push(!0),!0}}const Y=this.circleCells[v];if(null!==Y){const Q=this.circles;for(const le of Y)if(!R.circle[le]){R.circle[le]=!0;const ce=3*le;if(this._circlesCollide(Q[ce],Q[ce+1],Q[ce+2],H.x,H.y,H.radius)&&(!z||z(this.circleKeys[le])))return b.push(!0),!0}}}_forEachCell(i,o,d,m,v,b,S,z){const H=this._convertToXCellCoord(i),R=this._convertToYCellCoord(o),B=this._convertToXCellCoord(d),Y=this._convertToYCellCoord(m);for(let Q=H;Q<=B;Q++)for(let le=R;le<=Y;le++)if(v.call(this,i,o,d,m,this.xCellCount*le+Q,b,S,z))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,d,m,v,b){const S=m-i,z=v-o,H=d+b;return H*H>S*S+z*z}_circleAndRectCollide(i,o,d,m,v,b,S){const z=(b-m)/2,H=Math.abs(i-(m+z));if(H>z+d)return!1;const R=(S-v)/2,B=Math.abs(o-(v+R));if(B>R+d)return!1;if(H<=z||B<=R)return!0;const Y=H-z,Q=B-R;return Y*Y+Q*Q<=d*d}}const Po={unknown:0,flipRequired:1,flipNotRequired:2},ya=Math.tan(85*Math.PI/180);function xo(h,i,o,d,m,v,b){const S=s.a6.create();if(o)if("globe"===v.name){const z=s.b3(m,i);s.a6.multiply(S,S,z)}else{const z=s.b4.invert([],b);S[0]=z[0],S[1]=z[1],S[4]=z[2],S[5]=z[3],d||s.a6.rotateZ(S,S,m.angle)}else s.a6.multiply(S,m.labelPlaneMatrix,h);return S}function y1(h,i,o,d,m,v,b){const S=xo(h,i,o,d,m,v,b);return"globe"===v.name&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function x1(h,i,o,d,m,v,b){if(o){if("globe"===v.name){const S=xo(h,i,o,d,m,v,b);return s.a6.invert(S,S),s.a6.multiply(S,h,S),S}{const S=s.a6.clone(h),z=s.a6.identity([]);return z[0]=b[0],z[1]=b[1],z[4]=b[2],z[5]=b[3],s.a6.multiply(S,S,z),d||s.a6.rotateZ(S,S,-m.angle),S}}return m.glCoordMatrix}function Ds(h,i,o,d){const m=[h,i,o,1];o?s.a7.transformMat4(m,m,d):po(m,m,d);const v=m[3];return m[0]/=v,m[1]/=v,m[2]/=v,m}function z1(h,i){return Math.min(.5+h/i*.5,1.5)}function bo(h,i){const o=h[0]/h[3],d=h[1]/h[3];return o>=-i[0]&&o<=i[0]&&d>=-i[1]&&d<=i[1]}function n1(h,i,o,d,m,v,b,S,z,H){const R=o.transform,B=d?h.textSizeData:h.iconSizeData,Y=s.b5(B,o.transform.zoom),Q="globe"===R.projection.name,le=[256/o.width*2+1,256/o.height*2+1],ce=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ce.clear();let pe=null;Q&&(pe=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const re=h.lineVertexArray,ve=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,Le=o.transform.width/o.transform.height;let Ce,ze=!1;for(let ge=0;ge<ve.length;ge++){const Ie=ve.get(ge),{numGlyphs:Qe,writingMode:nt}=Ie;if(nt!==s.b6.vertical||ze||Ce===s.b6.horizontal||(ze=!0),Ce=nt,(Ie.hidden||nt===s.b6.vertical)&&!ze){Zo(Qe,ce);continue}ze=!1;const dt=new s.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:$t,y:Ct,z:en}=R.projection.projectTilePoint(dt.x,dt.y,H.canonical);if(z){const[Yn,di,Ai]=z(dt);$t+=Yn,Ct+=di,en+=Ai}const Jt=[$t,Ct,en,1];if(s.a7.transformMat4(Jt,Jt,i),!bo(Jt,le)){Zo(Qe,ce);continue}const xn=Jt[3],Lt=z1(o.transform.getCameraToCenterDistance(R.projection),xn),Zt=s.b7(B,Y,Ie),ut=b?Zt/Lt:Zt*Lt,Nt=Ds($t,Ct,en,m);if(Nt[3]<=0){Zo(Qe,ce);continue}let Cn={};const Un=b?null:z,kn=xa(Ie,ut,!1,S,i,m,v,h.glyphOffsetArray,re,ce,pe,Nt,dt,Cn,Le,Un,R.projection,H,b);ze=kn.useVertical,Un&&kn.needsFlipping&&(Cn={}),(kn.notEnoughRoom||ze||kn.needsFlipping&&xa(Ie,ut,!0,S,i,m,v,h.glyphOffsetArray,re,ce,pe,Nt,dt,Cn,Le,Un,R.projection,H,b).notEnoughRoom)&&Zo(Qe,ce)}d?(h.text.dynamicLayoutVertexBuffer.updateData(ce),pe&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(pe)):(h.icon.dynamicLayoutVertexBuffer.updateData(ce),pe&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(pe))}function r1(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce){const{lineStartIndex:pe,glyphStartIndex:re,segment:ve}=S,Le=re+S.numGlyphs,Ce=pe+S.lineLength,ze=i.getoffsetX(re),ge=i.getoffsetX(Le-1),Ie=ja(h*ze,o,d,m,v,b,ve,pe,Ce,z,H,R,B,Y,!0,Q,le,ce);if(!Ie)return null;const Qe=ja(h*ge,o,d,m,v,b,ve,pe,Ce,z,H,R,B,Y,!0,Q,le,ce);return Qe?{first:Ie,last:Qe}:null}function Ws(h,i,o,d){return h===s.b6.horizontal&&Math.abs(d)>Math.abs(o)?{useVertical:!0}:h===s.b6.vertical?d>0?{needsFlipping:!0}:null:i!==Po.unknown&&(0===(m=o)||Math.abs(d/m)>ya)?i===Po.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null;var m}function xa(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe,re,ve){const Le=i/24,Ce=h.lineOffsetX*Le,ze=h.lineOffsetY*Le,{lineStartIndex:ge,glyphStartIndex:Ie,numGlyphs:Qe,segment:nt,writingMode:dt,flipState:$t}=h,Ct=ge+h.lineLength,en=Jt=>{if(R){const[ut,Nt,Cn]=Jt.up,Un=H.length;s.b8(R,Un+0,ut,Nt,Cn),s.b8(R,Un+1,ut,Nt,Cn),s.b8(R,Un+2,ut,Nt,Cn),s.b8(R,Un+3,ut,Nt,Cn)}const[xn,Lt,Zt]=Jt.point;s.b9(H,xn,Lt,Zt,Jt.angle)};if(Qe>1){const Jt=r1(Le,S,Ce,ze,o,B,Y,h,z,v,Q,ce,!1,pe,re,ve);if(!Jt)return{notEnoughRoom:!0};if(d&&!o){let[xn,Lt,Zt]=Jt.first.point,[ut,Nt,Cn]=Jt.last.point;[xn,Lt]=Ds(xn,Lt,Zt,b),[ut,Nt]=Ds(ut,Nt,Cn,b);const Un=Ws(dt,$t,(ut-xn)*le,Nt-Lt);if(h.flipState=Un&&Un.needsFlipping?Po.flipRequired:Po.flipNotRequired,Un)return Un}en(Jt.first);for(let xn=Ie+1;xn<Ie+Qe-1;xn++){const Lt=ja(Le*S.getoffsetX(xn),Ce,ze,o,B,Y,nt,ge,Ct,z,v,Q,ce,!1,!1,pe,re,ve);if(!Lt)return H.length-=4*(xn-Ie),{notEnoughRoom:!0};en(Lt)}en(Jt.last)}else{if(d&&!o){const xn=Ds(Y.x,Y.y,0,m),Lt=ge+nt+1,Zt=new s.P(z.getx(Lt),z.gety(Lt)),ut=Ds(Zt.x,Zt.y,0,m),Nt=ut[3]>0?ut:co(Y,Zt,xn,1,m,void 0,pe,re.canonical),Cn=Ws(dt,$t,(Nt[0]-xn[0])*le,Nt[1]-xn[1]);if(h.flipState=Cn&&Cn.needsFlipping?Po.flipRequired:Po.flipNotRequired,Cn)return Cn}const Jt=ja(Le*S.getoffsetX(Ie),Ce,ze,o,B,Y,nt,ge,Ct,z,v,Q,ce,!1,!1,pe,re,ve);if(!Jt)return{notEnoughRoom:!0};en(Jt)}return{}}function ea(h,i,o,d,m){const{x:v,y:b,z:S}=d.projectTilePoint(h.x,h.y,i);if(!m)return Ds(v,b,S,o);const[z,H,R]=m(h);return Ds(v+z,b+H,S+R,o)}function co(h,i,o,d,m,v,b,S){const z=ea(h.sub(i)._unit()._add(h),S,m,b,v);return s.N.sub(z,o,z),s.N.normalize(z,z),s.N.scaleAndAdd(z,o,z,d)}function ja(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe,re){const ve=d?h-i:h+i;let Le=ve>0?1:-1,Ce=0;d&&(Le*=-1,Ce=Math.PI),Le<0&&(Ce+=Math.PI);let ze=S+b+(Le>0?0:1)|0,ge=m,Ie=m,Qe=0,nt=0;const dt=Math.abs(ve),$t=[],Ct=[];let en=v,Jt=en;const xn=()=>co(Jt,en,Ie,dt-Qe+1,R,Y,ce,pe.canonical);for(;Qe+nt<=dt;){if(ze+=Le,ze<S||ze>=z)return null;if(Ie=ge,Jt=en,$t.push(Ie),Q&&Ct.push(Jt),en=new s.P(H.getx(ze),H.gety(ze)),ge=B[ze],!ge){const di=ea(en,pe.canonical,R,ce,Y);ge=di[3]>0?B[ze]=di:xn()}Qe+=nt,nt=s.N.distance(Ie,ge)}le&&Y&&(B[ze]&&(ge=xn(),nt=s.N.distance(Ie,ge)),B[ze]=ge);const Lt=(dt-Qe)/nt,Zt=en.sub(Jt)._mult(Lt)._add(Jt),ut=s.N.sub([],ge,Ie),Nt=s.N.scaleAndAdd([],Ie,ut,Lt);let Cn=[0,0,1],Un=ut[0],kn=ut[1];if(re&&(Cn=ce.upVector(pe.canonical,Zt.x,Zt.y),0!==Cn[0]||0!==Cn[1]||1!==Cn[2])){const di=[Cn[2],0,-Cn[0]],Ai=s.N.cross([],Cn,di);s.N.normalize(di,di),s.N.normalize(Ai,Ai),Un=s.N.dot(ut,di),kn=s.N.dot(ut,Ai)}if(o){const di=s.N.cross([],Cn,ut);s.N.normalize(di,di),s.N.scaleAndAdd(Nt,Nt,di,o*Le)}const Yn=Ce+Math.atan2(kn,Un);return $t.push(Nt),Q&&Ct.push(Zt),{point:Nt,angle:Yn,path:$t,tilePath:Ct,up:Cn}}function Zo(h,i){const o=i.length,d=o+4*h;i.resize(d),i.float32.fill(-1/0,4*o,4*d)}function po(h,i,o){const d=i[0],m=i[1];return h[0]=o[0]*d+o[4]*m+o[12],h[1]=o[1]*d+o[5]*m+o[13],h[3]=o[3]*d+o[7]*m+o[15],h}const Ss=100;class Rn{constructor(i,o,d=new j1(i.width+200,i.height+200,25),m=new j1(i.width+200,i.height+200,25)){this.transform=i,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ss,this.screenBottomBoundary=i.height+Ss,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,d,m,v,b,S,z){let H=d.projectedAnchorX,R=d.projectedAnchorY,B=d.projectedAnchorZ;const Y=d.elevation,Q=d.tileID,le=i.getProjection();if(Y&&Q){const[ge,Ie,Qe]=le.upVector(Q.canonical,d.tileAnchorX,d.tileAnchorY),nt=le.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=ge*Y*nt,R+=Ie*Y*nt,B+=Qe*Y*nt}const ce=this.projectAndGetPerspectiveRatio(S,H,R,B,d.tileID,"globe"===le.name||!!Y||this.transform.pitch>0,le),pe=b*ce.perspectiveRatio,re=(d.x1*o+m.x-d.padding)*pe+ce.point.x,ve=(d.y1*o+m.y-d.padding)*pe+ce.point.y,Le=(d.x2*o+m.x+d.padding)*pe+ce.point.x,Ce=(d.y2*o+m.y+d.padding)*pe+ce.point.y,ze=ce.perspectiveRatio<=.55||ce.occluded;return!this.isInsideGrid(re,ve,Le,Ce)||!v&&this.grid.hitTest(re,ve,Le,Ce,z)||ze?{box:[],offscreen:!1,occluded:ce.occluded}:{box:[re,ve,Le,Ce],offscreen:this.isOffscreen(re,ve,Le,Ce),occluded:!1}}placeCollisionCircles(i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce){const pe=[],re=this.transform.elevation,ve=i.getProjection(),Le=re?re.getAtTileOffsetFunc(ce,this.transform.center.lat,this.transform.worldSize,ve):null,Ce=new s.P(d.tileAnchorX,d.tileAnchorY);let{x:ze,y:ge,z:Ie}=ve.projectTilePoint(Ce.x,Ce.y,ce.canonical);if(Le){const[Zt,ut,Nt]=Le(Ce);ze+=Zt,ge+=ut,Ie+=Nt}const Qe="globe"===ve.name,nt=this.projectAndGetPerspectiveRatio(S,ze,ge,Ie,ce,Qe||!!re||this.transform.pitch>0,ve),{perspectiveRatio:dt}=nt,$t=(B?b/dt:b*dt)/s.bc,Ct=Ds(ze,ge,Ie,z),en=nt.signedDistanceFromCamera>0?r1($t,v,d.lineOffsetX*$t,d.lineOffsetY*$t,!1,Ct,Ce,d,m,z,{},re&&!B?Le:null,B&&!!re,ve,ce,B):null;let Jt=!1,xn=!1,Lt=!0;if(en&&!nt.occluded){const Zt=.5*Q*dt+le,ut=new s.P(-100,-100),Nt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Cn=new Ho,{first:Un,last:kn}=en,Yn=Un.path.length;let di=[];for(let bi=Yn-1;bi>=1;bi--)di.push(Un.path[bi]);for(let bi=1;bi<kn.path.length;bi++)di.push(kn.path[bi]);const Ai=2.5*Zt;H&&(di=di.map(([bi,ur,ar],yr)=>(Le&&!Qe&&(ar=Le(yr<Yn-1?Un.tilePath[Yn-1-yr]:kn.tilePath[yr-Yn+2])[2]),Ds(bi,ur,ar,H))),di.some(bi=>bi[3]<=0)&&(di=[]));let xi=[];if(di.length>0){let bi=1/0,ur=-1/0,ar=1/0,yr=-1/0;for(const mr of di)bi=Math.min(bi,mr[0]),ar=Math.min(ar,mr[1]),ur=Math.max(ur,mr[0]),yr=Math.max(yr,mr[1]);ur>=ut.x&&bi<=Nt.x&&yr>=ut.y&&ar<=Nt.y&&(xi=[di.map(mr=>new s.P(mr[0],mr[1]))],(bi<ut.x||ur>Nt.x||ar<ut.y||yr>Nt.y)&&(xi=s.ba(xi,ut.x,ut.y,Nt.x,Nt.y)))}for(const bi of xi){Cn.reset(bi,.25*Zt);let ur=0;ur=Cn.length<=.5*Zt?1:Math.ceil(Cn.paddedLength/Ai)+1;for(let ar=0;ar<ur;ar++){const yr=ar/Math.max(ur-1,1),mr=Cn.lerp(yr),Yr=mr.x+Ss,Is=mr.y+Ss;pe.push(Yr,Is,Zt,0);const xr=Yr-Zt,Us=Is-Zt,kr=Yr+Zt,ts=Is+Zt;if(Lt=Lt&&this.isOffscreen(xr,Us,kr,ts),xn=xn||this.isInsideGrid(xr,Us,kr,ts),!o&&this.grid.hitTestCircle(Yr,Is,Zt,Y)&&(Jt=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Jt,occluded:!1}}}}return{circles:!R&&Jt||!xn?[]:pe,offscreen:Lt,collisionDetected:Jt,occluded:nt.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const o=[];let d=1/0,m=1/0,v=-1/0,b=-1/0;for(const R of i){const B=new s.P(R.x+Ss,R.y+Ss);d=Math.min(d,B.x),m=Math.min(m,B.y),v=Math.max(v,B.x),b=Math.max(b,B.y),o.push(B)}const S=this.grid.query(d,m,v,b).concat(this.ignoredGrid.query(d,m,v,b)),z={},H={};for(const R of S){const B=R.key;if(void 0===z[B.bucketInstanceId]&&(z[B.bucketInstanceId]={}),z[B.bucketInstanceId][B.featureIndex])continue;const Y=[new s.P(R.x1,R.y1),new s.P(R.x2,R.y1),new s.P(R.x2,R.y2),new s.P(R.x1,R.y2)];s.bb(o,Y)&&(z[B.bucketInstanceId][B.featureIndex]=!0,void 0===H[B.bucketInstanceId]&&(H[B.bucketInstanceId]=[]),H[B.bucketInstanceId].push(B.featureIndex))}return H}insertCollisionBox(i,o,d,m,v){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,d,m,v){const b=o?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:m,collisionGroupID:v};for(let z=0;z<i.length;z+=4)b.insertCircle(S,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,o,d,m,v,b,S){const z=[o,d,m,1];let H=!1;m||this.transform.pitch>0?(s.a7.transformMat4(z,z,i),this.fogState&&v&&"globe"!==S.name&&(H=function(Y,Q,le,ce,pe,re){const ve=re.calculateFogTileMatrix(pe),Le=[Q,le,ce];return s.N.transformMat4(Le,Le,ve),ri(Y,s.N.length(Le),re.pitch,re._fov)}(this.fogState,o,d,m,v.toUnwrapped(),this.transform)>.9)):po(z,z,i);const R=z[3];return{point:new s.P((z[0]/R+1)/2*this.transform.width+Ss,(-z[1]/R+1)/2*this.transform.height+Ss),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/R*.5,1.5),signedDistanceFromCamera:R,occluded:b&&z[2]>R||H}}isOffscreen(i,o,d,m){return d<Ss||i>=this.screenRightBoundary||m<Ss||o>this.screenBottomBoundary}isInsideGrid(i,o,d,m){return d>=0&&i<this.gridRightBoundary&&m>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=s.a6.identity([]);return s.a6.translate(i,i,[-100,-100,0]),i}}function s1(h,i,o){const d=i.createTileMatrix(h,h.worldSize,o.toUnwrapped());return s.a6.multiply(new Float32Array(16),h.projMatrix,d)}function A1(h,i,o){if(i.projection.name===o.projection.name)return h.projMatrix;const d=o.clone();return d.setProjection(i.projection),s1(d,i.getProjection(),h)}function lo(h,i,o){return i.name===o.projection.name?h.projMatrix:s1(o,i,h)}class Ga{constructor(i,o,d,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):m&&d?1:0,this.placed=d}isHidden(){return 0===this.opacity&&!this.placed}}class aa{constructor(i,o,d,m,v,b=!1){this.text=new Ga(i?i.text:null,o,d,v),this.icon=new Ga(i?i.icon:null,o,m,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sr{constructor(i,o,d,m=!1){this.text=i,this.icon=o,this.skipFade=d,this.clipped=m}}class ca{constructor(){this.invProjMatrix=s.a6.create(),this.viewportMatrix=s.a6.create(),this.circles=[]}}class la{constructor(i,o,d,m,v){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=v}}class G1{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:d=>d.collisionGroupID===o}}return this.collisionGroups[i]}}function $a(h,i,o,d,m){const{horizontalAlign:v,verticalAlign:b}=s.bf(h),S=-(v-.5)*i,z=-(b-.5)*o,H=s.bd(h,d);return new s.P(S+H[0]*m,z+H[1]*m)}function se(h,i,o,d,m){const v=new s.P(h,i);return o&&v._rotate(d?m:-m),v}class ne{constructor(i,o,d,m,v,b){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Rn(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new G1(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,d,m){const v=d.getBucket(o),b=d.latestFeatureIndex;if(!v||!b||o.fqid!==v.layerIds[0])return;const S=v.layers[0].layout,z=d.collisionBoxArray,H=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),R=d.tileSize/s.V,B=d.tileID.toUnwrapped();this.transform.setProjection(v.projection);const Y=(Q=d.tileID,le=v.getProjection(),ce=this.transform,le.name===this.projection?ce.calculateProjMatrix(Q.toUnwrapped()):s1(ce,le,Q));var Q,le,ce;const pe="map"===S.get("text-pitch-alignment"),re="map"===S.get("text-rotation-alignment");o.compileFilter();const ve=o.dynamicFilter(),Le=o.dynamicFilterNeedsFeature(),Ce=this.transform.calculatePixelsToTileUnitsMatrix(d),ze=y1(Y,d.tileID.canonical,pe,re,this.transform,v.getProjection(),Ce);let ge=null;if(pe){const nt=x1(Y,d.tileID.canonical,pe,re,this.transform,v.getProjection(),Ce);ge=s.a6.multiply([],this.transform.labelPlaneMatrix,nt)}let Ie=null;ve&&d.latestFeatureIndex&&(Ie={unwrappedTileID:B,dynamicFilter:ve,dynamicFilterNeedsFeature:Le,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new la(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,d.tileID);const Qe={bucket:v,layout:S,posMatrix:Y,textLabelPlaneMatrix:ze,labelToScreenMatrix:ge,clippingData:Ie,scale:H,textPixelRatio:R,holdingForFade:d.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:s.b5(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.b5(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const nt of v.sortKeyRanges){const{sortKey:dt,symbolInstanceStart:$t,symbolInstanceEnd:Ct}=nt;i.push({sortKey:dt,symbolInstanceStart:$t,symbolInstanceEnd:Ct,parameters:Qe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Qe})}attemptAnchorPlacement(i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe,re,ve){const{textOffset0:Le,textOffset1:Ce,crossTileID:ze}=Y,ge=[Le,Ce],Ie=$a(i,d,m,ge,v),Qe=this.collisionIndex.placeCollisionBox(le,v,o,se(Ie.x,Ie.y,b,S,this.transform.angle),B,z,H,R.predicate);if(pe){const nt=le.getSymbolInstanceIconSize(ve,this.transform.zoom,Y.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(le,nt,pe,se(Ie.x,Ie.y,b,S,this.transform.angle),B,z,H,R.predicate).box.length)return}if(Qe.box.length>0){let nt;return this.prevPlacement&&this.prevPlacement.variableOffsets[ze]&&this.prevPlacement.placements[ze]&&this.prevPlacement.placements[ze].text&&(nt=this.prevPlacement.variableOffsets[ze].anchor),this.variableOffsets[ze]={textOffset:ge,width:d,height:m,anchor:i,textScale:v,prevAnchor:nt},this.markUsedJustification(le,i,Y,ce),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ce,Y),this.placedOrientations[ze]=ce),{shift:Ie,placedGlyphBoxes:Qe}}}placeLayerBucketPart(i,o,d,m){const{bucket:v,layout:b,posMatrix:S,textLabelPlaneMatrix:z,labelToScreenMatrix:H,clippingData:R,textPixelRatio:B,holdingForFade:Y,collisionBoxArray:Q,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:ce,collisionGroup:pe}=i.parameters,re=b.get("text-optional"),ve=b.get("icon-optional"),Le=b.get("text-allow-overlap"),Ce=b.get("icon-allow-overlap"),ze="map"===b.get("text-rotation-alignment"),ge="map"===b.get("text-pitch-alignment"),Ie="viewport-y"===b.get("symbol-z-order"),Qe=b.get("symbol-z-elevate");this.transform.setProjection(v.projection);let nt=Le&&(Ce||!v.hasIconData()||ve),dt=Ce&&(Le||!v.hasTextData()||re);!v.collisionArrays&&Q&&v.deserializeCollisionBoxes(Q),d&&m&&v.updateCollisionDebugBuffers(this.transform.zoom,Q);const $t=(Ct,en,Jt)=>{const{crossTileID:xn,numVerticalGlyphVertices:Lt}=Ct;if(R){const kr={zoom:this.transform.zoom,pitch:this.transform.pitch};let ts=null;if(R.dynamicFilterNeedsFeature){const Rr=this.retainedQueryData[v.bucketInstanceId];ts=R.featureIndex.loadFeature({featureIndex:Ct.featureIndex,bucketIndex:Rr.bucketIndex,sourceLayerIndex:Rr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(kr,ts,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new s.P(Ct.tileAnchorX,Ct.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[xn]=new sr(!1,!1,!1,!0),void o.add(xn)}if(o.has(xn))return;if(Y)return void(this.placements[xn]=new sr(!1,!1,!1));let Zt=!1,ut=!1,Nt=!0,Cn=!1,Un=!1,kn=null,Yn={box:null,offscreen:null,occluded:null},di={box:null,offscreen:null,occluded:null},Ai=null,xi=null,bi=null,ur=0,ar=0,yr=0;Jt.textFeatureIndex?ur=Jt.textFeatureIndex:Ct.useRuntimeCollisionCircles&&(ur=Ct.featureIndex),Jt.verticalTextFeatureIndex&&(ar=Jt.verticalTextFeatureIndex);const mr=kr=>{kr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const ts=this.transform.elevation;kr.elevation=Ct.zOffset+(ts?ts.getAtTileOffset(kr.tileID,kr.tileAnchorX,kr.tileAnchorY):0)},Yr=Jt.textBox;if(Yr){mr(Yr);const kr=Rr=>{let Jr=s.b6.horizontal;if(v.allowVerticalPlacement&&!Rr&&this.prevPlacement){const Ys=this.prevPlacement.placedOrientations[xn];Ys&&(this.placedOrientations[xn]=Ys,Jr=Ys,this.markUsedOrientation(v,Jr,Ct))}return Jr},ts=(Rr,Jr)=>{if(v.allowVerticalPlacement&&Lt>0&&Jt.verticalTextBox){for(const Ys of v.writingModes)if(Ys===s.b6.vertical?(Yn=Jr(),di=Yn):Yn=Rr(),Yn&&Yn.box&&Yn.box.length)break}else Yn=Rr()};if(b.get("text-variable-anchor")){let Rr=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xn]){const ss=this.prevPlacement.variableOffsets[xn];Rr.indexOf(ss.anchor)>0&&(Rr=Rr.filter(pa=>pa!==ss.anchor),Rr.unshift(ss.anchor))}const Jr=(ss,pa,p1)=>{const k1=v.getSymbolInstanceTextSize(le,Ct,this.transform.zoom,en),G2=(ss.x2-ss.x1)*k1+2*ss.padding,Y1=(ss.y2-ss.y1)*k1+2*ss.padding,ra=Ct.hasIconTextFit&&!Ce?pa:null;ra&&mr(ra);let no={box:[],offscreen:!1,occluded:!1};const ka=Le?2*Rr.length:Rr.length;for(let m1=0;m1<ka;++m1){const R1=this.attemptAnchorPlacement(Rr[m1%Rr.length],ss,G2,Y1,k1,ze,ge,B,S,pe,m1>=Rr.length,Ct,en,v,p1,ra,le,ce);if(R1&&(no=R1.placedGlyphBoxes,no&&no.box&&no.box.length)){Zt=!0,kn=R1.shift;break}}return no};ts(()=>Jr(Yr,Jt.iconBox,s.b6.horizontal),()=>{const ss=Jt.verticalTextBox;return ss&&mr(ss),v.allowVerticalPlacement&&!(Yn&&Yn.box&&Yn.box.length)&&Lt>0&&ss?Jr(ss,Jt.verticalIconBox,s.b6.vertical):{box:null,offscreen:null,occluded:null}}),Yn&&(Zt=Yn.box,Nt=Yn.offscreen,Cn=Yn.occluded);const Ys=kr(!(!Yn||!Yn.box));if(!Zt&&this.prevPlacement){const ss=this.prevPlacement.variableOffsets[xn];ss&&(this.variableOffsets[xn]=ss,this.markUsedJustification(v,ss.anchor,Ct,Ys))}}else{const Rr=(Jr,Ys)=>{const ss=v.getSymbolInstanceTextSize(le,Ct,this.transform.zoom,en),pa=this.collisionIndex.placeCollisionBox(v,ss,Jr,new s.P(0,0),Le,B,S,pe.predicate);return pa&&pa.box&&pa.box.length&&(this.markUsedOrientation(v,Ys,Ct),this.placedOrientations[xn]=Ys),pa};ts(()=>Rr(Yr,s.b6.horizontal),()=>{const Jr=Jt.verticalTextBox;return v.allowVerticalPlacement&&Lt>0&&Jr?(mr(Jr),Rr(Jr,s.b6.vertical)):{box:null,offscreen:null,occluded:null}}),kr(!!(Yn&&Yn.box&&Yn.box.length))}}if(Ai=Yn,Zt=Ai&&Ai.box&&Ai.box.length>0,Nt=Ai&&Ai.offscreen,Cn=Ai&&Ai.occluded,Ct.useRuntimeCollisionCircles){const kr=v.text.placedSymbolArray.get(Ct.centerJustifiedTextSymbolIndex>=0?Ct.centerJustifiedTextSymbolIndex:Ct.verticalPlacedTextSymbolIndex),ts=s.b7(v.textSizeData,le,kr),Rr=b.get("text-padding");xi=this.collisionIndex.placeCollisionCircles(v,Le,kr,v.lineVertexArray,v.glyphOffsetArray,ts,S,z,H,d,ge,pe.predicate,Ct.collisionCircleDiameter*ts/s.bc,Rr,this.retainedQueryData[v.bucketInstanceId].tileID),Zt=Le||xi.circles.length>0&&!xi.collisionDetected,Nt=Nt&&xi.offscreen,Cn=xi.occluded}if(Jt.iconFeatureIndex&&(yr=Jt.iconFeatureIndex),Jt.iconBox){const kr=ts=>{mr(ts);const Rr=Ct.hasIconTextFit&&kn?se(kn.x,kn.y,ze,ge,this.transform.angle):new s.P(0,0),Jr=v.getSymbolInstanceIconSize(ce,this.transform.zoom,Ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Jr,ts,Rr,Ce,B,S,pe.predicate)};di&&di.box&&di.box.length&&Jt.verticalIconBox?(bi=kr(Jt.verticalIconBox),ut=bi.box.length>0):(bi=kr(Jt.iconBox),ut=bi.box.length>0),Nt=Nt&&bi.offscreen,Un=bi.occluded}const Is=re||0===Ct.numHorizontalGlyphVertices&&0===Lt,xr=ve||0===Ct.numIconVertices;if(Is||xr?xr?Is||(ut=ut&&Zt):Zt=ut&&Zt:ut=Zt=ut&&Zt,Zt&&Ai&&Ai.box&&this.collisionIndex.insertCollisionBox(Ai.box,b.get("text-ignore-placement"),v.bucketInstanceId,di&&di.box&&ar?ar:ur,pe.ID),ut&&bi&&this.collisionIndex.insertCollisionBox(bi.box,b.get("icon-ignore-placement"),v.bucketInstanceId,yr,pe.ID),xi&&(Zt&&this.collisionIndex.insertCollisionCircles(xi.circles,b.get("text-ignore-placement"),v.bucketInstanceId,ur,pe.ID),d)){const kr=v.bucketInstanceId;let ts=this.collisionCircleArrays[kr];void 0===ts&&(ts=this.collisionCircleArrays[kr]=new ca);for(let Rr=0;Rr<xi.circles.length;Rr+=4)ts.circles.push(xi.circles[Rr+0]),ts.circles.push(xi.circles[Rr+1]),ts.circles.push(xi.circles[Rr+2]),ts.circles.push(xi.collisionDetected?1:0)}const Us="globe"!==v.projection.name;nt=nt&&(Us||!Cn),dt=dt&&(Us||!Un),this.placements[xn]=new sr(Zt||nt,ut||dt,Nt||v.justReloaded),o.add(xn)};if(Qe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),Ie){const Ct=v.getSortedSymbolIndexes(this.transform.angle);for(let en=Ct.length-1;en>=0;--en){const Jt=Ct[en];$t(v.symbolInstances.get(Jt),Jt,v.collisionArrays[Jt])}v.hasAnyZOffset&&s.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Ct=v.getSortedIndexesByZOffset();for(let en=0;en<Ct.length;++en){const Jt=Ct[en];$t(v.symbolInstances.get(Jt),Jt,v.collisionArrays[Jt])}}else for(let Ct=i.symbolInstanceStart;Ct<i.symbolInstanceEnd;Ct++)$t(v.symbolInstances.get(Ct),Ct,v.collisionArrays[Ct]);if(d&&v.bucketInstanceId in this.collisionCircleArrays){const Ct=this.collisionCircleArrays[v.bucketInstanceId];s.a6.invert(Ct.invProjMatrix,S),Ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,o,d,m){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:z,crossTileID:H}=d,R=s.be(o),B=m===s.b6.vertical?z:"left"===R?v:"center"===R?b:"right"===R?S:-1;v>=0&&(i.text.placedSymbolArray.get(v).crossTileID=B>=0&&v!==B?0:H),b>=0&&(i.text.placedSymbolArray.get(b).crossTileID=B>=0&&b!==B?0:H),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:H),z>=0&&(i.text.placedSymbolArray.get(z).crossTileID=B>=0&&z!==B?0:H)}markUsedOrientation(i,o,d){const m=o===s.b6.horizontal||o===s.b6.horizontalOnly?o:0,v=o===s.b6.vertical?o:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:H}=d,R=i.text.placedSymbolArray;b>=0&&(R.get(b).placedOrientation=m),S>=0&&(R.get(S).placedOrientation=m),z>=0&&(R.get(z).placedOrientation=m),H>=0&&(R.get(H).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let d=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const m=o?o.symbolFadeChange(i):1,v=o?o.opacities:{},b=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const z in this.placements){const H=this.placements[z],R=v[z];R?(this.opacities[z]=new aa(R,m,H.text,H.icon,null,H.clipped),d=d||H.text!==R.text.placed||H.icon!==R.icon.placed):(this.opacities[z]=new aa(null,m,H.text,H.icon,H.skipFade,H.clipped),d=d||H.text||H.icon)}for(const z in v){const H=v[z];if(!this.opacities[z]){const R=new aa(H,m,!1,!1);R.isHidden()||(this.opacities[z]=R,d=d||H.text.placed||H.icon.placed)}}for(const z in b)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=b[z]);for(const z in S)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=S[z]);d?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const d=new Set;for(const m of o){const v=m.getBucket(i);v&&m.latestFeatureIndex&&i.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,d,m.collisionBoxArray),v.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,m.tileID),v.updateZOffset()))}}updateBucketOpacities(i,o,d){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const m=i.layers[0].layout,v=!!i.layers[0].dynamicFilter(),b=new aa(null,0,!1,!1,!0),S=m.get("text-allow-overlap"),z=m.get("icon-allow-overlap"),H=m.get("text-variable-anchor"),R="map"===m.get("text-rotation-alignment"),B="map"===m.get("text-pitch-alignment"),Y=new aa(null,0,S&&(z||!i.hasIconData()||m.get("icon-optional")),z&&(S||!i.hasTextData()||m.get("text-optional")),!0);!i.collisionArrays&&d&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(d);const Q=(ce,pe,re)=>{for(let ve=0;ve<pe/4;ve++)ce.opacityVertexArray.emplaceBack(re)};let le=0;for(let ce=0;ce<i.symbolInstances.length;ce++){const pe=i.symbolInstances.get(ce),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ve,crossTileID:Le,numIconVertices:Ce}=pe,ze=o.has(Le);let ge=this.opacities[Le];ze?ge=b:ge||(ge=Y,this.opacities[Le]=ge),o.add(Le);const Ie=re>0||ve>0,Qe=Ce>0,nt=this.placedOrientations[Le],dt=nt===s.b6.vertical,$t=nt===s.b6.horizontal||nt===s.b6.horizontalOnly;if(!Ie&&!Qe||ge.isHidden()||le++,Ie){const Ct=Yo(ge.text);Q(i.text,re,dt?qs:Ct),Q(i.text,ve,$t?qs:Ct);const en=ge.text.isHidden(),{leftJustifiedTextSymbolIndex:Jt,centerJustifiedTextSymbolIndex:xn,rightJustifiedTextSymbolIndex:Lt,verticalPlacedTextSymbolIndex:Zt}=pe,ut=i.text.placedSymbolArray,Nt=en||dt?1:0;Jt>=0&&(ut.get(Jt).hidden=Nt),xn>=0&&(ut.get(xn).hidden=Nt),Lt>=0&&(ut.get(Lt).hidden=Nt),Zt>=0&&(ut.get(Zt).hidden=en||$t?1:0);const Cn=this.variableOffsets[Le];Cn&&this.markUsedJustification(i,Cn.anchor,pe,nt);const Un=this.placedOrientations[Le];Un&&(this.markUsedJustification(i,"left",pe,Un),this.markUsedOrientation(i,Un,pe))}if(Qe){const Ct=Yo(ge.icon),{placedIconSymbolIndex:en,verticalPlacedIconSymbolIndex:Jt}=pe,xn=i.icon.placedSymbolArray,Lt=ge.icon.isHidden()?1:0;en>=0&&(Q(i.icon,Ce,dt?qs:Ct),xn.get(en).hidden=Lt),Jt>=0&&(Q(i.icon,pe.numVerticalIconVertices,$t?qs:Ct),xn.get(Jt).hidden=Lt)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ct=i.collisionArrays[ce];if(Ct){let en=new s.P(0,0),Jt=!0;if(Ct.textBox||Ct.verticalTextBox){if(H){const Lt=this.variableOffsets[Le];Lt?(en=$a(Lt.anchor,Lt.width,Lt.height,Lt.textOffset,Lt.textScale),R&&en._rotate(B?this.transform.angle:-this.transform.angle)):Jt=!1}v&&(Jt=!ge.clipped),Ct.textBox&&X(i.textCollisionBox.collisionVertexArray,ge.text.placed,!Jt||dt,en.x,en.y),Ct.verticalTextBox&&X(i.textCollisionBox.collisionVertexArray,ge.text.placed,!Jt||$t,en.x,en.y)}const xn=Jt&&Boolean(!$t&&Ct.verticalIconBox);Ct.iconBox&&X(i.iconCollisionBox.collisionVertexArray,ge.icon.placed,xn,pe.hasIconTextFit?en.x:0,pe.hasIconTextFit?en.y:0),Ct.verticalIconBox&&X(i.iconCollisionBox.collisionVertexArray,ge.icon.placed,!xn,pe.hasIconTextFit?en.x:0,pe.hasIconTextFit?en.y:0)}}}if(i.fullyClipped=0===le,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ce.invProjMatrix,i.placementViewportMatrix=ce.viewportMatrix,i.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const d=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*d>i}setStale(){this.stale=!0}}function X(h,i,o,d,m){h.emplaceBack(i?1:0,o?1:0,d||0,m||0),h.emplaceBack(i?1:0,o?1:0,d||0,m||0),h.emplaceBack(i?1:0,o?1:0,d||0,m||0),h.emplaceBack(i?1:0,o?1:0,d||0,m||0)}const Ve=Math.pow(2,25),lt=Math.pow(2,24),jn=Math.pow(2,17),ms=Math.pow(2,16),Eo=Math.pow(2,9),Hs=Math.pow(2,8),o1=Math.pow(2,1);function Yo(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const i=h.placed?1:0,o=Math.floor(127*h.opacity);return o*Ve+i*lt+o*jn+i*ms+o*Eo+i*Hs+o*o1+i}const qs=0;class ba{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,d,m,v){const b=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(b,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((S,z)=>S.sortKey-z.sortKey));this._currentPartIndex<b.length;){const S=b[this._currentPartIndex];if(o.placeLayerBucketPart(S,this._seenCrossTileIDs,d,0===S.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class Aa{constructor(i,o,d,m,v,b,S,z,H){this.placement=new ne(i,v,b,S,z,H),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(i,o,d,m){const v=s.f.now(),b=()=>{const S=s.f.now()-v;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=o[i[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if("symbol"===S.type&&(!S.minzoom||S.minzoom<=z)&&(!S.maxzoom||S.maxzoom>z)){const H=S,R=H.layout.get("symbol-z-elevate"),B=this._inProgressLayer=this._inProgressLayer||new ba(H),Y=s.ag(S.source,S.scope);if(B.continuePlacement(R?m[Y]:d[Y],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const a1=512/s.V/2;class b1{constructor(i,o,d){this.tileID=i,this.bucketInstanceId=d,this.index=new s.bg(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=i.canonical.x*s.V,v=i.canonical.y*s.V;for(let b=0;b<o.length;b++){const{key:S,crossTileID:z,tileAnchorX:H,tileAnchorY:R}=o.get(b),B=Math.floor((m+H)*a1),Y=Math.floor((v+R)*a1);this.index.add(B,Y),this.keys.push(S),this.crossTileIDs.push(z)}this.index.finish()}findMatches(i,o,d){const m=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),v=a1/Math.pow(2,o.canonical.z-this.tileID.canonical.z),b=o.canonical.x*s.V,S=o.canonical.y*s.V;for(let z=0;z<i.length;z++){const H=i.get(z);if(H.crossTileID)continue;const{key:R,tileAnchorX:B,tileAnchorY:Y}=H,Q=Math.floor((b+B)*v),le=Math.floor((S+Y)*v),ce=this.index.range(Q-m,le-m,Q+m,le+m);for(const pe of ce){const re=this.crossTileIDs[pe];if(this.keys[pe]===R&&!d.has(re)){d.add(re),H.crossTileID=re;break}}}}}class t2{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(0!==o)for(const d in this.indexes){const m=this.indexes[d],v={};for(const b in m){const S=m[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),v[S.tileID.key]=S}this.indexes[d]=v}this.lng=i}addBucket(i,o,d){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<o.symbolInstances.length;v++)o.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const m=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const b=this.indexes[v];if(Number(v)>i.overscaledZ)for(const S in b){const z=b[S];z.tileID.isChildOf(i)&&z.findMatches(o.symbolInstances,i,m)}else{const S=b[i.scaledTo(Number(v)).key];S&&S.findMatches(o.symbolInstances,i,m)}}for(let v=0;v<o.symbolInstances.length;v++){const b=o.symbolInstances.get(v);b.crossTileID||(b.crossTileID=d.generate(),m.add(b.crossTileID))}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new b1(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const d of o.crossTileIDs)this.usedCrossTileIDs[i].delete(d)}removeStaleBuckets(i){let o=!1;for(const d in this.indexes){const m=this.indexes[d];for(const v in m)i[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[v]),delete m[v],o=!0)}return o}}class Bo{constructor(){this.layerIndexes={},this.crossTileIDs=new t2,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,d,m){let v=this.layerIndexes[i.fqid];void 0===v&&(v=this.layerIndexes[i.fqid]=new gs);let b=!1;const S={};"globe"!==m.name&&v.handleWrapJump(d);for(const z of o){const H=z.getBucket(i);H&&i.fqid===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(z.tileID,H,this.crossTileIDs)&&(b=!0),S[H.bucketInstanceId]=!0)}return v.removeStaleBuckets(S)&&(b=!0),b}pruneUnusedLayers(i){const o={};i.forEach(d=>{o[d]=!0});for(const d in this.layerIndexes)o[d]||delete this.layerIndexes[d]}}class ta{constructor(i=0,o=0,d=0,m=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=d,this.right=m}interpolate(i,o,d){return null!=o.top&&null!=i.top&&(this.top=s.U(i.top,o.top,d)),null!=o.bottom&&null!=i.bottom&&(this.bottom=s.U(i.bottom,o.bottom,d)),null!=o.left&&null!=i.left&&(this.left=s.U(i.left,o.left,d)),null!=o.right&&null!=i.right&&(this.right=s.U(i.right,o.right,d)),this}getCenter(i,o){const d=s.aa((this.left+i-this.right)/2,0,i),m=s.aa((this.top+o-this.bottom)/2,0,o);return new s.P(d,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ta(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function c1(h,i){const o=s.bk(h,3);s.a6.fromQuat(h,i),s.bm(h,3,o)}function mo(h,i){const o=s.bi.identity([]);return s.bi.rotateZ(o,o,-i),s.bi.rotateX(o,o,-h),o}function n2(h,i){const o=[h[0],h[1],0],d=[i[0],i[1],0];if(s.N.length(o)>=1e-15){const b=s.N.normalize([],o);s.N.scale(d,b,s.N.dot(d,b)),i[0]=d[0],i[1]=d[1]}const m=s.N.cross([],i,h);if(s.N.len(m)<1e-15)return null;const v=Math.atan2(-m[1],m[0]);return mo(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class Wa{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof s.L?i:new s.L(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=s.bh(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const d=this.position,m=this._elevation?this._elevation.getAtPointOrZero(s.L.fromLngLat(i)):0,v=s.L.fromLngLat(i,m),b=[v.x-d.x,v.y-d.y,v.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=n2(b,o)}setPitchBearing(i,o){this.orientation=mo(s.bj(i),s.bj(-o))}}class La{constructor(i,o){this._transform=s.a6.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new s.L(i[0],i[1],i[2])}get position(){const i=s.bk(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&s.bm(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||s.bi.identity([]),i&&c1(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=mo(i,o),c1(this._transform,this._orientation)}forward(){const i=s.bk(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=s.bk(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=s.bk(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const d=new Float64Array(16);return s.a6.invert(d,this.getWorldToCamera(i,o)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,o,d){const m=this.position;s.N.scale(m,m,-i);const v=new Float64Array(16);return s.a6.fromScaling(v,[d,d,d]),s.a6.translate(v,v,m),v[10]*=o,v}getWorldToCamera(i,o){const d=new Float64Array(16),m=new Float64Array(4),v=this.position;return s.bi.conjugate(m,this._orientation),s.N.scale(v,v,-i),s.a6.fromQuat(d,m),s.a6.translate(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=o,d[9]*=o,d[10]*=o,d[11]*=o,d}getCameraToClipPerspective(i,o,d,m){const v=new Float64Array(16);return s.a6.perspective(v,i,o,d,m),v}getCameraToClipOrthographic(i,o,d,m,v,b){const S=new Float64Array(16);return s.a6.ortho(S,i,o,d,m,v,b),S}getDistanceToElevation(i,o=!1){const d=0===i?0:s.bl(i,o?s.au(this.position[1]):this.position[1]),m=this.forward();return(d-this.position[2])/m[2]}clone(){return new La([...this.position],[...this.orientation])}}const I1=(h,i,o)=>(1-o)*h+o*i,wa=h=>h*h*h*h*h;class qa{constructor(i,o,d,m,v,b,S){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=d??0,this._maxPitch=m??60,this.setProjection(b),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ta,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new La,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new qa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(i,o=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||d)&&this._updateCameraOnTerrain(),(i||d)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return s.ac(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=s.bo(this.projectionOptions);const d=!ct(o,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bo({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bh(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=s.b4.create(),s.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=s.aa(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=s.bj(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let m=0,v=0;for(let b=0;b<o.length;b++){const S=new s.P(o[b][0]*this.width,d+o[b][1]*(this.height-d)),z=i.pointCoordinate(S);if(!z)continue;const H=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);m+=z[3]*H,v+=H}return 0===v?NaN:m/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*o,m=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(m-d,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let d;d=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const m=s.N.length(s.N.sub([],this._camera.position,d));return s.aa(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!s.bi.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const d=[i.position.x,i.position.y,i.position.z];s.N.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new Wa;return o.position=new s.L(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!s.bi.length(i))return!1;s.bi.normalize(i,i);const o=s.N.transformQuat([],[0,0,-1],i),d=s.N.transformQuat([],[0,-1,0],i);if(d[2]<0)return!1;const m=n2(o,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;i[2]=s.aa(i[2],m/d,m/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,d){this._unmodified=!1,this._edgeInsets.interpolate(i,o,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new s.bp(0,i)];if(this.renderWorldCopies){const d=this.pointCoordinate(new s.P(0,0)),m=this.pointCoordinate(new s.P(this.width,0)),v=this.pointCoordinate(new s.P(this.width,this.height)),b=this.pointCoordinate(new s.P(0,this.height)),S=Math.floor(Math.min(d.x,m.x,v.x,b.x)),z=Math.floor(Math.max(d.x,m.x,v.x,b.x)),H=1;for(let R=S-H;R<=z+H;R++)0!==R&&o.push(new s.bp(R,i))}return o}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(i,o,d){let m=[];if(0===o[0]&&0===o[1])return m;for(const b of i){const S=b.canonical,z=b.overscaledZ,H=b.wrap,R=1<<S.z,B=S.x+1<R,Y=S.x>0,Q=S.y+1<R,le=S.y>0,ce=b.wrap-(Y?0:1),pe=b.wrap+(B?0:1),re=Y?S.x-1:R-1,ve=B?S.x+1:0;o[0]<0?(m.push(new s.am(z,pe,S.z,ve,S.y)),o[1]<0&&Q&&(m.push(new s.am(z,H,S.z,S.x,S.y+1)),m.push(new s.am(z,pe,S.z,ve,S.y+1))),o[1]>0&&le&&(m.push(new s.am(z,H,S.z,S.x,S.y-1)),m.push(new s.am(z,pe,S.z,ve,S.y-1)))):o[0]>0?(m.push(new s.am(z,ce,S.z,re,S.y)),o[1]<0&&Q&&(m.push(new s.am(z,H,S.z,S.x,S.y+1)),m.push(new s.am(z,ce,S.z,re,S.y+1))),o[1]>0&&le&&(m.push(new s.am(z,H,S.z,S.x,S.y-1)),m.push(new s.am(z,ce,S.z,re,S.y-1)))):o[1]<0&&Q?m.push(new s.am(z,H,S.z,S.x,S.y+1)):le&&m.push(new s.am(z,H,S.z,S.x,S.y-1))}if(m.length>1){m.sort((z,H)=>z.overscaledZ-H.overscaledZ||z.wrap-H.wrap||z.canonical.z-H.canonical.z||z.canonical.x-H.canonical.x||z.canonical.y-H.canonical.y);let b=0,S=0;for(;S<m.length;)m[S].equals(m[b])?++S:m[++b]=m[S++];m.length=b+1}const v=[];for(const b of m)m.some(S=>b.isChildOf(S))||v.push(b);return m=v.filter(b=>!i.some(S=>!!(b.overscaledZ<d&&S.isChildOf(b))||b.equals(S)||b.isChildOf(S))),m}coveringTiles(i){let o=this.coveringZoomLevel(i);const d=o,m=this.elevation&&this.elevation.exaggeration(),v=m&&!i.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==i.minzoom&&o<i.minzoom)return[];void 0!==i.maxzoom&&o>i.maxzoom&&(o=i.maxzoom);const S=this.locationCoordinate(this.center),z=this.center.lat,H=1<<o,R=[H*S.x,H*S.y,0],B="globe"===this.projection.name,Y=!B,Q=s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,Y),le=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ce=H*s.bl(1,this.center.lat),pe=this._camera.position[2]/s.bl(1,this.center.lat),re=[H*le.x,H*le.y,pe*(Y?1:ce)],ve=B||m,Le=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Ce=this.isLODDisabled(!0)?o:0;let ze;if(this._elevation&&i.isTerrainDEM)ze=1e4*this._elevation.exaggeration();else if(this._elevation){const ut=this._elevation.getMinMaxForVisibleTiles();ze=ut?ut.max:this._centerAltitude}else ze=this._centerAltitude;const ge=i.isTerrainDEM?-ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?s.br(this):1,Qe=ut=>{const Cn=new s.L(ut.x+25e-6,ut.y,ut.z),Un=new s.L(ut.x,ut.y+25e-6,ut.z),kn=ut.toLngLat(),Yn=Cn.toLngLat(),di=Un.toLngLat(),Ai=this.locationCoordinate(kn),xi=this.locationCoordinate(Yn),bi=this.locationCoordinate(di),ur=Math.hypot(xi.x-Ai.x,xi.y-Ai.y),ar=Math.hypot(bi.x-Ai.x,bi.y-Ai.y);return Math.sqrt(ur*ar)*Ie/25e-6},nt=ut=>{const Nt=ze,Cn=ge;return{aabb:s.bu(this,H,0,0,0,ut,Cn,Nt,this.projection),zoom:0,x:0,y:0,minZ:Cn,maxZ:Nt,wrap:ut,fullyVisible:!1}},dt=[];let $t=[];const Ct=o,en=i.reparseOverscaled?d:o,Jt=ut=>ut*ut,xn=Jt((pe-this._centerAltitude)*ce),Lt=ut=>{if(!this._elevation||!ut.tileID||!b)return;const Nt=this._elevation.getMinMaxForTile(ut.tileID),Cn=ut.aabb;Nt?(Cn.min[2]=Nt.min,Cn.max[2]=Nt.max,Cn.center[2]=(Cn.min[2]+Cn.max[2])/2):(ut.shouldSplit=Zt(ut),ut.shouldSplit||(Cn.min[2]=Cn.max[2]=Cn.center[2]=this._centerAltitude))},Zt=ut=>{if(ut.zoom<Ce)return!0;if(ut.zoom===Ct)return!1;if(null!=ut.shouldSplit)return ut.shouldSplit;const Nt=ut.aabb.distanceX(re),Cn=ut.aabb.distanceY(re);let Un=xn,kn=1;if(B){Un=Jt(ut.aabb.distanceZ(re));const Ai=Math.pow(2,ut.zoom),xi=s.au((ut.y+1)/Ai),bi=s.au(ut.y/Ai),ur=Math.min(Math.max(z,xi),bi),ar=s.bJ(ur)/s.bJ(z);if(kn=ur===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ar/this._mercatorScaleRatio),this.zoom<=s.bG&&ut.zoom===Ct-1&&ar>=.9)return!0}else if(v&&(Un=Jt(ut.aabb.distanceZ(re)*ce)),this.projection.isReprojectedInTileSpace&&d<=5){const Ai=Math.pow(2,ut.zoom),xi=Qe(new s.L((ut.x+.5)/Ai,(ut.y+.5)/Ai));kn=xi>.85?1:xi}const Yn=Nt*Nt+Cn*Cn+Un;return Yn<Jt((1<<Ct-ut.zoom)*Le*kn*((Ai,xi)=>{if(xi*Jt(.707)<Ai)return 1;const bi=Math.sqrt(xi/Ai);return bi/(1.4144271570014144+(Math.pow(1.1,bi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Un,xn),Yn))};if(this.renderWorldCopies)for(let ut=1;ut<=3;ut++)dt.push(nt(-ut)),dt.push(nt(ut));for(dt.push(nt(0));dt.length>0;){const ut=dt.pop(),Nt=ut.x,Cn=ut.y;let Un=ut.fullyVisible;const kn=()=>"globe"===this.projection.name&&(0===ut.y||ut.y===(1<<ut.zoom)-1);if(!Un){let Yn=ve?ut.aabb.intersects(Q):ut.aabb.intersectsFlat(Q);if(0===Yn&&kn()){const di=new s.bs(ut.zoom,Nt,Cn);Yn=s.bt(this,H,di,!0).intersects(Q)}if(0===Yn)continue;Un=2===Yn}if(ut.zoom!==Ct&&Zt(ut))for(let Yn=0;Yn<4;Yn++){const di=(Nt<<1)+Yn%2,Ai=(Cn<<1)+(Yn>>1),xi={aabb:b?ut.aabb.quadrant(Yn):s.bu(this,H,ut.zoom+1,di,Ai,ut.wrap,ut.minZ,ut.maxZ,this.projection),zoom:ut.zoom+1,x:di,y:Ai,wrap:ut.wrap,fullyVisible:Un,tileID:void 0,shouldSplit:void 0,minZ:ut.minZ,maxZ:ut.maxZ};v&&!B&&(xi.tileID=new s.am(ut.zoom+1===Ct?en:ut.zoom+1,ut.wrap,ut.zoom+1,di,Ai),Lt(xi)),dt.push(xi)}else{const Yn=ut.zoom===Ct?en:ut.zoom;if(i.minzoom&&i.minzoom>Yn)continue;if(!Un){let bi=ve?ut.aabb.intersectsPrecise(Q):ut.aabb.intersectsPreciseFlat(Q);if(0===bi&&kn()){const ur=new s.bs(ut.zoom,Nt,Cn);bi=s.bt(this,H,ur,!0).intersectsPrecise(Q)}if(0===bi)continue}const di=R[0]-(.5+Nt+(ut.wrap<<ut.zoom))*(1<<o-ut.zoom),Ai=R[1]-.5-Cn,xi=ut.tileID?ut.tileID:new s.am(Yn,ut.wrap,ut.zoom,Nt,Cn);$t.push({tileID:xi,distanceSq:di*di+Ai*Ai})}}if(this.fogCullDistSq){const ut=this.fogCullDistSq,Nt=this.horizonLineFromTop();$t=$t.filter(Cn=>{const Un=[0,0,0,1],kn=[s.V,s.V,0,1],Yn=this.calculateFogTileMatrix(Cn.tileID.toUnwrapped());s.a7.transformMat4(Un,Un,Yn),s.a7.transformMat4(kn,kn,Yn);const di=s.a7.min([],Un,kn),Ai=s.a7.max([],Un,kn),xi=s.bv(di,Ai);if(0===xi)return!0;let bi=!1;const ur=this._elevation;if(ur&&xi>ut&&0!==Nt){const ar=this.calculateProjMatrix(Cn.tileID.toUnwrapped());let yr;i.isTerrainDEM||(yr=ur.getMinMaxForTile(Cn.tileID)),yr||(yr={min:ge,max:ze});const mr=s.bH(this.rotation),Yr=[mr[0]*s.V,mr[1]*s.V,yr.max];s.N.transformMat4(Yr,Yr,ar),bi=(1-Yr[1])*this.height*.5<Nt}return xi<ut||bi})}return $t.sort((ut,Nt)=>ut.distanceSq-Nt.distanceSq).map(ut=>ut.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=s.aa(i.lat,-s.bw,s.bw),d=this.projection.project(i.lng,o);return new s.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let d,m;const v=this.centerPoint;if("globe"===this.projection.name){const S=this.worldSize;d=(o.x-v.x)/S,m=(o.y-v.y)/S}else{const S=this.pointCoordinate(o),z=this.pointCoordinate(v);d=S.x-z.x,m=S.y-z.y}const b=this.locationCoordinate(i);this.setLocation(new s.L(b.x-d,b.y-m))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const d=o?s.bl(o,i.lat):void 0,m=this.projection.project(i.lng,i.lat);return new s.L(m.x,m.y,d)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const d=o??this._centerAltitude,m=[i.x,i.y,0,1],v=[i.x,i.y,1,1];s.a7.transformMat4(m,m,this.pixelMatrixInverse),s.a7.transformMat4(v,v,this.pixelMatrixInverse);const b=v[3];s.a7.scale(m,m,1/m[3]),s.a7.scale(v,v,1/b);const S=m[2],z=v[2];return{p0:m,p1:v,t:S===z?0:(d-S)/(z-S)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],d=[i.x,i.y,1,1];return s.a7.transformMat4(o,o,this.pixelMatrixInverse),s.a7.transformMat4(d,d,this.pixelMatrixInverse),s.a7.scale(o,o,1/o[3]),s.a7.scale(d,d,1/d[3]),o[2]=s.bl(o[2],this._center.lat)*this.worldSize,d[2]=s.bl(d[2],this._center.lat)*this.worldSize,s.a7.scale(o,o,1/this.worldSize),s.a7.scale(d,d,1/this.worldSize),new s.a2([o[0],o[1],o[2]],s.N.normalize([],s.N.sub([],d,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:d,t:m}=i,v=s.bl(o[2],this._center.lat),b=s.bl(d[2],this._center.lat);return new s.L(s.U(o[0],d[0],m)/this.worldSize,s.U(o[1],d[1],m)/this.worldSize,s.U(v,b,m))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new s.L(o[0],o[1],o[2]);let d=0,m=this.horizonLineFromTop();if(i.y>m)return this.pointCoordinate(i);const v=.02*m,b=i.clone();for(let S=0;S<10&&m-d>v;S++){b.y=s.U(d,m,.66);const z=this.projection.pointCoordinate3D(this,b.x,b.y);z?(m=b.y,o=z):d=b.y}return o?new s.L(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=s.bx)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const d=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,m=[i.x*this.worldSize,i.y*this.worldSize,d+i.toAltitude(),1];return s.a7.transformMat4(m,m,this.pixelMatrix),m[3]>0?new s.P(m[0]/m[3],m[1]/m[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,v=this.pointLocation3D(new s.P(o,i)),b=this.pointLocation3D(new s.P(m,i)),S=this.pointLocation3D(new s.P(m,d)),z=this.pointLocation3D(new s.P(o,d));let H=Math.min(v.lng,b.lng,S.lng,z.lng),R=Math.max(v.lng,b.lng,S.lng,z.lng),B=Math.min(v.lat,b.lat,S.lat,z.lat),Y=Math.max(v.lat,b.lat,S.lat,z.lat);const Q=Math.pow(2,-this.zoom)/16*270,le="globe"===this.projection.name?1:4,ce=(pe,re,ve,Le,Ce)=>{const ze=(pe+ve)/2,ge=(re+Le)/2,Ie=new s.P(ze,ge),{lng:Qe,lat:nt}=this.pointLocation3D(Ie),dt=Math.max(0,H-Qe,B-nt,Qe-R,nt-Y);H=Math.min(H,Qe),R=Math.max(R,Qe),B=Math.min(B,nt),Y=Math.max(Y,nt),(Ce<le||dt>Q)&&(ce(pe,re,ze,ge,Ce+1),ce(ze,ge,ve,Le,Ce+1))};if(ce(o,i,m,i,1),ce(m,i,m,d,1),ce(m,d,o,d,1),ce(o,d,o,i,1),"globe"===this.projection.name){const[pe,re]=s.by(this);pe?(Y=90,R=180,H=-180):re&&(B=-90,R=180,H=-180)}return new s.ad(new s.bn(H,B),new s.bn(R,Y))}_getBoundsRectangular(i,o){const{top:d,left:m}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,S=new s.P(m,d),z=new s.P(b,d),H=new s.P(b,v),R=new s.P(m,v);let B=this.pointCoordinate(S,i),Y=this.pointCoordinate(z,i);const Q=this.pointCoordinate(H,o),le=this.pointCoordinate(R,o),ce=(pe,re)=>(re.y-pe.y)/(re.x-pe.x);return B.y>1&&Y.y>=0?B=new s.L((1-le.y)/ce(le,B)+le.x,1):B.y<0&&Y.y<=1&&(B=new s.L(-le.y/ce(le,B)+le.x,0)),Y.y>1&&B.y>=0?Y=new s.L((1-Q.y)/ce(Q,Y)+Q.x,1):Y.y<0&&B.y<=1&&(Y=new s.L(-Q.y/ce(Q,Y)+Q.x,0)),(new s.ad).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((d,m)=>{if(m.dem){const v=m.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-s.bw,this.maxLat=s.bw,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.a5(this.minLng)*this.tileSize,this.worldMaxX=s.a5(this.maxLng)*this.tileSize,this.worldMinY=s.ae(this.maxLat)*this.tileSize,this.worldMaxY=s.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,d=this._distanceTileDataCache;if(d[o])return d[o];const m=i.canonical,v=1/this.height,b=this.cameraWorldSize,S=b/this.zoomScale(m.z),z=(m.x+Math.pow(2,m.z)*i.wrap)*S,H=m.y*S,R=this.point;R.x*=b/this.worldSize,R.y*=b/this.worldSize;const B=this.angle,Y=Math.sin(-B),Q=-Math.cos(-B);return d[o]={bearing:[Y,Q],center:[(R.x-z)*v,(R.y-H)*v],scale:S/s.V*v},d[o]}calculateFogTileMatrix(i){const o=i.key,d=this._fogTileMatrixCache;if(d[o])return d[o];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return s.a6.multiply(m,this.worldToFogMatrix,m),d[o]=new Float32Array(m),d[o]}calculateProjMatrix(i,o=!1,d=!1){const m=i.key;let v;if(v=d?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,v[m])return v[m];const b=this.calculatePosMatrix(i,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,s.a6.multiply(b,S,b),v[m]=new Float32Array(b),v[m]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,d=this._pixelsToTileUnitsCache;if(d[o])return d[o];const m=s.bz(i,this);return d[o]=m,d[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const i=1/this.worldSize,o=s.a6.fromScaling([],[i,i,i]);return s.a6.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const i=this._elevation;this._updateCameraState();const o=s.bl(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(o),m=this._camera.forward(),v=s.bl(1,this._center.lat);d[2]/=v,m[2]/=v,s.N.normalize(m,m);const b=i.raycast(d,m,i.exaggeration());if(b){const S=s.N.scaleAndAdd([],d,m,b),z=new s.L(S[0],S[1],s.bl(S[2],s.au(S[1]))),H=(z.z+s.N.length([z.x-d[0],z.y-d[1],z.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(H),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,d=s.bl(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(d),v=o.getAtPointOrZero(new s.L(...m)),b=this.pixelsPerMeter/this.worldSize*v,S=this._minimumHeightOverTerrain(),z=m[2]-b;if(z<=S)if(z<0||i){const H=this.locationCoordinate(this._center,this._centerAltitude),R=[m[0],m[1],H.z-m[2]],B=s.N.length(R);R[2]-=(S-z)/this._pixelsPerMercatorPixel;const Y=s.N.length(R);if(0===Y)return;s.N.scale(R,R,B/Y*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],H.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const Y=this.center;return Y.lat=s.aa(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(Y.lng=s.aa(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const o=this._unmodified,{x:d,y:m}=this.point;let v=0,b=d,S=m;const z=this.width/2,H=this.height/2,R=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(m-H<R&&(S=R+H),m+H>B&&(S=B-H),B-R<this.height&&(v=Math.max(v,this.height/(B-R)),S=(B+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,le=this.worldSize/2-(Y+Q)/2;b=(d+le+this.worldSize)%this.worldSize-le,b-z<Y&&(b=Y+z),b+z>Q&&(b=Q-z),Q-Y<this.width&&(v=Math.max(v,this.width/(Q-Y)),b=(Q+Y)/2)}b===d&&S===m||(this.center=this.unproject(new s.P(b,S))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o="globe"===this.projection.name,d=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=s.bl(1,this.center.lat)/s.bl(1,s.bI));const m=s.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v="meters"===this.projection.zAxisUnit?d:1,b=this._camera.getWorldToCamera(this.worldSize,v);let S;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-i.x/this.width,z[9]=2*i.y/this.height,this.isOrthographic){let nt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),dt=nt*this.aspect,$t=-dt,Ct=-nt;dt-=i.x,$t-=i.x,nt+=i.y,Ct+=i.y,S=this._camera.getCameraToClipOrthographic($t,dt,Ct,nt,this._nearZ,this._farZ),((en,Jt,xn,Lt)=>{for(let Zt=0;Zt<16;Zt++)en[Zt]=I1(Jt[Zt],xn[Zt],Lt)})(S,S,z,wa(this.pitch>=15?1:this.pitch/15))}else S=z;const H=s.a6.mul([],z,b);let R=s.a6.mul([],S,b);if(this.projection.isReprojectedInTileSpace){const nt=this.locationCoordinate(this.center),dt=s.a6.identity([]);s.a6.translate(dt,dt,[nt.x*this.worldSize,nt.y*this.worldSize,0]),s.a6.multiply(dt,dt,s.bB(this)),s.a6.translate(dt,dt,[-nt.x*this.worldSize,-nt.y*this.worldSize,0]),s.a6.multiply(R,R,dt),s.a6.multiply(H,H,dt),this.inverseAdjustmentMatrix=s.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a6.scale([],R,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=R,this.invProjMatrix=s.a6.invert(new Float64Array(16),this.projMatrix),o){const nt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);nt[8]=2*-i.x/this.width,nt[9]=2*i.y/this.height,this.expandedFarZProjMatrix=s.a6.mul([],nt,b)}else this.expandedFarZProjMatrix=this.projMatrix;const B=s.a6.invert([],S);this.frustumCorners=s.bD.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const Y=new Float32Array(16);s.a6.identity(Y),s.a6.scale(Y,Y,[1,-1,1]),s.a6.rotateX(Y,Y,this._pitch),s.a6.rotateZ(Y,Y,this.angle);const Q=s.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a6.clone(Q);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-i.x/this.width,Q[9]=2*(i.y+le)/this.height,this.skyboxMatrix=s.a6.multiply(Y,Q,Y);const ce=this.point,pe=ce.x,re=ce.y,ve=this.width%2/2,Le=this.height%2/2,Ce=Math.cos(this.angle),ze=Math.sin(this.angle),ge=pe-Math.round(pe)+Ce*ve+ze*Le,Ie=re-Math.round(re)+Ce*Le+ze*ve,Qe=new Float64Array(R);if(s.a6.translate(Qe,Qe,[ge>.5?ge-1:ge,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=Qe,R=s.a6.create(),s.a6.scale(R,R,[this.width/2,-this.height/2,1]),s.a6.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=s.a6.create(),s.a6.scale(R,R,[1,-1,1]),s.a6.translate(R,R,[-1,-1,0]),s.a6.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=s.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,H),this._calcFogMatrices(),this._distanceTileDataCache={},R=s.a6.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=s.bE(this);const nt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.N.transformMat4(nt,nt,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,v=[i,i,o];s.N.scale(v,v,m),s.N.scale(d,d,-1),s.N.multiply(d,d,v);const b=s.a6.create();s.a6.translate(b,b,d),s.a6.scale(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,m)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),m=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-d[0]*v,m.y/this.worldSize-d[1]*v,i/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],m=i[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(v=Math.min((o-d)/m,1)),this._camera.position=s.N.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),v=s.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bj(this._maxPitch)),S=Math.max((i[2]-v)/Math.cos(d),b),z=this._zoomFromMercatorZ(S);s.N.scaleAndAdd(i,i,o,S),this._pitch=s.aa(d,s.bj(this.minPitch),s.bj(this.maxPitch)),this.angle=s.bh(m,-Math.PI,Math.PI),this._setZoom(s.aa(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.L(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,d=s.bx,m=0,v=1/0;for(;d-o>1e-6&&d>o;){const b=o+.5*(d-o),S=this.tileSize*Math.pow(2,b),z=this.getCameraToCenterDistance(this.projection,b,S),H=this.scaleZoom(z/(i*this.tileSize)),R=Math.abs(b-H);R<v&&(v=R,m=b),b<H?o=b:d=b}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const d=Math.min(i.x,o.x),m=Math.max(i.x,o.x),v=Math.min(i.y,o.y),b=Math.max(i.y,o.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new s.P(d,v),new s.P(m,b),new s.P(d,b),new s.P(m,v)],z=this.renderWorldCopies?-3:0,H=this.renderWorldCopies?4:1;for(const R of S){const B=this.pointRayIntersection(R);if(B.t<0)return!0;const Y=this.rayIntersectionCoordinate(B);if(Y.x<z||Y.y<0||Y.x>H||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(i,o){const d=s.N.length(s.N.sub([],this._camera.position,i)),m=this._zoomFromMercatorZ(d)+o;return d-this._mercatorZfromZoom(m)}getCameraPoint(){if("globe"===this.projection.name){const i=function([o,d,m],v){const b=[o,d,m,1];s.a7.transformMat4(b,b,v);const S=b[3]=Math.max(b[3],1e-6);return b[0]/=S,b[1]/=S,b[2]/=S,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,i))}}getCameraToCenterDistance(i,o=this.zoom,d=this.worldSize){const m=s.bA(i,o,this.width,this.height,1024),v=i.pixelSpaceConversion(this.center.lat,d,m);let b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=I1(1,b,wa(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&s.a6.multiply(i,i,this.globeMatrix),i}getFrustum(i){return s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,"meters"===this.projection.zAxisUnit)}}const vt={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},ft=(h,i)=>{if(i>0&&h.terrain&&s.w("Cutoff is currently disabled on terrain"),i<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=h.transform,d=Math.max(Math.abs(o._zoom-(h.minCutoffZoom-1)),1),m=o.isLODDisabled(!1)?s.O(60,45,o.pitch):s.O(30,15,o.pitch),v=o._farZ-o._nearZ,b=i*o.height,S=((1-(z=m))*o.cameraToCenterDistance+z*(o._farZ+b))*d;var z;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(S-o._nearZ)/v,(S-b-o._nearZ)/v]}}},$e={cascadeCount:2,shadowMapResolution:2048};class Yt{constructor(i,o){this.aabb=i,this.lastCascade=o}}class Pn{add(i,o){const d=this.receivers[i.key];void 0!==d?(d.aabb.min[0]=Math.min(d.aabb.min[0],o.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],o.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],o.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],o.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],o.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],o.max[2])):this.receivers[i.key]=new Yt(o,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,o,d){const m=s.bS.fromPoints(i.points);let v=0;for(const b in this.receivers){const S=this.receivers[b];if(!S||!m.intersectsAabb(S.aabb))continue;S.aabb.min=m.closestPoint(S.aabb.min),S.aabb.max=m.closestPoint(S.aabb.max);const z=S.aabb.getCorners();for(let H=0;H<d.length;H++){let R=!0;for(const B of z){const Y=[B[0]*o,B[1]*o,B[2]];if(s.N.transformMat4(Y,Y,d[H].matrix),Y[0]<-1||Y[0]>1||Y[1]<-1||Y[1]>1){R=!1;break}}if(S.lastCascade=H,v=Math.max(v,H),R)break}}return v+1}}class Ui{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Pn,this._depthMode=new ci(i.context.gl.LEQUAL,ci.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,i.tp.registerParameter($e,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter($e,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,o){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const m=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||m<=0||(this._shadowLayerCount=d.style.order.reduce((le,ce)=>{const pe=d.style._mergedLayers[ce];return le+(pe.hasShadowPass()&&!pe.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const v=d.context,b=$e.shadowMapResolution,S=$e.shadowMapResolution;if(0===this._cascades.length||$e.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<$e.cascadeCount;++le){const ce=d._shadowMapDebug,pe=v.gl,re=v.createFramebuffer(b,S,ce,"texture"),ve=new s.T(v,{width:b,height:S,data:null},pe.DEPTH_COMPONENT);if(re.depthAttachment.set(ve.texture),ce){const Le=new s.T(v,{width:b,height:S,data:null},pe.RGBA);re.colorAttachment.set(Le.texture)}this._cascades.push({framebuffer:re,texture:ve,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bq,scale:0})}}this.shadowDirection=na(o);let z=0;if(i.elevation){const le=i.elevation,ce=[1e4,-1e4];le.visibleDemTiles.filter(pe=>pe.dem).forEach(pe=>{const re=pe.dem.tree;ce[0]=Math.min(ce[0],re.minimums[0]),ce[1]=Math.max(ce[1],re.maximums[0])}),1e4!==ce[0]&&(z=(ce[1]-ce[0])*le.exaggeration())}const H=1.5*i.cameraToCenterDistance,R=3*H,B=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const ce=this._cascades[le];let pe=i.height/50,re=1;1===$e.cascadeCount?re=R:0===le?re=H:(pe=H,re=R);const[ve,Le]=V1(i,this.shadowDirection,pe,re,$e.shadowMapResolution,z);ce.scale=i.scale,ce.matrix=ve,ce.boundingSphereRadius=Le,s.a6.invert(B,ce.matrix),ce.frustum=s.bq.fromInvProjectionMatrix(B,1,0,!0),ce.far=re}const Y=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Y].far,this._cascades[Y].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/$e.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=$e.shadowMapResolution,this._uniformValues.u_shadowmap_0=vt.ShadowMap0,this._uniformValues.u_shadowmap_1=vt.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=d.transform.elevation;for(const le of this._groundShadowTiles){let ce={min:0,max:0};if(Q){const pe=Q.getMinMaxForTile(le);pe&&(ce=pe)}this.addShadowReceiver(le.toUnwrapped(),ce.min,ce.max)}}get enabled(){return this._enabled}set enabled(i){this._enabled=i}drawShadowPass(i,o){if(!this._enabled)return;const d=this.painter,m=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),m.viewport.set([0,0,$e.shadowMapResolution,$e.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){d.currentShadowCascade=v,m.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),m.clear({color:s.ax.white,depth:1});for(const b of i.order){const S=i._mergedLayers[b];if(!S.hasShadowPass()||S.isHidden(d.transform.zoom))continue;const z=i.getLayerSourceCache(S),H=z?o[z.id]:void 0;("model"===S.type||H&&H.length)&&d.renderLayer(d,z,S,H)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const i=this.painter,o=i.style,d=i.context,m=o.directionalLight,v=o.ambientLight;if(!m||!v)return;const b=[],S=ft(i,i.longestCutoffRange);S.shouldRenderCutoff&&b.push("RENDER_CUTOFF");const z=Da(m,v),H=new ci(d.gl.LEQUAL,ci.ReadOnly,i.depthRangeFor3D);for(const R of this._groundShadowTiles){const B=R.toUnwrapped(),Y=i.isTileAffectedByFog(R),Q=i.getOrCreateProgram("groundShadow",{defines:b,overrideFog:Y});this.setupShadows(B,Q),i.uploadCommonUniforms(d,Q,B,null,S);const le={u_matrix:i.transform.calculateProjMatrix(B),u_ground_shadow_factor:z};Q.draw(i,d.gl.TRIANGLES,H,Ci.disabled,Bi.multiply,Qn.disabled,le,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Bi.unblended:Bi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const o=this.painter.transform,d=o.calculatePosMatrix(i,o.worldSize);return s.a6.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(i){return s.a6.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,o,d,m=0){if(!this._enabled)return;const v=this.painter.transform,b=this.painter.context,S=b.gl,z=this._uniformValues,H=new Float64Array(16),R=v.calculatePosMatrix(i,v.worldSize);for(let B=0;B<this._cascades.length;B++)s.a6.multiply(H,this._cascades[B].matrix,R),z[0===B?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(H),b.activeTexture.set(S.TEXTURE0+vt.ShadowMap0+B),this._cascades[B].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const B=s.bR(i.canonical),Y=2/v.tileSize*s.V/$e.shadowMapResolution,Q=Y*this._cascades[0].boundingSphereRadius,le=Y*this._cascades[this._cascades.length-1].boundingSphereRadius,ce=("vector-tile"===d?1:3)/Math.pow(2,m-i.canonical.z-(1-v.zoom+Math.floor(v.zoom)));z.u_shadow_normal_offset=[B,Q*ce,le*ce],z.u_shadow_bias=[6e-5,.0012,.012]}else z.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(b,z)}setupShadowsFromMatrix(i,o,d=!1){if(!this._enabled)return;const m=this.painter.context,v=m.gl,b=this._uniformValues,S=new Float64Array(16);for(let z=0;z<$e.cascadeCount;z++)s.a6.multiply(S,this._cascades[z].matrix,i),b[0===z?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),m.activeTexture.set(v.TEXTURE0+vt.ShadowMap0+z),this._cascades[z].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);this.useNormalOffset=d,d?(b.u_shadow_normal_offset=[1,5,5],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],o.setShadowUniformValues(m,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,o,d,m){if(m[2]>=0)return{};const v=function(z,H,R){const B=R/(1<<z.canonical.z);return new s.bS([z.canonical.x*B+z.wrap*R,z.canonical.y*B+z.wrap*R,0],[(z.canonical.x+1)*B+z.wrap*R,(z.canonical.y+1)*B+z.wrap*R,H])}(i,o,d).getCorners(),b=o/-m[2];m[0]<0?(s.N.add(v[0],v[0],[m[0]*b,0,0]),s.N.add(v[3],v[3],[m[0]*b,0,0])):m[0]>0&&(s.N.add(v[1],v[1],[m[0]*b,0,0]),s.N.add(v[2],v[2],[m[0]*b,0,0])),m[1]<0?(s.N.add(v[0],v[0],[0,m[1]*b,0]),s.N.add(v[1],v[1],[0,m[1]*b,0])):m[1]>0&&(s.N.add(v[2],v[2],[0,m[1]*b,0]),s.N.add(v[3],v[3],[0,m[1]*b,0]));const S={};return S.vertices=v,S.planes=[ys(v[1],v[0],v[4]),ys(v[2],v[1],v[5]),ys(v[3],v[2],v[6]),ys(v[0],v[3],v[7])],S}addShadowReceiver(i,o,d){this._receivers.add(i,s.bS.fromTileIdAndHeight(i,o,d))}getMaxCascadeForTile(i){const o=this._receivers.get(i);return o&&o.lastCascade?o.lastCascade:0}}function ys(h,i,o){const d=s.N.sub([],o,i),m=s.N.sub([],h,i),v=s.N.cross([],d,m),b=s.N.length(v);return 0===b?[0,0,1,0]:(s.N.scale(v,v,1/b),[v[0],v[1],v[2],-s.N.dot(v,i)])}function na(h){const i=h.properties.get("direction"),o=s.bQ(i.x,i.y,i.z);o[2]=s.aa(o[2],0,75);const d=s.bT([o[0],o[1],o[2]]);return s.N.fromValues(d.x,d.y,d.z)}function Da(h,i){const o=h.properties.get("color"),d=h.properties.get("intensity"),m=h.properties.get("direction"),v=[m.x,m.y,m.z],b=i.properties.get("color"),S=i.properties.get("intensity"),z=Math.max(s.N.dot([0,0,1],v),0),H=[0,0,0];s.N.scale(H,b.toArray01Linear().slice(0,3),S);const R=[0,0,0];return s.N.scale(R,o.toArray01Linear().slice(0,3),z*d),s.bU([H[0]>0?H[0]/(H[0]+R[0]):0,H[1]>0?H[1]/(H[1]+R[1]):0,H[2]>0?H[2]/(H[2]+R[2]):0])}function V1(h,i,o,d,m,v){const b=h.zoom,S=h.scale,z=h.worldSize,H=1/z,R=h.aspect,B=Math.sqrt(1+R*R)*Math.tan(.5*h.fovX),Y=B*B,Q=d-o,le=d+o;let ce,pe;Y>Q/le?(ce=d,pe=d*B):(ce=.5*le*(1+Y),pe=.5*Math.sqrt(Q*Q+2*(d*d+o*o)*Y+le*le*Y*Y));const re=h.projection.pixelsPerMeter(h.center.lat,z),ve=h._camera.getCameraToWorldMercator(),Le=[0,0,-ce*H];s.N.transformMat4(Le,Le,ve);let Ce=pe*H;const ze=h._edgeInsets;if(!(0===ze.left&&0===ze.top&&0===ze.right&&0===ze.bottom||ze.left===ze.right&&ze.top===ze.bottom)){const Un=h._camera.getWorldToCamera(h.worldSize,"meters"===h.projection.zAxisUnit?re:1),kn=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,o,d);kn[8]=2*-h.centerOffset.x/h.width,kn[9]=2*h.centerOffset.y/h.height;const Yn=new Float64Array(16);s.a6.mul(Yn,kn,Un);const di=new Float64Array(16);s.a6.invert(di,Yn);const Ai=s.bq.fromInvProjectionMatrix(di,z,b,!0);for(const xi of Ai.points){const bi=((ge=xi)[0]/=S,ge[1]/=S,ge[2]=s.bl(ge[2],h._center.lat),ge);Ce=Math.max(Ce,s.N.len(s.N.subtract([],Le,bi)))}}var ge;Ce*=m/(m-1);const Ie=Math.acos(i[2]),Qe=Math.atan2(-i[0],-i[1]),nt=new La;nt.position=Le,nt.setPitchBearing(Ie,Qe);const dt=nt.getWorldToCamera(z,re),$t=Ce*z,Ct=Math.min(h._mercatorZfromZoom(17)*z*-2,-2*$t),en=nt.getCameraToClipOrthographic(-$t,$t,-$t,$t,Ct,($t+v*re)/i[2]),Jt=new Float64Array(16);s.a6.multiply(Jt,en,dt);const xn=s.N.fromValues(Math.floor(1e6*Le[0])/1e6*z,Math.floor(1e6*Le[1])/1e6*z,0),Lt=.5*m,Zt=[0,0,0];s.N.transformMat4(Zt,xn,Jt),s.N.scale(Zt,Zt,Lt);const ut=[Math.floor(Zt[0]),Math.floor(Zt[1]),Math.floor(Zt[2])],Nt=[0,0,0];s.N.sub(Nt,Zt,ut),s.N.scale(Nt,Nt,-1/Lt);const Cn=new Float64Array(16);return s.a6.identity(Cn),s.a6.translate(Cn,Cn,Nt),s.a6.multiply(Jt,Cn,Jt),[Jt,$t]}const ua=(h,i)=>$n(h,i&&i.filter(o=>"source.canvas"!==o.identifier)),v2=s.ac(cr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),zo=s.ac(cr,["setCenter","setZoom","setBearing","setPitch"]),l1={version:8,layers:[],sources:{}},Zs={duration:300,delay:0},X2=new Set(["fill","line","background","hillshade","raster"]);class u1 extends s.E{constructor(i,o={}){super(),this.map=i,this.scope=o.scope||"",this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=s.e({},Zs),this._buildingIndex=new U1(this),this.crossTileSymbolIndex=new Bo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new _t,this.dispatcher=o.dispatcher?o.dispatcher:new s.bW(s.bX(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new je,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new s.bY(i._requestManager,o.localFontFamily?s.bZ.all:o.localIdeographFontFamily?s.bZ.ideographs:s.bZ.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new Ue(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this.dispatcher.broadcast("setReferrer",s.b_());const d=this;this._rtlTextPluginCallback=u1.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(v,b)=>{if(s.b$(v),b&&b.every(S=>S))for(const S in d._sourceCaches){const z=d._sourceCaches[S],H=z.getSource().type;"vector"!==H&&"geojson"!==H||z.reload()}})}),this.on("data",m=>{if("source"!==m.dataType||"metadata"!==m.sourceDataType)return;const v=this.getOwnSource(m.sourceId);if(v&&v.vectorLayerIds)for(const b in this._layers){const S=this._layers[b];S.source===v.id&&this._validateLayer(S)}})}loadURL(i,o={}){this.fire(new s.b("dataloading",{dataType:"style"}));const d="boolean"==typeof o.validate?o.validate:!s.c0(i);i=this.map._requestManager.normalizeStyleURL(i,o.accessToken),this.resolvedImports.add(i);const m=this.importsCache.get(i);if(m)return this._load(m,d);const v=this.map._requestManager.transformRequest(i,s.R.Style);this._request=s.g(v,(b,S)=>{if(this._request=null,b)this.fire(new s.a(b));else if(S)return this.importsCache.set(i,S),this._load(S,d)})}loadJSON(i,o={}){this.fire(new s.b("dataloading",{dataType:"style"})),this._request=s.f.frame(()=>{this._request=null,this._load(i,!1!==o.validate)})}loadEmpty(){this.fire(new s.b("dataloading",{dataType:"style"})),this._load(l1,!1)}_loadImports(i,o,d){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const v of i){const b=this._createFragmentStyle(v),S=new Promise(R=>{b.once("style.import.load",R),b.once("error",R)}).then(()=>this.mergeAll());if(m.push(S),this.resolvedImports.has(v.url)){b.loadEmpty();continue}const z=v.data||this.importsCache.get(v.url);z?b.loadJSON(z,{validate:o}):v.url?b.loadURL(v.url,{validate:o}):b.loadEmpty();const H={style:b,id:v.id,config:v.config};if(d){const R=this.fragments.findIndex(({id:B})=>B===d);this.fragments=this.fragments.slice(0,R).concat(H).concat(this.fragments.slice(R))}else this.fragments.push(H)}return Promise.allSettled(m)}_createFragmentStyle(i){const o=this.scope?s.ag(i.id,this.scope):i.id,d=new u1(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:i.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return d.setEventedParent(this.map,{style:d}),d}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const i=this.isRootStyle();this._shouldPrecompile=i,this.fire(new s.b(i?"style.load":"style.import.load"))}_load(i,o){const d=i.schema;if(this.isRootStyle()&&(i.fragment||d&&!1!==i.fragment)){const b=s.e({},l1,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(b,o)}if(this.setConfig(this._config,d),o&&ua(this,Ji(i)))return;this._loaded=!0,this.stylesheet=s.c1(i);for(const b in i.sources)this.addSource(b,i.sources[b],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const m=va(this.stylesheet.layers);if(this._order=m.map(b=>b.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const b=this.stylesheet.lights[0];this.light=new Zn(b.properties,b.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Zn(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const b of m){const S=s.c2(b,this.scope,this.options);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize();const z=this.getOwnLayerSourceCache(S),H=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&S.canCastShadows()&&H&&(z.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const v=this.stylesheet.terrain;v&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=s.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.b("data",{dataType:"style"})),i.imports?this._loadImports(i.imports,o).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let i,o,d,m,v,b,S,z;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(H=>{if(H.stylesheet){if(null!=H.light&&(i=H.light),H.stylesheet.lights)for(const R of H.stylesheet.lights)"ambient"===R.type&&null!=H.ambientLight&&(o=H.ambientLight),"directional"===R.type&&null!=H.directionalLight&&(d=H.directionalLight);m=this._prioritizeTerrain(m,H.terrain,H.stylesheet.terrain),H.stylesheet.fog&&null!=H.fog&&(v=H.fog),null!=H.stylesheet.camera&&(z=H.stylesheet.camera),null!=H.stylesheet.projection&&(b=H.stylesheet.projection),null!=H.stylesheet.transition&&(S=H.stylesheet.transition)}}),this.light=i,this.ambientLight=o,this.directionalLight=d,this.fog=v,null===m?delete this.terrain:this.terrain=m,this.camera=z||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=s.e({},Zs,S),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const o=d=>{for(const m of d.fragments)o(m.style);i(d)};o(this)}_prioritizeTerrain(i,o,d){const m=i&&0===i.drapeRenderMode;return null===d?o&&0===o.drapeRenderMode?o:m?i:null:null!=o&&(!i||m||o&&1===o.drapeRenderMode)?o:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{i=this._prioritizeTerrain(i,o.terrain,o.stylesheet.terrain)}),null===i?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(o=>{null!=o.stylesheet.projection&&(i=o.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},o={},d={};this.forEachFragmentStyle(m=>{for(const v in m._sourceCaches){const b=s.ag(v,m.scope);i[b]=m._sourceCaches[v]}for(const v in m._otherSourceCaches){const b=s.ag(v,m.scope);o[b]=m._otherSourceCaches[v]}for(const v in m._symbolSourceCaches){const b=s.ag(v,m.scope);d[b]=m._symbolSourceCaches[v]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=d}mergeLayers(){const i={},o=[],d={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const b of v._order){const S=v._layers[b];if("slot"===S.type){const z=s.c3(b);if(i[z])continue;i[z]=[]}S.slot&&i[S.slot]?i[S.slot].push(S):o.push(S)}}),this._mergedOrder=[];const m=(v=[])=>{for(const b of v)if("slot"===b.type){const S=s.c3(b.id);i[S]&&m(i[S])}else{const S=s.ag(b.id,b.scope);this._mergedOrder.push(S),d[S]=b,b.is3D()&&(this._has3DLayers=!0),"circle"===b.type&&(this._hasCircleLayers=!0),"symbol"===b.type&&(this._hasSymbolLayers=!0)}};m(o),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=s.e({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(o,d,m){let v,b,S;const z=s.f.devicePixelRatio>1?"@2x":"";let H=s.g(d.transformRequest(d.normalizeSpriteURL(o,z,".json"),s.R.SpriteJSON),(Y,Q)=>{H=null,S||(S=Y,v=Q,B())}),R=s.d(d.transformRequest(d.normalizeSpriteURL(o,z,".png"),s.R.SpriteImage),(Y,Q)=>{R=null,S||(S=Y,b=Q,B())});function B(){if(S)m(S);else if(v&&b){const Y=s.f.getImageData(b),Q={};for(const le in v){const{width:ce,height:pe,x:re,y:ve,sdf:Le,pixelRatio:Ce,stretchX:ze,stretchY:ge,content:Ie}=v[le],Qe=new s.h({width:ce,height:pe});s.h.copy(Y,Qe,{x:re,y:ve},{x:0,y:0},{width:ce,height:pe}),Q[le]={data:Qe,pixelRatio:Ce,sdf:Le,stretchX:ze,stretchY:ge,content:Ie}}m(null,Q)}}return{cancel(){H&&(H.cancel(),H=null),R&&(R.cancel(),R=null)}}}(i,this.map._requestManager,(o,d)=>{if(this._spriteRequest=null,o)this.fire(new s.a(o));else if(d)for(const m in d)this.imageManager.addImage(m,this.scope,d[m]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.b("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getOwnSource(i.source);if(!o)return;const d=i.sourceLayer;d&&("geojson"===o.type||o.vectorLayerIds&&-1===o.vectorLayerIds.indexOf(d))&&this.fire(new s.a(new Error(`Source layer "${d}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,o)=>{const d=this.fragments[o];return d&&d.style&&(i.data=d.style.serialize()),i})}_serializeSources(){const i={};for(const o in this._sourceCaches){const d=this._sourceCaches[o].getSource();i[d.id]||(i[d.id]=d.serialize())}return i}_serializeLayers(i){const o=[];for(const d of i){const m=this._layers[d];m&&"custom"!==m.type&&o.push(m.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&("function"==typeof i.isLayerDraped?i.isLayerDraped(this.getLayerSourceCache(i)):X2.has(i.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const o=this.getOwnLayer(i);if(o)return o;this.fire(new s.a(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const o=this.getOwnSource(i);if(o)return o;this.fire(new s.a(new Error(`The source '${i}' does not exist in the map's style.`)))}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const o=this.calculateLightsBrightness();i.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const d=this._changes.isDirty();if(this._changes.isDirty()){const v=this._changes.getLayerUpdatesByScope();for(const b in v){const{updatedIds:S,removedIds:z}=v[b];(S||z)&&this._updateWorkerLayers(b,S,z)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const m={};for(const v in this._mergedSourceCaches){const b=this._mergedSourceCaches[v];m[v]=b.used,b.used=!1,b.tileCoverLift=0}for(const v of this._mergedOrder){const b=this._mergedLayers[v];if(b.recalculate(i,this._availableImages),!b.isHidden(i.zoom)){const S=this.getLayerSourceCache(b);S&&(S.used=!0,S.tileCoverLift=Math.max(S.tileCoverLift,b.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let S=b.minzoom||0;S<(b.maxzoom||25.5);S++){const z=this.map.painter;if(z){const H=b.getProgramIds();if(!H)continue;for(const R of H){const B=b.getDefaultProgramParams(R,i.zoom);B&&(z.style=this,this.fog&&(z._fogVisible=!0,B.overrideFog=!0,z.getOrCreateProgram(R,B)),z._fogVisible=!1,B.overrideFog=!1,z.getOrCreateProgram(R,B),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(B.overrideRtt=!0,z.getOrCreateProgram(R,B)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const v in m){const b=this._mergedSourceCaches[v];m[v]!==b.used&&b.getSource().fire(new s.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new s.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,o,d){const m=this.getFragmentStyle(i);m&&this.dispatcher.broadcast("updateLayers",{layers:o?m._serializeLayers(o):[],scope:i,removedIds:d||[],options:m.options})}setState(i){if(this._checkLoaded(),ua(this,Ji(i)))return!1;(i=s.c1(i)).layers=va(i.layers);const o=function(m,v){if(!m)return[{command:cr.setStyle,args:[v]}];let b=[];try{if(!ct(m.version,v.version))return[{command:cr.setStyle,args:[v]}];ct(m.center,v.center)||b.push({command:cr.setCenter,args:[v.center]}),ct(m.zoom,v.zoom)||b.push({command:cr.setZoom,args:[v.zoom]}),ct(m.bearing,v.bearing)||b.push({command:cr.setBearing,args:[v.bearing]}),ct(m.pitch,v.pitch)||b.push({command:cr.setPitch,args:[v.pitch]}),ct(m.sprite,v.sprite)||b.push({command:cr.setSprite,args:[v.sprite]}),ct(m.glyphs,v.glyphs)||b.push({command:cr.setGlyphs,args:[v.glyphs]}),ct(m.imports,v.imports)||function(B=[],Y=[],Q){Y=Y||[];const le=(B=B||[]).map(ao),ce=Y.map(ao),pe=B.reduce(Ua,{}),re=Y.reduce(Ua,{}),ve=le.slice();let Le,Ce,ze,ge;for(Le=0,Ce=0;Le<le.length;Le++)ze=le[Le],re.hasOwnProperty(ze)?Ce++:(Q.push({command:cr.removeImport,args:[ze]}),ve.splice(ve.indexOf(ze,Ce),1));for(Le=0,Ce=0;Le<ce.length;Le++)ze=ce[ce.length-1-Le],ve[ve.length-1-Le]!==ze&&(pe.hasOwnProperty(ze)?(Q.push({command:cr.removeImport,args:[ze]}),ve.splice(ve.lastIndexOf(ze,ve.length-Ce),1)):Ce++,ge=ve[ve.length-Le],Q.push({command:cr.addImport,args:[re[ze],ge]}),ve.splice(ve.length-Le,0,ze));for(const Ie of Y){const Qe=pe[Ie.id];Qe&&!ct(Qe,Ie)&&Q.push({command:cr.updateImport,args:[Ie.id,Ie]})}}(m.imports,v.imports,b),ct(m.transition,v.transition)||b.push({command:cr.setTransition,args:[v.transition]}),ct(m.light,v.light)||b.push({command:cr.setLight,args:[v.light]}),ct(m.fog,v.fog)||b.push({command:cr.setFog,args:[v.fog]}),ct(m.projection,v.projection)||b.push({command:cr.setProjection,args:[v.projection]}),ct(m.lights,v.lights)||b.push({command:cr.setLights,args:[v.lights]}),ct(m.camera,v.camera)||b.push({command:cr.setCamera,args:[v.camera]});const S={},z=[];!function(B,Y,Q,le){let ce;for(ce in Y=Y||{},B=B||{})B.hasOwnProperty(ce)&&(Y.hasOwnProperty(ce)||Ba(ce,Q,le));for(ce in Y){if(!Y.hasOwnProperty(ce))continue;const pe=Y[ce];B.hasOwnProperty(ce)?ct(B[ce],pe)||("geojson"===B[ce].type&&"geojson"===pe.type&&v1(B,Y,ce)?Q.push({command:cr.setGeoJSONSourceData,args:[ce,pe.data]}):D2(ce,Y,Q,le)):To(ce,Y,Q)}}(m.sources,v.sources,z,S);const H=[];m.layers&&m.layers.forEach(B=>{B.source&&S[B.source]?b.push({command:cr.removeLayer,args:[B.id]}):H.push(B)});let R=m.terrain;R&&S[R.source]&&(b.push({command:cr.setTerrain,args:[void 0]}),R=void 0),b=b.concat(z),ct(R,v.terrain)||b.push({command:cr.setTerrain,args:[v.terrain]}),function(B,Y,Q){Y=Y||[];const le=(B=B||[]).map(ao),ce=Y.map(ao),pe=B.reduce(Ua,{}),re=Y.reduce(Ua,{}),ve=le.slice(),Le=Object.create(null);let Ce,ze,ge,Ie,Qe,nt,dt;for(Ce=0,ze=0;Ce<le.length;Ce++)ge=le[Ce],re.hasOwnProperty(ge)?ze++:(Q.push({command:cr.removeLayer,args:[ge]}),ve.splice(ve.indexOf(ge,ze),1));for(Ce=0,ze=0;Ce<ce.length;Ce++)ge=ce[ce.length-1-Ce],ve[ve.length-1-Ce]!==ge&&(pe.hasOwnProperty(ge)?(Q.push({command:cr.removeLayer,args:[ge]}),ve.splice(ve.lastIndexOf(ge,ve.length-ze),1)):ze++,nt=ve[ve.length-Ce],Q.push({command:cr.addLayer,args:[re[ge],nt]}),ve.splice(ve.length-Ce,0,ge),Le[ge]=!0);for(Ce=0;Ce<ce.length;Ce++)if(ge=ce[Ce],Ie=pe[ge],Qe=re[ge],!Le[ge]&&!ct(Ie,Qe))if(ct(Ie.source,Qe.source)&&ct(Ie["source-layer"],Qe["source-layer"])&&ct(Ie.type,Qe.type)){for(dt in Qo(Ie.layout,Qe.layout,Q,ge,null,cr.setLayoutProperty),Qo(Ie.paint,Qe.paint,Q,ge,null,cr.setPaintProperty),ct(Ie.slot,Qe.slot)||Q.push({command:cr.setSlot,args:[ge,Qe.slot]}),ct(Ie.filter,Qe.filter)||Q.push({command:cr.setFilter,args:[ge,Qe.filter]}),ct(Ie.minzoom,Qe.minzoom)&&ct(Ie.maxzoom,Qe.maxzoom)||Q.push({command:cr.setLayerZoomRange,args:[ge,Qe.minzoom,Qe.maxzoom]}),Ie)Ie.hasOwnProperty(dt)&&"layout"!==dt&&"paint"!==dt&&"filter"!==dt&&"metadata"!==dt&&"minzoom"!==dt&&"maxzoom"!==dt&&"slot"!==dt&&(0===dt.indexOf("paint.")?Qo(Ie[dt],Qe[dt],Q,ge,dt.slice(6),cr.setPaintProperty):ct(Ie[dt],Qe[dt])||Q.push({command:cr.setLayerProperty,args:[ge,dt,Qe[dt]]}));for(dt in Qe)Qe.hasOwnProperty(dt)&&!Ie.hasOwnProperty(dt)&&"layout"!==dt&&"paint"!==dt&&"filter"!==dt&&"metadata"!==dt&&"minzoom"!==dt&&"maxzoom"!==dt&&"slot"!==dt&&(0===dt.indexOf("paint.")?Qo(Ie[dt],Qe[dt],Q,ge,dt.slice(6),cr.setPaintProperty):ct(Ie[dt],Qe[dt])||Q.push({command:cr.setLayerProperty,args:[ge,dt,Qe[dt]]}))}else Q.push({command:cr.removeLayer,args:[ge]}),nt=ve[ve.lastIndexOf(ge)+1],Q.push({command:cr.addLayer,args:[Qe,nt]})}(H,v.layers,b)}catch(S){console.warn("Unable to compute style diff:",S),b=[{command:cr.setStyle,args:[v]}]}return b}(this.serialize(),i).filter(m=>!(m.command in zo));if(0===o.length)return!1;const d=o.filter(m=>!(m.command in v2));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);return o.forEach(m=>{this[m.command].apply(this,m.args)}),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,o){return this.getImage(i)?this.fire(new s.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,o),this._afterImageUpdated(i),this)}updateImage(i,o){this.imageManager.updateImage(i,this.scope,o)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new s.a(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,o,d={}){return this._checkLoaded(),this._validate(Hn,`models.${i}`,o,null,d)||(this.modelManager.addModel(i,o,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new s.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,o,d={}){if(this._checkLoaded(),void 0!==this.getOwnSource(i))throw new Error(`There is already a source with ID "${i}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(ir,`sources.${i}`,o,null,d))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const m=Nr(i,o,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const v=b=>{const S=(b?"symbol:":"other:")+m.id,z=s.ag(S,this.scope),H=this._sourceCaches[S]=new za(z,m,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=H,H.onAdd(this.map)};v(!1),"vector"!==o.type&&"geojson"!==o.type||v(!0),m.onAdd&&m.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const o=this.getOwnSource(i);if(!o)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===i)return this.fire(new s.a(new Error(`Source "${i}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new s.a(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const d=this.getOwnSourceCaches(i);for(const m of d){const v=s.c3(m.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(m.id),m.fire(new s.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getOwnSource(i).setData(o),this._changes.setDirty()}getOwnSource(i){const o=this.getOwnSourceCache(i);return o&&o.getSource()}getOwnSources(){const i=[];for(const o in this._otherSourceCaches){const d=this.getOwnSourceCache(o);d&&i.push(d.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const o in i){const d=i[o]._tiles;for(const m in d){const v=d[m];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const m of i){if(this._validate(sn,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(m),v.updateTransitions(o)}else this.ambientLight=new In(m,vn,this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(m),v.updateTransitions(o)}else this.directionalLight=new In(m,ei,this.scope,this.options)}}const d=new s.K(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,o=this.ambientLight;if(!i||!o)return;const d=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),m=i.properties.get("color").toArray01(),v=i.properties.get("intensity"),b=i.properties.get("direction"),S=1-s.bQ(b.x,b.y,b.z)[2]/90,z=d(m)*v*S,H=o.properties.get("color").toArray01(),R=o.properties.get("intensity");return(z+d(H)*R)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(s.c4(i)){const o=s.c5(i),d=this.fragments.find(({id:v})=>v===o);if(!d)throw new Error(`Style import not found: ${i}`);const m=s.c3(i);return d.style.getFragmentStyle(m)}{const o=this.fragments.find(({id:d})=>d===i);if(!o)throw new Error(`Style import not found: ${i}`);return o.style}}getConfigProperty(i,o){const d=this.getFragmentStyle(i);if(!d)return null;const m=s.ag(o,d.scope),v=d.options.get(m),b=v?v.value||v.default:null;return b?b.serialize():null}setConfigProperty(i,o,d){const m=s.r(d);if("success"!==m.result)return void ua(this,m.value);const v=m.value.expression,b=this.getFragmentStyle(i);if(!b)return;const S=s.ag(o,b.scope),z=b.options.get(S);z&&(this.options.set(S,{...z,value:v}),this.updateConfigDependencies())}setConfig(i,o){if(this._config=i,i||o)if(o)for(const d in o){let m,v;const b=s.r(o[d].default);if("success"===b.result&&(m=b.value.expression),i&&void 0!==i[d]){const Y=s.r(i[d]);"success"===Y.result&&(v=Y.value.expression)}const{minValue:S,maxValue:z,stepValue:H,type:R,values:B}=o[d];if(m){const Y=s.ag(d,this.scope);this.options.set(Y,{default:m,value:v,minValue:S,maxValue:z,stepValue:H,type:R,values:B})}else this.fire(new s.a(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new s.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const i of this._configDependentLayers){const o=this.getLayer(i);o&&(o.possiblyEvaluateVisibility(),this._updateLayer(o))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(i,o,d={}){this._checkLoaded();const m=i.id;if(this._layers[m])return void this.fire(new s.a(new Error(`Layer with id "${m}" already exists on this map`)));let v;if("custom"===i.type){if(ua(this,s.c6(i)))return;v=s.c2(i,this.scope,this.options)}else{if("object"==typeof i.source&&(this.addSource(m,i.source),i=s.c1(i),i=s.e(i,{source:m})),this._validate(it,`layers.${m}`,i,{arrayIndex:-1},d))return;v=s.c2(i,this.scope,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[v.id]=v.serialize()}v.isConfigDependent&&this._configDependentLayers.add(v.fqid);let b=this._order.length;if(o){const R=this._order.indexOf(o);if(-1===R)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));v.slot===this._layers[o].slot?b=R:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=v;const S=this.getOwnLayerSourceCache(v),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&v.canCastShadows()&&z&&(S.castsShadows=!0);const H=this._changes.getRemovedLayer(v);if(H&&v.source&&S&&"custom"!==v.type){this._changes.discardLayerRemoval(v);const R=s.ag(v.source,v.scope);H.type!==v.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(i,o){this._checkLoaded();const d=this._checkLayer(i);if(!d||i===o)return;const m=this._order.indexOf(i);this._order.splice(m,1);let v=this._order.length;if(o){const b=this._order.indexOf(o);if(-1===b)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));d.slot===this._layers[o].slot?v=b:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const o=this._checkLayer(i);if(!o)return;o.setEventedParent(null);const d=this._order.indexOf(i);this._order.splice(d,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const m=this.getOwnLayerSourceCache(o);if(m&&m.castsShadows){let v=!1;for(const b in this._layers)if(this._layers[b].source===o.source&&this._layers[b].canCastShadows()){v=!0;break}m.castsShadows=v}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,d){this._checkLoaded();const m=this._checkLayer(i);m&&(m.minzoom===o&&m.maxzoom===d||(null!=o&&(m.minzoom=o),null!=d&&(m.maxzoom=d),this._updateLayer(m)))}setSlot(i,o){this._checkLoaded();const d=this._checkLayer(i);d&&d.slot!==o&&(d.slot=o,this._updateLayer(d))}setFilter(i,o,d={}){this._checkLoaded();const m=this._checkLayer(i);if(m&&!ct(m.filter,o))return null==o?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(zt,`layers.${m.id}.filter`,o,{layerType:m.type},d)||(m.filter=s.c1(o),this._updateLayer(m)))}getFilter(i){const o=this._checkLayer(i);if(o)return s.c1(o.filter)}setLayoutProperty(i,o,d,m={}){this._checkLoaded();const v=this._checkLayer(i);if(v&&!ct(v.getLayoutProperty(o),d)){if(null!=d&&(!m||!1!==m.validate)&&ua(v,It.call(Ji,{key:`layers.${i}.layout.${o}`,layerType:v.type,objectKey:o,value:d,styleSpec:s.D,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(o,d),v.isConfigDependent&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(i,o){const d=this._checkLayer(i);if(d)return d.getLayoutProperty(o)}setPaintProperty(i,o,d,m={}){this._checkLoaded();const v=this._checkLayer(i);if(!v||ct(v.getPaintProperty(o),d)||null!=d&&(!m||!1!==m.validate)&&ua(v,At.call(Ji,{key:`layers.${i}.paint.${o}`,layerType:v.type,objectKey:o,value:d,styleSpec:s.D})))return;const b=v.setPaintProperty(o,d);v.isConfigDependent&&this._configDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(i,o){const d=this._checkLayer(i);if(d)return d.getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const d=i.source,m=i.sourceLayer,v=this._checkSource(d);if(!v)return;const b=v.type;if("geojson"===b&&m)return void this.fire(new s.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===b&&!m)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new s.a(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(d);for(const z of S)z.setFeatureState(m,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const d=i.source,m=this._checkSource(d);if(!m)return;const v=m.type,b="vector"===v?i.sourceLayer:void 0;if("vector"===v&&!b)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new s.a(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(d);for(const z of S)z.removeFeatureState(b,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,d=i.sourceLayer,m=this._checkSource(o);if(m){if("vector"!==m.type||d)return void 0===i.id&&this.fire(new s.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(d,i.id);this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=s.e({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return s.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),o=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return s.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(i){this._changes.updateLayer(i);const o=this.getLayerSourceCache(i),d=s.ag(i.source,i.scope),m=this._changes.getUpdatedSourceCaches();i.source&&!m[d]&&o&&"raster"!==o.getSource().type&&(this._changes.updateSourceCache(d,"reload"),o.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=S=>"fill-extrusion"===this._mergedLayers[S].type||"model"===this._mergedLayers[S].type,d=this.order,m={},v=[];for(let S=d.length-1;S>=0;S--){const z=d[S];if(o(z)){m[z]=S;for(const H of i){const R=H[z];if(R)for(const B of R)v.push(B)}}}v.sort((S,z)=>z.intersectionZ-S.intersectionZ);const b=[];for(let S=d.length-1;S>=0;S--){const z=d[S];if(o(z))for(let H=v.length-1;H>=0;H--){const R=v[H].feature;if(m[R.layer.id]<S)break;b.push(R),v.pop()}else for(const H of i){const R=H[z];if(R)for(const B of R)b.push(B.feature)}}return b}queryRenderedFeatures(i,o,d){o&&o.filter&&this._validate(zt,"queryRenderedFeatures.filter",o.filter,null,o),o.scope=this.scope,o.availableImages=this._availableImages,o.serializedLayers=this._serializedLayers;const m={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.a(new Error("parameters.layers must be an Array."))),[];for(const H of o.layers){const R=this._mergedLayers[H];if(!R)return this.fire(new s.a(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];m[R.source]=!0}}const v=[],b=o.serializedLayers||{},S=o&&o.layers?o.layers.some(H=>{const R=this.getLayer(H);return R&&R.is3D()}):this.has3DLayers(),z=Oi.createFromScreenPoints(i,d);for(const H in this._mergedSourceCaches){const R=this._mergedSourceCaches[H].getSource();if(!R||R.scope!==o.scope)continue;const B=this._mergedSourceCaches[H].getSource().id;o.layers&&!m[B]||v.push(Fa(this._mergedSourceCaches[H],this._mergedLayers,b,z,o,d,S,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(H,R,B,Y,Q,le,ce){const pe={},re=le.queryRenderedSymbols(Y),ve=[];for(const Le of Object.keys(re).map(Number))ve.push(ce[Le]);ve.sort(_1);for(const Le of ve){const Ce=Le.featureIndex.lookupSymbolFeatures(re[Le.bucketInstanceId],R,Le.bucketIndex,Le.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,H);for(const ze in Ce){const ge=pe[ze]=pe[ze]||[],Ie=Ce[ze];Ie.sort((Qe,nt)=>{const dt=Le.featureSortOrder;if(dt){const $t=dt.indexOf(Qe.featureIndex);return dt.indexOf(nt.featureIndex)-$t}return nt.featureIndex-Qe.featureIndex});for(const Qe of Ie)ge.push(Qe)}}for(const Le in pe)pe[Le].forEach(Ce=>{const ze=Ce.feature,ge=B(H[Le]);if(!ge)return;const Ie=ge.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=Ie});return pe}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),z.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,o){o&&o.filter&&this._validate(zt,"querySourceFeatures.filter",o.filter,null,o);const d=this.getOwnSourceCaches(i);let m=[];for(const v of d)m=m.concat(oo(v,o));return m}addSourceType(i,o,d){return u1.getSourceType(i)?d(new Error(`A source type called "${i}" already exists.`)):(u1.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,o,d={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const S in i)if(!ct(i[S],m[S])){v=!0;break}if(!v)return;const b=this._getTransitionParameters();this.light.setLight(i,o,d),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&0!==o||delete this.terrain,null===i?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let d=i;const m=null==i.source;if(1===o){if("object"==typeof d.source){const S="terrain-dem-src";this.addSource(S,d.source),d=s.c1(d),d=s.e(d,{source:S})}const v=s.e({},d),b={};if(this.terrain&&m){v.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(b.style=S.serialize())}if(this._validate(me,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&o!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,o),this.fire(new s.b("data",{dataType:"style"}))}else{const v=this.terrain,b=v.get();for(const S of Object.keys(s.D.terrain))!d.hasOwnProperty(S)&&s.D.terrain[S].default&&(d[S]=s.D.terrain[S].default);for(const S in i)if(!ct(i[S],b[S])){v.set(i,this.options),this.stylesheet.terrain=i;const z=this._getTransitionParameters({duration:0});v.updateTransitions(z),this.fire(new s.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new Tt(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!ct(o.get(),i)){o.set(i,this.options),this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createFog(i);this._markersNeedUpdate=!0}_getTransitionParameters(i){return{now:s.f.now(),transition:s.e(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],o=[];for(const d in this._mergedLayers)this.isLayerDraped(this._mergedLayers[d])?i.push(d):o.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const d=this.terrain=new Hi(i,o,this.scope,this.options);1===o&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});d.updateTransitions(m)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];"fill-extrusion"===o.type&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];"symbol"===o.type&&this._updateLayer(o)}}_validate(i,o,d,m,v={}){if(v&&!1===v.validate)return!1;const b=s.e({},this.serialize());return ua(this,i.call(Ji,s.e({key:o,style:b,value:d,styleSpec:s.D},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const o=this.getSourceCaches(i);for(const d of o)d.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const o=this.getSourceCaches(i);for(const d of o)d.resume(),d.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let o;this.directionalLight&&(o=na(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(i,void 0,void 0,o)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,d,m,v=!1){let b=!1,S=!1;const z={},H={};for(const R of this._mergedOrder){const B=this._mergedLayers[R];if("symbol"!==B.type)continue;const Y=s.ag(B.source,B.scope);let Q=z[Y];if(!Q){const ce=this.getLayerSourceCache(B);if(!ce)continue;const pe=ce.getRenderableIds(!0).map(re=>ce.getTileByID(re));H[Y]=pe.slice(),Q=z[Y]=pe.sort((re,ve)=>ve.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ve.tileID)?-1:1))}const le=this.crossTileSymbolIndex.addLayer(B,Q,i.center.lng,i.projection);b=b||le}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||0===d,this._layerOrderChanged&&this.fire(new s.b("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.f.now(),i.zoom))&&(this.pauseablePlacement=new Aa(i,this._mergedOrder,v,o,d,m,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.f.now()),S=!0),b&&this.pauseablePlacement.placement.setStale()),S||b){this._buildingIndex.onNewFrame(i.zoom);for(const R of this._mergedOrder){const B=this._mergedLayers[R];"symbol"===B.type&&this.placement.updateLayerOpacities(B,z[s.ag(B.source,B.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.f.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,o){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==d.findIndex(({id:v})=>v===i.id))return this.fire(new s.a(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!o)return d.push(i),this._loadImports([i],!0),this;const m=d.findIndex(({id:v})=>v===o);return-1===m?this.fire(new s.a(new Error(`Import with id "${o}" does not exist on this map.`))):(this.stylesheet.imports=d.slice(0,m).concat(i).concat(d.slice(m)),this._loadImports([i],!0,o),this)}updateImport(i,o){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(i);return-1===m?this:"string"==typeof o?(this.setImportUrl(i,o),this):(o.url&&o.url!==d[m].url&&this.setImportUrl(i,o.url),ct(o.config,d[m].config)||this.setImportConfig(i,o.config),ct(o.data,d[m].data)||this.setImportData(i,o.data),this)}moveImport(i,o){this._checkLoaded();let d=this.stylesheet.imports||[];const m=this.getImportIndex(i);if(-1===m)return this;const v=this.getImportIndex(o);if(-1===v)return this;const b=d[m],S=this.fragments[m];return d=d.filter(({id:z})=>z!==i),this.fragments=this.fragments.filter(({id:z})=>z!==i),this.stylesheet.imports=d.slice(0,v).concat(b).concat(d.slice(v)),this.fragments=this.fragments.slice(0,v).concat(S).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(i,o){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(i);if(-1===m)return this;d[m].url=o;const v=this.fragments[m];return v.style=this._createFragmentStyle(d[m]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(o),this}setImportData(i,o){this._checkLoaded();const d=this.getImportIndex(i),m=this.stylesheet.imports||[];return-1===d?this:o?(this.fragments[d].style.setState(o),this._reloadImports(),this):(delete m[d].data,this.setImportUrl(i,m[d].url))}setImportConfig(i,o){this._checkLoaded();const d=this.getImportIndex(i),m=this.stylesheet.imports||[];if(-1===d)return this;o?m[d].config=o:delete m[d].config;const v=this.fragments[d],b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=o,v.style.setConfig(o,b),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const o=this.stylesheet.imports||[],d=this.getImportIndex(i);return-1===d||(o.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports()),this}getImportIndex(i){const o=(this.stylesheet.imports||[]).findIndex(d=>d.id===i);return-1===o&&this.fire(new s.a(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),o}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const o in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[o];d&&i.push(d.getSource())}return i}getSource(i,o){const d=this.getSourceCache(i,o);return d&&d.getSource()}getLayerSource(i){const o=this.getLayerSourceCache(i);return o&&o.getSource()}getSourceCache(i,o){const d=s.ag(i,o);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(i){const o=s.ag(i.source,i.scope);return"symbol"===i.type?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(i){const o=[];return this._mergedOtherSourceCaches[i]&&o.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&o.push(this._mergedSymbolSourceCaches[i]),o}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const o in i){const d=i[o];"reload"===d?this.reloadSource(o):"clear"===d&&this.clearSource(o)}}updateLayers(i){const o=this._changes.getUpdatedPaintProperties();for(const d of o){const m=this.getLayer(d);m&&m.updateTransitions(i)}}getImages(i,o,d){this.imageManager.getImages(o.icons,o.scope,d),this._updateTilesForChangedImages();const m=v=>{v&&v.setDependencies(o.tileID.key,o.type,o.icons)};m(this._otherSourceCaches[o.source]),m(this._symbolSourceCaches[o.source])}getGlyphs(i,o,d){this.glyphManager.getGlyphs(o.stacks,o.scope,d)}getResource(i,o,d){return s.c9(o,d)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this.getOwnSourceCaches(i);return 0===o.length?(this.fire(new s.a(new Error(`There is no source with ID '${i}'`))),!1):o.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}u1.getSourceType=function(h){return Oo[h]},u1.setSourceType=function(h,i){Oo[h]=i},u1.registerForPluginStateChange=s.bV;var l2="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",I2="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",V2="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Z="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",I="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",L="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",j="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",ie="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",we="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",Je="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",yt="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const rn=[];dr(l2,rn),dr(V2,rn),dr(I2,rn);const mn={"_prelude_fog.vertex.glsl":L,"_prelude_terrain.vertex.glsl":I,"_prelude_shadow.vertex.glsl":Je,"_prelude_fog.fragment.glsl":j,"_prelude_shadow.fragment.glsl":yt,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":ie,"_prelude_raster_particle.glsl":we},Jn={};ji("",I),ji(j,L),ji(yt,Je),ji(ie,""),ji(we,"");const Bn=ji(I2,V2),gi=l2;var Zi={background:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:ji("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ji('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:ji("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ji("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:ji("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:ji("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:ji('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:ji("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:ji("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:ji("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:ji("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ji("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:ji('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:ji('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:ji('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:ji("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:ji('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Z),skyboxGradient:ji('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Z),skyboxCapture:ji("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:ji('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:ji('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:ji("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:ji("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function dr(h,i){const o=h.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let d of o)if(d=d.trim(),"#"===d[0]&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=d.split(" ");for(const v of m)i.includes(v)||i.push(v)}}function ji(h,i){const o=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(H=>{const R=H.split(" ");return R[R.length-1]}),m=[...new Set(m)]);const v={},b=[],S=[];if(h=h.replace(o,(H,R)=>(S.push(R),"")),(i=i.replace(o,(H,R)=>(b.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let z=[...rn];dr(h,z),dr(i,z);for(const H of[...b,...S])mn[H]||console.error(`Undefined include: ${H}`),Jn[H]||(Jn[H]=[],dr(mn[H],Jn[H])),z=[...z,...Jn[H]];return{fragmentSource:h=h.replace(d,(H,R,B,Y,Q)=>(v[Q]=!0,"define"===R?`\n#ifndef HAS_UNIFORM_u_${Q}\nin ${B} ${Y} ${Q};\n#else\nuniform ${B} ${Y} u_${Q};\n#endif\n`:"initialize"===R?`\n#ifdef HAS_UNIFORM_u_${Q}\n    ${B} ${Y} ${Q} = u_${Q};\n#endif\n`:"define-attribute"===R?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    in ${B} ${Y} ${Q};\n#endif\n`:"initialize-attribute"===R?"":void 0)),vertexSource:i=i.replace(d,(H,R,B,Y,Q)=>{const le="float"===Y?"vec2":Y,ce=Q.match(/color/)?"color":le;return"define-attribute-vertex-shader-only"===R?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\nin ${B} ${Y} a_${Q};\n#endif\n`:v[Q]?"define"===R?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nin ${B} ${le} a_${Q};\nout ${B} ${Y} ${Q};\n#else\nuniform ${B} ${Y} u_${Q};\n#endif\n`:"initialize"===R?"vec4"===ce?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = a_${Q};\n#else\n    ${B} ${Y} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = unpack_mix_${ce}(a_${Q}, u_${Q}_t);\n#else\n    ${B} ${Y} ${Q} = u_${Q};\n#endif\n`:"define-attribute"===R?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    in ${B} ${Y} a_${Q};\n    out ${B} ${Y} ${Q};\n#endif\n`:"initialize-attribute"===R?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    ${Q} = a_${Q};\n#endif\n`:void 0:"define"===R?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nin ${B} ${le} a_${Q};\n#else\nuniform ${B} ${Y} u_${Q};\n#endif\n`:"define-instanced"===R?"mat4"===ce?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${Q}0;\nin vec4 a_${Q}1;\nin vec4 a_${Q}2;\nin vec4 a_${Q}3;\n#else\nuniform ${B} ${Y} u_${Q};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${B} ${le} a_${Q};\n#else\nuniform ${B} ${Y} u_${Q};\n#endif\n`:"initialize-attribute-custom"===R?`\n#ifdef HAS_ATTRIBUTE_a_${Q}\n    ${B} ${Y} ${Q} = a_${Q};\n#endif\n`:"vec4"===ce?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${B} ${Y} ${Q} = a_${Q};\n#else\n    ${B} ${Y} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${B} ${Y} ${Q} = unpack_mix_${ce}(a_${Q}, u_${Q}_t);\n#else\n    ${B} ${Y} ${Q} = u_${Q};\n#endif\n`}),staticAttributes:m,usedDefines:z,vertexIncludes:b,fragmentIncludes:S}}class wo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,d,m,v,b,S,z){this.context=i;let H=this.boundPaintVertexBuffers.length!==m.length;for(let B=0;!H&&B<m.length;B++)this.boundPaintVertexBuffers[B]!==m[B]&&(H=!0);let R=this.boundDynamicVertexBuffers.length!==S.length;for(let B=0;!R&&B<S.length;B++)this.boundDynamicVertexBuffers[B]!==S[B]&&(R=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==d||H||R||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(o,d,m,v,b,S,z);else{i.bindVertexArrayOES.set(this.vao);for(const B of S)B&&(B.bind(),z&&B.instanceCount&&B.setVertexAttribDivisor(i.gl,o,z));v&&v.dynamicDraw&&v.bind()}}freshBind(i,o,d,m,v,b,S){const z=i.numAttributes,H=this.context,R=H.gl;this.vao&&this.destroy(),this.vao=H.gl.createVertexArray(),H.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,o.enableAttributes(R,i),o.bind(),o.setVertexAttribPointers(R,i,v);for(const B of d)B.enableAttributes(R,i),B.bind(),B.setVertexAttribPointers(R,i,v);for(const B of b)B&&(B.enableAttributes(R,i),B.bind(),B.setVertexAttribPointers(R,i,v),S&&B.instanceCount&&B.setVertexAttribDivisor(R,i,S));m&&m.bind(),H.currentNumAttributes=z}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function No(h,i){const o=Math.pow(2,i.canonical.z),d=i.canonical.y;return[new s.L(0,d/o).toLngLat().lat,new s.L(0,(d+1)/o).toLngLat().lat]}function Bs(h,i,o,d,m,v,b){const S=h.context,z=S.gl,H=o.hillshadeFBO;if(!H)return;h.prepareDrawTile();const R=h.isTileAffectedByFog(i),B=h.getOrCreateProgram("hillshade",{overrideFog:R});S.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,H.colorAttachment.get());const Y=((pe,re,ve,Le)=>{const Ce=ve.paint.get("hillshade-shadow-color"),ze=ve.paint.get("hillshade-highlight-color"),ge=ve.paint.get("hillshade-accent-color"),Ie=ve.paint.get("hillshade-emissive-strength");let Qe=s.bj(ve.paint.get("hillshade-illumination-direction"));if("viewport"===ve.paint.get("hillshade-illumination-anchor"))Qe-=pe.transform.angle;else if(pe.style&&pe.style.enable3dLights()&&pe.style.directionalLight){const dt=pe.style.directionalLight.properties.get("direction"),$t=s.bQ(dt.x,dt.y,dt.z);Qe=s.bj($t[1])}const nt=!pe.options.moving;return{u_matrix:Le||pe.transform.calculateProjMatrix(re.tileID.toUnwrapped(),nt),u_image:0,u_latrange:No(0,re.tileID),u_light:[ve.paint.get("hillshade-exaggeration"),Qe],u_shadow:Ce,u_highlight:ze,u_emissive_strength:Ie,u_accent:ge}})(h,o,d,h.terrain?i.projMatrix:null);h.uploadCommonUniforms(S,B,i.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:le,tileBoundsSegments:ce}=h.getTileBoundsBuffers(o);B.draw(h,z.TRIANGLES,m,v,b,Qn.disabled,Y,d.id,Q,le,ce)}function Ps(h,i,o){if(!i.needsDEMTextureUpload)return;const d=h.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||h.getTileTexture(o.stride);const v=o.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new s.T(d,v,m.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function xs(h,i,o){const d=h.context,m=d.gl;if(!i.dem)return;const v=i.dem;if(d.activeTexture.set(m.TEXTURE1),Ps(h,i,v),!i.demTexture)return;i.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const b=v.dim;d.activeTexture.set(m.TEXTURE0);let S=i.hillshadeFBO;if(!S){const Y=new s.T(d,{width:b,height:b,data:null},m.RGBA);Y.bind(m.LINEAR,m.CLAMP_TO_EDGE),S=i.hillshadeFBO=d.createFramebuffer(b,b,!0,"renderbuffer"),S.colorAttachment.set(Y.texture)}d.bindFramebuffer.set(S.framebuffer),d.viewport.set([0,0,b,b]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:R}=h.getMercatorTileBoundsBuffers(),B=[];h.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(h,m.TRIANGLES,ci.disabled,Ci.disabled,Bi.unblended,Qn.disabled,((Y,Q)=>{const le=Q.stride,ce=s.a6.create();return s.a6.ortho(ce,0,s.V,-s.V,0,0,1),s.a6.translate(ce,ce,[0,-s.V,0]),{u_matrix:ce,u_image:1,u_dimension:[le,le],u_zoom:Y.overscaledZ}})(i.tileID,v),o.id,z,H,R),i.needsHillshadePrepare=!1}const uo=h=>({u_matrix:new s.bK(h),u_image0:new s.bO(h),u_skirt_height:new s.bN(h),u_ground_shadow_factor:new s.bM(h)}),Uo=(h,i,o)=>({u_matrix:h,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:o}),Za=(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:o,u_zoom_transition:m,u_merc_center:v,u_image0:0,u_frustum_tl:b,u_frustum_tr:S,u_frustum_br:z,u_frustum_bl:H,u_globe_pos:R,u_globe_radius:B,u_viewport:Y,u_grid_matrix:ce?Float32Array.from(ce):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:le});function h1(h,i){return null!=h&&null!=i&&!(!h.hasData()||!i.hasData())&&null!=h.demTexture&&null!=i.demTexture&&h.tileID.key!==i.tileID.key}const ha=new class{constructor(){this.operations={}}newMorphing(h,i,o,d,m){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==o.tileID.key&&(v.queued=o)}else this.operations[h]={startTime:d,phase:0,duration:m,from:i,to:o,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const i=this.operations[h];return{from:i.from,to:i.to,phase:i.phase}}update(h){for(const i in this.operations){const o=this.operations[i];for(o.phase=(h-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,h)){delete this.operations[i];break}}}_nextOp(h,i){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=i,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},fa={0:null,1:"TERRAIN_VERTEX_MORPHING"};function r2(h,i,o){if(0===i)return 0;const d=i<1&&514===o?.25/i:1;return 6*Math.pow(1.5,22-h)*Math.max(i,1)*d}function H2(h,i){const o=1<<h.z;return!i&&(0===h.x||h.x===o-1)||0===h.y||h.y===o-1}const J2=h=>({u_matrix:h});function gc(h,i,o,d,m){if(m>0){const v=s.f.now(),b=(v-h.timeAdded)/m,S=i?(v-i.timeAdded)/m:-1,z=o.getSource(),H=d.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),R=!i||Math.abs(i.tileID.overscaledZ-H)>Math.abs(h.tileID.overscaledZ-H),B=R&&h.refreshedUponExpiration?1:s.aa(R?b:1-S,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),i?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Dl extends za{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},d=new s.bW(s.bX(),null),m=Nr("mock-dem",o,d,i.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class $1 extends za{constructor(i){const o=Nr("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new s.bW(s.bX(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,d){if(i.freezeTileCoverage)return;this.transform=i;const m=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){const S=new $s(b,this._source.tileSize*b.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[b.key]=S}return v},{});for(const v in this._tiles)v in m||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){const o=this.proxyCachedFBO[i];if(void 0!==o){const d=Object.values(o);this.renderCachePool.push(...d),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _c extends s.am{constructor(i,o,d){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=d}}class y2 extends s.ck{constructor(i,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,m,v]=function(z){const H=new s.aN,R=new s.aw,B=131;H.reserve(17161),R.reserve(33800);const Y=s.V/128,Q=s.V+Y/2,le=Q+Y;for(let pe=-Y;pe<le;pe+=Y)for(let re=-Y;re<le;re+=Y){const ve=re<0||re>Q||pe<0||pe>Q?24575:0,Le=s.aa(Math.round(re),0,s.V),Ce=s.aa(Math.round(pe),0,s.V);H.emplaceBack(Le+ve,Ce)}const ce=(pe,re)=>{const ve=re*B+pe;R.emplaceBack(ve+1,ve,ve+B),R.emplaceBack(ve+B,ve+B+1,ve+1)};for(let pe=1;pe<129;pe++)for(let re=1;re<129;re++)ce(re,pe);return[0,129].forEach(pe=>{for(let re=0;re<130;re++)ce(re,pe),ce(pe,re)}),[H,R,32768]}(),b=i.context;this.gridBuffer=b.createVertexBuffer(d,s.aP.members),this.gridIndexBuffer=b.createIndexBuffer(m),this.gridSegments=s.aB.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=s.aB.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new $1(o.map),this.orthoMatrix=s.a6.create(),s.a6.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,s.V,0,s.V,0,1);const S=b.gl;this._overlapStencilMode=new Ci({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Dl(o.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,d){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const m=i.terrain.properties,v=0===i.terrain.drapeRenderMode,b=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.f.now();const S=i.terrain&&i.terrain.scope,z=m.get("source"),H=v?this._mockSourceCache:i.getSourceCache(z,S);if(!H)return void s.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=H,this._exaggeration=b?this.calculateExaggeration(o):m.get("exaggeration"),!o.projection.requiresDraping&&b&&0===this._exaggeration)return void this._disable();this.enabled=!0;const R=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(o,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),o.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(i){const o=this._previousCameraAltitude,d=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=d;const m=null!=o?d-o:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const v=i.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let S=v-this._previousZoom;const z=this._previousUpdateTimestamp;let H=v;null!=this._evaluationZoom&&(H=this._evaluationZoom,Math.abs(v-H)>.5&&(S=.5*(v-H+S)),S*m<0&&(H+=S)),this._evaluationZoom=H;const R=b.getExaggeration(H),B=R===b.getExaggeration(Math.max(0,H-.1));if(B&&Math.abs(R-this._exaggeration)<.01)return R;let Y=Math.min(.1,.00375*(this._updateTimestamp-z));return(B||R<.1||Math.abs(S)<1e-4)&&(Y=Math.min(.2,4*Y)),s.U(this._exaggeration,R,Y)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=0===d._centerAltitude&&-1===this.getAtPointOrZero(s.L.fromLngLat(d.center),-1),this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=o.getIds().map(z=>{const H=o.getTileByID(z).tileID;return H.projMatrix=d.calculateProjMatrix(H.toUnwrapped()),H});!function(z,H){const R=H.transform.pointCoordinate(H.transform.getCameraPoint()),B=new s.P(R.x,R.y);z.sort((Y,Q)=>{if(Q.overscaledZ-Y.overscaledZ)return Q.overscaledZ-Y.overscaledZ;const le=new s.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ce=new s.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),pe=B.mult(1<<Y.canonical.z);return pe.x-=.5,pe.y-=.5,pe.distSqr(le)-pe.distSqr(ce)})}(m,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},m.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const z in b){const H=b[z];if(!H.used||(H!==this.sourceCache&&this.resetTileLookupCache(H.id),this._setupProxiedCoordsForOrtho(H,i[z],v),H.usedForTerrain))continue;const R=i[z];H.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[o.id]=m.map(z=>new _c(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const H=this.terrainTileForTile[z.key];if(!H)continue;const R=H.tileID.key;R in S||(this._visibleDemTiles.push(H),S[R]=R)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const d=this._findTileCoveringTileID(o,this.sourceCache);d&&(this.terrainTileForTile[o.key]=d)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const d in this.terrainTileForTile){const m=this.terrainTileForTile[d],v=m.dem;!v||m.demTexture&&!m.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),Ps(this.painter,m,v))}}_prepareDemTileUniforms(i,o,d,m){if(!o||null==o.demTexture)return!1;const v=i.tileID.canonical,b=Math.pow(2,o.tileID.canonical.z-v.z),S=m||"";return d[`u_dem_tl${S}`]=[v.x*b%1,v.y*b%1],d[`u_dem_scale${S}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const d=new s.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.T(i,d,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;const v=m.dem.tree.minimums[0];return v>0&&i++,d+v},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const d=this._getLoadedAreaMinimum(),[m,v]=(()=>{const S=new s.cm({width:1,height:1},new Float32Array([d]));return[o.R32F,S]})();this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(i,v,m,{premultiply:!1}),b}setupElevationDraw(i,o,d){const m=this.painter.context,v=m.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};b.u_exaggeration=this.exaggeration();let S=null,z=null,H=1;if(d&&d.morphing&&this._useVertexMorphing){const Y=d.morphing.srcDemTile,Q=d.morphing.dstDemTile;H=d.morphing.phase,Y&&Q&&(this._prepareDemTileUniforms(i,Y,b,"_prev")&&(z=Y),this._prepareDemTileUniforms(i,Q,b)&&(S=Q))}const R=Y=>Y&&Y.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,B=Y=>{b.u_dem_size=1===Y.size[0]?1:Y.size[0]-2};if(z&&S)m.activeTexture.set(v.TEXTURE2),S.demTexture.bind(R(S),v.CLAMP_TO_EDGE),m.activeTexture.set(v.TEXTURE4),z.demTexture.bind(R(z),v.CLAMP_TO_EDGE),S.demTexture&&B(S.demTexture),b.u_dem_lerp=H;else{S=this.terrainTileForTile[i.tileID.key],m.activeTexture.set(v.TEXTURE2);const Y=this._prepareDemTileUniforms(i,S,b)?S.demTexture:this.emptyDEMTexture;Y.bind(R(S),v.CLAMP_TO_EDGE),B(Y)}if(m.activeTexture.set(v.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&S){const Y=(1<<S.tileID.canonical.z)*s.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=Y}if(d&&d.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),o.setTerrainUniformValues(m,b),"globe"===this.painter.transform.projection.name){const Y=this.globeUniformValues(this.painter.transform,i.tileID.canonical,d&&d.useDenormalizedUpVectorScale);o.setGlobeUniformValues(m,Y)}}globeUniformValues(i,o,d){const m=i.projection;return{u_tile_tl_up:m.upVector(o,0,0),u_tile_tr_up:m.upVector(o,s.V,0),u_tile_br_up:m.upVector(o,s.V,s.V),u_tile_bl_up:m.upVector(o,0,s.V),u_tile_up_scale:d?s.cl(1):m.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,d=this.painter.context;0!==i.length&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,v,b,S,z){if("globe"===m.transform.projection.name)!function(H,R,B,Y,Q){const le=H.context,ce=le.gl;let pe,re;const ve=H.transform,Le=s.cd(H,le,ve),Ce=(en,Jt)=>{if(re===Jt)return;const xn=[fa[Jt],"PROJECTION_GLOBE_VIEW"];Le&&xn.push("CUSTOM_ANTIALIASING");const Lt=H.isTileAffectedByFog(en);pe=H.getOrCreateProgram("globeRaster",{defines:xn,overrideFog:Lt}),re=Jt},ze=H.colorModeForRenderPass(),ge=new ci(ce.LEQUAL,ci.ReadWrite,H.depthRangeFor3D);ha.update(Q);const Ie=s.ce(ve),Qe=[s.a5(ve.center.lng),s.ae(ve.center.lat)],nt=H.globeSharedBuffers,dt=[ve.width*s.f.devicePixelRatio,ve.height*s.f.devicePixelRatio],$t=Float32Array.from(ve.globeMatrix),Ct={useDenormalizedUpVectorScale:!0};{const en=H.transform,Jt=r2(en.zoom,R.exaggeration(),R.sourceCache._source.tileSize);re=-1;const xn=ce.TRIANGLES;for(const Lt of Y){const Zt=B.getTile(Lt),ut=Ci.disabled,Nt=R.prevTerrainTileForTile[Lt.key],Cn=R.terrainTileForTile[Lt.key];h1(Nt,Cn)&&ha.newMorphing(Lt.key,Nt,Cn,Q,250),le.activeTexture.set(ce.TEXTURE0),Zt.texture&&Zt.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Un=ha.getMorphValuesForProxy(Lt.key),kn=Un?1:0;Un&&s.j(Ct,{morphing:{srcDemTile:Un.from,dstDemTile:Un.to,phase:s.cc(Un.phase)}});const Yn=s.cf(Lt.canonical),di=s.cg(Yn.getCenter().lat),Ai=s.ch(Lt.canonical,Yn,di,en.worldSize/en._pixelsPerMercatorPixel),xi=s.aT(s.ci(Lt.canonical)),bi=Za(en.expandedFarZProjMatrix,$t,Ie,xi,s.S(en.zoom),Qe,en.frustumCorners.TL,en.frustumCorners.TR,en.frustumCorners.BR,en.frustumCorners.BL,en.globeCenterInViewSpace,en.globeRadius,dt,Jt,en._farZ,Ai);if(Ce(Lt,kn),pe&&(R.setupElevationDraw(Zt,pe,Ct),H.uploadCommonUniforms(le,pe,Lt.toUnwrapped()),nt)){const[ur,ar,yr]=nt.getGridBuffers(di,0!==Jt);pe.draw(H,xn,ge,ut,ze,Qn.backCCW,bi,"globe_raster",ur,ar,yr)}}}if(nt&&(H.renderDefaultNorthPole||H.renderDefaultSouthPole)){const en=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Le&&en.push("CUSTOM_ANTIALIASING"),pe=H.getOrCreateProgram("globeRaster",{defines:en});for(const Jt of Y){const{x:xn,y:Lt,z:Zt}=Jt.canonical,ut=0===Lt,Nt=Lt===(1<<Zt)-1,[Cn,Un,kn,Yn]=nt.getPoleBuffers(Zt,!1);if(Yn&&(ut||Nt)){const di=B.getTile(Jt);le.activeTexture.set(ce.TEXTURE0),di.texture&&di.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);let Ai=s.cj(Zt,xn,ve);const xi=s.aT(s.ci(Jt.canonical)),bi=(ur,ar)=>ur.draw(H,ce.TRIANGLES,ge,Ci.disabled,ze,Qn.disabled,Za(ve.expandedFarZProjMatrix,Ai,Ai,xi,0,Qe,ve.frustumCorners.TL,ve.frustumCorners.TR,ve.frustumCorners.BR,ve.frustumCorners.BL,ve.globeCenterInViewSpace,ve.globeRadius,dt,0,ve._farZ),"globe_pole_raster",ar,kn,Yn);R.setupElevationDraw(di,pe,Ct),H.uploadCommonUniforms(le,pe,Jt.toUnwrapped()),ut&&H.renderDefaultNorthPole&&bi(pe,Cn),Nt&&H.renderDefaultSouthPole&&(Ai=s.a6.scale(s.a6.create(),Ai,[1,-1,1]),bi(pe,Un))}}}}(m,v,b,S,z);else{const H=m.context,R=H.gl;let B,Y;const Q=m.shadowRenderer,le=ft(m,m.longestCutoffRange),ce=ze=>{if(Y===ze)return;const ge=[];ge.push(fa[ze]),le.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),B=m.getOrCreateProgram("terrainRaster",{defines:ge}),Y=ze},pe=m.colorModeForRenderPass(),re=new ci(R.LEQUAL,ci.ReadWrite,m.depthRangeFor3D);ha.update(z);const ve=m.transform,Le=r2(ve.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let Ce=[0,0,0];if(Q){const ze=m.style.directionalLight,ge=m.style.ambientLight;ze&&ge&&(Ce=Da(ze,ge))}{Y=-1;const ze=R.TRIANGLES,[ge,Ie]=[v.gridIndexBuffer,v.gridSegments];for(const Qe of S){const nt=b.getTile(Qe),dt=Ci.disabled,$t=v.prevTerrainTileForTile[Qe.key],Ct=v.terrainTileForTile[Qe.key];h1($t,Ct)&&ha.newMorphing(Qe.key,$t,Ct,z,250),H.activeTexture.set(R.TEXTURE0),nt.texture&&nt.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const en=ha.getMorphValuesForProxy(Qe.key),Jt=en?1:0;let xn;en&&(xn={morphing:{srcDemTile:en.from,dstDemTile:en.to,phase:s.cc(en.phase)}});const Lt=Uo(Qe.projMatrix,H2(Qe.canonical,ve.renderWorldCopies)?Le/10:Le,Ce);if(ce(Jt),!B)continue;v.setupElevationDraw(nt,B,xn);const Zt=Qe.toUnwrapped();Q&&Q.setupShadows(Zt,B),m.uploadCommonUniforms(H,B,Zt,null,le),B.draw(m,ze,re,dt,pe,Qn.backCCW,Lt,"terrain_raster",v.gridBuffer,ge,Ie)}}}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const o=this.painter,d=this.painter.context,m=this.proxySourceCache,v=this.proxiedCoords[m.id],b=this._drapedRenderBatches.shift(),S=o.style.order,z=[];let H=0;for(const R of v){const B=m.getTileByID(R.proxyTileKey),Y=m.proxyCachedFBO[R.key]?m.proxyCachedFBO[R.key][i]:void 0,Q=void 0!==Y?m.renderCache[Y]:this.pool[H++],le=void 0!==Y;if(B.texture=Q.tex,le&&!Q.dirty){z.push(B.tileID);continue}let ce;d.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(d.clear({color:s.ax.transparent,stencil:0}),Q.dirty=!1);for(let pe=b.start;pe<=b.end;++pe){const re=o.style._mergedLayers[S[pe]];if(re.isHidden(o.transform.zoom))continue;const ve=o.style.getLayerSourceCache(re),Le=ve?this.proxyToSource[R.key][ve.id]:[R];if(!Le)continue;const Ce=Le;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),ce!==(ve?ve.id:null)&&(this._setupStencil(Q,Le,re,ve),ce=ve?ve.id:null),o.renderLayer(o,ve,re,Ce)}if(0===this._drapedRenderBatches.length)for(const pe of this._pendingGroundEffectLayers){const re=o.style._mergedLayers[S[pe]];if(re.isHidden(o.transform.zoom))continue;const ve=o.style.getLayerSourceCache(re),Le=ve?this.proxyToSource[R.key][ve.id]:[R];if(!Le)continue;const Ce=Le;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),ce!==(ve?ve.id:null)&&(this._setupStencil(Q,Le,re,ve),ce=ve?ve.id:null),o.renderLayer(o,ve,re,Ce)}this.renderedToTile?(Q.dirty=!0,z.push(B.tileID)):le||--H,5===H&&(H=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),b.end+1}postRender(){}isLayerOrderingCorrect(i){const o=i.order.length;let d=-1,m=o;for(let v=0;v<o;++v)this._style.isLayerDraped(i._mergedLayers[i.order[v]])?d=Math.max(d,v):m=Math.min(m,v);return m>d}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,o,d){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const b=v.tileID,S=1<<b.overscaledZ,{x:z,y:H}=b.canonical,R=z/S,B=(z+1)/S,Y=H/S,Q=(H+1)/S;return{minx:R,miny:Y,maxx:B,maxy:Q,t:v.dem.tree.raycastRoot(R,Y,B,Q,i,o,d),tile:v}});m.sort((v,b)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==b.t?b.t:Number.MAX_VALUE));for(const v of m){if(null==v.t)return null;const b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,o,d);if(null!=b)return b}return null}_createFBO(){const i=this.painter.context,o=i.gl,d=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const m=new s.T(i,{width:d[0],height:d[1],data:null},o.RGBA);m.bind(o.LINEAR,o.CLAMP_TO_EDGE);const v=i.createFramebuffer(d[0],d[1],!0,null);return v.colorAttachment.set(m.texture),v.depthAttachment=new _r(i,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._mergedLayers[i],d=o.isHidden(this.painter.transform.zoom);return"custom"===o.type?!d&&o.shouldRedrape():!d&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const d of this._style.getSources())if(d instanceof Ge){i=!0;break}if(!i)return;const o={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(m);if(v&&!o[v.id]&&!m.isHidden(this.painter.transform.zoom)&&"line"===m.type&&m.widthExpression()instanceof s.Z){o[v.id]=!0;for(const b of this.proxyCoords){const S=this.proxyToSource[b.key][v.id];if(S)for(const z of S)this._clearRenderCacheForTile(v.id,z)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof ye){i=!0;break}if(!i)return;const o={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(m);if(!v||o[v.id]||m.isHidden(this.painter.transform.zoom)||"raster"!==m.type)continue;const b=m.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const z=this.proxyToSource[S.key][v.id];if(z)for(const H of z){const R=gc(v.getTile(H),v.findLoadedParent(H,0),v,this.painter.transform,b);(1!==R.opacity||0!==R.mix)&&this._clearRenderCacheForTile(v.id,H)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(0===o)return;const d=[];this._pendingGroundEffectLayers=[];let m,v=0,b=this._style._mergedLayers[i[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<o;)b=this._style._mergedLayers[i[v]];for(;v<o;++v){const S=this._style._mergedLayers[i[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===m&&(m=v):("fill-extrusion"===S.type&&this._pendingGroundEffectLayers.push(v),void 0!==m&&(d.push({start:m,end:v-1}),m=void 0)))}if(void 0!==m&&d.push({start:m,end:v-1}),0!==d.length){const S=d[d.length-1];this._pendingGroundEffectLayers.every(z=>z>S.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const b=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<b.length;++S){const z=Object.values(b[S]);o.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,m=this._tilesDirty;for(let b=d.length-1;b>=0;b--){const S=d[b];if(o.getTileByID(S.key),void 0!==o.proxyCachedFBO[S.key]){const z=i[S.key],H=this.proxyToSource[S.key];let R=0;for(const B in H){const Y=H[B],Q=z[B];if(!Q||Q.length!==Y.length||Y.some((le,ce)=>le!==Q[ce]||m[B]&&m[B].hasOwnProperty(le.key))){R=-1;break}++R}for(const B in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][B]].dirty=R<0||R!==Object.values(z).length}}const v=[...this._drapedRenderBatches];v.sort((b,S)=>S.end-S.start-(b.end-b.start));for(const b of v)for(const S of d){if(o.proxyCachedFBO[S.key])continue;let z=o.renderCachePool.pop();void 0===z&&o.renderCache.length<50&&(z=o.renderCache.length,o.renderCache.push(this._createFBO())),void 0!==z&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][b.start]=z,o.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,b=v.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(d.isTileClipped())S=o.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):Ci.disabled}_renderTileClippingMasks(i,o){const d=this.painter,m=this.painter.context,v=m.gl;d._tileClippingMaskIDs={},m.setColorMode(Bi.disabled),m.setDepthMode(ci.disabled);const b=d.getOrCreateProgram("clippingMask");for(const S of i){const z=d._tileClippingMaskIDs[S.key]=--o;b.draw(d,v.TRIANGLES,ci.disabled,new Ci({func:v.ALWAYS,mask:0},z,255,v.KEEP,v.KEEP,v.REPLACE),Bi.disabled,Qn.disabled,J2(S.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const d=[i.x,i.y,1,1];s.a7.transformMat4(d,d,o.pixelMatrixInverse),s.a7.scale(d,d,1/d[3]),d[0]/=o.worldSize,d[1]/=o.worldSize;const m=o._camera.position,v=s.bl(1,o.center.lat),b=[m[0],m[1],m[2]/v,0],S=s.N.subtract([],d.slice(0,3),b);s.N.normalize(S,S);const z=this.raycast(b,S,this._exaggeration);return null!==z&&z?(s.N.scaleAndAdd(b,b,S,z),b[3]=b[2],b[2]*=v,b):null}drawDepth(){const i=this.painter,o=i.context,d=this.proxySourceCache,m=Math.ceil(i.width),v=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=o.gl,S=o.createFramebuffer(m,v,!0,"renderbuffer");o.activeTexture.set(b.TEXTURE0);const z=new s.T(o,{width:m,height:v,data:null},b.RGBA);z.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.colorAttachment.set(z.texture);const H=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,m,v);S.depthAttachment.set(H),this._depthFBO=S,this._depthTexture=z}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,m,v]),function(b,S,z,H){if("globe"===b.transform.projection.name)return;const R=b.context,B=R.gl;R.clear({depth:1});const Y=b.getOrCreateProgram("terrainDepth"),Q=new ci(B.LESS,ci.ReadWrite,b.depthRangeFor3D);for(const le of H){const ce=z.getTile(le),pe=Uo(le.projMatrix,0,[0,0,0]);S.setupElevationDraw(ce,Y),Y.draw(b,B.TRIANGLES,Q,Ci.disabled,Bi.unblended,Qn.backCCW,pe,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,d){if(i.getSource()instanceof s.ap)return this._setupProxiedCoordsForImageSource(i,o,d);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const m=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let z=0;z<v.length;z++){const H=v[z],R=this._findTileCoveringTileID(H,i);if(R){const B=this._createProxiedId(H,R,d[H.key]&&d[H.key][i.id]);m.push(B),this.proxyToSource[H.key][i.id]=[B]}}let b=!1;const S=new Set;for(let z=0;z<o.length;z++){const H=i.getTile(o[z]);if(!H||!H.hasData())continue;const R=this._findTileCoveringTileID(H.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==H.tileID.canonical.z){const B=this.proxyToSource[R.tileID.key][i.id],Y=this._createProxiedId(R.tileID,H,d[R.tileID.key]&&d[R.tileID.key][i.id]);B?B.splice(B.length-1,0,Y):this.proxyToSource[R.tileID.key][i.id]=[Y];const Q=this.proxyToSource[R.tileID.key][i.id];S.has(Q)||S.add(Q),m.push(Y),b=!0}}if(this._sourceTilesOverlap[i.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const z of S)z.sort((H,R)=>R.overscaledZ-H.overscaledZ)}_setupProxiedCoordsForImageSource(i,o,d){if(!i.getSource().loaded())return;const m=this.proxiedCoords[i.id]=[],v=this.proxyCoords,b=i.getSource(),S=b.tileID;if(!S)return;const z=new s.P(S.x,S.y)._div(1<<S.z),H=b.coordinates.map(s.L.fromLngLat).reduce((B,Y)=>(B.min.x=Math.min(B.min.x,Y.x-z.x),B.min.y=Math.min(B.min.y,Y.y-z.y),B.max.x=Math.max(B.max.x,Y.x-z.x),B.max.y=Math.max(B.max.y,Y.y-z.y),B),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(B,Y)=>{const Q=B.wrap+B.canonical.x/(1<<B.canonical.z),le=B.canonical.y/(1<<B.canonical.z),ce=s.V/(1<<B.canonical.z),pe=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),re=Y.canonical.y/(1<<Y.canonical.z);return Q+ce<pe+H.min.x||Q>pe+H.max.x||le+ce<re+H.min.y||le>re+H.max.y};for(let B=0;B<v.length;B++){const Y=v[B];for(let Q=0;Q<o.length;Q++){const le=i.getTile(o[Q]);if(!le||!le.hasData()||R(Y,le.tileID))continue;const ce=this._createProxiedId(Y,le,d[Y.key]&&d[Y.key][i.id]),pe=this.proxyToSource[Y.key][i.id];pe?pe.push(ce):this.proxyToSource[Y.key][i.id]=[ce],m.push(ce)}}}_createProxiedId(i,o,d){let m=this.orthoMatrix;if(d){const v=d.find(b=>b.key===o.tileID.key);if(v)return v}if(o.tileID.key!==i.key){const v=i.canonical.z-o.tileID.canonical.z;let b,S,z;m=s.a6.create();const H=o.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(b=s.V>>v,S=b*((o.tileID.canonical.x<<v)-i.canonical.x+H),z=b*((o.tileID.canonical.y<<v)-i.canonical.y)):(b=s.V<<-v,S=s.V*(o.tileID.canonical.x-(i.canonical.x+H<<-v)),z=s.V*(o.tileID.canonical.y-(i.canonical.y<<-v))),s.a6.ortho(m,0,b,0,b,0,1),s.a6.translate(m,m,[S,z,0])}return new _c(o.tileID,i.key,m)}_findTileCoveringTileID(i,o){let d=o.getTile(i);if(d&&d.hasData())return d;const m=this._findCoveringTileCache[o.id],v=m[i.key];if(d=v?o.getTileByID(v):null,d&&d.hasData()||null===v)return d;let b=d?d.tileID:i,S=b.overscaledZ;const z=o.getSource().minzoom,H=[];if(!v){const B=o.getSource().maxzoom;if(i.canonical.z>=B){const Y=i.canonical.z-B;o.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,o.transform.tileZoom),b=new s.am(S,i.wrap,B,i.canonical.x>>Y,i.canonical.y>>Y)):0!==Y&&(S=B,b=new s.am(S,i.wrap,B,i.canonical.x>>Y,i.canonical.y>>Y))}b.key!==i.key&&(H.push(b.key),d=o.getTile(b))}const R=B=>{H.forEach(Y=>{m[Y]=B}),H.length=0};for(S-=1;S>=z&&(!d||!d.hasData());S--){d&&R(d.tileID.key);const B=b.calculateScaledKey(S);if(d=o.getTileByID(B),d&&d.hasData())break;const Y=m[B];if(null===Y)break;void 0===Y?H.push(B):d=o.getTileByID(Y)}return R(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let d=this._tilesDirty[i];d||(d=this._tilesDirty[i]={}),d[o.key]=!0}}function x2(h,i,o){const d=function(S,z,H){const R=s.N.dot(z,S),B=s.N.dot(H,[.2126,.7152,.0722]),Y=(le,ce,pe)=>(1-pe)*le+pe*ce,Q=Y(1-.3*Math.min(B,1),1,Math.min(R+1,1));return Y(.92,1,Math.asin(s.aa(z[2],-1,1))/Math.PI+.5)*Q}(h,[0,0,1],i),m=[0,0,0];s.N.scale(m,o.slice(0,3),d);const v=[0,0,0];s.N.scale(v,i.slice(0,3),h[2]);const b=[0,0,0];return s.N.add(b,m,v),s.bU(b)}const vc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],P2=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Q2{static cacheKey(i,o,d,m){let v=`${o}${m?m.cacheKey:""}`;for(const b of d)i.usedDefines.includes(b)&&(v+=`/${b}`);return v}constructor(i,o,d,m,v,b,S){const z=i.gl;this.program=z.createProgram(),this.configuration=m,this.name=o,this.fixedDefines=[...b];const H=m?m.getBinderAttributes():[],R=(d.staticAttributes||[]).concat(H);let B=m?m.defines():[];B=B.concat(b.map(re=>`#define ${re}`));const Y="#version 300 es\n";let Q=Y+B.concat("precision mediump float;",gi,Bn.fragmentSource).join("\n");for(const re of d.fragmentIncludes)Q+=`\n${mn[re]}`;Q+=`\n${d.fragmentSource}`;let le=Y+B.concat("precision highp float;",gi,Bn.vertexSource).join("\n");for(const re of d.vertexIncludes)le+=`\n${mn[re]}`;le+=`\n${d.vertexSource}`;const ce=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(ce,Q),z.compileShader(ce),z.attachShader(this.program,ce);const pe=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(pe,le),z.compileShader(pe),z.attachShader(this.program,pe),this.attributes={},this.numAttributes=R.length;for(let re=0;re<this.numAttributes;re++)if(R[re]){const ve=R[re].startsWith("a_")?R[re]:`a_${R[re]}`;z.bindAttribLocation(this.program,re,ve),this.attributes[ve]=re}S&&S.shaderVaryings.length>0&&z.transformFeedbackVaryings(this.program,S.shaderVaryings,S.bufferMode),z.linkProgram(this.program),z.deleteShader(pe),z.deleteShader(ce),this.fixedUniforms=v(i),this.binderUniforms=m?m.getUniforms(i):[],b.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new s.bO(re=i),u_dem_prev:new s.bO(re),u_dem_tl:new s.bL(re),u_dem_scale:new s.bN(re),u_dem_tl_prev:new s.bL(re),u_dem_scale_prev:new s.bN(re),u_dem_size:new s.bN(re),u_dem_lerp:new s.bN(re),u_exaggeration:new s.bN(re),u_depth:new s.bO(re),u_depth_size_inv:new s.bL(re),u_meter_to_dem:new s.bN(re),u_label_plane_matrix_inv:new s.bK(re)}),b.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new s.bM(re),u_tile_tr_up:new s.bM(re),u_tile_br_up:new s.bM(re),u_tile_bl_up:new s.bM(re),u_tile_up_scale:new s.bN(re)}))(i)),b.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new s.bK(re),u_fog_range:new s.bL(re),u_fog_color:new s.bP(re),u_fog_horizon_blend:new s.bN(re),u_fog_vertical_limit:new s.bL(re),u_fog_temporal_offset:new s.bN(re),u_frustum_tl:new s.bM(re),u_frustum_tr:new s.bM(re),u_frustum_br:new s.bM(re),u_frustum_bl:new s.bM(re),u_globe_pos:new s.bM(re),u_globe_radius:new s.bN(re),u_globe_transition:new s.bN(re),u_is_globe:new s.bO(re),u_viewport:new s.bL(re)}))(i)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new s.bP(re)}))(i)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new s.bM(re),u_lighting_directional_dir:new s.bM(re),u_lighting_directional_color:new s.bM(re),u_ground_radiance:new s.bM(re)}))(i)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new s.bK(re),u_light_matrix_1:new s.bK(re),u_fade_range:new s.bL(re),u_shadow_normal_offset:new s.bM(re),u_shadow_intensity:new s.bN(re),u_shadow_texel_size:new s.bN(re),u_shadow_map_resolution:new s.bN(re),u_shadow_direction:new s.bM(re),u_shadow_bias:new s.bM(re),u_shadowmap_0:new s.bO(re),u_shadowmap_1:new s.bO(re)}))(i))}var re}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)d[m]&&d[m].set(this.program,m,o[m])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)d[m]&&d[m].set(this.program,m,o[m])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)d[m].set(this.program,m,o[m])}}setCutoffUniformValues(i,o){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)d[m].set(this.program,m,o[m])}}setLightsUniformValues(i,o){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in o)d[m].set(this.program,m,o[m])}}setShadowUniformValues(i,o){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;i.program.set(this.program);for(const m in o)d[m].set(this.program,m,o[m])}_drawDebugWireframe(i,o,d,m,v,b,S,z,H,R){const B=i.options.wireframe;if(!1===B.terrain&&!1===B.layers2D&&!1===B.layers3D)return;const Y=i.context;if(!(()=>!(!B.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!B.layers2D||i._terrain&&i._terrain.renderingToTexture||!vc.includes(this.name))||!(!B.layers3D||!P2.includes(this.name)))())return;const Q=Y.gl,le=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,v,Y);if(!le)return;const ce=[...this.fixedDefines];ce.push("DEBUG_WIREFRAME");const pe=i.getOrCreateProgram(this.name,{config:this.configuration,defines:ce});Y.program.set(pe.program);const re=(Ce,ze,ge)=>{if(ze[Ce]&&ge[Ce])for(const Ie in ze[Ce])ge[Ce][Ie]&&ge[Ce][Ie].set(ge.program,Ie,ze[Ce][Ie].current)};H&&H.setUniforms(pe.program,Y,pe.binderUniforms,S,{zoom:z}),re("fixedUniforms",this,pe),re("terrainUniforms",this,pe),re("globeUniforms",this,pe),re("fogUniforms",this,pe),re("lightsUniforms",this,pe),re("shadowUniforms",this,pe),le.bind(),Y.setColorMode(new Bi([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],s.ax.transparent,[!0,!0,!0,!1])),Y.setDepthMode(new ci(o.func===Q.LESS?Q.LEQUAL:o.func,ci.ReadOnly,o.range)),Y.setStencilMode(Ci.disabled);const ve=3*b.primitiveLength*2,Le=3*b.primitiveOffset*2*2;R&&R>1?Q.drawElementsInstanced(Q.LINES,ve,Q.UNSIGNED_SHORT,Le,R):Q.drawElements(Q.LINES,ve,Q.UNSIGNED_SHORT,Le),v.bind(),Y.program.set(this.program),Y.setDepthMode(o),Y.setStencilMode(d),Y.setColorMode(m)}draw(i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe,re){const ve=i.context,Le=ve.gl;if(this.failedToCreate)return;ve.program.set(this.program),ve.setDepthMode(d),ve.setStencilMode(m),ve.setColorMode(v),ve.setCullFace(b);for(const Ie of Object.keys(this.fixedUniforms))this.fixedUniforms[Ie].set(this.program,Ie,S[Ie]);le&&le.setUniforms(this.program,ve,this.binderUniforms,Y,{zoom:Q});const Ce={[Le.POINTS]:1,[Le.LINES]:2,[Le.TRIANGLES]:3,[Le.LINE_STRIP]:1}[o],ze=re&&re.length>0;if(ze){for(const Ie of re)Le.bindBufferBase(Le.TRANSFORM_FEEDBACK_BUFFER,Ie.targetIndex,Ie.buffer.buffer);Le.beginTransformFeedback(o)}const ge=pe&&pe>0?1:void 0;for(const Ie of B.get()){const Qe=Ie.vaos||(Ie.vaos={});(Qe[z]||(Qe[z]=new wo)).bind(ve,this,H,le?le.getPaintVertexBuffers():[],R,Ie.vertexOffset,ce||[],ge),pe&&pe>1?Le.drawElementsInstanced(o,Ie.primitiveLength*Ce,Le.UNSIGNED_SHORT,Ie.primitiveOffset*Ce*2,pe):R?Le.drawElements(o,Ie.primitiveLength*Ce,Le.UNSIGNED_SHORT,Ie.primitiveOffset*Ce*2):Le.drawArrays(o,Ie.vertexOffset,Ie.vertexLength),o===Le.TRIANGLES&&R&&this._drawDebugWireframe(i,d,m,v,R,Ie,Y,Q,le,pe)}ze&&Le.endTransformFeedback()}}function Vc(h,i){const o=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,h.transform.tileZoom)/o,m=d*(i.tileID.canonical.x+i.tileID.wrap*o),v=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.a3(i,1,h.transform.tileZoom),u_pixel_coord_upper:[m>>16,v>>16],u_pixel_coord_lower:[65535&m,65535&v]}}const Hc=s.a6.create(),yc=(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce)=>{const pe=i.style.light,re=pe.properties.get("position"),ve=[re.x,re.y,re.z],Le=s.co.create();"viewport"===pe.properties.get("anchor")&&(s.co.fromRotation(Le,-i.transform.angle),s.N.transformMat3(ve,ve,Le));const Ce=pe.properties.get("color"),ze=i.transform,ge={u_matrix:h,u_lightpos:ve,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+o,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:v,u_flood_light_color:B,u_vertical_scale:Y,u_flood_light_intensity:Q,u_ground_shadow_factor:le,u_emissive_strength:ce};return"globe"===ze.projection.name&&(ge.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],ge.u_zoom_transition=z,ge.u_inv_rot_matrix=R,ge.u_merc_center=H,ge.u_up_dir=ze.projection.upVector(new s.bs(0,0,0),H[0]*s.V,H[1]*s.V),ge.u_height_lift=S),ge},Ca=(h,i,o)=>({u_matrix:h,u_edge_radius:i,u_vertical_scale:o}),H1=(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q)=>{const le=yc(h,i,o,d,m,v,b,z,H,R,B,Y,Q,1,[0,0,0],0),ce={u_height_factor:-Math.pow(2,b.overscaledZ)/S.tileSize/8};return s.e(le,Vc(i,S),ce)},s2=(h,i)=>({u_matrix:h,u_emissive_strength:i}),b2=(h,i,o,d)=>s.e(s2(h,i),Vc(o,d)),w1=(h,i,o)=>({u_matrix:h,u_world:o,u_emissive_strength:i}),Pc=(h,i,o,d,m)=>s.e(b2(h,i,o,d),{u_world:m}),te=(h,i,o,d)=>{const m=s.V/o.tileSize;return{u_matrix:h,u_camera_to_center_distance:i.getCameraToCenterDistance(d),u_extrude_scale:[i.pixelsToGLUnits[0]/m,i.pixelsToGLUnits[1]/m]}},P=(h,i,o=1)=>({u_matrix:h,u_color:i,u_overlay:0,u_overlay_scale:o}),D=s.a6.create(),q=(h,i,o,d,m,v,b)=>{const S=h.transform,z="globe"===S.projection.name,H=z?s.cp(S.zoom,i.canonical)*S._pixelsPerMercatorPixel:s.a3(o,1,v),R={u_matrix:i.projMatrix,u_extrude_scale:H,u_intensity:b,u_inv_rot_matrix:D,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){R.u_inv_rot_matrix=d,R.u_merc_center=m,R.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],R.u_zoom_transition=s.S(S.zoom);const B=m[0]*s.V,Y=m[1]*s.V;R.u_up_dir=S.projection.upVector(new s.bs(0,0,0),B,Y)}return R};function he(h,[i,o,d,m],[v,b]){if(v===b)return[0,0,0,0];const S=255*(h-1)/(h*(b-v));return[i*S,o*S,d*S,m*S]}function Fe(h,i,[o,d]){return o===d?0:.5/h+(i-o)*(h-1)/(h*(d-o))}const bt=(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe,re,ve,Le,Ce)=>{return{u_matrix:h,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:v,u_scale_parent:H,u_fade_t:R.mix,u_opacity:R.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:(ge=B.paint.get("raster-saturation"),ge>0?1-1/(1.001-ge):-ge),u_contrast_factor:(ze=B.paint.get("raster-contrast"),ze>0?1/(1-ze):1+ze),u_spin_weights:Mt(B.paint.get("raster-hue-rotate")),u_perspective_transform:Y,u_raster_elevation:Q,u_zoom_transition:b,u_merc_center:S,u_cutoff_params:z,u_colorization_mix:he(s.cq,ce,re),u_colorization_offset:Fe(s.cq,pe,re),u_color_ramp:le,u_texture_offset:[Le/(ve+2*Le),ve/(ve+2*Le)],u_texture_res:[ve+2*Le,ve+2*Le],u_emissive_strength:Ce};var ze,ge};function Mt(h){h*=Math.PI/180;const i=Math.sin(h),o=Math.cos(h);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const fn=(h,i,o,d,m,v,b,S,z,H,R,B)=>({u_matrix:h,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:v,u_scale_parent:H,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:b,u_merc_center:S,u_cutoff_params:z}),An=(h,i,o,d,m,v,b,S)=>({u_tile_offset:h,u_velocity:i,u_color_ramp:d,u_velocity_res:o,u_max_speed:m,u_texture_offset:v,u_data_scale:b,u_data_offset:S}),fi=(h,i,o,d,m,v,b,S)=>({u_velocity:h,u_velocity_res:i,u_max_speed:o,u_speed_factor:d,u_lifetime_delta:m,u_rand_seed:Math.random(),u_texture_offset:v,u_data_scale:b,u_data_offset:S}),Vi=s.a6.create(),Zr=(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe,re)=>{const ve=m.transform,Le={u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(ce),u_rotate_symbol:+o,u_aspect_ratio:ve.width/ve.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+d,u_texsize:H,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vi,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vi,u_up_vector:[0,-1,0],u_icon_transition:re||0,u_icon_saturation:pe};return"globe"===ce.name&&(Le.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],Le.u_zoom_transition=B,Le.u_inv_rot_matrix=Q,Le.u_merc_center=Y,Le.u_camera_forward=ve._camera.forward(),Le.u_ecef_origin=s.cr(ve.globeMatrix,R.toUnwrapped()),Le.u_tile_matrix=Float32Array.from(ve.globeMatrix),Le.u_up_vector=le),Le},Wr=(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe)=>s.e(Zr(h,i,o,d,m,v,b,S,z,H,B,Y,Q,le,ce,pe,1),{u_gamma_scale:d?m.transform.getCameraToCenterDistance(pe)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:s.f.devicePixelRatio,u_is_halo:+R,undefined:void 0}),pr=(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce)=>s.e(Wr(h,i,o,d,m,v,b,S,!0,z,!0,R,B,Y,Q,le,ce),{u_texsize_icon:H,u_texture_icon:1}),Fr=(h,i,o,d)=>({u_matrix:h,u_emissive_strength:i,u_opacity:o,u_color:d}),_s=(h,i,o,d,m,v,b)=>s.e(function(S,z,H,R){const B=H.imageManager.getPattern(S.toString(),z),{width:Y,height:Q}=H.imageManager.getPixelSize(z),le=Math.pow(2,R.tileID.overscaledZ),ce=R.tileSize*Math.pow(2,H.transform.tileZoom)/le,pe=ce*(R.tileID.canonical.x+R.tileID.wrap*le),re=ce*R.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[Y,Q],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/s.a3(R,1,H.transform.tileZoom),u_pixel_coord_upper:[pe>>16,re>>16],u_pixel_coord_lower:[65535&pe,65535&re]}}(m,v,d,b),{u_matrix:h,u_emissive_strength:i,u_opacity:o}),vr=(h,i,o,d,m,v,b,S,z,H,R,B,Y=[0,0,0],Q)=>{const le=d.style.light,ce=le.properties.get("position"),pe=[-ce.x,-ce.y,ce.z],re=s.co.create();"viewport"===le.properties.get("anchor")&&(s.co.fromRotation(re,-d.transform.angle),s.N.transformMat3(pe,pe,re));const ve="MASK"===H.alphaMode,Le=le.properties.get("color"),Ce=B.paint.get("model-ambient-occlusion-intensity"),ze=B.paint.get("model-color").constantOr(s.ax.white),ge=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:i,u_normal_matrix:o,u_lightpos:pe,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[Le.r,Le.g,Le.b],u_camera_pos:Y,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+ve,u_alphaCutoff:H.alphaCutoff,u_baseColorFactor:[v.r,v.g,v.b,v.a],u_emissiveFactor:[b[0],b[1],b[2],1],u_metallicFactor:S,u_roughnessFactor:z,u_baseColorTexture:vt.BaseColor,u_metallicRoughnessTexture:vt.MetallicRoughness,u_normalTexture:vt.Normal,u_occlusionTexture:vt.Occlusion,u_emissionTexture:vt.Emission,u_color_mix:[ze.r,ze.g,ze.b,ge],u_aoIntensity:Ce,u_emissive_strength:R,u_occlusionTextureTransform:Q||[0,0,0,0]}},ko=new Float32Array(16),da=(h,i=ko,o=ko)=>({u_matrix:h,u_instance:i,u_node_matrix:o}),Ia={fillExtrusion:h=>({u_matrix:new s.bK(h),u_lightpos:new s.bM(h),u_lightintensity:new s.bN(h),u_lightcolor:new s.bM(h),u_vertical_gradient:new s.bN(h),u_opacity:new s.bN(h),u_edge_radius:new s.bN(h),u_ao:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_up_dir:new s.bM(h),u_height_lift:new s.bN(h),u_flood_light_color:new s.bM(h),u_vertical_scale:new s.bN(h),u_flood_light_intensity:new s.bN(h),u_ground_shadow_factor:new s.bM(h),u_emissive_strength:new s.bN(h)}),fillExtrusionDepth:h=>({u_matrix:new s.bK(h),u_edge_radius:new s.bN(h),u_vertical_scale:new s.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new s.bK(h),u_lightpos:new s.bM(h),u_lightintensity:new s.bN(h),u_lightcolor:new s.bM(h),u_vertical_gradient:new s.bN(h),u_height_factor:new s.bN(h),u_edge_radius:new s.bN(h),u_ao:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_up_dir:new s.bM(h),u_height_lift:new s.bN(h),u_image:new s.bO(h),u_texsize:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h),u_opacity:new s.bN(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new s.bK(h),u_opacity:new s.bN(h),u_ao_pass:new s.bN(h),u_meter_to_tile:new s.bN(h),u_ao:new s.bL(h),u_flood_light_intensity:new s.bN(h),u_flood_light_color:new s.bM(h),u_attenuation:new s.bN(h),u_edge_radius:new s.bN(h),u_fb:new s.bO(h),u_fb_size:new s.bN(h)}),fill:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h)}),fillPattern:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_image:new s.bO(h),u_texsize:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h)}),fillOutline:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_world:new s.bL(h)}),fillOutlinePattern:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_world:new s.bL(h),u_image:new s.bO(h),u_texsize:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h)}),circle:s.cs,collisionBox:h=>({u_matrix:new s.bK(h),u_camera_to_center_distance:new s.bN(h),u_extrude_scale:new s.bL(h)}),collisionCircle:h=>({u_matrix:new s.bK(h),u_inv_matrix:new s.bK(h),u_camera_to_center_distance:new s.bN(h),u_viewport_size:new s.bL(h)}),debug:h=>({u_color:new s.ca(h),u_matrix:new s.bK(h),u_overlay:new s.bO(h),u_overlay_scale:new s.bN(h)}),clippingMask:h=>({u_matrix:new s.bK(h)}),heatmap:h=>({u_extrude_scale:new s.bN(h),u_intensity:new s.bN(h),u_matrix:new s.bK(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_up_dir:new s.bM(h)}),heatmapTexture:h=>({u_image:new s.bO(h),u_color_ramp:new s.bO(h),u_opacity:new s.bN(h)}),hillshade:h=>({u_matrix:new s.bK(h),u_image:new s.bO(h),u_latrange:new s.bL(h),u_light:new s.bL(h),u_shadow:new s.ca(h),u_highlight:new s.ca(h),u_emissive_strength:new s.bN(h),u_accent:new s.ca(h)}),hillshadePrepare:h=>({u_matrix:new s.bK(h),u_image:new s.bO(h),u_dimension:new s.bL(h),u_zoom:new s.bN(h)}),line:s.ct,linePattern:s.cu,raster:h=>({u_matrix:new s.bK(h),u_normalize_matrix:new s.bK(h),u_globe_matrix:new s.bK(h),u_merc_matrix:new s.bK(h),u_grid_matrix:new s.cb(h),u_tl_parent:new s.bL(h),u_scale_parent:new s.bN(h),u_fade_t:new s.bN(h),u_opacity:new s.bN(h),u_image0:new s.bO(h),u_image1:new s.bO(h),u_brightness_low:new s.bN(h),u_brightness_high:new s.bN(h),u_saturation_factor:new s.bN(h),u_contrast_factor:new s.bN(h),u_spin_weights:new s.bM(h),u_perspective_transform:new s.bL(h),u_raster_elevation:new s.bN(h),u_zoom_transition:new s.bN(h),u_merc_center:new s.bL(h),u_cutoff_params:new s.bP(h),u_colorization_mix:new s.bP(h),u_colorization_offset:new s.bN(h),u_color_ramp:new s.bO(h),u_texture_offset:new s.bL(h),u_texture_res:new s.bL(h),u_emissive_strength:new s.bN(h)}),rasterParticle:h=>({u_matrix:new s.bK(h),u_normalize_matrix:new s.bK(h),u_globe_matrix:new s.bK(h),u_merc_matrix:new s.bK(h),u_grid_matrix:new s.cb(h),u_tl_parent:new s.bL(h),u_scale_parent:new s.bN(h),u_fade_t:new s.bN(h),u_opacity:new s.bN(h),u_image0:new s.bO(h),u_image1:new s.bO(h),u_raster_elevation:new s.bN(h),u_zoom_transition:new s.bN(h),u_merc_center:new s.bL(h),u_cutoff_params:new s.bP(h)}),rasterParticleTexture:h=>({u_texture:new s.bO(h),u_opacity:new s.bN(h)}),rasterParticleDraw:h=>({u_tile_offset:new s.bL(h),u_velocity:new s.bO(h),u_color_ramp:new s.bO(h),u_velocity_res:new s.bL(h),u_max_speed:new s.bN(h),u_texture_offset:new s.bL(h),u_data_scale:new s.bP(h),u_data_offset:new s.bN(h)}),rasterParticleUpdate:h=>({u_velocity:new s.bO(h),u_velocity_res:new s.bL(h),u_max_speed:new s.bN(h),u_speed_factor:new s.bN(h),u_lifetime_delta:new s.bN(h),u_rand_seed:new s.bN(h),u_texture_offset:new s.bL(h),u_data_scale:new s.bP(h),u_data_offset:new s.bN(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new s.bO(h),u_is_size_feature_constant:new s.bO(h),u_size_t:new s.bN(h),u_size:new s.bN(h),u_camera_to_center_distance:new s.bN(h),u_rotate_symbol:new s.bO(h),u_aspect_ratio:new s.bN(h),u_fade_change:new s.bN(h),u_matrix:new s.bK(h),u_label_plane_matrix:new s.bK(h),u_coord_matrix:new s.bK(h),u_is_text:new s.bO(h),u_pitch_with_map:new s.bO(h),u_texsize:new s.bL(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_camera_forward:new s.bM(h),u_tile_matrix:new s.bK(h),u_up_vector:new s.bM(h),u_ecef_origin:new s.bM(h),u_texture:new s.bO(h),u_icon_transition:new s.bN(h),u_icon_saturation:new s.bN(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new s.bO(h),u_is_size_feature_constant:new s.bO(h),u_size_t:new s.bN(h),u_size:new s.bN(h),u_camera_to_center_distance:new s.bN(h),u_rotate_symbol:new s.bO(h),u_aspect_ratio:new s.bN(h),u_fade_change:new s.bN(h),u_matrix:new s.bK(h),u_label_plane_matrix:new s.bK(h),u_coord_matrix:new s.bK(h),u_is_text:new s.bO(h),u_pitch_with_map:new s.bO(h),u_texsize:new s.bL(h),u_texture:new s.bO(h),u_gamma_scale:new s.bN(h),u_device_pixel_ratio:new s.bN(h),u_tile_id:new s.bM(h),u_zoom_transition:new s.bN(h),u_inv_rot_matrix:new s.bK(h),u_merc_center:new s.bL(h),u_camera_forward:new s.bM(h),u_tile_matrix:new s.bK(h),u_up_vector:new s.bM(h),u_ecef_origin:new s.bM(h),u_is_halo:new s.bO(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new s.bO(h),u_is_size_feature_constant:new s.bO(h),u_size_t:new s.bN(h),u_size:new s.bN(h),u_camera_to_center_distance:new s.bN(h),u_rotate_symbol:new s.bO(h),u_aspect_ratio:new s.bN(h),u_fade_change:new s.bN(h),u_matrix:new s.bK(h),u_label_plane_matrix:new s.bK(h),u_coord_matrix:new s.bK(h),u_is_text:new s.bO(h),u_pitch_with_map:new s.bO(h),u_texsize:new s.bL(h),u_texsize_icon:new s.bL(h),u_texture:new s.bO(h),u_texture_icon:new s.bO(h),u_gamma_scale:new s.bN(h),u_device_pixel_ratio:new s.bN(h),u_is_halo:new s.bO(h)}),background:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_opacity:new s.bN(h),u_color:new s.ca(h)}),backgroundPattern:h=>({u_matrix:new s.bK(h),u_emissive_strength:new s.bN(h),u_opacity:new s.bN(h),u_image:new s.bO(h),u_pattern_tl:new s.bL(h),u_pattern_br:new s.bL(h),u_texsize:new s.bL(h),u_pattern_size:new s.bL(h),u_pixel_coord_upper:new s.bL(h),u_pixel_coord_lower:new s.bL(h),u_tile_units_to_pixels:new s.bN(h)}),terrainRaster:uo,terrainDepth:uo,skybox:h=>({u_matrix:new s.bK(h),u_sun_direction:new s.bM(h),u_cubemap:new s.bO(h),u_opacity:new s.bN(h),u_temporal_offset:new s.bN(h)}),skyboxGradient:h=>({u_matrix:new s.bK(h),u_color_ramp:new s.bO(h),u_center_direction:new s.bM(h),u_radius:new s.bN(h),u_opacity:new s.bN(h),u_temporal_offset:new s.bN(h)}),skyboxCapture:h=>({u_matrix_3f:new s.cb(h),u_sun_direction:new s.bM(h),u_sun_intensity:new s.bN(h),u_color_tint_r:new s.bP(h),u_color_tint_m:new s.bP(h),u_luminance:new s.bN(h)}),globeRaster:h=>({u_proj_matrix:new s.bK(h),u_globe_matrix:new s.bK(h),u_normalize_matrix:new s.bK(h),u_merc_matrix:new s.bK(h),u_zoom_transition:new s.bN(h),u_merc_center:new s.bL(h),u_image0:new s.bO(h),u_grid_matrix:new s.cb(h),u_skirt_height:new s.bN(h),u_far_z_cutoff:new s.bN(h),u_frustum_tl:new s.bM(h),u_frustum_tr:new s.bM(h),u_frustum_br:new s.bM(h),u_frustum_bl:new s.bM(h),u_globe_pos:new s.bM(h),u_globe_radius:new s.bN(h),u_viewport:new s.bL(h)}),globeAtmosphere:h=>({u_frustum_tl:new s.bM(h),u_frustum_tr:new s.bM(h),u_frustum_br:new s.bM(h),u_frustum_bl:new s.bM(h),u_horizon:new s.bN(h),u_transition:new s.bN(h),u_fadeout_range:new s.bN(h),u_color:new s.bP(h),u_high_color:new s.bP(h),u_space_color:new s.bP(h),u_temporal_offset:new s.bN(h),u_horizon_angle:new s.bN(h)}),model:h=>({u_matrix:new s.bK(h),u_lighting_matrix:new s.bK(h),u_normal_matrix:new s.bK(h),u_lightpos:new s.bM(h),u_lightintensity:new s.bN(h),u_lightcolor:new s.bM(h),u_camera_pos:new s.bM(h),u_opacity:new s.bN(h),u_baseColorFactor:new s.bP(h),u_emissiveFactor:new s.bP(h),u_metallicFactor:new s.bN(h),u_roughnessFactor:new s.bN(h),u_baseTextureIsAlpha:new s.bO(h),u_alphaMask:new s.bO(h),u_alphaCutoff:new s.bN(h),u_baseColorTexture:new s.bO(h),u_metallicRoughnessTexture:new s.bO(h),u_normalTexture:new s.bO(h),u_occlusionTexture:new s.bO(h),u_emissionTexture:new s.bO(h),u_color_mix:new s.bP(h),u_aoIntensity:new s.bN(h),u_emissive_strength:new s.bN(h),u_occlusionTextureTransform:new s.bP(h)}),modelDepth:h=>({u_matrix:new s.bK(h),u_instance:new s.bK(h),u_node_matrix:new s.bK(h)}),groundShadow:h=>({u_matrix:new s.bK(h),u_ground_shadow_factor:new s.bM(h)}),stars:h=>({u_matrix:new s.bK(h),u_up:new s.bM(h),u_right:new s.bM(h),u_intensity_multiplier:new s.bN(h)})};let Va;function ia(h,i,o,d,m,v,b){const S=h.context,z=S.gl,H=h.transform,R=h.getOrCreateProgram("collisionBox"),B=[];let Y=0,Q=0;for(let Ce=0;Ce<d.length;Ce++){const ze=d[Ce],ge=i.getTile(ze),Ie=ge.getBucket(o);if(!Ie)continue;const Qe=A1(ze,Ie,H);let nt=Qe;0===m[0]&&0===m[1]||(nt=h.translatePosMatrix(Qe,ge,m,v));const dt=b?Ie.textCollisionBox:Ie.iconCollisionBox,$t=Ie.collisionCircleArray;if($t.length>0){const Ct=s.a6.create(),en=nt;s.a6.mul(Ct,Ie.placementInvProjMatrix,H.glCoordMatrix),s.a6.mul(Ct,Ct,Ie.placementViewportMatrix),B.push({circleArray:$t,circleOffset:Q,transform:en,invTransform:Ct,projection:Ie.getProjection()}),Y+=$t.length/4,Q=Y}dt&&(h.terrain&&h.terrain.setupElevationDraw(ge,R),R.draw(h,z.LINES,ci.disabled,Ci.disabled,h.colorModeForRenderPass(),Qn.disabled,te(nt,H,ge,Ie.getProjection()),o.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,null,H.zoom,null,[dt.collisionVertexBuffer,dt.collisionVertexBufferExt]))}if(!b||!B.length)return;const le=h.getOrCreateProgram("collisionCircle"),ce=new s.cv;ce.resize(4*Y),ce._trim();let pe=0;for(const Ce of B)for(let ze=0;ze<Ce.circleArray.length/4;ze++){const ge=4*ze,Ie=Ce.circleArray[ge+0],Qe=Ce.circleArray[ge+1],nt=Ce.circleArray[ge+2],dt=Ce.circleArray[ge+3];ce.emplace(pe++,Ie,Qe,nt,dt,0),ce.emplace(pe++,Ie,Qe,nt,dt,1),ce.emplace(pe++,Ie,Qe,nt,dt,2),ce.emplace(pe++,Ie,Qe,nt,dt,3)}(!Va||Va.length<2*Y)&&(Va=function(Ce){const ze=2*Ce,ge=new s.aw;ge.resize(ze),ge._trim();for(let Ie=0;Ie<ze;Ie++){const Qe=6*Ie;ge.uint16[Qe+0]=4*Ie+0,ge.uint16[Qe+1]=4*Ie+1,ge.uint16[Qe+2]=4*Ie+2,ge.uint16[Qe+3]=4*Ie+2,ge.uint16[Qe+4]=4*Ie+3,ge.uint16[Qe+5]=4*Ie+0}return ge}(Y));const re=S.createIndexBuffer(Va,!0),ve=S.createVertexBuffer(ce,s.cw.members,!0);for(const Ce of B){const ze={u_matrix:Ce.transform,u_inv_matrix:Ce.invTransform,u_camera_to_center_distance:(Le=H).getCameraToCenterDistance(Ce.projection),u_viewport_size:[Le.width,Le.height]};le.draw(h,z.TRIANGLES,ci.disabled,Ci.disabled,h.colorModeForRenderPass(),Qn.disabled,ze,o.id,ve,re,s.aB.simpleSegment(0,2*Ce.circleOffset,Ce.circleArray.length,Ce.circleArray.length/2),null,H.zoom)}var Le;ve.destroy(),re.destroy()}const jo=s.a6.create();function P1(h){const i=h._camera.getWorldToCamera(h.worldSize,1),o=s.a6.multiply([],i,h.globeMatrix);s.a6.invert(o,o);const d=[0,0,0],m=[0,1,0,0];return s.a7.transformMat4(m,m,o),d[0]=m[0],d[1]=m[1],d[2]=m[2],s.N.normalize(d,d),d}function Xn({width:h,height:i,anchor:o,textOffset:d,textScale:m},v){const{horizontalAlign:b,verticalAlign:S}=s.bf(o),z=-(b-.5)*h,H=-(S-.5)*i,R=s.bd(o,d);return new s.P((z/m+R[0])*v,(H/m+R[1])*v)}function C1(h,i,o,d,m,v,b,S,z,H,R){const B=h.text.placedSymbolArray,Y=h.text.dynamicLayoutVertexArray,Q=h.icon.dynamicLayoutVertexArray,le={},ce=h.getProjection(),pe=lo(S,ce,v),re=v.elevation,ve=ce.upVectorScale(S.canonical,v.center.lat,v.worldSize).metersToTile;Y.clear();for(let Le=0;Le<B.length;Le++){const Ce=B.get(Le),{tileAnchorX:ze,tileAnchorY:ge,numGlyphs:Ie}=Ce,Qe=Ce.hidden||!Ce.crossTileID||h.allowVerticalPlacement&&!Ce.placedOrientation?null:d[Ce.crossTileID];if(Qe){let nt=0,dt=0,$t=0;if(re){const Cn=re?re.getAtTileOffset(S,ze,ge):0,[Un,kn,Yn]=ce.upVector(S.canonical,ze,ge);nt=Cn*Un*ve,dt=Cn*kn*ve,$t=Cn*Yn*ve}let[Ct,en,Jt,xn]=Ds(Ce.projectedAnchorX+nt,Ce.projectedAnchorY+dt,Ce.projectedAnchorZ+$t,o?pe:b);const Lt=z1(v.getCameraToCenterDistance(ce),xn);let Zt=m.evaluateSizeForFeature(h.textSizeData,H,Ce)*Lt/s.bc;o&&(Zt*=h.tilePixelRatio/z);const ut=Xn(Qe,Zt);o?(({x:Ct,y:en,z:Jt}=ce.projectTilePoint(ze+ut.x,ge+ut.y,S.canonical)),[Ct,en,Jt]=Ds(Ct+nt,en+dt,Jt+$t,b)):(i&&ut._rotate(-v.angle),Ct+=ut.x,en+=ut.y,Jt=0);const Nt=h.allowVerticalPlacement&&Ce.placedOrientation===s.b6.vertical?Math.PI/2:0;for(let Cn=0;Cn<Ie;Cn++)s.b9(Y,Ct,en,Jt,Nt);R&&Ce.associatedIconIndex>=0&&(le[Ce.associatedIconIndex]={x:Ct,y:en,z:Jt,angle:Nt})}else Zo(Ie,Y)}if(R){Q.clear();const Le=h.icon.placedSymbolArray;for(let Ce=0;Ce<Le.length;Ce++){const ze=Le.get(Ce),{numGlyphs:ge}=ze,Ie=le[Ce];if(ze.hidden||!Ie)Zo(ge,Q);else{const{x:Qe,y:nt,z:dt,angle:$t}=Ie;for(let Ct=0;Ct<ge;Ct++)s.b9(Q,Qe,nt,dt,$t)}}h.icon.dynamicLayoutVertexBuffer.updateData(Q)}h.text.dynamicLayoutVertexBuffer.updateData(Y)}function Nc(h,i,o,d,m,v,b={}){const S=o.paint.get("icon-translate"),z=o.paint.get("text-translate"),H=o.paint.get("icon-translate-anchor"),R=o.paint.get("text-translate-anchor"),B=o.layout.get("icon-rotation-alignment"),Y=o.layout.get("text-rotation-alignment"),Q=o.layout.get("icon-pitch-alignment"),le=o.layout.get("text-pitch-alignment"),ce=o.layout.get("icon-keep-upright"),pe=o.layout.get("text-keep-upright"),re=o.paint.get("icon-color-saturation"),ve=h.context,Le=ve.gl,Ce=h.transform,ze="map"===B,ge="map"===Y,Ie="map"===Q,Qe="map"===le,nt=void 0!==o.layout.get("symbol-sort-key").constantOr(1);let dt=!1;const $t=h.depthModeForSublayer(0,ci.ReadOnly),Ct=[s.a5(Ce.center.lng),s.ae(Ce.center.lat)],en=o.layout.get("text-variable-anchor"),Jt="globe"===Ce.projection.name,xn=[],Lt=[0,-1,0];for(const Zt of d){const ut=i.getTile(Zt),Nt=ut.getBucket(o);if(!Nt||"mercator"===Nt.projection.name&&Jt||Nt.fullyClipped)continue;const Cn="globe"===Nt.projection.name,Un=Cn?s.S(Ce.zoom):0,kn=lo(Zt,Nt.getProjection(),Ce),Yn=Ce.calculatePixelsToTileUnitsMatrix(ut),di=en&&Nt.hasTextData(),Ai=Nt.hasIconTextFit()&&di&&Nt.hasIconData(),xi=Nt.getProjection().createInversionMatrix(Ce,Zt.canonical),bi=()=>{const Us=ze&&"point"!==o.layout.get("symbol-placement"),kr=[],ts=Us||Ai,Rr=o.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&Ie&&kr.push("PITCH_WITH_MAP_TERRAIN"),Cn&&(kr.push("PROJECTION_GLOBE_VIEW"),ts&&kr.push("PROJECTED_POS_ON_VIEWPORT")),Rr>0&&kr.push("ICON_TRANSITION"),Nt.icon.zOffsetVertexBuffer&&kr.push("Z_OFFSET"),re<1&&kr.push("SATURATION");const Jr=Nt.icon.programConfigurations.get(o.id),Ys=h.getOrCreateProgram(Nt.sdfIcons?"symbolSDF":"symbolIcon",{config:Jr,defines:kr});let ss;const pa=ut.imageAtlasTexture?ut.imageAtlasTexture.size:[0,0],p1=Nt.iconSizeData,k1=s.b5(p1,Ce.zoom),G2=Ie||0!==Ce.pitch,Y1=xo(kn,ut.tileID.canonical,Ie,ze,Ce,Nt.getProjection(),Yn),ra=x1(kn,ut.tileID.canonical,Ie,ze,Ce,Nt.getProjection(),Yn),no=h.translatePosMatrix(ra,ut,S,H,!0),ka=h.translatePosMatrix(kn,ut,S,H),m1=ts?jo:Y1,R1=ze&&!Ie&&!Us;let C2=Lt;!Jt&&!Ce.mercatorFromTransition||ze||(C2=P1(Ce));const Sc=Cn?C2:Lt;ss=Nt.sdfIcons&&!Nt.iconsInText?Wr(p1.kind,k1,R1,Ie,h,ka,m1,no,!1,pa,!0,Zt,Un,Ct,xi,Sc,Nt.getProjection()):Zr(p1.kind,k1,R1,Ie,h,ka,m1,no,!1,pa,Zt,Un,Ct,xi,Sc,Nt.getProjection(),re,Rr);const fl=ut.imageAtlasTexture?ut.imageAtlasTexture:null,F3=1!==o.layout.get("icon-size").constantOr(0)||Nt.iconsNeedLinear,Tc=Nt.sdfIcons||h.options.rotating||h.options.zooming||F3||G2?Le.LINEAR:Le.NEAREST,$l=Nt.sdfIcons&&0!==o.paint.get("icon-halo-width").constantOr(1),B3=h.terrain&&Ie&&Us?s.a6.invert(s.a6.create(),Y1):jo;if(Us&&Nt.icon){const Wl=Ce.elevation,ql=Wl?Wl.getAtTileOffsetFunc(Zt,Ce.center.lat,Ce.worldSize,Nt.getProjection()):null,ic=y1(kn,ut.tileID.canonical,Ie,ze,Ce,Nt.getProjection(),Yn);n1(Nt,kn,h,!1,ic,ra,Ie,ce,ql,Zt)}return{program:Ys,buffers:Nt.icon,uniformValues:ss,atlasTexture:fl,atlasTextureIcon:null,atlasInterpolation:Tc,atlasInterpolationIcon:null,isSDF:Nt.sdfIcons,hasHalo:$l,tile:ut,labelPlaneMatrixInv:B3}},ur=()=>{const Us=ge&&"point"!==o.layout.get("symbol-placement"),kr=[],ts=Us||en||Ai;h.terrainRenderModeElevated()&&Qe&&kr.push("PITCH_WITH_MAP_TERRAIN"),Cn&&(kr.push("PROJECTION_GLOBE_VIEW"),ts&&kr.push("PROJECTED_POS_ON_VIEWPORT")),Nt.text.zOffsetVertexBuffer&&kr.push("Z_OFFSET");const Rr=Nt.text.programConfigurations.get(o.id),Jr=h.getOrCreateProgram(Nt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Rr,defines:kr});let Ys,ss=[0,0],pa=null;const p1=Nt.textSizeData;Nt.iconsInText&&(ss=ut.imageAtlasTexture?ut.imageAtlasTexture.size:[0,0],pa=ut.imageAtlasTexture?ut.imageAtlasTexture:null,Ys=Qe||0!==Ce.pitch||h.options.rotating||h.options.zooming||"composite"===p1.kind||"camera"===p1.kind?Le.LINEAR:Le.NEAREST);const k1=ut.glyphAtlasTexture?ut.glyphAtlasTexture.size:[0,0],G2=s.b5(p1,Ce.zoom),Y1=xo(kn,ut.tileID.canonical,Qe,ge,Ce,Nt.getProjection(),Yn),ra=x1(kn,ut.tileID.canonical,Qe,ge,Ce,Nt.getProjection(),Yn),no=h.translatePosMatrix(ra,ut,z,R,!0),ka=h.translatePosMatrix(kn,ut,z,R),m1=ts?jo:Y1,R1=ge&&!Qe&&!Us;let C2=Lt;!Jt&&!Ce.mercatorFromTransition||ge||(C2=P1(Ce));const Sc=Cn?C2:Lt;let fl;fl=Nt.iconsInText?pr(p1.kind,G2,R1,Qe,h,ka,m1,no,k1,ss,Zt,Un,Ct,xi,Sc,Nt.getProjection()):Wr(p1.kind,G2,R1,Qe,h,ka,m1,no,!0,k1,!0,Zt,Un,Ct,xi,Sc,Nt.getProjection());const F3=ut.glyphAtlasTexture?ut.glyphAtlasTexture:null,Tc=Le.LINEAR,$l=0!==o.paint.get("text-halo-width").constantOr(1),B3=h.terrain&&Qe&&Us?s.a6.invert(s.a6.create(),Y1):jo;if(Us&&Nt.text){const Wl=Ce.elevation,ql=Wl?Wl.getAtTileOffsetFunc(Zt,Ce.center.lat,Ce.worldSize,Nt.getProjection()):null,ic=y1(kn,ut.tileID.canonical,Qe,ge,Ce,Nt.getProjection(),Yn);n1(Nt,kn,h,!0,ic,ra,Qe,pe,ql,Zt)}return{program:Jr,buffers:Nt.text,uniformValues:fl,atlasTexture:F3,atlasTextureIcon:pa,atlasInterpolation:Tc,atlasInterpolationIcon:Ys,isSDF:!0,hasHalo:$l,tile:ut,labelPlaneMatrixInv:B3}},ar=Nt.icon.segments.get().length,yr=Nt.text.segments.get().length,mr=ar&&!b.onlyText?bi():null,Yr=yr&&!b.onlyIcons?ur():null,Is=o.paint.get("icon-opacity").constantOr(1),xr=o.paint.get("text-opacity").constantOr(1);if(nt&&Nt.canOverlap){dt=!0;const Us=Is&&!b.onlyText?Nt.icon.segments.get():[],kr=xr&&!b.onlyIcons?Nt.text.segments.get():[];for(const ts of Us)xn.push({segments:new s.aB([ts]),sortKey:ts.sortKey,state:mr});for(const ts of kr)xn.push({segments:new s.aB([ts]),sortKey:ts.sortKey,state:Yr})}else b.onlyText||xn.push({segments:Is?Nt.icon.segments:new s.aB([]),sortKey:0,state:mr}),b.onlyIcons||xn.push({segments:xr?Nt.text.segments:new s.aB([]),sortKey:0,state:Yr})}dt&&xn.sort((Zt,ut)=>Zt.sortKey-ut.sortKey);for(const Zt of xn){const ut=Zt.state;if(ut)if(h.terrain&&h.terrain.setupElevationDraw(ut.tile,ut.program,{useDepthForOcclusion:Ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ut.labelPlaneMatrixInv}),ve.activeTexture.set(Le.TEXTURE0),ut.atlasTexture&&ut.atlasTexture.bind(ut.atlasInterpolation,Le.CLAMP_TO_EDGE,!0),ut.atlasTextureIcon&&(ve.activeTexture.set(Le.TEXTURE1),ut.atlasTextureIcon&&ut.atlasTextureIcon.bind(ut.atlasInterpolationIcon,Le.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,ut.program),ut.hasHalo){const Nt=ut.uniformValues;Nt.u_is_halo=1,Ts(ut.buffers,Zt.segments,o,h,ut.program,$t,m,v,Nt,2),Nt.u_is_halo=0}else{if(ut.isSDF){const Nt=ut.uniformValues;ut.hasHalo&&(Nt.u_is_halo=1,Ts(ut.buffers,Zt.segments,o,h,ut.program,$t,m,v,Nt,1)),Nt.u_is_halo=0}Ts(ut.buffers,Zt.segments,o,h,ut.program,$t,m,v,ut.uniformValues,1)}}}function Ts(h,i,o,d,m,v,b,S,z,H){const R=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];m.draw(d,d.context.gl.TRIANGLES,v,b,S,Qn.disabled,z,o.id,h.layoutVertexBuffer,h.indexBuffer,i,o.paint,d.transform.zoom,h.programConfigurations.get(o.id),R,H)}function Ya(h,i,o,d,m,v,b){const S=h.context.gl,z=o.paint.get("fill-pattern"),H=z&&z.constantOr(1);let R,B,Y,Q,le;b?(B=H&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=S.LINES):(B=H?"fillPattern":"fill",R=S.TRIANGLES);for(const ce of d){const pe=i.getTile(ce);if(H&&!pe.patternsLoaded())continue;const re=pe.getBucket(o);if(!re)continue;h.prepareDrawTile();const ve=re.programConfigurations.get(o.id),Le=h.isTileAffectedByFog(ce),Ce=h.getOrCreateProgram(B,{config:ve,overrideFog:Le});H&&(h.context.activeTexture.set(S.TEXTURE0),pe.imageAtlasTexture&&pe.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ve.updatePaintBuffers());const ze=z.constantOr(null);if(ze&&pe.imageAtlas){const Qe=pe.imageAtlas.patternPositions[ze.toString()];Qe&&ve.setConstantPatternPositions(Qe)}const ge=h.translatePosMatrix(ce.projMatrix,pe,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Ie=o.paint.get("fill-emissive-strength");if(b){Q=re.indexBuffer2,le=re.segments2;const Qe=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Y="fillOutlinePattern"===B&&H?Pc(ge,Ie,h,pe,Qe):w1(ge,Ie,Qe)}else Q=re.indexBuffer,le=re.segments,Y=H?b2(ge,Ie,h,pe):s2(ge,Ie);h.uploadCommonUniforms(h.context,Ce,ce.toUnwrapped()),Ce.draw(h,R,m,h.stencilModeForClipping(ce),v,Qn.disabled,Y,o.id,re.layoutVertexBuffer,Q,le,o.paint,h.transform.zoom,ve,void 0)}}function ai(h,i,o,d,m,v,b,S){o.resetLayerRenderingStats(h);const z=h.context,H=z.gl,R=h.transform,B=o.paint.get("fill-extrusion-pattern"),Y=B.constantOr(1),Q=o.paint.get("fill-extrusion-opacity"),le=h.style.enable3dLights(),ce=o.paint.get(le&&!Y?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pe=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),ce],re=o.layout.get("fill-extrusion-edge-radius"),ve=re>0&&!o.paint.get("fill-extrusion-rounded-roof"),Le=ve?0:re,Ce="globe"===R.projection.name?s.cF():0,ze="globe"===R.projection.name,ge=ze?s.S(R.zoom):0,Ie=[s.a5(R.center.lng),s.ae(R.center.lat)],Qe=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),nt=o.paint.get("fill-extrusion-flood-light-intensity"),dt=o.paint.get("fill-extrusion-vertical-scale"),$t=ft(h,o.paint.get("fill-extrusion-cutoff-fade-range")),Ct=o.paint.get("fill-extrusion-emissive-strength"),en=[];let Jt;ze&&en.push("PROJECTION_GLOBE_VIEW"),pe[0]>0&&en.push("FAUX_AO"),ve&&en.push("ZERO_ROOF_RADIUS"),S&&en.push("HAS_CENTROID"),nt>0&&en.push("FLOOD_LIGHT"),$t.shouldRenderCutoff&&en.push("RENDER_CUTOFF");const xn="shadow"===h.renderPass,Lt=h.shadowRenderer,Zt=xn&&!!Lt;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let ut=[0,0,0];if(Lt){const Un=h.style.directionalLight,kn=h.style.ambientLight;Un&&kn&&(ut=Da(Un,kn)),Jt=en.concat(["SHADOWS_SINGLE_CASCADE"])}const Nt=Zt?"fillExtrusionDepth":Y?"fillExtrusionPattern":"fillExtrusion",Cn=o.getLayerRenderingStats();for(const Un of d){const kn=i.getTile(Un),Yn=kn.getBucket(o);if(!Yn||Yn.projection.name!==R.projection.name)continue;let di=!1;Lt&&(di=0===Lt.getMaxCascadeForTile(Un.toUnwrapped()));const Ai=h.isTileAffectedByFog(Un),xi=Yn.programConfigurations.get(o.id),bi=h.getOrCreateProgram(Nt,{config:xi,defines:di?Jt:en,overrideFog:Ai});if(h.terrain&&h.terrain.setupElevationDraw(kn,bi,{useMeterToDem:!0}),!Yn.centroidVertexBuffer){const Is=bi.attributes.a_centroid_pos;void 0!==Is&&H.vertexAttrib2f(Is,0,0)}!xn&&Lt&&Lt.setupShadows(kn.tileID.toUnwrapped(),bi,"vector-tile",kn.tileID.overscaledZ),Y&&(h.context.activeTexture.set(H.TEXTURE0),kn.imageAtlasTexture&&kn.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),xi.updatePaintBuffers());const ur=B.constantOr(null);if(ur&&kn.imageAtlas){const Is=kn.imageAtlas.patternPositions[ur.toString()];Is&&xi.setConstantPatternPositions(Is)}const ar=o.paint.get("fill-extrusion-vertical-gradient");let yr;if(xn&&Lt){if(Ao(kn.tileID,Yn,h))continue;const Is=Lt.calculateShadowPassMatrixFromTile(kn.tileID.toUnwrapped());yr=Ca(Is,Le,dt)}else{const Is=h.translatePosMatrix(Un.expandedProjMatrix,kn,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),xr=R.projection.createInversionMatrix(R,Un.canonical);yr=Y?H1(Is,h,ar,Q,pe,Le,Un,kn,Ce,ge,Ie,xr,Qe,dt):yc(Is,h,ar,Q,pe,Le,Un,Ce,ge,Ie,xr,Qe,dt,nt,ut,Ct)}h.uploadCommonUniforms(z,bi,Un.toUnwrapped(),null,$t);let mr=Yn.segments;if("mercator"===R.projection.name&&!xn&&(mr=Yn.getVisibleSegments(kn.tileID,h.terrain,h.transform.getFrustum(0)),!mr.get().length))continue;if(Cn)if(xn)for(const Is of mr.get())Cn.numRenderedVerticesInShadowPass+=Is.primitiveLength;else for(const Is of mr.get())Cn.numRenderedVerticesInTransparentPass+=Is.primitiveLength;const Yr=[];(h.terrain||S)&&Yr.push(Yn.centroidVertexBuffer),ze&&Yr.push(Yn.layoutVertexExtBuffer),bi.draw(h,z.gl.TRIANGLES,m,v,b,Qn.backCCW,yr,o.id,Yn.layoutVertexBuffer,Yn.indexBuffer,mr,o.paint,h.transform.zoom,xi,Yr)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function o2(h,i,o,d,m,v,b,S,z,H,R,B,Y,Q,le,ce,pe,re,ve){const Le=h.context,Ce=Le.gl,ze=h.transform,ge=h.transform.zoom,Ie=[],Qe=ft(h,o.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===H?(Ie.push("CLEAR_SUBPASS"),ve&&(Ie.push("CLEAR_FROM_TEXTURE"),Le.activeTexture.set(Ce.TEXTURE0),ve.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE))):"sdf"===H&&Ie.push("SDF_SUBPASS"),pe&&Ie.push("HAS_CENTROID"),Qe.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");const nt=o.layout.get("fill-extrusion-edge-radius"),dt=($t,Ct,en,Jt,xn)=>{const Lt=Ct.programConfigurations.get(o.id),Zt=h.isTileAffectedByFog($t),ut=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:Lt,defines:Ie,overrideFog:Zt}),Nt={u_matrix:Jt,u_opacity:R,u_ao_pass:z?1:0,u_meter_to_tile:xn,u_ao:[B,Y*xn],u_flood_light_intensity:Q,u_flood_light_color:le,u_attenuation:ce,u_edge_radius:ge>=17?0:nt*xn,u_fb:0,u_fb_size:ve?ve.size[0]:0},Cn=[];pe&&Cn.push(Ct.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(Le,ut,$t.toUnwrapped(),null,Qe),ut.draw(h,Le.gl.TRIANGLES,m,v,b,S,Nt,o.id,Ct.vertexBuffer,Ct.indexBuffer,en,o.paint,ge,Lt,Cn)};for(const $t of d){const Ct=i.getTile($t),en=Ct.getBucket(o);if(!en||en.projection.name!==ze.projection.name||!en.groundEffect||en.groundEffect&&!en.groundEffect.hasData())continue;const Jt=en.groundEffect,xn=1/en.tileToMeter;{const Lt=h.translatePosMatrix($t.projMatrix,Ct,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Zt=Jt.getDefaultSegment();dt($t,Jt,Zt,Lt,xn)}if(re)for(let Lt=0;Lt<4;Lt++){const Zt=s.cG[Lt]($t),ut=i.getTile(Zt);if(!ut)continue;const Nt=ut.getBucket(o);if(!Nt||Nt.projection.name!==ze.projection.name||!Nt.groundEffect||Nt.groundEffect&&!Nt.groundEffect.hasData())continue;const Cn=Nt.groundEffect;let Un,kn;0===Lt?(Un=[-s.V,0,0],kn=1):1===Lt?(Un=[s.V,0,0],kn=0):2===Lt?(Un=[0,-s.V,0],kn=3):(Un=[0,s.V,0],kn=2);const Yn=Cn.regionSegments[kn];if(!Yn)continue;const di=new Float32Array(16);s.a6.translate(di,$t.projMatrix,Un),dt($t,Cn,Yn,h.translatePosMatrix(di,Ct,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),xn)}}}function Ni(h,i,o,d,m,v,b){0===d.centroidVertexArray.length&&d.createCentroidsBuffer();const S=v?v.findDEMTileFor(o):null;if(!(S&&S.dem||b))return;const z=re=>new s.P(Math.ceil((re+s.cJ)*s.cK),0),H=re=>{const ve=i.getSource().minzoom,Le=ze=>{const ge=i.getTileByID(ze);if(ge&&ge.hasData())return ge.getBucket(m)},Ce=[0,-1,1];for(const ze of Ce){if(re.overscaledZ+ze<ve)continue;const ge=Le(re.calculateScaledKey(re.overscaledZ+ze));if(ge)return ge}},R=[0,0,0],B=(re,ve)=>(R[0]=Math.min(re.min.y,ve.min.y),R[1]=Math.max(re.max.y,ve.max.y),R[2]=s.V-ve.min.x>re.max.x?ve.min.x-s.V:re.max.x,R),Y=(re,ve)=>(R[0]=Math.min(re.min.x,ve.min.x),R[1]=Math.max(re.max.x,ve.max.x),R[2]=s.V-ve.min.y>re.max.y?ve.min.y-s.V:re.max.y,R),Q=[(re,ve)=>B(re,ve),(re,ve)=>B(ve,re),(re,ve)=>Y(re,ve),(re,ve)=>Y(ve,re)],le=(re,ve,Le,Ce,ze,ge,Ie)=>{if(!v)return 0;const Qe=[[ge?Le:re,ge?re:Le,0],[ge?Le:ve,ge?ve:Le,0]],nt=Ie<0?s.V+Ie:Ie,dt=[ge?nt:(re+ve)/2,ge?(re+ve)/2:nt,0];return 0===Le&&Ie<0||0!==Le&&Ie>0?v.getForTilePoints(ze,[dt],!0,Ce):Qe.push(dt),v.getForTilePoints(o,Qe,!0,S),Math.max(Qe[0][2],Qe[1][2],dt[2])/v.exaggeration()};for(let re=0;re<4;re++){const ve=d.borderFeatureIndices[re];if(0===ve.length)continue;const Le=s.cG[re](o),Ce=H(Le);if(!(Ce&&Ce instanceof s.cH)||d.borderDoneWithNeighborZ[re]===Ce.canonical.z)continue;0===Ce.centroidVertexArray.length&&Ce.createCentroidsBuffer();const ze=v?v.findDEMTileFor(Le):null;if(!(ze&&ze.dem||b))continue;const ge=(re<2?1:5)-re,Ie=Ce.borderDoneWithNeighborZ[ge]!==d.canonical.z,Qe=Ce.borderFeatureIndices[ge];let nt=0;if(d.canonical.z!==Ce.canonical.z){for(const dt of ve)d.showCentroid(d.featuresOnBorder[dt]);if(Ie)for(const dt of Qe)Ce.showCentroid(Ce.featuresOnBorder[dt]);d.borderDoneWithNeighborZ[re]=Ce.canonical.z,Ce.borderDoneWithNeighborZ[ge]=d.canonical.z}for(const dt of ve){const $t=d.featuresOnBorder[dt],Ct=d.centroidData[$t.centroidDataIndex],en=$t.borders[re];let Jt;for(;nt<Qe.length;){Jt=Ce.featuresOnBorder[Qe[nt]];const xn=Jt.borders[ge];if(xn[1]>en[0]+3||xn[0]>en[0]-3)break;Ce.showCentroid(Jt),nt++}if(Jt&&nt<Qe.length){const xn=nt;let Lt=0;for(;!(Jt.borders[ge][0]>en[1]-3)&&(Lt++,++nt!==Qe.length);)Jt=Ce.featuresOnBorder[Qe[nt]];if(Jt=Ce.featuresOnBorder[Qe[xn]],Lt>1){const Nt=Jt.borders[ge];Math.abs(en[0]-Nt[0])<3&&Math.abs(en[1]-Nt[1])<3&&(Lt=1,nt=xn+1)}else if(0===Lt){d.showCentroid($t);continue}const Zt=Ce.centroidData[Jt.centroidDataIndex];b&&1===Lt&&(((ce=Ct).flags|(pe=Zt).flags)&s.cI?(ce.flags|=s.cI,pe.flags|=s.cI):(ce.flags&=~s.cI,pe.flags&=~s.cI));const ut=$t.intersectsCount()>1||Jt.intersectsCount()>1;if(Lt>1)nt=xn,Ct.centroidXY=Zt.centroidXY=new s.P(0,0);else if(ze&&ze.dem&&!ut){const Nt=Q[re](Ct,Zt),Cn=re%2?s.V-1:0,Un=le(Nt[0],Math.min(s.V-1,Nt[1]),Cn,ze,Le,re<2,Nt[2]);Ct.centroidXY=Zt.centroidXY=z(Un)}else ut?Ct.centroidXY=Zt.centroidXY=new s.P(0,0):(Ct.centroidXY=d.encodeBorderCentroid($t),Zt.centroidXY=Ce.encodeBorderCentroid(Jt));d.writeCentroidToBuffer(Ct),Ce.writeCentroidToBuffer(Zt)}else d.showCentroid($t)}d.borderDoneWithNeighborZ[re]=Ce.canonical.z,Ce.borderDoneWithNeighborZ[ge]=d.canonical.z}var ce,pe;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&0!==d.centroidVertexArray.length)&&d.uploadCentroid(h)}const lr=[1,0,0],wr=[0,1,0],us=[0,0,1];function Ao(h,i,o){const d=o.transform,m=o.shadowRenderer;if(!m)return!0;const v=h.toUnwrapped(),b=d.tileSize*m._cascades[o.currentShadowCascade].scale;let S=i.maxHeight;if(d.elevation){const ce=d.elevation.getMinMaxForTile(h);ce&&(S+=ce.max)}const z=[...m.shadowDirection];z[2]=-z[2];const H=m.computeSimplifiedTileShadowVolume(v,S,b,z);if(!H)return!1;const R=[lr,wr,us,z,[z[0],0,z[2]],[0,z[1],z[2]]],B="globe"===d.projection.name,Y=d.scaleZoom(b),Q=s.bq.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,Y,!B),le=m.getCurrentCascadeFrustum();return 0===Q.intersectsPrecise(H.vertices,H.planes,R)||0===le.intersectsPrecise(H.vertices,H.planes,R)}function L1(h){return[h[0]*s.cL,h[1]*s.cL,h[2]*s.cL,0]}function f1(h,i,o,d,m,v,b,S,z){const H=d.getSource(),R=o.globeSharedBuffers;if(!R)return;let B,Y,Q;if(i&&(B=d.getTile(i)),H instanceof s.ap?(Y=H.texture,Q=s.cj(0,0,o.transform)):B&&i&&(Y=B.texture,Q=s.cj(i.canonical.z,i.canonical.x,o.transform)),!Y||!Q)return;h||(Q=s.a6.scale(s.a6.create(),Q,[1,-1,1]));const le=o.context,ce=le.gl,pe="nearest"===m.paint.get("raster-resampling")?ce.NEAREST:ce.LINEAR,re=o.colorModeForDrapableLayerRenderPass(v),ve=b.defines;ve.push("GLOBE_POLES");const Le=new ci(ce.LEQUAL,ci.ReadWrite,o.depthRangeFor3D),Ce=Float32Array.from(o.transform.expandedFarZProjMatrix),ze=Float32Array.from(s.aT(s.ci(new s.bs(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),le.activeTexture.set(ce.TEXTURE0),Y.bind(pe,ce.CLAMP_TO_EDGE),le.activeTexture.set(ce.TEXTURE1),Y.bind(pe,ce.CLAMP_TO_EDGE),Y.useMipmap&&le.extTextureFilterAnisotropic&&o.transform.pitch>20&&ce.texParameterf(ce.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[ge,Ie,Qe,nt]=i?R.getPoleBuffers(i.canonical.z,!1):R.getPoleBuffers(0,!0),dt=m.paint.get("raster-elevation");let $t;h?($t=ge,o.renderDefaultNorthPole=0!==dt):($t=Ie,o.renderDefaultSouthPole=0!==dt);const Ct=L1(b.mix),en=(xn=Ce,Lt=ze,Zt=Q,ut=s.S(o.transform.zoom),Cn=m,kn=dt,di=Ct,Ai=b.offset,xi=b.range,bi=v,bt(xn,Lt,Zt,new Float32Array(16),new Float32Array(9),[0,0],ut,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Cn,[0,0],kn,2,di,Ai,xi,1,0,bi)),Jt=o.getOrCreateProgram("raster",{defines:ve});var xn,Lt,Zt,ut,Cn,kn,di,Ai,xi,bi;o.uploadCommonUniforms(le,Jt,null),Jt.draw(o,ce.TRIANGLES,Le,z,re,S,en,m.id,$t,Qe,nt)}function W1(h){const i=h._nearZ,o=h.projection.farthestPixelDistance(h),d=o-i,m=.2*h.height,v=i+m;return[i,o,(v-m-i)/d,(v-i)/d]}function k(h,i,o,d){if(h)return i instanceof ke&&h instanceof yo?i.getTextureDescriptor(h,o,!0):{texture:h.texture,mix:L1(d.mix),offset:d.offset,buffer:0,tileSize:1}}function F(h,i,o){if(!h)return null;const d=i.getTextureDescriptor(h,o,!0);if(!d)return null;let{texture:m,mix:v,offset:b,tileSize:S,buffer:z,format:H}=d;if(!m||!H)return null;let R=!1;return"uint32"===H&&(R=!0,v[3]=0,v=he(s.cM,v,[0,o.paint.get("raster-particle-max-speed")]),b=Fe(s.cM,b,[0,o.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[z/(S+2*z),S/(S+2*z)],tileSize:S,scalarData:R,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[H]]}}function V(h){const i=h._nearZ,o=h.projection.farthestPixelDistance(h),d=o-i,m=.2*h.height,v=i+m;return[i,o,(v-m-i)/d,(v-i)/d]}const $=new s.ax(1,0,0,1),oe=new s.ax(0,1,0,1),xe=new s.ax(0,0,1,1),Oe=new s.ax(1,0,1,1),Ut=new s.ax(0,1,1,1);function zn(h,i,o,d,m,v,b){const S=h.context,z=h.transform,H=S.gl,R="globe"===z.projection.name,B=R?["PROJECTION_GLOBE_VIEW"]:[];let Y=s.a6.clone(o.projMatrix);if(R&&s.S(z.zoom)>0){const Ct=s.aS(o.canonical,z),en=s.cN(Ct);Y=s.a6.multiply(new Float32Array(16),z.globeMatrix,en),s.a6.multiply(Y,z.projMatrix,Y)}const Q=s.a6.create();Q[12]+=2*m/(s.f.devicePixelRatio*z.width),Q[13]+=2*v/(s.f.devicePixelRatio*z.height),s.a6.multiply(Y,Q,Y);const le=h.getOrCreateProgram("debug",{defines:B}),ce=i.getTileByID(o.key);h.terrain&&h.terrain.setupElevationDraw(ce,le);const pe=ci.disabled,re=Ci.disabled,ve=h.colorModeForRenderPass();S.activeTexture.set(H.TEXTURE0),h.emptyTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),R?ce._makeGlobeTileDebugBuffers(h.context,z):ce._makeDebugTileBoundsBuffers(h.context,z.projection);const Ce=ce._tileDebugBuffer||h.debugBuffer,ze=ce._tileDebugIndexBuffer||h.debugIndexBuffer,ge=ce._tileDebugSegments||h.debugSegments;if(le.draw(h,H.LINE_STRIP,pe,re,ve,Qn.disabled,P(Y,d),"$debug",Ce,ze,ge,null,null,null,[ce._globeTileDebugBorderBuffer]),b){const Ct=ce.latestRawTileData,en=Math.floor((Ct&&Ct.byteLength||0)/1024);let Jt=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Jt+=` => ${o.overscaledZ}`),Jt+=` ${ce.state}`,Jt+=` ${en}kb`,function(xn,Lt){xn.initDebugOverlayCanvas();const Zt=xn.debugOverlayCanvas,ut=xn.context.gl,Nt=xn.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,Zt.width,Zt.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(Lt,5,5),Nt.strokeText(Lt,5,5),xn.debugOverlayTexture.update(Zt),xn.debugOverlayTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE)}(h,Jt)}const Ie=i.getTile(o).tileSize,Qe=512/Math.min(Ie,512)*(o.overscaledZ/z.zoom)*.5,nt=ce._tileDebugTextBuffer||h.debugBuffer,dt=ce._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,$t=ce._tileDebugTextSegments||h.debugSegments;le.draw(h,H.TRIANGLES,pe,re,Bi.alphaBlended,Qn.disabled,P(Y,s.ax.transparent,Qe),"$debug",nt,dt,$t,null,null,null,[ce._globeTileDebugTextBuffer])}function Li(h,i,o,d){or(h,0,i+o/2,h.transform.width,o,d)}function _i(h,i,o,d){or(h,i-o/2,0,o,h.transform.height,d)}function or(h,i,o,d,m,v){const b=h.context,S=b.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*s.f.devicePixelRatio,o*s.f.devicePixelRatio,d*s.f.devicePixelRatio,m*s.f.devicePixelRatio),b.clear({color:v}),S.disable(S.SCISSOR_TEST)}const Go=s.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:d1}=Go;function Ma(h,i,o,d){h.emplaceBack(i,o,d)}class N1{constructor(i){this.vertexArray=new s.az,this.indices=new s.aw,Ma(this.vertexArray,-1,-1,1),Ma(this.vertexArray,1,-1,1),Ma(this.vertexArray,-1,1,1),Ma(this.vertexArray,1,1,1),Ma(this.vertexArray,-1,-1,-1),Ma(this.vertexArray,1,-1,-1),Ma(this.vertexArray,-1,1,-1),Ma(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,d1),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=s.aB.simpleSegment(0,0,36,12)}}function Ha(h,i,o,d,m,v){const b=h.context.gl,S=i.paint.get("sky-atmosphere-color"),z=i.paint.get("sky-atmosphere-halo-color"),H=i.paint.get("sky-atmosphere-sun-intensity"),R={u_matrix_3f:s.co.fromMat4(s.co.create(),d),u_sun_direction:m,u_sun_intensity:H,u_color_tint_r:[(le=S).r,le.g,le.b,le.a],u_color_tint_m:[(ce=z).r,ce.g,ce.b,ce.a],u_luminance:5e-5};var le,ce;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),o.draw(h,b.TRIANGLES,ci.disabled,Ci.disabled,Bi.unblended,Qn.frontCW,R,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const tl=s.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class N2{constructor(i){const o=new s.cO;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const d=new s.aw;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,tl.members),this.indexBuffer=i.createIndexBuffer(d),this.segments=s.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ec=s.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class On{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class zi{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Bi([1,771,1,771],s.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Bi([1,0,1,0],s.ax.transparent,[!1,!1,!1,!0]),this.params=new On,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const o=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new N2(o);const d=this.params.sizeRange,m=this.params.intensityRange,v=function(R){const B=s.aA(30),Y=[];for(let Q=0;Q<R;++Q){const le=2*Math.PI*B(),ce=Math.acos(1-2*B())-.5*Math.PI;Y.push(s.N.fromValues(Math.cos(ce)*Math.cos(le),Math.cos(ce)*Math.sin(le),Math.sin(ce)))}return Y}(this.params.starsCount),b=s.aA(300),S=new s.cP,z=new s.aw;let H=0;for(let R=0;R<v.length;++R){const B=s.N.scale([],v[R],200),Y=Math.max(0,1+.01*d*(1*b()-.5)),Q=Math.max(0,1+.01*m*(1*b()-.5));S.emplaceBack(B[0],B[1],B[2],-1,-1,Y,Q),S.emplaceBack(B[0],B[1],B[2],1,-1,Y,Q),S.emplaceBack(B[0],B[1],B[2],1,1,Y,Q),S.emplaceBack(B[0],B[1],B[2],-1,1,Y,Q),z.emplaceBack(H+0,H+1,H+2),z.emplaceBack(H+0,H+2,H+3),H+=4}this.starsVx=o.createVertexBuffer(S,ec.members),this.starsIdx=o.createIndexBuffer(z),this.starsSegments=s.aB.simpleSegment(0,0,S.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,o){const d=i.context,m=d.gl,v=i.transform,b=new ci(m.LEQUAL,ci.ReadOnly,[0,1]),S=s.S(v.zoom),z=o.properties.get("color").toArray01(),H=o.properties.get("high-color").toArray01(),R=o.properties.get("space-color").toArray01PremultipliedAlpha(),B=5e-4,Y=s.cQ(o.properties.get("horizon-blend"),0,1,B,.25),Q=s.cd(i,d,v)&&Y===B?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,le=i.frameCounter/1e3%1,ce=s.N.length(v.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(ce,2)-Math.pow(Q,2)),re=Math.acos(pe/ce),ve=Le=>{const Ce="globe"===v.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Le&&Ce.push("ALPHA_PASS");const ze=i.getOrCreateProgram("globeAtmosphere",{defines:Ce}),ge={u_frustum_tl:v.frustumCorners.TL,u_frustum_tr:v.frustumCorners.TR,u_frustum_br:v.frustumCorners.BR,u_frustum_bl:v.frustumCorners.BL,u_horizon:v.frustumCorners.horizon,u_transition:S,u_fadeout_range:Y,u_color:z,u_high_color:H,u_space_color:R,u_temporal_offset:le,u_horizon_angle:re};i.uploadCommonUniforms(d,ze);const Ie=this.atmosphereBuffer;Ie&&ze.draw(i,m.TRIANGLES,b,Ci.disabled,Le?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Qn.backCW,ge,Le?"atmosphere_glow_alpha":"atmosphere_glow",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)};ve(!1),ve(!0)}drawStars(i,o){const d=s.aa(o.properties.get("star-intensity"),0,1);if(0===d)return;const m=i.context,v=m.gl,b=i.transform,S=i.getOrCreateProgram("stars"),z=s.bi.identity([]);s.bi.rotateX(z,z,-b._pitch),s.bi.rotateZ(z,z,-b.angle),s.bi.rotateX(z,z,s.bj(b._center.lat)),s.bi.rotateY(z,z,-s.bj(b._center.lng));const H=s.a6.fromQuat(new Float32Array(16),z),R=s.a6.multiply([],b.starsProjMatrix,H),B=s.co.fromMat4([],H),Y=s.co.invert([],B),Q=[0,1,0];s.N.transformMat3(Q,Q,Y),s.N.scale(Q,Q,this.params.sizeMultiplier);const le=[1,0,0];s.N.transformMat3(le,le,Y),s.N.scale(le,le,this.params.sizeMultiplier);const ce=(pe=Q,re=le,ve=d,{u_matrix:Float32Array.from(R),u_up:pe,u_right:re,u_intensity_multiplier:ve});var pe,re,ve;i.uploadCommonUniforms(m,S),this.starsVx&&this.starsIdx&&S.draw(i,v.TRIANGLES,ci.disabled,Ci.disabled,this.colorModeAlphaBlendedWriteRGB,Qn.disabled,ce,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function xc(h,i){const o=[...h],d=i.cameraWorldSizeForFog/i.worldSize,m=s.a6.identity([]);return s.a6.scale(m,m,[d,d,1]),s.a6.multiply(o,m,o),s.a6.multiply(o,i.worldToFogMatrix,o),o}function Co(h,i,o,d){const m=o.material,v=d.context,{baseColorTexture:b,metallicRoughnessTexture:S}=m.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:H,emissionTexture:R}=m;function B(Y,Q,le){if(Y&&(h.push(Q),v.activeTexture.set(v.gl.TEXTURE0+le),Y.gfxTexture)){const{minFilter:ce,magFilter:pe,wrapS:re,wrapT:ve}=Y.sampler;Y.gfxTexture.bindExtraParam(ce,pe,re,ve)}}B(b,"HAS_TEXTURE_u_baseColorTexture",vt.BaseColor),B(S,"HAS_TEXTURE_u_metallicRoughnessTexture",vt.MetallicRoughness),B(z,"HAS_TEXTURE_u_normalTexture",vt.Normal),B(H,"HAS_TEXTURE_u_occlusionTexture",vt.Occlusion),B(R,"HAS_TEXTURE_u_emissionTexture",vt.Emission),o.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(o.texcoordBuffer)),o.colorBuffer&&(h.push(12===o.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(o.colorBuffer)),o.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(o.normalBuffer)),o.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(o.pbrBuffer)),"OPAQUE"!==m.alphaMode&&"MASK"!==m.alphaMode||h.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES")}function Il(h,i,o,d,m,v){const b=o.paint.get("model-opacity"),S=i.context,z=new ci(i.context.gl.LEQUAL,ci.ReadWrite,i.depthRangeFor3D),H=i.transform,R=h.mesh,B=R.material,Y=B.pbrMetallicRoughness,Q=i.style.fog;let le;le="pixels"===i.transform.projection.zAxisUnit?[...h.nodeModelMatrix]:s.a6.multiply([],d.zScaleMatrix,h.nodeModelMatrix),s.a6.multiply(le,d.negCameraPosMatrix,le);const ce=s.a6.invert([],le);s.a6.transpose(ce,ce);const pe=o.paint.get("model-emissive-strength").constantOr(0),re=vr(new Float32Array(h.worldViewProjection),new Float32Array(le),new Float32Array(ce),i,b,Y.baseColorFactor,B.emissiveFactor,Y.metallicFactor,Y.roughnessFactor,B,pe,o),ve={defines:[]},Le=[];Co(ve.defines,Le,R,i);const Ce=i.shadowRenderer;Ce&&(Ce.useNormalOffset=!1);let ze=null;if(Q){const Qe=xc(h.nodeModelMatrix,i.transform);if(ze=new Float32Array(Qe),"globe"!==H.projection.name){const nt=R.aabb.min,dt=R.aabb.max,[$t,Ct]=Q.getOpacityForBounds(Qe,nt[0],nt[1],dt[0],dt[1]);ve.overrideFog=$t>=hr||Ct>=hr}}const ge=ft(i,o.paint.get("model-cutoff-fade-range"));ge.shouldRenderCutoff&&ve.defines.push("RENDER_CUTOFF");const Ie=i.getOrCreateProgram("model",ve);i.uploadCommonUniforms(S,Ie,null,ze,ge),"shadow"!==i.renderPass&&Ce&&Ce.setupShadowsFromMatrix(h.nodeModelMatrix,Ie),Ie.draw(i,S.gl.TRIANGLES,z,m,v,R.material.doubleSided?Qn.disabled:Qn.backCCW,re,o.id,R.vertexBuffer,R.indexBuffer,R.segments,o.paint,i.transform.zoom,void 0,Le)}function k2(h,i,o,d,m,v,b){let S;S="globe"===h.projection.name?s.cS(o,h):[...o],s.a6.multiply(S,S,i.matrix);const z=s.a6.multiply([],d,S);if(i.meshes)for(const H of i.meshes){if("BLEND"!==H.material.alphaMode){b.push({mesh:H,depth:0,modelIndex:m,worldViewProjection:z,nodeModelMatrix:S});continue}const R=s.N.transformMat4([],H.centroid,z);R[2]>0&&v.push({mesh:H,depth:R[2],modelIndex:m,worldViewProjection:z,nodeModelMatrix:S})}if(i.children)for(const H of i.children)k2(h,H,o,d,m,v,b)}function Rt(h,i,o,d){const m=o.shadowRenderer;if(!m)return;const v=m.getShadowPassDepthMode(),b=m.getShadowPassColorMode(),S=m.calculateShadowPassMatrixFromMatrix(i),z=da(S);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,v,Ci.disabled,b,Qn.backCCW,z,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,o.transform.zoom,void 0,void 0)}function L4(h,i,o){const d=i.updateZoomBasedPaintProperties(),m=function(v,b,S){let z,H,R,B=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&B>0){const Y=v.terrain,Q=Y.findDEMTileFor(S);Q&&Q.dem?z=s.cU.create(Y,S,Q):B=0}if(0===B&&(b.terrainElevationMin=0,b.terrainElevationMax=0),B===b.validForExaggeration&&(0===B||z&&z._demTile&&z._demTile.tileID===b.validForDEMTile.id&&z._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const Y in b.instancesPerModel){const Q=b.instancesPerModel[Y];for(let le=0;le<Q.instancedDataArray.length;++le){const ce=(z?B*z.getElevationAt(0|Q.instancedDataArray.float32[16*le],0|Q.instancedDataArray.float32[16*le+1],!0,!0):0)+Q.instancesEvaluatedElevation[le];Q.instancedDataArray.float32[16*le+6]=ce,H=H?Math.min(b.terrainElevationMin,ce):ce,R=R?Math.max(b.terrainElevationMax,ce):ce}}return b.terrainElevationMin=H||0,b.terrainElevationMax=R||0,b.validForExaggeration=B,b.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,i,o);(d||m)&&(i.uploaded=!1,i.upload(h.context))}const u2={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.bS([0,0,0],[s.V,s.V,0])};function D4(h,i){const o=1<<h.canonical.z,d=i.getFreeCameraOptions().position,m=i.elevation,v=h.canonical.x/o,b=(h.canonical.x+1)/o,S=h.canonical.y/o,z=(h.canonical.y+1)/o;let H=i._centerAltitude;if(m){const Q=m.getMinMaxForTile(h);Q&&Q.max>H&&(H=Q.max)}const R=s.aa(d.x,v,b)-d.x,B=s.aa(d.y,S,z)-d.y,Y=s.bl(H,i.center.lat)-d.z;return i._zoomFromMercatorZ(Math.sqrt(R*R+B*B+Y*Y))}function I4(h,i,o,d,m,v,b){const S=h.context,z="shadow"===h.renderPass,H=h.shadowRenderer,R=z&&H?H.getShadowPassDepthMode():new ci(S.gl.LEQUAL,ci.ReadWrite,h.depthRangeFor3D),B=h.isTileAffectedByFog(v);if(o.meshes)for(const Y of o.meshes){const Q=["MODEL_POSITION_ON_GPU"],le=[];let ce,pe,re;d.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const ve=ft(h,i.paint.get("model-cutoff-fade-range"));if(ve.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),z&&H)ce=h.getOrCreateProgram("modelDepth",{defines:Q}),pe=da(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(o.matrix)),re=H.getShadowPassColorMode();else{Co(Q,le,Y,h),ce=h.getOrCreateProgram("model",{defines:Q,overrideFog:B});const Ce=Y.material,ze=Ce.pbrMetallicRoughness,ge=i.paint.get("model-opacity"),Ie=i.paint.get("model-emissive-strength").constantOr(0);pe=vr(v.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),h,ge,ze.baseColorFactor,Ce.emissiveFactor,ze.metallicFactor,ze.roughnessFactor,Ce,Ie,i,m),H&&(b.shadowUniformsInitialized?ce.setShadowUniformValues(S,H.getShadowUniformValues()):(H.setupShadows(v.toUnwrapped(),ce,"model-tile",v.overscaledZ),b.shadowUniformsInitialized=!0)),re=ve.shouldRenderCutoff||ge<1||"OPAQUE"!==Ce.alphaMode?Bi.alphaBlended:Bi.unblended}h.uploadCommonUniforms(S,ce,v.toUnwrapped(),null,ve);const Le=Y.material.doubleSided?Qn.disabled:Qn.backCCW;if(d.instancedDataArray.length>20)le.push(d.instancedDataBuffer),ce.draw(h,S.gl.TRIANGLES,R,Ci.disabled,re,Le,pe,i.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,i.paint,h.transform.zoom,void 0,le,d.instancedDataArray.length);else{const Ce=z?"u_instance":"u_normal_matrix";for(let ze=0;ze<d.instancedDataArray.length;++ze)pe[Ce]=new Float32Array(d.instancedDataArray.arrayBuffer,64*ze,16),ce.draw(h,S.gl.TRIANGLES,R,Ci.disabled,re,Le,pe,i.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,i.paint,h.transform.zoom,void 0,le)}}if(o.children)for(const Y of o.children)I4(h,i,Y,d,m,v,b)}const Vl=[1,-1,1];function N6(h,i,o,d){if(!o.modelManager)return!0;const m=o.modelManager;if(!o.shadowRenderer)return!0;const v=o.shadowRenderer,b=i.aabb;let S=!0,z=h.maxHeight;if(0===z){let R=0;for(const B in h.instancesPerModel){const Y=m.getModel(B,d);Y?R=Math.max(R,Math.max(Math.max(Y.aabb.max[0],Y.aabb.max[1]),Y.aabb.max[2])):S=!1}z=h.maxScale*R*1.41+h.maxVerticalOffset,S&&(h.maxHeight=z)}b.max[2]=z,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,s.N.transformMat4(b.min,b.min,i.tileMatrix),s.N.transformMat4(b.max,b.max,i.tileMatrix);const H=b.intersects(v.getCurrentCascadeFrustum());return 0===o.currentShadowCascade&&(h.isInsideFirstShadowMapFrustum=2===H),0===H}class fu{}class du{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,o,d){{const B=this._storage.get(o.id);if(B)return B.lastUsedFrameIdx=i,B.buf}const m=d.gl,v=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),b=new ArrayBuffer(v),S=new Int16Array(b);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const z=new s.cW;for(let B=0;B<v/2;B+=3){const Y=S[B],Q=S[B+1],le=S[B+2];z.emplaceBack(Y,Q),z.emplaceBack(Q,le),z.emplaceBack(le,Y)}const H=d.bindVertexArrayOES.current,R=new fu;return R.buf=new Dn(d,z),R.lastUsedFrameIdx=i,this._storage.set(o.id,R),d.bindVertexArrayOES.set(H),R.buf}update(i){for(const[o,d]of this._storage)i-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(o))}destroy(){for(const[i,o]of this._storage)o.buf.destroy(),this._storage.delete(i)}}class tc{registerParameter(i,o,d,m,v){}registerButton(i,o,d){}}const nl={symbol:function(h,i,o,d,m){if("translucent"!==h.renderPass)return;const v=Ci.disabled,b=h.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(H,R,B,Y,Q,le,ce){const pe=R.transform,re="map"===Q,ve="map"===le;for(const Le of H){const Ce=Y.getTile(Le),ze=Ce.getBucket(B);if(!ze||!ze.text||!ze.text.segments.get().length)continue;const ge=s.b5(ze.textSizeData,pe.zoom),Ie=lo(Le,ze.getProjection(),pe),Qe=pe.calculatePixelsToTileUnitsMatrix(Ce),nt=xo(Ie,Ce.tileID.canonical,ve,re,pe,ze.getProjection(),Qe),dt=ze.hasIconTextFit()&&ze.hasIconData();if(ge){const $t=Math.pow(2,pe.zoom-Ce.tileID.overscaledZ);C1(ze,re,ve,ce,s.cx,pe,nt,Le,$t,ge,dt)}}}(d,h,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),m);const S=0!==o.paint.get("icon-opacity").constantOr(1),z=0!==o.paint.get("text-opacity").constantOr(1);void 0!==o.layout.get("symbol-sort-key").constantOr(1)&&(S||z)?Nc(h,i,o,d,v,b):(S&&Nc(h,i,o,d,v,b,{onlyIcons:!0}),z&&Nc(h,i,o,d,v,b,{onlyText:!0})),i.map.showCollisionBoxes&&(ia(h,i,o,d,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),ia(h,i,o,d,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(h,i,o,d){if("translucent"!==h.renderPass)return;const m=o.paint.get("circle-opacity"),v=o.paint.get("circle-stroke-width"),b=o.paint.get("circle-stroke-opacity"),S=void 0!==o.layout.get("circle-sort-key").constantOr(1),z=o.paint.get("circle-emissive-strength");if(0===m.constantOr(1)&&(0===v.constantOr(1)||0===b.constantOr(1)))return;const H=h.context,R=H.gl,B=h.transform,Y=h.depthModeForSublayer(0,ci.ReadOnly),Q=Ci.disabled,le=h.colorModeForDrapableLayerRenderPass(z),ce="globe"===B.projection.name,pe=[s.a5(B.center.lng),s.ae(B.center.lat)],re=[];for(let Le=0;Le<d.length;Le++){const Ce=d[Le],ze=i.getTile(Ce),ge=ze.getBucket(o);if(!ge||ge.projection.name!==B.projection.name)continue;const Ie=ge.programConfigurations.get(o.id),Qe=s.cy(o),nt=h.isTileAffectedByFog(Ce);ce&&Qe.push("PROJECTION_GLOBE_VIEW");const dt=h.getOrCreateProgram("circle",{config:Ie,defines:Qe,overrideFog:nt}),$t=ge.layoutVertexBuffer,Ct=ge.globeExtVertexBuffer,en=ge.indexBuffer,Jt=B.projection.createInversionMatrix(B,Ce.canonical),xn={programConfiguration:Ie,program:dt,layoutVertexBuffer:$t,globeExtVertexBuffer:Ct,indexBuffer:en,uniformValues:s.cz(h,Ce,ze,Jt,pe,o),tile:ze};if(S){const Lt=ge.segments.get();for(const Zt of Lt)re.push({segments:new s.aB([Zt]),sortKey:Zt.sortKey,state:xn})}else re.push({segments:ge.segments,sortKey:0,state:xn})}S&&re.sort((Le,Ce)=>Le.sortKey-Ce.sortKey);const ve={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const Le of re){const{programConfiguration:Ce,program:ze,layoutVertexBuffer:ge,globeExtVertexBuffer:Ie,indexBuffer:Qe,uniformValues:nt,tile:dt}=Le.state,$t=Le.segments;h.terrain&&h.terrain.setupElevationDraw(dt,ze,ve),h.uploadCommonUniforms(H,ze,dt.tileID.toUnwrapped()),ze.draw(h,R.TRIANGLES,Y,Q,le,Qn.disabled,nt,o.id,ge,Qe,$t,o.paint,B.zoom,Ce,[Ie])}},heatmap:function(h,i,o,d){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const m=h.context,v=m.gl,b=Ci.disabled,S=new Bi([v.ONE,v.ONE,v.ONE,v.ONE],s.ax.transparent,[!0,!0,!0,!0]);(function(Q,le,ce,pe){const re=Q.gl,ve=le.width*pe,Le=le.height*pe;Q.activeTexture.set(re.TEXTURE1),Q.viewport.set([0,0,ve,Le]);let Ce=ce.heatmapFbo;if(!Ce||Ce&&(Ce.width!==ve||Ce.height!==Le)){Ce&&Ce.destroy();const ze=re.createTexture();re.bindTexture(re.TEXTURE_2D,ze),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),Ce=ce.heatmapFbo=Q.createFramebuffer(ve,Le,!0,null),function(ge,Ie,Qe,nt,dt,$t){const Ct=ge.gl;Ct.texImage2D(Ct.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?Ct.RGBA16F:Ct.RGBA,dt,$t,0,Ct.RGBA,ge.extRenderToTextureHalfFloat?Ct.HALF_FLOAT:Ct.UNSIGNED_BYTE,null),nt.colorAttachment.set(Qe)}(Q,0,ze,Ce,ve,Le)}else re.bindTexture(re.TEXTURE_2D,Ce.colorAttachment.get()),Q.bindFramebuffer.set(Ce.framebuffer)})(m,h,o,"globe"===h.transform.projection.name?.5:.25),m.clear({color:s.ax.transparent});const z=h.transform,H="globe"===z.projection.name,R=H?["PROJECTION_GLOBE_VIEW"]:[],B=H?Qn.frontCCW:Qn.disabled,Y=[s.a5(z.center.lng),s.ae(z.center.lat)];for(let Q=0;Q<d.length;Q++){const le=d[Q];if(i.hasRenderableParent(le))continue;const ce=i.getTile(le),pe=ce.getBucket(o);if(!pe||pe.projection.name!==z.projection.name)continue;const re=h.isTileAffectedByFog(le),ve=pe.programConfigurations.get(o.id),Le=h.getOrCreateProgram("heatmap",{config:ve,defines:R,overrideFog:re}),{zoom:Ce}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ce,Le),h.uploadCommonUniforms(m,Le,le.toUnwrapped());const ze=z.projection.createInversionMatrix(z,le.canonical);Le.draw(h,v.TRIANGLES,ci.disabled,b,S,B,q(h,le,ce,ze,Y,Ce,o.paint.get("heatmap-intensity")),o.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,o.paint,h.transform.zoom,ve,H?[pe.globeExtVertexBuffer]:null)}m.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(m,v){const b=m.context,S=b.gl,z=v.heatmapFbo;if(!z)return;b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,z.colorAttachment.get()),b.activeTexture.set(S.TEXTURE1);let H=v.colorRampTexture;H||(H=v.colorRampTexture=new s.T(b,v.colorRamp,S.RGBA)),H.bind(S.LINEAR,S.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,S.TRIANGLES,ci.disabled,Ci.disabled,m.colorModeForRenderPass(),Qn.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,v.paint,m.transform.zoom)}(h,o))},line:function(h,i,o,d){if("translucent"!==h.renderPass)return;const m=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(0===m.constantOr(1)||0===v.constantOr(1))return;const b=o.paint.get("line-emissive-strength"),S=h.depthModeForSublayer(0,ci.ReadOnly),z=h.colorModeForDrapableLayerRenderPass(b),H=h.terrain&&h.terrain.renderingToTexture?1:s.f.devicePixelRatio,R=o.paint.get("line-dasharray"),B=R.constantOr(1),Y=o.layout.get("line-cap"),Q=o.paint.get("line-pattern"),le=Q.constantOr(1),ce=o.paint.get("line-pattern").constantOr(1),pe=1!==o.paint.get("line-opacity").constantOr(1);let re=!ce&&pe;const ve=o.paint.get("line-gradient"),Le=le?"linePattern":"line",Ce=h.context,ze=Ce.gl,ge=s.cA(o);h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(re=!1);for(const Ie of d){const Qe=i.getTile(Ie);if(le&&!Qe.patternsLoaded())continue;const nt=Qe.getBucket(o);if(!nt)continue;h.prepareDrawTile();const dt=nt.programConfigurations.get(o.id),$t=h.isTileAffectedByFog(Ie),Ct=h.getOrCreateProgram(Le,{config:dt,defines:ge,overrideFog:$t}),en=Q.constantOr(null);if(en&&Qe.imageAtlas){const Un=Qe.imageAtlas.patternPositions[en.toString()];Un&&dt.setConstantPatternPositions(Un)}const Jt=R.constantOr(null),xn=Y.constantOr(null);if(!le&&Jt&&xn&&Qe.lineAtlas){const Un=Qe.lineAtlas.getDash(Jt,xn);Un&&dt.setConstantPatternPositions(Un)}let[Lt,Zt]=o.paint.get("line-trim-offset");("round"===xn||"square"===xn)&&Lt!==Zt&&(0===Lt&&(Lt-=1),1===Zt&&(Zt+=1));const ut=h.terrain?Ie.projMatrix:null,Nt=le?s.cB(h,Qe,o,ut,H,[Lt,Zt]):s.cC(h,Qe,o,ut,nt.lineClipsArray.length,H,[Lt,Zt]);if(ve){const Un=nt.gradients[o.id];let kn=Un.texture;if(o.gradientVersion!==Un.version){let Yn=256;if(o.stepInterpolant){const di=i.getSource().maxzoom,Ai=Ie.canonical.z===di?Math.ceil(1<<h.transform.maxZoom-Ie.canonical.z):1;Yn=s.aa(s.cD(nt.maxLineLength/s.V*1024*Ai),256,Ce.maxTextureSize)}Un.gradient=s.cE({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Yn,image:Un.gradient||void 0,clips:nt.lineClipsArray}),Un.texture?Un.texture.update(Un.gradient):Un.texture=new s.T(Ce,Un.gradient,ze.RGBA),Un.version=o.gradientVersion,kn=Un.texture}Ce.activeTexture.set(ze.TEXTURE1),kn.bind(o.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}B&&(Ce.activeTexture.set(ze.TEXTURE0),Qe.lineAtlasTexture&&Qe.lineAtlasTexture.bind(ze.LINEAR,ze.REPEAT),dt.updatePaintBuffers()),le&&(Ce.activeTexture.set(ze.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),dt.updatePaintBuffers()),h.uploadCommonUniforms(Ce,Ct,Ie.toUnwrapped());const Cn=Un=>{Ct.draw(h,ze.TRIANGLES,S,Un,z,Qn.disabled,Nt,o.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,o.paint,h.transform.zoom,dt,[nt.layoutVertexBuffer2])};if(re){const Un=h.stencilModeForClipping(Ie).ref;0===Un&&h.terrain&&Ce.clear({stencil:0});const kn={func:ze.EQUAL,mask:255};Nt.u_alpha_discard_threshold=.8,Cn(new Ci(kn,Un,255,ze.KEEP,ze.KEEP,ze.INVERT)),Nt.u_alpha_discard_threshold=0,Cn(new Ci(kn,Un,255,ze.KEEP,ze.KEEP,ze.KEEP))}else Cn(h.stencilModeForClipping(Ie))}re&&(h.resetStencilClippingMasks(),h.terrain&&Ce.clear({stencil:0}))},fill:function(h,i,o,d){const m=o.paint.get("fill-color"),v=o.paint.get("fill-opacity");if(0===v.constantOr(1))return;const b=o.paint.get("fill-emissive-strength"),S=h.colorModeForDrapableLayerRenderPass(b),z=o.paint.get("fill-pattern"),H=h.opaquePassEnabledForLayer()&&!z.constantOr(1)&&1===m.constantOr(s.ax.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(h.renderPass===H){const R=h.depthModeForSublayer(1,"opaque"===h.renderPass?ci.ReadWrite:ci.ReadOnly);Ya(h,i,o,d,R,S,!1)}if("translucent"===h.renderPass&&o.paint.get("fill-antialias")){const R=h.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,ci.ReadOnly);Ya(h,i,o,d,R,S,!0)}},"fill-extrusion":function(h,i,o,d){const m=o.paint.get("fill-extrusion-opacity"),v=h.context,b=v.gl,S=h.terrain,z=S&&S.renderingToTexture;if(0===m)return;const H=h.conflationActive&&h.layerUsedInConflation(o,i.getSource());if(H&&function(R,B,Y,Q){for(const le of Q){const ce=B.getTile(le).getBucket(Y);ce&&(ce.updateReplacement(le,R.replacementSource),ce.uploadCentroid(R.context))}}(h,i,o,d),S||H)for(const R of d){const B=i.getTile(R).getBucket(o);B&&Ni(h.context,i,R,B,o,S,H)}if("shadow"===h.renderPass&&h.shadowRenderer){const R=h.shadowRenderer;if(S&&m<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.Z)return;const B=R.getShadowPassDepthMode(),Y=R.getShadowPassColorMode();ai(h,i,o,d,B,Ci.disabled,Y,H)}else if("translucent"===h.renderPass){const R=!o.paint.get("fill-extrusion-pattern").constantOr(1),B=o.paint.get("fill-extrusion-color").constantOr(s.ax.white);if(!z&&0!==B.a){const Y=new ci(h.context.gl.LEQUAL,ci.ReadWrite,h.depthRangeFor3D);1===m&&R?ai(h,i,o,d,Y,Ci.disabled,Bi.unblended,H):(ai(h,i,o,d,Y,Ci.disabled,Bi.disabled,H),ai(h,i,o,d,Y,h.stencilModeFor3D(),h.colorModeForRenderPass(),H),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&R&&(!S&&"globe"!==h.transform.projection.name||z)){const Y=o.paint.get("fill-extrusion-opacity"),Q=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),le=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ce=o.paint.get("fill-extrusion-flood-light-intensity"),pe=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),re=Q>0&&le>0,ve=ce>0,Le=(ze,ge,Ie)=>(1-Ie)*ze+Ie*ge,Ce=ze=>{const ge=h.depthModeForSublayer(1,ci.ReadOnly,b.LEQUAL,!0),Ie=o.paint.get(ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=Le(.1,3,Ie),nt=h._showOverdrawInspector;if(!nt){const dt=new Ci({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),$t=new Bi([b.ONE,b.ONE,b.ONE,b.ONE],s.ax.transparent,[!1,!1,!1,!0],b.MIN);o2(h,i,o,d,ge,dt,$t,Qn.disabled,ze,"sdf",Y,Q,le,ce,pe,Qe,H,!1)}{const dt=nt?Ci.disabled:new Ci({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),$t=nt?h.colorModeForRenderPass():new Bi([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],s.ax.transparent,[!0,!0,!0,!0]);o2(h,i,o,d,ge,dt,$t,Qn.disabled,ze,"color",Y,Q,le,ce,pe,Qe,H,!1)}};if(z){const ze=(ge,Ie,Qe)=>{const nt=h.depthModeForSublayer(1,ci.ReadOnly,b.LEQUAL,!1),dt=o.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),$t=Le(.1,3,dt);{const Ct=new Bi([b.ONE,b.ONE,b.ONE,b.ONE],s.ax.transparent,[!1,!1,!1,!0]);o2(h,i,o,d,nt,Ci.disabled,Ct,Qn.disabled,ge,"clear",Y,Q,le,ce,pe,$t,H,Ie)}{const Ct=new Ci({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),en=new Bi([b.ONE,b.ONE,b.ONE,b.ONE],s.ax.transparent,[!1,!1,!1,!0],b.MIN);o2(h,i,o,d,nt,Ct,en,Qn.disabled,ge,"sdf",Y,Q,le,ce,pe,$t,H,Ie)}{const Ct=ge?b.ZERO:b.ONE_MINUS_DST_ALPHA,en=new Ci({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Jt=new Bi([Ct,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],s.ax.transparent,[!0,!0,!0,!0]);o2(h,i,o,d,nt,en,Jt,Qn.disabled,ge,"color",Y,Q,le,ce,pe,$t,H,Ie)}{const Ct=new Bi([b.ONE,b.ONE,b.ONE,ge?b.ZERO:b.ONE],s.ax.transparent,[!1,!1,!1,!0],ge?b.FUNC_ADD:b.MAX);o2(h,i,o,d,nt,Ci.disabled,Ct,Qn.disabled,ge,"clear",Y,Q,le,ce,pe,$t,H,Ie,Qe)}};if(re||ve){let ge;if(h.prepareDrawTile(),S){const Ie=S.drapeBufferSize[0],Qe=S.drapeBufferSize[1];ge=S.framebufferCopyTexture,ge&&(!ge||ge.size[0]===Ie&&ge.size[1]===Qe)||(ge&&ge.destroy(),ge=S.framebufferCopyTexture=new s.T(v,new s.h({width:Ie,height:Qe}),b.RGBA)),ge.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,Ie,Qe,0)}re&&ze(!0,!1,ge),ve&&ze(!1,!0,ge)}}else re&&Ce(!0),ve&&Ce(!1)}}},hillshade:function(h,i,o,d){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass||h.style.disableElevatedTerrain)return;const m=h.context,v=h.terrain&&h.terrain.renderingToTexture,[b,S]="translucent"!==h.renderPass||v?[{},d]:h.stencilConfigForOverlap(d);for(const z of S){const H=i.getTile(z);if(H.needsHillshadePrepare&&"offscreen"===h.renderPass)xs(h,H,o);else if("translucent"===h.renderPass){const R=h.depthModeForSublayer(0,ci.ReadOnly),B=o.paint.get("hillshade-emissive-strength"),Y=h.colorModeForDrapableLayerRenderPass(B),Q=v&&h.terrain?h.terrain.stencilModeForRTTOverlap(z):b[z.overscaledZ];Bs(h,z,H,o,R,Q,Y)}}m.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,i,o,d,m,v){if("translucent"!==h.renderPass||0===o.paint.get("raster-opacity"))return;const b="globe"===h.transform.projection.name,S=0!==o.paint.get("raster-elevation"),z=S&&b;if(h.renderElevatedRasterBackface&&!z)return;const H=h.context,R=H.gl,B=i.getSource(),Y=function(ge,Ie,Qe,nt){const dt=Ie.paint.get("raster-color"),$t="raster-array"===ge.type,Ct=[],en=Ie.paint.get("raster-resampling"),Jt=Ie.paint.get("raster-color-mix");let xn=Ie.paint.get("raster-color-range");const Lt=[Jt[0],Jt[1],Jt[2],0],Zt=Jt[3];let ut="nearest"===en?nt.NEAREST:nt.LINEAR;if($t&&(Ct.push("RASTER_ARRAY"),dt||Ct.push("RASTER_COLOR"),"linear"===en&&Ct.push("RASTER_ARRAY_LINEAR"),ut=nt.NEAREST,!xn&&ge.rasterLayers)){const Nt=ge.rasterLayers.find(({id:Cn})=>Cn===Ie.sourceLayer);Nt&&Nt.fields&&Nt.fields.range&&(xn=Nt.fields.range)}if(xn=xn||[0,1],dt){Ct.push("RASTER_COLOR"),Qe.activeTexture.set(nt.TEXTURE2),Ie.updateColorRamp(xn);let Nt=Ie.colorRampTexture;Nt||(Nt=Ie.colorRampTexture=new s.T(Qe,Ie.colorRamp,nt.RGBA)),Nt.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)}return{mix:Lt,range:xn,offset:Zt,defines:Ct,resampling:ut}}(B,o,H,R);if(B instanceof s.ap&&!d.length&&!b)return;const Q=o.paint.get("raster-emissive-strength"),le=h.colorModeForDrapableLayerRenderPass(Q),ce=h.terrain&&h.terrain.renderingToTexture,pe=!h.options.moving,re="nearest"===o.paint.get("raster-resampling")?R.NEAREST:R.LINEAR;if(B instanceof s.ap&&!d.length&&(B.onNorthPole||B.onSouthPole)){const ge=S?h.stencilModeFor3D():Ci.disabled;return void f1(!!B.onNorthPole,null,h,i,o,Q,Y,Qn.disabled,ge)}if(!d.length)return;const[ve,Le]=B instanceof s.ap||ce?[{},d]:h.stencilConfigForOverlap(d),Ce=Le[Le.length-1].overscaledZ;z&&Y.defines.push("PROJECTION_GLOBE_VIEW"),S&&Y.defines.push("RENDER_CUTOFF");const ze=(ge,Ie,Qe)=>{for(const nt of ge){const dt=nt.toUnwrapped(),$t=i.getTile(nt);if(ce&&(!$t||!$t.hasData()))continue;H.activeTexture.set(R.TEXTURE0);const Ct=k($t,B,o,Y);if(!Ct||!Ct.texture)continue;const{texture:en,mix:Jt,offset:xn,tileSize:Lt,buffer:Zt}=Ct;let ut,Nt;ce?(ut=ci.disabled,Nt=nt.projMatrix):S?(ut=new ci(R.LEQUAL,ci.ReadWrite,h.depthRangeFor3D),Nt=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(dt,pe)):(ut=h.depthModeForSublayer(nt.overscaledZ-Ce,1===o.paint.get("raster-opacity")?ci.ReadWrite:ci.ReadOnly,R.LESS),Nt=h.transform.calculateProjMatrix(dt,pe));const Cn=h.terrain&&ce?h.terrain.stencilModeForRTTOverlap(nt):ve[nt.overscaledZ],Un=v?0:o.paint.get("raster-fade-duration");$t.registerFadeDuration(Un);const kn=i.findLoadedParent(nt,0),Yn=gc($t,kn,i,h.transform,Un);let di,Ai;h.terrain&&h.terrain.prepareDrawTile(),H.activeTexture.set(R.TEXTURE0),en.bind(re,R.CLAMP_TO_EDGE),H.activeTexture.set(R.TEXTURE1),kn?(kn.texture&&kn.texture.bind(re,R.CLAMP_TO_EDGE),di=Math.pow(2,kn.tileID.overscaledZ-$t.tileID.overscaledZ),Ai=[$t.tileID.canonical.x*di%1,$t.tileID.canonical.y*di%1]):en.bind(re,R.CLAMP_TO_EDGE),en.useMipmap&&H.extTextureFilterAnisotropic&&h.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const xi=h.transform;let bi;const ur=S?W1(xi):[0,0,0,0];let ar,yr,mr,Yr,Is,xr=0;if(z&&B instanceof s.ap&&B.coordinates.length>3)ar=Float32Array.from(s.aT(s.ci(new s.bs(0,0,0)))),yr=Float32Array.from(xi.globeMatrix),mr=Float32Array.from(s.ce(xi)),Yr=[s.a5(xi.center.lng),s.ae(xi.center.lat)],bi=B.elevatedGlobePerspectiveTransform,Is=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const Rr=s.cf(nt.canonical);xr=s.cg(Rr.getCenter().lat),ar=Float32Array.from(s.aT(s.ci(nt.canonical))),yr=Float32Array.from(xi.globeMatrix),mr=Float32Array.from(s.ce(xi)),Yr=[s.a5(xi.center.lng),s.ae(xi.center.lat)],bi=[0,0],Is=Float32Array.from(s.ch(nt.canonical,Rr,xr,xi.worldSize/xi._pixelsPerMercatorPixel))}else bi=B instanceof s.ap?B.perspectiveTransform:[0,0],ar=new Float32Array(16),yr=new Float32Array(9),mr=new Float32Array(16),Yr=[0,0],Is=new Float32Array(9);const Us=bt(Nt,ar,yr,mr,Is,Ai||[0,0],s.S(h.transform.zoom),Yr,ur,di||1,Yn,o,bi,S?o.paint.get("raster-elevation"):0,2,Jt,xn,Y.range,Lt,Zt,Q),kr=h.isTileAffectedByFog(nt),ts=h.getOrCreateProgram("raster",{defines:Y.defines,overrideFog:kr});if(h.uploadCommonUniforms(H,ts,dt),B instanceof s.ap){const Rr=B.elevatedGlobeVertexBuffer,Jr=B.elevatedGlobeIndexBuffer;if(ce||!b)B.boundsBuffer&&B.boundsSegments&&ts.draw(h,R.TRIANGLES,ut,Ci.disabled,le,Qn.disabled,Us,o.id,B.boundsBuffer,h.quadTriangleIndexBuffer,B.boundsSegments);else if(Rr&&Jr){const Ys=xi.zoom<=s.bG?B.elevatedGlobeSegments:B.getSegmentsForLongitude(xi.center.lng);Ys&&ts.draw(h,R.TRIANGLES,ut,Ci.disabled,le,Ie,Us,o.id,Rr,Jr,Ys)}}else if(z){ut=new ci(R.LEQUAL,ci.ReadOnly,h.depthRangeFor3D);const Rr=h.globeSharedBuffers;if(Rr){const[Jr,Ys,ss]=Rr.getGridBuffers(xr,!1);ts.draw(h,R.TRIANGLES,ut,Qe||Cn,h.colorModeForRenderPass(),Ie,Us,o.id,Jr,Ys,ss)}}else{const{tileBoundsBuffer:Rr,tileBoundsIndexBuffer:Jr,tileBoundsSegments:Ys}=h.getTileBoundsBuffers($t);ts.draw(h,R.TRIANGLES,ut,Cn,le,Qn.disabled,Us,o.id,Rr,Jr,Ys)}}if(!(B instanceof s.ap)&&z)for(const nt of ge){const dt=nt.canonical.y===(1<<nt.canonical.z)-1;0===nt.canonical.y&&f1(!0,nt,h,i,o,Q,Y,Ie,Qe||Ci.disabled),dt&&f1(!1,nt,h,i,o,Q,Y,Ie===Qn.frontCW?Qn.backCW:Qn.frontCW,Qe||Ci.disabled)}};z?ze(Le,h.renderElevatedRasterBackface?Qn.backCW:Qn.frontCW,h.stencilModeFor3D()):ze(Le,Qn.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,i,o,d,m,v){"offscreen"===h.renderPass&&function(b,S,z,H){if(!H.length)return;const R=b.context,B=R.gl,Y=S.getSource();if(!(Y instanceof ke))return;const Q=[];for(const pe of H){const re=S.getTile(pe);if(!(re instanceof yo))continue;const ve=F(re,Y,z);if(!ve)continue;const Le=[ve.tileSize,ve.tileSize];let Ce=z.tileFramebuffer;Ce||(Ce=z.tileFramebuffer=R.createFramebuffer(Le[0],Le[1],!0,null));let ze=re.rasterParticleState;const ge=z.paint.get("raster-particle-count");ze||(ze=re.rasterParticleState=new as(R,pe,Le,ge));const Ie=ze.update(z.lastInvalidatedAt);ze.numParticles!==ge&&ze.setNumParticles(pe,ge);const Qe=ze.targetColorTexture;ze.targetColorTexture=ze.backgroundColorTexture,ze.backgroundColorTexture=Qe;const nt=ze.particleVertices0;ze.particleVertices0=ze.particleVertices1,ze.particleVertices1=nt,Q.push([pe,ve,ze,Ie])}if(0===Q.length)return;const le=s.f.now(),ce=z.previousDrawTimestamp?.001*(le-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=le,z.hasColorMap()){R.activeTexture.set(B.TEXTURE0+2);let pe=z.colorRampTexture;pe||(pe=z.colorRampTexture=new s.T(R,z.colorRamp,B.RGBA)),pe.bind(B.LINEAR,B.CLAMP_TO_EDGE)}R.bindFramebuffer.set(z.tileFramebuffer.framebuffer),R.activeTexture.set(B.TEXTURE0),function(pe,re,ve){const Le=pe.context,Ce=Le.gl,ze=re.tileFramebuffer;Le.activeTexture.set(Ce.TEXTURE0);const ge={u_texture:0,u_opacity:1.05*(Qe=re.paint.get("raster-particle-fade-opacity-factor"))/(Qe+.05)},Ie=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Qe;for(const nt of ve){const[,,dt,$t]=nt;ze.colorAttachment.set(dt.targetColorTexture.texture),Le.viewport.set([0,0,ze.width,ze.height]),Le.clear({color:s.ax.transparent}),$t&&(dt.backgroundColorTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE),Ie.draw(pe,Ce.TRIANGLES,ci.disabled,Ci.disabled,Bi.alphaBlended,Qn.disabled,ge,re.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(b,z,Q),function(pe,re,ve,Le){const Ce=pe.context.gl,ze=ve.tileFramebuffer,ge="globe"===pe.transform.projection.name,Ie=ve.paint.get("raster-particle-max-speed");for(const Qe of Le){const[nt,dt,$t]=Qe;dt.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),ze.colorAttachment.set($t.targetColorTexture.texture);const Ct=pe.getOrCreateProgram("rasterParticleDraw",{defines:dt.defines,overrideFog:!1}),en=dt.scalarData?[]:[0,1,2,3].map(Lt=>s.cG[Lt](nt));en.push(nt);const Jt=nt.canonical.x,xn=nt.canonical.y;for(const Lt of en){const Zt=re.getTile(ge?Lt.wrapped():Lt);if(!Zt)continue;const ut=Zt.rasterParticleState;if(!ut)continue;const Nt=An([Lt.canonical.x+(1<<Lt.canonical.z)*(Lt.wrap-nt.wrap)-Jt,Lt.canonical.y-xn],0,dt.texture.size,2,Ie,dt.textureOffset,dt.scale,dt.offset);Ct.draw(pe,Ce.POINTS,ci.disabled,Ci.disabled,Bi.alphaBlended,Qn.disabled,Nt,ve.id,ut.particleVertices0,void 0,ut.particleSegment)}}}(b,S,z,Q),function(pe,re,ve,Le){const Ce=pe.context.gl;let ze=re.transformFeedbackObject;ze||(ze=re.transformFeedbackObject=Ce.createTransformFeedback()),Ce.bindTransformFeedback(Ce.TRANSFORM_FEEDBACK,re.transformFeedbackObject);const ge=re.paint.get("raster-particle-max-speed"),Ie=Le*re.paint.get("raster-particle-speed-factor")*.3,Qe=(nt=re.paint.get("raster-particle-reset-rate-factor"),Math.pow(nt,6));var nt;for(const dt of ve){const[,$t,Ct]=dt;$t.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE);const en=fi(0,$t.texture.size,ge,Ie,Qe,$t.textureOffset,$t.scale,$t.offset);pe.getOrCreateProgram("rasterParticleUpdate",{defines:$t.defines,transformFeedback:{bufferMode:Ce.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(pe,Ce.POINTS,ci.disabled,Ci.disabled,Bi.disabled,Qn.disabled,en,re.id,Ct.particleVertices0,void 0,Ct.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:Ct.particleVertices1,targetIndex:0}])}Ce.bindTransformFeedback(Ce.TRANSFORM_FEEDBACK,null)}(b,z,Q,ce)}(h,i,o,d),"translucent"===h.renderPass&&(function(b,S,z,H,R){const B=b.context,Y=B.gl,Q=!b.options.moving,le="globe"===b.transform.projection.name;if(!H.length)return;const[ce,pe]=b.stencilConfigForOverlap(H),re=[];le&&re.push("PROJECTION_GLOBE_VIEW");for(const ve of pe){const Le=ve.toUnwrapped(),Ce=S.getTile(ve);if(!Ce.rasterParticleState)continue;const ze=Ce.rasterParticleState,ge=100;Ce.registerFadeDuration(ge);const Ie=S.findLoadedParent(ve,0),Qe=gc(Ce,Ie,S,b.transform,ge);let nt,dt;b.terrain&&b.terrain.prepareDrawTile(),B.activeTexture.set(Y.TEXTURE0),ze.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),B.activeTexture.set(Y.TEXTURE1),Ie&&Ie.rasterParticleState?(Ie.rasterParticleState.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),nt=Math.pow(2,Ie.tileID.overscaledZ-Ce.tileID.overscaledZ),dt=[Ce.tileID.canonical.x*nt%1,Ce.tileID.canonical.y*nt%1]):ze.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const $t=le?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(Le,Q),Ct=b.transform,en=V(Ct),Jt=s.cf(ve.canonical),xn=s.cg(Jt.getCenter().lat);let Lt,Zt,ut,Nt,Cn;le?(Lt=Float32Array.from(s.aT(s.ci(ve.canonical))),Zt=Float32Array.from(Ct.globeMatrix),ut=Float32Array.from(s.ce(Ct)),Nt=[s.a5(Ct.center.lng),s.ae(Ct.center.lat)],Cn=Float32Array.from(s.ch(ve.canonical,Jt,xn,Ct.worldSize/Ct._pixelsPerMercatorPixel))):(Lt=new Float32Array(16),Zt=new Float32Array(9),ut=new Float32Array(16),Nt=[0,0],Cn=new Float32Array(9));const Un=fn($t,Lt,Zt,ut,Cn,dt||[0,0],s.S(b.transform.zoom),Nt,en,nt||1,Qe,250),kn=b.isTileAffectedByFog(ve),Yn=b.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:kn});if(b.uploadCommonUniforms(B,Yn,Le),le){const di=new ci(Y.LEQUAL,ci.ReadWrite,b.depthRangeFor3D),Ai=0,xi=b.globeSharedBuffers;if(xi){const[bi,ur,ar]=xi.getGridBuffers(xn,0!==Ai);Yn.draw(b,Y.TRIANGLES,di,Ci.disabled,Bi.alphaBlended,Qn.backCCW,Un,z.id,bi,ur,ar)}}else{const di=b.depthModeForSublayer(0,ci.ReadOnly),Ai=ce[ve.overscaledZ],{tileBoundsBuffer:xi,tileBoundsIndexBuffer:bi,tileBoundsSegments:ur}=b.getTileBoundsBuffers(Ce);Yn.draw(b,Y.TRIANGLES,di,Ai,Bi.alphaBlended,Qn.disabled,Un,z.id,xi,bi,ur)}}b.resetStencilClippingMasks()}(h,i,o,d),h.style.map.triggerRepaint())},background:function(h,i,o,d){const m=o.paint.get("background-color"),v=o.paint.get("background-opacity"),b=o.paint.get("background-emissive-strength");if(0===v)return;const S=h.context,z=S.gl,H=h.transform,R=H.tileSize,B=o.paint.get("background-pattern");if(h.isPatternMissing(B,o.scope))return;const Y=!B&&1===m.a&&1===v&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==Y)return;const Q=Ci.disabled,le=h.depthModeForSublayer(0,"opaque"===Y?ci.ReadWrite:ci.ReadOnly),ce=h.colorModeForDrapableLayerRenderPass(b),pe=B?"backgroundPattern":"background";let re,ve=d;ve||(re=h.getBackgroundTiles(),ve=Object.values(re).map(Le=>Le.tileID)),B&&(S.activeTexture.set(z.TEXTURE0),h.imageManager.bind(h.context,o.scope));for(const Le of ve){const Ce=h.isTileAffectedByFog(Le),ze=h.getOrCreateProgram(pe,{overrideFog:Ce}),ge=Le.toUnwrapped(),Ie=d?Le.projMatrix:h.transform.calculateProjMatrix(ge);h.prepareDrawTile();const Qe=i?i.getTile(Le):re?re[Le.key]:new $s(Le,R,H.zoom,h),nt=B?_s(Ie,b,v,h,B,o.scope,{tileID:Le,tileSize:R}):Fr(Ie,b,v,m);h.uploadCommonUniforms(S,ze,ge);const{tileBoundsBuffer:dt,tileBoundsIndexBuffer:$t,tileBoundsSegments:Ct}=h.getTileBoundsBuffers(Qe);ze.draw(h,z.TRIANGLES,le,Q,ce,Qn.disabled,nt,o.id,dt,$t,Ct)}},sky:function(h,i,o){const d=h._atmosphere?s.S(h.transform.zoom):1,m=o.paint.get("sky-opacity")*d;if(0===m)return;const v=h.context,b=o.paint.get("sky-type"),S=new ci(v.gl.LEQUAL,ci.ReadOnly,[0,1]),z=h.frameCounter/1e3%1;"atmosphere"===b?"offscreen"===h.renderPass?o.needsSkyboxCapture(h)&&(function(H,R,B,Y){const Q=H.context,le=Q.gl;let ce=R.skyboxFbo;if(!ce){ce=R.skyboxFbo=Q.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new N1(Q),R.skyboxTexture=Q.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,R.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Le=0;Le<6;++Le)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ce.framebuffer),Q.viewport.set([0,0,32,32]);const pe=R.getCenter(H,!0),re=H.getOrCreateProgram("skyboxCapture"),ve=new Float64Array(16);s.a6.identity(ve),s.a6.rotateY(ve,ve,.5*-Math.PI),Ha(H,R,re,ve,pe,0),s.a6.identity(ve),s.a6.rotateY(ve,ve,.5*Math.PI),Ha(H,R,re,ve,pe,1),s.a6.identity(ve),s.a6.rotateX(ve,ve,.5*-Math.PI),Ha(H,R,re,ve,pe,2),s.a6.identity(ve),s.a6.rotateX(ve,ve,.5*Math.PI),Ha(H,R,re,ve,pe,3),s.a6.identity(ve),Ha(H,R,re,ve,pe,4),s.a6.identity(ve),s.a6.rotateY(ve,ve,Math.PI),Ha(H,R,re,ve,pe,5),Q.viewport.set([0,0,H.width,H.height])}(h,o),o.markSkyboxValid(h)):"sky"===h.renderPass&&function(H,R,B,Y,Q){const le=H.context,ce=le.gl,pe=H.transform,re=H.getOrCreateProgram("skybox");le.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,R.skyboxTexture);const ve={u_matrix:pe.skyboxMatrix,u_sun_direction:R.getCenter(H,!1),u_cubemap:0,u_opacity:Y,u_temporal_offset:Q};H.uploadCommonUniforms(le,re),re.draw(H,ce.TRIANGLES,B,Ci.disabled,H.colorModeForRenderPass(),Qn.backCW,ve,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,o,S,m,z):"gradient"===b&&"sky"===h.renderPass&&function(H,R,B,Y,Q){const le=H.context,ce=le.gl,pe=H.transform,re=H.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new N1(le)),le.activeTexture.set(ce.TEXTURE0);let ve=R.colorRampTexture;ve||(ve=R.colorRampTexture=new s.T(le,R.colorRamp,ce.RGBA)),ve.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Le=(Ce=pe.skyboxMatrix,ze=R.getCenter(H,!1),ge=R.paint.get("sky-gradient-radius"),Ie=Y,Qe=Q,{u_matrix:Ce,u_color_ramp:0,u_center_direction:ze,u_radius:s.bj(ge),u_opacity:Ie,u_temporal_offset:Qe});var Ce,ze,ge,Ie,Qe;H.uploadCommonUniforms(le,re),re.draw(H,ce.TRIANGLES,B,Ci.disabled,H.colorModeForRenderPass(),Qn.backCW,Le,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,o,S,m,z)},debug:function(h,i,o,d,m,v){for(let b=0;b<o.length;b++)if(m){const H=new s.ax(.8*d.r,.8*d.g,.8*d.b,1);zn(h,i,o[b],d,-1,-1,v),zn(h,i,o[b],d,-1,1,v),zn(h,i,o[b],d,1,1,v),zn(h,i,o[b],d,1,-1,v),zn(h,i,o[b],H,0,0,v)}else zn(h,i,o[b],d,0,0,v)},custom:function(h,i,o,d){const m=h.context,v=o.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||"offscreen"===h.renderPass)&&o.isLayerDraped(i)){if("offscreen"===h.renderPass){const b=v.prerender;if(b){if(h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),"globe"===h.transform.projection.name){const S=h.transform.pointMerc;b.call(v,m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.S(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else b.call(v,m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState()}}else if("translucent"===h.renderPass){if(h.terrain&&h.terrain.renderingToTexture){const S=v.renderToTile;if(S){const z=d[0].canonical,H=new s.L(z.x+d[0].wrap*(1<<z.z),z.y,z.z);m.setDepthMode(ci.disabled),m.setStencilMode(Ci.disabled),m.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),S.call(v,m.gl,H),m.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),m.setStencilMode(Ci.disabled);const b="3d"===v.renderingMode?new ci(h.context.gl.LEQUAL,ci.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ci.ReadOnly);if(m.setDepthMode(b),"globe"===h.transform.projection.name){const S=h.transform.pointMerc;v.render(m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.S(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else v.render(m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState(),m.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,i,o,d){if("opaque"===h.renderPass)return;const m=o.paint.get("model-opacity");if(0===m)return;const v=o.paint.get("model-cast-shadows");if("shadow"===h.renderPass&&(!v||h.terrain&&m<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof s.Z))return;const b=h.shadowRenderer,S=o.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,S||(b.enabled=!1));const z=()=>{b&&(b.useNormalOffset=!0,S||(b.enabled=!0))},H=i.getSource();if("light-beam"===h.renderPass&&"batched-model"!==H.type)return;if("vector"===H.type||"geojson"===H.type)return function(re,ve,Le,Ce){const ze=re.transform;if("mercator"!==ze.projection.name)return void s.w(`Drawing 3D models for ${ze.projection.name} projection is not yet implemented`);const ge=ze.getFreeCameraOptions().position;if(!re.modelManager)return;const Ie=re.modelManager;Le.modelManager=Ie;const Qe=re.shadowRenderer;if(!Le._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const nt=Le._unevaluatedLayout._values["model-id"],dt={...Le.layout.get("model-id").parameters};for(const $t of Ce){const Ct=ve.getTile($t).getBucket(Le);if(!Ct||Ct.projection.name!==ze.projection.name)continue;const en=D4($t,ze);dt.zoom=en;const Jt=nt.possiblyEvaluate(dt);if(L4(re,Ct,$t),u2.shadowUniformsInitialized=!1,u2.useSingleShadowCascade=!!Qe&&0===Qe.getMaxCascadeForTile($t.toUnwrapped()),"shadow"===re.renderPass&&Qe){if(1===re.currentShadowCascade&&Ct.isInsideFirstShadowMapFrustum)continue;const Zt=ze.calculatePosMatrix($t.toUnwrapped(),ze.worldSize);if(u2.tileMatrix.set(Zt),u2.shadowTileMatrix=Float32Array.from(Qe.calculateShadowPassMatrixFromMatrix(Zt)),u2.aabb.min.fill(0),u2.aabb.max[0]=u2.aabb.max[1]=s.V,u2.aabb.max[2]=0,N6(Ct,u2,re,Le.scope))continue}const xn=1<<$t.canonical.z,Lt=[((ge.x-$t.wrap)*xn-$t.canonical.x)*s.V,(ge.y*xn-$t.canonical.y)*s.V,ge.z*xn*s.V];for(let Zt in Ct.instancesPerModel){const ut=Ct.instancesPerModel[Zt];ut.features.length>0&&(Zt=Jt.evaluate(ut.features[0].feature,{}));const Nt=Ie.getModel(Zt,Le.scope);if(Nt&&Nt.uploaded)for(const Cn of Nt.nodes)I4(re,Le,Cn,ut,Lt,$t,u2)}}}(h,i,o,d),void z();if(!H.loaded())return;if("batched-model"===H.type)return function(re,ve,Le,Ce){Le.resetLayerRenderingStats(re);const ze=re.context,ge=re.transform,Ie=re.style.fog,Qe=re.shadowRenderer;if("mercator"!==ge.projection.name)return void s.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const nt=re.transform.getFreeCameraOptions().position,dt=s.N.scale([],[nt.x,nt.y,nt.z],re.transform.worldSize);s.N.negate(dt,dt);const $t=s.a6.identity([]),Ct=s.cR(ge.center.lat,ge.zoom),en=s.a6.fromScaling([],[1,1,1/Ct]);s.a6.translate($t,$t,dt);const Jt=Le.paint.get("model-opacity"),xn=new ci(ze.gl.LEQUAL,ci.ReadWrite,re.depthRangeFor3D),Lt=new ci(ze.gl.LEQUAL,ci.ReadOnly,re.depthRangeFor3D),Zt=new s.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ut="shadow"===re.renderPass,Nt=ut&&Qe?Qe.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),Cn=Le.getLayerRenderingStats(),Un=function(kn,Yn){for(const di of Ce){const Ai=ve.getTile(di).getBucket(Le);if(!Ai||!Ai.uploaded)continue;let xi=!1;Qe&&(xi=0===Qe.getMaxCascadeForTile(di.toUnwrapped()));const bi=ge.calculatePosMatrix(di.toUnwrapped(),ge.worldSize),ur=Ai.modelTraits;for(const ar of Ai.getNodesInfo()){if(ar.hiddenByReplacement||!ar.node.meshes)continue;const yr=ar.evaluatedScale,mr=ar.node;let Yr=0;if(re.terrain&&mr.elevation&&(Yr=mr.elevation*re.terrain.exaggeration()),yr[0]<=1&&yr[1]<=1&&yr[2]<=1&&0===(()=>{const Ys=ar.getLocalBounds();return Zt.min=[...Ys.min],Zt.max=[...Ys.max],Zt.min[2]+=Yr,Zt.max[2]+=Yr,s.N.transformMat4(Zt.min,Zt.min,bi),s.N.transformMat4(Zt.max,Zt.max,bi),Zt})().intersects(Nt))continue;const Is="light-beam"===re.renderPass,xr=[...bi];s.a6.translate(xr,xr,[(mr.anchor?mr.anchor[0]:0)*(yr[0]-1),(mr.anchor?mr.anchor[1]:0)*(yr[1]-1),Yr]),s.N.exactEquals(yr,s.cT)||s.a6.scale(xr,xr,yr),s.a6.multiply(xr,xr,mr.matrix);const Us=s.a6.multiply([],en,xr);s.a6.multiply(Us,$t,Us);const kr=s.a6.invert([],Us);s.a6.transpose(kr,kr),s.a6.scale(kr,kr,Vl);const ts=s.a6.multiply([],ge.expandedFarZProjMatrix,xr),Rr=ur&s.cV.HasMapboxMeshFeatures,Jr=Rr?0:ar.evaluatedRMEA[0][2];for(let Ys=0;Ys<mr.meshes.length;++Ys){const ss=mr.meshes[Ys],pa=Ys===mr.lightMeshIndex;if(pa){if(!Is&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}}else if(Is)continue;const p1={defines:[]},k1=[];if(Co(p1.defines,k1,ss,re),Rr||p1.defines.push("DIFFUSE_SHADED"),xi&&p1.defines.push("SHADOWS_SINGLE_CASCADE"),Cn&&(ut?Cn.numRenderedVerticesInShadowPass+=ss.vertexArray.length:Cn.numRenderedVerticesInTransparentPass+=ss.vertexArray.length),ut){Rt(ss,xr,re,Le);continue}let G2=null;if(Ie){const R1=xc(xr,re.transform);if(G2=new Float32Array(R1),"globe"!==ge.projection.name){const C2=ss.aabb.min,Sc=ss.aabb.max,[fl,F3]=Ie.getOpacityForBounds(R1,C2[0],C2[1],Sc[0],Sc[1]);p1.overrideFog=fl>=hr||F3>=hr}}const Y1=ss.material;let ra;Y1.occlusionTexture&&Y1.occlusionTexture.offsetScale&&(ra=Y1.occlusionTexture.offsetScale,p1.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ut&&Qe&&(Qe.useNormalOffset=!!ss.normalBuffer);const no=re.getOrCreateProgram("model",p1);!ut&&Qe&&Qe.setupShadowsFromMatrix(xr,no,Qe.useNormalOffset),re.uploadCommonUniforms(ze,no,di.toUnwrapped(),G2);const ka=Y1.pbrMetallicRoughness;ka.metallicFactor=.9,ka.roughnessFactor=.5;const m1=vr(new Float32Array(ts),new Float32Array(Us),new Float32Array(kr),re,Jt,ka.baseColorFactor,Y1.emissiveFactor,ka.metallicFactor,ka.roughnessFactor,Y1,Jr,Le,[0,0,0],ra);no.draw(re,ze.gl.TRIANGLES,Yn&&!pa?xn:Lt,Ci.disabled,kn?pa||Jt<1||ar.hasTranslucentParts?Bi.alphaBlended:Bi.unblended:Bi.disabled,Qn.backCCW,m1,Le.id,ss.vertexBuffer,ss.indexBuffer,ss.segments,Le.paint,re.transform.zoom,void 0,k1)}}}};(function(kn,Yn,di,Ai){const xi=kn.terrain?kn.terrain.exaggeration():0,bi=kn.transform.zoom;for(const ur of Ai){const ar=Yn.getTile(ur).getBucket(di);ar&&(kn.conflationActive&&ar.updateReplacement(ur,kn.replacementSource),ar.evaluateScale(kn,di),kn.terrain&&xi>0&&ar.elevationUpdate(kn.terrain,xi,ur,di.source),ar.needsReEvaluation(kn,bi,di)&&ar.evaluate(di))}})(re,ve,Le,Ce),1===Jt?Un(!0,!0):(Un(!1,!0),Un(!0,!1))}(h,i,o,d),void z();const R=H.getModels(),B=[],Y=h.transform.getFreeCameraOptions().position,Q=s.N.scale([],[Y.x,Y.y,Y.z],h.transform.worldSize);s.N.negate(Q,Q);const le=[],ce=[];let pe=0;for(const re of R){const ve=o.paint.get("model-rotation").constantOr(null),Le=o.paint.get("model-scale").constantOr(null),Ce=o.paint.get("model-translation").constantOr(null);re.computeModelMatrix(h,ve,Le,Ce,!0,!0,!1);const ze=s.a6.identity([]),ge=s.cR(re.position.lat,h.transform.zoom),Ie=s.a6.fromScaling([],[1,1,1/ge]);s.a6.translate(ze,ze,Q),B.push({zScaleMatrix:Ie,negCameraPosMatrix:ze});for(const Qe of re.nodes)k2(h.transform,Qe,re.matrix,h.transform.expandedFarZProjMatrix,pe,le,ce);pe++}if(le.sort((re,ve)=>ve.depth-re.depth),"shadow"!==h.renderPass){if(1===m)for(const re of ce)Il(re,h,o,B[re.modelIndex],Ci.disabled,h.colorModeForRenderPass());else{for(const re of ce)Il(re,h,o,B[re.modelIndex],Ci.disabled,Bi.disabled);for(const re of ce)Il(re,h,o,B[re.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const re of le)Il(re,h,o,B[re.modelIndex],Ci.disabled,h.colorModeForRenderPass());z()}else{for(const re of ce)Rt(re.mesh,re.nodeModelMatrix,h,o);for(const re of le)Rt(re.mesh,re.nodeModelMatrix,h,o);z()}}},V4={model:function(h,i,o){const d=h.scope,m=i.getSource();if(!m.loaded())return;if("vector"===m.type||"geojson"===m.type)return void(o.modelManager&&o.modelManager.upload(o,d));if("batched-model"===m.type)return;const v=m.getModels();for(const b of v)b.upload(o.context)},raster:function(h,i,o){const d=i.getSource();if(!(d instanceof ke&&d.loaded()))return;const m=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const v=h.paint.get("raster-array-band")||d.getInitialBand(m);if(null==v)return;const b=i.getIds().map(S=>i.getTileByID(S));for(const S of b)S.updateNeeded(m,v)&&d.prepareTile(S,m,v)},"raster-particle":function(h,i,o){const d=i.getSource();if(!(d instanceof ke&&d.loaded()))return;const m=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const v=h.paint.get("raster-particle-array-band")||d.getInitialBand(m);if(null==v)return;const b=i.getIds().map(S=>i.getTileByID(S));for(const S of b)S.updateNeeded(m,v)&&d.prepareTile(S,m,v)}};class H4{constructor(i,o,d,m){this.context=new Ls(i,o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=m,this._debugParams={showTerrainProxyTiles:!1},m.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=za.maxUnderzooming+za.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ui(this),this._wireframeDebugCache=new du,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(i,o){const d=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new y2(this,i));const m=this._terrain;this.transform.elevation=d?m:null,m.update(i,this.transform,o),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(i){const o=i.fog;if(!o||"globe"===this.transform.projection.name||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,m]=o.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);const v=d+.78*(m-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,o){if(this.width=i*s.f.devicePixelRatio,this.height=o*s.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const i=this.context,o=new s.aN;o.emplaceBack(0,0),o.emplaceBack(s.V,0),o.emplaceBack(0,s.V),o.emplaceBack(s.V,s.V),this.tileExtentBuffer=i.createVertexBuffer(o,s.aP.members),this.tileExtentSegments=s.aB.simpleSegment(0,0,4,2);const d=new s.aN;d.emplaceBack(0,0),d.emplaceBack(s.V,0),d.emplaceBack(0,s.V),d.emplaceBack(s.V,s.V),this.debugBuffer=i.createVertexBuffer(d,s.aP.members),this.debugSegments=s.aB.simpleSegment(0,0,4,5);const m=new s.aN;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(m,s.aP.members),this.viewportSegments=s.aB.simpleSegment(0,0,4,2);const v=new s.av;v.emplaceBack(0,0,0,0),v.emplaceBack(s.V,0,s.V,0),v.emplaceBack(0,s.V,0,s.V),v.emplaceBack(s.V,s.V,s.V,s.V),this.mercatorBoundsBuffer=i.createVertexBuffer(v,s.aR.members),this.mercatorBoundsSegments=s.aB.simpleSegment(0,0,4,2);const b=new s.aw;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(b);const S=new s.aO;for(const H of[0,1,3,2,0])S.emplaceBack(H);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new s.T(i,new s.h({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=s.a6.create();const z=this.context.gl;this.stencilClearMode=new Ci({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,ci.disabled,this.stencilClearMode,Bi.disabled,Qn.disabled,J2(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,d){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!d||0===d.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const z of d)if(void 0===this._tileClippingMaskIDs[z.key]){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const m=this.context,v=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(Bi.disabled),m.setDepthMode(ci.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of d){const z=o.getTile(S),H=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:B,tileBoundsSegments:Y}=this.getTileBoundsBuffers(z);b.draw(this,v.TRIANGLES,ci.disabled,new Ci({func:v.ALWAYS,mask:0},H,255,v.KEEP,v.KEEP,v.REPLACE),Bi.disabled,Qn.disabled,J2(S.projMatrix),"$clipping",R,B,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new Ci({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new Ci({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,d=i.sort((b,S)=>S.overscaledZ-b.overscaledZ),m=d[d.length-1].overscaledZ,v=d[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const b={};for(let S=0;S<v;S++)b[S+m]=new Ci({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=v,[b,d]}return[{[m]:Ci.disabled},d]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Bi([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new s.ax(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Bi.unblended:Bi.alphaBlended}colorModeForDrapableLayerRenderPass(i){const o=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Bi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new s.ax(0,0,0,void 0===i?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,o,d,m=!1){if(!this.opaquePassEnabledForLayer()&&!m)return ci.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new ci(d||this.context.gl.LEQUAL,o,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this._wireframeDebugCache.update(this.frameCounter),this.style=i,this.options=o;const d=this.style._mergedLayers,m=this.style.order,v=m.map(ge=>d[ge]),b=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(s.f.now()),this.imageManager.beginFrame();let S=0,z=!1;for(const ge in b){const Ie=b[ge];Ie.used&&(Ie.prepare(this.context),Ie.getSource().usedInConflation&&++S)}for(const ge of v)ge.isHidden(this.transform.zoom)||this.prepareLayer(ge);const H={},R={},B={},Y={},Q={};for(const ge in b){const Ie=b[ge];H[ge]=Ie.getVisibleCoordinates(),R[ge]=H[ge].slice().reverse(),B[ge]=Ie.getVisibleCoordinates(!0).reverse(),Y[ge]=Ie.getShadowCasterCoordinates(),Q[ge]=Ie.sortCoordinatesByDistance(H[ge])}const le=ge=>{const Ie=this.style.getLayerSourceCache(ge);return Ie&&Ie.used?Ie.getSource():null};if(S){const ge=[];for(const Ie of v)this.layerUsedInConflation(Ie,le(Ie))&&ge.push(Ie);if(ge&&ge.length>1){const Ie=[];for(const Qe of ge){const nt=this.style.getLayerSourceCache(Qe);nt&&nt.used&&nt.getSource().usedInConflation&&Ie.push({layer:Qe.fqid,cache:nt})}this.replacementSource.setSources(Ie),z=!0}}z||this.replacementSource.clear(),this.conflationActive=z,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const ge of v){const Ie=ge.cutoffRange();if(this.longestCutoffRange=Math.max(Ie,this.longestCutoffRange),Ie>0){const Qe=le(ge);Qe&&(this.minCutoffZoom=Math.max(Qe.minzoom,this.minCutoffZoom)),ge.minzoom&&(this.minCutoffZoom=Math.max(ge.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let ge=0;ge<v.length;ge++)if(v[ge].is3D()){this.opaquePassCutoff=ge;break}const ce=this.style&&this.style.fog;ce?(this._fogVisible=0!==ce.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(B),this.opaquePassCutoff=0);const pe=this._shadowRenderer;if(pe){pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const ge in b)for(const Ie of H[ge]){let Qe={min:0,max:0};this.terrain&&(Qe=this.terrain.getMinMaxForTile(Ie)||Qe),pe.addShadowReceiver(Ie.toUnwrapped(),Qe.min,Qe.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new s.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new zi(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cZ(this.context.gl))return;this.renderPass="offscreen";for(const ge of v){const Ie=i.getLayerSourceCache(ge);if(!ge.hasOffscreenPass()||ge.isHidden(this.transform.zoom))continue;const Qe=Ie?R[Ie.id]:void 0;("custom"===ge.type||"raster"===ge.type||"raster-particle"===ge.type||ge.isSky()||Qe&&Qe.length)&&this.renderLayer(this,Ie,ge,Qe)}this.depthRangeFor3D=[0,1-(v.length+2)*this.numSublayers*this.depthEpsilon];const re=this.terrain;re&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&re.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ve="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),Le=(()=>{if(o.showOverdrawInspector)return s.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!ve){const ge=this.style.fog.properties.get("color").toArray01();return new s.ax(...ge)}if(this.style.fog&&this.transform.projection.supportsFog&&ve){const ge=this.style.fog.properties.get("space-color").toArray01();return new s.ax(...ge)}return s.ax.transparent})();if(this.context.clear({color:Le,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const ge=v[this.currentLayer],Ie=i.getLayerSourceCache(ge);if(ge.isSky())continue;const Qe=Ie?(ge.is3D()?Q:R)[Ie.id]:void 0;this._renderTileClippingMasks(ge,Ie,Qe),this.renderLayer(this,Ie,ge,Qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.S(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const ge=v[this.currentLayer],Ie=i.getLayerSourceCache(ge);ge.isSky()&&this.renderLayer(this,Ie,ge,Ie?R[Ie.id]:void 0)}function Ce(ge,Ie){let Qe;return Ie&&(Qe=("symbol"===ge.type?B:ge.is3D()?Q:R)[Ie.id]),Qe}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<m.length;){const ge=v[this.currentLayer];if("raster"===ge.type){const Ie=i.getLayerSourceCache(ge);this.renderLayer(this,Ie,ge,Ce(ge,Ie))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ze=0;for(pe&&(ze=pe.getShadowCastingLayerCount());this.currentLayer<m.length;){const ge=v[this.currentLayer],Ie=i.getLayerSourceCache(ge);if(ge.isSky())++this.currentLayer;else if(re&&this.style.isLayerDraped(ge)){if(ge.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=re.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(ge,Ie,Ie?H[Ie.id]:void 0),this.renderLayer(this,Ie,ge,Ce(ge,Ie)),!re&&pe&&ze>0&&ge.hasShadowPass()&&0==--ze&&(pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Qe;this.currentLayer++){const nt=v[this.currentLayer];if(!nt.hasLightBeamPass())continue;const dt=i.getLayerSourceCache(nt);this.renderLayer(this,dt,nt,dt?R[dt.id]:void 0)}this.currentLayer=Qe,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ge=null;v.forEach(Ie=>{const Qe=i.getLayerSourceCache(Ie);Qe&&!Ie.isHidden(this.transform.zoom)&&Qe.getVisibleCoordinates().length&&(!ge||ge.getSource().maxzoom<Qe.getSource().maxzoom)&&(ge=Qe)}),ge&&this.options.showTileBoundaries&&nl.debug(this,ge,ge.getVisibleCoordinates(),s.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&nl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ge){const Ie=ge.transform.padding;Li(ge,ge.transform.height-(Ie.top||0),3,$),Li(ge,Ie.bottom||0,3,oe),_i(ge,Ie.left||0,3,xe),_i(ge,ge.transform.width-(Ie.right||0),3,Oe);const Qe=ge.transform.centerPoint;var nt,dt,$t,Ct;or(nt=ge,(dt=Qe.x)-1,($t=ge.transform.height-Qe.y)-10,2,20,Ct=Ut),or(nt,dt-10,$t-1,20,2,Ct)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),z||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:o}=this.transform.projection,d=!o||!o.includes(i.type);if(V4[i.type]&&(d||this.terrain&&"custom"===i.type)){const m=this.style.getLayerSourceCache(i);V4[i.type](i,m,this)}this.gpuTimingEnd()}renderLayer(i,o,d,m){d.isHidden(this.transform.zoom)||("background"===d.type||"sky"===d.type||"custom"===d.type||"model"===d.type||"raster"===d.type||"raster-particle"===d.type||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(d.type)||i.terrain&&"custom"===d.type)&&nl[d.type](i,o,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,d=this.context.gl;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:d.createQuery()}),m.calls++,d.beginQuery(o.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=this.context.gl,d=o.createQuery();this.deferredRenderGpuTimeQueries.push(d),o.beginQuery(i.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const d in i){const m=i[d],v=this.context.extTimerQuery,b=v.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(m.query),o[d]=b}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery,d=this.context.gl;let m=0;for(const v of i)m+=o.getQueryParameter(v,d.QUERY_RESULT)/1e6,o.deleteQueryEXT(v);return m}translatePosMatrix(i,o,d,m,v){if(!d[0]&&!d[1])return i;const b=v?"map"===m?this.transform.angle:0:"viewport"===m?-this.transform.angle:0;if(b){const H=Math.sin(b),R=Math.cos(b);d=[d[0]*R-d[1]*H,d[0]*H+d[1]*R]}const S=[v?d[0]:s.a3(o,d[0],this.transform.zoom),v?d[1]:s.a3(o,d[1],this.transform.zoom),0],z=new Float32Array(16);return s.a6.translate(z,i,S),z}saveTileTexture(i){const o=i.size[0],d=this._tileTextures[o];d?d.push(i):this._tileTextures[o]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i,o){return null===i||void 0!==i&&!this.imageManager.getPattern(i.toString(),o)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(i,o,d){const m=void 0===d?this.terrain&&this.terrain.renderingToTexture:d,v=this.terrain&&0===this.terrain.exaggeration(),b=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===i||"terrainRaster"===i?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||b.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||b.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?b.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):b.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT"),v&&b.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&b.push("GLOBE"),!this._fogVisible||m||void 0!==o&&!o||b.push("FOG","FOG_DITHERING"),m&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(i,o){this.cache=this.cache||{};const d=o&&o.defines||[],m=o&&o.config,v=o&&o.transformFeedback,b=this.currentGlobalDefines(i,o&&o.overrideFog,o&&o.overrideRtt).concat(d),S=Q2.cacheKey(Zi[i],i,b,m);return this.cache[S]||(this.cache[S]=new Q2(this.context,i,Zi[i],m,Ia[i],b,v)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,o){if(this.style.enable3dLights()){const d=this.style.directionalLight,m=this.style.ambientLight;if(d&&m){const v=((b,S)=>{const z=b.properties.get("direction"),H=b.properties.get("color").toArray01(),R=b.properties.get("intensity"),B=S.properties.get("color").toArray01(),Y=S.properties.get("intensity"),Q=[z.x,z.y,z.z],le=s.cn(B,Y),ce=s.cn(H,R);return{u_lighting_ambient_color:le,u_lighting_directional_dir:Q,u_lighting_directional_color:ce,u_ground_radiance:x2(Q,ce,le)}})(d,m);o.setLightsUniformValues(i,v)}}}uploadCommonUniforms(i,o,d,m,v){if(this.uploadCommonLightUniforms(i,o),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const S=b.getOpacity(this.transform.pitch),z=((H,R,B,Y,Q,le,ce,pe,re,ve,Le,Ce)=>{const ze=H.transform,ge=R.properties.get("color").toArray01();ge[3]=Y;const Ie=H.frameCounter/1e3%1,[Qe,nt]=R.properties.get("vertical-range");return{u_fog_matrix:B?ze.calculateFogTileMatrix(B):Ce||H.identityMat,u_fog_range:R.getFovAdjustedRange(ze._fov),u_fog_color:ge,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Qe,nt),nt],u_fog_temporal_offset:Ie,u_frustum_tl:Q,u_frustum_tr:le,u_frustum_br:ce,u_frustum_bl:pe,u_globe_pos:re,u_globe_radius:ve,u_viewport:Le,u_globe_transition:s.S(ze.zoom),u_is_globe:+("globe"===ze.projection.name)}})(this,b,d,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.f.devicePixelRatio,this.transform.height*s.f.devicePixelRatio],m);o.setFogUniformValues(i,z)}v&&o.setCutoffUniformValues(i,v.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const m of d)o[m.key]=i[m.key]||new $s(m,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(i,o){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||"building"!==i.sourceLayer&&(!o||"batched-model"!==o.type))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let o=this._cachedTileFogOpacities[i.key];return o||(this._cachedTileFogOpacities[i.key]=o=this.style.fog.getOpacityForTile(i)),o[0]>=hr||o[1]>=hr}}function D3(h,i){let o=!1,d=null;const m=()=>{d=null,o&&(h(),d=setTimeout(m,i),o=!1)};return()=>(o=!0,d||m(),d)}class Hl{constructor(i){this._hashName=i&&encodeURIComponent(i),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=D3(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=Pl(i);if(this._hashName){const d=this._hashName;let m=!1;const v=location.hash.slice(1).split("&").map(b=>{const S=b.split("=")[0];return S===d?(m=!0,`${S}=${o}`):b}).filter(b=>b);return m||v.push(`${d}=${o}`),`#${v.join("&")}`}return`#${o}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(o=d)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(d=>isNaN(d))){const d=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Pl(h,i){const o=h.getCenter(),d=Math.round(100*h.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),b=Math.round(o.lng*v)/v,S=Math.round(o.lat*v)/v,z=h.getBearing(),H=h.getPitch();let R=i?`/${b}/${S}/${d}`:`${d}/${S}/${b}`;return(z||H)&&(R+="/"+Math.round(10*z)/10),H&&(R+=`/${Math.round(H)}`),R}const Nl={linearity:.3,easing:s.c_(0,0,.3,1)},q1=s.e({deceleration:2500,maxSpeed:1400},Nl),P4=s.e({deceleration:20,maxSpeed:1400},Nl),I3=s.e({deceleration:1e3,maxSpeed:360},Nl),go=s.e({deceleration:1e3,maxSpeed:90},Nl);class cs{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.f.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=s.f.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)o.zoom+=v.zoomDelta||0,o.bearing+=v.bearingDelta||0,o.pitch+=v.pitchDelta||0,v.panDelta&&o.pan._add(v.panDelta),v.around&&(o.around=v.around),v.pinchAround&&(o.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(o.pan.mag()){const v=R2(o.pan.mag(),d,s.e({},q1,i||{}));m.offset=o.pan.mult(v.amount/o.pan.mag()),m.center=this._map.transform.center,kl(m,v)}if(o.zoom){const v=R2(o.zoom,d,P4);m.zoom=this._map.transform.zoom+v.amount,kl(m,v)}if(o.bearing){const v=R2(o.bearing,d,I3);m.bearing=this._map.transform.bearing+s.aa(v.amount,-179,179),kl(m,v)}if(o.pitch){const v=R2(o.pitch,d,go);m.pitch=this._map.transform.pitch+v.amount,kl(m,v)}if(m.zoom||m.bearing){const v=void 0===o.pinchAround?o.around:o.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function kl(h,i){(!h.duration||h.duration<i.duration)&&(h.duration=i.duration,h.easing=i.easing)}function R2(h,i,o){const{maxSpeed:d,linearity:m,deceleration:v}=o,b=s.aa(h*m/(i/1e3),-d,d),S=Math.abs(b)/(v*m);return{easing:o.easing,duration:1e3*S,amount:b*(S/2)}}class Z1 extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,d,m={}){const v=hn(o.getCanvasContainer(),d),b=o.unproject(v);super(i,s.e({point:v,lngLat:b,originalEvent:d},m)),this._defaultPrevented=!1,this.target=o}}class bc extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,d){const m="touchend"===i?d.changedTouches:d.touches,v=Vn(o.getCanvasContainer(),m),b=v.map(z=>o.unproject(z)),S=v.reduce((z,H,R,B)=>z.add(H.div(B.length)),new s.P(0,0));super(i,{points:v,point:S,lngLats:b,lngLat:o.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class pu extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,d){super(i,{originalEvent:d}),this._defaultPrevented=!1}}class N4{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new pu(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Z1(i.type,this._map,i))}mouseup(i){this._map.fire(new Z1(i.type,this._map,i))}preclick(i){const o=s.e({},i);o.type="preclick",this._map.fire(new Z1(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Z1(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Z1(i.type,this._map,i))}mouseover(i){this._map.fire(new Z1(i.type,this._map,i))}mouseout(i){this._map.fire(new Z1(i.type,this._map,i))}touchstart(i){return this._firePreventable(new bc(i.type,this._map,i))}touchmove(i){this._map.fire(new bc(i.type,this._map,i))}touchend(i){this._map.fire(new bc(i.type,this._map,i))}touchcancel(i){this._map.fire(new bc(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class O2{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Z1(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Z1("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Z1(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class F2{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&0===i.button&&(Sn(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const d=o,m=this._startPos,v=this._lastPos;if(!m||!v||v.equals(d)||!this._box&&d.dist(m)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=gt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const b=Math.min(m.x,d.x),S=Math.max(m.x,d.x),z=Math.min(m.y,d.y),H=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${z}px)`,this._box.style.width=S-b+"px",this._box.style.height=H-z+"px")})}mouseupWindow(i,o){if(!this._active)return;const d=this._startPos,m=o;if(d&&0===i.button){if(this.reset(),ii(),d.x!==m.x||d.y!==m.y)return this._map.fire(new s.b("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),En(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new s.b(i,{originalEvent:o}))}}function kc(h,i){const o={};for(let d=0;d<h.length;d++)o[h[d].identifier]=i[d];return o}class il{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const v=new s.P(0,0);for(const b of m)v._add(b);return v.div(m.length)}(o),this.touches=kc(d,o)))}touchmove(i,o,d){if(this.aborted||!this.centroid)return;const m=kc(d,o);for(const v in this.touches){const b=m[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(i,o,d){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===d.length){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class rl{constructor(i){this.singleTap=new il(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,d){this.singleTap.touchstart(i,o,d)}touchmove(i,o,d){this.singleTap.touchmove(i,o,d)}touchend(i,o,d){const m=this.singleTap.touchend(i,o,d);if(m){const v=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(v&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class h2{constructor(){this._zoomIn=new rl({numTouches:1,numTaps:2}),this._zoomOut=new rl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,d){this._zoomIn.touchstart(i,o,d),this._zoomOut.touchstart(i,o,d)}touchmove(i,o,d){this._zoomIn.touchmove(i,o,d),this._zoomOut.touchmove(i,o,d)}touchend(i,o,d){const m=this._zoomIn.touchend(i,o,d),v=this._zoomOut.touchend(i,o,d);return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const k4={0:1,2:2};class B2{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const d=hi(i);this._correctButton(i,d)&&(this._lastPoint=o,this._eventButton=d)}mousemoveWindow(i,o){const d=this._lastPoint;if(d)if(i.preventDefault(),null!=this._eventButton&&function(m,v){const b=k4[v];return void 0===m.buttons||(m.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(d,o)}mouseupWindow(i){this._lastPoint&&hi(i)===this._eventButton&&(this._moved&&ii(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class R4 extends B2{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return 0===o&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class sl extends B2{_correctButton(i,o){return 0===o&&i.ctrlKey||2===o}_move(i,o){const d=.8*(o.x-i.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(i){i.preventDefault()}}class ol extends B2{_correctButton(i,o){return 0===o&&i.ctrlKey||2===o}_move(i,o){const d=-.5*(o.y-i.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(i){i.preventDefault()}}class O4{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(i,o,d){return this._calculateTransform(i,o,d)}touchmove(i,o,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===d.length&&!s.c$())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,d)}}touchend(i,o,d){this._calculateTransform(i,o,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,d){d.length>0&&(this._active=!0);const m=kc(d,o),v=new s.P(0,0),b=new s.P(0,0);let S=0;for(const H in m){const R=m[H],B=this._touches[H];B&&(v._add(R),b._add(R.sub(B)),S++,m[H]=R)}if(this._touches=m,S<this._minTouches||!b.mag())return;const z=b.div(S);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Pa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,d){return{}}touchstart(i,o,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,d){const m=this._firstTwoTouches;if(!m)return;i.preventDefault();const[v,b]=m,S=al(d,o,v),z=al(d,o,b);if(!S||!z)return;const H=this._aroundCenter?null:S.add(z).div(2);return this._move([S,z],H,i)}touchend(i,o,d){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,b=al(d,o,m),S=al(d,o,v);b&&S||(this._active&&ii(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function al(h,i,o){for(let d=0;d<h.length;d++)if(h[d].identifier===o)return i[d]}function Rl(h,i){return Math.log(h/i)/Math.LN2}class Ol extends Pa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const d=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Rl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rl(this._distance,d),pinchAround:o}}}function wc(h,i){return 180*h.angleWith(i)/Math.PI}class D1 extends Pa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const d=this._vector;if(this._vector=i[0].sub(i[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:wc(this._vector,d),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const m=wc(i,d);return Math.abs(m)<o}}function Cc(h){return Math.abs(h.y)>Math.abs(h.x)}class V3 extends Pa{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Cc(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,d){const m=this._lastPoints;if(!m)return;const v=i[0].sub(m[0]),b=i[1].sub(m[1]);return this._map._cooperativeGestures&&!s.c$()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,d.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(i,o,d){if(void 0!==this._valid)return this._valid;const m=i.mag()>=2,v=o.mag()>=2;if(!m&&!v)return;if(!m||!v)return null==this._firstMove&&(this._firstMove=d),d-this._firstMove<100&&void 0;const b=i.y>0==o.y>0;return Cc(i)&&Cc(o)&&b}}const nc={panStep:100,bearingStep:15,pitchStep:10};class Na{constructor(){const i=nc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,d=0,m=0,v=0,b=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?d=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?d=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),b=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:S=>{const z=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Mc,zoom:o?Math.round(z)+o*(i.shiftKey?2:1):z,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+m*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mc(h){return h*(2-h)}const cl=4.000244140625;class F4{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||s.c$()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const d=s.f.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,0!==o&&o%cl==0?this._type="wheel":0!==o&&Math.abs(o)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=hn(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;"wheel"===this._type&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const H="wheel"===this._type&&Math.abs(this._delta)>cl?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&0!==R&&(R=1/R);const B=o(),Y=Math.pow(2,B),Q="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):Y;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(Q*R))),"wheel"===this._type&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d="number"==typeof this._targetZoom?this._targetZoom:o(),m=this._startZoom,v=this._easing;let b,S=!1;if("wheel"===this._type&&m&&v){const H=Math.min((s.f.now()-this._lastWheelEventTime)/200,1),R=v(H);b=s.U(m,d,R),H<1?this._frameId||(this._frameId=!0):S=!0}else b=d,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let z=b-o();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=s.d0;if(this._prevEase){const d=this._prevEase,m=(s.f.now()-d.start)/d.duration,v=d.easing(m+.01)-d.easing(m),b=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-b*b);o=s.c_(b,S,.25,1)}return this._prevEase={start:s.f.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class B4{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class mu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(i.shiftKey?-1:1),around:d.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class U4{constructor(){this._tap=new rl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,d){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=o[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(i,o,d))}touchmove(i,o,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=o[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,o,d)}touchend(i,o,d){this._tapTime?this._swipePoint&&0===d.length&&this.reset():this._tap.touchend(i,o,d)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gu{constructor(i,o,d){this._el=i,this._mousePan=o,this._touchPan=d}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class j4{constructor(i,o,d){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _u{constructor(i,o,d,m){this._el=i,this._touchZoom=o,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ll=h=>h.zoom||h.drag||h.pitch||h.rotate;class P3 extends s.b{}class Fl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const d=s.N.sub([],o,i);this.radius=s.N.length(d[2]<0?s.N.div([],d,this.constants):[d[0],d[1],0])}projectRay(i){s.N.div(i,i,this.constants),s.N.normalize(i,i),s.N.mul(i,i,this.constants);const o=s.N.scale([],i,this.radius);if(o[2]>0){const d=s.N.scale([],[0,0,1],s.N.dot(o,[0,0,1])),m=s.N.scale([],s.N.normalize([],[o[0],o[1],0]),this.radius),v=s.N.add([],o,s.N.scale([],s.N.sub([],s.N.add([],m,d),o),2));o[0]=v[0],o[1]=v[1]}return o}}function Bl(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ul{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cs(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Fl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,b]of this._listeners){const S=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(v,S,b)}}destroy(){for(const[i,o,d]of this._listeners){const m=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(o,m,d)}}_addDefaultHandlers(i){const o=this._map,d=o.getCanvasContainer();this._add("mapEvent",new N4(o,i));const m=o.boxZoom=new F2(o,i);this._add("boxZoom",m);const v=new h2,b=new mu;o.doubleClickZoom=new B4(b,v),this._add("tapZoom",v),this._add("clickZoom",b);const S=new U4;this._add("tapDragZoom",S);const z=o.touchPitch=new V3(o);this._add("touchPitch",z);const H=new sl(i),R=new ol(i);o.dragRotate=new j4(i,H,R),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const B=new R4(i),Y=new O4(o,i);o.dragPan=new gu(d,B,Y),this._add("mousePan",B),this._add("touchPan",Y,["touchZoom","touchRotate"]);const Q=new D1,le=new Ol;o.touchZoomRotate=new _u(d,le,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new O2(o));const ce=o.scrollZoom=new F4(o,this);this._add("scrollZoom",ce,["mousePan"]);const pe=o.keyboard=new Na;this._add("keyboard",pe);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[re]&&o[re].enable(i[re])}_add(i,o,d){this._handlers.push({handlerName:i,handler:o,allowed:d}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ll(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,d){for(const m in i)if(m!==d&&(!o||o.indexOf(m)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const d of i)this._el.contains(d.target)&&o.push(d);return o}handleEvent(i,o){this._updatingCamera=!0;const d="renderFrame"===i.type,m=d?void 0:i,v={needsRenderFrame:!1},b={},S={},z=i.touches?this._getMapTouches(i.touches):void 0,H=z?Vn(this._el,z):d?void 0:hn(this._el,i);for(const{handlerName:Y,handler:Q,allowed:le}of this._handlers){if(!Q.isEnabled())continue;let ce;this._blockedByActive(S,le,Y)?Q.reset():Q[o||i.type]&&(ce=Q[o||i.type](i,H,z),this.mergeHandlerResult(v,b,ce,Y,m),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||Q.isActive())&&(S[Y]=Q)}const R={};for(const Y in this._previousActiveHandlers)S[Y]||(R[Y]=m);this._previousActiveHandlers=S,(Object.keys(R).length||Bl(v))&&(this._changes.push([v,b,R]),this._triggerRenderFrame()),(Object.keys(S).length||Bl(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=v;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(i,o,d,m,v){if(!d)return;s.e(i,d);const b={handlerName:m,originalEvent:d.originalEvent||v};void 0!==d.zoomDelta&&(o.zoom=b),void 0!==d.panDelta&&(o.drag=b),void 0!==d.pitchDelta&&(o.pitch=b),void 0!==d.bearingDelta&&(o.rotate=b)}_applyChanges(){const i={},o={},d={};for(const[m,v,b]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new s.P(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),void 0!==m.around&&(i.around=m.around),void 0!==m.aroundCoord&&(i.aroundCoord=m.aroundCoord),void 0!==m.pinchAround&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),s.e(o,v),s.e(d,b);this._updateMapTransform(i,o,d),this._changes=[]}_updateMapTransform(i,o,d){const m=this._map,v=m.transform,b=ve=>[ve.x,ve.y,ve.z];if((ve=>{const Le=this._eventsInProgress.drag;return Le&&!this._handlersById[Le.handlerName].isActive()})()&&!Bl(i)){const ve=v.zoom;v.cameraElevationReference="sea",null!=this._originalZoom&&v._orthographicProjectionAtLowPitch&&"globe"!==v.projection.name&&0===v.pitch?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ve!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&m._stop(!0),!Bl(i))return void this._fireEvents(o,d,!0);let{panDelta:S,zoomDelta:z,bearingDelta:H,pitchDelta:R,around:B,aroundCoord:Y,pinchAround:Q}=i;v._isCameraConstrained&&(z>0&&(z=0),v._isCameraConstrained=!1),void 0!==Q&&(B=Q),(z||(ve=>o.drag&&!this._eventsInProgress.drag)())&&B&&(this._dragOrigin=b(v.pointCoordinate3D(B)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",m._stop(!0),B=B||m.transform.centerPoint,H&&(v.bearing+=H),R&&(v.pitch+=R),v._updateCameraState();const le=[0,0,0];if(S)if("mercator"===v.projection.name){const ve=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(B).dir),Le=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(B.sub(S)).dir);le[0]=Le[0]-ve[0],le[1]=Le[1]-ve[1]}else{const ve=v.pointCoordinate(B);if("globe"===v.projection.name){S=S.rotate(-v.angle);const Le=v._pixelsPerMercatorPixel/v.worldSize;le[0]=-S.x*s.d1(s.au(ve.y))*Le,le[1]=-S.y*s.d1(v.center.lat)*Le}else{const Le=v.pointCoordinate(B.sub(S));ve&&Le&&(le[0]=Le.x-ve.x,le[1]=Le.y-ve.y)}}const ce=v.zoom,pe=[0,0,0];if(z){const ve=b(Y||v.pointCoordinate3D(B)),Le={dir:s.N.normalize([],s.N.sub([],ve,v._camera.position))};if(Le.dir[2]<0){const Ce=v.zoomDeltaToMovement(ve,z);s.N.scale(pe,Le.dir,Ce)}}const re=s.N.add(le,le,pe);v._translateCameraConstrained(re),z&&Math.abs(v.zoom-ce)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,d,!0)}_fireEvents(i,o,d){const m=ll(this._eventsInProgress),v=ll(i),b={};for(const R in i){const{originalEvent:B}=i[R];this._eventsInProgress[R]||(b[`${R}start`]=B),this._eventsInProgress[R]=i[R]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const R in b)this._fireEvent(R,b[R]);v&&this._fireEvent("move",v.originalEvent);for(const R in i){const{originalEvent:B}=i[R];this._fireEvent(R,B)}const S={};let z;for(const R in this._eventsInProgress){const{handlerName:B,originalEvent:Y}=this._eventsInProgress[R];this._handlersById[B].isActive()||(delete this._eventsInProgress[R],z=o[B]||Y,S[`${R}end`]=z)}for(const R in S)this._fireEvent(R,S[R]);const H=ll(this._eventsInProgress);if(d&&(m||v)&&!H){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=Y=>0!==Y&&-this._bearingSnap<Y&&Y<this._bearingSnap;R?(B(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:z})):(this._map.fire(new s.b("moveend",{originalEvent:z})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new s.b(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new P3("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const G4="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ro extends s.E{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=!1!==o.respectPrefersReducedMotion,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,d){return i=s.P.convert(i).mult(-1),this.panTo(this.transform.center,s.e({offset:i},o),d)}panTo(i,o,d){return this.easeTo(s.e({center:i},o),d)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,d){return this.easeTo(s.e({zoom:i},o),d)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,d){return this.easeTo(s.e({bearing:i},o),d)}resetNorth(i,o){return this.rotateTo(0,s.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=s.ad.convert(i);const d=o&&o.bearing||0,m=o&&o.pitch||0,v=i.getNorthWest(),b=i.getSouthEast();return this._cameraForBounds(this.transform,v,b,d,m,o)}_extendCameraOptions(i){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=s.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const d=i.padding;i.padding={top:d,bottom:d,right:d,left:d}}return i.padding=s.e(o,i.padding),i}_minimumAABBFrustumDistance(i,o){const d=o.max[0]-o.min[0],m=o.max[1]-o.min[1];return d/m>i.aspect?d/(2*Math.tan(.5*i.fovX)*i.aspect):m/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,d,m,v,b){const S=i.clone(),z=this._extendCameraOptions(b);S.bearing=m,S.pitch=v;const H=s.bn.convert(o),R=s.bn.convert(d),B=.5*(H.lat+R.lat),Y=.5*(H.lng+R.lng),Q=s.d2(B,Y),le=s.N.normalize([],Q),ce=s.N.normalize([],s.N.cross([],le,[0,1,0])),pe=s.N.cross([],ce,le),re=[ce[0],ce[1],ce[2],0,pe[0],pe[1],pe[2],0,le[0],le[1],le[2],0,0,0,0,1],ve=[Q,s.d2(H.lat,H.lng),s.d2(R.lat,H.lng),s.d2(R.lat,R.lng),s.d2(H.lat,R.lng),s.d2(B,H.lng),s.d2(B,R.lng),s.d2(H.lat,Y),s.d2(R.lat,Y)];let Le=s.bS.fromPoints(ve.map(Nt=>[s.N.dot(ce,Nt),s.N.dot(pe,Nt),s.N.dot(le,Nt)]));const Ce=s.N.transformMat4([],Le.center,re);0===s.N.squaredLength(Ce)&&s.N.set(Ce,0,0,1),s.N.normalize(Ce,Ce),s.N.scale(Ce,Ce,s.ab),S.center=s.d3(Ce);const ze=S.getWorldToCameraMatrix(),ge=s.a6.invert(new Float64Array(16),ze);Le=s.bS.applyTransform(Le,s.a6.multiply([],ze,re)),s.N.transformMat4(Ce,Ce,ze);const Ie=.5*(Le.max[2]-Le.min[2]),Qe=this._minimumAABBFrustumDistance(S,Le),nt=s.N.scale([],[0,0,1],Ie),dt=s.N.add(nt,Ce,nt),$t=Qe+(0===S.pitch?0:s.N.distance(Ce,dt)),Ct=S.globeCenterInViewSpace,en=s.N.sub([],Ce,[Ct[0],Ct[1],Ct[2]]);s.N.normalize(en,en),s.N.scale(en,en,$t);const Jt=s.N.add([],Ce,en);s.N.transformMat4(Jt,Jt,ge);const xn=s.d4/s.ab,Lt=s.N.length(Jt),Zt=s.bl(Math.max(Lt*xn-s.d4,Number.EPSILON),0),ut=Math.min(S.zoomFromMercatorZAdjusted(Zt),z.maxZoom);return ut>.5*(s.bG+s.bx)?(S.setProjection({name:"mercator"}),S.zoom=ut,this._cameraForBounds(S,o,d,m,v,b)):{center:S.center,zoom:ut,bearing:m,pitch:v}}queryTerrainElevation(i,o){const d=this.transform.elevation;return d?(o=s.e({},{exaggerated:!0},o),d.getAtPoint(s.L.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,d,m,v,b){if("globe"===i.projection.name)return this._cameraForBoundsOnGlobe(i,o,d,m,v,b);const S=i.clone(),z=this._extendCameraOptions(b),H=S.padding;S.bearing=m,S.pitch=v;const R=s.bn.convert(o),B=s.bn.convert(d),Y=new s.bn(R.lng,B.lat),Q=new s.bn(B.lng,R.lat),le=S.project(R),ce=S.project(B),pe=this.queryTerrainElevation(R),re=this.queryTerrainElevation(B),ve=this.queryTerrainElevation(Y),Le=this.queryTerrainElevation(Q),Ce=[[le.x,le.y,Math.min(pe||0,re||0,ve||0,Le||0)],[ce.x,ce.y,Math.max(pe||0,re||0,ve||0,Le||0)]];let ze=s.bS.fromPoints(Ce);const ge=S.getWorldToCameraMatrix(),Ie=s.a6.invert(new Float64Array(16),ge);ze=s.bS.applyTransform(ze,ge);const Qe=s.N.sub([],ze.max,ze.min),nt=H.left||0,dt=H.right||0,$t=H.bottom||0,Ct=H.top||0,{left:en,right:Jt,top:xn,bottom:Lt}=z.padding,Zt=.5*(nt+dt),ut=.5*(Ct+$t),Nt=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(nt+dt+en+Jt))/Qe[0],(S.height-($t+Ct+Lt+xn))/Qe[1])),z.maxZoom),Cn=S.scale/S.zoomScale(Nt);ze=new s.bS([ze.min[0]-(en+Zt)*Cn,ze.min[1]-(Lt+ut)*Cn,ze.min[2]],[ze.max[0]+(Jt+Zt)*Cn,ze.max[1]+(xn+ut)*Cn,ze.max[2]]);const Un=.5*Qe[2],kn=this._minimumAABBFrustumDistance(S,ze),Yn=[0,0,1,0];s.a7.transformMat4(Yn,Yn,ge),s.a7.normalize(Yn,Yn);const di=s.N.scale([],Yn,kn+Un),Ai=s.N.add([],ze.center,di),xi=("number"==typeof z.offset.x&&"number"==typeof z.offset.y?new s.P(z.offset.x,z.offset.y):s.P.convert(z.offset)).rotate(-s.bj(m));ze.center[0]-=xi.x*Cn,ze.center[1]+=xi.y*Cn,s.N.transformMat4(ze.center,ze.center,Ie),s.N.transformMat4(Ai,Ai,Ie);const bi=[ze.center[0],ze.center[1],Ai[2]*S.pixelsPerMeter];s.N.scale(bi,bi,1/S.worldSize);const ur=s.at(bi[0]),ar=s.au(bi[1]),yr=Math.min(S._zoomFromMercatorZ(bi[2]),z.maxZoom),mr=new s.bn(ur,ar);return S.mercatorFromTransition&&yr<.5*(s.bG+s.bx)?(S.setProjection({name:"globe"}),S.zoom=yr,this._cameraForBounds(S,o,d,m,v,b)):{center:mr,zoom:yr,bearing:m,pitch:v}}fitBounds(i,o,d){const m=this.cameraForBounds(i,o);return this._fitInternal(m,o,d)}fitScreenCoordinates(i,o,d,m,v){const b=s.P.convert(i),S=s.P.convert(o),z=new s.P(Math.min(b.x,S.x),Math.min(b.y,S.y)),H=new s.P(Math.max(b.x,S.x),Math.max(b.y,S.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(b,S))return this;const R=this.transform.pointLocation3D(z),B=this.transform.pointLocation3D(H),Y=this.transform.pointLocation3D(new s.P(z.x,H.y)),Q=this.transform.pointLocation3D(new s.P(H.x,z.y)),le=[Math.min(R.lng,B.lng,Y.lng,Q.lng),Math.min(R.lat,B.lat,Y.lat,Q.lat)],ce=[Math.max(R.lng,B.lng,Y.lng,Q.lng),Math.max(R.lat,B.lat,Y.lat,Q.lat)],pe=m&&m.pitch?m.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,le,ce,d,pe,m);return this._fitInternal(re,m,v)}_fitInternal(i,o,d){return i?(delete(o=s.e(i,o)).padding,o.linear?this.easeTo(o,d):this.flyTo(o,d)):this}jumpTo(i,o){this.stop();const d=i.preloadOnly?this.transform.clone():this.transform;let m=!1,v=!1,b=!1;return"zoom"in i&&d.zoom!==+i.zoom&&(m=!0,d.zoom=+i.zoom),void 0!==i.center&&(d.center=s.bn.convert(i.center)),"bearing"in i&&d.bearing!==+i.bearing&&(v=!0,d.bearing=+i.bearing),"pitch"in i&&d.pitch!==+i.pitch&&(b=!0,d.pitch=+i.pitch),null==i.padding||d.isPaddingEqual(i.padding)||(d.padding=i.padding),i.preloadOnly?(this._preloadTiles(d),this):(this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),m&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),v&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),b&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(G4),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const d=this.transform;if(!d.projection.supportsFreeCamera)return s.w(G4),this;this.stop();const m=d.zoom,v=d.pitch,b=d.bearing;d.setFreeCameraOptions(i);const S=m!==d.zoom,z=v!==d.pitch,H=b!==d.bearing;return this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),S&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),H&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),z&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),(!1===(i=s.e({offset:[0,0],duration:500,easing:s.d0},i)).animate||this._prefersReducedMotion(i))&&(i.duration=0);const d=this.transform,m=this.getZoom(),v=this.getBearing(),b=this.getPitch(),S=this.getPadding(),z="zoom"in i?+i.zoom:m,H="bearing"in i?this._normalizeBearing(i.bearing,v):v,R="pitch"in i?+i.pitch:b,B="padding"in i?i.padding:d.padding,Y=s.P.convert(i.offset);let Q,le,ce;if("globe"===d.projection.name){const nt=s.L.fromLngLat(d.center),dt=Y.rotate(-d.angle);nt.x+=dt.x/d.worldSize,nt.y+=dt.y/d.worldSize;const $t=nt.toLngLat(),Ct=s.bn.convert(i.center||$t);this._normalizeCenter(Ct),Q=d.centerPoint.add(dt),le=new s.P(nt.x,nt.y).mult(d.worldSize),ce=new s.P(s.a5(Ct.lng),s.ae(Ct.lat)).mult(d.worldSize).sub(le)}else{Q=d.centerPoint.add(Y);const nt=d.pointLocation(Q),dt=s.bn.convert(i.center||nt);this._normalizeCenter(dt),le=d.project(nt),ce=d.project(dt).sub(le)}const pe=d.zoomScale(z-m);let re,ve;i.around&&(re=s.bn.convert(i.around),ve=d.locationPoint(re));const Le=this._zooming||z!==m,Ce=this._rotating||v!==H,ze=this._pitching||R!==b,ge=!d.isPaddingEqual(B),Ie=nt=>dt=>{if(Le&&(nt.zoom=s.U(m,z,dt)),Ce&&(nt.bearing=s.U(v,H,dt)),ze&&(nt.pitch=s.U(b,R,dt)),ge&&(nt.interpolatePadding(S,B,dt),Q=nt.centerPoint.add(Y)),re)nt.setLocationAtPoint(re,ve);else{const $t=nt.zoomScale(nt.zoom-m),Ct=z>m?Math.min(2,pe):Math.max(.5,pe),en=Math.pow(Ct,1-dt),Jt=nt.unproject(le.add(ce.mult(dt*en)).mult($t));nt.setLocationAtPoint(nt.renderWorldCopies?Jt.wrap():Jt,Q)}return i.preloadOnly||this._fireMoveEvents(o),nt};if(i.preloadOnly){const nt=this._emulate(Ie,i.duration,d);return this._preloadTiles(nt),this}const Qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Le,this._rotating=Ce,this._pitching=ze,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,Qe),this._ease(Ie(d),nt=>{"sea"===d.cameraElevationReference&&d.recenterOnTerrain(),this._afterEase(o,nt)},i),this}_prepareEase(i,o,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),o||d.moving||this.fire(new s.b("movestart",i)),this._zooming&&!d.zooming&&this.fire(new s.b("zoomstart",i)),this._rotating&&!d.rotating&&this.fire(new s.b("rotatestart",i)),this._pitching&&!d.pitching&&this.fire(new s.b("pitchstart",i))}_fireMoveEvents(i){this.fire(new s.b("move",i)),this._zooming&&this.fire(new s.b("zoom",i)),this._rotating&&this.fire(new s.b("rotate",i)),this._pitching&&this.fire(new s.b("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,d&&this.fire(new s.b("zoomend",i)),m&&this.fire(new s.b("rotateend",i)),v&&this.fire(new s.b("pitchend",i)),this.fire(new s.b("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const Lt=s.ac(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,o)}this.stop(),i=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.d0},i);const d=this.transform,m=this.getZoom(),v=this.getBearing(),b=this.getPitch(),S="zoom"in i?s.aa(+i.zoom,d.minZoom,d.maxZoom):m,z="bearing"in i?this._normalizeBearing(i.bearing,v):v,H="pitch"in i?+i.pitch:b,R=d.zoomScale(S-m),B=s.P.convert(i.offset),Y=d.centerPoint.add(B),Q=d.pointLocation(Y);let le=i.center;if(le&&i.padding){const Lt=this._cameraForBounds(this.transform,le,le,z,H,i);Lt&&(le=Lt.center)}le=s.bn.convert(le||Q),this._normalizeCenter(le);const ce=d.project(Q),pe=d.project(le).sub(ce);let re=i.curve;const ve=Math.max(d.width,d.height),Le=ve/R,Ce=pe.mag();if("minZoom"in i){const Lt=s.aa(Math.min(i.minZoom,m,S),d.minZoom,d.maxZoom),Zt=ve/d.zoomScale(Lt-m);re=Math.sqrt(Zt/Ce*2)}const ze=re*re;function ge(Lt){const Zt=(Le*Le-ve*ve+(Lt?-1:1)*ze*ze*Ce*Ce)/(2*(Lt?Le:ve)*ze*Ce);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function Ie(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function Qe(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const nt=ge(0);let dt=function(Lt){return Qe(nt)/Qe(nt+re*Lt)},$t=function(Lt){return ve*((Qe(nt)*(Ie(Zt=nt+re*Lt)/Qe(Zt))-Ie(nt))/ze)/Ce;var Zt},Ct=(ge(1)-nt)/re;if(Math.abs(Ce)<1e-6||!isFinite(Ct)){if(Math.abs(ve-Le)<1e-6)return this.easeTo(i,o);const Lt=Le<ve?-1:1;Ct=Math.abs(Math.log(Le/ve))/re,$t=function(){return 0},dt=function(Zt){return Math.exp(Lt*re*Zt)}}i.duration="duration"in i?+i.duration:1e3*Ct/("screenSpeed"in i?+i.screenSpeed/re:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const en=v!==z,Jt=H!==b,xn=Lt=>Zt=>{const ut=Zt*Ct,Nt=1/dt(ut);Lt.zoom=1===Zt?S:m+Lt.scaleZoom(Nt),en&&(Lt.bearing=s.U(v,z,Zt)),Jt&&(Lt.pitch=s.U(b,H,Zt));const Cn=1===Zt?le:Lt.unproject(ce.add(pe.mult($t(ut))).mult(Nt));return Lt.setLocationAtPoint(Lt.renderWorldCopies?Cn.wrap():Cn,Y),Lt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),Lt};if(i.preloadOnly){const Lt=this._emulate(xn,i.duration,d);return this._preloadTiles(Lt),this}return this._zooming=!0,this._rotating=en,this._pitching=Jt,this._prepareEase(o,!1),this._ease(xn(d),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,o)}if(!i){const d=this.handlers;d&&d.stop(!1)}return this}_ease(i,o,d){!1===d.animate||0===d.duration?(i(1),o()):(this._easeStart=s.f.now(),this._easeOptions=d,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((s.f.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=s.bh(i,-180,180);const d=Math.abs(i-o);return Math.abs(i-360-o)<d&&(i-=360),Math.abs(i+360-o)<d&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(o.maxBounds||"globe"!==o.projection.name&&!o.renderWorldCopies)return;const d=i.lng-o.center.lng;i.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&s.f.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,d){const m=Math.ceil(15*o/1e3),v=[],b=i(d.clone());for(let S=0;S<=m;S++){const z=b(S/m);v.push(z.clone())}return v}}class ul{constructor(i={}){this.options=i,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=gt("button","mapboxgl-ctrl-attrib-button",this._container),gt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gt("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===o&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const d=this._map._getUIString(`AttributionControl.${o}`);i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.d5.ACCESS_TOKEN}];if(i){const d=o.reduce((m,v,b)=>(v.value&&(m+=`${v.key}=${v.value}${b<o.length-1?"&":""}`),m),"?");i.href=`${s.d5.FEEDBACK_URL}/${d}#${Pl(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const o=this._map.style._mergedSourceCaches;for(const m in o){const v=o[m];if(v.used){const b=v.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort((m,v)=>m.length-v.length),i=i.filter((m,v)=>{for(let b=v+1;b<i.length;b++)if(i[b].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const d=i.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,i.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class N3{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=gt("div","mapboxgl-ctrl");const o=gt("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const o in i){const d=i[o].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class k3{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,d=o?this._queue.concat(o):this._queue;for(const m of d)if(m.id===i)return void(m.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const d of o)if(!d.cancelled&&(d.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function U2(h,i,o){if(h=new s.bn(h.lng,h.lat),i){const d=new s.bn(h.lng-360,h.lat),m=new s.bn(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-o.center.lng)/360),b=o.locationPoint(h).distSqr(i),S=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(d).distSqr(i)<b&&(S||Math.abs(d.lng-o.center.lng)<v)?h=d:o.locationPoint(m).distSqr(i)<b&&(S||Math.abs(m.lng-o.center.lng)<v)&&(h=m)}for(;Math.abs(h.lng-o.center.lng)>180;){const d=o.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=o.width&&d.y<=o.height)break;h.lng>o.center.lng?h.lng-=360:h.lng+=360}return h}const hl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class R3 extends s.E{constructor(i,o){if(super(),(i instanceof HTMLElement||o)&&(i=s.e({element:i},o)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=s.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=gt("div");const v=41,b=27,S=jt("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),z=jt("radialGradient",{id:"shadowGradient"},jt("defs",{},S));jt("stop",{offset:"10%","stop-opacity":.4},z),jt("stop",{offset:"100%","stop-opacity":.05},z),jt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),jt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),jt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),jt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=s.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const d=this._element.classList;for(const v in hl)d.remove(`mapboxgl-marker-anchor-${v}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);const m=i&&i.className?i.className.trim().split(/\s+/):[];d.add(...m),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=s.bn.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,d=i.charCode||i.keyCode;"Space"!==o&&"Enter"!==o&&32!==d&&13!==d||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,d=this._element;this._popup&&(o===d||d.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const d=i.unproject(o),m=i.getFreeCameraOptions();if(!m.position)return!1;const v=m.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const d=i.unproject(o);let m;i._showingGlobe()&&s.d6(i.transform,this._lngLat)?m=0:(m=1-i._queryFogOpacity(d),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${i.x}px,${i.y}px)\n            ${hl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${o.x}px,${o.y}px)\n        `}_calculateXYTransform(){const i=this._pos,o=this._map,d=this.getPitchAlignment();if(!o||!i||"map"!==d)return"";if(!o._showingGlobe()){const z=o.getPitch();return z?`rotateX(${z}deg)`:""}const m=s.bF(s.d7(o.transform,this._lngLat)),v=i.sub(s.d8(o.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(0===b)return"";const S=m/b;return`rotateX(${-v.y*S}deg) rotateY(${v.x*S}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let d=0;const m=this.getRotationAlignment();if("map"===m)if(o._showingGlobe()){const v=o.project(new s.bn(this._lngLat.lng,this._lngLat.lat+.001)),b=o.project(new s.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);d=s.bF(Math.atan2(b.y,b.x))-90}else d=-o.getBearing();else if("horizon"===m){const v=s.O(4,6,o.getZoom()),b=s.d8(o.transform);b.y+=v*o.transform.height;const S=i.sub(b),z=s.bF(Math.atan2(S.y,S.x));d=(z>90?z-270:z+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=U2(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),!0===i?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=s.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const o=this._map;if(!o)return;const d=this._pointerdownPos,m=this._positionDelta;if(d&&m){if(!this._isDragging){const v=this._clickTolerance||o._clickTolerance;if(i.point.dist(d)<v)return;this._isDragging=!0}this._pos=i.point.sub(m),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new s.b("dragstart"))),this.fire(new s.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new s.b("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,d=this._pos;o&&d&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(d),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const vu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},O3=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yu(h=new s.P(0,0),i="bottom"){if("number"==typeof h){const o=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(i){case"top":return new s.P(0,h);case"top-left":return new s.P(o,o);case"top-right":return new s.P(-o,o);case"bottom":return new s.P(0,-h);case"bottom-left":return new s.P(o,-o);case"bottom-right":return new s.P(-o,-o);case"left":return new s.P(h,0);case"right":return new s.P(-h,0)}return new s.P(0,0)}return h instanceof s.P||Array.isArray(h)?s.P.convert(h):s.P.convert(h[i]||[0,0])}class $4{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=s.cc((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,d){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+d}}const jl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},xu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class W4{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Gl={showCompass:!0,showZoom:!0,visualizePitch:!1};class j2{constructor(i,o,d=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new sl({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,d&&(this.mousePitch=new ol({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),Sn()}move(i,o){const d=this.map,m=this.mouseRotate.mousemoveWindow(i,o),v=m&&m.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){const b=this.mousePitch.mousemoveWindow(i,o),S=b&&b.pitchDelta;S&&d.setPitch(d.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){En(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(s.e({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),hn(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,hn(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=Vn(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=Vn(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},M1={maxWidth:100,unit:"metric"},w2={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.dk,supported:de,setRTLTextPlugin:s.dm,getRTLTextPluginStatus:s.dn,Map:class extends Ro{constructor(h){const i=h;if(null!=(h=s.e({},xu,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&s.d9(window)&&(h.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new qa(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!1,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new k3,this._domRenderTaskQueue=new k3,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aC(),this._locale=s.e({},jl,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new $4(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.da(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?{...h.contextCreateOptions}:{},"string"==typeof h.container){const o=document.getElementById(h.container);if(!o)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=o}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new W4,this._tp=h.devtools?new tc(this):new tc,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,o=>{this.repaint=o}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,o=>{this.showTileAABBs=o}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,o=>{this.showPadding=o}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ul(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||s.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new Hl("string"==typeof h.hash&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const o=h.bounds;o&&(this.resize(),this.fitBounds(o,s.e({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new ul({customAttribution:h.customAttribution})),this._logoControl=new N3,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new s.b(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.b(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(h,i){if(void 0===i&&(i=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[i];return-1!==i.indexOf("bottom")?d.insertBefore(o,d.firstChild):d.appendChild(o),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(h);return i>-1&&this._controls.splice(i,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new s.b("movestart",h)).fire(new s.b("move",h)),this.fire(new s.b("resize",h)),i&&this.fire(new s.b("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(s.ad.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return"auto"===h?navigator.language:Array.isArray(h)?0===h.length?void 0:h.map(i=>"auto"===i?navigator.language:i):h}setLanguage(h){const i=this._parseLanguage(h);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(h){return this._lazyInitEmptyStyle(),h?"string"==typeof h&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const h=this.transform,i=h.projection.name;let o;"globe"===i&&h.zoom>=s.bx?(h.setMercatorFromTransition(),o=!0):"mercator"===i&&h.zoom<s.bx&&(h.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,i){return this._updateProjection(h||i||{name:"mercator"})}_updateProjection(h){let i;return i="globe"===h.name&&this.transform.zoom>=s.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(s.bn.convert(h))}unproject(h){return this.transform.pointLocation3D(s.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,i,o){if("mouseenter"===h||"mouseover"===h){let d=!1;const m=b=>{const S=i.filter(H=>this.getLayer(H)),z=S.length?this.queryRenderedFeatures(b.point,{layers:S}):[];z.length?d||(d=!0,o.call(this,new Z1(h,this,b.originalEvent,{features:z}))):d=!1},v=()=>{d=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:m,mouseout:v}}}if("mouseleave"===h||"mouseout"===h){let d=!1;const m=b=>{const S=i.filter(z=>this.getLayer(z));(S.length?this.queryRenderedFeatures(b.point,{layers:S}):[]).length?d=!0:d&&(d=!1,o.call(this,new Z1(h,this,b.originalEvent)))},v=b=>{d&&(d=!1,o.call(this,new Z1(h,this,b.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:m,mouseout:v}}}{const d=m=>{const v=i.filter(S=>this.getLayer(S)),b=v.length?this.queryRenderedFeatures(m.point,{layers:v}):[];b.length&&(m.features=b,o.call(this,m),delete m.features)};return{layers:new Set(i),listener:o,delegates:{[h]:d}}}}on(h,i,o){if(void 0===o)return super.on(h,i);if(Array.isArray(i)||(i=[i]),i)for(const m of i)if(!this._isValidId(m))return this;const d=this._createDelegatedListener(h,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(h,i,o){if(void 0===o)return super.once(h,i);if(Array.isArray(i)||(i=[i]),i)for(const m of i)if(!this._isValidId(m))return this;const d=this._createDelegatedListener(h,i,o);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(h,i,o){if(void 0===o)return super.off(h,i);i=new Set(Array.isArray(i)?i:[i]);for(const v of i)if(!this._isValidId(v))return this;const d=(v,b)=>{if(v.size!==b.size)return!1;for(const S of v)if(!b.has(S))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[h]:void 0;return m&&(v=>{for(let b=0;b<v.length;b++){const S=v[b];if(S.listener===o&&d(S.layers,i)){for(const z in S.delegates)this.off(z,S.delegates[z]);return v.splice(b,1),this}}})(m),this}queryRenderedFeatures(h,i){if(!this.style)return[];if(void 0!==i||void 0===h||h instanceof s.P||Array.isArray(h)||(i=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers))for(const o of i.layers)if(!this._isValidId(o))return[];return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(h,i){return this._isValidId(h)?this.style.querySourceFeatures(h,i):[]}isPointOnSurface(h){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&s.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(h))}setStyle(h,i){return!1!==(i=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(h,i))}_getUIString(h){const i=this._locale[h];if(null==i)throw new Error(`Missing UI string '${h}'`);return i}_updateStyle(h,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new u1(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new u1(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,i){if("string"==typeof h){const o=this._requestManager.normalizeStyleURL(h),d=this._requestManager.transformRequest(o,s.R.Style);s.g(d,(m,v)=>{m?this.fire(new s.a(m)):v&&this._updateDiff(v,i)})}else"object"==typeof h&&this._updateDiff(h,i)}_updateDiff(h,i){try{this.style.setState(h)&&this._update(!0)}catch(o){s.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(h,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(h){return null==h?(this.fire(new s.a(new Error("IDs can't be empty."))),!1):!s.c4(h)||(this.fire(new s.a(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}addSource(h,i){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,i),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(h,i,o)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,i,{pixelRatio:o=1,sdf:d=!1,stretchX:m,stretchY:v,content:b}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:S,height:z,data:H}=s.f.getImageData(i);this.style.addImage(h,{data:new s.h({width:S,height:z},H),pixelRatio:o,stretchX:m,stretchY:v,content:b,sdf:d,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new s.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:z}=i,H=i;this.style.addImage(h,{data:new s.h({width:S,height:z},new Uint8Array(H.data)),pixelRatio:o,stretchX:m,stretchY:v,content:b,sdf:d,version:0,userImage:H}),H.onAdd&&H.onAdd(this,h)}}updateImage(h,i){this._lazyInitEmptyStyle();const o=this.style.getImage(h);if(!o)return void this.fire(new s.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?s.f.getImageData(i):i,{width:m,height:v}=d,b=d.data;if(void 0===m||void 0===v)return void this.fire(new s.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==o.data.width||v!==o.data.height)return void this.fire(new s.a(new Error(`The width and height of the updated image (${m}, ${v})\n                must be that same as the previous version of the image\n                (${o.data.width}, ${o.data.height})`)));const S=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);o.data.replace(b,S),this.style.updateImage(h,o)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new s.a(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,i){s.d(this._requestManager.transformRequest(h,s.R.Image),(o,d)=>{i(o,d instanceof HTMLImageElement?s.f.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(h,i){this._lazyInitEmptyStyle(),this.style.addModel(h,i)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new s.a(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,i){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,i),this._update(!0)):this}getSlot(h){const i=this.getLayer(h);return i&&i.slot||null}setSlot(h,i){return this.style.setSlot(h,i),this.style.mergeLayers(),this._update(!0)}addImport(h,i){return this.style.addImport(h,i),this}updateImport(h,i){return"string"!=typeof i&&i.id!==h?(this.removeImport(h),this.addImport(i)):(this.style.updateImport(h,i),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,i){return this.style.moveImport(h,i),this._update(!0)}moveLayer(h,i){return this._isValidId(h)?(this.style.moveLayer(h,i),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){return this._isValidId(h)?this.style.getOwnLayer(h):null}setLayerZoomRange(h,i,o){return this._isValidId(h)?(this.style.setLayerZoomRange(h,i,o),this._update(!0)):this}setFilter(h,i,o={}){return this._isValidId(h)?(this.style.setFilter(h,i,o),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,i,o,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,i,o,d),this._update(!0)):this}getPaintProperty(h,i){return this._isValidId(h)?this.style.getPaintProperty(h,i):null}setLayoutProperty(h,i,o,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,i,o,d),this._update(!0)):this}getLayoutProperty(h,i){return this._isValidId(h)?this.style.getLayoutProperty(h,i):null}getConfigProperty(h,i){return this.style.getConfigProperty(h,i)}setConfigProperty(h,i,o){return this.style.setConfigProperty(h,i,o),this._update(!0)}setLights(h){if(this._lazyInitEmptyStyle(),h&&1===h.length&&"flat"===h[0].type){const i=h[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return 0===h.length&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===h["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bn.convert(h),this.transform):0}setFeatureState(h,i){return this._isValidId(h.source)?(this.style.setFeatureState(h,i),this._update()):this}removeFeatureState(h,i){return this._isValidId(h.source)?(this.style.removeFeatureState(h,i),this._update()):this}getFeatureState(h){return this._isValidId(h.source)?this.style.getFeatureState(h):null}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,d,m,v=this._container;for(;v&&(!d||!m);){const b=window.getComputedStyle(v).transform;b&&"none"!==b&&(o=b.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&"0"!==o[0]&&"1"!==o[0]&&(d=o[0]),o[3]&&"0"!==o[3]&&"1"!==o[3]&&(m=o[3])),v=v.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=m?Math.abs(i/m):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=gt("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=gt("div","mapboxgl-canvas-container",h);this._canvas=gt("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=gt("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{d[m]=gt("div",`mapboxgl-ctrl-${m}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,i){const o=s.f.devicePixelRatio||1;this._canvas.width=o*Math.ceil(h),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${i}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const i=this._markers.indexOf(h);-1!==i&&this._markers.splice(i,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const i=this._popups.indexOf(h);-1!==i&&this._popups.splice(i,1)}_setupPainter(){const h=s.e({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",h);i?(s.db(i,!0),this.painter=new H4(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",o=>{"source"===o.dataType&&this.painter.setTileLoadedFlag(!0)}),s.dc.testSupport(i)):this.fire(new s.a(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.b("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new s.b("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let i;this.fire(new s.b("renderstart"));const o=this.painter.context.extTimerQuery,d=s.f.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=m.createQuery(),m.beginQuery(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,H=this.transform.pitch,R=s.f.now(),B=new s.K(z,{now:R,fadeDuration:v,pitch:H,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const z=s.f.now()-d;m.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const H=m.getQueryParameter(i,m.QUERY_RESULT)/1e6;m.deleteQuery(i),this.fire(new s.b("gpu-timing-frame",{cpuTime:z,gpuTime:H}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(z);this.fire(new s.b("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(z);this.fire(new s.b("gpu-timing-deferred-render",{gpuTime:H}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(S||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(b=this._updateAverageElevation(d,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new s.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new s.b("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const i of this._markers)h&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!h||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(h,i=!1){const o=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&o(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(i||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=h;const b=Math.abs(m-v);if(b>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(v),o(v);this._averageElevation.easeTo(v,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),o(v)}return!!this._averageElevation.isEasing(h)&&o(this._averageElevation.getValue(h))}_authenticate(){s.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===s.df||401===h.status)){const i=this.painter.context.gl;s.db(i,!1),this._logoControl instanceof N3&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,d=o.createFramebuffer();function m(v){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v,0);const b=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,b),b}return o.bindFramebuffer(o.FRAMEBUFFER,d),this._canvasPixelComparison(m(h),i.canvasCopies.map(m),i.timeStamps)}_canvasPixelComparison(h,i,o){let d=o[1]-o[0];const m=h.length/4;for(let v=0;v<i.length;v++){const b=i[v];let S=0;for(let z=0;z<b.length;z+=4)b[z]===h[z]&&b[z+1]===h[z+1]&&b[z+2]===h[z+2]&&b[z+3]===h[z+3]&&(S+=1);d+=(o[v+2]-o[v+1])*(1-S/m)}return d}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.dh(this.painter.context.gl),s.di.remove(),s.dj.remove(),this._removed=!0,this.fire(new s.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=s.f.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(h){const i=this.style?Object.values(this.style._sourceCaches):[];return s.b1(i,(o,d)=>o._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,i){s.dl(h,i)}get version(){return s.dk}},NavigationControl:class{constructor(h){this.options=s.e({},Gl,h),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),gt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),gt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=gt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const i=h.getZoom(),o=i===h.getMaxZoom(),d=i===h.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new j2(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,i){const o=gt("button",h,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(h,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);h.setAttribute("aria-label",o),h.firstElementChild&&h.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.E{constructor(h){super();const i=navigator.geolocation;this.options=s.e({geolocation:i},Rc,h),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=D3(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,h(o)};void 0!==this._supportsGeolocation?h(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(o=>i("denied"!==o.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(h){const i=this._map.getMaxBounds(),o=h.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.b("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("geolocate",h)),this._finish()}}_updateCamera(h){const i=new s.bn(h.coords.longitude,h.coords.latitude),o=h.coords.accuracy,d=this._map.getBearing(),m=s.e({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),m,{geolocateSource:!0})}_updateMarker(h){if(h){const i=new s.bn(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,i=s.bl(1,h._center.lat)*h.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=gt("button","mapboxgl-ctrl-geolocate",this._container),gt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===h){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gt("div","mapboxgl-user-location"),this._dotElement.appendChild(gt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(gt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new R3({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=gt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new R3({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.b("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ul,ScaleControl:class{constructor(h){this.options=s.e({},M1,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,d=i._containerWidth/2-h/2,m=i.unproject([d,o]),v=i.unproject([d+h,o]),b=m.distanceTo(v);if("imperial"===this.options.unit){const S=3.2808*b;S>5280?this._setScale(h,S/5280,"mile"):this._setScale(h,S,"foot")}else"nautical"===this.options.unit?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,i,o){this._map._requestDomTask(()=>{const d=function(v){const b=Math.pow(10,`${Math.floor(v)}`.length-1);let S=v/b;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(z){const H=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*H)/H}(S),b*S}(i),m=d/i;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==o?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(d):`${d}&nbsp;${w2[o]}`,this._container.style.width=h*m+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=gt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);gt("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(h){super(),this.options=s.e(Object.create(vu),h),s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new s.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new s.b("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=s.bn.convert(h),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const i=document.createDocumentFragment(),o=document.createElement("body");let d;for(o.innerHTML=h;d=o.firstChild,d;)i.appendChild(d);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=gt("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(h),this.options.closeButton){const o=this._closeButton=gt("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let i;return this._classList.delete(h)?i=!1:(this._classList.add(h),i=!0),this._updateClassList(),i}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,d=this._pos;if(!i||!o||!d)return"bottom";const m=o.offsetWidth,v=o.offsetHeight,b=d.x<m/2,S=d.x>i.transform.width-m/2;if(d.y+h<v)return b?"top-left":S?"top-right":"top";if(d.y>i.transform.height-v){if(b)return"bottom-left";if(S)return"bottom-right"}return b?"left":S?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),h.className=i.join(" ")}_update(h){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let d=this._container;if(d||(d=this._container=gt("div","mapboxgl-popup",i.getContainer()),this._tip=gt("div","mapboxgl-popup-tip",d),d.appendChild(o)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=U2(this._lngLat,this._pos,i.transform)),!this._trackPointer||h){const m=this._pos=this._trackPointer&&h?h:i.project(this._lngLat),v=yu(this.options.offset),b=this._anchor=this._getAnchor(v.y),S=yu(this.options.offset,b),z=m.add(S).round();i._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${hl[b]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&i._showingGlobe()){const m=s.d6(i.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(O3);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:R3,Style:u1,LngLat:s.bn,LngLatBounds:s.ad,Point:s.P,MercatorCoordinate:s.L,FreeCameraOptions:Wa,Evented:s.E,config:s.d5,prewarm:s.dp,clearPrewarmedResources:s.dq,get accessToken(){return s.d5.ACCESS_TOKEN},set accessToken(h){s.d5.ACCESS_TOKEN=h},get baseApiUrl(){return s.d5.API_URL},set baseApiUrl(h){s.d5.API_URL=h},get workerCount(){return s.dr.workerCount},set workerCount(h){s.dr.workerCount=h},get maxParallelImageRequests(){return s.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){s.d5.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){s.ds(h)},get workerUrl(){return s.dt.workerUrl},set workerUrl(h){s.dt.workerUrl=h},get workerClass(){return s.dt.workerClass},set workerClass(h){s.dt.workerClass=h},get workerParams(){return s.dt.workerParams},set workerParams(h){s.dt.workerParams=h},get dracoUrl(){return s.du()},set dracoUrl(h){s.dv(h)},get meshoptUrl(){return s.dw()},set meshoptUrl(h){s.dx(h)},setNow:s.f.setNow,restoreNow:s.f.restoreNow}}),C}()},1135:(yi,on,ue)=>{"use strict";ue.d(on,{X:()=>De});var C=ue(7579);class De extends C.x{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){const ct=super._subscribe(s);return!ct.closed&&s.next(this._value),ct}getValue(){const{hasError:s,thrownError:ct,_value:de}=this;if(s)throw ct;return this._throwIfClosed(),de}next(s){super.next(this._value=s)}}},9751:(yi,on,ue)=>{"use strict";ue.d(on,{y:()=>qt});var C=ue(930),De=ue(727),Xe=ue(8822),s=ue(9635),ct=ue(2416),de=ue(576),Et=ue(2806);let qt=(()=>{class Gt{constructor(Sn){Sn&&(this._subscribe=Sn)}lift(Sn){const En=new Gt;return En.source=this,En.operator=Sn,En}subscribe(Sn,En,dn){const ii=function wt(Gt){return Gt&&Gt instanceof C.Lv||function jt(Gt){return Gt&&(0,de.m)(Gt.next)&&(0,de.m)(Gt.error)&&(0,de.m)(Gt.complete)}(Gt)&&(0,De.Nn)(Gt)}(Sn)?Sn:new C.Hp(Sn,En,dn);return(0,Et.x)(()=>{const{operator:hn,source:Vn}=this;ii.add(hn?hn.call(ii,Vn):Vn?this._subscribe(ii):this._trySubscribe(ii))}),ii}_trySubscribe(Sn){try{return this._subscribe(Sn)}catch(En){Sn.error(En)}}forEach(Sn,En){return new(En=gt(En))((dn,ii)=>{const hn=new C.Hp({next:Vn=>{try{Sn(Vn)}catch(hi){ii(hi),hn.unsubscribe()}},error:ii,complete:dn});this.subscribe(hn)})}_subscribe(Sn){var En;return null===(En=this.source)||void 0===En?void 0:En.subscribe(Sn)}[Xe.L](){return this}pipe(...Sn){return(0,s.U)(Sn)(this)}toPromise(Sn){return new(Sn=gt(Sn))((En,dn)=>{let ii;this.subscribe(hn=>ii=hn,hn=>dn(hn),()=>En(ii))})}}return Gt.create=Kn=>new Gt(Kn),Gt})();function gt(Gt){var Kn;return null!==(Kn=Gt??ct.v.Promise)&&void 0!==Kn?Kn:Promise}},7579:(yi,on,ue)=>{"use strict";ue.d(on,{x:()=>Et});var C=ue(9751),De=ue(727);const s=(0,ue(3888).d)(gt=>function(){gt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ct=ue(8737),de=ue(2806);let Et=(()=>{class gt extends C.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(wt){const Gt=new qt(this,this);return Gt.operator=wt,Gt}_throwIfClosed(){if(this.closed)throw new s}next(wt){(0,de.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Gt of this.currentObservers)Gt.next(wt)}})}error(wt){(0,de.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=wt;const{observers:Gt}=this;for(;Gt.length;)Gt.shift().error(wt)}})}complete(){(0,de.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:wt}=this;for(;wt.length;)wt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var wt;return(null===(wt=this.observers)||void 0===wt?void 0:wt.length)>0}_trySubscribe(wt){return this._throwIfClosed(),super._trySubscribe(wt)}_subscribe(wt){return this._throwIfClosed(),this._checkFinalizedStatuses(wt),this._innerSubscribe(wt)}_innerSubscribe(wt){const{hasError:Gt,isStopped:Kn,observers:Sn}=this;return Gt||Kn?De.Lc:(this.currentObservers=null,Sn.push(wt),new De.w0(()=>{this.currentObservers=null,(0,ct.P)(Sn,wt)}))}_checkFinalizedStatuses(wt){const{hasError:Gt,thrownError:Kn,isStopped:Sn}=this;Gt?wt.error(Kn):Sn&&wt.complete()}asObservable(){const wt=new C.y;return wt.source=this,wt}}return gt.create=(jt,wt)=>new qt(jt,wt),gt})();class qt extends Et{constructor(jt,wt){super(),this.destination=jt,this.source=wt}next(jt){var wt,Gt;null===(Gt=null===(wt=this.destination)||void 0===wt?void 0:wt.next)||void 0===Gt||Gt.call(wt,jt)}error(jt){var wt,Gt;null===(Gt=null===(wt=this.destination)||void 0===wt?void 0:wt.error)||void 0===Gt||Gt.call(wt,jt)}complete(){var jt,wt;null===(wt=null===(jt=this.destination)||void 0===jt?void 0:jt.complete)||void 0===wt||wt.call(jt)}_subscribe(jt){var wt,Gt;return null!==(Gt=null===(wt=this.source)||void 0===wt?void 0:wt.subscribe(jt))&&void 0!==Gt?Gt:De.Lc}}},930:(yi,on,ue)=>{"use strict";ue.d(on,{Hp:()=>dn,Lv:()=>Gt});var C=ue(576),De=ue(727),Xe=ue(2416),s=ue(7849),ct=ue(5032);const de=gt("C",void 0,void 0);function gt(Te,_t,Ue){return{kind:Te,value:_t,error:Ue}}var jt=ue(3410),wt=ue(2806);class Gt extends De.w0{constructor(_t){super(),this.isStopped=!1,_t?(this.destination=_t,(0,De.Nn)(_t)&&_t.add(this)):this.destination=hi}static create(_t,Ue,Ye){return new dn(_t,Ue,Ye)}next(_t){this.isStopped?Vn(function qt(Te){return gt("N",Te,void 0)}(_t),this):this._next(_t)}error(_t){this.isStopped?Vn(function Et(Te){return gt("E",void 0,Te)}(_t),this):(this.isStopped=!0,this._error(_t))}complete(){this.isStopped?Vn(de,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(_t){this.destination.next(_t)}_error(_t){try{this.destination.error(_t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Kn=Function.prototype.bind;function Sn(Te,_t){return Kn.call(Te,_t)}class En{constructor(_t){this.partialObserver=_t}next(_t){const{partialObserver:Ue}=this;if(Ue.next)try{Ue.next(_t)}catch(Ye){ii(Ye)}}error(_t){const{partialObserver:Ue}=this;if(Ue.error)try{Ue.error(_t)}catch(Ye){ii(Ye)}else ii(_t)}complete(){const{partialObserver:_t}=this;if(_t.complete)try{_t.complete()}catch(Ue){ii(Ue)}}}class dn extends Gt{constructor(_t,Ue,Ye){let Pt;if(super(),(0,C.m)(_t)||!_t)Pt={next:_t??void 0,error:Ue??void 0,complete:Ye??void 0};else{let je;this&&Xe.v.useDeprecatedNextContext?(je=Object.create(_t),je.unsubscribe=()=>this.unsubscribe(),Pt={next:_t.next&&Sn(_t.next,je),error:_t.error&&Sn(_t.error,je),complete:_t.complete&&Sn(_t.complete,je)}):Pt=_t}this.destination=new En(Pt)}}function ii(Te){Xe.v.useDeprecatedSynchronousErrorHandling?(0,wt.O)(Te):(0,s.h)(Te)}function Vn(Te,_t){const{onStoppedNotification:Ue}=Xe.v;Ue&&jt.z.setTimeout(()=>Ue(Te,_t))}const hi={closed:!0,next:ct.Z,error:function hn(Te){throw Te},complete:ct.Z}},727:(yi,on,ue)=>{"use strict";ue.d(on,{Lc:()=>de,w0:()=>ct,Nn:()=>Et});var C=ue(576);const Xe=(0,ue(3888).d)(gt=>function(wt){gt(this),this.message=wt?`${wt.length} errors occurred during unsubscription:\n${wt.map((Gt,Kn)=>`${Kn+1}) ${Gt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=wt});var s=ue(8737);class ct{constructor(jt){this.initialTeardown=jt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let jt;if(!this.closed){this.closed=!0;const{_parentage:wt}=this;if(wt)if(this._parentage=null,Array.isArray(wt))for(const Sn of wt)Sn.remove(this);else wt.remove(this);const{initialTeardown:Gt}=this;if((0,C.m)(Gt))try{Gt()}catch(Sn){jt=Sn instanceof Xe?Sn.errors:[Sn]}const{_finalizers:Kn}=this;if(Kn){this._finalizers=null;for(const Sn of Kn)try{qt(Sn)}catch(En){jt=jt??[],En instanceof Xe?jt=[...jt,...En.errors]:jt.push(En)}}if(jt)throw new Xe(jt)}}add(jt){var wt;if(jt&&jt!==this)if(this.closed)qt(jt);else{if(jt instanceof ct){if(jt.closed||jt._hasParent(this))return;jt._addParent(this)}(this._finalizers=null!==(wt=this._finalizers)&&void 0!==wt?wt:[]).push(jt)}}_hasParent(jt){const{_parentage:wt}=this;return wt===jt||Array.isArray(wt)&&wt.includes(jt)}_addParent(jt){const{_parentage:wt}=this;this._parentage=Array.isArray(wt)?(wt.push(jt),wt):wt?[wt,jt]:jt}_removeParent(jt){const{_parentage:wt}=this;wt===jt?this._parentage=null:Array.isArray(wt)&&(0,s.P)(wt,jt)}remove(jt){const{_finalizers:wt}=this;wt&&(0,s.P)(wt,jt),jt instanceof ct&&jt._removeParent(this)}}ct.EMPTY=(()=>{const gt=new ct;return gt.closed=!0,gt})();const de=ct.EMPTY;function Et(gt){return gt instanceof ct||gt&&"closed"in gt&&(0,C.m)(gt.remove)&&(0,C.m)(gt.add)&&(0,C.m)(gt.unsubscribe)}function qt(gt){(0,C.m)(gt)?gt():gt.unsubscribe()}},2416:(yi,on,ue)=>{"use strict";ue.d(on,{v:()=>C});const C={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},7272:(yi,on,ue)=>{"use strict";ue.d(on,{z:()=>ct});var C=ue(8189),Xe=ue(3269),s=ue(2076);function ct(...de){return function De(){return(0,C.J)(1)}()((0,s.D)(de,(0,Xe.yG)(de)))}},515:(yi,on,ue)=>{"use strict";ue.d(on,{E:()=>De});const De=new(ue(9751).y)(ct=>ct.complete())},2076:(yi,on,ue)=>{"use strict";ue.d(on,{D:()=>Ye});var C=ue(8421),De=ue(9672),Xe=ue(4482),s=ue(5403);function ct(Pt,je=0){return(0,Xe.e)((Ze,ot)=>{Ze.subscribe((0,s.x)(ot,pt=>(0,De.f)(ot,Pt,()=>ot.next(pt),je),()=>(0,De.f)(ot,Pt,()=>ot.complete(),je),pt=>(0,De.f)(ot,Pt,()=>ot.error(pt),je)))})}function de(Pt,je=0){return(0,Xe.e)((Ze,ot)=>{ot.add(Pt.schedule(()=>Ze.subscribe(ot),je))})}var gt=ue(9751),wt=ue(2202),Gt=ue(576);function Sn(Pt,je){if(!Pt)throw new Error("Iterable cannot be null");return new gt.y(Ze=>{(0,De.f)(Ze,je,()=>{const ot=Pt[Symbol.asyncIterator]();(0,De.f)(Ze,je,()=>{ot.next().then(pt=>{pt.done?Ze.complete():Ze.next(pt.value)})},0,!0)})})}var En=ue(3670),dn=ue(8239),ii=ue(1144),hn=ue(6495),Vn=ue(2206),hi=ue(4532),Te=ue(3260);function Ye(Pt,je){return je?function Ue(Pt,je){if(null!=Pt){if((0,En.c)(Pt))return function Et(Pt,je){return(0,C.Xf)(Pt).pipe(de(je),ct(je))}(Pt,je);if((0,ii.z)(Pt))return function jt(Pt,je){return new gt.y(Ze=>{let ot=0;return je.schedule(function(){ot===Pt.length?Ze.complete():(Ze.next(Pt[ot++]),Ze.closed||this.schedule())})})}(Pt,je);if((0,dn.t)(Pt))return function qt(Pt,je){return(0,C.Xf)(Pt).pipe(de(je),ct(je))}(Pt,je);if((0,Vn.D)(Pt))return Sn(Pt,je);if((0,hn.T)(Pt))return function Kn(Pt,je){return new gt.y(Ze=>{let ot;return(0,De.f)(Ze,je,()=>{ot=Pt[wt.h](),(0,De.f)(Ze,je,()=>{let pt,Ot;try{({value:pt,done:Ot}=ot.next())}catch(Xt){return void Ze.error(Xt)}Ot?Ze.complete():Ze.next(pt)},0,!0)}),()=>(0,Gt.m)(ot?.return)&&ot.return()})}(Pt,je);if((0,Te.L)(Pt))return function _t(Pt,je){return Sn((0,Te.Q)(Pt),je)}(Pt,je)}throw(0,hi.z)(Pt)}(Pt,je):(0,C.Xf)(Pt)}},8421:(yi,on,ue)=>{"use strict";ue.d(on,{Xf:()=>Kn});var C=ue(7582),De=ue(1144),Xe=ue(8239),s=ue(9751),ct=ue(3670),de=ue(2206),Et=ue(4532),qt=ue(6495),gt=ue(3260),jt=ue(576),wt=ue(7849),Gt=ue(8822);function Kn(Te){if(Te instanceof s.y)return Te;if(null!=Te){if((0,ct.c)(Te))return function Sn(Te){return new s.y(_t=>{const Ue=Te[Gt.L]();if((0,jt.m)(Ue.subscribe))return Ue.subscribe(_t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Te);if((0,De.z)(Te))return function En(Te){return new s.y(_t=>{for(let Ue=0;Ue<Te.length&&!_t.closed;Ue++)_t.next(Te[Ue]);_t.complete()})}(Te);if((0,Xe.t)(Te))return function dn(Te){return new s.y(_t=>{Te.then(Ue=>{_t.closed||(_t.next(Ue),_t.complete())},Ue=>_t.error(Ue)).then(null,wt.h)})}(Te);if((0,de.D)(Te))return hn(Te);if((0,qt.T)(Te))return function ii(Te){return new s.y(_t=>{for(const Ue of Te)if(_t.next(Ue),_t.closed)return;_t.complete()})}(Te);if((0,gt.L)(Te))return function Vn(Te){return hn((0,gt.Q)(Te))}(Te)}throw(0,Et.z)(Te)}function hn(Te){return new s.y(_t=>{(function hi(Te,_t){var Ue,Ye,Pt,je;return(0,C.mG)(this,void 0,void 0,function*(){try{for(Ue=(0,C.KL)(Te);!(Ye=yield Ue.next()).done;)if(_t.next(Ye.value),_t.closed)return}catch(Ze){Pt={error:Ze}}finally{try{Ye&&!Ye.done&&(je=Ue.return)&&(yield je.call(Ue))}finally{if(Pt)throw Pt.error}}_t.complete()})})(Te,_t).catch(Ue=>_t.error(Ue))})}},6451:(yi,on,ue)=>{"use strict";ue.d(on,{T:()=>de});var C=ue(8189),De=ue(8421),Xe=ue(515),s=ue(3269),ct=ue(2076);function de(...Et){const qt=(0,s.yG)(Et),gt=(0,s._6)(Et,1/0),jt=Et;return jt.length?1===jt.length?(0,De.Xf)(jt[0]):(0,C.J)(gt)((0,ct.D)(jt,qt)):Xe.E}},9646:(yi,on,ue)=>{"use strict";ue.d(on,{of:()=>Xe});var C=ue(3269),De=ue(2076);function Xe(...s){const ct=(0,C.yG)(s);return(0,De.D)(s,ct)}},2843:(yi,on,ue)=>{"use strict";ue.d(on,{_:()=>Xe});var C=ue(9751),De=ue(576);function Xe(s,ct){const de=(0,De.m)(s)?s:()=>s,Et=qt=>qt.error(de());return new C.y(ct?qt=>ct.schedule(Et,0,qt):Et)}},5403:(yi,on,ue)=>{"use strict";ue.d(on,{x:()=>De});var C=ue(930);function De(s,ct,de,Et,qt){return new Xe(s,ct,de,Et,qt)}class Xe extends C.Lv{constructor(ct,de,Et,qt,gt,jt){super(ct),this.onFinalize=gt,this.shouldUnsubscribe=jt,this._next=de?function(wt){try{de(wt)}catch(Gt){ct.error(Gt)}}:super._next,this._error=qt?function(wt){try{qt(wt)}catch(Gt){ct.error(Gt)}finally{this.unsubscribe()}}:super._error,this._complete=Et?function(){try{Et()}catch(wt){ct.error(wt)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ct;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:de}=this;super.unsubscribe(),!de&&(null===(ct=this.onFinalize)||void 0===ct||ct.call(this))}}}},262:(yi,on,ue)=>{"use strict";ue.d(on,{K:()=>s});var C=ue(8421),De=ue(5403),Xe=ue(4482);function s(ct){return(0,Xe.e)((de,Et)=>{let jt,qt=null,gt=!1;qt=de.subscribe((0,De.x)(Et,void 0,void 0,wt=>{jt=(0,C.Xf)(ct(wt,s(ct)(de))),qt?(qt.unsubscribe(),qt=null,jt.subscribe(Et)):gt=!0})),gt&&(qt.unsubscribe(),qt=null,jt.subscribe(Et))})}},4351:(yi,on,ue)=>{"use strict";ue.d(on,{b:()=>Xe});var C=ue(5577),De=ue(576);function Xe(s,ct){return(0,De.m)(ct)?(0,C.z)(s,ct,1):(0,C.z)(s,1)}},8372:(yi,on,ue)=>{"use strict";ue.d(on,{b:()=>s});var C=ue(4986),De=ue(4482),Xe=ue(5403);function s(ct,de=C.z){return(0,De.e)((Et,qt)=>{let gt=null,jt=null,wt=null;const Gt=()=>{if(gt){gt.unsubscribe(),gt=null;const Sn=jt;jt=null,qt.next(Sn)}};function Kn(){const Sn=wt+ct,En=de.now();if(En<Sn)return gt=this.schedule(void 0,Sn-En),void qt.add(gt);Gt()}Et.subscribe((0,Xe.x)(qt,Sn=>{jt=Sn,wt=de.now(),gt||(gt=de.schedule(Kn,ct),qt.add(gt))},()=>{Gt(),qt.complete()},void 0,()=>{jt=gt=null}))})}},9300:(yi,on,ue)=>{"use strict";ue.d(on,{h:()=>Xe});var C=ue(4482),De=ue(5403);function Xe(s,ct){return(0,C.e)((de,Et)=>{let qt=0;de.subscribe((0,De.x)(Et,gt=>s.call(ct,gt,qt++)&&Et.next(gt)))})}},8746:(yi,on,ue)=>{"use strict";ue.d(on,{x:()=>De});var C=ue(4482);function De(Xe){return(0,C.e)((s,ct)=>{try{s.subscribe(ct)}finally{ct.add(Xe)}})}},4004:(yi,on,ue)=>{"use strict";ue.d(on,{U:()=>Xe});var C=ue(4482),De=ue(5403);function Xe(s,ct){return(0,C.e)((de,Et)=>{let qt=0;de.subscribe((0,De.x)(Et,gt=>{Et.next(s.call(ct,gt,qt++))}))})}},9718:(yi,on,ue)=>{"use strict";ue.d(on,{h:()=>De});var C=ue(4004);function De(Xe){return(0,C.U)(()=>Xe)}},8189:(yi,on,ue)=>{"use strict";ue.d(on,{J:()=>Xe});var C=ue(5577),De=ue(4671);function Xe(s=1/0){return(0,C.z)(De.y,s)}},5577:(yi,on,ue)=>{"use strict";ue.d(on,{z:()=>qt});var C=ue(4004),De=ue(8421),Xe=ue(4482),s=ue(9672),ct=ue(5403),Et=ue(576);function qt(gt,jt,wt=1/0){return(0,Et.m)(jt)?qt((Gt,Kn)=>(0,C.U)((Sn,En)=>jt(Gt,Sn,Kn,En))((0,De.Xf)(gt(Gt,Kn))),wt):("number"==typeof jt&&(wt=jt),(0,Xe.e)((Gt,Kn)=>function de(gt,jt,wt,Gt,Kn,Sn,En,dn){const ii=[];let hn=0,Vn=0,hi=!1;const Te=()=>{hi&&!ii.length&&!hn&&jt.complete()},_t=Ye=>hn<Gt?Ue(Ye):ii.push(Ye),Ue=Ye=>{Sn&&jt.next(Ye),hn++;let Pt=!1;(0,De.Xf)(wt(Ye,Vn++)).subscribe((0,ct.x)(jt,je=>{Kn?.(je),Sn?_t(je):jt.next(je)},()=>{Pt=!0},void 0,()=>{if(Pt)try{for(hn--;ii.length&&hn<Gt;){const je=ii.shift();En?(0,s.f)(jt,En,()=>Ue(je)):Ue(je)}Te()}catch(je){jt.error(je)}}))};return gt.subscribe((0,ct.x)(jt,_t,()=>{hi=!0,Te()})),()=>{dn?.()}}(Gt,Kn,gt,wt)))}},8675:(yi,on,ue)=>{"use strict";ue.d(on,{O:()=>s});var C=ue(7272),De=ue(3269),Xe=ue(4482);function s(...ct){const de=(0,De.yG)(ct);return(0,Xe.e)((Et,qt)=>{(de?(0,C.z)(ct,Et,de):(0,C.z)(ct,Et)).subscribe(qt)})}},3900:(yi,on,ue)=>{"use strict";ue.d(on,{w:()=>s});var C=ue(8421),De=ue(4482),Xe=ue(5403);function s(ct,de){return(0,De.e)((Et,qt)=>{let gt=null,jt=0,wt=!1;const Gt=()=>wt&&!gt&&qt.complete();Et.subscribe((0,Xe.x)(qt,Kn=>{gt?.unsubscribe();let Sn=0;const En=jt++;(0,C.Xf)(ct(Kn,En)).subscribe(gt=(0,Xe.x)(qt,dn=>qt.next(de?de(Kn,dn,En,Sn++):dn),()=>{gt=null,Gt()}))},()=>{wt=!0,Gt()}))})}},5698:(yi,on,ue)=>{"use strict";ue.d(on,{q:()=>s});var C=ue(515),De=ue(4482),Xe=ue(5403);function s(ct){return ct<=0?()=>C.E:(0,De.e)((de,Et)=>{let qt=0;de.subscribe((0,Xe.x)(Et,gt=>{++qt<=ct&&(Et.next(gt),ct<=qt&&Et.complete())}))})}},2722:(yi,on,ue)=>{"use strict";ue.d(on,{R:()=>ct});var C=ue(4482),De=ue(5403),Xe=ue(8421),s=ue(5032);function ct(de){return(0,C.e)((Et,qt)=>{(0,Xe.Xf)(de).subscribe((0,De.x)(qt,()=>qt.complete(),s.Z)),!qt.closed&&Et.subscribe(qt)})}},8505:(yi,on,ue)=>{"use strict";ue.d(on,{b:()=>ct});var C=ue(576),De=ue(4482),Xe=ue(5403),s=ue(4671);function ct(de,Et,qt){const gt=(0,C.m)(de)||Et||qt?{next:de,error:Et,complete:qt}:de;return gt?(0,De.e)((jt,wt)=>{var Gt;null===(Gt=gt.subscribe)||void 0===Gt||Gt.call(gt);let Kn=!0;jt.subscribe((0,Xe.x)(wt,Sn=>{var En;null===(En=gt.next)||void 0===En||En.call(gt,Sn),wt.next(Sn)},()=>{var Sn;Kn=!1,null===(Sn=gt.complete)||void 0===Sn||Sn.call(gt),wt.complete()},Sn=>{var En;Kn=!1,null===(En=gt.error)||void 0===En||En.call(gt,Sn),wt.error(Sn)},()=>{var Sn,En;Kn&&(null===(Sn=gt.unsubscribe)||void 0===Sn||Sn.call(gt)),null===(En=gt.finalize)||void 0===En||En.call(gt)}))}):s.y}},4408:(yi,on,ue)=>{"use strict";ue.d(on,{o:()=>ct});var C=ue(727);class De extends C.w0{constructor(Et,qt){super()}schedule(Et,qt=0){return this}}const Xe={setInterval(de,Et,...qt){const{delegate:gt}=Xe;return gt?.setInterval?gt.setInterval(de,Et,...qt):setInterval(de,Et,...qt)},clearInterval(de){const{delegate:Et}=Xe;return(Et?.clearInterval||clearInterval)(de)},delegate:void 0};var s=ue(8737);class ct extends De{constructor(Et,qt){super(Et,qt),this.scheduler=Et,this.work=qt,this.pending=!1}schedule(Et,qt=0){var gt;if(this.closed)return this;this.state=Et;const jt=this.id,wt=this.scheduler;return null!=jt&&(this.id=this.recycleAsyncId(wt,jt,qt)),this.pending=!0,this.delay=qt,this.id=null!==(gt=this.id)&&void 0!==gt?gt:this.requestAsyncId(wt,this.id,qt),this}requestAsyncId(Et,qt,gt=0){return Xe.setInterval(Et.flush.bind(Et,this),gt)}recycleAsyncId(Et,qt,gt=0){if(null!=gt&&this.delay===gt&&!1===this.pending)return qt;null!=qt&&Xe.clearInterval(qt)}execute(Et,qt){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const gt=this._execute(Et,qt);if(gt)return gt;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Et,qt){let jt,gt=!1;try{this.work(Et)}catch(wt){gt=!0,jt=wt||new Error("Scheduled action threw falsy error")}if(gt)return this.unsubscribe(),jt}unsubscribe(){if(!this.closed){const{id:Et,scheduler:qt}=this,{actions:gt}=qt;this.work=this.state=this.scheduler=null,this.pending=!1,(0,s.P)(gt,this),null!=Et&&(this.id=this.recycleAsyncId(qt,Et,null)),this.delay=null,super.unsubscribe()}}}},7565:(yi,on,ue)=>{"use strict";ue.d(on,{v:()=>Xe});var C=ue(6063);class De{constructor(ct,de=De.now){this.schedulerActionCtor=ct,this.now=de}schedule(ct,de=0,Et){return new this.schedulerActionCtor(this,ct).schedule(Et,de)}}De.now=C.l.now;class Xe extends De{constructor(ct,de=De.now){super(ct,de),this.actions=[],this._active=!1}flush(ct){const{actions:de}=this;if(this._active)return void de.push(ct);let Et;this._active=!0;do{if(Et=ct.execute(ct.state,ct.delay))break}while(ct=de.shift());if(this._active=!1,Et){for(;ct=de.shift();)ct.unsubscribe();throw Et}}}},4986:(yi,on,ue)=>{"use strict";ue.d(on,{P:()=>s,z:()=>Xe});var C=ue(4408);const Xe=new(ue(7565).v)(C.o),s=Xe},6063:(yi,on,ue)=>{"use strict";ue.d(on,{l:()=>C});const C={now:()=>(C.delegate||Date).now(),delegate:void 0}},3410:(yi,on,ue)=>{"use strict";ue.d(on,{z:()=>C});const C={setTimeout(De,Xe,...s){const{delegate:ct}=C;return ct?.setTimeout?ct.setTimeout(De,Xe,...s):setTimeout(De,Xe,...s)},clearTimeout(De){const{delegate:Xe}=C;return(Xe?.clearTimeout||clearTimeout)(De)},delegate:void 0}},2202:(yi,on,ue)=>{"use strict";ue.d(on,{h:()=>De});const De=function C(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(yi,on,ue)=>{"use strict";ue.d(on,{L:()=>C});const C="function"==typeof Symbol&&Symbol.observable||"@@observable"},6805:(yi,on,ue)=>{"use strict";ue.d(on,{K:()=>De});const De=(0,ue(3888).d)(Xe=>function(){Xe(this),this.name="EmptyError",this.message="no elements in sequence"})},3269:(yi,on,ue)=>{"use strict";ue.d(on,{_6:()=>de,jO:()=>s,yG:()=>ct});var C=ue(576),De=ue(3532);function Xe(Et){return Et[Et.length-1]}function s(Et){return(0,C.m)(Xe(Et))?Et.pop():void 0}function ct(Et){return(0,De.K)(Xe(Et))?Et.pop():void 0}function de(Et,qt){return"number"==typeof Xe(Et)?Et.pop():qt}},4742:(yi,on,ue)=>{"use strict";ue.d(on,{D:()=>ct});const{isArray:C}=Array,{getPrototypeOf:De,prototype:Xe,keys:s}=Object;function ct(Et){if(1===Et.length){const qt=Et[0];if(C(qt))return{args:qt,keys:null};if(function de(Et){return Et&&"object"==typeof Et&&De(Et)===Xe}(qt)){const gt=s(qt);return{args:gt.map(jt=>qt[jt]),keys:gt}}}return{args:Et,keys:null}}},8737:(yi,on,ue)=>{"use strict";function C(De,Xe){if(De){const s=De.indexOf(Xe);0<=s&&De.splice(s,1)}}ue.d(on,{P:()=>C})},3888:(yi,on,ue)=>{"use strict";function C(De){const s=De(ct=>{Error.call(ct),ct.stack=(new Error).stack});return s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,s}ue.d(on,{d:()=>C})},1810:(yi,on,ue)=>{"use strict";function C(De,Xe){return De.reduce((s,ct,de)=>(s[ct]=Xe[de],s),{})}ue.d(on,{n:()=>C})},2806:(yi,on,ue)=>{"use strict";ue.d(on,{O:()=>s,x:()=>Xe});var C=ue(2416);let De=null;function Xe(ct){if(C.v.useDeprecatedSynchronousErrorHandling){const de=!De;if(de&&(De={errorThrown:!1,error:null}),ct(),de){const{errorThrown:Et,error:qt}=De;if(De=null,Et)throw qt}}else ct()}function s(ct){C.v.useDeprecatedSynchronousErrorHandling&&De&&(De.errorThrown=!0,De.error=ct)}},9672:(yi,on,ue)=>{"use strict";function C(De,Xe,s,ct=0,de=!1){const Et=Xe.schedule(function(){s(),de?De.add(this.schedule(null,ct)):this.unsubscribe()},ct);if(De.add(Et),!de)return Et}ue.d(on,{f:()=>C})},4671:(yi,on,ue)=>{"use strict";function C(De){return De}ue.d(on,{y:()=>C})},1144:(yi,on,ue)=>{"use strict";ue.d(on,{z:()=>C});const C=De=>De&&"number"==typeof De.length&&"function"!=typeof De},2206:(yi,on,ue)=>{"use strict";ue.d(on,{D:()=>De});var C=ue(576);function De(Xe){return Symbol.asyncIterator&&(0,C.m)(Xe?.[Symbol.asyncIterator])}},576:(yi,on,ue)=>{"use strict";function C(De){return"function"==typeof De}ue.d(on,{m:()=>C})},3670:(yi,on,ue)=>{"use strict";ue.d(on,{c:()=>Xe});var C=ue(8822),De=ue(576);function Xe(s){return(0,De.m)(s[C.L])}},6495:(yi,on,ue)=>{"use strict";ue.d(on,{T:()=>Xe});var C=ue(2202),De=ue(576);function Xe(s){return(0,De.m)(s?.[C.h])}},8239:(yi,on,ue)=>{"use strict";ue.d(on,{t:()=>De});var C=ue(576);function De(Xe){return(0,C.m)(Xe?.then)}},3260:(yi,on,ue)=>{"use strict";ue.d(on,{L:()=>s,Q:()=>Xe});var C=ue(7582),De=ue(576);function Xe(ct){return(0,C.FC)(this,arguments,function*(){const Et=ct.getReader();try{for(;;){const{value:qt,done:gt}=yield(0,C.qq)(Et.read());if(gt)return yield(0,C.qq)(void 0);yield yield(0,C.qq)(qt)}}finally{Et.releaseLock()}})}function s(ct){return(0,De.m)(ct?.getReader)}},3532:(yi,on,ue)=>{"use strict";ue.d(on,{K:()=>De});var C=ue(576);function De(Xe){return Xe&&(0,C.m)(Xe.schedule)}},4482:(yi,on,ue)=>{"use strict";ue.d(on,{A:()=>De,e:()=>Xe});var C=ue(576);function De(s){return(0,C.m)(s?.lift)}function Xe(s){return ct=>{if(De(ct))return ct.lift(function(de){try{return s(de,this)}catch(Et){this.error(Et)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(yi,on,ue)=>{"use strict";ue.d(on,{Z:()=>s});var C=ue(4004);const{isArray:De}=Array;function s(ct){return(0,C.U)(de=>function Xe(ct,de){return De(de)?ct(...de):ct(de)}(ct,de))}},5032:(yi,on,ue)=>{"use strict";function C(){}ue.d(on,{Z:()=>C})},9635:(yi,on,ue)=>{"use strict";ue.d(on,{U:()=>Xe,z:()=>De});var C=ue(4671);function De(...s){return Xe(s)}function Xe(s){return 0===s.length?C.y:1===s.length?s[0]:function(de){return s.reduce((Et,qt)=>qt(Et),de)}}},7849:(yi,on,ue)=>{"use strict";ue.d(on,{h:()=>Xe});var C=ue(2416),De=ue(3410);function Xe(s){De.z.setTimeout(()=>{const{onUnhandledError:ct}=C.v;if(!ct)throw s;ct(s)})}},4532:(yi,on,ue)=>{"use strict";function C(De){return new TypeError(`You provided ${null!==De&&"object"==typeof De?"an invalid object":`'${De}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}ue.d(on,{z:()=>C})},7340:(yi,on,ue)=>{"use strict";ue.d(on,{LC:()=>De,SB:()=>gt,X$:()=>s,ZE:()=>Vn,ZN:()=>hn,_j:()=>C,eR:()=>wt,jt:()=>ct,k1:()=>hi,l3:()=>Xe,oB:()=>qt,vP:()=>Et});class C{}class De{}const Xe="*";function s(Te,_t){return{type:7,name:Te,definitions:_t,options:{}}}function ct(Te,_t=null){return{type:4,styles:_t,timings:Te}}function Et(Te,_t=null){return{type:2,steps:Te,options:_t}}function qt(Te){return{type:6,styles:Te,offset:null}}function gt(Te,_t,Ue){return{type:0,name:Te,styles:_t,options:Ue}}function wt(Te,_t,Ue=null){return{type:1,expr:Te,animation:_t,options:Ue}}function ii(Te){Promise.resolve().then(Te)}class hn{constructor(_t=0,Ue=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=_t+Ue}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(_t=>_t()),this._onDoneFns=[])}onStart(_t){this._originalOnStartFns.push(_t),this._onStartFns.push(_t)}onDone(_t){this._originalOnDoneFns.push(_t),this._onDoneFns.push(_t)}onDestroy(_t){this._onDestroyFns.push(_t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){ii(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(_t=>_t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(_t=>_t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(_t){this._position=this.totalTime?_t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(_t){const Ue="start"==_t?this._onStartFns:this._onDoneFns;Ue.forEach(Ye=>Ye()),Ue.length=0}}class Vn{constructor(_t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=_t;let Ue=0,Ye=0,Pt=0;const je=this.players.length;0==je?ii(()=>this._onFinish()):this.players.forEach(Ze=>{Ze.onDone(()=>{++Ue==je&&this._onFinish()}),Ze.onDestroy(()=>{++Ye==je&&this._onDestroy()}),Ze.onStart(()=>{++Pt==je&&this._onStart()})}),this.totalTime=this.players.reduce((Ze,ot)=>Math.max(Ze,ot.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(_t=>_t()),this._onDoneFns=[])}init(){this.players.forEach(_t=>_t.init())}onStart(_t){this._onStartFns.push(_t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(_t=>_t()),this._onStartFns=[])}onDone(_t){this._onDoneFns.push(_t)}onDestroy(_t){this._onDestroyFns.push(_t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(_t=>_t.play())}pause(){this.players.forEach(_t=>_t.pause())}restart(){this.players.forEach(_t=>_t.restart())}finish(){this._onFinish(),this.players.forEach(_t=>_t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(_t=>_t.destroy()),this._onDestroyFns.forEach(_t=>_t()),this._onDestroyFns=[])}reset(){this.players.forEach(_t=>_t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(_t){const Ue=_t*this.totalTime;this.players.forEach(Ye=>{const Pt=Ye.totalTime?Math.min(1,Ue/Ye.totalTime):1;Ye.setPosition(Pt)})}getPosition(){const _t=this.players.reduce((Ue,Ye)=>null===Ue||Ye.totalTime>Ue.totalTime?Ye:Ue,null);return null!=_t?_t.getPosition():0}beforeDestroy(){this.players.forEach(_t=>{_t.beforeDestroy&&_t.beforeDestroy()})}triggerCallback(_t){const Ue="start"==_t?this._onStartFns:this._onDoneFns;Ue.forEach(Ye=>Ye()),Ue.length=0}}const hi="!"},6875:(yi,on,ue)=>{"use strict";ue.d(on,{be:()=>Wa,B8:()=>La,U5:()=>qa,st:()=>I1,po:()=>wa});var C=ue(1571);let De;try{De=typeof Intl<"u"&&Intl.v8BreakIterator}catch{De=!1}var Te=ue(7579),_t=ue(727);function eo(vt,...ft){return ft.length?ft.some($e=>vt[$e]):vt.altKey||vt.shiftKey||vt.ctrlKey||vt.metaKey}var Ci=ue(8505),As=ue(8372),Bi=ue(9300),Vs=ue(4004);class oo{constructor(ft){this._items=ft,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new Te.x,this._typeaheadSubscription=_t.w0.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._pageUpAndDown={enabled:!1,delta:10},this._skipPredicateFn=$e=>$e.disabled,this._pressedLetters=[],this.tabOut=new Te.x,this.change=new Te.x,ft instanceof C.n_E&&(this._itemChangesSubscription=ft.changes.subscribe($e=>{if(this._activeItem){const Pn=$e.toArray().indexOf(this._activeItem);Pn>-1&&Pn!==this._activeItemIndex&&(this._activeItemIndex=Pn)}}))}skipPredicate(ft){return this._skipPredicateFn=ft,this}withWrap(ft=!0){return this._wrap=ft,this}withVerticalOrientation(ft=!0){return this._vertical=ft,this}withHorizontalOrientation(ft){return this._horizontal=ft,this}withAllowedModifierKeys(ft){return this._allowedModifierKeys=ft,this}withTypeAhead(ft=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe((0,Ci.b)($e=>this._pressedLetters.push($e)),(0,As.b)(ft),(0,Bi.h)(()=>this._pressedLetters.length>0),(0,Vs.U)(()=>this._pressedLetters.join(""))).subscribe($e=>{const Yt=this._getItemsArray();for(let Pn=1;Pn<Yt.length+1;Pn++){const Ui=(this._activeItemIndex+Pn)%Yt.length,ys=Yt[Ui];if(!this._skipPredicateFn(ys)&&0===ys.getLabel().toUpperCase().trim().indexOf($e)){this.setActiveItem(Ui);break}}this._pressedLetters=[]}),this}cancelTypeahead(){return this._pressedLetters=[],this}withHomeAndEnd(ft=!0){return this._homeAndEnd=ft,this}withPageUpDown(ft=!0,$e=10){return this._pageUpAndDown={enabled:ft,delta:$e},this}setActiveItem(ft){const $e=this._activeItem;this.updateActiveItem(ft),this._activeItem!==$e&&this.change.next(this._activeItemIndex)}onKeydown(ft){const $e=ft.keyCode,Pn=["altKey","ctrlKey","metaKey","shiftKey"].every(Ui=>!ft[Ui]||this._allowedModifierKeys.indexOf(Ui)>-1);switch($e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&Pn){this.setNextItemActive();break}return;case 38:if(this._vertical&&Pn){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&Pn){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&Pn){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&Pn){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&Pn){this.setLastItemActive();break}return;case 33:if(this._pageUpAndDown.enabled&&Pn){const Ui=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(Ui>0?Ui:0,1);break}return;case 34:if(this._pageUpAndDown.enabled&&Pn){const Ui=this._activeItemIndex+this._pageUpAndDown.delta,ys=this._getItemsArray().length;this._setActiveItemByIndex(Ui<ys?Ui:ys-1,-1);break}return;default:return void((Pn||eo(ft,"shiftKey"))&&(ft.key&&1===ft.key.length?this._letterKeyStream.next(ft.key.toLocaleUpperCase()):($e>=65&&$e<=90||$e>=48&&$e<=57)&&this._letterKeyStream.next(String.fromCharCode($e))))}this._pressedLetters=[],ft.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(ft){const $e=this._getItemsArray(),Yt="number"==typeof ft?ft:$e.indexOf(ft);this._activeItem=$e[Yt]??null,this._activeItemIndex=Yt}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._letterKeyStream.complete(),this.tabOut.complete(),this.change.complete(),this._pressedLetters=[]}_setActiveItemByDelta(ft){this._wrap?this._setActiveInWrapMode(ft):this._setActiveInDefaultMode(ft)}_setActiveInWrapMode(ft){const $e=this._getItemsArray();for(let Yt=1;Yt<=$e.length;Yt++){const Pn=(this._activeItemIndex+ft*Yt+$e.length)%$e.length;if(!this._skipPredicateFn($e[Pn]))return void this.setActiveItem(Pn)}}_setActiveInDefaultMode(ft){this._setActiveItemByIndex(this._activeItemIndex+ft,ft)}_setActiveItemByIndex(ft,$e){const Yt=this._getItemsArray();if(Yt[ft]){for(;this._skipPredicateFn(Yt[ft]);)if(!Yt[ft+=$e])return;this.setActiveItem(ft)}}_getItemsArray(){return this._items instanceof C.n_E?this._items.toArray():this._items}}class yo extends oo{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(ft){return this._origin=ft,this}setActiveItem(ft){super.setActiveItem(ft),this.activeItem&&this.activeItem.focus(this._origin)}}var la=ue(6895);const G1=new C.OlP("cdk-dir-doc",{providedIn:"root",factory:function $a(){return(0,C.f3M)(la.K0)}}),se=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let X=(()=>{class vt{constructor($e){this.value="ltr",this.change=new C.vpe,$e&&(this.value=function ne(vt){const ft=vt?.toLowerCase()||"";return"auto"===ft&&typeof navigator<"u"&&navigator?.language?se.test(navigator.language)?"rtl":"ltr":"rtl"===ft?"rtl":"ltr"}(($e.body?$e.body.dir:null)||($e.documentElement?$e.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return vt.\u0275fac=function($e){return new($e||vt)(C.LFG(G1,8))},vt.\u0275prov=C.Yz7({token:vt,factory:vt.\u0275fac,providedIn:"root"}),vt})(),lt=(()=>{class vt{}return vt.\u0275fac=function($e){return new($e||vt)},vt.\u0275mod=C.oAB({type:vt}),vt.\u0275inj=C.cJS({}),vt})();function jn(vt){return null!=vt&&"false"!=`${vt}`}var ba=ue(9646),Aa=ue(8675),a1=ue(2722);function b1(vt,ft){1&vt&&C.Hsn(0)}const t2=["*"];let gs=(()=>{class vt{constructor($e){this._elementRef=$e}focus(){this._elementRef.nativeElement.focus()}}return vt.\u0275fac=function($e){return new($e||vt)(C.Y36(C.SBq))},vt.\u0275dir=C.lG2({type:vt,selectors:[["","cdkStepHeader",""]],hostAttrs:["role","tab"]}),vt})(),Bo=(()=>{class vt{constructor($e){this.template=$e}}return vt.\u0275fac=function($e){return new($e||vt)(C.Y36(C.Rgc))},vt.\u0275dir=C.lG2({type:vt,selectors:[["","cdkStepLabel",""]]}),vt})(),ta=0;const n2=new C.OlP("STEPPER_GLOBAL_OPTIONS");let Wa=(()=>{class vt{get editable(){return this._editable}set editable($e){this._editable=jn($e)}get optional(){return this._optional}set optional($e){this._optional=jn($e)}get completed(){return null==this._completedOverride?this._getDefaultCompleted():this._completedOverride}set completed($e){this._completedOverride=jn($e)}_getDefaultCompleted(){return this.stepControl?this.stepControl.valid&&this.interacted:this.interacted}get hasError(){return null==this._customError?this._getDefaultError():this._customError}set hasError($e){this._customError=jn($e)}_getDefaultError(){return this.stepControl&&this.stepControl.invalid&&this.interacted}constructor($e,Yt){this._stepper=$e,this.interacted=!1,this.interactedStream=new C.vpe,this._editable=!0,this._optional=!1,this._completedOverride=null,this._customError=null,this._stepperOptions=Yt||{},this._displayDefaultIndicatorType=!1!==this._stepperOptions.displayDefaultIndicatorType}select(){this._stepper.selected=this}reset(){this.interacted=!1,null!=this._completedOverride&&(this._completedOverride=!1),null!=this._customError&&(this._customError=!1),this.stepControl&&this.stepControl.reset()}ngOnChanges(){this._stepper._stateChanged()}_markAsInteracted(){this.interacted||(this.interacted=!0,this.interactedStream.emit(this))}_showError(){return this._stepperOptions.showError??null!=this._customError}}return vt.\u0275fac=function($e){return new($e||vt)(C.Y36((0,C.Gpc)(()=>La)),C.Y36(n2,8))},vt.\u0275cmp=C.Xpm({type:vt,selectors:[["cdk-step"]],contentQueries:function($e,Yt,Pn){if(1&$e&&C.Suo(Pn,Bo,5),2&$e){let Ui;C.iGM(Ui=C.CRH())&&(Yt.stepLabel=Ui.first)}},viewQuery:function($e,Yt){if(1&$e&&C.Gf(C.Rgc,7),2&$e){let Pn;C.iGM(Pn=C.CRH())&&(Yt.content=Pn.first)}},inputs:{stepControl:"stepControl",label:"label",errorMessage:"errorMessage",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],state:"state",editable:"editable",optional:"optional",completed:"completed",hasError:"hasError"},outputs:{interactedStream:"interacted"},exportAs:["cdkStep"],features:[C.TTD],ngContentSelectors:t2,decls:1,vars:0,template:function($e,Yt){1&$e&&(C.F$t(),C.YNc(0,b1,1,0,"ng-template"))},encapsulation:2,changeDetection:0}),vt})(),La=(()=>{class vt{get linear(){return this._linear}set linear($e){this._linear=jn($e)}get selectedIndex(){return this._selectedIndex}set selectedIndex($e){const Yt=function ms(vt,ft=0){return function Eo(vt){return!isNaN(parseFloat(vt))&&!isNaN(Number(vt))}(vt)?Number(vt):ft}($e);this.steps&&this._steps?(this._isValidIndex(Yt),this.selected?._markAsInteracted(),this._selectedIndex!==Yt&&!this._anyControlsInvalidOrPending(Yt)&&(Yt>=this._selectedIndex||this.steps.toArray()[Yt].editable)&&this._updateSelectedItemIndex(Yt)):this._selectedIndex=Yt}get selected(){return this.steps?this.steps.toArray()[this.selectedIndex]:void 0}set selected($e){this.selectedIndex=$e&&this.steps?this.steps.toArray().indexOf($e):-1}get orientation(){return this._orientation}set orientation($e){this._orientation=$e,this._keyManager&&this._keyManager.withVerticalOrientation("vertical"===$e)}constructor($e,Yt,Pn){this._dir=$e,this._changeDetectorRef=Yt,this._elementRef=Pn,this._destroyed=new Te.x,this.steps=new C.n_E,this._sortedHeaders=new C.n_E,this._linear=!1,this._selectedIndex=0,this.selectionChange=new C.vpe,this._orientation="horizontal",this._groupId=ta++}ngAfterContentInit(){this._steps.changes.pipe((0,Aa.O)(this._steps),(0,a1.R)(this._destroyed)).subscribe($e=>{this.steps.reset($e.filter(Yt=>Yt._stepper===this)),this.steps.notifyOnChanges()})}ngAfterViewInit(){this._stepHeader.changes.pipe((0,Aa.O)(this._stepHeader),(0,a1.R)(this._destroyed)).subscribe($e=>{this._sortedHeaders.reset($e.toArray().sort((Yt,Pn)=>Yt._elementRef.nativeElement.compareDocumentPosition(Pn._elementRef.nativeElement)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)),this._sortedHeaders.notifyOnChanges()}),this._keyManager=new yo(this._sortedHeaders).withWrap().withHomeAndEnd().withVerticalOrientation("vertical"===this._orientation),(this._dir?this._dir.change:(0,ba.of)()).pipe((0,Aa.O)(this._layoutDirection()),(0,a1.R)(this._destroyed)).subscribe($e=>this._keyManager.withHorizontalOrientation($e)),this._keyManager.updateActiveItem(this._selectedIndex),this.steps.changes.subscribe(()=>{this.selected||(this._selectedIndex=Math.max(this._selectedIndex-1,0))}),this._isValidIndex(this._selectedIndex)||(this._selectedIndex=0)}ngOnDestroy(){this._keyManager?.destroy(),this.steps.destroy(),this._sortedHeaders.destroy(),this._destroyed.next(),this._destroyed.complete()}next(){this.selectedIndex=Math.min(this._selectedIndex+1,this.steps.length-1)}previous(){this.selectedIndex=Math.max(this._selectedIndex-1,0)}reset(){this._updateSelectedItemIndex(0),this.steps.forEach($e=>$e.reset()),this._stateChanged()}_getStepLabelId($e){return`cdk-step-label-${this._groupId}-${$e}`}_getStepContentId($e){return`cdk-step-content-${this._groupId}-${$e}`}_stateChanged(){this._changeDetectorRef.markForCheck()}_getAnimationDirection($e){const Yt=$e-this._selectedIndex;return Yt<0?"rtl"===this._layoutDirection()?"next":"previous":Yt>0?"rtl"===this._layoutDirection()?"previous":"next":"current"}_getIndicatorType($e,Yt="number"){const Pn=this.steps.toArray()[$e],Ui=this._isCurrentStep($e);return Pn._displayDefaultIndicatorType?this._getDefaultIndicatorLogic(Pn,Ui):this._getGuidelineLogic(Pn,Ui,Yt)}_getDefaultIndicatorLogic($e,Yt){return $e._showError()&&$e.hasError&&!Yt?"error":!$e.completed||Yt?"number":$e.editable?"edit":"done"}_getGuidelineLogic($e,Yt,Pn="number"){return $e._showError()&&$e.hasError&&!Yt?"error":$e.completed&&!Yt?"done":$e.completed&&Yt?Pn:$e.editable&&Yt?"edit":Pn}_isCurrentStep($e){return this._selectedIndex===$e}_getFocusIndex(){return this._keyManager?this._keyManager.activeItemIndex:this._selectedIndex}_updateSelectedItemIndex($e){const Yt=this.steps.toArray();this.selectionChange.emit({selectedIndex:$e,previouslySelectedIndex:this._selectedIndex,selectedStep:Yt[$e],previouslySelectedStep:Yt[this._selectedIndex]}),this._containsFocus()?this._keyManager.setActiveItem($e):this._keyManager.updateActiveItem($e),this._selectedIndex=$e,this._stateChanged()}_onKeydown($e){const Yt=eo($e),Pn=$e.keyCode,Ui=this._keyManager;null==Ui.activeItemIndex||Yt||32!==Pn&&13!==Pn?Ui.setFocusOrigin("keyboard").onKeydown($e):(this.selectedIndex=Ui.activeItemIndex,$e.preventDefault())}_anyControlsInvalidOrPending($e){return!!(this._linear&&$e>=0)&&this.steps.toArray().slice(0,$e).some(Yt=>{const Pn=Yt.stepControl;return(Pn?Pn.invalid||Pn.pending||!Yt.interacted:!Yt.completed)&&!Yt.optional&&!Yt._completedOverride})}_layoutDirection(){return this._dir&&"rtl"===this._dir.value?"rtl":"ltr"}_containsFocus(){const $e=this._elementRef.nativeElement,Yt=function hn(){let vt=typeof document<"u"&&document?document.activeElement:null;for(;vt&&vt.shadowRoot;){const ft=vt.shadowRoot.activeElement;if(ft===vt)break;vt=ft}return vt}();return $e===Yt||$e.contains(Yt)}_isValidIndex($e){return $e>-1&&(!this.steps||$e<this.steps.length)}}return vt.\u0275fac=function($e){return new($e||vt)(C.Y36(X,8),C.Y36(C.sBO),C.Y36(C.SBq))},vt.\u0275dir=C.lG2({type:vt,selectors:[["","cdkStepper",""]],contentQueries:function($e,Yt,Pn){if(1&$e&&(C.Suo(Pn,Wa,5),C.Suo(Pn,gs,5)),2&$e){let Ui;C.iGM(Ui=C.CRH())&&(Yt._steps=Ui),C.iGM(Ui=C.CRH())&&(Yt._stepHeader=Ui)}},inputs:{linear:"linear",selectedIndex:"selectedIndex",selected:"selected",orientation:"orientation"},outputs:{selectionChange:"selectionChange"},exportAs:["cdkStepper"]}),vt})(),I1=(()=>{class vt{constructor($e){this._stepper=$e,this.type="submit"}}return vt.\u0275fac=function($e){return new($e||vt)(C.Y36(La))},vt.\u0275dir=C.lG2({type:vt,selectors:[["button","cdkStepperNext",""]],hostVars:1,hostBindings:function($e,Yt){1&$e&&C.NdJ("click",function(){return Yt._stepper.next()}),2&$e&&C.Ikx("type",Yt.type)},inputs:{type:"type"}}),vt})(),wa=(()=>{class vt{constructor($e){this._stepper=$e,this.type="button"}}return vt.\u0275fac=function($e){return new($e||vt)(C.Y36(La))},vt.\u0275dir=C.lG2({type:vt,selectors:[["button","cdkStepperPrevious",""]],hostVars:1,hostBindings:function($e,Yt){1&$e&&C.NdJ("click",function(){return Yt._stepper.previous()}),2&$e&&C.Ikx("type",Yt.type)},inputs:{type:"type"}}),vt})(),qa=(()=>{class vt{}return vt.\u0275fac=function($e){return new($e||vt)},vt.\u0275mod=C.oAB({type:vt}),vt.\u0275inj=C.cJS({imports:[lt]}),vt})()},6895:(yi,on,ue)=>{"use strict";ue.d(on,{Do:()=>Vn,EM:()=>Qo,H9:()=>_1,HT:()=>s,JF:()=>Po,K0:()=>de,Mx:()=>ro,NF:()=>cr,O5:()=>js,Ov:()=>ci,PC:()=>es,S$:()=>dn,V_:()=>gt,Ye:()=>hi,b0:()=>hn,bD:()=>Xo,ez:()=>Fo,mk:()=>Oa,q:()=>Xe,rS:()=>As,sg:()=>Sr,tP:()=>ho,uU:()=>Ls,w_:()=>ct});var C=ue(1571);let De=null;function Xe(){return De}function s(Z){De||(De=Z)}class ct{}const de=new C.OlP("DocumentToken");let Et=(()=>{class Z{historyGo(L){throw new Error("Not implemented")}}return Z.\u0275fac=function(L){return new(L||Z)},Z.\u0275prov=C.Yz7({token:Z,factory:function(){return function qt(){return(0,C.LFG)(jt)}()},providedIn:"platform"}),Z})();const gt=new C.OlP("Location Initialized");let jt=(()=>{class Z extends Et{constructor(L){super(),this._doc=L,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Xe().getBaseHref(this._doc)}onPopState(L){const j=Xe().getGlobalEventTarget(this._doc,"window");return j.addEventListener("popstate",L,!1),()=>j.removeEventListener("popstate",L)}onHashChange(L){const j=Xe().getGlobalEventTarget(this._doc,"window");return j.addEventListener("hashchange",L,!1),()=>j.removeEventListener("hashchange",L)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(L){this._location.pathname=L}pushState(L,j,ie){wt()?this._history.pushState(L,j,ie):this._location.hash=ie}replaceState(L,j,ie){wt()?this._history.replaceState(L,j,ie):this._location.hash=ie}forward(){this._history.forward()}back(){this._history.back()}historyGo(L=0){this._history.go(L)}getState(){return this._history.state}}return Z.\u0275fac=function(L){return new(L||Z)(C.LFG(de))},Z.\u0275prov=C.Yz7({token:Z,factory:function(){return function Gt(){return new jt((0,C.LFG)(de))}()},providedIn:"platform"}),Z})();function wt(){return!!window.history.pushState}function Kn(Z,I){if(0==Z.length)return I;if(0==I.length)return Z;let L=0;return Z.endsWith("/")&&L++,I.startsWith("/")&&L++,2==L?Z+I.substring(1):1==L?Z+I:Z+"/"+I}function Sn(Z){const I=Z.match(/#|\?|$/),L=I&&I.index||Z.length;return Z.slice(0,L-("/"===Z[L-1]?1:0))+Z.slice(L)}function En(Z){return Z&&"?"!==Z[0]?"?"+Z:Z}let dn=(()=>{class Z{historyGo(L){throw new Error("Not implemented")}}return Z.\u0275fac=function(L){return new(L||Z)},Z.\u0275prov=C.Yz7({token:Z,factory:function(){return(0,C.f3M)(hn)},providedIn:"root"}),Z})();const ii=new C.OlP("appBaseHref");let hn=(()=>{class Z extends dn{constructor(L,j){super(),this._platformLocation=L,this._removeListenerFns=[],this._baseHref=j??this._platformLocation.getBaseHrefFromDOM()??(0,C.f3M)(de).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(L){this._removeListenerFns.push(this._platformLocation.onPopState(L),this._platformLocation.onHashChange(L))}getBaseHref(){return this._baseHref}prepareExternalUrl(L){return Kn(this._baseHref,L)}path(L=!1){const j=this._platformLocation.pathname+En(this._platformLocation.search),ie=this._platformLocation.hash;return ie&&L?`${j}${ie}`:j}pushState(L,j,ie,we){const Je=this.prepareExternalUrl(ie+En(we));this._platformLocation.pushState(L,j,Je)}replaceState(L,j,ie,we){const Je=this.prepareExternalUrl(ie+En(we));this._platformLocation.replaceState(L,j,Je)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(L=0){this._platformLocation.historyGo?.(L)}}return Z.\u0275fac=function(L){return new(L||Z)(C.LFG(Et),C.LFG(ii,8))},Z.\u0275prov=C.Yz7({token:Z,factory:Z.\u0275fac,providedIn:"root"}),Z})(),Vn=(()=>{class Z extends dn{constructor(L,j){super(),this._platformLocation=L,this._baseHref="",this._removeListenerFns=[],null!=j&&(this._baseHref=j)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(L){this._removeListenerFns.push(this._platformLocation.onPopState(L),this._platformLocation.onHashChange(L))}getBaseHref(){return this._baseHref}path(L=!1){let j=this._platformLocation.hash;return null==j&&(j="#"),j.length>0?j.substring(1):j}prepareExternalUrl(L){const j=Kn(this._baseHref,L);return j.length>0?"#"+j:j}pushState(L,j,ie,we){let Je=this.prepareExternalUrl(ie+En(we));0==Je.length&&(Je=this._platformLocation.pathname),this._platformLocation.pushState(L,j,Je)}replaceState(L,j,ie,we){let Je=this.prepareExternalUrl(ie+En(we));0==Je.length&&(Je=this._platformLocation.pathname),this._platformLocation.replaceState(L,j,Je)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(L=0){this._platformLocation.historyGo?.(L)}}return Z.\u0275fac=function(L){return new(L||Z)(C.LFG(Et),C.LFG(ii,8))},Z.\u0275prov=C.Yz7({token:Z,factory:Z.\u0275fac}),Z})(),hi=(()=>{class Z{constructor(L){this._subject=new C.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=L;const j=this._locationStrategy.getBaseHref();this._basePath=function Ye(Z){if(new RegExp("^(https?:)?//").test(Z)){const[,L]=Z.split(/\/\/[^\/]+/);return L}return Z}(Sn(Ue(j))),this._locationStrategy.onPopState(ie=>{this._subject.emit({url:this.path(!0),pop:!0,state:ie.state,type:ie.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(L=!1){return this.normalize(this._locationStrategy.path(L))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(L,j=""){return this.path()==this.normalize(L+En(j))}normalize(L){return Z.stripTrailingSlash(function _t(Z,I){if(!Z||!I.startsWith(Z))return I;const L=I.substring(Z.length);return""===L||["/",";","?","#"].includes(L[0])?L:I}(this._basePath,Ue(L)))}prepareExternalUrl(L){return L&&"/"!==L[0]&&(L="/"+L),this._locationStrategy.prepareExternalUrl(L)}go(L,j="",ie=null){this._locationStrategy.pushState(ie,"",L,j),this._notifyUrlChangeListeners(this.prepareExternalUrl(L+En(j)),ie)}replaceState(L,j="",ie=null){this._locationStrategy.replaceState(ie,"",L,j),this._notifyUrlChangeListeners(this.prepareExternalUrl(L+En(j)),ie)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(L=0){this._locationStrategy.historyGo?.(L)}onUrlChange(L){return this._urlChangeListeners.push(L),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(j=>{this._notifyUrlChangeListeners(j.url,j.state)})),()=>{const j=this._urlChangeListeners.indexOf(L);this._urlChangeListeners.splice(j,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(L="",j){this._urlChangeListeners.forEach(ie=>ie(L,j))}subscribe(L,j,ie){return this._subject.subscribe({next:L,error:j,complete:ie})}}return Z.normalizeQueryParams=En,Z.joinWithSlash=Kn,Z.stripTrailingSlash=Sn,Z.\u0275fac=function(L){return new(L||Z)(C.LFG(dn))},Z.\u0275prov=C.Yz7({token:Z,factory:function(){return function Te(){return new hi((0,C.LFG)(dn))}()},providedIn:"root"}),Z})();function Ue(Z){return Z.replace(/\/index.html$/,"")}const Pt={ADP:[void 0,void 0,0],AFN:[void 0,"\u060b",0],ALL:[void 0,void 0,0],AMD:[void 0,"\u058f",2],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],AZN:[void 0,"\u20bc"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09f3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,void 0,2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xa5","\xa5"],COP:[void 0,"$",2],CRC:[void 0,"\u20a1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010d",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xa3"],ESP:[void 0,"\u20a7",0],EUR:["\u20ac"],FJD:[void 0,"$"],FKP:[void 0,"\xa3"],GBP:["\xa3"],GEL:[void 0,"\u20be"],GHS:[void 0,"GH\u20b5"],GIP:[void 0,"\xa3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",2],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",2],ILS:["\u20aa"],INR:["\u20b9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xa5",void 0,0],KHR:[void 0,"\u17db"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20a9",0],KRW:["\u20a9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20b8"],LAK:[void 0,"\u20ad",0],LBP:[void 0,"L\xa3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20ae",2],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",2],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20a6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:["\u20b1"],PKR:[void 0,"Rs",2],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20b2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20bd"],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xa3"],SLE:[void 0,void 0,2],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xa3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xa3",0],THB:[void 0,"\u0e3f"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20ba"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,2],UAH:[void 0,"\u20b4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UYW:[void 0,void 0,4],UZS:[void 0,void 0,2],VEF:[void 0,"Bs",2],VND:["\u20ab",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["F\u202fCFA",void 0,0],XPF:["CFPF",void 0,0],XXX:["\xa4"],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]};var je=(()=>((je=je||{})[je.Decimal=0]="Decimal",je[je.Percent=1]="Percent",je[je.Currency=2]="Currency",je[je.Scientific=3]="Scientific",je))(),ot=(()=>((ot=ot||{})[ot.Format=0]="Format",ot[ot.Standalone=1]="Standalone",ot))(),pt=(()=>((pt=pt||{})[pt.Narrow=0]="Narrow",pt[pt.Abbreviated=1]="Abbreviated",pt[pt.Wide=2]="Wide",pt[pt.Short=3]="Short",pt))(),Ot=(()=>((Ot=Ot||{})[Ot.Short=0]="Short",Ot[Ot.Medium=1]="Medium",Ot[Ot.Long=2]="Long",Ot[Ot.Full=3]="Full",Ot))(),Xt=(()=>((Xt=Xt||{})[Xt.Decimal=0]="Decimal",Xt[Xt.Group=1]="Group",Xt[Xt.List=2]="List",Xt[Xt.PercentSign=3]="PercentSign",Xt[Xt.PlusSign=4]="PlusSign",Xt[Xt.MinusSign=5]="MinusSign",Xt[Xt.Exponential=6]="Exponential",Xt[Xt.SuperscriptingExponent=7]="SuperscriptingExponent",Xt[Xt.PerMille=8]="PerMille",Xt[Xt.Infinity=9]="Infinity",Xt[Xt.NaN=10]="NaN",Xt[Xt.TimeSeparator=11]="TimeSeparator",Xt[Xt.CurrencyDecimal=12]="CurrencyDecimal",Xt[Xt.CurrencyGroup=13]="CurrencyGroup",Xt))();function Ne(Z,I){return $r((0,C.cg1)(Z)[C.wAp.DateFormat],I)}function Pe(Z,I){return $r((0,C.cg1)(Z)[C.wAp.TimeFormat],I)}function Ke(Z,I){return $r((0,C.cg1)(Z)[C.wAp.DateTimeFormat],I)}function Bt(Z,I){const L=(0,C.cg1)(Z),j=L[C.wAp.NumberSymbols][I];if(typeof j>"u"){if(I===Xt.CurrencyDecimal)return L[C.wAp.NumberSymbols][Xt.Decimal];if(I===Xt.CurrencyGroup)return L[C.wAp.NumberSymbols][Xt.Group]}return j}function Ur(Z){if(!Z[C.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${Z[C.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function $r(Z,I){for(let L=I;L>-1;L--)if(typeof Z[L]<"u")return Z[L];throw new Error("Locale data API: locale data undefined")}function Ji(Z){const[I,L]=Z.split(":");return{hours:+I,minutes:+L}}const jr=2,me=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,He={},it=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var zt=(()=>((zt=zt||{})[zt.Short=0]="Short",zt[zt.ShortGMT=1]="ShortGMT",zt[zt.Long=2]="Long",zt[zt.Extended=3]="Extended",zt))(),At=(()=>((At=At||{})[At.FullYear=0]="FullYear",At[At.Month=1]="Month",At[At.Date=2]="Date",At[At.Hours=3]="Hours",At[At.Minutes=4]="Minutes",At[At.Seconds=5]="Seconds",At[At.FractionalSeconds=6]="FractionalSeconds",At[At.Day=7]="Day",At))(),It=(()=>((It=It||{})[It.DayPeriods=0]="DayPeriods",It[It.Days=1]="Days",It[It.Months=2]="Months",It[It.Eras=3]="Eras",It))();function Hn(Z,I,L,j){let ie=function an(Z){if(qe(Z))return Z;if("number"==typeof Z&&!isNaN(Z))return new Date(Z);if("string"==typeof Z){if(Z=Z.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(Z)){const[ie,we=1,Je=1]=Z.split("-").map(yt=>+yt);return Qt(ie,we-1,Je)}const L=parseFloat(Z);if(!isNaN(Z-L))return new Date(L);let j;if(j=Z.match(me))return function _n(Z){const I=new Date(0);let L=0,j=0;const ie=Z[8]?I.setUTCFullYear:I.setFullYear,we=Z[8]?I.setUTCHours:I.setHours;Z[9]&&(L=Number(Z[9]+Z[10]),j=Number(Z[9]+Z[11])),ie.call(I,Number(Z[1]),Number(Z[2])-1,Number(Z[3]));const Je=Number(Z[4]||0)-L,yt=Number(Z[5]||0)-j,rn=Number(Z[6]||0),mn=Math.floor(1e3*parseFloat("0."+(Z[7]||0)));return we.call(I,Je,yt,rn,mn),I}(j)}const I=new Date(Z);if(!qe(I))throw new Error(`Unable to convert "${Z}" into a date`);return I}(Z);I=$n(L,I)||I;let yt,Je=[];for(;I;){if(yt=it.exec(I),!yt){Je.push(I);break}{Je=Je.concat(yt.slice(1));const Jn=Je.pop();if(!Jn)break;I=Jn}}let rn=ie.getTimezoneOffset();j&&(rn=Oi(j,rn),ie=function Ht(Z,I,L){const j=L?-1:1,ie=Z.getTimezoneOffset();return function kt(Z,I){return(Z=new Date(Z.getTime())).setMinutes(Z.getMinutes()+I),Z}(Z,j*(Oi(I,ie)-ie))}(ie,j,!0));let mn="";return Je.forEach(Jn=>{const Bn=function ei(Z){if(vn[Z])return vn[Z];let I;switch(Z){case"G":case"GG":case"GGG":I=Ti(It.Eras,pt.Abbreviated);break;case"GGGG":I=Ti(It.Eras,pt.Wide);break;case"GGGGG":I=Ti(It.Eras,pt.Narrow);break;case"y":I=Hi(At.FullYear,1,0,!1,!0);break;case"yy":I=Hi(At.FullYear,2,0,!0,!0);break;case"yyy":I=Hi(At.FullYear,3,0,!1,!0);break;case"yyyy":I=Hi(At.FullYear,4,0,!1,!0);break;case"Y":I=In(1);break;case"YY":I=In(2,!0);break;case"YYY":I=In(3);break;case"YYYY":I=In(4);break;case"M":case"L":I=Hi(At.Month,1,1);break;case"MM":case"LL":I=Hi(At.Month,2,1);break;case"MMM":I=Ti(It.Months,pt.Abbreviated);break;case"MMMM":I=Ti(It.Months,pt.Wide);break;case"MMMMM":I=Ti(It.Months,pt.Narrow);break;case"LLL":I=Ti(It.Months,pt.Abbreviated,ot.Standalone);break;case"LLLL":I=Ti(It.Months,pt.Wide,ot.Standalone);break;case"LLLLL":I=Ti(It.Months,pt.Narrow,ot.Standalone);break;case"w":I=Tt(1);break;case"ww":I=Tt(2);break;case"W":I=Tt(1,!0);break;case"d":I=Hi(At.Date,1);break;case"dd":I=Hi(At.Date,2);break;case"c":case"cc":I=Hi(At.Day,1);break;case"ccc":I=Ti(It.Days,pt.Abbreviated,ot.Standalone);break;case"cccc":I=Ti(It.Days,pt.Wide,ot.Standalone);break;case"ccccc":I=Ti(It.Days,pt.Narrow,ot.Standalone);break;case"cccccc":I=Ti(It.Days,pt.Short,ot.Standalone);break;case"E":case"EE":case"EEE":I=Ti(It.Days,pt.Abbreviated);break;case"EEEE":I=Ti(It.Days,pt.Wide);break;case"EEEEE":I=Ti(It.Days,pt.Narrow);break;case"EEEEEE":I=Ti(It.Days,pt.Short);break;case"a":case"aa":case"aaa":I=Ti(It.DayPeriods,pt.Abbreviated);break;case"aaaa":I=Ti(It.DayPeriods,pt.Wide);break;case"aaaaa":I=Ti(It.DayPeriods,pt.Narrow);break;case"b":case"bb":case"bbb":I=Ti(It.DayPeriods,pt.Abbreviated,ot.Standalone,!0);break;case"bbbb":I=Ti(It.DayPeriods,pt.Wide,ot.Standalone,!0);break;case"bbbbb":I=Ti(It.DayPeriods,pt.Narrow,ot.Standalone,!0);break;case"B":case"BB":case"BBB":I=Ti(It.DayPeriods,pt.Abbreviated,ot.Format,!0);break;case"BBBB":I=Ti(It.DayPeriods,pt.Wide,ot.Format,!0);break;case"BBBBB":I=Ti(It.DayPeriods,pt.Narrow,ot.Format,!0);break;case"h":I=Hi(At.Hours,1,-12);break;case"hh":I=Hi(At.Hours,2,-12);break;case"H":I=Hi(At.Hours,1);break;case"HH":I=Hi(At.Hours,2);break;case"m":I=Hi(At.Minutes,1);break;case"mm":I=Hi(At.Minutes,2);break;case"s":I=Hi(At.Seconds,1);break;case"ss":I=Hi(At.Seconds,2);break;case"S":I=Hi(At.FractionalSeconds,1);break;case"SS":I=Hi(At.FractionalSeconds,2);break;case"SSS":I=Hi(At.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":I=ri(zt.Short);break;case"ZZZZZ":I=ri(zt.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":I=ri(zt.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":I=ri(zt.Long);break;default:return null}return vn[Z]=I,I}(Jn);mn+=Bn?Bn(ie,L,rn):"''"===Jn?"'":Jn.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),mn}function Qt(Z,I,L){const j=new Date(0);return j.setFullYear(Z,I,L),j.setHours(0,0,0),j}function $n(Z,I){const L=function Wi(Z){return(0,C.cg1)(Z)[C.wAp.LocaleId]}(Z);if(He[L]=He[L]||{},He[L][I])return He[L][I];let j="";switch(I){case"shortDate":j=Ne(Z,Ot.Short);break;case"mediumDate":j=Ne(Z,Ot.Medium);break;case"longDate":j=Ne(Z,Ot.Long);break;case"fullDate":j=Ne(Z,Ot.Full);break;case"shortTime":j=Pe(Z,Ot.Short);break;case"mediumTime":j=Pe(Z,Ot.Medium);break;case"longTime":j=Pe(Z,Ot.Long);break;case"fullTime":j=Pe(Z,Ot.Full);break;case"short":const ie=$n(Z,"shortTime"),we=$n(Z,"shortDate");j=Wn(Ke(Z,Ot.Short),[ie,we]);break;case"medium":const Je=$n(Z,"mediumTime"),yt=$n(Z,"mediumDate");j=Wn(Ke(Z,Ot.Medium),[Je,yt]);break;case"long":const rn=$n(Z,"longTime"),mn=$n(Z,"longDate");j=Wn(Ke(Z,Ot.Long),[rn,mn]);break;case"full":const Jn=$n(Z,"fullTime"),Bn=$n(Z,"fullDate");j=Wn(Ke(Z,Ot.Full),[Jn,Bn])}return j&&(He[L][I]=j),j}function Wn(Z,I){return I&&(Z=Z.replace(/\{([^}]+)}/g,function(L,j){return null!=I&&j in I?I[j]:L})),Z}function Zn(Z,I,L="-",j,ie){let we="";(Z<0||ie&&Z<=0)&&(ie?Z=1-Z:(Z=-Z,we=L));let Je=String(Z);for(;Je.length<I;)Je="0"+Je;return j&&(Je=Je.slice(Je.length-I)),we+Je}function Hi(Z,I,L=0,j=!1,ie=!1){return function(we,Je){let yt=function Xr(Z,I){switch(Z){case At.FullYear:return I.getFullYear();case At.Month:return I.getMonth();case At.Date:return I.getDate();case At.Hours:return I.getHours();case At.Minutes:return I.getMinutes();case At.Seconds:return I.getSeconds();case At.FractionalSeconds:return I.getMilliseconds();case At.Day:return I.getDay();default:throw new Error(`Unknown DateType value "${Z}".`)}}(Z,we);if((L>0||yt>-L)&&(yt+=L),Z===At.Hours)0===yt&&-12===L&&(yt=12);else if(Z===At.FractionalSeconds)return function Fi(Z,I){return Zn(Z,3).substring(0,I)}(yt,I);const rn=Bt(Je,Xt.MinusSign);return Zn(yt,I,rn,j,ie)}}function Ti(Z,I,L=ot.Format,j=!1){return function(ie,we){return function hr(Z,I,L,j,ie,we){switch(L){case It.Months:return function rt(Z,I,L){const j=(0,C.cg1)(Z),we=$r([j[C.wAp.MonthsFormat],j[C.wAp.MonthsStandalone]],I);return $r(we,L)}(I,ie,j)[Z.getMonth()];case It.Days:return function Tn(Z,I,L){const j=(0,C.cg1)(Z),we=$r([j[C.wAp.DaysFormat],j[C.wAp.DaysStandalone]],I);return $r(we,L)}(I,ie,j)[Z.getDay()];case It.DayPeriods:const Je=Z.getHours(),yt=Z.getMinutes();if(we){const mn=function Si(Z){const I=(0,C.cg1)(Z);return Ur(I),(I[C.wAp.ExtraData][2]||[]).map(j=>"string"==typeof j?Ji(j):[Ji(j[0]),Ji(j[1])])}(I),Jn=function Xi(Z,I,L){const j=(0,C.cg1)(Z);Ur(j);const we=$r([j[C.wAp.ExtraData][0],j[C.wAp.ExtraData][1]],I)||[];return $r(we,L)||[]}(I,ie,j),Bn=mn.findIndex(gi=>{if(Array.isArray(gi)){const[Zi,dr]=gi,ji=Je>=Zi.hours&&yt>=Zi.minutes,wo=Je<dr.hours||Je===dr.hours&&yt<dr.minutes;if(Zi.hours<dr.hours){if(ji&&wo)return!0}else if(ji||wo)return!0}else if(gi.hours===Je&&gi.minutes===yt)return!0;return!1});if(-1!==Bn)return Jn[Bn]}return function ti(Z,I,L){const j=(0,C.cg1)(Z),we=$r([j[C.wAp.DayPeriodsFormat],j[C.wAp.DayPeriodsStandalone]],I);return $r(we,L)}(I,ie,j)[Je<12?0:1];case It.Eras:return function xt(Z,I){return $r((0,C.cg1)(Z)[C.wAp.Eras],I)}(I,j)[Z.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${L}`)}}(ie,we,Z,I,L,j)}}function ri(Z){return function(I,L,j){const ie=-1*j,we=Bt(L,Xt.MinusSign),Je=ie>0?Math.floor(ie/60):Math.ceil(ie/60);switch(Z){case zt.Short:return(ie>=0?"+":"")+Zn(Je,2,we)+Zn(Math.abs(ie%60),2,we);case zt.ShortGMT:return"GMT"+(ie>=0?"+":"")+Zn(Je,1,we);case zt.Long:return"GMT"+(ie>=0?"+":"")+Zn(Je,2,we)+":"+Zn(Math.abs(ie%60),2,we);case zt.Extended:return 0===j?"Z":(ie>=0?"+":"")+Zn(Je,2,we)+":"+Zn(Math.abs(ie%60),2,we);default:throw new Error(`Unknown zone width "${Z}"`)}}}const Qi=0,Ir=4;function Be(Z){return Qt(Z.getFullYear(),Z.getMonth(),Z.getDate()+(Ir-Z.getDay()))}function Tt(Z,I=!1){return function(L,j){let ie;if(I){const we=new Date(L.getFullYear(),L.getMonth(),1).getDay()-1,Je=L.getDate();ie=1+Math.floor((Je+we)/7)}else{const we=Be(L),Je=function cn(Z){const I=Qt(Z,Qi,1).getDay();return Qt(Z,0,1+(I<=Ir?Ir:Ir+7)-I)}(we.getFullYear()),yt=we.getTime()-Je.getTime();ie=1+Math.round(yt/6048e5)}return Zn(ie,Z,Bt(j,Xt.MinusSign))}}function In(Z,I=!1){return function(L,j){return Zn(Be(L).getFullYear(),Z,Bt(j,Xt.MinusSign),I)}}const vn={};function Oi(Z,I){Z=Z.replace(/:/g,"");const L=Date.parse("Jan 01, 1970 00:00:00 "+Z)/6e4;return isNaN(L)?I:L}function qe(Z){return Z instanceof Date&&!isNaN(Z.valueOf())}const Ge=/^(\d+)?\.((\d+)(-(\d+))?)?$/,ye=22,ke=".",J="0",_e=";",Se=",",at="#",St="\xa4";function Dn(Z,I,L,j,ie){const Je=function si(Z,I="-"){const L={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},j=Z.split(_e),ie=j[0],we=j[1],Je=-1!==ie.indexOf(ke)?ie.split(ke):[ie.substring(0,ie.lastIndexOf(J)+1),ie.substring(ie.lastIndexOf(J)+1)],yt=Je[0],rn=Je[1]||"";L.posPre=yt.substring(0,yt.indexOf(at));for(let Jn=0;Jn<rn.length;Jn++){const Bn=rn.charAt(Jn);Bn===J?L.minFrac=L.maxFrac=Jn+1:Bn===at?L.maxFrac=Jn+1:L.posSuf+=Bn}const mn=yt.split(Se);if(L.gSize=mn[1]?mn[1].length:0,L.lgSize=mn[2]||mn[1]?(mn[2]||mn[1]).length:0,we){const Jn=ie.length-L.posPre.length-L.posSuf.length,Bn=we.indexOf(at);L.negPre=we.substring(0,Bn).replace(/'/g,""),L.negSuf=we.slice(Bn+Jn).replace(/'/g,"")}else L.negPre=I+L.posPre,L.negSuf=L.posSuf;return L}(function mi(Z,I){return(0,C.cg1)(Z)[C.wAp.NumberFormats][I]}(I,je.Currency),Bt(I,Xt.MinusSign));return Je.minFrac=function sn(Z){let I;const L=Pt[Z];return L&&(I=L[2]),"number"==typeof I?I:jr}(j),Je.maxFrac=Je.minFrac,function bn(Z,I,L,j,ie,we,Je=!1){let yt="",rn=!1;if(isFinite(Z)){let mn=function rs(Z){let j,ie,we,Je,yt,I=Math.abs(Z)+"",L=0;for((ie=I.indexOf(ke))>-1&&(I=I.replace(ke,"")),(we=I.search(/e/i))>0?(ie<0&&(ie=we),ie+=+I.slice(we+1),I=I.substring(0,we)):ie<0&&(ie=I.length),we=0;I.charAt(we)===J;we++);if(we===(yt=I.length))j=[0],ie=1;else{for(yt--;I.charAt(yt)===J;)yt--;for(ie-=we,j=[],Je=0;we<=yt;we++,Je++)j[Je]=Number(I.charAt(we))}return ie>ye&&(j=j.splice(0,ye-1),L=ie-1,ie=1),{digits:j,exponent:L,integerLen:ie}}(Z);Je&&(mn=function er(Z){if(0===Z.digits[0])return Z;const I=Z.digits.length-Z.integerLen;return Z.exponent?Z.exponent+=2:(0===I?Z.digits.push(0,0):1===I&&Z.digits.push(0),Z.integerLen+=2),Z}(mn));let Jn=I.minInt,Bn=I.minFrac,gi=I.maxFrac;if(we){const Bs=we.match(Ge);if(null===Bs)throw new Error(`${we} is not a valid digit info`);const Ps=Bs[1],xs=Bs[3],uo=Bs[5];null!=Ps&&(Jn=zs(Ps)),null!=xs&&(Bn=zs(xs)),null!=uo?gi=zs(uo):null!=xs&&Bn>gi&&(gi=Bn)}!function Er(Z,I,L){if(I>L)throw new Error(`The minimum number of digits after fraction (${I}) is higher than the maximum (${L}).`);let j=Z.digits,ie=j.length-Z.integerLen;const we=Math.min(Math.max(I,ie),L);let Je=we+Z.integerLen,yt=j[Je];if(Je>0){j.splice(Math.max(Z.integerLen,Je));for(let Bn=Je;Bn<j.length;Bn++)j[Bn]=0}else{ie=Math.max(0,ie),Z.integerLen=1,j.length=Math.max(1,Je=we+1),j[0]=0;for(let Bn=1;Bn<Je;Bn++)j[Bn]=0}if(yt>=5)if(Je-1<0){for(let Bn=0;Bn>Je;Bn--)j.unshift(0),Z.integerLen++;j.unshift(1),Z.integerLen++}else j[Je-1]++;for(;ie<Math.max(0,we);ie++)j.push(0);let rn=0!==we;const mn=I+Z.integerLen,Jn=j.reduceRight(function(Bn,gi,Zi,dr){return dr[Zi]=(gi+=Bn)<10?gi:gi-10,rn&&(0===dr[Zi]&&Zi>=mn?dr.pop():rn=!1),gi>=10?1:0},0);Jn&&(j.unshift(Jn),Z.integerLen++)}(mn,Bn,gi);let Zi=mn.digits,dr=mn.integerLen;const ji=mn.exponent;let wo=[];for(rn=Zi.every(Bs=>!Bs);dr<Jn;dr++)Zi.unshift(0);for(;dr<0;dr++)Zi.unshift(0);dr>0?wo=Zi.splice(dr,Zi.length):(wo=Zi,Zi=[0]);const No=[];for(Zi.length>=I.lgSize&&No.unshift(Zi.splice(-I.lgSize,Zi.length).join(""));Zi.length>I.gSize;)No.unshift(Zi.splice(-I.gSize,Zi.length).join(""));Zi.length&&No.unshift(Zi.join("")),yt=No.join(Bt(L,j)),wo.length&&(yt+=Bt(L,ie)+wo.join("")),ji&&(yt+=Bt(L,Xt.Exponential)+"+"+ji)}else yt=Bt(L,Xt.Infinity);return yt=Z<0&&!rn?I.negPre+yt+I.negSuf:I.posPre+yt+I.posSuf,yt}(Z,Je,I,Xt.CurrencyGroup,Xt.CurrencyDecimal,ie).replace(St,L).replace(St,"").trim()}function zs(Z){const I=parseInt(Z);if(isNaN(I))throw new Error("Invalid integer literal when parsing "+Z);return I}function ro(Z,I){I=encodeURIComponent(I);for(const L of Z.split(";")){const j=L.indexOf("="),[ie,we]=-1==j?[L,""]:[L.slice(0,j),L.slice(j+1)];if(ie.trim()===I)return decodeURIComponent(we)}return null}const Os=/\s+/,e1=[];let Oa=(()=>{class Z{constructor(L,j,ie,we){this._iterableDiffers=L,this._keyValueDiffers=j,this._ngEl=ie,this._renderer=we,this.initialClasses=e1,this.stateMap=new Map}set klass(L){this.initialClasses=null!=L?L.trim().split(Os):e1}set ngClass(L){this.rawClass="string"==typeof L?L.trim().split(Os):L}ngDoCheck(){for(const j of this.initialClasses)this._updateState(j,!0);const L=this.rawClass;if(Array.isArray(L)||L instanceof Set)for(const j of L)this._updateState(j,!0);else if(null!=L)for(const j of Object.keys(L))this._updateState(j,Boolean(L[j]));this._applyStateDiff()}_updateState(L,j){const ie=this.stateMap.get(L);void 0!==ie?(ie.enabled!==j&&(ie.changed=!0,ie.enabled=j),ie.touched=!0):this.stateMap.set(L,{enabled:j,changed:!0,touched:!0})}_applyStateDiff(){for(const L of this.stateMap){const j=L[0],ie=L[1];ie.changed?(this._toggleClass(j,ie.enabled),ie.changed=!1):ie.touched||(ie.enabled&&this._toggleClass(j,!1),this.stateMap.delete(j)),ie.touched=!1}}_toggleClass(L,j){(L=L.trim()).length>0&&L.split(Os).forEach(ie=>{j?this._renderer.addClass(this._ngEl.nativeElement,ie):this._renderer.removeClass(this._ngEl.nativeElement,ie)})}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.ZZ4),C.Y36(C.aQg),C.Y36(C.SBq),C.Y36(C.Qsj))},Z.\u0275dir=C.lG2({type:Z,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),Z})();class qi{constructor(I,L,j,ie){this.$implicit=I,this.ngForOf=L,this.index=j,this.count=ie}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Sr=(()=>{class Z{set ngForOf(L){this._ngForOf=L,this._ngForOfDirty=!0}set ngForTrackBy(L){this._trackByFn=L}get ngForTrackBy(){return this._trackByFn}constructor(L,j,ie){this._viewContainer=L,this._template=j,this._differs=ie,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(L){L&&(this._template=L)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const L=this._ngForOf;!this._differ&&L&&(this._differ=this._differs.find(L).create(this.ngForTrackBy))}if(this._differ){const L=this._differ.diff(this._ngForOf);L&&this._applyChanges(L)}}_applyChanges(L){const j=this._viewContainer;L.forEachOperation((ie,we,Je)=>{if(null==ie.previousIndex)j.createEmbeddedView(this._template,new qi(ie.item,this._ngForOf,-1,-1),null===Je?void 0:Je);else if(null==Je)j.remove(null===we?void 0:we);else if(null!==we){const yt=j.get(we);j.move(yt,Je),Pi(yt,ie)}});for(let ie=0,we=j.length;ie<we;ie++){const yt=j.get(ie).context;yt.index=ie,yt.count=we,yt.ngForOf=this._ngForOf}L.forEachIdentityChange(ie=>{Pi(j.get(ie.currentIndex),ie)})}static ngTemplateContextGuard(L,j){return!0}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.s_b),C.Y36(C.Rgc),C.Y36(C.ZZ4))},Z.\u0275dir=C.lG2({type:Z,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),Z})();function Pi(Z,I){Z.context.$implicit=I.item}let js=(()=>{class Z{constructor(L,j){this._viewContainer=L,this._context=new sa,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=j}set ngIf(L){this._context.$implicit=this._context.ngIf=L,this._updateView()}set ngIfThen(L){ps("ngIfThen",L),this._thenTemplateRef=L,this._thenViewRef=null,this._updateView()}set ngIfElse(L){ps("ngIfElse",L),this._elseTemplateRef=L,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(L,j){return!0}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.s_b),C.Y36(C.Rgc))},Z.\u0275dir=C.lG2({type:Z,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),Z})();class sa{constructor(){this.$implicit=null,this.ngIf=null}}function ps(Z,I){if(I&&!I.createEmbeddedView)throw new Error(`${Z} must be a TemplateRef, but received '${(0,C.AaK)(I)}'.`)}let es=(()=>{class Z{constructor(L,j,ie){this._ngEl=L,this._differs=j,this._renderer=ie,this._ngStyle=null,this._differ=null}set ngStyle(L){this._ngStyle=L,!this._differ&&L&&(this._differ=this._differs.find(L).create())}ngDoCheck(){if(this._differ){const L=this._differ.diff(this._ngStyle);L&&this._applyChanges(L)}}_setStyle(L,j){const[ie,we]=L.split("."),Je=-1===ie.indexOf("-")?void 0:C.JOm.DashCase;null!=j?this._renderer.setStyle(this._ngEl.nativeElement,ie,we?`${j}${we}`:j,Je):this._renderer.removeStyle(this._ngEl.nativeElement,ie,Je)}_applyChanges(L){L.forEachRemovedItem(j=>this._setStyle(j.key,null)),L.forEachAddedItem(j=>this._setStyle(j.key,j.currentValue)),L.forEachChangedItem(j=>this._setStyle(j.key,j.currentValue))}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.SBq),C.Y36(C.aQg),C.Y36(C.Qsj))},Z.\u0275dir=C.lG2({type:Z,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),Z})(),ho=(()=>{class Z{constructor(L){this._viewContainerRef=L,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(L){if(L.ngTemplateOutlet||L.ngTemplateOutletInjector){const j=this._viewContainerRef;if(this._viewRef&&j.remove(j.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:ie,ngTemplateOutletContext:we,ngTemplateOutletInjector:Je}=this;this._viewRef=j.createEmbeddedView(ie,we,Je?{injector:Je}:void 0)}else this._viewRef=null}else this._viewRef&&L.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.s_b))},Z.\u0275dir=C.lG2({type:Z,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[C.TTD]}),Z})();function Cs(Z,I){return new C.vHH(2100,!1)}class fo{createSubscription(I,L){return I.subscribe({next:L,error:j=>{throw j}})}dispose(I){I.unsubscribe()}}class _a{createSubscription(I,L){return I.then(L,j=>{throw j})}dispose(I){}}const _r=new _a,vs=new fo;let ci=(()=>{class Z{constructor(L){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=L}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(L){return this._obj?L!==this._obj?(this._dispose(),this.transform(L)):this._latestValue:(L&&this._subscribe(L),this._latestValue)}_subscribe(L){this._obj=L,this._strategy=this._selectStrategy(L),this._subscription=this._strategy.createSubscription(L,j=>this._updateLatestValue(L,j))}_selectStrategy(L){if((0,C.QGY)(L))return _r;if((0,C.F4k)(L))return vs;throw Cs()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(L,j){L===this._obj&&(this._latestValue=j,this._ref.markForCheck())}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.sBO,16))},Z.\u0275pipe=C.Yjl({name:"async",type:Z,pure:!1,standalone:!0}),Z})();const Ci=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let As=(()=>{class Z{transform(L){if(null==L)return null;if("string"!=typeof L)throw Cs();return L.replace(Ci,j=>j[0].toUpperCase()+j.slice(1).toLowerCase())}}return Z.\u0275fac=function(L){return new(L||Z)},Z.\u0275pipe=C.Yjl({name:"titlecase",type:Z,pure:!0,standalone:!0}),Z})();const Gs=new C.OlP("DATE_PIPE_DEFAULT_TIMEZONE"),Qn=new C.OlP("DATE_PIPE_DEFAULT_OPTIONS");let Ls=(()=>{class Z{constructor(L,j,ie){this.locale=L,this.defaultTimezone=j,this.defaultOptions=ie}transform(L,j,ie,we){if(null==L||""===L||L!=L)return null;try{return Hn(L,j??this.defaultOptions?.dateFormat??"mediumDate",we||this.locale,ie??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(Je){throw Cs()}}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.soG,16),C.Y36(Gs,24),C.Y36(Qn,24))},Z.\u0275pipe=C.Yjl({name:"date",type:Z,pure:!0,standalone:!0}),Z})(),_1=(()=>{class Z{constructor(L,j="USD"){this._locale=L,this._defaultCurrencyCode=j}transform(L,j=this._defaultCurrencyCode,ie="symbol",we,Je){if(!function yo(Z){return!(null==Z||""===Z||Z!=Z)}(L))return null;Je=Je||this._locale,"boolean"==typeof ie&&(ie=ie?"symbol":"code");let yt=j||this._defaultCurrencyCode;"code"!==ie&&(yt="symbol"===ie||"symbol-narrow"===ie?function ir(Z,I,L="en"){const j=function Br(Z){return(0,C.cg1)(Z)[C.wAp.Currencies]}(L)[Z]||Pt[Z]||[],ie=j[1];return"narrow"===I&&"string"==typeof ie?ie:j[0]||Z}(yt,"symbol"===ie?"wide":"narrow",Je):ie);try{return Dn(function oa(Z){if("string"==typeof Z&&!isNaN(Number(Z)-parseFloat(Z)))return Number(Z);if("number"!=typeof Z)throw new Error(`${Z} is not a number`);return Z}(L),Je,yt,j,we)}catch(rn){throw Cs()}}}return Z.\u0275fac=function(L){return new(L||Z)(C.Y36(C.soG,16),C.Y36(C.EJc,16))},Z.\u0275pipe=C.Yjl({name:"currency",type:Z,pure:!0,standalone:!0}),Z})();let Fo=(()=>{class Z{}return Z.\u0275fac=function(L){return new(L||Z)},Z.\u0275mod=C.oAB({type:Z}),Z.\u0275inj=C.cJS({}),Z})();const Xo="browser";function cr(Z){return Z===Xo}let Qo=(()=>{class Z{}return Z.\u0275prov=(0,C.Yz7)({token:Z,providedIn:"root",factory:()=>new ao((0,C.LFG)(de),window)}),Z})();class ao{constructor(I,L){this.document=I,this.window=L,this.offset=()=>[0,0]}setOffset(I){this.offset=Array.isArray(I)?()=>I:I}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(I){this.supportsScrolling()&&this.window.scrollTo(I[0],I[1])}scrollToAnchor(I){if(!this.supportsScrolling())return;const L=function Ho(Z,I){const L=Z.getElementById(I)||Z.getElementsByName(I)[0];if(L)return L;if("function"==typeof Z.createTreeWalker&&Z.body&&(Z.body.createShadowRoot||Z.body.attachShadow)){const j=Z.createTreeWalker(Z.body,NodeFilter.SHOW_ELEMENT);let ie=j.currentNode;for(;ie;){const we=ie.shadowRoot;if(we){const Je=we.getElementById(I)||we.querySelector(`[name="${I}"]`);if(Je)return Je}ie=j.nextNode()}}return null}(this.document,I);L&&(this.scrollToElement(L),L.focus())}setHistoryScrollRestoration(I){if(this.supportScrollRestoration()){const L=this.window.history;L&&L.scrollRestoration&&(L.scrollRestoration=I)}}scrollToElement(I){const L=I.getBoundingClientRect(),j=L.left+this.window.pageXOffset,ie=L.top+this.window.pageYOffset,we=this.offset();this.window.scrollTo(j-we[0],ie-we[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const I=Ua(this.window.history)||Ua(Object.getPrototypeOf(this.window.history));return!(!I||!I.writable&&!I.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Ua(Z){return Object.getOwnPropertyDescriptor(Z,"scrollRestoration")}class Po{}},529:(yi,on,ue)=>{"use strict";ue.d(on,{JF:()=>ri,LE:()=>hn,TP:()=>xt,WM:()=>jt,eN:()=>Wi});var C=ue(6895),De=ue(1571),Xe=ue(9646),s=ue(9751),ct=ue(4351),de=ue(9300),Et=ue(4004);class qt{}class gt{}class jt{constructor(Be){this.normalizedNames=new Map,this.lazyUpdate=null,Be?this.lazyInit="string"==typeof Be?()=>{this.headers=new Map,Be.split("\n").forEach(Tt=>{const In=Tt.indexOf(":");if(In>0){const vn=Tt.slice(0,In),ei=vn.toLowerCase(),Oi=Tt.slice(In+1).trim();this.maybeSetNormalizedName(vn,ei),this.headers.has(ei)?this.headers.get(ei).push(Oi):this.headers.set(ei,[Oi])}})}:()=>{this.headers=new Map,Object.entries(Be).forEach(([Tt,In])=>{let vn;if(vn="string"==typeof In?[In]:"number"==typeof In?[In.toString()]:In.map(ei=>ei.toString()),vn.length>0){const ei=Tt.toLowerCase();this.headers.set(ei,vn),this.maybeSetNormalizedName(Tt,ei)}})}:this.headers=new Map}has(Be){return this.init(),this.headers.has(Be.toLowerCase())}get(Be){this.init();const Tt=this.headers.get(Be.toLowerCase());return Tt&&Tt.length>0?Tt[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Be){return this.init(),this.headers.get(Be.toLowerCase())||null}append(Be,Tt){return this.clone({name:Be,value:Tt,op:"a"})}set(Be,Tt){return this.clone({name:Be,value:Tt,op:"s"})}delete(Be,Tt){return this.clone({name:Be,value:Tt,op:"d"})}maybeSetNormalizedName(Be,Tt){this.normalizedNames.has(Tt)||this.normalizedNames.set(Tt,Be)}init(){this.lazyInit&&(this.lazyInit instanceof jt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Be=>this.applyUpdate(Be)),this.lazyUpdate=null))}copyFrom(Be){Be.init(),Array.from(Be.headers.keys()).forEach(Tt=>{this.headers.set(Tt,Be.headers.get(Tt)),this.normalizedNames.set(Tt,Be.normalizedNames.get(Tt))})}clone(Be){const Tt=new jt;return Tt.lazyInit=this.lazyInit&&this.lazyInit instanceof jt?this.lazyInit:this,Tt.lazyUpdate=(this.lazyUpdate||[]).concat([Be]),Tt}applyUpdate(Be){const Tt=Be.name.toLowerCase();switch(Be.op){case"a":case"s":let In=Be.value;if("string"==typeof In&&(In=[In]),0===In.length)return;this.maybeSetNormalizedName(Be.name,Tt);const vn=("a"===Be.op?this.headers.get(Tt):void 0)||[];vn.push(...In),this.headers.set(Tt,vn);break;case"d":const ei=Be.value;if(ei){let Oi=this.headers.get(Tt);if(!Oi)return;Oi=Oi.filter(kt=>-1===ei.indexOf(kt)),0===Oi.length?(this.headers.delete(Tt),this.normalizedNames.delete(Tt)):this.headers.set(Tt,Oi)}else this.headers.delete(Tt),this.normalizedNames.delete(Tt)}}forEach(Be){this.init(),Array.from(this.normalizedNames.keys()).forEach(Tt=>Be(this.normalizedNames.get(Tt),this.headers.get(Tt)))}}class Gt{encodeKey(Be){return dn(Be)}encodeValue(Be){return dn(Be)}decodeKey(Be){return decodeURIComponent(Be)}decodeValue(Be){return decodeURIComponent(Be)}}const Sn=/%(\d[a-f0-9])/gi,En={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function dn(cn){return encodeURIComponent(cn).replace(Sn,(Be,Tt)=>En[Tt]??Be)}function ii(cn){return`${cn}`}class hn{constructor(Be={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Be.encoder||new Gt,Be.fromString){if(Be.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Kn(cn,Be){const Tt=new Map;return cn.length>0&&cn.replace(/^\?/,"").split("&").forEach(vn=>{const ei=vn.indexOf("="),[Oi,kt]=-1==ei?[Be.decodeKey(vn),""]:[Be.decodeKey(vn.slice(0,ei)),Be.decodeValue(vn.slice(ei+1))],Ht=Tt.get(Oi)||[];Ht.push(kt),Tt.set(Oi,Ht)}),Tt}(Be.fromString,this.encoder)}else Be.fromObject?(this.map=new Map,Object.keys(Be.fromObject).forEach(Tt=>{const In=Be.fromObject[Tt],vn=Array.isArray(In)?In.map(ii):[ii(In)];this.map.set(Tt,vn)})):this.map=null}has(Be){return this.init(),this.map.has(Be)}get(Be){this.init();const Tt=this.map.get(Be);return Tt?Tt[0]:null}getAll(Be){return this.init(),this.map.get(Be)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Be,Tt){return this.clone({param:Be,value:Tt,op:"a"})}appendAll(Be){const Tt=[];return Object.keys(Be).forEach(In=>{const vn=Be[In];Array.isArray(vn)?vn.forEach(ei=>{Tt.push({param:In,value:ei,op:"a"})}):Tt.push({param:In,value:vn,op:"a"})}),this.clone(Tt)}set(Be,Tt){return this.clone({param:Be,value:Tt,op:"s"})}delete(Be,Tt){return this.clone({param:Be,value:Tt,op:"d"})}toString(){return this.init(),this.keys().map(Be=>{const Tt=this.encoder.encodeKey(Be);return this.map.get(Be).map(In=>Tt+"="+this.encoder.encodeValue(In)).join("&")}).filter(Be=>""!==Be).join("&")}clone(Be){const Tt=new hn({encoder:this.encoder});return Tt.cloneFrom=this.cloneFrom||this,Tt.updates=(this.updates||[]).concat(Be),Tt}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Be=>this.map.set(Be,this.cloneFrom.map.get(Be))),this.updates.forEach(Be=>{switch(Be.op){case"a":case"s":const Tt=("a"===Be.op?this.map.get(Be.param):void 0)||[];Tt.push(ii(Be.value)),this.map.set(Be.param,Tt);break;case"d":if(void 0===Be.value){this.map.delete(Be.param);break}{let In=this.map.get(Be.param)||[];const vn=In.indexOf(ii(Be.value));-1!==vn&&In.splice(vn,1),In.length>0?this.map.set(Be.param,In):this.map.delete(Be.param)}}}),this.cloneFrom=this.updates=null)}}class hi{constructor(){this.map=new Map}set(Be,Tt){return this.map.set(Be,Tt),this}get(Be){return this.map.has(Be)||this.map.set(Be,Be.defaultValue()),this.map.get(Be)}delete(Be){return this.map.delete(Be),this}has(Be){return this.map.has(Be)}keys(){return this.map.keys()}}function _t(cn){return typeof ArrayBuffer<"u"&&cn instanceof ArrayBuffer}function Ue(cn){return typeof Blob<"u"&&cn instanceof Blob}function Ye(cn){return typeof FormData<"u"&&cn instanceof FormData}class je{constructor(Be,Tt,In,vn){let ei;if(this.url=Tt,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Be.toUpperCase(),function Te(cn){switch(cn){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||vn?(this.body=void 0!==In?In:null,ei=vn):ei=In,ei&&(this.reportProgress=!!ei.reportProgress,this.withCredentials=!!ei.withCredentials,ei.responseType&&(this.responseType=ei.responseType),ei.headers&&(this.headers=ei.headers),ei.context&&(this.context=ei.context),ei.params&&(this.params=ei.params)),this.headers||(this.headers=new jt),this.context||(this.context=new hi),this.params){const Oi=this.params.toString();if(0===Oi.length)this.urlWithParams=Tt;else{const kt=Tt.indexOf("?");this.urlWithParams=Tt+(-1===kt?"?":kt<Tt.length-1?"&":"")+Oi}}else this.params=new hn,this.urlWithParams=Tt}serializeBody(){return null===this.body?null:_t(this.body)||Ue(this.body)||Ye(this.body)||function Pt(cn){return typeof URLSearchParams<"u"&&cn instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof hn?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Ye(this.body)?null:Ue(this.body)?this.body.type||null:_t(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof hn?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Be={}){const Tt=Be.method||this.method,In=Be.url||this.url,vn=Be.responseType||this.responseType,ei=void 0!==Be.body?Be.body:this.body,Oi=void 0!==Be.withCredentials?Be.withCredentials:this.withCredentials,kt=void 0!==Be.reportProgress?Be.reportProgress:this.reportProgress;let Ht=Be.headers||this.headers,an=Be.params||this.params;const _n=Be.context??this.context;return void 0!==Be.setHeaders&&(Ht=Object.keys(Be.setHeaders).reduce((qe,Ge)=>qe.set(Ge,Be.setHeaders[Ge]),Ht)),Be.setParams&&(an=Object.keys(Be.setParams).reduce((qe,Ge)=>qe.set(Ge,Be.setParams[Ge]),an)),new je(Tt,In,ei,{params:an,headers:Ht,context:_n,reportProgress:kt,responseType:vn,withCredentials:Oi})}}var Ze=(()=>((Ze=Ze||{})[Ze.Sent=0]="Sent",Ze[Ze.UploadProgress=1]="UploadProgress",Ze[Ze.ResponseHeader=2]="ResponseHeader",Ze[Ze.DownloadProgress=3]="DownloadProgress",Ze[Ze.Response=4]="Response",Ze[Ze.User=5]="User",Ze))();class ot{constructor(Be,Tt=200,In="OK"){this.headers=Be.headers||new jt,this.status=void 0!==Be.status?Be.status:Tt,this.statusText=Be.statusText||In,this.url=Be.url||null,this.ok=this.status>=200&&this.status<300}}class pt extends ot{constructor(Be={}){super(Be),this.type=Ze.ResponseHeader}clone(Be={}){return new pt({headers:Be.headers||this.headers,status:void 0!==Be.status?Be.status:this.status,statusText:Be.statusText||this.statusText,url:Be.url||this.url||void 0})}}class Ot extends ot{constructor(Be={}){super(Be),this.type=Ze.Response,this.body=void 0!==Be.body?Be.body:null}clone(Be={}){return new Ot({body:void 0!==Be.body?Be.body:this.body,headers:Be.headers||this.headers,status:void 0!==Be.status?Be.status:this.status,statusText:Be.statusText||this.statusText,url:Be.url||this.url||void 0})}}class Xt extends ot{constructor(Be){super(Be,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Be.url||"(unknown url)"}`:`Http failure response for ${Be.url||"(unknown url)"}: ${Be.status} ${Be.statusText}`,this.error=Be.error||null}}function Mi(cn,Be){return{body:Be,headers:cn.headers,context:cn.context,observe:cn.observe,params:cn.params,reportProgress:cn.reportProgress,responseType:cn.responseType,withCredentials:cn.withCredentials}}let Wi=(()=>{class cn{constructor(Tt){this.handler=Tt}request(Tt,In,vn={}){let ei;if(Tt instanceof je)ei=Tt;else{let Ht,an;Ht=vn.headers instanceof jt?vn.headers:new jt(vn.headers),vn.params&&(an=vn.params instanceof hn?vn.params:new hn({fromObject:vn.params})),ei=new je(Tt,In,void 0!==vn.body?vn.body:null,{headers:Ht,context:vn.context,params:an,reportProgress:vn.reportProgress,responseType:vn.responseType||"json",withCredentials:vn.withCredentials})}const Oi=(0,Xe.of)(ei).pipe((0,ct.b)(Ht=>this.handler.handle(Ht)));if(Tt instanceof je||"events"===vn.observe)return Oi;const kt=Oi.pipe((0,de.h)(Ht=>Ht instanceof Ot));switch(vn.observe||"body"){case"body":switch(ei.responseType){case"arraybuffer":return kt.pipe((0,Et.U)(Ht=>{if(null!==Ht.body&&!(Ht.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Ht.body}));case"blob":return kt.pipe((0,Et.U)(Ht=>{if(null!==Ht.body&&!(Ht.body instanceof Blob))throw new Error("Response is not a Blob.");return Ht.body}));case"text":return kt.pipe((0,Et.U)(Ht=>{if(null!==Ht.body&&"string"!=typeof Ht.body)throw new Error("Response is not a string.");return Ht.body}));default:return kt.pipe((0,Et.U)(Ht=>Ht.body))}case"response":return kt;default:throw new Error(`Unreachable: unhandled observe type ${vn.observe}}`)}}delete(Tt,In={}){return this.request("DELETE",Tt,In)}get(Tt,In={}){return this.request("GET",Tt,In)}head(Tt,In={}){return this.request("HEAD",Tt,In)}jsonp(Tt,In){return this.request("JSONP",Tt,{params:(new hn).append(In,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Tt,In={}){return this.request("OPTIONS",Tt,In)}patch(Tt,In,vn={}){return this.request("PATCH",Tt,Mi(vn,In))}post(Tt,In,vn={}){return this.request("POST",Tt,Mi(vn,In))}put(Tt,In,vn={}){return this.request("PUT",Tt,Mi(vn,In))}}return cn.\u0275fac=function(Tt){return new(Tt||cn)(De.LFG(qt))},cn.\u0275prov=De.Yz7({token:cn,factory:cn.\u0275fac}),cn})();function ti(cn,Be){return Be(cn)}function Tn(cn,Be){return(Tt,In)=>Be.intercept(Tt,{handle:vn=>cn(vn,In)})}const xt=new De.OlP("HTTP_INTERCEPTORS"),ht=new De.OlP("HTTP_INTERCEPTOR_FNS");function st(){let cn=null;return(Be,Tt)=>(null===cn&&(cn=((0,De.f3M)(xt,{optional:!0})??[]).reduceRight(Tn,ti)),cn(Be,Tt))}let Ne=(()=>{class cn extends qt{constructor(Tt,In){super(),this.backend=Tt,this.injector=In,this.chain=null}handle(Tt){if(null===this.chain){const In=Array.from(new Set(this.injector.get(ht)));this.chain=In.reduceRight((vn,ei)=>function rt(cn,Be,Tt){return(In,vn)=>Tt.runInContext(()=>Be(In,ei=>cn(ei,vn)))}(vn,ei,this.injector),ti)}return this.chain(Tt,In=>this.backend.handle(In))}}return cn.\u0275fac=function(Tt){return new(Tt||cn)(De.LFG(gt),De.LFG(De.lqb))},cn.\u0275prov=De.Yz7({token:cn,factory:cn.\u0275fac}),cn})();const Xi=/^\)\]\}',?\n/;let $r=(()=>{class cn{constructor(Tt){this.xhrFactory=Tt}handle(Tt){if("JSONP"===Tt.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new s.y(In=>{const vn=this.xhrFactory.build();if(vn.open(Tt.method,Tt.urlWithParams),Tt.withCredentials&&(vn.withCredentials=!0),Tt.headers.forEach((ye,ke)=>vn.setRequestHeader(ye,ke.join(","))),Tt.headers.has("Accept")||vn.setRequestHeader("Accept","application/json, text/plain, */*"),!Tt.headers.has("Content-Type")){const ye=Tt.detectContentTypeHeader();null!==ye&&vn.setRequestHeader("Content-Type",ye)}if(Tt.responseType){const ye=Tt.responseType.toLowerCase();vn.responseType="json"!==ye?ye:"text"}const ei=Tt.serializeBody();let Oi=null;const kt=()=>{if(null!==Oi)return Oi;const ye=vn.statusText||"OK",ke=new jt(vn.getAllResponseHeaders()),J=function Rs(cn){return"responseURL"in cn&&cn.responseURL?cn.responseURL:/^X-Request-URL:/m.test(cn.getAllResponseHeaders())?cn.getResponseHeader("X-Request-URL"):null}(vn)||Tt.url;return Oi=new pt({headers:ke,status:vn.status,statusText:ye,url:J}),Oi},Ht=()=>{let{headers:ye,status:ke,statusText:J,url:_e}=kt(),Se=null;204!==ke&&(Se=typeof vn.response>"u"?vn.responseText:vn.response),0===ke&&(ke=Se?200:0);let at=ke>=200&&ke<300;if("json"===Tt.responseType&&"string"==typeof Se){const St=Se;Se=Se.replace(Xi,"");try{Se=""!==Se?JSON.parse(Se):null}catch(nn){Se=St,at&&(at=!1,Se={error:nn,text:Se})}}at?(In.next(new Ot({body:Se,headers:ye,status:ke,statusText:J,url:_e||void 0})),In.complete()):In.error(new Xt({error:Se,headers:ye,status:ke,statusText:J,url:_e||void 0}))},an=ye=>{const{url:ke}=kt(),J=new Xt({error:ye,status:vn.status||0,statusText:vn.statusText||"Unknown Error",url:ke||void 0});In.error(J)};let _n=!1;const qe=ye=>{_n||(In.next(kt()),_n=!0);let ke={type:Ze.DownloadProgress,loaded:ye.loaded};ye.lengthComputable&&(ke.total=ye.total),"text"===Tt.responseType&&vn.responseText&&(ke.partialText=vn.responseText),In.next(ke)},Ge=ye=>{let ke={type:Ze.UploadProgress,loaded:ye.loaded};ye.lengthComputable&&(ke.total=ye.total),In.next(ke)};return vn.addEventListener("load",Ht),vn.addEventListener("error",an),vn.addEventListener("timeout",an),vn.addEventListener("abort",an),Tt.reportProgress&&(vn.addEventListener("progress",qe),null!==ei&&vn.upload&&vn.upload.addEventListener("progress",Ge)),vn.send(ei),In.next({type:Ze.Sent}),()=>{vn.removeEventListener("error",an),vn.removeEventListener("abort",an),vn.removeEventListener("load",Ht),vn.removeEventListener("timeout",an),Tt.reportProgress&&(vn.removeEventListener("progress",qe),null!==ei&&vn.upload&&vn.upload.removeEventListener("progress",Ge)),vn.readyState!==vn.DONE&&vn.abort()}})}}return cn.\u0275fac=function(Tt){return new(Tt||cn)(De.LFG(C.JF))},cn.\u0275prov=De.Yz7({token:cn,factory:cn.\u0275fac}),cn})();const Ji=new De.OlP("XSRF_ENABLED"),jr=new De.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),me=new De.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class He{}let it=(()=>{class cn{constructor(Tt,In,vn){this.doc=Tt,this.platform=In,this.cookieName=vn,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Tt=this.doc.cookie||"";return Tt!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,C.Mx)(Tt,this.cookieName),this.lastCookieString=Tt),this.lastToken}}return cn.\u0275fac=function(Tt){return new(Tt||cn)(De.LFG(C.K0),De.LFG(De.Lbi),De.LFG(jr))},cn.\u0275prov=De.Yz7({token:cn,factory:cn.\u0275fac}),cn})();function zt(cn,Be){const Tt=cn.url.toLowerCase();if(!(0,De.f3M)(Ji)||"GET"===cn.method||"HEAD"===cn.method||Tt.startsWith("http://")||Tt.startsWith("https://"))return Be(cn);const In=(0,De.f3M)(He).getToken(),vn=(0,De.f3M)(me);return null!=In&&!cn.headers.has(vn)&&(cn=cn.clone({headers:cn.headers.set(vn,In)})),Be(cn)}var It=(()=>((It=It||{})[It.Interceptors=0]="Interceptors",It[It.LegacyInterceptors=1]="LegacyInterceptors",It[It.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",It[It.NoXsrfProtection=3]="NoXsrfProtection",It[It.JsonpSupport=4]="JsonpSupport",It[It.RequestsMadeViaParent=5]="RequestsMadeViaParent",It))();function Hn(cn,Be){return{\u0275kind:cn,\u0275providers:Be}}function Qt(...cn){const Be=[Wi,$r,Ne,{provide:qt,useExisting:Ne},{provide:gt,useExisting:$r},{provide:ht,useValue:zt,multi:!0},{provide:Ji,useValue:!0},{provide:He,useClass:it}];for(const Tt of cn)Be.push(...Tt.\u0275providers);return(0,De.MR2)(Be)}const Wn=new De.OlP("LEGACY_INTERCEPTOR_FN");let ri=(()=>{class cn{}return cn.\u0275fac=function(Tt){return new(Tt||cn)},cn.\u0275mod=De.oAB({type:cn}),cn.\u0275inj=De.cJS({providers:[Qt(Hn(It.LegacyInterceptors,[{provide:Wn,useFactory:st},{provide:ht,useExisting:Wn,multi:!0}]))]}),cn})()},1571:(yi,on,ue)=>{"use strict";ue.d(on,{QbO:()=>g2,tb:()=>Sm,AFp:()=>Xa,ip1:()=>Lo,CZH:()=>Ko,hGG:()=>_7,z2F:()=>xp,sBO:()=>r7,Sil:()=>mp,_Vd:()=>Q4,EJc:()=>L2,Xts:()=>Mu,SBq:()=>K1,lqb:()=>dl,qLn:()=>rc,vpe:()=>F1,XFs:()=>me,OlP:()=>vr,zs3:()=>gl,ZZ4:()=>lm,aQg:()=>Tp,soG:()=>g1,YKP:()=>wf,h0i:()=>dc,PXZ:()=>Xm,R0b:()=>_2,FiY:()=>N1,Lbi:()=>Ja,g9A:()=>Ta,n_E:()=>Jc,Qsj:()=>pd,FYo:()=>G6,JOm:()=>h2,q3G:()=>Ra,tp0:()=>tl,Rgc:()=>iu,dDg:()=>Zm,eoX:()=>Cm,GfV:()=>W6,s_b:()=>ru,ifc:()=>Ge,MMx:()=>J0,Lck:()=>Z8,eFA:()=>J5,Gpc:()=>En,f3M:()=>In,$WT:()=>ro,MR2:()=>sd,_c5:()=>g7,c2e:()=>Qc,zSh:()=>Y4,wAp:()=>Vr,vHH:()=>Te,lri:()=>bm,rWj:()=>wm,JZr:()=>hi,EiD:()=>j3,mCW:()=>ra,qzn:()=>Us,JVY:()=>ts,pB0:()=>ss,eBb:()=>Jr,L6k:()=>Rr,LAX:()=>Ys,D6c:()=>v7,cg1:()=>R0,kL8:()=>O0,dqk:()=>Hn,Z0I:()=>Si,eJc:()=>n,CqO:()=>i8,QGY:()=>zh,F4k:()=>n8,RDi:()=>Un,AaK:()=>Gt,z3N:()=>xr,qOj:()=>e4,TTD:()=>Ho,_Bn:()=>D6,jDz:()=>M4,xp6:()=>ku,uIk:()=>t6,Tol:()=>u8,ekj:()=>jh,Suo:()=>up,Xpm:()=>Dn,lG2:()=>zs,Yz7:()=>Gi,cJS:()=>Hr,oAB:()=>er,Yjl:()=>Qs,Y36:()=>q3,_UZ:()=>C0,GkF:()=>r6,BQk:()=>S0,ynx:()=>M0,qZA:()=>w0,TgZ:()=>i6,EpF:()=>s6,n5z:()=>he,Ikx:()=>rf,LFG:()=>Be,$8M:()=>fn,$Z:()=>l0,NdJ:()=>Zc,CRH:()=>hp,kcU:()=>l2,O4$:()=>X2,oxw:()=>o8,ALo:()=>T4,lcZ:()=>Nf,xi3:()=>sp,Hsn:()=>a8,F$t:()=>a6,Q6J:()=>n6,s9C:()=>Lh,MGl:()=>u3,DdM:()=>Af,VKq:()=>Lf,WLB:()=>tp,kEZ:()=>V6,HTZ:()=>Df,iGM:()=>$f,MAs:()=>Th,KtG:()=>Eo,evT:()=>Vu,CHM:()=>ms,oJD:()=>id,LSH:()=>ma,P3R:()=>Cu,Udp:()=>Uh,d8E:()=>k0,YNc:()=>Sh,W1O:()=>z4,_uU:()=>f6,Oqu:()=>Zh,hij:()=>I0,AsE:()=>d6,Gf:()=>lp});var C=ue(7579),De=ue(727),Xe=ue(9751),s=ue(6451),ct=ue(8421),de=ue(930),Et=ue(4482);function gt(a,l,...f){if(!0===l)return void a();if(!1===l)return;const _=new de.Hp({next:()=>{_.unsubscribe(),a()}});return(0,ct.Xf)(l(...f)).subscribe(_)}function jt(a){for(let l in a)if(a[l]===jt)return l;throw Error("Could not find renamed property on target object.")}function wt(a,l){for(const f in l)l.hasOwnProperty(f)&&!a.hasOwnProperty(f)&&(a[f]=l[f])}function Gt(a){if("string"==typeof a)return a;if(Array.isArray(a))return"["+a.map(Gt).join(", ")+"]";if(null==a)return""+a;if(a.overriddenName)return`${a.overriddenName}`;if(a.name)return`${a.name}`;const l=a.toString();if(null==l)return""+l;const f=l.indexOf("\n");return-1===f?l:l.substring(0,f)}function Kn(a,l){return null==a||""===a?null===l?"":l:null==l||""===l?a:a+" "+l}const Sn=jt({__forward_ref__:jt});function En(a){return a.__forward_ref__=En,a.toString=function(){return Gt(this())},a}function dn(a){return ii(a)?a():a}function ii(a){return"function"==typeof a&&a.hasOwnProperty(Sn)&&a.__forward_ref__===En}function hn(a){return a&&!!a.\u0275providers}const hi="https://g.co/ng/security#xss";class Te extends Error{constructor(l,f){super(_t(l,f)),this.code=l}}function _t(a,l){return`NG0${Math.abs(a)}${l?": "+l.trim():""}`}function Ue(a){return"string"==typeof a?a:null==a?"":String(a)}function ot(a,l){throw new Te(-201,!1)}function Ke(a,l){null==a&&function Bt(a,l,f,_){throw new Error(`ASSERTION ERROR: ${a}`+(null==_?"":` [Expected=> ${f} ${_} ${l} <=Actual]`))}(l,a,null,"!=")}function Gi(a){return{token:a.token,providedIn:a.providedIn||null,factory:a.factory,value:void 0}}function Hr(a){return{providers:a.providers||[],imports:a.imports||[]}}function Ur(a){return Xi(a,Ji)||Xi(a,jr)}function Si(a){return null!==Ur(a)}function Xi(a,l){return a.hasOwnProperty(l)?a[l]:null}function $r(a){return a&&(a.hasOwnProperty(ir)||a.hasOwnProperty(sn))?a[ir]:null}const Ji=jt({\u0275prov:jt}),ir=jt({\u0275inj:jt}),jr=jt({ngInjectableDef:jt}),sn=jt({ngInjectorDef:jt});var me=(()=>((me=me||{})[me.Default=0]="Default",me[me.Host=1]="Host",me[me.Self=2]="Self",me[me.SkipSelf=4]="SkipSelf",me[me.Optional=8]="Optional",me))();let He;function zt(a){const l=He;return He=a,l}function At(a,l,f){const _=Ur(a);return _&&"root"==_.providedIn?void 0===_.value?_.value=_.factory():_.value:f&me.Optional?null:void 0!==l?l:void ot(Gt(a))}const Hn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Zn={},Fi="__NG_DI_FLAG__",Hi="ngTempTokenPath",Xr="ngTokenPath",Ti=/\n/gm,hr="\u0275",ri="__source";let Qi;function Ir(a){const l=Qi;return Qi=a,l}function cn(a,l=me.Default){if(void 0===Qi)throw new Te(-203,!1);return null===Qi?At(a,void 0,l):Qi.get(a,l&me.Optional?null:void 0,l)}function Be(a,l=me.Default){return(function it(){return He}()||cn)(dn(a),l)}function In(a,l=me.Default){return Be(a,vn(l))}function vn(a){return typeof a>"u"||"number"==typeof a?a:0|(a.optional&&8)|(a.host&&1)|(a.self&&2)|(a.skipSelf&&4)}function ei(a){const l=[];for(let f=0;f<a.length;f++){const _=dn(a[f]);if(Array.isArray(_)){if(0===_.length)throw new Te(900,!1);let w,T=me.Default;for(let N=0;N<_.length;N++){const G=_[N],K=kt(G);"number"==typeof K?-1===K?w=G.token:T|=K:w=G}l.push(Be(w,T))}else l.push(Be(_))}return l}function Oi(a,l){return a[Fi]=l,a.prototype[Fi]=l,a}function kt(a){return a[Fi]}function _n(a){return{toString:a}.toString()}var qe=(()=>((qe=qe||{})[qe.OnPush=0]="OnPush",qe[qe.Default=1]="Default",qe))(),Ge=(()=>{return(a=Ge||(Ge={}))[a.Emulated=0]="Emulated",a[a.None=2]="None",a[a.ShadowDom=3]="ShadowDom",Ge;var a})();const ye={},ke=[],J=jt({\u0275cmp:jt}),_e=jt({\u0275dir:jt}),Se=jt({\u0275pipe:jt}),at=jt({\u0275mod:jt}),St=jt({\u0275fac:jt}),nn=jt({__NG_ELEMENT_ID__:jt});let bn=0;function Dn(a){return _n(()=>{const l=e1(a),f={...l,decls:a.decls,vars:a.vars,template:a.template,consts:a.consts||null,ngContentSelectors:a.ngContentSelectors,onPush:a.changeDetection===qe.OnPush,directiveDefs:null,pipeDefs:null,dependencies:l.standalone&&a.dependencies||null,getStandaloneInjector:null,data:a.data||{},encapsulation:a.encapsulation||Ge.Emulated,id:"c"+bn++,styles:a.styles||ke,_:null,schemas:a.schemas||null,tView:null};Oa(f);const _=a.dependencies;return f.directiveDefs=qo(_,!1),f.pipeDefs=qo(_,!0),f})}function Ei(a){return zr(a)||ls(a)}function si(a){return null!==a}function er(a){return _n(()=>({type:a.type,bootstrap:a.bootstrap||ke,declarations:a.declarations||ke,imports:a.imports||ke,exports:a.exports||ke,transitiveCompileScopes:null,schemas:a.schemas||null,id:a.id||null}))}function Er(a,l){if(null==a)return ye;const f={};for(const _ in a)if(a.hasOwnProperty(_)){let w=a[_],T=w;Array.isArray(w)&&(T=w[1],w=w[0]),f[w]=_,l&&(l[w]=T)}return f}function zs(a){return _n(()=>{const l=e1(a);return Oa(l),l})}function Qs(a){return{type:a.type,name:a.name,factory:null,pure:!1!==a.pure,standalone:!0===a.standalone,onDestroy:a.type.prototype.ngOnDestroy||null}}function zr(a){return a[J]||null}function ls(a){return a[_e]||null}function ds(a){return a[Se]||null}function ro(a){const l=zr(a)||ls(a)||ds(a);return null!==l&&l.standalone}function Os(a,l){const f=a[at]||null;if(!f&&!0===l)throw new Error(`Type ${Gt(a)} does not have '\u0275mod' property.`);return f}function e1(a){const l={};return{type:a.type,providersResolver:null,factory:null,hostBindings:a.hostBindings||null,hostVars:a.hostVars||0,hostAttrs:a.hostAttrs||null,contentQueries:a.contentQueries||null,declaredInputs:l,exportAs:a.exportAs||null,standalone:!0===a.standalone,selectors:a.selectors||ke,viewQuery:a.viewQuery||null,features:a.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Er(a.inputs,l),outputs:Er(a.outputs)}}function Oa(a){a.features?.forEach(l=>l(a))}function qo(a,l){if(!a)return null;const f=l?ds:Ei;return()=>("function"==typeof a?a():a).map(_=>f(_)).filter(si)}const So=0,vi=1,qi=2,Sr=3,Pi=4,Io=5,js=6,sa=7,ps=8,Fs=9,Vo=10,br=11,ws=12,qn=13,Yi=14,tr=15,es=16,ho=17,rr=18,Cs=19,fo=20,_a=21,_r=22,ci=1,eo=2,Ci=7,As=8,Bi=9,Vs=10;function Qn(a){return Array.isArray(a)&&"object"==typeof a[ci]}function Ls(a){return Array.isArray(a)&&!0===a[ci]}function so(a){return 0!=(4&a.flags)}function as(a){return a.componentOffset>-1}function to(a){return 1==(1&a.flags)}function $s(a){return!!a.template}function Oo(a){return 0!=(256&a[qi])}function ao(a,l){return a.hasOwnProperty(St)?a[St]:null}class Ua{constructor(l,f,_){this.previousValue=l,this.currentValue=f,this.firstChange=_}isFirstChange(){return this.firstChange}}function Ho(){return j1}function j1(a){return a.type.prototype.ngOnChanges&&(a.setInput=ya),Po}function Po(){const a=y1(this),l=a?.current;if(l){const f=a.previous;if(f===ye)a.previous=l;else for(let _ in l)f[_]=l[_];a.current=null,this.ngOnChanges(l)}}function ya(a,l,f,_){const w=this.declaredInputs[f],T=y1(a)||function x1(a,l){return a[xo]=l}(a,{previous:ye,current:null}),N=T.current||(T.current={}),G=T.previous,K=G[w];N[w]=new Ua(K&&K.currentValue,l,G===ye),a[_]=l}Ho.ngInherit=!0;const xo="__ngSimpleChanges__";function y1(a){return a[xo]||null}const bo=function(a,l,f){},n1="svg";function Ws(a){for(;Array.isArray(a);)a=a[So];return a}function ea(a,l){return Ws(l[a])}function co(a,l){return Ws(l[a.index])}function Zo(a,l){return a.data[l]}function po(a,l){return a[l]}function Ss(a,l){const f=l[a];return Qn(f)?f:f[So]}function s1(a){return 64==(64&a[qi])}function lo(a,l){return null==l?null:a[l]}function Ga(a){a[rr]=0}function aa(a,l){a[Io]+=l;let f=a,_=a[Sr];for(;null!==_&&(1===l&&1===f[Io]||-1===l&&0===f[Io]);)_[Io]+=l,f=_,_=_[Sr]}const sr={lFrame:ys(null),bindingsEnabled:!0};function ne(){return sr.bindingsEnabled}function lt(){return sr.lFrame.lView}function jn(){return sr.lFrame.tView}function ms(a){return sr.lFrame.contextLView=a,a[ps]}function Eo(a){return sr.lFrame.contextLView=null,a}function Hs(){let a=o1();for(;null!==a&&64===a.type;)a=a.parent;return a}function o1(){return sr.lFrame.currentTNode}function qs(a,l){const f=sr.lFrame;f.currentTNode=a,f.isParent=l}function ba(){return sr.lFrame.isParent}function Aa(){sr.lFrame.isParent=!1}function gs(){const a=sr.lFrame;let l=a.bindingRootIndex;return-1===l&&(l=a.bindingRootIndex=a.tView.bindingStartIndex),l}function c1(){return sr.lFrame.bindingIndex++}function mo(a){const l=sr.lFrame,f=l.bindingIndex;return l.bindingIndex=l.bindingIndex+a,f}function La(a,l){const f=sr.lFrame;f.bindingIndex=f.bindingRootIndex=a,wa(l)}function wa(a){sr.lFrame.currentDirectiveIndex=a}function qa(a){const l=sr.lFrame.currentDirectiveIndex;return-1===l?null:a[l]}function vt(){return sr.lFrame.currentQueryIndex}function ft(a){sr.lFrame.currentQueryIndex=a}function $e(a){const l=a[vi];return 2===l.type?l.declTNode:1===l.type?a[js]:null}function Yt(a,l,f){if(f&me.SkipSelf){let w=l,T=a;for(;!(w=w.parent,null!==w||f&me.Host||(w=$e(T),null===w||(T=T[tr],10&w.type))););if(null===w)return!1;l=w,a=T}const _=sr.lFrame=Ui();return _.currentTNode=l,_.lView=a,!0}function Pn(a){const l=Ui(),f=a[vi];sr.lFrame=l,l.currentTNode=f.firstChild,l.lView=a,l.tView=f,l.contextLView=a,l.bindingIndex=f.bindingStartIndex,l.inI18n=!1}function Ui(){const a=sr.lFrame,l=null===a?null:a.child;return null===l?ys(a):l}function ys(a){const l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:a,child:null,inI18n:!1};return null!==a&&(a.child=l),l}function na(){const a=sr.lFrame;return sr.lFrame=a.parent,a.currentTNode=null,a.lView=null,a}const Da=na;function V1(){const a=na();a.isParent=!0,a.tView=null,a.selectedIndex=-1,a.contextLView=null,a.elementDepthCount=0,a.currentDirectiveIndex=-1,a.currentNamespace=null,a.bindingRootIndex=-1,a.bindingIndex=-1,a.currentQueryIndex=0}function zo(){return sr.lFrame.selectedIndex}function l1(a){sr.lFrame.selectedIndex=a}function Zs(){const a=sr.lFrame;return Zo(a.tView,a.selectedIndex)}function X2(){sr.lFrame.currentNamespace=n1}function l2(){!function I2(){sr.lFrame.currentNamespace=null}()}function I(a,l){for(let f=l.directiveStart,_=l.directiveEnd;f<_;f++){const T=a.data[f].type.prototype,{ngAfterContentInit:N,ngAfterContentChecked:G,ngAfterViewInit:K,ngAfterViewChecked:fe,ngOnDestroy:Ae}=T;N&&(a.contentHooks??(a.contentHooks=[])).push(-f,N),G&&((a.contentHooks??(a.contentHooks=[])).push(f,G),(a.contentCheckHooks??(a.contentCheckHooks=[])).push(f,G)),K&&(a.viewHooks??(a.viewHooks=[])).push(-f,K),fe&&((a.viewHooks??(a.viewHooks=[])).push(f,fe),(a.viewCheckHooks??(a.viewCheckHooks=[])).push(f,fe)),null!=Ae&&(a.destroyHooks??(a.destroyHooks=[])).push(f,Ae)}}function L(a,l,f){we(a,l,3,f)}function j(a,l,f,_){(3&a[qi])===f&&we(a,l,f,_)}function ie(a,l){let f=a[qi];(3&f)===l&&(f&=2047,f+=1,a[qi]=f)}function we(a,l,f,_){const T=_??-1,N=l.length-1;let G=0;for(let K=void 0!==_?65535&a[rr]:0;K<N;K++)if("number"==typeof l[K+1]){if(G=l[K],null!=_&&G>=_)break}else l[K]<0&&(a[rr]+=65536),(G<T||-1==T)&&(Je(a,f,l,K),a[rr]=(4294901760&a[rr])+K+2),K++}function Je(a,l,f,_){const w=f[_]<0,T=f[_+1],G=a[w?-f[_]:f[_]];if(w){if(a[qi]>>11<a[rr]>>16&&(3&a[qi])===l){a[qi]+=2048,bo(4,G,T);try{T.call(G)}finally{bo(5,G,T)}}}else{bo(4,G,T);try{T.call(G)}finally{bo(5,G,T)}}}const yt=-1;class rn{constructor(l,f,_){this.factory=l,this.resolving=!1,this.canSeeViewProviders=f,this.injectImpl=_}}function No(a,l,f){let _=0;for(;_<f.length;){const w=f[_];if("number"==typeof w){if(0!==w)break;_++;const T=f[_++],N=f[_++],G=f[_++];a.setAttribute(l,N,G,T)}else{const T=w,N=f[++_];Ps(T)?a.setProperty(l,T,N):a.setAttribute(l,T,N),_++}}return _}function Bs(a){return 3===a||4===a||6===a}function Ps(a){return 64===a.charCodeAt(0)}function xs(a,l){if(null!==l&&0!==l.length)if(null===a||0===a.length)a=l.slice();else{let f=-1;for(let _=0;_<l.length;_++){const w=l[_];"number"==typeof w?f=w:0===f||uo(a,f,w,null,-1===f||2===f?l[++_]:null)}}return a}function uo(a,l,f,_,w){let T=0,N=a.length;if(-1===l)N=-1;else for(;T<a.length;){const G=a[T++];if("number"==typeof G){if(G===l){N=-1;break}if(G>l){N=T-1;break}}}for(;T<a.length;){const G=a[T];if("number"==typeof G)break;if(G===f){if(null===_)return void(null!==w&&(a[T+1]=w));if(_===a[T+1])return void(a[T+2]=w)}T++,null!==_&&T++,null!==w&&T++}-1!==N&&(a.splice(N,0,l),T=N+1),a.splice(T++,0,f),null!==_&&a.splice(T++,0,_),null!==w&&a.splice(T++,0,w)}function Uo(a){return a!==yt}function Za(a){return 32767&a}function ha(a,l){let f=function h1(a){return a>>16}(a),_=l;for(;f>0;)_=_[tr],f--;return _}let fa=!0;function r2(a){const l=fa;return fa=a,l}const J2=255,gc=5;let Dl=0;const $1={};function y2(a,l){const f=vc(a,l);if(-1!==f)return f;const _=l[vi];_.firstCreatePass&&(a.injectorIndex=l.length,x2(_.data,a),x2(l,null),x2(_.blueprint,null));const w=P2(a,l),T=a.injectorIndex;if(Uo(w)){const N=Za(w),G=ha(w,l),K=G[vi].data;for(let fe=0;fe<8;fe++)l[T+fe]=G[N+fe]|K[N+fe]}return l[T+8]=w,T}function x2(a,l){a.push(0,0,0,0,0,0,0,0,l)}function vc(a,l){return-1===a.injectorIndex||a.parent&&a.parent.injectorIndex===a.injectorIndex||null===l[a.injectorIndex+8]?-1:a.injectorIndex}function P2(a,l){if(a.parent&&-1!==a.parent.injectorIndex)return a.parent.injectorIndex;let f=0,_=null,w=l;for(;null!==w;){if(_=Mt(w),null===_)return yt;if(f++,w=w[tr],-1!==_.injectorIndex)return _.injectorIndex|f<<16}return yt}function Q2(a,l,f){!function _c(a,l,f){let _;"string"==typeof f?_=f.charCodeAt(0)||0:f.hasOwnProperty(nn)&&(_=f[nn]),null==_&&(_=f[nn]=Dl++);const w=_&J2;l.data[a+(w>>gc)]|=1<<w}(a,l,f)}function Hc(a,l,f){if(f&me.Optional||void 0!==a)return a;ot()}function yc(a,l,f,_){if(f&me.Optional&&void 0===_&&(_=null),!(f&(me.Self|me.Host))){const w=a[Fs],T=zt(void 0);try{return w?w.get(l,_,f&me.Optional):At(l,_,f&me.Optional)}finally{zt(T)}}return Hc(_,0,f)}function Ca(a,l,f,_=me.Default,w){if(null!==a){if(1024&l[qi]){const N=function bt(a,l,f,_,w){let T=a,N=l;for(;null!==T&&null!==N&&1024&N[qi]&&!(256&N[qi]);){const G=H1(T,N,f,_|me.Self,$1);if(G!==$1)return G;let K=T.parent;if(!K){const fe=N[_a];if(fe){const Ae=fe.get(f,$1,_);if(Ae!==$1)return Ae}K=Mt(N),N=N[tr]}T=K}return w}(a,l,f,_,$1);if(N!==$1)return N}const T=H1(a,l,f,_,$1);if(T!==$1)return T}return yc(l,f,_,w)}function H1(a,l,f,_,w){const T=function Pc(a){if("string"==typeof a)return a.charCodeAt(0)||0;const l=a.hasOwnProperty(nn)?a[nn]:void 0;return"number"==typeof l?l>=0?l&J2:q:l}(f);if("function"==typeof T){if(!Yt(l,a,_))return _&me.Host?Hc(w,0,_):yc(l,f,_,w);try{const N=T(_);if(null!=N||_&me.Optional)return N;ot()}finally{Da()}}else if("number"==typeof T){let N=null,G=vc(a,l),K=yt,fe=_&me.Host?l[es][js]:null;for((-1===G||_&me.SkipSelf)&&(K=-1===G?P2(a,l):l[G+8],K!==yt&&P(_,!1)?(N=l[vi],G=Za(K),l=ha(K,l)):G=-1);-1!==G;){const Ae=l[vi];if(te(T,G,Ae.data)){const tt=s2(G,l,f,N,_,fe);if(tt!==$1)return tt}K=l[G+8],K!==yt&&P(_,l[vi].data[G+8]===fe)&&te(T,G,l)?(N=Ae,G=Za(K),l=ha(K,l)):G=-1}}return w}function s2(a,l,f,_,w,T){const N=l[vi],G=N.data[a+8],Ae=b2(G,N,f,null==_?as(G)&&fa:_!=N&&0!=(3&G.type),w&me.Host&&T===G);return null!==Ae?w1(l,N,Ae,G):$1}function b2(a,l,f,_,w){const T=a.providerIndexes,N=l.data,G=1048575&T,K=a.directiveStart,Ae=T>>20,Ft=w?G+Ae:a.directiveEnd;for(let ln=_?G:G+Ae;ln<Ft;ln++){const Fn=N[ln];if(ln<K&&f===Fn||ln>=K&&Fn.type===f)return ln}if(w){const ln=N[K];if(ln&&$s(ln)&&ln.type===f)return K}return null}function w1(a,l,f,_){let w=a[f];const T=l.data;if(function mn(a){return a instanceof rn}(w)){const N=w;N.resolving&&function Pt(a,l){const f=l?`. Dependency path: ${l.join(" > ")} > ${a}`:"";throw new Te(-200,`Circular dependency in DI detected for ${a}${f}`)}(function Ye(a){return"function"==typeof a?a.name||a.toString():"object"==typeof a&&null!=a&&"function"==typeof a.type?a.type.name||a.type.toString():Ue(a)}(T[f]));const G=r2(N.canSeeViewProviders);N.resolving=!0;const K=N.injectImpl?zt(N.injectImpl):null;Yt(a,_,me.Default);try{w=a[f]=N.factory(void 0,T,a,_),l.firstCreatePass&&f>=_.directiveStart&&function Z(a,l,f){const{ngOnChanges:_,ngOnInit:w,ngDoCheck:T}=l.type.prototype;if(_){const N=j1(l);(f.preOrderHooks??(f.preOrderHooks=[])).push(a,N),(f.preOrderCheckHooks??(f.preOrderCheckHooks=[])).push(a,N)}w&&(f.preOrderHooks??(f.preOrderHooks=[])).push(0-a,w),T&&((f.preOrderHooks??(f.preOrderHooks=[])).push(a,T),(f.preOrderCheckHooks??(f.preOrderCheckHooks=[])).push(a,T))}(f,T[f],l)}finally{null!==K&&zt(K),r2(G),N.resolving=!1,Da()}}return w}function te(a,l,f){return!!(f[l+(a>>gc)]&1<<a)}function P(a,l){return!(a&me.Self||a&me.Host&&l)}class D{constructor(l,f){this._tNode=l,this._lView=f}get(l,f,_){return Ca(this._tNode,this._lView,l,vn(_),f)}}function q(){return new D(Hs(),lt())}function he(a){return _n(()=>{const l=a.prototype.constructor,f=l[St]||Fe(l),_=Object.prototype;let w=Object.getPrototypeOf(a.prototype).constructor;for(;w&&w!==_;){const T=w[St]||Fe(w);if(T&&T!==f)return T;w=Object.getPrototypeOf(w)}return T=>new T})}function Fe(a){return ii(a)?()=>{const l=Fe(dn(a));return l&&l()}:ao(a)}function Mt(a){const l=a[vi],f=l.type;return 2===f?l.declTNode:1===f?a[js]:null}function fn(a){return function Vc(a,l){if("class"===l)return a.classes;if("style"===l)return a.styles;const f=a.attrs;if(f){const _=f.length;let w=0;for(;w<_;){const T=f[w];if(Bs(T))break;if(0===T)w+=2;else if("number"==typeof T)for(w++;w<_&&"string"==typeof f[w];)w++;else{if(T===l)return f[w+1];w+=2}}}return null}(Hs(),a)}const fi="__parameters__";function pr(a,l,f){return _n(()=>{const _=function Wr(a){return function(...f){if(a){const _=a(...f);for(const w in _)this[w]=_[w]}}}(l);function w(...T){if(this instanceof w)return _.apply(this,T),this;const N=new w(...T);return G.annotation=N,G;function G(K,fe,Ae){const tt=K.hasOwnProperty(fi)?K[fi]:Object.defineProperty(K,fi,{value:[]})[fi];for(;tt.length<=Ae;)tt.push(null);return(tt[Ae]=tt[Ae]||[]).push(N),K}}return f&&(w.prototype=Object.create(f.prototype)),w.prototype.ngMetadataName=a,w.annotationCls=w,w})}class vr{constructor(l,f){this._desc=l,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof f?this.__NG_ELEMENT_ID__=f:void 0!==f&&(this.\u0275prov=Gi({token:this,providedIn:f.providedIn||"root",factory:f.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function lr(a,l){a.forEach(f=>Array.isArray(f)?lr(f,l):l(f))}function wr(a,l,f){l>=a.length?a.push(f):a.splice(l,0,f)}function us(a,l){return l>=a.length-1?a.pop():a.splice(l,1)[0]}function Ao(a,l){const f=[];for(let _=0;_<a;_++)f.push(l);return f}function F(a,l,f){let _=$(a,l);return _>=0?a[1|_]=f:(_=~_,function W1(a,l,f,_){let w=a.length;if(w==l)a.push(f,_);else if(1===w)a.push(_,a[0]),a[0]=f;else{for(w--,a.push(a[w-1],a[w]);w>l;)a[w]=a[w-2],w--;a[l]=f,a[l+1]=_}}(a,_,l,f)),_}function V(a,l){const f=$(a,l);if(f>=0)return a[1|f]}function $(a,l){return function xe(a,l,f){let _=0,w=a.length>>f;for(;w!==_;){const T=_+(w-_>>1),N=a[T<<f];if(l===N)return T<<f;N>l?w=T:_=T+1}return~(w<<f)}(a,l,1)}const N1=Oi(pr("Optional"),8),tl=Oi(pr("SkipSelf"),4);var h2=(()=>((h2=h2||{})[h2.Important=1]="Important",h2[h2.DashCase=2]="DashCase",h2))();const ol=new Map;let O4=0;const nc="__ngContext__";function Na(a,l){Qn(l)?(a[nc]=l[fo],function al(a){ol.set(a[fo],a)}(l)):a[nc]=l}let P3;function Fl(a,l){return P3(a,l)}function Ul(a){const l=a[Sr];return Ls(l)?l[Sr]:l}function ul(a){return k3(a[qn])}function N3(a){return k3(a[Pi])}function k3(a){for(;null!==a&&!Ls(a);)a=a[Pi];return a}function U2(a,l,f,_,w){if(null!=_){let T,N=!1;Ls(_)?T=_:Qn(_)&&(N=!0,_=_[So]);const G=Ws(_);0===a&&null!==f?null==w?m(l,f,G):d(l,f,G,w||null,!0):1===a&&null!==f?d(l,f,G,w||null,!0):2===a?function Le(a,l,f){const _=z(a,l);_&&function b(a,l,f,_){a.removeChild(l,f,_)}(a,_,l,f)}(l,G,N):3===a&&l.destroyNode(G),null!=T&&function Qe(a,l,f,_,w){const T=f[Ci];T!==Ws(f)&&U2(l,a,_,T,w);for(let G=Vs;G<f.length;G++){const K=f[G];ze(K[vi],K,a,l,_,T)}}(l,a,T,f,w)}}function O3(a,l,f){return a.createElement(l,f)}function j2(a,l){const f=a[Bi],_=f.indexOf(l),w=l[Sr];512&l[qi]&&(l[qi]&=-513,aa(w,-1)),f.splice(_,1)}function Rc(a,l){if(a.length<=Vs)return;const f=Vs+l,_=a[f];if(_){const w=_[ho];null!==w&&w!==a&&j2(w,_),l>0&&(a[f-1][Pi]=_[Pi]);const T=us(a,Vs+l);!function yu(a,l){ze(a,l,l[br],2,null,null),l[So]=null,l[js]=null}(_[vi],_);const N=T[Cs];null!==N&&N.detachView(T[vi]),_[Sr]=null,_[Pi]=null,_[qi]&=-65}return _}function M1(a,l){if(!(128&l[qi])){const f=l[br];f.destroyNode&&ze(a,l,f,3,null,null),function xu(a){let l=a[qn];if(!l)return w2(a[vi],a);for(;l;){let f=null;if(Qn(l))f=l[qn];else{const _=l[Vs];_&&(f=_)}if(!f){for(;l&&!l[Pi]&&l!==a;)Qn(l)&&w2(l[vi],l),l=l[Sr];null===l&&(l=a),Qn(l)&&w2(l[vi],l),f=l&&l[Pi]}l=f}}(l)}}function w2(a,l){if(!(128&l[qi])){l[qi]&=-65,l[qi]|=128,function h(a,l){let f;if(null!=a&&null!=(f=a.destroyHooks))for(let _=0;_<f.length;_+=2){const w=l[f[_]];if(!(w instanceof rn)){const T=f[_+1];if(Array.isArray(T))for(let N=0;N<T.length;N+=2){const G=w[T[N]],K=T[N+1];bo(4,G,K);try{K.call(G)}finally{bo(5,G,K)}}else{bo(4,w,T);try{T.call(w)}finally{bo(5,w,T)}}}}}(a,l),function bu(a,l){const f=a.cleanup,_=l[sa];let w=-1;if(null!==f)for(let T=0;T<f.length-1;T+=2)if("string"==typeof f[T]){const N=f[T+3];N>=0?_[w=N]():_[w=-N].unsubscribe(),T+=2}else{const N=_[w=f[T+1]];f[T].call(N)}if(null!==_){for(let T=w+1;T<_.length;T++)(0,_[T])();l[sa]=null}}(a,l),1===l[vi].type&&l[br].destroy();const f=l[ho];if(null!==f&&Ls(l[Sr])){f!==l[Sr]&&j2(f,l);const _=l[Cs];null!==_&&_.detachView(a)}!function Ol(a){ol.delete(a[fo])}(l)}}function i(a,l,f){return function o(a,l,f){let _=l;for(;null!==_&&40&_.type;)_=(l=_).parent;if(null===_)return f[So];{const{componentOffset:w}=_;if(w>-1){const{encapsulation:T}=a.data[_.directiveStart+w];if(T===Ge.None||T===Ge.Emulated)return null}return co(_,f)}}(a,l.parent,f)}function d(a,l,f,_,w){a.insertBefore(l,f,_,w)}function m(a,l,f){a.appendChild(l,f)}function v(a,l,f,_,w){null!==_?d(a,l,f,_,w):m(a,l,f)}function z(a,l){return a.parentNode(l)}function R(a,l,f){return Y(a,l,f)}let Q,en,Cn,Yn,Y=function B(a,l,f){return 40&a.type?co(a,f):null};function ce(a,l,f,_){const w=i(a,_,l),T=l[br],G=R(_.parent||l[js],_,l);if(null!=w)if(Array.isArray(f))for(let K=0;K<f.length;K++)v(T,w,f[K],G,!1);else v(T,w,f,G,!1);void 0!==Q&&Q(T,_,l,f,w)}function pe(a,l){if(null!==l){const f=l.type;if(3&f)return co(l,a);if(4&f)return ve(-1,a[l.index]);if(8&f){const _=l.child;if(null!==_)return pe(a,_);{const w=a[l.index];return Ls(w)?ve(-1,w):Ws(w)}}if(32&f)return Fl(l,a)()||Ws(a[l.index]);{const _=re(a,l);return null!==_?Array.isArray(_)?_[0]:pe(Ul(a[es]),_):pe(a,l.next)}}return null}function re(a,l){return null!==l?a[es][js].projection[l.projection]:null}function ve(a,l){const f=Vs+a+1;if(f<l.length){const _=l[f],w=_[vi].firstChild;if(null!==w)return pe(_,w)}return l[Ci]}function Ce(a,l,f,_,w,T,N){for(;null!=f;){const G=_[f.index],K=f.type;if(N&&0===l&&(G&&Na(Ws(G),_),f.flags|=2),32!=(32&f.flags))if(8&K)Ce(a,l,f.child,_,w,T,!1),U2(l,a,w,G,T);else if(32&K){const fe=Fl(f,_);let Ae;for(;Ae=fe();)U2(l,a,w,Ae,T);U2(l,a,w,G,T)}else 16&K?Ie(a,l,_,f,w,T):U2(l,a,w,G,T);f=N?f.projectionNext:f.next}}function ze(a,l,f,_,w,T){Ce(f,_,a.firstChild,l,w,T,!1)}function Ie(a,l,f,_,w,T){const N=f[es],K=N[js].projection[_.projection];if(Array.isArray(K))for(let fe=0;fe<K.length;fe++)U2(l,a,w,K[fe],T);else Ce(a,l,K,N[Sr],w,T,!0)}function $t(a,l,f){""===f?a.removeAttribute(l,"class"):a.setAttribute(l,"class",f)}function Ct(a,l,f){const{mergedAttrs:_,classes:w,styles:T}=f;null!==_&&No(a,l,_),null!==w&&$t(a,l,w),null!==T&&function dt(a,l,f){a.setAttribute(l,"style",f)}(a,l,T)}function xn(a){return function Jt(){if(void 0===en&&(en=null,Hn.trustedTypes))try{en=Hn.trustedTypes.createPolicy("angular",{createHTML:a=>a,createScript:a=>a,createScriptURL:a=>a})}catch{}return en}()?.createHTML(a)||a}function Un(a){Cn=a}function di(){if(void 0===Yn&&(Yn=null,Hn.trustedTypes))try{Yn=Hn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:a=>a,createScript:a=>a,createScriptURL:a=>a})}catch{}return Yn}function Ai(a){return di()?.createHTML(a)||a}function bi(a){return di()?.createScriptURL(a)||a}class ur{constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${hi})`}}class ar extends ur{getTypeName(){return"HTML"}}class yr extends ur{getTypeName(){return"Style"}}class mr extends ur{getTypeName(){return"Script"}}class Yr extends ur{getTypeName(){return"URL"}}class Is extends ur{getTypeName(){return"ResourceURL"}}function xr(a){return a instanceof ur?a.changingThisBreaksApplicationSecurity:a}function Us(a,l){const f=function kr(a){return a instanceof ur&&a.getTypeName()||null}(a);if(null!=f&&f!==l){if("ResourceURL"===f&&"URL"===l)return!0;throw new Error(`Required a safe ${l}, got a ${f} (see ${hi})`)}return f===l}function ts(a){return new ar(a)}function Rr(a){return new yr(a)}function Jr(a){return new mr(a)}function Ys(a){return new Yr(a)}function ss(a){return new Is(a)}class p1{constructor(l){this.inertDocumentHelper=l}getInertBodyElement(l){l="<body><remove></remove>"+l;try{const f=(new window.DOMParser).parseFromString(xn(l),"text/html").body;return null===f?this.inertDocumentHelper.getInertBodyElement(l):(f.removeChild(f.firstChild),f)}catch{return null}}}class k1{constructor(l){this.defaultDoc=l,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(l){const f=this.inertDocument.createElement("template");return f.innerHTML=xn(l),f}}const Y1=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function ra(a){return(a=String(a)).match(Y1)?a:"unsafe:"+a}function no(a){const l={};for(const f of a.split(","))l[f]=!0;return l}function ka(...a){const l={};for(const f of a)for(const _ in f)f.hasOwnProperty(_)&&(l[_]=!0);return l}const m1=no("area,br,col,hr,img,wbr"),R1=no("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),C2=no("rp,rt"),Tc=ka(m1,ka(R1,no("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ka(C2,no("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ka(C2,R1)),$l=no("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ql=ka($l,no("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),no("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ic=no("script,style,template");class td{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(l){let f=l.firstChild,_=!0;for(;f;)if(f.nodeType===Node.ELEMENT_NODE?_=this.startElement(f):f.nodeType===Node.TEXT_NODE?this.chars(f.nodeValue):this.sanitizedSomething=!0,_&&f.firstChild)f=f.firstChild;else for(;f;){f.nodeType===Node.ELEMENT_NODE&&this.endElement(f);let w=this.checkClobberedElement(f,f.nextSibling);if(w){f=w;break}f=this.checkClobberedElement(f,f.parentNode)}return this.buf.join("")}startElement(l){const f=l.nodeName.toLowerCase();if(!Tc.hasOwnProperty(f))return this.sanitizedSomething=!0,!ic.hasOwnProperty(f);this.buf.push("<"),this.buf.push(f);const _=l.attributes;for(let w=0;w<_.length;w++){const T=_.item(w),N=T.name,G=N.toLowerCase();if(!ql.hasOwnProperty(G)){this.sanitizedSomething=!0;continue}let K=T.value;$l[G]&&(K=ra(K)),this.buf.push(" ",N,'="',q4(K),'"')}return this.buf.push(">"),!0}endElement(l){const f=l.nodeName.toLowerCase();Tc.hasOwnProperty(f)&&!m1.hasOwnProperty(f)&&(this.buf.push("</"),this.buf.push(f),this.buf.push(">"))}chars(l){this.buf.push(q4(l))}checkClobberedElement(l,f){if(f&&(l.compareDocumentPosition(f)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${l.outerHTML}`);return f}}const Ep=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,U3=/([^\#-~ |!])/g;function q4(a){return a.replace(/&/g,"&amp;").replace(Ep,function(l){return"&#"+(1024*(l.charCodeAt(0)-55296)+(l.charCodeAt(1)-56320)+65536)+";"}).replace(U3,function(l){return"&#"+l.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Oc;function j3(a,l){let f=null;try{Oc=Oc||function pa(a){const l=new k1(a);return function G2(){try{return!!(new window.DOMParser).parseFromString(xn(""),"text/html")}catch{return!1}}()?new p1(l):l}(a);let _=l?String(l):"";f=Oc.getInertBodyElement(_);let w=5,T=_;do{if(0===w)throw new Error("Failed to sanitize html because the input is unstable");w--,_=T,T=f.innerHTML,f=Oc.getInertBodyElement(_)}while(_!==T);return xn((new td).sanitizeChildren(wu(f)||f))}finally{if(f){const _=wu(f)||f;for(;_.firstChild;)_.removeChild(_.firstChild)}}}function wu(a){return"content"in a&&function nd(a){return a.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===a.nodeName}(a)?a.content:null}var Ra=(()=>((Ra=Ra||{})[Ra.NONE=0]="NONE",Ra[Ra.HTML=1]="HTML",Ra[Ra.STYLE=2]="STYLE",Ra[Ra.SCRIPT=3]="SCRIPT",Ra[Ra.URL=4]="URL",Ra[Ra.RESOURCE_URL=5]="RESOURCE_URL",Ra))();function id(a){const l=Yl();return l?Ai(l.sanitize(Ra.HTML,a)||""):Us(a,"HTML")?Ai(xr(a)):j3(function kn(){return void 0!==Cn?Cn:typeof document<"u"?document:void 0}(),Ue(a))}function ma(a){const l=Yl();return l?l.sanitize(Ra.URL,a)||"":Us(a,"URL")?xr(a):ra(Ue(a))}function k6(a){const l=Yl();if(l)return bi(l.sanitize(Ra.RESOURCE_URL,a)||"");if(Us(a,"ResourceURL"))return bi(xr(a));throw new Te(904,!1)}function Cu(a,l,f){return function Mo(a,l){return"src"===l&&("embed"===a||"frame"===a||"iframe"===a||"media"===a||"script"===a)||"href"===l&&("base"===a||"link"===a)?k6:ma}(l,f)(a)}function Yl(){const a=lt();return a&&a[ws]}const Mu=new vr("ENVIRONMENT_INITIALIZER"),_o=new vr("INJECTOR",-1),Su=new vr("INJECTOR_DEF_TYPES");class $2{get(l,f=Zn){if(f===Zn){const _=new Error(`NullInjectorError: No provider for ${Gt(l)}!`);throw _.name="NullInjectorError",_}return f}}function sd(a){return{\u0275providers:a}}function od(...a){return{\u0275providers:Tu(0,a),\u0275fromNgModule:!0}}function Tu(a,...l){const f=[],_=new Set;let w;return lr(l,T=>{const N=T;G3(N,f,[],_)&&(w||(w=[]),w.push(N))}),void 0!==w&&Es(w,f),f}function Es(a,l){for(let f=0;f<a.length;f++){const{providers:w}=a[f];Eu(w,T=>{l.push(T)})}}function G3(a,l,f,_){if(!(a=dn(a)))return!1;let w=null,T=$r(a);const N=!T&&zr(a);if(T||N){if(N&&!N.standalone)return!1;w=a}else{const K=a.ngModule;if(T=$r(K),!T)return!1;w=K}const G=_.has(w);if(N){if(G)return!1;if(_.add(w),N.dependencies){const K="function"==typeof N.dependencies?N.dependencies():N.dependencies;for(const fe of K)G3(fe,l,f,_)}}else{if(!T)return!1;{if(null!=T.imports&&!G){let fe;_.add(w);try{lr(T.imports,Ae=>{G3(Ae,l,f,_)&&(fe||(fe=[]),fe.push(Ae))})}finally{}void 0!==fe&&Es(fe,l)}if(!G){const fe=ao(w)||(()=>new w);l.push({provide:w,useFactory:fe,deps:ke},{provide:Su,useValue:w,multi:!0},{provide:Mu,useValue:()=>Be(w),multi:!0})}const K=T.providers;null==K||G||Eu(K,Ae=>{l.push(Ae)})}}return w!==a&&void 0!==a.providers}function Eu(a,l){for(let f of a)hn(f)&&(f=f.\u0275providers),Array.isArray(f)?Eu(f,l):l(f)}const ad=jt({provide:String,useValue:jt});function Z4(a){return null!==a&&"object"==typeof a&&ad in a}function io(a){return"function"==typeof a}const Y4=new vr("Set Injector scope."),K4={},ld={};let Au;function X4(){return void 0===Au&&(Au=new $2),Au}class dl{}class R6 extends dl{get destroyed(){return this._destroyed}constructor(l,f,_,w){super(),this.parent=f,this.source=_,this.scopes=w,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Lu(l,N=>this.processProvider(N)),this.records.set(_o,Kl(void 0,this)),w.has("environment")&&this.records.set(dl,Kl(void 0,this));const T=this.records.get(Y4);null!=T&&"string"==typeof T.value&&this.scopes.add(T.value),this.injectorDefTypes=new Set(this.get(Su.multi,ke,me.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const l of this._ngOnDestroyHooks)l.ngOnDestroy();for(const l of this._onDestroyHooks)l()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(l){this._onDestroyHooks.push(l)}runInContext(l){this.assertNotDestroyed();const f=Ir(this),_=zt(void 0);try{return l()}finally{Ir(f),zt(_)}}get(l,f=Zn,_=me.Default){this.assertNotDestroyed(),_=vn(_);const w=Ir(this),T=zt(void 0);try{if(!(_&me.SkipSelf)){let G=this.records.get(l);if(void 0===G){const K=function F6(a){return"function"==typeof a||"object"==typeof a&&a instanceof vr}(l)&&Ur(l);G=K&&this.injectableDefInScope(K)?Kl(gr(l),K4):null,this.records.set(l,G)}if(null!=G)return this.hydrate(l,G)}return(_&me.Self?X4():this.parent).get(l,f=_&me.Optional&&f===Zn?null:f)}catch(N){if("NullInjectorError"===N.name){if((N[Hi]=N[Hi]||[]).unshift(Gt(l)),w)throw N;return function Ht(a,l,f,_){const w=a[Hi];throw l[ri]&&w.unshift(l[ri]),a.message=function an(a,l,f,_=null){a=a&&"\n"===a.charAt(0)&&a.charAt(1)==hr?a.slice(2):a;let w=Gt(l);if(Array.isArray(l))w=l.map(Gt).join(" -> ");else if("object"==typeof l){let T=[];for(let N in l)if(l.hasOwnProperty(N)){let G=l[N];T.push(N+":"+("string"==typeof G?JSON.stringify(G):Gt(G)))}w=`{${T.join(", ")}}`}return`${f}${_?"("+_+")":""}[${w}]: ${a.replace(Ti,"\n  ")}`}("\n"+a.message,w,f,_),a[Xr]=w,a[Hi]=null,a}(N,l,"R3InjectorError",this.source)}throw N}finally{zt(T),Ir(w)}}resolveInjectorInitializers(){const l=Ir(this),f=zt(void 0);try{const _=this.get(Mu.multi,ke,me.Self);for(const w of _)w()}finally{Ir(l),zt(f)}}toString(){const l=[],f=this.records;for(const _ of f.keys())l.push(Gt(_));return`R3Injector[${l.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Te(205,!1)}processProvider(l){let f=io(l=dn(l))?l:dn(l&&l.provide);const _=function O6(a){return Z4(a)?Kl(void 0,a.useValue):Kl(Ec(a),K4)}(l);if(io(l)||!0!==l.multi)this.records.get(f);else{let w=this.records.get(f);w||(w=Kl(void 0,K4,!0),w.factory=()=>ei(w.multi),this.records.set(f,w)),f=l,w.multi.push(l)}this.records.set(f,_)}hydrate(l,f){return f.value===K4&&(f.value=ld,f.value=f.factory()),"object"==typeof f.value&&f.value&&function hd(a){return null!==a&&"object"==typeof a&&"function"==typeof a.ngOnDestroy}(f.value)&&this._ngOnDestroyHooks.add(f.value),f.value}injectableDefInScope(l){if(!l.providedIn)return!1;const f=dn(l.providedIn);return"string"==typeof f?"any"===f||this.scopes.has(f):this.injectorDefTypes.has(f)}}function gr(a){const l=Ur(a),f=null!==l?l.factory:ao(a);if(null!==f)return f;if(a instanceof vr)throw new Te(204,!1);if(a instanceof Function)return function Lr(a){const l=a.length;if(l>0)throw Ao(l,"?"),new Te(204,!1);const f=function Rs(a){return a&&(a[Ji]||a[jr])||null}(a);return null!==f?()=>f.factory(a):()=>new a}(a);throw new Te(204,!1)}function Ec(a,l,f){let _;if(io(a)){const w=dn(a);return ao(w)||gr(w)}if(Z4(a))_=()=>dn(a.useValue);else if(function zu(a){return!(!a||!a.useFactory)}(a))_=()=>a.useFactory(...ei(a.deps||[]));else if(function Ar(a){return!(!a||!a.useExisting)}(a))_=()=>Be(dn(a.useExisting));else{const w=dn(a&&(a.useClass||a.provide));if(!function ud(a){return!!a.deps}(a))return ao(w)||gr(w);_=()=>new w(...ei(a.deps))}return _}function Kl(a,l,f=!1){return{factory:a,value:l,multi:f?[]:void 0}}function Lu(a,l){for(const f of a)Array.isArray(f)?Lu(f,l):f&&hn(f)?Lu(f.\u0275providers,l):l(f)}class J4{}class B6{}class Fc{resolveComponentFactory(l){throw function fd(a){const l=Error(`No component factory found for ${Gt(a)}. Did you add it to @NgModule.entryComponents?`);return l.ngComponent=a,l}(l)}}let Q4=(()=>{class a{}return a.NULL=new Fc,a})();function Gr(){return pl(Hs(),lt())}function pl(a,l){return new K1(co(a,l))}let K1=(()=>{class a{constructor(f){this.nativeElement=f}}return a.__NG_ELEMENT_ID__=Gr,a})();function j6(a){return a instanceof K1?a.nativeElement:a}class G6{}let pd=(()=>{class a{}return a.__NG_ELEMENT_ID__=()=>function $6(){const a=lt(),f=Ss(Hs().index,a);return(Qn(f)?f:a)[br]}(),a})(),md=(()=>{class a{}return a.\u0275prov=Gi({token:a,providedIn:"root",factory:()=>null}),a})();class W6{constructor(l){this.full=l,this.major=l.split(".")[0],this.minor=l.split(".")[1],this.patch=l.split(".").slice(2).join(".")}}const gd=new W6("15.2.10"),e0={},Du="ngOriginalError";function $3(a){return a[Du]}class rc{constructor(){this._console=console}handleError(l){const f=this._findOriginalError(l);this._console.error("ERROR",l),f&&this._console.error("ORIGINAL ERROR",f)}_findOriginalError(l){let f=l&&$3(l);for(;f&&$3(f);)f=$3(f);return f||null}}function Vu(a){return a.ownerDocument}function sc(a){return a instanceof Function?a():a}function Y6(a,l,f){let _=a.length;for(;;){const w=a.indexOf(l,f);if(-1===w)return w;if(0===w||a.charCodeAt(w-1)<=32){const T=l.length;if(w+T===_||a.charCodeAt(w+T)<=32)return w}f=w+1}}const Hu="ng-template";function oc(a,l,f){let _=0,w=!0;for(;_<a.length;){let T=a[_++];if("string"==typeof T&&w){const N=a[_++];if(f&&"class"===T&&-1!==Y6(N.toLowerCase(),l,0))return!0}else{if(1===T){for(;_<a.length&&"string"==typeof(T=a[_++]);)if(T.toLowerCase()===l)return!0;return!1}"number"==typeof T&&(w=!1)}}return!1}function Pu(a){return 4===a.type&&a.value!==Hu}function yd(a,l,f){return l===(4!==a.type||f?a.value:Hu)}function Np(a,l,f){let _=4;const w=a.attrs||[],T=function kp(a){for(let l=0;l<a.length;l++)if(Bs(a[l]))return l;return a.length}(w);let N=!1;for(let G=0;G<l.length;G++){const K=l[G];if("number"!=typeof K){if(!N)if(4&_){if(_=2|1&_,""!==K&&!yd(a,K,f)||""===K&&1===l.length){if(M2(_))return!1;N=!0}}else{const fe=8&_?K:l[++G];if(8&_&&null!==a.attrs){if(!oc(a.attrs,fe,f)){if(M2(_))return!1;N=!0}continue}const tt=Nu(8&_?"class":K,w,Pu(a),f);if(-1===tt){if(M2(_))return!1;N=!0;continue}if(""!==fe){let Ft;Ft=tt>T?"":w[tt+1].toLowerCase();const ln=8&_?Ft:null;if(ln&&-1!==Y6(ln,fe,0)||2&_&&fe!==Ft){if(M2(_))return!1;N=!0}}}}else{if(!N&&!M2(_)&&!M2(K))return!1;if(N&&M2(K))continue;N=!1,_=K|1&_}}return M2(_)||N}function M2(a){return 0==(1&a)}function Nu(a,l,f,_){if(null===l)return-1;let w=0;if(_||!f){let T=!1;for(;w<l.length;){const N=l[w];if(N===a)return w;if(3===N||6===N)T=!0;else{if(1===N||2===N){let G=l[++w];for(;"string"==typeof G;)G=l[++w];continue}if(4===N)break;if(0===N){w+=4;continue}}w+=T?1:2}return-1}return function Kr(a,l){let f=a.indexOf(4);if(f>-1)for(f++;f<a.length;){const _=a[f];if("number"==typeof _)return-1;if(_===l)return f;f++}return-1}(l,a)}function xd(a,l,f=!1){for(let _=0;_<l.length;_++)if(Np(a,l[_],f))return!0;return!1}function n0(a,l){e:for(let f=0;f<l.length;f++){const _=l[f];if(a.length===_.length){for(let w=0;w<a.length;w++)if(a[w]!==_[w])continue e;return!0}}return!1}function X1(a,l){return a?":not("+l.trim()+")":l}function Uc(a){let l=a[0],f=1,_=2,w="",T=!1;for(;f<a.length;){let N=a[f];if("string"==typeof N)if(2&_){const G=a[++f];w+="["+N+(G.length>0?'="'+G+'"':"")+"]"}else 8&_?w+="."+N:4&_&&(w+=" "+N);else""!==w&&!M2(N)&&(l+=X1(T,w),w=""),_=N,T=T||!M2(_);f++}return""!==w&&(l+=X1(T,w)),l}const ns={};function ku(a){K6(jn(),lt(),zo()+a,!1)}function K6(a,l,f,_){if(!_)if(3==(3&l[qi])){const T=a.preOrderCheckHooks;null!==T&&L(l,T,f)}else{const T=a.preOrderHooks;null!==T&&j(l,T,0,f)}l1(f)}function eh(a,l=null,f=null,_){const w=Ru(a,l,f,_);return w.resolveInjectorInitializers(),w}function Ru(a,l=null,f=null,_,w=new Set){const T=[f||ke,od(a)];return _=_||("object"==typeof a?void 0:Gt(a)),new R6(T,l||X4(),_||null,w)}let gl=(()=>{class a{static create(f,_){if(Array.isArray(f))return eh({name:""},_,f,"");{const w=f.name??"";return eh({name:w},f.parent,f.providers,w)}}}return a.THROW_IF_NOT_FOUND=Zn,a.NULL=new $2,a.\u0275prov=Gi({token:a,providedIn:"any",factory:()=>Be(_o)}),a.__NG_ELEMENT_ID__=-1,a})();function q3(a,l=me.Default){const f=lt();return null===f?Be(a,l):Ca(Hs(),f,dn(a),l)}function l0(){throw new Error("invalid")}function Wu(a,l){const f=a.contentQueries;if(null!==f)for(let _=0;_<f.length;_+=2){const T=f[_+1];if(-1!==T){const N=a.data[T];ft(f[_]),N.contentQueries(2,l[T],T)}}}function u0(a,l,f,_,w,T,N,G,K,fe,Ae){const tt=l.blueprint.slice();return tt[So]=w,tt[qi]=76|_,(null!==Ae||a&&1024&a[qi])&&(tt[qi]|=1024),Ga(tt),tt[Sr]=tt[tr]=a,tt[ps]=f,tt[Vo]=N||a&&a[Vo],tt[br]=G||a&&a[br],tt[ws]=K||a&&a[ws]||null,tt[Fs]=fe||a&&a[Fs]||null,tt[js]=T,tt[fo]=function Pa(){return O4++}(),tt[_a]=Ae,tt[es]=2==l.type?a[es]:tt,tt}function Jl(a,l,f,_,w){let T=a.data[l];if(null===T)T=function Z3(a,l,f,_,w){const T=o1(),N=ba(),K=a.data[l]=function Id(a,l,f,_,w,T){return{type:f,index:_,insertBeforeIndex:null,injectorIndex:l?l.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:w,attrs:T,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,N?T:T&&T.parent,f,l,_,w);return null===a.firstChild&&(a.firstChild=K),null!==T&&(N?null==T.child&&null!==K.parent&&(T.child=K):null===T.next&&(T.next=K,K.prev=T)),K}(a,l,f,_,w),function n2(){return sr.lFrame.inI18n}()&&(T.flags|=32);else if(64&T.type){T.type=f,T.value=_,T.attrs=w;const N=function Yo(){const a=sr.lFrame,l=a.currentTNode;return a.isParent?l:l.parent}();T.injectorIndex=null===N?-1:N.injectorIndex}return qs(T,!0),T}function Ql(a,l,f,_){if(0===f)return-1;const w=l.length;for(let T=0;T<f;T++)l.push(_),a.blueprint.push(_),a.data.push(null);return w}function e3(a,l,f){Pn(l);try{const _=a.viewQuery;null!==_&&yl(1,_,f);const w=a.template;null!==w&&qu(a,l,w,1,f),a.firstCreatePass&&(a.firstCreatePass=!1),a.staticContentQueries&&Wu(a,l),a.staticViewQueries&&yl(2,a.viewQuery,f);const T=a.components;null!==T&&function jc(a,l){for(let f=0;f<l.length;f++)Kp(a,l[f])}(l,T)}catch(_){throw a.firstCreatePass&&(a.incompleteFirstPass=!0,a.firstCreatePass=!1),_}finally{l[qi]&=-5,V1()}}function t3(a,l,f,_){const w=l[qi];if(128!=(128&w)){Pn(l);try{Ga(l),function ta(a){return sr.lFrame.bindingIndex=a}(a.bindingStartIndex),null!==f&&qu(a,l,f,2,_);const N=3==(3&w);if(N){const fe=a.preOrderCheckHooks;null!==fe&&L(l,fe,null)}else{const fe=a.preOrderHooks;null!==fe&&j(l,fe,0,null),ie(l,0)}if(function Zp(a){for(let l=ul(a);null!==l;l=N3(l)){if(!l[eo])continue;const f=l[Bi];for(let _=0;_<f.length;_++){const w=f[_];512&w[qi]||aa(w[Sr],1),w[qi]|=512}}}(l),function n3(a){for(let l=ul(a);null!==l;l=N3(l))for(let f=Vs;f<l.length;f++){const _=l[f],w=_[vi];s1(_)&&t3(w,_,w.template,_[ps])}}(l),null!==a.contentQueries&&Wu(a,l),N){const fe=a.contentCheckHooks;null!==fe&&L(l,fe)}else{const fe=a.contentHooks;null!==fe&&j(l,fe,1),ie(l,1)}!function Up(a,l){const f=a.hostBindingOpCodes;if(null!==f)try{for(let _=0;_<f.length;_++){const w=f[_];if(w<0)l1(~w);else{const T=w,N=f[++_],G=f[++_];La(N,T),G(2,l[T])}}}finally{l1(-1)}}(a,l);const G=a.components;null!==G&&function q2(a,l){for(let f=0;f<l.length;f++)Yp(a,l[f])}(l,G);const K=a.viewQuery;if(null!==K&&yl(2,K,_),N){const fe=a.viewCheckHooks;null!==fe&&L(l,fe)}else{const fe=a.viewHooks;null!==fe&&j(l,fe,2),ie(l,2)}!0===a.firstUpdatePass&&(a.firstUpdatePass=!1),l[qi]&=-41,512&l[qi]&&(l[qi]&=-513,aa(l[Sr],-1))}finally{V1()}}}function qu(a,l,f,_,w){const T=zo(),N=2&_;try{l1(-1),N&&l.length>_r&&K6(a,l,_r,!1),bo(N?2:0,w),f(_,w)}finally{l1(T),bo(N?3:1,w)}}function Y3(a,l,f){if(so(l)){const w=l.directiveEnd;for(let T=l.directiveStart;T<w;T++){const N=a.data[T];N.contentQueries&&N.contentQueries(1,f[T],T)}}}function K3(a,l,f){ne()&&(function hh(a,l,f,_){const w=f.directiveStart,T=f.directiveEnd;as(f)&&function qp(a,l,f){const _=co(l,a),w=oh(f),T=a[Vo],N=d0(a,u0(a,w,null,f.onPush?32:16,_,l,T,T.createRenderer(_,f),null,null,null));a[l.index]=N}(l,f,a.data[w+f.componentOffset]),a.firstCreatePass||y2(f,l),Na(_,l);const N=f.initialInputs;for(let G=w;G<T;G++){const K=a.data[G],fe=w1(l,a,G,f);Na(fe,l),null!==N&&Ku(0,G-w,fe,K,0,N),$s(K)&&(Ss(f.index,l)[ps]=w1(l,a,G,f))}}(a,l,f,co(f,l)),64==(64&f.flags)&&Gc(a,l,f))}function h0(a,l,f=co){const _=l.localNames;if(null!==_){let w=l.index+1;for(let T=0;T<_.length;T+=2){const N=_[T+1],G=-1===N?f(l,a):a[N];a[w++]=G}}}function oh(a){const l=a.tView;return null===l||l.incompleteFirstPass?a.tView=f0(1,null,a.template,a.decls,a.vars,a.directiveDefs,a.pipeDefs,a.viewQuery,a.schemas,a.consts):l}function f0(a,l,f,_,w,T,N,G,K,fe){const Ae=_r+_,tt=Ae+w,Ft=function _l(a,l){const f=[];for(let _=0;_<l;_++)f.push(_<a?null:ns);return f}(Ae,tt),ln="function"==typeof fe?fe():fe;return Ft[vi]={type:a,blueprint:Ft,template:f,queries:null,viewQuery:G,declTNode:l,data:Ft.slice().fill(null,Ae),bindingStartIndex:Ae,expandoStartIndex:tt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof T?T():T,pipeRegistry:"function"==typeof N?N():N,firstChild:null,schemas:K,consts:ln,incompleteFirstPass:!1}}function Zu(a,l,f,_){const w=ga(l);null===f?w.push(_):(w.push(f),a.firstCreatePass&&p0(a).push(_,w.length-1))}function Yu(a,l,f,_){for(let w in a)if(a.hasOwnProperty(w)){f=null===f?{}:f;const T=a[w];null===_?Vd(f,l,w,T):_.hasOwnProperty(w)&&Vd(f,l,_[w],T)}return f}function Vd(a,l,f,_){a.hasOwnProperty(f)?a[f].push(l,_):a[f]=[l,_]}function f2(a,l,f,_,w,T,N,G){const K=co(l,f);let Ae,fe=l.inputs;!G&&null!=fe&&(Ae=fe[_])?(r3(a,f,Ae,_,w),as(l)&&function Hd(a,l){const f=Ss(l,a);16&f[qi]||(f[qi]|=32)}(f,l.index)):3&l.type&&(_=function ah(a){return"class"===a?"className":"for"===a?"htmlFor":"formaction"===a?"formAction":"innerHtml"===a?"innerHTML":"readonly"===a?"readOnly":"tabindex"===a?"tabIndex":a}(_),w=null!=N?N(w,l.value||"",_):w,T.setProperty(K,_,w))}function ch(a,l,f,_){if(ne()){const w=null===_?null:{"":-1},T=function kd(a,l){const f=a.directiveRegistry;let _=null,w=null;if(f)for(let T=0;T<f.length;T++){const N=f[T];if(xd(l,N.selectors,!1))if(_||(_=[]),$s(N))if(null!==N.findHostDirectiveDefs){const G=[];w=w||new Map,N.findHostDirectiveDefs(N,G,w),_.unshift(...G,N),fh(a,l,G.length)}else _.unshift(N),fh(a,l,0);else w=w||new Map,N.findHostDirectiveDefs?.(N,_,w),_.push(N)}return null===_?null:[_,w]}(a,f);let N,G;null===T?N=G=null:[N,G]=T,null!==N&&lh(a,l,f,N,w,G),w&&function $p(a,l,f){if(l){const _=a.localNames=[];for(let w=0;w<l.length;w+=2){const T=f[l[w+1]];if(null==T)throw new Te(-301,!1);_.push(l[w],T)}}}(f,_,w)}f.mergedAttrs=xs(f.mergedAttrs,f.attrs)}function lh(a,l,f,_,w,T){for(let fe=0;fe<_.length;fe++)Q2(y2(f,l),a,_[fe].type);!function Wp(a,l,f){a.flags|=1,a.directiveStart=l,a.directiveEnd=l+f,a.providerIndexes=l}(f,a.data.length,_.length);for(let fe=0;fe<_.length;fe++){const Ae=_[fe];Ae.providersResolver&&Ae.providersResolver(Ae)}let N=!1,G=!1,K=Ql(a,l,_.length,null);for(let fe=0;fe<_.length;fe++){const Ae=_[fe];f.mergedAttrs=xs(f.mergedAttrs,Ae.hostAttrs),Rd(a,f,l,K,Ae),X3(K,Ae,w),null!==Ae.contentQueries&&(f.flags|=4),(null!==Ae.hostBindings||null!==Ae.hostAttrs||0!==Ae.hostVars)&&(f.flags|=64);const tt=Ae.type.prototype;!N&&(tt.ngOnChanges||tt.ngOnInit||tt.ngDoCheck)&&((a.preOrderHooks??(a.preOrderHooks=[])).push(f.index),N=!0),!G&&(tt.ngOnChanges||tt.ngDoCheck)&&((a.preOrderCheckHooks??(a.preOrderCheckHooks=[])).push(f.index),G=!0),K++}!function jp(a,l,f){const w=l.directiveEnd,T=a.data,N=l.attrs,G=[];let K=null,fe=null;for(let Ae=l.directiveStart;Ae<w;Ae++){const tt=T[Ae],Ft=f?f.get(tt):null,Fn=Ft?Ft.outputs:null;K=Yu(tt.inputs,Ae,K,Ft?Ft.inputs:null),fe=Yu(tt.outputs,Ae,fe,Fn);const ui=null===K||null===N||Pu(l)?null:Od(K,Ae,N);G.push(ui)}null!==K&&(K.hasOwnProperty("class")&&(l.flags|=8),K.hasOwnProperty("style")&&(l.flags|=16)),l.initialInputs=G,l.inputs=K,l.outputs=fe}(a,f,T)}function Gc(a,l,f){const _=f.directiveStart,w=f.directiveEnd,T=f.index,N=function I1(){return sr.lFrame.currentDirectiveIndex}();try{l1(T);for(let G=_;G<w;G++){const K=a.data[G],fe=l[G];wa(G),(null!==K.hostBindings||0!==K.hostVars||null!==K.hostAttrs)&&c2(K,fe)}}finally{l1(-1),wa(N)}}function c2(a,l){null!==a.hostBindings&&a.hostBindings(1,l)}function fh(a,l,f){l.componentOffset=f,(a.components??(a.components=[])).push(l.index)}function X3(a,l,f){if(f){if(l.exportAs)for(let _=0;_<l.exportAs.length;_++)f[l.exportAs[_]]=a;$s(l)&&(f[""]=a)}}function Rd(a,l,f,_,w){a.data[_]=w;const T=w.factory||(w.factory=ao(w.type)),N=new rn(T,$s(w),q3);a.blueprint[_]=N,f[_]=N,function Nd(a,l,f,_,w){const T=w.hostBindings;if(T){let N=a.hostBindingOpCodes;null===N&&(N=a.hostBindingOpCodes=[]);const G=~l.index;(function uh(a){let l=a.length;for(;l>0;){const f=a[--l];if("number"==typeof f&&f<0)return f}return 0})(N)!=G&&N.push(G),N.push(f,_,T)}}(a,l,_,Ql(a,f,w.hostVars,ns),w)}function Ac(a,l,f,_,w,T){const N=co(a,l);!function J3(a,l,f,_,w,T,N){if(null==T)a.removeAttribute(l,w,f);else{const G=null==N?Ue(T):N(T,_||"",w);a.setAttribute(l,w,G,f)}}(l[br],N,T,a.value,f,_,w)}function Ku(a,l,f,_,w,T){const N=T[l];if(null!==N){const G=_.setInput;for(let K=0;K<N.length;){const fe=N[K++],Ae=N[K++],tt=N[K++];null!==G?_.setInput(f,tt,fe,Ae):f[Ae]=tt}}}function Od(a,l,f){let _=null,w=0;for(;w<f.length;){const T=f[w];if(0!==T)if(5!==T){if("number"==typeof T)break;if(a.hasOwnProperty(T)){null===_&&(_=[]);const N=a[T];for(let G=0;G<N.length;G+=2)if(N[G]===l){_.push(T,N[G+1],f[w+1]);break}}w+=2}else w+=2;else w+=4}return _}function vl(a,l,f,_){return[a,!0,!1,l,null,0,_,f,null,null]}function Yp(a,l){const f=Ss(l,a);if(s1(f)){const _=f[vi];48&f[qi]?t3(_,f,_.template,f[ps]):f[Io]>0&&dh(f)}}function dh(a){for(let _=ul(a);null!==_;_=N3(_))for(let w=Vs;w<_.length;w++){const T=_[w];if(s1(T))if(512&T[qi]){const N=T[vi];t3(N,T,N.template,T[ps])}else T[Io]>0&&dh(T)}const f=a[vi].components;if(null!==f)for(let _=0;_<f.length;_++){const w=Ss(f[_],a);s1(w)&&w[Io]>0&&dh(w)}}function Kp(a,l){const f=Ss(l,a),_=f[vi];(function Xp(a,l){for(let f=l.length;f<a.blueprint.length;f++)l.push(a.blueprint[f])})(_,f),e3(_,f,f[ps])}function d0(a,l){return a[qn]?a[Yi][Pi]=l:a[qn]=l,a[Yi]=l,l}function Xu(a){for(;a;){a[qi]|=32;const l=Ul(a);if(Oo(a)&&!l)return a;a=l}return null}function i3(a,l,f,_=!0){const w=l[Vo];w.begin&&w.begin();try{t3(a,l,a.template,f)}catch(N){throw _&&m0(l,N),N}finally{w.end&&w.end()}}function yl(a,l,f){ft(0),l(a,f)}function ga(a){return a[sa]||(a[sa]=[])}function p0(a){return a.cleanup||(a.cleanup=[])}function m0(a,l){const f=a[Fs],_=f?f.get(rc,null):null;_&&_.handleError(l)}function r3(a,l,f,_,w){for(let T=0;T<f.length;){const N=f[T++],G=f[T++],K=l[N],fe=a.data[N];null!==fe.setInput?fe.setInput(K,w,_,G):K[G]=w}}function S2(a,l,f){const _=ea(l,a);!function R3(a,l,f){a.setValue(l,f)}(a[br],_,f)}function Q3(a,l,f){let _=f?a.styles:null,w=f?a.classes:null,T=0;if(null!==l)for(let N=0;N<l.length;N++){const G=l[N];"number"==typeof G?T=G:1==T?w=Kn(w,G):2==T&&(_=Kn(_,G+": "+l[++N]+";"))}f?a.styles=_:a.stylesWithoutHost=_,f?a.classes=w:a.classesWithoutHost=w}function g0(a,l,f,_,w=!1){for(;null!==f;){const T=l[f.index];if(null!==T&&_.push(Ws(T)),Ls(T))for(let G=Vs;G<T.length;G++){const K=T[G],fe=K[vi].firstChild;null!==fe&&g0(K[vi],K,fe,_)}const N=f.type;if(8&N)g0(a,l,f.child,_);else if(32&N){const G=Fl(f,l);let K;for(;K=G();)_.push(K)}else if(16&N){const G=re(l,f);if(Array.isArray(G))_.push(...G);else{const K=Ul(l[es]);g0(K[vi],K,G,_,!0)}}f=w?f.projectionNext:f.next}return _}class $c{get rootNodes(){const l=this._lView,f=l[vi];return g0(f,l,f.firstChild,[])}constructor(l,f){this._lView=l,this._cdRefInjectingView=f,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ps]}set context(l){this._lView[ps]=l}get destroyed(){return 128==(128&this._lView[qi])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const l=this._lView[Sr];if(Ls(l)){const f=l[As],_=f?f.indexOf(this):-1;_>-1&&(Rc(l,_),us(f,_))}this._attachedToViewContainer=!1}M1(this._lView[vi],this._lView)}onDestroy(l){Zu(this._lView[vi],this._lView,null,l)}markForCheck(){Xu(this._cdRefInjectingView||this._lView)}detach(){this._lView[qi]&=-65}reattach(){this._lView[qi]|=64}detectChanges(){i3(this._lView[vi],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Te(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function jl(a,l){ze(a,l,l[br],2,null,null)}(this._lView[vi],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new Te(902,!1);this._appRef=l}}class Ju extends $c{constructor(l){super(l),this._view=l}detectChanges(){const l=this._view;i3(l[vi],l,l[ps],!1)}checkNoChanges(){}get context(){return null}}class Qu extends Q4{constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){const f=zr(l);return new s3(f,this.ngModule)}}function _0(a){const l=[];for(let f in a)a.hasOwnProperty(f)&&l.push({propName:a[f],templateName:f});return l}class Jp{constructor(l,f){this.injector=l,this.parentInjector=f}get(l,f,_){_=vn(_);const w=this.injector.get(l,e0,_);return w!==e0||f===e0?w:this.parentInjector.get(l,f,_)}}class s3 extends B6{get inputs(){return _0(this.componentDef.inputs)}get outputs(){return _0(this.componentDef.outputs)}constructor(l,f){super(),this.componentDef=l,this.ngModule=f,this.componentType=l.type,this.selector=function bd(a){return a.map(Uc).join(",")}(l.selectors),this.ngContentSelectors=l.ngContentSelectors?l.ngContentSelectors:[],this.isBoundToModule=!!f}create(l,f,_,w){let T=(w=w||this.ngModule)instanceof dl?w:w?.injector;T&&null!==this.componentDef.getStandaloneInjector&&(T=this.componentDef.getStandaloneInjector(T)||T);const N=T?new Jp(l,T):l,G=N.get(G6,null);if(null===G)throw new Te(407,!1);const K=N.get(md,null),fe=G.createRenderer(null,this.componentDef),Ae=this.componentDef.selectors[0][0]||"div",tt=_?function Dd(a,l,f){return a.selectRootElement(l,f===Ge.ShadowDom)}(fe,_,this.componentDef.encapsulation):O3(fe,Ae,function mh(a){const l=a.toLowerCase();return"svg"===l?n1:"math"===l?"math":null}(Ae)),Ft=this.componentDef.onPush?288:272,ln=f0(0,null,null,1,0,null,null,null,null,null),Fn=u0(null,ln,null,Ft,null,null,G,fe,K,N,null);let ui,Ri;Pn(Fn);try{const nr=this.componentDef;let Or,oi=null;nr.findHostDirectiveDefs?(Or=[],oi=new Map,nr.findHostDirectiveDefs(nr,Or,oi),Or.push(nr)):Or=[nr];const fs=function Qp(a,l){const f=a[vi],_=_r;return a[_]=l,Jl(f,_,2,"#host",null)}(Fn,tt),Ea=function Bd(a,l,f,_,w,T,N,G){const K=w[vi];!function e5(a,l,f,_){for(const w of a)l.mergedAttrs=xs(l.mergedAttrs,w.hostAttrs);null!==l.mergedAttrs&&(Q3(l,l.mergedAttrs,!0),null!==f&&Ct(_,f,l))}(_,a,l,N);const fe=T.createRenderer(l,f),Ae=u0(w,oh(f),null,f.onPush?32:16,w[a.index],a,T,fe,G||null,null,null);return K.firstCreatePass&&fh(K,a,_.length-1),d0(w,Ae),w[a.index]=Ae}(fs,tt,nr,Or,Fn,G,fe);Ri=Zo(ln,_r),tt&&function n5(a,l,f,_){if(_)No(a,f,["ng-version",gd.full]);else{const{attrs:w,classes:T}=function wd(a){const l=[],f=[];let _=1,w=2;for(;_<a.length;){let T=a[_];if("string"==typeof T)2===w?""!==T&&l.push(T,a[++_]):8===w&&f.push(T);else{if(!M2(w))break;w=T}_++}return{attrs:l,classes:f}}(l.selectors[0]);w&&No(a,f,w),T&&T.length>0&&$t(a,f,T.join(" "))}}(fe,nr,tt,_),void 0!==f&&function Ud(a,l,f){const _=a.projection=[];for(let w=0;w<l.length;w++){const T=f[w];_.push(null!=T?Array.from(T):null)}}(Ri,this.ngContentSelectors,f),ui=function t5(a,l,f,_,w,T){const N=Hs(),G=w[vi],K=co(N,w);lh(G,w,N,f,null,_);for(let Ae=0;Ae<f.length;Ae++)Na(w1(w,G,N.directiveStart+Ae,N),w);Gc(G,w,N),K&&Na(K,w);const fe=w1(w,G,N.directiveStart+N.componentOffset,N);if(a[ps]=w[ps]=fe,null!==T)for(const Ae of T)Ae(fe,l);return Y3(G,N,a),fe}(Ea,nr,Or,oi,Fn,[i5]),e3(ln,Fn,null)}finally{V1()}return new gh(this.componentType,ui,pl(Ri,Fn),Fn,Ri)}}class gh extends J4{constructor(l,f,_,w,T){super(),this.location=_,this._rootLView=w,this._tNode=T,this.instance=f,this.hostView=this.changeDetectorRef=new Ju(w),this.componentType=l}setInput(l,f){const _=this._tNode.inputs;let w;if(null!==_&&(w=_[l])){const T=this._rootLView;r3(T[vi],T,w,l,f),Xu(Ss(this._tNode.index,T))}}get injector(){return new D(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}}function i5(){const a=Hs();I(lt()[vi],a)}function e4(a){let l=function _h(a){return Object.getPrototypeOf(a.prototype).constructor}(a.type),f=!0;const _=[a];for(;l;){let w;if($s(a))w=l.\u0275cmp||l.\u0275dir;else{if(l.\u0275cmp)throw new Te(903,!1);w=l.\u0275dir}if(w){if(f){_.push(w);const N=a;N.inputs=e6(a.inputs),N.declaredInputs=e6(a.declaredInputs),N.outputs=e6(a.outputs);const G=w.hostBindings;G&&s5(a,G);const K=w.viewQuery,fe=w.contentQueries;if(K&&t4(a,K),fe&&jd(a,fe),wt(a.inputs,w.inputs),wt(a.declaredInputs,w.declaredInputs),wt(a.outputs,w.outputs),$s(w)&&w.data.animation){const Ae=a.data;Ae.animation=(Ae.animation||[]).concat(w.data.animation)}}const T=w.features;if(T)for(let N=0;N<T.length;N++){const G=T[N];G&&G.ngInherit&&G(a),G===e4&&(f=!1)}}l=Object.getPrototypeOf(l)}!function r5(a){let l=0,f=null;for(let _=a.length-1;_>=0;_--){const w=a[_];w.hostVars=l+=w.hostVars,w.hostAttrs=xs(w.hostAttrs,f=xs(f,w.hostAttrs))}}(_)}function e6(a){return a===ye?{}:a===ke?[]:a}function t4(a,l){const f=a.viewQuery;a.viewQuery=f?(_,w)=>{l(_,w),f(_,w)}:l}function jd(a,l){const f=a.contentQueries;a.contentQueries=f?(_,w,T)=>{l(_,w,T),f(_,w,T)}:l}function s5(a,l){const f=a.hostBindings;a.hostBindings=f?(_,w)=>{l(_,w),f(_,w)}:l}function n4(a){return!!bh(a)&&(Array.isArray(a)||!(a instanceof Map)&&Symbol.iterator in a)}function bh(a){return null!==a&&("function"==typeof a||"object"==typeof a)}function Z2(a,l,f){return a[l]=f}function i4(a,l){return a[l]}function O1(a,l,f){return!Object.is(a[l],f)&&(a[l]=f,!0)}function xl(a,l,f,_){const w=O1(a,l,f);return O1(a,l+1,_)||w}function t6(a,l,f,_){const w=lt();return O1(w,c1(),l)&&(jn(),Ac(Zs(),w,a,l,f,_)),t6}function T2(a,l,f,_){return O1(a,c1(),f)?l+Ue(f)+_:ns}function r4(a,l,f,_,w,T){const G=xl(a,function Bo(){return sr.lFrame.bindingIndex}(),f,w);return mo(2),G?l+Ue(f)+_+Ue(w)+T:ns}function Sh(a,l,f,_,w,T,N,G){const K=lt(),fe=jn(),Ae=a+_r,tt=fe.firstCreatePass?function e8(a,l,f,_,w,T,N,G,K){const fe=l.consts,Ae=Jl(l,a,4,N||null,lo(fe,G));ch(l,f,Ae,lo(fe,K)),I(l,Ae);const tt=Ae.tView=f0(2,Ae,_,w,T,l.directiveRegistry,l.pipeRegistry,null,l.schemas,fe);return null!==l.queries&&(l.queries.template(l,Ae),tt.queries=l.queries.embeddedTView(Ae)),Ae}(Ae,fe,K,l,f,_,w,T,N):fe.data[Ae];qs(tt,!1);const Ft=K[br].createComment("");ce(fe,K,Ft,tt),Na(Ft,K),d0(K,K[Ae]=vl(Ft,K,Ft,tt)),to(tt)&&K3(fe,K,tt),null!=N&&h0(K,tt,G)}function Th(a){return po(function a1(){return sr.lFrame.contextLView}(),_r+a)}function n6(a,l,f){const _=lt();return O1(_,c1(),l)&&f2(jn(),Zs(),_,a,l,_[br],f,!1),n6}function a4(a,l,f,_,w){const N=w?"class":"style";r3(a,f,l.inputs[N],N,_)}function i6(a,l,f,_){const w=lt(),T=jn(),N=_r+a,G=w[br],K=T.firstCreatePass?function Eh(a,l,f,_,w,T){const N=l.consts,K=Jl(l,a,2,_,lo(N,w));return ch(l,f,K,lo(N,T)),null!==K.attrs&&Q3(K,K.attrs,!1),null!==K.mergedAttrs&&Q3(K,K.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,K),K}(N,T,w,l,f,_):T.data[N],fe=w[N]=O3(G,l,function V2(){return sr.lFrame.currentNamespace}()),Ae=to(K);return qs(K,!0),Ct(G,fe,K),32!=(32&K.flags)&&ce(T,w,fe,K),0===function G1(){return sr.lFrame.elementDepthCount}()&&Na(fe,w),function $a(){sr.lFrame.elementDepthCount++}(),Ae&&(K3(T,w,K),Y3(T,K,w)),null!==_&&h0(w,K),i6}function w0(){let a=Hs();ba()?Aa():(a=a.parent,qs(a,!1));const l=a;!function se(){sr.lFrame.elementDepthCount--}();const f=jn();return f.firstCreatePass&&(I(f,a),so(a)&&f.queries.elementEnd(a)),null!=l.classesWithoutHost&&function Zi(a){return 0!=(8&a.flags)}(l)&&a4(f,l,lt(),l.classesWithoutHost,!0),null!=l.stylesWithoutHost&&function dr(a){return 0!=(16&a.flags)}(l)&&a4(f,l,lt(),l.stylesWithoutHost,!1),w0}function C0(a,l,f,_){return i6(a,l,f,_),w0(),C0}function M0(a,l,f){const _=lt(),w=jn(),T=a+_r,N=w.firstCreatePass?function t8(a,l,f,_,w){const T=l.consts,N=lo(T,_),G=Jl(l,a,8,"ng-container",N);return null!==N&&Q3(G,N,!0),ch(l,f,G,lo(T,w)),null!==l.queries&&l.queries.elementStart(l,G),G}(T,w,_,l,f):w.data[T];qs(N,!0);const G=_[T]=_[br].createComment("");return ce(w,_,G,N),Na(G,_),to(N)&&(K3(w,_,N),Y3(w,N,_)),null!=f&&h0(_,N),M0}function S0(){let a=Hs();const l=jn();return ba()?Aa():(a=a.parent,qs(a,!1)),l.firstCreatePass&&(I(l,a),so(a)&&l.queries.elementEnd(a)),S0}function r6(a,l,f){return M0(a,l,f),S0(),r6}function s6(){return lt()}function zh(a){return!!a&&"function"==typeof a.then}function n8(a){return!!a&&"function"==typeof a.subscribe}const i8=n8;function Zc(a,l,f,_){const w=lt(),T=jn(),N=Hs();return function Ah(a,l,f,_,w,T,N){const G=to(_),fe=a.firstCreatePass&&p0(a),Ae=l[ps],tt=ga(l);let Ft=!0;if(3&_.type||N){const ui=co(_,l),Ri=N?N(ui):ui,nr=tt.length,Or=N?fs=>N(Ws(fs[_.index])):_.index;let oi=null;if(!N&&G&&(oi=function r8(a,l,f,_){const w=a.cleanup;if(null!=w)for(let T=0;T<w.length-1;T+=2){const N=w[T];if(N===f&&w[T+1]===_){const G=l[sa],K=w[T+2];return G.length>K?G[K]:null}"string"==typeof N&&(T+=2)}return null}(a,l,w,_.index)),null!==oi)(oi.__ngLastListenerFn__||oi).__ngNextListenerFn__=T,oi.__ngLastListenerFn__=T,Ft=!1;else{T=s8(_,l,Ae,T,!1);const fs=f.listen(Ri,w,T);tt.push(T,fs),fe&&fe.push(w,Or,nr,nr+1)}}else T=s8(_,l,Ae,T,!1);const ln=_.outputs;let Fn;if(Ft&&null!==ln&&(Fn=ln[w])){const ui=Fn.length;if(ui)for(let Ri=0;Ri<ui;Ri+=2){const Ea=l[Fn[Ri]][Fn[Ri+1]].subscribe(T),E1=tt.length;tt.push(T,Ea),fe&&fe.push(w,_.index,E1,-(E1+1))}}}(T,w,w[br],N,a,l,_),Zc}function o6(a,l,f,_){try{return bo(6,l,f),!1!==f(_)}catch(w){return m0(a,w),!1}finally{bo(7,l,f)}}function s8(a,l,f,_,w){return function T(N){if(N===Function)return _;Xu(a.componentOffset>-1?Ss(a.index,l):l);let K=o6(l,f,_,N),fe=T.__ngNextListenerFn__;for(;fe;)K=o6(l,f,fe,N)&&K,fe=fe.__ngNextListenerFn__;return w&&!1===K&&(N.preventDefault(),N.returnValue=!1),K}}function o8(a=1){return function ua(a){return(sr.lFrame.contextLView=function v2(a,l){for(;a>0;)l=l[tr],a--;return l}(a,sr.lFrame.contextLView))[ps]}(a)}function c5(a,l){let f=null;const _=function ac(a){const l=a.attrs;if(null!=l){const f=l.indexOf(5);if(!(1&f))return l[f+1]}return null}(a);for(let w=0;w<l.length;w++){const T=l[w];if("*"!==T){if(null===_?xd(a,T,!0):n0(_,T))return w}else f=w}return f}function a6(a){const l=lt()[es][js];if(!l.projection){const _=l.projection=Ao(a?a.length:1,null),w=_.slice();let T=l.child;for(;null!==T;){const N=a?c5(T,a):0;null!==N&&(w[N]?w[N].projectionNext=T:_[N]=T,w[N]=T),T=T.next}}}function a8(a,l=0,f){const _=lt(),w=jn(),T=Jl(w,_r+a,16,null,f||null);null===T.projection&&(T.projection=l),Aa(),32!=(32&T.flags)&&function ge(a,l,f){Ie(l[br],0,l,f,i(a,f,l),R(f.parent||l[js],f,l))}(w,_,T)}function Lh(a,l,f){return u3(a,"",l,"",f),Lh}function u3(a,l,f,_,w){const T=lt(),N=T2(T,l,f,_);return N!==ns&&f2(jn(),Zs(),T,a,N,T[br],w,!1),u3}function T0(a,l){return a<<17|l<<2}function wl(a){return a>>17&32767}function u6(a){return 2|a}function h3(a){return(131068&a)>>2}function Nh(a,l){return-131069&a|l<<2}function h6(a){return 1|a}function E0(a,l,f,_,w){const T=a[f+1],N=null===l;let G=_?wl(T):h3(T),K=!1;for(;0!==G&&(!1===K||N);){const Ae=a[G+1];f3(a[G],l)&&(K=!0,a[G+1]=_?h6(Ae):u6(Ae)),G=_?wl(Ae):h3(Ae)}K&&(a[f+1]=_?u6(T):h6(T))}function f3(a,l){return null===a||null==l||(Array.isArray(a)?a[1]:a)===l||!(!Array.isArray(a)||"string"!=typeof l)&&$(a,l)>=0}const T1={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Rh(a){return a.substring(T1.key,T1.keyEnd)}function Oh(a,l){const f=T1.textEnd;return f===l?-1:(l=T1.keyEnd=function Bh(a,l,f){for(;l<f&&a.charCodeAt(l)>32;)l++;return l}(a,T1.key=l,f),Ns(a,l,f))}function Ns(a,l,f){for(;l<f&&a.charCodeAt(l)<=32;)l++;return l}function Uh(a,l,f){return uc(a,l,f,!1),Uh}function jh(a,l){return uc(a,l,null,!0),jh}function u8(a){!function hc(a,l,f,_){const w=jn(),T=mo(2);w.firstUpdatePass&&h4(w,null,T,_);const N=lt();if(f!==ns&&O1(N,T,f)){const G=w.data[zo()];if(qh(G,_)&&!h8(w,T)){let K=_?G.classesWithoutHost:G.stylesWithoutHost;null!==K&&(f=Kn(K,f||"")),a4(w,G,N,f,_)}else!function L0(a,l,f,_,w,T,N,G){w===ns&&(w=ke);let K=0,fe=0,Ae=0<w.length?w[0]:null,tt=0<T.length?T[0]:null;for(;null!==Ae||null!==tt;){const Ft=K<w.length?w[K+1]:void 0,ln=fe<T.length?T[fe+1]:void 0;let ui,Fn=null;Ae===tt?(K+=2,fe+=2,Ft!==ln&&(Fn=tt,ui=ln)):null===tt||null!==Ae&&Ae<tt?(K+=2,Fn=Ae):(fe+=2,Fn=tt,ui=ln),null!==Fn&&m3(a,l,f,_,Fn,ui,N,G),Ae=K<w.length?w[K]:null,tt=fe<T.length?T[fe]:null}}(w,G,N,N[br],N[T+1],N[T+1]=function g5(a,l,f){if(null==f||""===f)return ke;const _=[],w=xr(f);if(Array.isArray(w))for(let T=0;T<w.length;T++)a(_,w[T],!0);else if("object"==typeof w)for(const T in w)w.hasOwnProperty(T)&&a(_,T,w[T]);else"string"==typeof w&&l(_,w);return _}(a,l,f),_,T)}}(p2,Dc,a,!0)}function Dc(a,l){for(let f=function f5(a){return function l4(a){T1.key=0,T1.keyEnd=0,T1.value=0,T1.valueEnd=0,T1.textEnd=a.length}(a),Oh(a,Ns(a,0,T1.textEnd))}(l);f>=0;f=Oh(l,f))F(a,Rh(l),!0)}function uc(a,l,f,_){const w=lt(),T=jn(),N=mo(2);T.firstUpdatePass&&h4(T,a,N,_),l!==ns&&O1(w,N,l)&&m3(T,T.data[zo()],w,w[br],a,w[N+1]=function d8(a,l){return null==a||""===a||("string"==typeof l?a+=l:"object"==typeof a&&(a=Gt(xr(a)))),a}(l,f),_,N)}function h8(a,l){return l>=a.expandoStartIndex}function h4(a,l,f,_){const w=a.data;if(null===w[f+1]){const T=w[zo()],N=h8(a,f);qh(T,_)&&null===l&&!N&&(l=!1),l=function f4(a,l,f,_){const w=qa(a);let T=_?l.residualClasses:l.residualStyles;if(null===w)0===(_?l.classBindings:l.styleBindings)&&(f=A0(f=$h(null,a,l,f,_),l.attrs,_),T=null);else{const N=l.directiveStylingLast;if(-1===N||a[N]!==w)if(f=$h(w,a,l,f,_),null===T){let K=function f8(a,l,f){const _=f?l.classBindings:l.styleBindings;if(0!==h3(_))return a[wl(_)]}(a,l,_);void 0!==K&&Array.isArray(K)&&(K=$h(null,a,l,K[1],_),K=A0(K,l.attrs,_),function p3(a,l,f,_){a[wl(f?l.classBindings:l.styleBindings)]=_}(a,l,_,K))}else T=function Gh(a,l,f){let _;const w=l.directiveEnd;for(let T=1+l.directiveStylingLast;T<w;T++)_=A0(_,a[T].hostAttrs,f);return A0(_,l.attrs,f)}(a,l,_)}return void 0!==T&&(_?l.residualClasses=T:l.residualStyles=T),f}(w,T,l,_),function lc(a,l,f,_,w,T){let N=T?l.classBindings:l.styleBindings,G=wl(N),K=h3(N);a[_]=f;let Ae,fe=!1;if(Array.isArray(f)?(Ae=f[1],(null===Ae||$(f,Ae)>0)&&(fe=!0)):Ae=f,w)if(0!==K){const Ft=wl(a[G+1]);a[_+1]=T0(Ft,G),0!==Ft&&(a[Ft+1]=Nh(a[Ft+1],_)),a[G+1]=function u5(a,l){return 131071&a|l<<17}(a[G+1],_)}else a[_+1]=T0(G,0),0!==G&&(a[G+1]=Nh(a[G+1],_)),G=_;else a[_+1]=T0(K,0),0===G?G=_:a[K+1]=Nh(a[K+1],_),K=_;fe&&(a[_+1]=u6(a[_+1])),E0(a,Ae,_,!0),E0(a,Ae,_,!1),function kh(a,l,f,_,w){const T=w?a.residualClasses:a.residualStyles;null!=T&&"string"==typeof l&&$(T,l)>=0&&(f[_+1]=h6(f[_+1]))}(l,Ae,a,_,T),N=T0(G,K),T?l.classBindings=N:l.styleBindings=N}(w,T,l,f,N,_)}}function $h(a,l,f,_,w){let T=null;const N=f.directiveEnd;let G=f.directiveStylingLast;for(-1===G?G=f.directiveStart:G++;G<N&&(T=l[G],_=A0(_,T.hostAttrs,w),T!==a);)G++;return null!==a&&(f.directiveStylingLast=G),_}function A0(a,l,f){const _=f?1:2;let w=-1;if(null!==l)for(let T=0;T<l.length;T++){const N=l[T];"number"==typeof N?w=N:w===_&&(Array.isArray(a)||(a=void 0===a?[]:["",a]),F(a,N,!!f||l[++T]))}return void 0===a?null:a}function p2(a,l,f){const _=String(l);""!==_&&!_.includes(" ")&&F(a,_,f)}function m3(a,l,f,_,w,T,N,G){if(!(3&l.type))return;const K=a.data,fe=K[G+1],Ae=function h5(a){return 1==(1&a)}(fe)?D0(K,l,f,w,h3(fe),N):void 0;g3(Ae)||(g3(T)||function l5(a){return 2==(2&a)}(fe)&&(T=D0(K,null,f,w,G,N)),function nt(a,l,f,_,w){if(l)w?a.addClass(f,_):a.removeClass(f,_);else{let T=-1===_.indexOf("-")?void 0:h2.DashCase;null==w?a.removeStyle(f,_,T):("string"==typeof w&&w.endsWith("!important")&&(w=w.slice(0,-10),T|=h2.Important),a.setStyle(f,_,w,T))}}(_,N,ea(zo(),f),w,T))}function D0(a,l,f,_,w,T){const N=null===l;let G;for(;w>0;){const K=a[w],fe=Array.isArray(K),Ae=fe?K[1]:K,tt=null===Ae;let Ft=f[w+1];Ft===ns&&(Ft=tt?ke:void 0);let ln=tt?V(Ft,_):Ae===_?Ft:void 0;if(fe&&!g3(ln)&&(ln=V(K,_)),g3(ln)&&(G=ln,N))return G;const Fn=a[w+1];w=N?wl(Fn):h3(Fn)}if(null!==l){let K=T?l.residualClasses:l.residualStyles;null!=K&&(G=V(K,_))}return G}function g3(a){return void 0!==a}function qh(a,l){return 0!=(a.flags&(l?8:16))}function f6(a,l=""){const f=lt(),_=jn(),w=a+_r,T=_.firstCreatePass?Jl(_,w,1,l,null):_.data[w],N=f[w]=function hl(a,l){return a.createText(l)}(f[br],l);ce(_,f,N,T),qs(T,!1)}function Zh(a){return I0("",a,""),Zh}function I0(a,l,f){const _=lt(),w=T2(_,a,l,f);return w!==ns&&S2(_,zo(),w),I0}function d6(a,l,f,_,w){const T=lt(),N=r4(T,a,l,f,_,w);return N!==ns&&S2(T,zo(),N),d6}function rf(a,l,f){const _=lt();return O1(_,c1(),l)&&f2(jn(),Zs(),_,a,l,_[br],f,!0),rf}function k0(a,l,f){const _=lt();if(O1(_,c1(),l)){const T=jn(),N=Zs();f2(T,N,_,a,l,function ph(a,l,f){return(null===a||$s(a))&&(f=function xa(a){for(;Array.isArray(a);){if("object"==typeof a[ci])return a;a=a[So]}return null}(f[l.index])),f[br]}(qa(T.data),N,_),f,!0)}return k0}const Kc=void 0;var m4=["en",[["a","p"],["AM","PM"],Kc],[["AM","PM"],Kc,Kc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Kc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Kc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Kc,"{1} 'at' {0}",Kc],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function v5(a){const f=Math.floor(Math.abs(a)),_=a.toString().replace(/^[^.]*\.?/,"").length;return 1===f&&0===_?1:5}];let E2={};function R0(a){const l=function E8(a){return a.toLowerCase().replace(/_/g,"-")}(a);let f=T8(l);if(f)return f;const _=l.split("-")[0];if(f=T8(_),f)return f;if("en"===_)return m4;throw new Te(701,!1)}function O0(a){return R0(a)[Vr.PluralCase]}function T8(a){return a in E2||(E2[a]=Hn.ng&&Hn.ng.common&&Hn.ng.common.locales&&Hn.ng.common.locales[a]),E2[a]}var Vr=(()=>((Vr=Vr||{})[Vr.LocaleId=0]="LocaleId",Vr[Vr.DayPeriodsFormat=1]="DayPeriodsFormat",Vr[Vr.DayPeriodsStandalone=2]="DayPeriodsStandalone",Vr[Vr.DaysFormat=3]="DaysFormat",Vr[Vr.DaysStandalone=4]="DaysStandalone",Vr[Vr.MonthsFormat=5]="MonthsFormat",Vr[Vr.MonthsStandalone=6]="MonthsStandalone",Vr[Vr.Eras=7]="Eras",Vr[Vr.FirstDayOfWeek=8]="FirstDayOfWeek",Vr[Vr.WeekendRange=9]="WeekendRange",Vr[Vr.DateFormat=10]="DateFormat",Vr[Vr.TimeFormat=11]="TimeFormat",Vr[Vr.DateTimeFormat=12]="DateTimeFormat",Vr[Vr.NumberSymbols=13]="NumberSymbols",Vr[Vr.NumberFormats=14]="NumberFormats",Vr[Vr.CurrencyCode=15]="CurrencyCode",Vr[Vr.CurrencySymbol=16]="CurrencySymbol",Vr[Vr.CurrencyName=17]="CurrencyName",Vr[Vr.Currencies=18]="Currencies",Vr[Vr.Directionality=19]="Directionality",Vr[Vr.PluralCase=20]="PluralCase",Vr[Vr.ExtraData=21]="ExtraData",Vr))();const g4="en-US";let A8=g4;function X0(a,l,f,_,w){if(a=dn(a),Array.isArray(a))for(let T=0;T<a.length;T++)X0(a[T],l,f,_,w);else{const T=jn(),N=lt();let G=io(a)?a:dn(a.provide),K=Ec(a);const fe=Hs(),Ae=1048575&fe.providerIndexes,tt=fe.directiveStart,Ft=fe.providerIndexes>>20;if(io(a)||!a.multi){const ln=new rn(K,w,q3),Fn=w3(G,l,w?Ae:Ae+Ft,tt);-1===Fn?(Q2(y2(fe,N),T,G),b3(T,a,l.length),l.push(G),fe.directiveStart++,fe.directiveEnd++,w&&(fe.providerIndexes+=1048576),f.push(ln),N.push(ln)):(f[Fn]=ln,N[Fn]=ln)}else{const ln=w3(G,l,Ae+Ft,tt),Fn=w3(G,l,Ae,Ae+Ft),Ri=Fn>=0&&f[Fn];if(w&&!Ri||!w&&!(ln>=0&&f[ln])){Q2(y2(fe,N),T,G);const nr=function C4(a,l,f,_,w){const T=new rn(a,f,q3);return T.multi=[],T.index=l,T.componentProviders=0,w4(T,w,_&&!f),T}(w?bf:L6,f.length,w,_,K);!w&&Ri&&(f[Fn].providerFactory=nr),b3(T,a,l.length,0),l.push(G),fe.directiveStart++,fe.directiveEnd++,w&&(fe.providerIndexes+=1048576),f.push(nr),N.push(nr)}else b3(T,a,ln>-1?ln:Fn,w4(f[w?Fn:ln],K,!w&&_));!w&&_&&Ri&&f[Fn].componentProviders++}}}function b3(a,l,f,_){const w=io(l),T=function cd(a){return!!a.useClass}(l);if(w||T){const K=(T?dn(l.useClass):l).prototype.ngOnDestroy;if(K){const fe=a.destroyHooks||(a.destroyHooks=[]);if(!w&&l.multi){const Ae=fe.indexOf(f);-1===Ae?fe.push(f,[_,K]):fe[Ae+1].push(_,K)}else fe.push(f,K)}}}function w4(a,l,f){return f&&a.componentProviders++,a.multi.push(l)-1}function w3(a,l,f,_){for(let w=f;w<_;w++)if(l[w]===a)return w;return-1}function L6(a,l,f,_){return z2(this.multi,[])}function bf(a,l,f,_){const w=this.multi;let T;if(this.providerFactory){const N=this.providerFactory.componentProviders,G=w1(f,f[vi],this.providerFactory.index,_);T=G.slice(0,N),z2(w,T);for(let K=N;K<G.length;K++)T.push(G[K])}else T=[],z2(w,T);return T}function z2(a,l){for(let f=0;f<a.length;f++)l.push((0,a[f])());return l}function D6(a,l=[]){return f=>{f.providersResolver=(_,w)=>function N5(a,l,f){const _=jn();if(_.firstCreatePass){const w=$s(a);X0(f,_.data,_.blueprint,w,!0),X0(l,_.data,_.blueprint,w,!1)}}(_,w?w(a):a,l)}}class dc{}class wf{}function Z8(a,l){return new Y8(a,l??null)}class Y8 extends dc{constructor(l,f){super(),this._parent=f,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Qu(this);const _=Os(l);this._bootstrapComponents=sc(_.bootstrap),this._r3Injector=Ru(l,f,[{provide:dc,useValue:this},{provide:Q4,useValue:this.componentFactoryResolver}],Gt(l),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(l)}get injector(){return this._r3Injector}destroy(){const l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(f=>f()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}}class C3 extends wf{constructor(l){super(),this.moduleType=l}create(l){return new Y8(this.moduleType,l)}}class K8 extends dc{constructor(l,f,_){super(),this.componentFactoryResolver=new Qu(this),this.instance=null;const w=new R6([...l,{provide:dc,useValue:this},{provide:Q4,useValue:this.componentFactoryResolver}],f||X4(),_,new Set(["environment"]));this.injector=w,w.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(l){this.injector.onDestroy(l)}}function J0(a,l,f=null){return new K8(a,l,f).injector}let k5=(()=>{class a{constructor(f){this._injector=f,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(f){if(!f.standalone)return null;if(!this.cachedInjectors.has(f.id)){const _=Tu(0,f.type),w=_.length>0?J0([_],this._injector,`Standalone[${f.type.name}]`):null;this.cachedInjectors.set(f.id,w)}return this.cachedInjectors.get(f.id)}ngOnDestroy(){try{for(const f of this.cachedInjectors.values())null!==f&&f.destroy()}finally{this.cachedInjectors.clear()}}}return a.\u0275prov=Gi({token:a,providedIn:"environment",factory:()=>new a(Be(dl))}),a})();function M4(a){a.getStandaloneInjector=l=>l.get(k5).getOrCreateStandaloneInjector(a)}function Af(a,l,f){const _=gs()+a,w=lt();return w[_]===ns?Z2(w,_,f?l.call(f):l()):i4(w,_)}function Lf(a,l,f,_){return Vf(lt(),gs(),a,l,f,_)}function tp(a,l,f,_,w){return Hf(lt(),gs(),a,l,f,_,w)}function V6(a,l,f,_,w,T){return function eu(a,l,f,_,w,T,N,G){const K=l+f;return function x0(a,l,f,_,w){const T=xl(a,l,f,_);return O1(a,l+2,w)||T}(a,K,w,T,N)?Z2(a,K+3,G?_.call(G,w,T,N):_(w,T,N)):pc(a,K+3)}(lt(),gs(),a,l,f,_,w,T)}function Df(a,l,f,_,w,T,N,G,K){const fe=gs()+a,Ae=lt(),tt=function d2(a,l,f,_,w,T){const N=xl(a,l,f,_);return xl(a,l+2,w,T)||N}(Ae,fe,f,_,w,T);return xl(Ae,fe+4,N,G)||tt?Z2(Ae,fe+6,K?l.call(K,f,_,w,T,N,G):l(f,_,w,T,N,G)):i4(Ae,fe+6)}function pc(a,l){const f=a[l];return f===ns?void 0:f}function Vf(a,l,f,_,w,T){const N=l+f;return O1(a,N,w)?Z2(a,N+1,T?_.call(T,w):_(w)):pc(a,N+1)}function Hf(a,l,f,_,w,T,N){const G=l+f;return xl(a,G,w,T)?Z2(a,G+2,N?_.call(N,w,T):_(w,T)):pc(a,G+2)}function T4(a,l){const f=jn();let _;const w=a+_r;f.firstCreatePass?(_=function rp(a,l){if(l)for(let f=l.length-1;f>=0;f--){const _=l[f];if(a===_.name)return _}}(l,f.pipeRegistry),f.data[w]=_,_.onDestroy&&(f.destroyHooks??(f.destroyHooks=[])).push(w,_.onDestroy)):_=f.data[w];const T=_.factory||(_.factory=ao(_.type)),N=zt(q3);try{const G=r2(!1),K=T();return r2(G),function a5(a,l,f,_){f>=a.data.length&&(a.data[f]=null,a.blueprint[f]=null),l[f]=_}(f,lt(),w,K),K}finally{zt(N)}}function Nf(a,l,f){const _=a+_r,w=lt(),T=po(w,_);return nu(w,_)?Vf(w,gs(),l,T.transform,f,T):T.transform(f)}function sp(a,l,f,_){const w=a+_r,T=lt(),N=po(T,w);return nu(T,w)?Hf(T,gs(),l,N.transform,f,_,N):N.transform(f,_)}function nu(a,l){return a[vi].data[l].pure}function kf(a){return l=>{setTimeout(a,void 0,l)}}const F1=class G5 extends C.x{constructor(l=!1){super(),this.__isAsync=l}emit(l){super.next(l)}subscribe(l,f,_){let w=l,T=f||(()=>null),N=_;if(l&&"object"==typeof l){const K=l;w=K.next?.bind(K),T=K.error?.bind(K),N=K.complete?.bind(K)}this.__isAsync&&(T=kf(T),w&&(w=kf(w)),N&&(N=kf(N)));const G=super.subscribe({next:w,error:T,complete:N});return l instanceof De.w0&&l.add(G),G}};function A2(){return this._results[Symbol.iterator]()}class Jc{get changes(){return this._changes||(this._changes=new F1)}constructor(l=!1){this._emitDistinctChangesOnly=l,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const f=Jc.prototype;f[Symbol.iterator]||(f[Symbol.iterator]=A2)}get(l){return this._results[l]}map(l){return this._results.map(l)}filter(l){return this._results.filter(l)}find(l){return this._results.find(l)}reduce(l,f){return this._results.reduce(l,f)}forEach(l){this._results.forEach(l)}some(l){return this._results.some(l)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(l,f){const _=this;_.dirty=!1;const w=function Ni(a){return a.flat(Number.POSITIVE_INFINITY)}(l);(this._changesDetected=!function o2(a,l,f){if(a.length!==l.length)return!1;for(let _=0;_<a.length;_++){let w=a[_],T=l[_];if(f&&(w=f(w),T=f(T)),T!==w)return!1}return!0}(_._results,w,f))&&(_._results=w,_.length=w.length,_.last=w[this.length-1],_.first=w[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let iu=(()=>{class a{}return a.__NG_ELEMENT_ID__=$5,a})();const Rf=iu,ap=class extends Rf{constructor(l,f,_){super(),this._declarationLView=l,this._declarationTContainer=f,this.elementRef=_}createEmbeddedView(l,f){const _=this._declarationTContainer.tView,w=u0(this._declarationLView,_,l,16,null,_.declTNode,null,null,null,null,f||null);w[ho]=this._declarationLView[this._declarationTContainer.index];const N=this._declarationLView[Cs];return null!==N&&(w[Cs]=N.createEmbeddedView(_)),e3(_,w,l),new $c(w)}};function $5(){return E4(Hs(),lt())}function E4(a,l){return 4&a.type?new ap(l,a,pl(a,l)):null}let ru=(()=>{class a{}return a.__NG_ELEMENT_ID__=Of,a})();function Of(){return M3(Hs(),lt())}const W5=ru,cp=class extends W5{constructor(l,f,_){super(),this._lContainer=l,this._hostTNode=f,this._hostLView=_}get element(){return pl(this._hostTNode,this._hostLView)}get injector(){return new D(this._hostTNode,this._hostLView)}get parentInjector(){const l=P2(this._hostTNode,this._hostLView);if(Uo(l)){const f=ha(l,this._hostLView),_=Za(l);return new D(f[vi].data[_+8],f)}return new D(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){const f=su(this._lContainer);return null!==f&&f[l]||null}get length(){return this._lContainer.length-Vs}createEmbeddedView(l,f,_){let w,T;"number"==typeof _?w=_:null!=_&&(w=_.index,T=_.injector);const N=l.createEmbeddedView(f||{},T);return this.insert(N,w),N}createComponent(l,f,_,w,T){const N=l&&!function ai(a){return"function"==typeof a}(l);let G;if(N)G=f;else{const tt=f||{};G=tt.index,_=tt.injector,w=tt.projectableNodes,T=tt.environmentInjector||tt.ngModuleRef}const K=N?l:new s3(zr(l)),fe=_||this.parentInjector;if(!T&&null==K.ngModule){const Ft=(N?fe:this.parentInjector).get(dl,null);Ft&&(T=Ft)}const Ae=K.create(fe,w,void 0,T);return this.insert(Ae.hostView,G),Ae}insert(l,f){const _=l._lView,w=_[vi];if(function A1(a){return Ls(a[Sr])}(_)){const Ae=this.indexOf(l);if(-1!==Ae)this.detach(Ae);else{const tt=_[Sr],Ft=new cp(tt,tt[js],tt[Sr]);Ft.detach(Ft.indexOf(l))}}const T=this._adjustIndex(f),N=this._lContainer;!function W4(a,l,f,_){const w=Vs+_,T=f.length;_>0&&(f[w-1][Pi]=l),_<T-Vs?(l[Pi]=f[w],wr(f,Vs+_,l)):(f.push(l),l[Pi]=null),l[Sr]=f;const N=l[ho];null!==N&&f!==N&&function Gl(a,l){const f=a[Bi];l[es]!==l[Sr][Sr][es]&&(a[eo]=!0),null===f?a[Bi]=[l]:f.push(l)}(N,l);const G=l[Cs];null!==G&&G.insertView(a),l[qi]|=64}(w,_,N,T);const G=ve(T,N),K=_[br],fe=z(K,N[Ci]);return null!==fe&&function $4(a,l,f,_,w,T){_[So]=w,_[js]=l,ze(a,_,f,1,w,T)}(w,N[js],K,_,fe,G),l.attachToViewContainerRef(),wr(Wo(N),T,l),l}move(l,f){return this.insert(l,f)}indexOf(l){const f=su(this._lContainer);return null!==f?f.indexOf(l):-1}remove(l){const f=this._adjustIndex(l,-1),_=Rc(this._lContainer,f);_&&(us(Wo(this._lContainer),f),M1(_[vi],_))}detach(l){const f=this._adjustIndex(l,-1),_=Rc(this._lContainer,f);return _&&null!=us(Wo(this._lContainer),f)?new $c(_):null}_adjustIndex(l,f=0){return l??this.length+f}};function su(a){return a[As]}function Wo(a){return a[As]||(a[As]=[])}function M3(a,l){let f;const _=l[a.index];if(Ls(_))f=_;else{let w;if(8&a.type)w=Ws(_);else{const T=l[br];w=T.createComment("");const N=co(a,l);d(T,z(T,N),w,function H(a,l){return a.nextSibling(l)}(T,N),!1)}l[a.index]=f=vl(_,l,w,a),d0(l,f)}return new cp(f,a,l)}class S3{constructor(l){this.queryList=l,this.matches=null}clone(){return new S3(this.queryList)}setDirty(){this.queryList.setDirty()}}class T3{constructor(l=[]){this.queries=l}createEmbeddedView(l){const f=l.queries;if(null!==f){const _=null!==l.contentQueries?l.contentQueries[0]:f.length,w=[];for(let T=0;T<_;T++){const N=f.getByIndex(T);w.push(this.queries[N.indexInDeclarationView].clone())}return new T3(w)}return null}insertView(l){this.dirtyQueriesWithMatches(l)}detachView(l){this.dirtyQueriesWithMatches(l)}dirtyQueriesWithMatches(l){for(let f=0;f<this.queries.length;f++)null!==qf(l,f).matches&&this.queries[f].setDirty()}}class Ff{constructor(l,f,_=null){this.predicate=l,this.flags=f,this.read=_}}class ou{constructor(l=[]){this.queries=l}elementStart(l,f){for(let _=0;_<this.queries.length;_++)this.queries[_].elementStart(l,f)}elementEnd(l){for(let f=0;f<this.queries.length;f++)this.queries[f].elementEnd(l)}embeddedTView(l){let f=null;for(let _=0;_<this.length;_++){const w=null!==f?f.length:0,T=this.getByIndex(_).embeddedTView(l,w);T&&(T.indexInDeclarationView=_,null!==f?f.push(T):f=[T])}return null!==f?new ou(f):null}template(l,f){for(let _=0;_<this.queries.length;_++)this.queries[_].template(l,f)}getByIndex(l){return this.queries[l]}get length(){return this.queries.length}track(l){this.queries.push(l)}}class Bf{constructor(l,f=-1){this.metadata=l,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=f}elementStart(l,f){this.isApplyingToNode(f)&&this.matchTNode(l,f)}elementEnd(l){this._declarationNodeIndex===l.index&&(this._appliesToNextNode=!1)}template(l,f){this.elementStart(l,f)}embeddedTView(l,f){return this.isApplyingToNode(l)?(this.crossesNgTemplate=!0,this.addMatch(-l.index,f),new Bf(this.metadata)):null}isApplyingToNode(l){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const f=this._declarationNodeIndex;let _=l.parent;for(;null!==_&&8&_.type&&_.index!==f;)_=_.parent;return f===(null!==_?_.index:-1)}return this._appliesToNextNode}matchTNode(l,f){const _=this.metadata.predicate;if(Array.isArray(_))for(let w=0;w<_.length;w++){const T=_[w];this.matchTNodeWithReadOption(l,f,Uf(f,T)),this.matchTNodeWithReadOption(l,f,b2(f,l,T,!1,!1))}else _===iu?4&f.type&&this.matchTNodeWithReadOption(l,f,-1):this.matchTNodeWithReadOption(l,f,b2(f,l,_,!1,!1))}matchTNodeWithReadOption(l,f,_){if(null!==_){const w=this.metadata.read;if(null!==w)if(w===K1||w===ru||w===iu&&4&f.type)this.addMatch(f.index,-2);else{const T=b2(f,l,w,!1,!1);null!==T&&this.addMatch(f.index,T)}else this.addMatch(f.index,_)}}addMatch(l,f){null===this.matches?this.matches=[l,f]:this.matches.push(l,f)}}function Uf(a,l){const f=a.localNames;if(null!==f)for(let _=0;_<f.length;_+=2)if(f[_]===l)return f[_+1];return null}function jf(a,l,f,_){return-1===f?function Y2(a,l){return 11&a.type?pl(a,l):4&a.type?E4(a,l):null}(l,a):-2===f?function q5(a,l,f){return f===K1?pl(l,a):f===iu?E4(l,a):f===ru?M3(l,a):void 0}(a,l,_):w1(a,a[vi],f,l)}function K2(a,l,f,_){const w=l[Cs].queries[_];if(null===w.matches){const T=a.data,N=f.matches,G=[];for(let K=0;K<N.length;K+=2){const fe=N[K];G.push(fe<0?null:jf(l,T[fe],N[K+1],f.metadata.read))}w.matches=G}return w.matches}function Gf(a,l,f,_){const w=a.queries.getByIndex(f),T=w.matches;if(null!==T){const N=K2(a,l,w,f);for(let G=0;G<T.length;G+=2){const K=T[G];if(K>0)_.push(N[G/2]);else{const fe=T[G+1],Ae=l[-K];for(let tt=Vs;tt<Ae.length;tt++){const Ft=Ae[tt];Ft[ho]===Ft[Sr]&&Gf(Ft[vi],Ft,fe,_)}if(null!==Ae[Bi]){const tt=Ae[Bi];for(let Ft=0;Ft<tt.length;Ft++){const ln=tt[Ft];Gf(ln[vi],ln,fe,_)}}}}}return _}function $f(a){const l=lt(),f=jn(),_=vt();ft(_+1);const w=qf(f,_);if(a.dirty&&function Rn(a){return 4==(4&a[qi])}(l)===(2==(2&w.metadata.flags))){if(null===w.matches)a.reset([]);else{const T=w.crossesNgTemplate?Gf(f,l,_,[]):K2(f,l,w,_);a.reset(T,j6),a.notifyOnChanges()}return!0}return!1}function lp(a,l,f){const _=jn();_.firstCreatePass&&(fp(_,new Ff(a,l,f),-1),2==(2&l)&&(_.staticViewQueries=!0)),Wf(_,lt(),l)}function up(a,l,f,_){const w=jn();if(w.firstCreatePass){const T=Hs();fp(w,new Ff(l,f,_),T.index),function dp(a,l){const f=a.contentQueries||(a.contentQueries=[]);l!==(f.length?f[f.length-1]:-1)&&f.push(a.queries.length-1,l)}(w,a),2==(2&f)&&(w.staticContentQueries=!0)}Wf(w,lt(),f)}function hp(){return function Z5(a,l){return a[Cs].queries[l].queryList}(lt(),vt())}function Wf(a,l,f){const _=new Jc(4==(4&f));Zu(a,l,_,_.destroy),null===l[Cs]&&(l[Cs]=new T3),l[Cs].queries.push(new S3(_))}function fp(a,l,f){null===a.queries&&(a.queries=new ou),a.queries.track(new Bf(l,f))}function qf(a,l){return a.queries.getByIndex(l)}function z4(a,l){return E4(a,l)}function n(a){return!!Os(a)}function Ks(...a){}const Lo=new vr("Application Initializer");let Ko=(()=>{class a{constructor(f){this.appInits=f,this.resolve=Ks,this.reject=Ks,this.initialized=!1,this.done=!1,this.donePromise=new Promise((_,w)=>{this.resolve=_,this.reject=w})}runInitializers(){if(this.initialized)return;const f=[],_=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let w=0;w<this.appInits.length;w++){const T=this.appInits[w]();if(zh(T))f.push(T);else if(i8(T)){const N=new Promise((G,K)=>{T.subscribe({complete:G,error:K})});f.push(N)}}Promise.all(f).then(()=>{_()}).catch(w=>{this.reject(w)}),0===f.length&&_(),this.initialized=!0}}return a.\u0275fac=function(f){return new(f||a)(Be(Lo,8))},a.\u0275prov=Gi({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const Xa=new vr("AppId",{providedIn:"root",factory:function Xs(){return`${Sa()}${Sa()}${Sa()}`}});function Sa(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Ta=new vr("Platform Initializer"),Ja=new vr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),g2=new vr("AnimationModuleType");let Qc=(()=>{class a{log(f){console.log(f)}warn(f){console.warn(f)}}return a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=Gi({token:a,factory:a.\u0275fac,providedIn:"platform"}),a})();const g1=new vr("LocaleId",{providedIn:"root",factory:()=>In(g1,me.Optional|me.SkipSelf)||function J1(){return typeof $localize<"u"&&$localize.locale||g4}()}),L2=new vr("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class pp{constructor(l,f){this.ngModuleFactory=l,this.componentFactories=f}}let mp=(()=>{class a{compileModuleSync(f){return new C3(f)}compileModuleAsync(f){return Promise.resolve(this.compileModuleSync(f))}compileModuleAndAllComponentsSync(f){const _=this.compileModuleSync(f),T=sc(Os(f).declarations).reduce((N,G)=>{const K=zr(G);return K&&N.push(new s3(K)),N},[]);return new pp(_,T)}compileModuleAndAllComponentsAsync(f){return Promise.resolve(this.compileModuleAndAllComponentsSync(f))}clearCache(){}clearCacheFor(f){}getModuleId(f){}}return a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=Gi({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const _p=(()=>Promise.resolve(0))();function el(a){typeof Zone>"u"?_p.then(()=>{a&&a.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",a)}class _2{constructor({enableLongStackTrace:l=!1,shouldCoalesceEventChangeDetection:f=!1,shouldCoalesceRunChangeDetection:_=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new F1(!1),this.onMicrotaskEmpty=new F1(!1),this.onStable=new F1(!1),this.onError=new F1(!1),typeof Zone>"u")throw new Te(908,!1);Zone.assertZonePatched();const w=this;w._nesting=0,w._outer=w._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(w._inner=w._inner.fork(new Zone.TaskTrackingZoneSpec)),l&&Zone.longStackTraceZoneSpec&&(w._inner=w._inner.fork(Zone.longStackTraceZoneSpec)),w.shouldCoalesceEventChangeDetection=!_&&f,w.shouldCoalesceRunChangeDetection=_,w.lastRequestAnimationFrameId=-1,w.nativeRequestAnimationFrame=function Jf(){let a=Hn.requestAnimationFrame,l=Hn.cancelAnimationFrame;if(typeof Zone<"u"&&a&&l){const f=a[Zone.__symbol__("OriginalDelegate")];f&&(a=f);const _=l[Zone.__symbol__("OriginalDelegate")];_&&(l=_)}return{nativeRequestAnimationFrame:a,nativeCancelAnimationFrame:l}}().nativeRequestAnimationFrame,function Q1(a){const l=()=>{!function X5(a){a.isCheckStableRunning||-1!==a.lastRequestAnimationFrameId||(a.lastRequestAnimationFrameId=a.nativeRequestAnimationFrame.call(Hn,()=>{a.fakeTopEventTask||(a.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{a.lastRequestAnimationFrameId=-1,e2(a),a.isCheckStableRunning=!0,uu(a),a.isCheckStableRunning=!1},void 0,()=>{},()=>{})),a.fakeTopEventTask.invoke()}),e2(a))}(a)};a._inner=a._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(f,_,w,T,N,G)=>{try{return z3(a),f.invokeTask(w,T,N,G)}finally{(a.shouldCoalesceEventChangeDetection&&"eventTask"===T.type||a.shouldCoalesceRunChangeDetection)&&l(),ed(a)}},onInvoke:(f,_,w,T,N,G,K)=>{try{return z3(a),f.invoke(w,T,N,G,K)}finally{a.shouldCoalesceRunChangeDetection&&l(),ed(a)}},onHasTask:(f,_,w,T)=>{f.hasTask(w,T),_===w&&("microTask"==T.change?(a._hasPendingMicrotasks=T.microTask,e2(a),uu(a)):"macroTask"==T.change&&(a.hasPendingMacrotasks=T.macroTask))},onHandleError:(f,_,w,T)=>(f.handleError(w,T),a.runOutsideAngular(()=>a.onError.emit(T)),!1)})}(w)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!_2.isInAngularZone())throw new Te(909,!1)}static assertNotInAngularZone(){if(_2.isInAngularZone())throw new Te(909,!1)}run(l,f,_){return this._inner.run(l,f,_)}runTask(l,f,_,w){const T=this._inner,N=T.scheduleEventTask("NgZoneEvent: "+w,l,Ll,Ks,Ks);try{return T.runTask(N,f,_)}finally{T.cancelTask(N)}}runGuarded(l,f,_){return this._inner.runGuarded(l,f,_)}runOutsideAngular(l){return this._outer.run(l)}}const Ll={};function uu(a){if(0==a._nesting&&!a.hasPendingMicrotasks&&!a.isStable)try{a._nesting++,a.onMicrotaskEmpty.emit(null)}finally{if(a._nesting--,!a.hasPendingMicrotasks)try{a.runOutsideAngular(()=>a.onStable.emit(null))}finally{a.isStable=!0}}}function e2(a){a.hasPendingMicrotasks=!!(a._hasPendingMicrotasks||(a.shouldCoalesceEventChangeDetection||a.shouldCoalesceRunChangeDetection)&&-1!==a.lastRequestAnimationFrameId)}function z3(a){a._nesting++,a.isStable&&(a.isStable=!1,a.onUnstable.emit(null))}function ed(a){a._nesting--,uu(a)}class A3{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new F1,this.onMicrotaskEmpty=new F1,this.onStable=new F1,this.onError=new F1}run(l,f,_){return l.apply(f,_)}runGuarded(l,f,_){return l.apply(f,_)}runOutsideAngular(l){return l()}runTask(l,f,_,w){return l.apply(f,_)}}const bm=new vr(""),wm=new vr("");let vp,Zm=(()=>{class a{constructor(f,_,w){this._ngZone=f,this.registry=_,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,vp||(function Ym(a){vp=a}(w),w.addToWindow(_)),this._watchAngularEvents(),f.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{_2.assertNotInAngularZone(),el(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())el(()=>{for(;0!==this._callbacks.length;){let f=this._callbacks.pop();clearTimeout(f.timeoutId),f.doneCb(this._didWork)}this._didWork=!1});else{let f=this.getPendingTasks();this._callbacks=this._callbacks.filter(_=>!_.updateCb||!_.updateCb(f)||(clearTimeout(_.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(f=>({source:f.source,creationLocation:f.creationLocation,data:f.data})):[]}addCallback(f,_,w){let T=-1;_&&_>0&&(T=setTimeout(()=>{this._callbacks=this._callbacks.filter(N=>N.timeoutId!==T),f(this._didWork,this.getPendingTasks())},_)),this._callbacks.push({doneCb:f,timeoutId:T,updateCb:w})}whenStable(f,_,w){if(w&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(f,_,w),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(f){this.registry.registerApplication(f,this)}unregisterApplication(f){this.registry.unregisterApplication(f)}findProviders(f,_,w){return[]}}return a.\u0275fac=function(f){return new(f||a)(Be(_2),Be(Cm),Be(wm))},a.\u0275prov=Gi({token:a,factory:a.\u0275fac}),a})(),Cm=(()=>{class a{constructor(){this._applications=new Map}registerApplication(f,_){this._applications.set(f,_)}unregisterApplication(f){this._applications.delete(f)}unregisterAllApplications(){this._applications.clear()}getTestability(f){return this._applications.get(f)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(f,_=!0){return vp?.findTestabilityInTree(this,f,_)??null}}return a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=Gi({token:a,factory:a.\u0275fac,providedIn:"platform"}),a})();const L3=!1;let A4=null;const Mm=new vr("AllowMultipleToken"),yp=new vr("PlatformDestroyListeners"),Sm=new vr("appBootstrapListener");class Xm{constructor(l,f){this.name=l,this.token=f}}function J5(a,l,f=[]){const _=`Platform: ${l}`,w=new vr(_);return(T=[])=>{let N=Q5();if(!N||N.injector.get(Mm,!1)){const G=[...f,...T,{provide:w,useValue:!0}];a?a(G):function Jm(a){if(A4&&!A4.get(Mm,!1))throw new Te(400,!1);A4=a;const l=a.get(Am);(function Em(a){const l=a.get(Ta,null);l&&l.forEach(f=>f())})(a)}(function zm(a=[],l){return gl.create({name:l,providers:[{provide:Y4,useValue:"platform"},{provide:yp,useValue:new Set([()=>A4=null])},...a]})}(G,_))}return function e7(a){const l=Q5();if(!l)throw new Te(401,!1);return l}()}}function Q5(){return A4?.get(Am)??null}let Am=(()=>{class a{constructor(f){this._injector=f,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(f,_){const w=function em(a,l){let f;return f="noop"===a?new A3:("zone.js"===a?void 0:a)||new _2(l),f}(_?.ngZone,function Lm(a){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!a||!a.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!a||!a.ngZoneRunCoalescing)||!1}}(_)),T=[{provide:_2,useValue:w}];return w.run(()=>{const N=gl.create({providers:T,parent:this.injector,name:f.moduleType.name}),G=f.create(N),K=G.injector.get(rc,null);if(!K)throw new Te(402,!1);return w.runOutsideAngular(()=>{const fe=w.onError.subscribe({next:Ae=>{K.handleError(Ae)}});G.onDestroy(()=>{bp(this._modules,G),fe.unsubscribe()})}),function Dm(a,l,f){try{const _=f();return zh(_)?_.catch(w=>{throw l.runOutsideAngular(()=>a.handleError(w)),w}):_}catch(_){throw l.runOutsideAngular(()=>a.handleError(_)),_}}(K,w,()=>{const fe=G.injector.get(Ko);return fe.runInitializers(),fe.donePromise.then(()=>(function L8(a){Ke(a,"Expected localeId to be defined"),"string"==typeof a&&(A8=a.toLowerCase().replace(/_/g,"-"))}(G.injector.get(g1,g4)||g4),this._moduleDoBootstrap(G),G))})})}bootstrapModule(f,_=[]){const w=Im({},_);return function Km(a,l,f){const _=new C3(f);return Promise.resolve(_)}(0,0,f).then(T=>this.bootstrapModuleFactory(T,w))}_moduleDoBootstrap(f){const _=f.injector.get(xp);if(f._bootstrapComponents.length>0)f._bootstrapComponents.forEach(w=>_.bootstrap(w));else{if(!f.instance.ngDoBootstrap)throw new Te(-403,!1);f.instance.ngDoBootstrap(_)}this._modules.push(f)}onDestroy(f){this._destroyListeners.push(f)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Te(404,!1);this._modules.slice().forEach(_=>_.destroy()),this._destroyListeners.forEach(_=>_());const f=this._injector.get(yp,null);f&&(f.forEach(_=>_()),f.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return a.\u0275fac=function(f){return new(f||a)(Be(gl))},a.\u0275prov=Gi({token:a,factory:a.\u0275fac,providedIn:"platform"}),a})();function Im(a,l){return Array.isArray(l)?l.reduce(Im,a):{...a,...l}}let xp=(()=>{class a{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(f,_,w){this._zone=f,this._injector=_,this._exceptionHandler=w,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const T=new Xe.y(G=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{G.next(this._stable),G.complete()})}),N=new Xe.y(G=>{let K;this._zone.runOutsideAngular(()=>{K=this._zone.onStable.subscribe(()=>{_2.assertNotInAngularZone(),el(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,G.next(!0))})})});const fe=this._zone.onUnstable.subscribe(()=>{_2.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{G.next(!1)}))});return()=>{K.unsubscribe(),fe.unsubscribe()}});this.isStable=(0,s.T)(T,N.pipe(function qt(a={}){const{connector:l=(()=>new C.x),resetOnError:f=!0,resetOnComplete:_=!0,resetOnRefCountZero:w=!0}=a;return T=>{let N,G,K,fe=0,Ae=!1,tt=!1;const Ft=()=>{G?.unsubscribe(),G=void 0},ln=()=>{Ft(),N=K=void 0,Ae=tt=!1},Fn=()=>{const ui=N;ln(),ui?.unsubscribe()};return(0,Et.e)((ui,Ri)=>{fe++,!tt&&!Ae&&Ft();const nr=K=K??l();Ri.add(()=>{fe--,0===fe&&!tt&&!Ae&&(G=gt(Fn,w))}),nr.subscribe(Ri),!N&&fe>0&&(N=new de.Hp({next:Or=>nr.next(Or),error:Or=>{tt=!0,Ft(),G=gt(ln,f,Or),nr.error(Or)},complete:()=>{Ae=!0,Ft(),G=gt(ln,_),nr.complete()}}),(0,ct.Xf)(ui).subscribe(N))})(T)}}()))}bootstrap(f,_){const w=f instanceof B6;if(!this._injector.get(Ko).done){!w&&ro(f);throw new Te(405,L3)}let N;N=w?f:this._injector.get(Q4).resolveComponentFactory(f),this.componentTypes.push(N.componentType);const G=function Tm(a){return a.isBoundToModule}(N)?void 0:this._injector.get(dc),fe=N.create(gl.NULL,[],_||N.selector,G),Ae=fe.location.nativeElement,tt=fe.injector.get(bm,null);return tt?.registerApplication(Ae),fe.onDestroy(()=>{this.detachView(fe.hostView),bp(this.components,fe),tt?.unregisterApplication(Ae)}),this._loadComponent(fe),fe}tick(){if(this._runningTick)throw new Te(101,!1);try{this._runningTick=!0;for(let f of this._views)f.detectChanges()}catch(f){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(f))}finally{this._runningTick=!1}}attachView(f){const _=f;this._views.push(_),_.attachToAppRef(this)}detachView(f){const _=f;bp(this._views,_),_.detachFromAppRef()}_loadComponent(f){this.attachView(f.hostView),this.tick(),this.components.push(f);const _=this._injector.get(Sm,[]);_.push(...this._bootstrapListeners),_.forEach(w=>w(f))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(f=>f()),this._views.slice().forEach(f=>f.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(f){return this._destroyListeners.push(f),()=>bp(this._destroyListeners,f)}destroy(){if(this._destroyed)throw new Te(406,!1);const f=this._injector;f.destroy&&!f.destroyed&&f.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return a.\u0275fac=function(f){return new(f||a)(Be(_2),Be(dl),Be(rc))},a.\u0275prov=Gi({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function bp(a,l){const f=a.indexOf(l);f>-1&&a.splice(f,1)}let r7=(()=>{class a{}return a.__NG_ELEMENT_ID__=s7,a})();function s7(a){return function o7(a,l,f){if(as(a)&&!f){const _=Ss(a.index,l);return new $c(_,_)}return 47&a.type?new $c(l[es],l):null}(Hs(),lt(),16==(16&a))}class Nm{constructor(){}supports(l){return n4(l)}create(l){return new km(l)}}const u7=(a,l)=>l;class km{constructor(l){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=l||u7}forEachItem(l){let f;for(f=this._itHead;null!==f;f=f._next)l(f)}forEachOperation(l){let f=this._itHead,_=this._removalsHead,w=0,T=null;for(;f||_;){const N=!_||f&&f.currentIndex<Om(_,w,T)?f:_,G=Om(N,w,T),K=N.currentIndex;if(N===_)w--,_=_._nextRemoved;else if(f=f._next,null==N.previousIndex)w++;else{T||(T=[]);const fe=G-w,Ae=K-w;if(fe!=Ae){for(let Ft=0;Ft<fe;Ft++){const ln=Ft<T.length?T[Ft]:T[Ft]=0,Fn=ln+Ft;Ae<=Fn&&Fn<fe&&(T[Ft]=ln+1)}T[N.previousIndex]=Ae-fe}}G!==K&&l(N,G,K)}}forEachPreviousItem(l){let f;for(f=this._previousItHead;null!==f;f=f._nextPrevious)l(f)}forEachAddedItem(l){let f;for(f=this._additionsHead;null!==f;f=f._nextAdded)l(f)}forEachMovedItem(l){let f;for(f=this._movesHead;null!==f;f=f._nextMoved)l(f)}forEachRemovedItem(l){let f;for(f=this._removalsHead;null!==f;f=f._nextRemoved)l(f)}forEachIdentityChange(l){let f;for(f=this._identityChangesHead;null!==f;f=f._nextIdentityChange)l(f)}diff(l){if(null==l&&(l=[]),!n4(l))throw new Te(900,!1);return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let w,T,N,f=this._itHead,_=!1;if(Array.isArray(l)){this.length=l.length;for(let G=0;G<this.length;G++)T=l[G],N=this._trackByFn(G,T),null!==f&&Object.is(f.trackById,N)?(_&&(f=this._verifyReinsertion(f,T,N,G)),Object.is(f.item,T)||this._addIdentityChange(f,T)):(f=this._mismatch(f,T,N,G),_=!0),f=f._next}else w=0,function Yd(a,l){if(Array.isArray(a))for(let f=0;f<a.length;f++)l(a[f]);else{const f=a[Symbol.iterator]();let _;for(;!(_=f.next()).done;)l(_.value)}}(l,G=>{N=this._trackByFn(w,G),null!==f&&Object.is(f.trackById,N)?(_&&(f=this._verifyReinsertion(f,G,N,w)),Object.is(f.item,G)||this._addIdentityChange(f,G)):(f=this._mismatch(f,G,N,w),_=!0),f=f._next,w++}),this.length=w;return this._truncate(f),this.collection=l,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let l;for(l=this._previousItHead=this._itHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._additionsHead;null!==l;l=l._nextAdded)l.previousIndex=l.currentIndex;for(this._additionsHead=this._additionsTail=null,l=this._movesHead;null!==l;l=l._nextMoved)l.previousIndex=l.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(l,f,_,w){let T;return null===l?T=this._itTail:(T=l._prev,this._remove(l)),null!==(l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(_,null))?(Object.is(l.item,f)||this._addIdentityChange(l,f),this._reinsertAfter(l,T,w)):null!==(l=null===this._linkedRecords?null:this._linkedRecords.get(_,w))?(Object.is(l.item,f)||this._addIdentityChange(l,f),this._moveAfter(l,T,w)):l=this._addAfter(new h7(f,_),T,w),l}_verifyReinsertion(l,f,_,w){let T=null===this._unlinkedRecords?null:this._unlinkedRecords.get(_,null);return null!==T?l=this._reinsertAfter(T,l._prev,w):l.currentIndex!=w&&(l.currentIndex=w,this._addToMoves(l,w)),l}_truncate(l){for(;null!==l;){const f=l._next;this._addToRemovals(this._unlink(l)),l=f}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(l,f,_){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(l);const w=l._prevRemoved,T=l._nextRemoved;return null===w?this._removalsHead=T:w._nextRemoved=T,null===T?this._removalsTail=w:T._prevRemoved=w,this._insertAfter(l,f,_),this._addToMoves(l,_),l}_moveAfter(l,f,_){return this._unlink(l),this._insertAfter(l,f,_),this._addToMoves(l,_),l}_addAfter(l,f,_){return this._insertAfter(l,f,_),this._additionsTail=null===this._additionsTail?this._additionsHead=l:this._additionsTail._nextAdded=l,l}_insertAfter(l,f,_){const w=null===f?this._itHead:f._next;return l._next=w,l._prev=f,null===w?this._itTail=l:w._prev=l,null===f?this._itHead=l:f._next=l,null===this._linkedRecords&&(this._linkedRecords=new Rm),this._linkedRecords.put(l),l.currentIndex=_,l}_remove(l){return this._addToRemovals(this._unlink(l))}_unlink(l){null!==this._linkedRecords&&this._linkedRecords.remove(l);const f=l._prev,_=l._next;return null===f?this._itHead=_:f._next=_,null===_?this._itTail=f:_._prev=f,l}_addToMoves(l,f){return l.previousIndex===f||(this._movesTail=null===this._movesTail?this._movesHead=l:this._movesTail._nextMoved=l),l}_addToRemovals(l){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Rm),this._unlinkedRecords.put(l),l.currentIndex=null,l._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=l,l._prevRemoved=null):(l._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=l),l}_addIdentityChange(l,f){return l.item=f,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=l:this._identityChangesTail._nextIdentityChange=l,l}}class h7{constructor(l,f){this.item=l,this.trackById=f,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class am{constructor(){this._head=null,this._tail=null}add(l){null===this._head?(this._head=this._tail=l,l._nextDup=null,l._prevDup=null):(this._tail._nextDup=l,l._prevDup=this._tail,l._nextDup=null,this._tail=l)}get(l,f){let _;for(_=this._head;null!==_;_=_._nextDup)if((null===f||f<=_.currentIndex)&&Object.is(_.trackById,l))return _;return null}remove(l){const f=l._prevDup,_=l._nextDup;return null===f?this._head=_:f._nextDup=_,null===_?this._tail=f:_._prevDup=f,null===this._head}}class Rm{constructor(){this.map=new Map}put(l){const f=l.trackById;let _=this.map.get(f);_||(_=new am,this.map.set(f,_)),_.add(l)}get(l,f){const w=this.map.get(l);return w?w.get(l,f):null}remove(l){const f=l.trackById;return this.map.get(f).remove(l)&&this.map.delete(f),l}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Om(a,l,f){const _=a.previousIndex;if(null===_)return _;let w=0;return f&&_<f.length&&(w=f[_]),_+l+w}class cm{constructor(){}supports(l){return l instanceof Map||bh(l)}create(){return new f7}}class f7{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(l){let f;for(f=this._mapHead;null!==f;f=f._next)l(f)}forEachPreviousItem(l){let f;for(f=this._previousMapHead;null!==f;f=f._nextPrevious)l(f)}forEachChangedItem(l){let f;for(f=this._changesHead;null!==f;f=f._nextChanged)l(f)}forEachAddedItem(l){let f;for(f=this._additionsHead;null!==f;f=f._nextAdded)l(f)}forEachRemovedItem(l){let f;for(f=this._removalsHead;null!==f;f=f._nextRemoved)l(f)}diff(l){if(l){if(!(l instanceof Map||bh(l)))throw new Te(900,!1)}else l=new Map;return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let f=this._mapHead;if(this._appendAfter=null,this._forEach(l,(_,w)=>{if(f&&f.key===w)this._maybeAddToChanges(f,_),this._appendAfter=f,f=f._next;else{const T=this._getOrCreateRecordForKey(w,_);f=this._insertBeforeOrAppend(f,T)}}),f){f._prev&&(f._prev._next=null),this._removalsHead=f;for(let _=f;null!==_;_=_._nextRemoved)_===this._mapHead&&(this._mapHead=null),this._records.delete(_.key),_._nextRemoved=_._next,_.previousValue=_.currentValue,_.currentValue=null,_._prev=null,_._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(l,f){if(l){const _=l._prev;return f._next=l,f._prev=_,l._prev=f,_&&(_._next=f),l===this._mapHead&&(this._mapHead=f),this._appendAfter=l,l}return this._appendAfter?(this._appendAfter._next=f,f._prev=this._appendAfter):this._mapHead=f,this._appendAfter=f,null}_getOrCreateRecordForKey(l,f){if(this._records.has(l)){const w=this._records.get(l);this._maybeAddToChanges(w,f);const T=w._prev,N=w._next;return T&&(T._next=N),N&&(N._prev=T),w._next=null,w._prev=null,w}const _=new Fm(l);return this._records.set(l,_),_.currentValue=f,this._addToAdditions(_),_}_reset(){if(this.isDirty){let l;for(this._previousMapHead=this._mapHead,l=this._previousMapHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._changesHead;null!==l;l=l._nextChanged)l.previousValue=l.currentValue;for(l=this._additionsHead;null!=l;l=l._nextAdded)l.previousValue=l.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(l,f){Object.is(f,l.currentValue)||(l.previousValue=l.currentValue,l.currentValue=f,this._addToChanges(l))}_addToAdditions(l){null===this._additionsHead?this._additionsHead=this._additionsTail=l:(this._additionsTail._nextAdded=l,this._additionsTail=l)}_addToChanges(l){null===this._changesHead?this._changesHead=this._changesTail=l:(this._changesTail._nextChanged=l,this._changesTail=l)}_forEach(l,f){l instanceof Map?l.forEach(f):Object.keys(l).forEach(_=>f(l[_],_))}}class Fm{constructor(l){this.key=l,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Bm(){return new lm([new Nm])}let lm=(()=>{class a{constructor(f){this.factories=f}static create(f,_){if(null!=_){const w=_.factories.slice();f=f.concat(w)}return new a(f)}static extend(f){return{provide:a,useFactory:_=>a.create(f,_||Bm()),deps:[[a,new tl,new N1]]}}find(f){const _=this.factories.find(w=>w.supports(f));if(null!=_)return _;throw new Te(901,!1)}}return a.\u0275prov=Gi({token:a,providedIn:"root",factory:Bm}),a})();function Um(){return new Tp([new cm])}let Tp=(()=>{class a{constructor(f){this.factories=f}static create(f,_){if(_){const w=_.factories.slice();f=f.concat(w)}return new a(f)}static extend(f){return{provide:a,useFactory:_=>a.create(f,_||Um()),deps:[[a,new tl,new N1]]}}find(f){const _=this.factories.find(w=>w.supports(f));if(_)return _;throw new Te(901,!1)}}return a.\u0275prov=Gi({token:a,providedIn:"root",factory:Um}),a})();const g7=J5(null,"core",[]);let _7=(()=>{class a{constructor(f){}}return a.\u0275fac=function(f){return new(f||a)(Be(xp))},a.\u0275mod=er({type:a}),a.\u0275inj=Hr({}),a})();function v7(a){return"boolean"==typeof a?a:null!=a&&"false"!==a}},433:(yi,on,ue)=>{"use strict";ue.d(on,{Fj:()=>Te,qu:()=>aa,NI:()=>ws,oH:()=>Oo,u:()=>t1,cw:()=>J,sg:()=>Ms,x0:()=>oo,JU:()=>En,a5:()=>jr,JJ:()=>it,JL:()=>zt,YN:()=>va,_:()=>Ls,UX:()=>$a,kI:()=>ot,_Y:()=>eo,Kr:()=>Qo});var C=ue(1571),De=ue(6895),Xe=ue(2076),s=ue(9751),ct=ue(4742),de=ue(8421),Et=ue(3269),qt=ue(5403),gt=ue(3268),jt=ue(1810),Gt=ue(4004);let Kn=(()=>{class se{constructor(X,Ve){this._renderer=X,this._elementRef=Ve,this.onChange=lt=>{},this.onTouched=()=>{}}setProperty(X,Ve){this._renderer.setProperty(this._elementRef.nativeElement,X,Ve)}registerOnTouched(X){this.onTouched=X}registerOnChange(X){this.onChange=X}setDisabledState(X){this.setProperty("disabled",X)}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(C.Qsj),C.Y36(C.SBq))},se.\u0275dir=C.lG2({type:se}),se})(),Sn=(()=>{class se extends Kn{}return se.\u0275fac=function(){let ne;return function(Ve){return(ne||(ne=C.n5z(se)))(Ve||se)}}(),se.\u0275dir=C.lG2({type:se,features:[C.qOj]}),se})();const En=new C.OlP("NgValueAccessor"),hn={provide:En,useExisting:(0,C.Gpc)(()=>Te),multi:!0},hi=new C.OlP("CompositionEventMode");let Te=(()=>{class se extends Kn{constructor(X,Ve,lt){super(X,Ve),this._compositionMode=lt,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Vn(){const se=(0,De.q)()?(0,De.q)().getUserAgent():"";return/android (\d+)/.test(se.toLowerCase())}())}writeValue(X){this.setProperty("value",X??"")}_handleInput(X){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(X)}_compositionStart(){this._composing=!0}_compositionEnd(X){this._composing=!1,this._compositionMode&&this.onChange(X)}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(C.Qsj),C.Y36(C.SBq),C.Y36(hi,8))},se.\u0275dir=C.lG2({type:se,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(X,Ve){1&X&&C.NdJ("input",function(jn){return Ve._handleInput(jn.target.value)})("blur",function(){return Ve.onTouched()})("compositionstart",function(){return Ve._compositionStart()})("compositionend",function(jn){return Ve._compositionEnd(jn.target.value)})},features:[C._Bn([hn]),C.qOj]}),se})();const _t=!1;function Ue(se){return null==se||("string"==typeof se||Array.isArray(se))&&0===se.length}function Ye(se){return null!=se&&"number"==typeof se.length}const Pt=new C.OlP("NgValidators"),je=new C.OlP("NgAsyncValidators"),Ze=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class ot{static min(ne){return function pt(se){return ne=>{if(Ue(ne.value)||Ue(se))return null;const X=parseFloat(ne.value);return!isNaN(X)&&X<se?{min:{min:se,actual:ne.value}}:null}}(ne)}static max(ne){return function Ot(se){return ne=>{if(Ue(ne.value)||Ue(se))return null;const X=parseFloat(ne.value);return!isNaN(X)&&X>se?{max:{max:se,actual:ne.value}}:null}}(ne)}static required(ne){return function Xt(se){return Ue(se.value)?{required:!0}:null}(ne)}static requiredTrue(ne){return function Mi(se){return!0===se.value?null:{required:!0}}(ne)}static email(ne){return function Wi(se){return Ue(se.value)||Ze.test(se.value)?null:{email:!0}}(ne)}static minLength(ne){return function ti(se){return ne=>Ue(ne.value)||!Ye(ne.value)?null:ne.value.length<se?{minlength:{requiredLength:se,actualLength:ne.value.length}}:null}(ne)}static maxLength(ne){return function Tn(se){return ne=>Ye(ne.value)&&ne.value.length>se?{maxlength:{requiredLength:se,actualLength:ne.value.length}}:null}(ne)}static pattern(ne){return function rt(se){if(!se)return xt;let ne,X;return"string"==typeof se?(X="","^"!==se.charAt(0)&&(X+="^"),X+=se,"$"!==se.charAt(se.length-1)&&(X+="$"),ne=new RegExp(X)):(X=se.toString(),ne=se),Ve=>{if(Ue(Ve.value))return null;const lt=Ve.value;return ne.test(lt)?null:{pattern:{requiredPattern:X,actualValue:lt}}}}(ne)}static nullValidator(ne){return null}static compose(ne){return mi(ne)}static composeAsync(ne){return Ii(ne)}}function xt(se){return null}function ht(se){return null!=se}function st(se){const ne=(0,C.QGY)(se)?(0,Xe.D)(se):se;if(_t&&!(0,C.CqO)(ne)){let X="Expected async validator to return Promise or Observable.";throw"object"==typeof se&&(X+=" Are you using a synchronous validator where an async validator is expected?"),new C.vHH(-1101,X)}return ne}function Ne(se){let ne={};return se.forEach(X=>{ne=null!=X?{...ne,...X}:ne}),0===Object.keys(ne).length?null:ne}function Pe(se,ne){return ne.map(X=>X(se))}function Bt(se){return se.map(ne=>function Ke(se){return!se.validate}(ne)?ne:X=>ne.validate(X))}function mi(se){if(!se)return null;const ne=se.filter(ht);return 0==ne.length?null:function(X){return Ne(Pe(X,ne))}}function Di(se){return null!=se?mi(Bt(se)):null}function Ii(se){if(!se)return null;const ne=se.filter(ht);return 0==ne.length?null:function(X){return function wt(...se){const ne=(0,Et.jO)(se),{args:X,keys:Ve}=(0,ct.D)(se),lt=new s.y(jn=>{const{length:ms}=X;if(!ms)return void jn.complete();const Eo=new Array(ms);let Hs=ms,o1=ms;for(let Yo=0;Yo<ms;Yo++){let qs=!1;(0,de.Xf)(X[Yo]).subscribe((0,qt.x)(jn,ba=>{qs||(qs=!0,o1--),Eo[Yo]=ba},()=>Hs--,void 0,()=>{(!Hs||!qs)&&(o1||jn.next(Ve?(0,jt.n)(Ve,Eo):Eo),jn.complete())}))}});return ne?lt.pipe((0,gt.Z)(ne)):lt}(Pe(X,ne).map(st)).pipe((0,Gt.U)(Ne))}}function Gi(se){return null!=se?Ii(Bt(se)):null}function Br(se,ne){return null===se?[ne]:Array.isArray(se)?[...se,ne]:[se,ne]}function Hr(se){return se._rawValidators}function Ur(se){return se._rawAsyncValidators}function Si(se){return se?Array.isArray(se)?se:[se]:[]}function Xi(se,ne){return Array.isArray(se)?se.includes(ne):se===ne}function Rs(se,ne){const X=Si(ne);return Si(se).forEach(lt=>{Xi(X,lt)||X.push(lt)}),X}function $r(se,ne){return Si(ne).filter(X=>!Xi(se,X))}class Ji{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(ne){this._rawValidators=ne||[],this._composedValidatorFn=Di(this._rawValidators)}_setAsyncValidators(ne){this._rawAsyncValidators=ne||[],this._composedAsyncValidatorFn=Gi(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(ne){this._onDestroyCallbacks.push(ne)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(ne=>ne()),this._onDestroyCallbacks=[]}reset(ne){this.control&&this.control.reset(ne)}hasError(ne,X){return!!this.control&&this.control.hasError(ne,X)}getError(ne,X){return this.control?this.control.getError(ne,X):null}}class ir extends Ji{get formDirective(){return null}get path(){return null}}class jr extends Ji{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class sn{constructor(ne){this._cd=ne}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let it=(()=>{class se extends sn{constructor(X){super(X)}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(jr,2))},se.\u0275dir=C.lG2({type:se,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(X,Ve){2&X&&C.ekj("ng-untouched",Ve.isUntouched)("ng-touched",Ve.isTouched)("ng-pristine",Ve.isPristine)("ng-dirty",Ve.isDirty)("ng-valid",Ve.isValid)("ng-invalid",Ve.isInvalid)("ng-pending",Ve.isPending)},features:[C.qOj]}),se})(),zt=(()=>{class se extends sn{constructor(X){super(X)}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(ir,10))},se.\u0275dir=C.lG2({type:se,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(X,Ve){2&X&&C.ekj("ng-untouched",Ve.isUntouched)("ng-touched",Ve.isTouched)("ng-pristine",Ve.isPristine)("ng-dirty",Ve.isDirty)("ng-valid",Ve.isValid)("ng-invalid",Ve.isInvalid)("ng-pending",Ve.isPending)("ng-submitted",Ve.isSubmitted)},features:[C.qOj]}),se})();function Qi(se,ne){return se?`with name: '${ne}'`:`at index: ${ne}`}const Tt=!1,In="VALID",vn="INVALID",ei="PENDING",Oi="DISABLED";function kt(se){return(qe(se)?se.validators:se)||null}function an(se,ne){return(qe(ne)?ne.asyncValidators:se)||null}function qe(se){return null!=se&&!Array.isArray(se)&&"object"==typeof se}function Ge(se,ne,X){const Ve=se.controls;if(!(ne?Object.keys(Ve):Ve).length)throw new C.vHH(1e3,Tt?function Ir(se){return`\n    There are no form controls registered with this ${se?"group":"array"} yet. If you're using ngModel,\n    you may want to check next tick (e.g. use setTimeout).\n  `}(ne):"");if(!Ve[X])throw new C.vHH(1001,Tt?function cn(se,ne){return`Cannot find form control ${Qi(se,ne)}`}(ne,X):"")}function ye(se,ne,X){se._forEachChild((Ve,lt)=>{if(void 0===X[lt])throw new C.vHH(1002,Tt?function Be(se,ne){return`Must supply a value for form control ${Qi(se,ne)}`}(ne,lt):"")})}class ke{constructor(ne,X){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(ne),this._assignAsyncValidators(X)}get validator(){return this._composedValidatorFn}set validator(ne){this._rawValidators=this._composedValidatorFn=ne}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(ne){this._rawAsyncValidators=this._composedAsyncValidatorFn=ne}get parent(){return this._parent}get valid(){return this.status===In}get invalid(){return this.status===vn}get pending(){return this.status==ei}get disabled(){return this.status===Oi}get enabled(){return this.status!==Oi}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(ne){this._assignValidators(ne)}setAsyncValidators(ne){this._assignAsyncValidators(ne)}addValidators(ne){this.setValidators(Rs(ne,this._rawValidators))}addAsyncValidators(ne){this.setAsyncValidators(Rs(ne,this._rawAsyncValidators))}removeValidators(ne){this.setValidators($r(ne,this._rawValidators))}removeAsyncValidators(ne){this.setAsyncValidators($r(ne,this._rawAsyncValidators))}hasValidator(ne){return Xi(this._rawValidators,ne)}hasAsyncValidator(ne){return Xi(this._rawAsyncValidators,ne)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(ne={}){this.touched=!0,this._parent&&!ne.onlySelf&&this._parent.markAsTouched(ne)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(ne=>ne.markAllAsTouched())}markAsUntouched(ne={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(X=>{X.markAsUntouched({onlySelf:!0})}),this._parent&&!ne.onlySelf&&this._parent._updateTouched(ne)}markAsDirty(ne={}){this.pristine=!1,this._parent&&!ne.onlySelf&&this._parent.markAsDirty(ne)}markAsPristine(ne={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(X=>{X.markAsPristine({onlySelf:!0})}),this._parent&&!ne.onlySelf&&this._parent._updatePristine(ne)}markAsPending(ne={}){this.status=ei,!1!==ne.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!ne.onlySelf&&this._parent.markAsPending(ne)}disable(ne={}){const X=this._parentMarkedDirty(ne.onlySelf);this.status=Oi,this.errors=null,this._forEachChild(Ve=>{Ve.disable({...ne,onlySelf:!0})}),this._updateValue(),!1!==ne.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...ne,skipPristineCheck:X}),this._onDisabledChange.forEach(Ve=>Ve(!0))}enable(ne={}){const X=this._parentMarkedDirty(ne.onlySelf);this.status=In,this._forEachChild(Ve=>{Ve.enable({...ne,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:ne.emitEvent}),this._updateAncestors({...ne,skipPristineCheck:X}),this._onDisabledChange.forEach(Ve=>Ve(!1))}_updateAncestors(ne){this._parent&&!ne.onlySelf&&(this._parent.updateValueAndValidity(ne),ne.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(ne){this._parent=ne}getRawValue(){return this.value}updateValueAndValidity(ne={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===In||this.status===ei)&&this._runAsyncValidator(ne.emitEvent)),!1!==ne.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!ne.onlySelf&&this._parent.updateValueAndValidity(ne)}_updateTreeValidity(ne={emitEvent:!0}){this._forEachChild(X=>X._updateTreeValidity(ne)),this.updateValueAndValidity({onlySelf:!0,emitEvent:ne.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Oi:In}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(ne){if(this.asyncValidator){this.status=ei,this._hasOwnPendingAsyncValidator=!0;const X=st(this.asyncValidator(this));this._asyncValidationSubscription=X.subscribe(Ve=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(Ve,{emitEvent:ne})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(ne,X={}){this.errors=ne,this._updateControlsErrors(!1!==X.emitEvent)}get(ne){let X=ne;return null==X||(Array.isArray(X)||(X=X.split(".")),0===X.length)?null:X.reduce((Ve,lt)=>Ve&&Ve._find(lt),this)}getError(ne,X){const Ve=X?this.get(X):this;return Ve&&Ve.errors?Ve.errors[ne]:null}hasError(ne,X){return!!this.getError(ne,X)}get root(){let ne=this;for(;ne._parent;)ne=ne._parent;return ne}_updateControlsErrors(ne){this.status=this._calculateStatus(),ne&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(ne)}_initObservables(){this.valueChanges=new C.vpe,this.statusChanges=new C.vpe}_calculateStatus(){return this._allControlsDisabled()?Oi:this.errors?vn:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ei)?ei:this._anyControlsHaveStatus(vn)?vn:In}_anyControlsHaveStatus(ne){return this._anyControls(X=>X.status===ne)}_anyControlsDirty(){return this._anyControls(ne=>ne.dirty)}_anyControlsTouched(){return this._anyControls(ne=>ne.touched)}_updatePristine(ne={}){this.pristine=!this._anyControlsDirty(),this._parent&&!ne.onlySelf&&this._parent._updatePristine(ne)}_updateTouched(ne={}){this.touched=this._anyControlsTouched(),this._parent&&!ne.onlySelf&&this._parent._updateTouched(ne)}_registerOnCollectionChange(ne){this._onCollectionChange=ne}_setUpdateStrategy(ne){qe(ne)&&null!=ne.updateOn&&(this._updateOn=ne.updateOn)}_parentMarkedDirty(ne){return!ne&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(ne){return null}_assignValidators(ne){this._rawValidators=Array.isArray(ne)?ne.slice():ne,this._composedValidatorFn=function Ht(se){return Array.isArray(se)?Di(se):se||null}(this._rawValidators)}_assignAsyncValidators(ne){this._rawAsyncValidators=Array.isArray(ne)?ne.slice():ne,this._composedAsyncValidatorFn=function _n(se){return Array.isArray(se)?Gi(se):se||null}(this._rawAsyncValidators)}}class J extends ke{constructor(ne,X,Ve){super(kt(X),an(Ve,X)),this.controls=ne,this._initObservables(),this._setUpdateStrategy(X),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(ne,X){return this.controls[ne]?this.controls[ne]:(this.controls[ne]=X,X.setParent(this),X._registerOnCollectionChange(this._onCollectionChange),X)}addControl(ne,X,Ve={}){this.registerControl(ne,X),this.updateValueAndValidity({emitEvent:Ve.emitEvent}),this._onCollectionChange()}removeControl(ne,X={}){this.controls[ne]&&this.controls[ne]._registerOnCollectionChange(()=>{}),delete this.controls[ne],this.updateValueAndValidity({emitEvent:X.emitEvent}),this._onCollectionChange()}setControl(ne,X,Ve={}){this.controls[ne]&&this.controls[ne]._registerOnCollectionChange(()=>{}),delete this.controls[ne],X&&this.registerControl(ne,X),this.updateValueAndValidity({emitEvent:Ve.emitEvent}),this._onCollectionChange()}contains(ne){return this.controls.hasOwnProperty(ne)&&this.controls[ne].enabled}setValue(ne,X={}){ye(this,!0,ne),Object.keys(ne).forEach(Ve=>{Ge(this,!0,Ve),this.controls[Ve].setValue(ne[Ve],{onlySelf:!0,emitEvent:X.emitEvent})}),this.updateValueAndValidity(X)}patchValue(ne,X={}){null!=ne&&(Object.keys(ne).forEach(Ve=>{const lt=this.controls[Ve];lt&&lt.patchValue(ne[Ve],{onlySelf:!0,emitEvent:X.emitEvent})}),this.updateValueAndValidity(X))}reset(ne={},X={}){this._forEachChild((Ve,lt)=>{Ve.reset(ne[lt],{onlySelf:!0,emitEvent:X.emitEvent})}),this._updatePristine(X),this._updateTouched(X),this.updateValueAndValidity(X)}getRawValue(){return this._reduceChildren({},(ne,X,Ve)=>(ne[Ve]=X.getRawValue(),ne))}_syncPendingControls(){let ne=this._reduceChildren(!1,(X,Ve)=>!!Ve._syncPendingControls()||X);return ne&&this.updateValueAndValidity({onlySelf:!0}),ne}_forEachChild(ne){Object.keys(this.controls).forEach(X=>{const Ve=this.controls[X];Ve&&ne(Ve,X)})}_setUpControls(){this._forEachChild(ne=>{ne.setParent(this),ne._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(ne){for(const[X,Ve]of Object.entries(this.controls))if(this.contains(X)&&ne(Ve))return!0;return!1}_reduceValue(){return this._reduceChildren({},(X,Ve,lt)=>((Ve.enabled||this.disabled)&&(X[lt]=Ve.value),X))}_reduceChildren(ne,X){let Ve=ne;return this._forEachChild((lt,jn)=>{Ve=X(Ve,lt,jn)}),Ve}_allControlsDisabled(){for(const ne of Object.keys(this.controls))if(this.controls[ne].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(ne){return this.controls.hasOwnProperty(ne)?this.controls[ne]:null}}class at extends J{}const nn=new C.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>bn}),bn="always";function Dn(se,ne){return[...ne.path,se]}function Nn(se,ne,X=bn){rs(se,ne),ne.valueAccessor.writeValue(se.value),(se.disabled||"always"===X)&&ne.valueAccessor.setDisabledState?.(se.disabled),function zs(se,ne){ne.valueAccessor.registerOnChange(X=>{se._pendingValue=X,se._pendingChange=!0,se._pendingDirty=!0,"change"===se.updateOn&&zr(se,ne)})}(se,ne),function ls(se,ne){const X=(Ve,lt)=>{ne.valueAccessor.writeValue(Ve),lt&&ne.viewToModelUpdate(Ve)};se.registerOnChange(X),ne._registerOnDestroy(()=>{se._unregisterOnChange(X)})}(se,ne),function Qs(se,ne){ne.valueAccessor.registerOnTouched(()=>{se._pendingTouched=!0,"blur"===se.updateOn&&se._pendingChange&&zr(se,ne),"submit"!==se.updateOn&&se.markAsTouched()})}(se,ne),function er(se,ne){if(ne.valueAccessor.setDisabledState){const X=Ve=>{ne.valueAccessor.setDisabledState(Ve)};se.registerOnDisabledChange(X),ne._registerOnDestroy(()=>{se._unregisterOnDisabledChange(X)})}}(se,ne)}function Ei(se,ne,X=!0){const Ve=()=>{};ne.valueAccessor&&(ne.valueAccessor.registerOnChange(Ve),ne.valueAccessor.registerOnTouched(Ve)),Er(se,ne),se&&(ne._invokeOnDestroyCallbacks(),se._registerOnCollectionChange(()=>{}))}function si(se,ne){se.forEach(X=>{X.registerOnValidatorChange&&X.registerOnValidatorChange(ne)})}function rs(se,ne){const X=Hr(se);null!==ne.validator?se.setValidators(Br(X,ne.validator)):"function"==typeof X&&se.setValidators([X]);const Ve=Ur(se);null!==ne.asyncValidator?se.setAsyncValidators(Br(Ve,ne.asyncValidator)):"function"==typeof Ve&&se.setAsyncValidators([Ve]);const lt=()=>se.updateValueAndValidity();si(ne._rawValidators,lt),si(ne._rawAsyncValidators,lt)}function Er(se,ne){let X=!1;if(null!==se){if(null!==ne.validator){const lt=Hr(se);if(Array.isArray(lt)&&lt.length>0){const jn=lt.filter(ms=>ms!==ne.validator);jn.length!==lt.length&&(X=!0,se.setValidators(jn))}}if(null!==ne.asyncValidator){const lt=Ur(se);if(Array.isArray(lt)&&lt.length>0){const jn=lt.filter(ms=>ms!==ne.asyncValidator);jn.length!==lt.length&&(X=!0,se.setAsyncValidators(jn))}}}const Ve=()=>{};return si(ne._rawValidators,Ve),si(ne._rawAsyncValidators,Ve),X}function zr(se,ne){se._pendingDirty&&se.markAsDirty(),se.setValue(se._pendingValue,{emitModelToViewChange:!1}),ne.viewToModelUpdate(se._pendingValue),se._pendingChange=!1}function vi(se,ne){if(!se.hasOwnProperty("model"))return!1;const X=se.model;return!!X.isFirstChange()||!Object.is(ne,X.currentValue)}function Pi(se,ne){if(!ne)return null;let X,Ve,lt;return Array.isArray(ne),ne.forEach(jn=>{jn.constructor===Te?X=jn:function qi(se){return Object.getPrototypeOf(se.constructor)===Sn}(jn)?Ve=jn:lt=jn}),lt||Ve||X||null}function Vo(se,ne){const X=se.indexOf(ne);X>-1&&se.splice(X,1)}function br(se){return"object"==typeof se&&null!==se&&2===Object.keys(se).length&&"value"in se&&"disabled"in se}const ws=class extends ke{constructor(ne=null,X,Ve){super(kt(X),an(Ve,X)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(ne),this._setUpdateStrategy(X),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),qe(X)&&(X.nonNullable||X.initialValueIsDefault)&&(this.defaultValue=br(ne)?ne.value:ne)}setValue(ne,X={}){this.value=this._pendingValue=ne,this._onChange.length&&!1!==X.emitModelToViewChange&&this._onChange.forEach(Ve=>Ve(this.value,!1!==X.emitViewToModelChange)),this.updateValueAndValidity(X)}patchValue(ne,X={}){this.setValue(ne,X)}reset(ne=this.defaultValue,X={}){this._applyFormState(ne),this.markAsPristine(X),this.markAsUntouched(X),this.setValue(this.value,X),this._pendingChange=!1}_updateValue(){}_anyControls(ne){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(ne){this._onChange.push(ne)}_unregisterOnChange(ne){Vo(this._onChange,ne)}registerOnDisabledChange(ne){this._onDisabledChange.push(ne)}_unregisterOnDisabledChange(ne){Vo(this._onDisabledChange,ne)}_forEachChild(ne){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(ne){br(ne)?(this.value=this._pendingValue=ne.value,ne.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=ne}};let tr=(()=>{class se extends ir{ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return Dn(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}}return se.\u0275fac=function(){let ne;return function(Ve){return(ne||(ne=C.n5z(se)))(Ve||se)}}(),se.\u0275dir=C.lG2({type:se,features:[C.qOj]}),se})(),eo=(()=>{class se{}return se.\u0275fac=function(X){return new(X||se)},se.\u0275dir=C.lG2({type:se,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),se})();const Bi={provide:En,useExisting:(0,C.Gpc)(()=>Ls),multi:!0};let Gs=(()=>{class se{}return se.\u0275fac=function(X){return new(X||se)},se.\u0275mod=C.oAB({type:se}),se.\u0275inj=C.cJS({}),se})(),Qn=(()=>{class se{constructor(){this._accessors=[]}add(X,Ve){this._accessors.push([X,Ve])}remove(X){for(let Ve=this._accessors.length-1;Ve>=0;--Ve)if(this._accessors[Ve][1]===X)return void this._accessors.splice(Ve,1)}select(X){this._accessors.forEach(Ve=>{this._isSameGroup(Ve,X)&&Ve[1]!==X&&Ve[1].fireUncheck(X.value)})}_isSameGroup(X,Ve){return!!X[0].control&&X[0]._parent===Ve._control._parent&&X[1].name===Ve.name}}return se.\u0275fac=function(X){return new(X||se)},se.\u0275prov=C.Yz7({token:se,factory:se.\u0275fac,providedIn:Gs}),se})(),Ls=(()=>{class se extends Sn{constructor(X,Ve,lt,jn){super(X,Ve),this._registry=lt,this._injector=jn,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=(0,C.f3M)(nn,{optional:!0})??bn}ngOnInit(){this._control=this._injector.get(jr),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(X){this._state=X===this.value,this.setProperty("checked",this._state)}registerOnChange(X){this._fn=X,this.onChange=()=>{X(this.value),this._registry.select(this)}}setDisabledState(X){(this.setDisabledStateFired||X||"whenDisabledForLegacyCode"===this.callSetDisabledState)&&this.setProperty("disabled",X),this.setDisabledStateFired=!0}fireUncheck(X){this.writeValue(X)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(C.Qsj),C.Y36(C.SBq),C.Y36(Qn),C.Y36(C.zs3))},se.\u0275dir=C.lG2({type:se,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(X,Ve){1&X&&C.NdJ("change",function(){return Ve.onChange()})("blur",function(){return Ve.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[C._Bn([Bi]),C.qOj]}),se})();const to=new C.OlP("NgModelWithFormControlWarning"),$s={provide:jr,useExisting:(0,C.Gpc)(()=>Oo)};let Oo=(()=>{class se extends jr{set isDisabled(X){}constructor(X,Ve,lt,jn,ms){super(),this._ngModelWarningConfig=jn,this.callSetDisabledState=ms,this.update=new C.vpe,this._ngModelWarningSent=!1,this._setValidators(X),this._setAsyncValidators(Ve),this.valueAccessor=Pi(0,lt)}ngOnChanges(X){if(this._isControlChanged(X)){const Ve=X.form.previousValue;Ve&&Ei(Ve,this,!1),Nn(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}vi(X,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Ei(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(X){this.viewModel=X,this.update.emit(X)}_isControlChanged(X){return X.hasOwnProperty("form")}}return se._ngModelWarningSentOnce=!1,se.\u0275fac=function(X){return new(X||se)(C.Y36(Pt,10),C.Y36(je,10),C.Y36(En,10),C.Y36(to,8),C.Y36(nn,8))},se.\u0275dir=C.lG2({type:se,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[C._Bn([$s]),C.qOj,C.TTD]}),se})();const Nr={provide:ir,useExisting:(0,C.Gpc)(()=>Ms)};let Ms=(()=>{class se extends ir{constructor(X,Ve,lt){super(),this.callSetDisabledState=lt,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new C.vpe,this._setValidators(X),this._setAsyncValidators(Ve)}ngOnChanges(X){this._checkFormPresent(),X.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Er(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(X){const Ve=this.form.get(X.path);return Nn(Ve,X,this.callSetDisabledState),Ve.updateValueAndValidity({emitEvent:!1}),this.directives.push(X),Ve}getControl(X){return this.form.get(X.path)}removeControl(X){Ei(X.control||null,X,!1),function Io(se,ne){const X=se.indexOf(ne);X>-1&&se.splice(X,1)}(this.directives,X)}addFormGroup(X){this._setUpFormContainer(X)}removeFormGroup(X){this._cleanUpFormContainer(X)}getFormGroup(X){return this.form.get(X.path)}addFormArray(X){this._setUpFormContainer(X)}removeFormArray(X){this._cleanUpFormContainer(X)}getFormArray(X){return this.form.get(X.path)}updateModel(X,Ve){this.form.get(X.path).setValue(Ve)}onSubmit(X){return this.submitted=!0,function Sr(se,ne){se._syncPendingControls(),ne.forEach(X=>{const Ve=X.control;"submit"===Ve.updateOn&&Ve._pendingChange&&(X.viewToModelUpdate(Ve._pendingValue),Ve._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(X),"dialog"===X?.target?.method}onReset(){this.resetForm()}resetForm(X){this.form.reset(X),this.submitted=!1}_updateDomValue(){this.directives.forEach(X=>{const Ve=X.control,lt=this.form.get(X.path);Ve!==lt&&(Ei(Ve||null,X),(se=>se instanceof ws)(lt)&&(Nn(lt,X,this.callSetDisabledState),X.control=lt))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(X){const Ve=this.form.get(X.path);(function ds(se,ne){rs(se,ne)})(Ve,X),Ve.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(X){if(this.form){const Ve=this.form.get(X.path);Ve&&function ro(se,ne){return Er(se,ne)}(Ve,X)&&Ve.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){rs(this.form,this),this._oldForm&&Er(this._oldForm,this)}_checkFormPresent(){}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(Pt,10),C.Y36(je,10),C.Y36(nn,8))},se.\u0275dir=C.lG2({type:se,selectors:[["","formGroup",""]],hostBindings:function(X,Ve){1&X&&C.NdJ("submit",function(jn){return Ve.onSubmit(jn)})("reset",function(){return Ve.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[C._Bn([Nr]),C.qOj,C.TTD]}),se})();const Fa={provide:ir,useExisting:(0,C.Gpc)(()=>oo)};let oo=(()=>{class se extends tr{constructor(X,Ve,lt){super(),this._parent=X,this._setValidators(Ve),this._setAsyncValidators(lt)}_checkParentType(){oa(this._parent)}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(ir,13),C.Y36(Pt,10),C.Y36(je,10))},se.\u0275dir=C.lG2({type:se,selectors:[["","formGroupName",""]],inputs:{name:["formGroupName","name"]},features:[C._Bn([Fa]),C.qOj]}),se})();const _1={provide:ir,useExisting:(0,C.Gpc)(()=>yo)};let yo=(()=>{class se extends ir{constructor(X,Ve,lt){super(),this._parent=X,this._setValidators(Ve),this._setAsyncValidators(lt)}ngOnInit(){this._checkParentType(),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return Dn(null==this.name?this.name:this.name.toString(),this._parent)}_checkParentType(){oa(this._parent)}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(ir,13),C.Y36(Pt,10),C.Y36(je,10))},se.\u0275dir=C.lG2({type:se,selectors:[["","formArrayName",""]],inputs:{name:["formArrayName","name"]},features:[C._Bn([_1]),C.qOj]}),se})();function oa(se){return!(se instanceof oo||se instanceof Ms||se instanceof yo)}const za={provide:jr,useExisting:(0,C.Gpc)(()=>t1)};let t1=(()=>{class se extends jr{set isDisabled(X){}constructor(X,Ve,lt,jn,ms){super(),this._ngModelWarningConfig=ms,this._added=!1,this.update=new C.vpe,this._ngModelWarningSent=!1,this._parent=X,this._setValidators(Ve),this._setAsyncValidators(lt),this.valueAccessor=Pi(0,jn)}ngOnChanges(X){this._added||this._setUpControl(),vi(X,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(X){this.viewModel=X,this.update.emit(X)}get path(){return Dn(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return se._ngModelWarningSentOnce=!1,se.\u0275fac=function(X){return new(X||se)(C.Y36(ir,13),C.Y36(Pt,10),C.Y36(je,10),C.Y36(En,10),C.Y36(to,8))},se.\u0275dir=C.lG2({type:se,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[C._Bn([za]),C.qOj,C.TTD]}),se})();const Fo={provide:En,useExisting:(0,C.Gpc)(()=>Jo),multi:!0};function Xo(se,ne){return null==se?`${ne}`:(ne&&"object"==typeof ne&&(ne="Object"),`${se}: ${ne}`.slice(0,50))}let Jo=(()=>{class se extends Sn{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(X){this._compareWith=X}writeValue(X){this.value=X;const lt=Xo(this._getOptionId(X),X);this.setProperty("value",lt)}registerOnChange(X){this.onChange=Ve=>{this.value=this._getOptionValue(Ve),X(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(X){for(const Ve of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(Ve),X))return Ve;return null}_getOptionValue(X){const Ve=function U1(se){return se.split(":")[0]}(X);return this._optionMap.has(Ve)?this._optionMap.get(Ve):X}}return se.\u0275fac=function(){let ne;return function(Ve){return(ne||(ne=C.n5z(se)))(Ve||se)}}(),se.\u0275dir=C.lG2({type:se,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(X,Ve){1&X&&C.NdJ("change",function(jn){return Ve.onChange(jn.target.value)})("blur",function(){return Ve.onTouched()})},inputs:{compareWith:"compareWith"},features:[C._Bn([Fo]),C.qOj]}),se})(),va=(()=>{class se{constructor(X,Ve,lt){this._element=X,this._renderer=Ve,this._select=lt,this._select&&(this.id=this._select._registerOption())}set ngValue(X){null!=this._select&&(this._select._optionMap.set(this.id,X),this._setElementValue(Xo(this.id,X)),this._select.writeValue(this._select.value))}set value(X){this._setElementValue(X),this._select&&this._select.writeValue(this._select.value)}_setElementValue(X){this._renderer.setProperty(this._element.nativeElement,"value",X)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(C.SBq),C.Y36(C.Qsj),C.Y36(Jo,9))},se.\u0275dir=C.lG2({type:se,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),se})();const cr={provide:En,useExisting:(0,C.Gpc)(()=>v1),multi:!0};function To(se,ne){return null==se?`${ne}`:("string"==typeof ne&&(ne=`'${ne}'`),ne&&"object"==typeof ne&&(ne="Object"),`${se}: ${ne}`.slice(0,50))}let v1=(()=>{class se extends Sn{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(X){this._compareWith=X}writeValue(X){let Ve;if(this.value=X,Array.isArray(X)){const lt=X.map(jn=>this._getOptionId(jn));Ve=(jn,ms)=>{jn._setSelected(lt.indexOf(ms.toString())>-1)}}else Ve=(lt,jn)=>{lt._setSelected(!1)};this._optionMap.forEach(Ve)}registerOnChange(X){this.onChange=Ve=>{const lt=[],jn=Ve.selectedOptions;if(void 0!==jn){const ms=jn;for(let Eo=0;Eo<ms.length;Eo++){const o1=this._getOptionValue(ms[Eo].value);lt.push(o1)}}else{const ms=Ve.options;for(let Eo=0;Eo<ms.length;Eo++){const Hs=ms[Eo];if(Hs.selected){const o1=this._getOptionValue(Hs.value);lt.push(o1)}}}this.value=lt,X(lt)}}_registerOption(X){const Ve=(this._idCounter++).toString();return this._optionMap.set(Ve,X),Ve}_getOptionId(X){for(const Ve of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(Ve)._value,X))return Ve;return null}_getOptionValue(X){const Ve=function Ba(se){return se.split(":")[0]}(X);return this._optionMap.has(Ve)?this._optionMap.get(Ve)._value:X}}return se.\u0275fac=function(){let ne;return function(Ve){return(ne||(ne=C.n5z(se)))(Ve||se)}}(),se.\u0275dir=C.lG2({type:se,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(X,Ve){1&X&&C.NdJ("change",function(jn){return Ve.onChange(jn.target)})("blur",function(){return Ve.onTouched()})},inputs:{compareWith:"compareWith"},features:[C._Bn([cr]),C.qOj]}),se})(),Qo=(()=>{class se{constructor(X,Ve,lt){this._element=X,this._renderer=Ve,this._select=lt,this._select&&(this.id=this._select._registerOption(this))}set ngValue(X){null!=this._select&&(this._value=X,this._setElementValue(To(this.id,X)),this._select.writeValue(this._select.value))}set value(X){this._select?(this._value=X,this._setElementValue(To(this.id,X)),this._select.writeValue(this._select.value)):this._setElementValue(X)}_setElementValue(X){this._renderer.setProperty(this._element.nativeElement,"value",X)}_setSelected(X){this._renderer.setProperty(this._element.nativeElement,"selected",X)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return se.\u0275fac=function(X){return new(X||se)(C.Y36(C.SBq),C.Y36(C.Qsj),C.Y36(v1,9))},se.\u0275dir=C.lG2({type:se,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),se})(),Rn=(()=>{class se{}return se.\u0275fac=function(X){return new(X||se)},se.\u0275mod=C.oAB({type:se}),se.\u0275inj=C.cJS({imports:[Gs]}),se})();class s1 extends ke{constructor(ne,X,Ve){super(kt(X),an(Ve,X)),this.controls=ne,this._initObservables(),this._setUpdateStrategy(X),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(ne){return this.controls[this._adjustIndex(ne)]}push(ne,X={}){this.controls.push(ne),this._registerControl(ne),this.updateValueAndValidity({emitEvent:X.emitEvent}),this._onCollectionChange()}insert(ne,X,Ve={}){this.controls.splice(ne,0,X),this._registerControl(X),this.updateValueAndValidity({emitEvent:Ve.emitEvent})}removeAt(ne,X={}){let Ve=this._adjustIndex(ne);Ve<0&&(Ve=0),this.controls[Ve]&&this.controls[Ve]._registerOnCollectionChange(()=>{}),this.controls.splice(Ve,1),this.updateValueAndValidity({emitEvent:X.emitEvent})}setControl(ne,X,Ve={}){let lt=this._adjustIndex(ne);lt<0&&(lt=0),this.controls[lt]&&this.controls[lt]._registerOnCollectionChange(()=>{}),this.controls.splice(lt,1),X&&(this.controls.splice(lt,0,X),this._registerControl(X)),this.updateValueAndValidity({emitEvent:Ve.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(ne,X={}){ye(this,!1,ne),ne.forEach((Ve,lt)=>{Ge(this,!1,lt),this.at(lt).setValue(Ve,{onlySelf:!0,emitEvent:X.emitEvent})}),this.updateValueAndValidity(X)}patchValue(ne,X={}){null!=ne&&(ne.forEach((Ve,lt)=>{this.at(lt)&&this.at(lt).patchValue(Ve,{onlySelf:!0,emitEvent:X.emitEvent})}),this.updateValueAndValidity(X))}reset(ne=[],X={}){this._forEachChild((Ve,lt)=>{Ve.reset(ne[lt],{onlySelf:!0,emitEvent:X.emitEvent})}),this._updatePristine(X),this._updateTouched(X),this.updateValueAndValidity(X)}getRawValue(){return this.controls.map(ne=>ne.getRawValue())}clear(ne={}){this.controls.length<1||(this._forEachChild(X=>X._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:ne.emitEvent}))}_adjustIndex(ne){return ne<0?ne+this.length:ne}_syncPendingControls(){let ne=this.controls.reduce((X,Ve)=>!!Ve._syncPendingControls()||X,!1);return ne&&this.updateValueAndValidity({onlySelf:!0}),ne}_forEachChild(ne){this.controls.forEach((X,Ve)=>{ne(X,Ve)})}_updateValue(){this.value=this.controls.filter(ne=>ne.enabled||this.disabled).map(ne=>ne.value)}_anyControls(ne){return this.controls.some(X=>X.enabled&&ne(X))}_setUpControls(){this._forEachChild(ne=>this._registerControl(ne))}_allControlsDisabled(){for(const ne of this.controls)if(ne.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(ne){ne.setParent(this),ne._registerOnCollectionChange(this._onCollectionChange)}_find(ne){return this.at(ne)??null}}function Ga(se){return!!se&&(void 0!==se.asyncValidators||void 0!==se.validators||void 0!==se.updateOn)}let aa=(()=>{class se{constructor(){this.useNonNullable=!1}get nonNullable(){const X=new se;return X.useNonNullable=!0,X}group(X,Ve=null){const lt=this._reduceControls(X);let jn={};return Ga(Ve)?jn=Ve:null!==Ve&&(jn.validators=Ve.validator,jn.asyncValidators=Ve.asyncValidator),new J(lt,jn)}record(X,Ve=null){const lt=this._reduceControls(X);return new at(lt,Ve)}control(X,Ve,lt){let jn={};return this.useNonNullable?(Ga(Ve)?jn=Ve:(jn.validators=Ve,jn.asyncValidators=lt),new ws(X,{...jn,nonNullable:!0})):new ws(X,Ve,lt)}array(X,Ve,lt){const jn=X.map(ms=>this._createControl(ms));return new s1(jn,Ve,lt)}_reduceControls(X){const Ve={};return Object.keys(X).forEach(lt=>{Ve[lt]=this._createControl(X[lt])}),Ve}_createControl(X){return X instanceof ws||X instanceof ke?X:Array.isArray(X)?this.control(X[0],X.length>1?X[1]:null,X.length>2?X[2]:null):this.control(X)}}return se.\u0275fac=function(X){return new(X||se)},se.\u0275prov=C.Yz7({token:se,factory:se.\u0275fac,providedIn:"root"}),se})(),$a=(()=>{class se{static withConfig(X){return{ngModule:se,providers:[{provide:to,useValue:X.warnOnNgModelWithFormControl??"always"},{provide:nn,useValue:X.callSetDisabledState??bn}]}}}return se.\u0275fac=function(X){return new(X||se)},se.\u0275mod=C.oAB({type:se}),se.\u0275inj=C.cJS({imports:[Rn]}),se})()},1481:(yi,on,ue)=>{"use strict";ue.d(on,{Dx:()=>zt,H7:()=>kt,b2:()=>jr,q6:()=>Rs,se:()=>Xt});var C=ue(6895),De=ue(1571);class Xe extends C.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class s extends Xe{static makeCurrent(){(0,C.HT)(new s)}onAndCancel(Ge,ye,ke){return Ge.addEventListener(ye,ke,!1),()=>{Ge.removeEventListener(ye,ke,!1)}}dispatchEvent(Ge,ye){Ge.dispatchEvent(ye)}remove(Ge){Ge.parentNode&&Ge.parentNode.removeChild(Ge)}createElement(Ge,ye){return(ye=ye||this.getDefaultDocument()).createElement(Ge)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Ge){return Ge.nodeType===Node.ELEMENT_NODE}isShadowRoot(Ge){return Ge instanceof DocumentFragment}getGlobalEventTarget(Ge,ye){return"window"===ye?window:"document"===ye?Ge:"body"===ye?Ge.body:null}getBaseHref(Ge){const ye=function de(){return ct=ct||document.querySelector("base"),ct?ct.getAttribute("href"):null}();return null==ye?null:function qt(qe){Et=Et||document.createElement("a"),Et.setAttribute("href",qe);const Ge=Et.pathname;return"/"===Ge.charAt(0)?Ge:`/${Ge}`}(ye)}resetBaseElement(){ct=null}getUserAgent(){return window.navigator.userAgent}getCookie(Ge){return(0,C.Mx)(document.cookie,Ge)}}let Et,ct=null;const gt=new De.OlP("TRANSITION_ID"),wt=[{provide:De.ip1,useFactory:function jt(qe,Ge,ye){return()=>{ye.get(De.CZH).donePromise.then(()=>{const ke=(0,C.q)(),J=Ge.querySelectorAll(`style[ng-transition="${qe}"]`);for(let _e=0;_e<J.length;_e++)ke.remove(J[_e])})}},deps:[gt,C.K0,De.zs3],multi:!0}];let Kn=(()=>{class qe{build(){return new XMLHttpRequest}}return qe.\u0275fac=function(ye){return new(ye||qe)},qe.\u0275prov=De.Yz7({token:qe,factory:qe.\u0275fac}),qe})();const Sn=new De.OlP("EventManagerPlugins");let En=(()=>{class qe{constructor(ye,ke){this._zone=ke,this._eventNameToPlugin=new Map,ye.forEach(J=>{J.manager=this}),this._plugins=ye.slice().reverse()}addEventListener(ye,ke,J){return this._findPluginFor(ke).addEventListener(ye,ke,J)}addGlobalEventListener(ye,ke,J){return this._findPluginFor(ke).addGlobalEventListener(ye,ke,J)}getZone(){return this._zone}_findPluginFor(ye){const ke=this._eventNameToPlugin.get(ye);if(ke)return ke;const J=this._plugins;for(let _e=0;_e<J.length;_e++){const Se=J[_e];if(Se.supports(ye))return this._eventNameToPlugin.set(ye,Se),Se}throw new Error(`No event manager plugin found for event ${ye}`)}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG(Sn),De.LFG(De.R0b))},qe.\u0275prov=De.Yz7({token:qe,factory:qe.\u0275fac}),qe})();class dn{constructor(Ge){this._doc=Ge}addGlobalEventListener(Ge,ye,ke){const J=(0,C.q)().getGlobalEventTarget(this._doc,Ge);if(!J)throw new Error(`Unsupported event target ${J} for event ${ye}`);return this.addEventListener(J,ye,ke)}}let ii=(()=>{class qe{constructor(){this.usageCount=new Map}addStyles(ye){for(const ke of ye)1===this.changeUsageCount(ke,1)&&this.onStyleAdded(ke)}removeStyles(ye){for(const ke of ye)0===this.changeUsageCount(ke,-1)&&this.onStyleRemoved(ke)}onStyleRemoved(ye){}onStyleAdded(ye){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(ye,ke){const J=this.usageCount;let _e=J.get(ye)??0;return _e+=ke,_e>0?J.set(ye,_e):J.delete(ye),_e}ngOnDestroy(){for(const ye of this.getAllStyles())this.onStyleRemoved(ye);this.usageCount.clear()}}return qe.\u0275fac=function(ye){return new(ye||qe)},qe.\u0275prov=De.Yz7({token:qe,factory:qe.\u0275fac}),qe})(),hn=(()=>{class qe extends ii{constructor(ye){super(),this.doc=ye,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(ye){for(const ke of this.hostNodes)this.addStyleToHost(ke,ye)}onStyleRemoved(ye){const ke=this.styleRef;ke.get(ye)?.forEach(_e=>_e.remove()),ke.delete(ye)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(ye){this.hostNodes.add(ye);for(const ke of this.getAllStyles())this.addStyleToHost(ye,ke)}removeHost(ye){this.hostNodes.delete(ye)}addStyleToHost(ye,ke){const J=this.doc.createElement("style");J.textContent=ke,ye.appendChild(J);const _e=this.styleRef.get(ke);_e?_e.push(J):this.styleRef.set(ke,[J])}resetHostNodes(){const ye=this.hostNodes;ye.clear(),ye.add(this.doc.head)}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG(C.K0))},qe.\u0275prov=De.Yz7({token:qe,factory:qe.\u0275fac}),qe})();const Vn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},hi=/%COMP%/g,je=new De.OlP("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function pt(qe,Ge){return Ge.flat(100).map(ye=>ye.replace(hi,qe))}function Ot(qe){return Ge=>{if("__ngUnwrap__"===Ge)return qe;!1===qe(Ge)&&(Ge.preventDefault(),Ge.returnValue=!1)}}let Xt=(()=>{class qe{constructor(ye,ke,J,_e){this.eventManager=ye,this.sharedStylesHost=ke,this.appId=J,this.removeStylesOnCompDestory=_e,this.rendererByCompId=new Map,this.defaultRenderer=new Mi(ye)}createRenderer(ye,ke){if(!ye||!ke)return this.defaultRenderer;const J=this.getOrCreateRenderer(ye,ke);return J instanceof ht?J.applyToHost(ye):J instanceof xt&&J.applyStyles(),J}getOrCreateRenderer(ye,ke){const J=this.rendererByCompId;let _e=J.get(ke.id);if(!_e){const Se=this.eventManager,at=this.sharedStylesHost,St=this.removeStylesOnCompDestory;switch(ke.encapsulation){case De.ifc.Emulated:_e=new ht(Se,at,ke,this.appId,St);break;case De.ifc.ShadowDom:return new rt(Se,at,ye,ke);default:_e=new xt(Se,at,ke,St)}_e.onDestroy=()=>J.delete(ke.id),J.set(ke.id,_e)}return _e}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG(En),De.LFG(hn),De.LFG(De.AFp),De.LFG(je))},qe.\u0275prov=De.Yz7({token:qe,factory:qe.\u0275fac}),qe})();class Mi{constructor(Ge){this.eventManager=Ge,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(Ge,ye){return ye?document.createElementNS(Vn[ye]||ye,Ge):document.createElement(Ge)}createComment(Ge){return document.createComment(Ge)}createText(Ge){return document.createTextNode(Ge)}appendChild(Ge,ye){(Tn(Ge)?Ge.content:Ge).appendChild(ye)}insertBefore(Ge,ye,ke){Ge&&(Tn(Ge)?Ge.content:Ge).insertBefore(ye,ke)}removeChild(Ge,ye){Ge&&Ge.removeChild(ye)}selectRootElement(Ge,ye){let ke="string"==typeof Ge?document.querySelector(Ge):Ge;if(!ke)throw new Error(`The selector "${Ge}" did not match any elements`);return ye||(ke.textContent=""),ke}parentNode(Ge){return Ge.parentNode}nextSibling(Ge){return Ge.nextSibling}setAttribute(Ge,ye,ke,J){if(J){ye=J+":"+ye;const _e=Vn[J];_e?Ge.setAttributeNS(_e,ye,ke):Ge.setAttribute(ye,ke)}else Ge.setAttribute(ye,ke)}removeAttribute(Ge,ye,ke){if(ke){const J=Vn[ke];J?Ge.removeAttributeNS(J,ye):Ge.removeAttribute(`${ke}:${ye}`)}else Ge.removeAttribute(ye)}addClass(Ge,ye){Ge.classList.add(ye)}removeClass(Ge,ye){Ge.classList.remove(ye)}setStyle(Ge,ye,ke,J){J&(De.JOm.DashCase|De.JOm.Important)?Ge.style.setProperty(ye,ke,J&De.JOm.Important?"important":""):Ge.style[ye]=ke}removeStyle(Ge,ye,ke){ke&De.JOm.DashCase?Ge.style.removeProperty(ye):Ge.style[ye]=""}setProperty(Ge,ye,ke){Ge[ye]=ke}setValue(Ge,ye){Ge.nodeValue=ye}listen(Ge,ye,ke){return"string"==typeof Ge?this.eventManager.addGlobalEventListener(Ge,ye,Ot(ke)):this.eventManager.addEventListener(Ge,ye,Ot(ke))}}function Tn(qe){return"TEMPLATE"===qe.tagName&&void 0!==qe.content}class rt extends Mi{constructor(Ge,ye,ke,J){super(Ge),this.sharedStylesHost=ye,this.hostEl=ke,this.shadowRoot=ke.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const _e=pt(J.id,J.styles);for(const Se of _e){const at=document.createElement("style");at.textContent=Se,this.shadowRoot.appendChild(at)}}nodeOrShadowRoot(Ge){return Ge===this.hostEl?this.shadowRoot:Ge}appendChild(Ge,ye){return super.appendChild(this.nodeOrShadowRoot(Ge),ye)}insertBefore(Ge,ye,ke){return super.insertBefore(this.nodeOrShadowRoot(Ge),ye,ke)}removeChild(Ge,ye){return super.removeChild(this.nodeOrShadowRoot(Ge),ye)}parentNode(Ge){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Ge)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class xt extends Mi{constructor(Ge,ye,ke,J,_e=ke.id){super(Ge),this.sharedStylesHost=ye,this.removeStylesOnCompDestory=J,this.rendererUsageCount=0,this.styles=pt(_e,ke.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class ht extends xt{constructor(Ge,ye,ke,J,_e){const Se=J+"-"+ke.id;super(Ge,ye,ke,_e,Se),this.contentAttr=function Ze(qe){return"_ngcontent-%COMP%".replace(hi,qe)}(Se),this.hostAttr=function ot(qe){return"_nghost-%COMP%".replace(hi,qe)}(Se)}applyToHost(Ge){this.applyStyles(),this.setAttribute(Ge,this.hostAttr,"")}createElement(Ge,ye){const ke=super.createElement(Ge,ye);return super.setAttribute(ke,this.contentAttr,""),ke}}let st=(()=>{class qe extends dn{constructor(ye){super(ye)}supports(ye){return!0}addEventListener(ye,ke,J){return ye.addEventListener(ke,J,!1),()=>this.removeEventListener(ye,ke,J)}removeEventListener(ye,ke,J){return ye.removeEventListener(ke,J)}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG(C.K0))},qe.\u0275prov=De.Yz7({token:qe,factory:qe.\u0275fac}),qe})();const Ne=["alt","control","meta","shift"],Pe={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ke={alt:qe=>qe.altKey,control:qe=>qe.ctrlKey,meta:qe=>qe.metaKey,shift:qe=>qe.shiftKey};let Bt=(()=>{class qe extends dn{constructor(ye){super(ye)}supports(ye){return null!=qe.parseEventName(ye)}addEventListener(ye,ke,J){const _e=qe.parseEventName(ke),Se=qe.eventCallback(_e.fullKey,J,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,C.q)().onAndCancel(ye,_e.domEventName,Se))}static parseEventName(ye){const ke=ye.toLowerCase().split("."),J=ke.shift();if(0===ke.length||"keydown"!==J&&"keyup"!==J)return null;const _e=qe._normalizeKey(ke.pop());let Se="",at=ke.indexOf("code");if(at>-1&&(ke.splice(at,1),Se="code."),Ne.forEach(nn=>{const bn=ke.indexOf(nn);bn>-1&&(ke.splice(bn,1),Se+=nn+".")}),Se+=_e,0!=ke.length||0===_e.length)return null;const St={};return St.domEventName=J,St.fullKey=Se,St}static matchEventFullKeyCode(ye,ke){let J=Pe[ye.key]||ye.key,_e="";return ke.indexOf("code.")>-1&&(J=ye.code,_e="code."),!(null==J||!J)&&(J=J.toLowerCase()," "===J?J="space":"."===J&&(J="dot"),Ne.forEach(Se=>{Se!==J&&(0,Ke[Se])(ye)&&(_e+=Se+".")}),_e+=J,_e===ke)}static eventCallback(ye,ke,J){return _e=>{qe.matchEventFullKeyCode(_e,ye)&&J.runGuarded(()=>ke(_e))}}static _normalizeKey(ye){return"esc"===ye?"escape":ye}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG(C.K0))},qe.\u0275prov=De.Yz7({token:qe,factory:qe.\u0275fac}),qe})();const Rs=(0,De.eFA)(De._c5,"browser",[{provide:De.Lbi,useValue:C.bD},{provide:De.g9A,useValue:function Hr(){s.makeCurrent()},multi:!0},{provide:C.K0,useFactory:function Si(){return(0,De.RDi)(document),document},deps:[]}]),$r=new De.OlP(""),Ji=[{provide:De.rWj,useClass:class Gt{addToWindow(Ge){De.dqk.getAngularTestability=(ke,J=!0)=>{const _e=Ge.findTestabilityInTree(ke,J);if(null==_e)throw new Error("Could not find testability for element.");return _e},De.dqk.getAllAngularTestabilities=()=>Ge.getAllTestabilities(),De.dqk.getAllAngularRootElements=()=>Ge.getAllRootElements(),De.dqk.frameworkStabilizers||(De.dqk.frameworkStabilizers=[]),De.dqk.frameworkStabilizers.push(ke=>{const J=De.dqk.getAllAngularTestabilities();let _e=J.length,Se=!1;const at=function(St){Se=Se||St,_e--,0==_e&&ke(Se)};J.forEach(function(St){St.whenStable(at)})})}findTestabilityInTree(Ge,ye,ke){return null==ye?null:Ge.getTestability(ye)??(ke?(0,C.q)().isShadowRoot(ye)?this.findTestabilityInTree(Ge,ye.host,!0):this.findTestabilityInTree(Ge,ye.parentElement,!0):null)}},deps:[]},{provide:De.lri,useClass:De.dDg,deps:[De.R0b,De.eoX,De.rWj]},{provide:De.dDg,useClass:De.dDg,deps:[De.R0b,De.eoX,De.rWj]}],ir=[{provide:De.zSh,useValue:"root"},{provide:De.qLn,useFactory:function Ur(){return new De.qLn},deps:[]},{provide:Sn,useClass:st,multi:!0,deps:[C.K0,De.R0b,De.Lbi]},{provide:Sn,useClass:Bt,multi:!0,deps:[C.K0]},{provide:Xt,useClass:Xt,deps:[En,hn,De.AFp,je]},{provide:De.FYo,useExisting:Xt},{provide:ii,useExisting:hn},{provide:hn,useClass:hn,deps:[C.K0]},{provide:En,useClass:En,deps:[Sn,De.R0b]},{provide:C.JF,useClass:Kn,deps:[]},[]];let jr=(()=>{class qe{constructor(ye){}static withServerTransition(ye){return{ngModule:qe,providers:[{provide:De.AFp,useValue:ye.appId},{provide:gt,useExisting:De.AFp},wt]}}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG($r,12))},qe.\u0275mod=De.oAB({type:qe}),qe.\u0275inj=De.cJS({providers:[...ir,...Ji],imports:[C.ez,De.hGG]}),qe})(),zt=(()=>{class qe{constructor(ye){this._doc=ye}getTitle(){return this._doc.title}setTitle(ye){this._doc.title=ye||""}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG(C.K0))},qe.\u0275prov=De.Yz7({token:qe,factory:function(ye){let ke=null;return ke=ye?new ye:function it(){return new zt((0,De.LFG)(C.K0))}(),ke},providedIn:"root"}),qe})();typeof window<"u"&&window;let kt=(()=>{class qe{}return qe.\u0275fac=function(ye){return new(ye||qe)},qe.\u0275prov=De.Yz7({token:qe,factory:function(ye){let ke=null;return ke=ye?new(ye||qe):De.LFG(an),ke},providedIn:"root"}),qe})(),an=(()=>{class qe extends kt{constructor(ye){super(),this._doc=ye}sanitize(ye,ke){if(null==ke)return null;switch(ye){case De.q3G.NONE:return ke;case De.q3G.HTML:return(0,De.qzn)(ke,"HTML")?(0,De.z3N)(ke):(0,De.EiD)(this._doc,String(ke)).toString();case De.q3G.STYLE:return(0,De.qzn)(ke,"Style")?(0,De.z3N)(ke):ke;case De.q3G.SCRIPT:if((0,De.qzn)(ke,"Script"))return(0,De.z3N)(ke);throw new Error("unsafe value used in a script context");case De.q3G.URL:return(0,De.qzn)(ke,"URL")?(0,De.z3N)(ke):(0,De.mCW)(String(ke));case De.q3G.RESOURCE_URL:if((0,De.qzn)(ke,"ResourceURL"))return(0,De.z3N)(ke);throw new Error(`unsafe value used in a resource URL context (see ${De.JZr})`);default:throw new Error(`Unexpected SecurityContext ${ye} (see ${De.JZr})`)}}bypassSecurityTrustHtml(ye){return(0,De.JVY)(ye)}bypassSecurityTrustStyle(ye){return(0,De.L6k)(ye)}bypassSecurityTrustScript(ye){return(0,De.eBb)(ye)}bypassSecurityTrustUrl(ye){return(0,De.LAX)(ye)}bypassSecurityTrustResourceUrl(ye){return(0,De.pB0)(ye)}}return qe.\u0275fac=function(ye){return new(ye||qe)(De.LFG(C.K0))},qe.\u0275prov=De.Yz7({token:qe,factory:function(ye){let ke=null;return ke=ye?new ye:function Ht(qe){return new an(qe.get(C.K0))}(De.LFG(De.zs3)),ke},providedIn:"root"}),qe})()},9838:(yi,on,ue)=>{"use strict";ue.d(on,{gz:()=>yo,c9:()=>fo,F0:()=>Ca,rH:()=>s2,Od:()=>b2,Bz:()=>o2,lC:()=>xo});var C=ue(1571),De=ue(2076),Xe=ue(9646),s=ue(1135),ct=ue(6805),de=ue(9751),Et=ue(4742),qt=ue(4671),gt=ue(3268),jt=ue(3269),wt=ue(1810),Gt=ue(5403),Kn=ue(9672);function Sn(...k){const F=(0,jt.yG)(k),V=(0,jt.jO)(k),{args:$,keys:oe}=(0,Et.D)(k);if(0===$.length)return(0,De.D)([],F);const xe=new de.y(function En(k,F,V=qt.y){return $=>{dn(F,()=>{const{length:oe}=k,xe=new Array(oe);let Oe=oe,Ut=oe;for(let zn=0;zn<oe;zn++)dn(F,()=>{const Li=(0,De.D)(k[zn],F);let _i=!1;Li.subscribe((0,Gt.x)($,or=>{xe[zn]=or,_i||(_i=!0,Ut--),Ut||$.next(V(xe.slice()))},()=>{--Oe||$.complete()}))},$)},$)}}($,F,oe?Oe=>(0,wt.n)(oe,Oe):qt.y));return V?xe.pipe((0,gt.Z)(V)):xe}function dn(k,F,V){k?(0,Kn.f)(V,k,F):F()}var ii=ue(7272),hn=ue(8421);function Vn(k){return new de.y(F=>{(0,hn.Xf)(k()).subscribe(F)})}var hi=ue(9635),Te=ue(2843),_t=ue(515),Ue=ue(727),Ye=ue(4482);function Pt(){return(0,Ye.e)((k,F)=>{let V=null;k._refCount++;const $=(0,Gt.x)(F,void 0,void 0,void 0,()=>{if(!k||k._refCount<=0||0<--k._refCount)return void(V=null);const oe=k._connection,xe=V;V=null,oe&&(!xe||oe===xe)&&oe.unsubscribe(),F.unsubscribe()});k.subscribe($),$.closed||(V=k.connect())})}class je extends de.y{constructor(F,V){super(),this.source=F,this.subjectFactory=V,this._subject=null,this._refCount=0,this._connection=null,(0,Ye.A)(F)&&(this.lift=F.lift)}_subscribe(F){return this.getSubject().subscribe(F)}getSubject(){const F=this._subject;return(!F||F.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:F}=this;this._subject=this._connection=null,F?.unsubscribe()}connect(){let F=this._connection;if(!F){F=this._connection=new Ue.w0;const V=this.getSubject();F.add(this.source.subscribe((0,Gt.x)(V,void 0,()=>{this._teardown(),V.complete()},$=>{this._teardown(),V.error($)},()=>this._teardown()))),F.closed&&(this._connection=null,F=Ue.w0.EMPTY)}return F}refCount(){return Pt()(this)}}var Ze=ue(7579),ot=ue(6895),pt=ue(4004),Ot=ue(3900),Xt=ue(5698),Mi=ue(8675),Wi=ue(9300),ti=ue(5577);function Tn(k){return(0,Ye.e)((F,V)=>{let $=!1;F.subscribe((0,Gt.x)(V,oe=>{$=!0,V.next(oe)},()=>{$||V.next(k),V.complete()}))})}function rt(k=xt){return(0,Ye.e)((F,V)=>{let $=!1;F.subscribe((0,Gt.x)(V,oe=>{$=!0,V.next(oe)},()=>$?V.complete():V.error(k())))})}function xt(){return new ct.K}function ht(k,F){const V=arguments.length>=2;return $=>$.pipe(k?(0,Wi.h)((oe,xe)=>k(oe,xe,$)):qt.y,(0,Xt.q)(1),V?Tn(F):rt(()=>new ct.K))}var st=ue(4351),Ne=ue(8505),Pe=ue(262);function Bt(k,F){return(0,Ye.e)(function Ke(k,F,V,$,oe){return(xe,Oe)=>{let Ut=V,zn=F,Li=0;xe.subscribe((0,Gt.x)(Oe,_i=>{const or=Li++;zn=Ut?k(zn,_i,or):(Ut=!0,_i),$&&Oe.next(zn)},oe&&(()=>{Ut&&Oe.next(zn),Oe.complete()})))}}(k,F,arguments.length>=2,!0))}function mi(k){return k<=0?()=>_t.E:(0,Ye.e)((F,V)=>{let $=[];F.subscribe((0,Gt.x)(V,oe=>{$.push(oe),k<$.length&&$.shift()},()=>{for(const oe of $)V.next(oe);V.complete()},void 0,()=>{$=null}))})}function Di(k,F){const V=arguments.length>=2;return $=>$.pipe(k?(0,Wi.h)((oe,xe)=>k(oe,xe,$)):qt.y,mi(1),V?Tn(F):rt(()=>new ct.K))}var Gi=ue(9718),Br=ue(8746),Hr=ue(8189),Ur=ue(1481);const Si="primary",Xi=Symbol("RouteTitle");class Rs{constructor(F){this.params=F||{}}has(F){return Object.prototype.hasOwnProperty.call(this.params,F)}get(F){if(this.has(F)){const V=this.params[F];return Array.isArray(V)?V[0]:V}return null}getAll(F){if(this.has(F)){const V=this.params[F];return Array.isArray(V)?V:[V]}return[]}get keys(){return Object.keys(this.params)}}function $r(k){return new Rs(k)}function Ji(k,F,V){const $=V.path.split("/");if($.length>k.length||"full"===V.pathMatch&&(F.hasChildren()||$.length<k.length))return null;const oe={};for(let xe=0;xe<$.length;xe++){const Oe=$[xe],Ut=k[xe];if(Oe.startsWith(":"))oe[Oe.substring(1)]=Ut;else if(Oe!==Ut.path)return null}return{consumed:k.slice(0,$.length),posParams:oe}}function jr(k,F){const V=k?Object.keys(k):void 0,$=F?Object.keys(F):void 0;if(!V||!$||V.length!=$.length)return!1;let oe;for(let xe=0;xe<V.length;xe++)if(oe=V[xe],!sn(k[oe],F[oe]))return!1;return!0}function sn(k,F){if(Array.isArray(k)&&Array.isArray(F)){if(k.length!==F.length)return!1;const V=[...k].sort(),$=[...F].sort();return V.every((oe,xe)=>$[xe]===oe)}return k===F}function me(k){return Array.prototype.concat.apply([],k)}function He(k){return k.length>0?k[k.length-1]:null}function zt(k,F){for(const V in k)k.hasOwnProperty(V)&&F(k[V],V)}function At(k){return(0,C.CqO)(k)?k:(0,C.QGY)(k)?(0,De.D)(Promise.resolve(k)):(0,Xe.of)(k)}const It=!1,Hn={exact:function Zn(k,F,V){if(!cn(k.segments,F.segments)||!Ti(k.segments,F.segments,V)||k.numberOfChildren!==F.numberOfChildren)return!1;for(const $ in F.children)if(!k.children[$]||!Zn(k.children[$],F.children[$],V))return!1;return!0},subset:Hi},Qt={exact:function Wn(k,F){return jr(k,F)},subset:function Fi(k,F){return Object.keys(F).length<=Object.keys(k).length&&Object.keys(F).every(V=>sn(k[V],F[V]))},ignored:()=>!0};function $n(k,F,V){return Hn[V.paths](k.root,F.root,V.matrixParams)&&Qt[V.queryParams](k.queryParams,F.queryParams)&&!("exact"===V.fragment&&k.fragment!==F.fragment)}function Hi(k,F,V){return Xr(k,F,F.segments,V)}function Xr(k,F,V,$){if(k.segments.length>V.length){const oe=k.segments.slice(0,V.length);return!(!cn(oe,V)||F.hasChildren()||!Ti(oe,V,$))}if(k.segments.length===V.length){if(!cn(k.segments,V)||!Ti(k.segments,V,$))return!1;for(const oe in F.children)if(!k.children[oe]||!Hi(k.children[oe],F.children[oe],$))return!1;return!0}{const oe=V.slice(0,k.segments.length),xe=V.slice(k.segments.length);return!!(cn(k.segments,oe)&&Ti(k.segments,oe,$)&&k.children[Si])&&Xr(k.children[Si],F,xe,$)}}function Ti(k,F,V){return F.every(($,oe)=>Qt[V](k[oe].parameters,$.parameters))}class hr{constructor(F=new ri([],{}),V={},$=null){this.root=F,this.queryParams=V,this.fragment=$}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$r(this.queryParams)),this._queryParamMap}toString(){return vn.serialize(this)}}class ri{constructor(F,V){this.segments=F,this.children=V,this.parent=null,zt(V,($,oe)=>$.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ei(this)}}class Qi{constructor(F,V){this.path=F,this.parameters=V}get parameterMap(){return this._parameterMap||(this._parameterMap=$r(this.parameters)),this._parameterMap}toString(){return ye(this)}}function cn(k,F){return k.length===F.length&&k.every((V,$)=>V.path===F[$].path)}let Tt=(()=>{class k{}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:function(){return new In},providedIn:"root"}),k})();class In{parse(F){const V=new Dn(F);return new hr(V.parseRootSegment(),V.parseQueryParams(),V.parseFragment())}serialize(F){const V=`/${Oi(F.root,!0)}`,$=function J(k){const F=Object.keys(k).map(V=>{const $=k[V];return Array.isArray($)?$.map(oe=>`${Ht(V)}=${Ht(oe)}`).join("&"):`${Ht(V)}=${Ht($)}`}).filter(V=>!!V);return F.length?`?${F.join("&")}`:""}(F.queryParams);return`${V}${$}${"string"==typeof F.fragment?`#${function an(k){return encodeURI(k)}(F.fragment)}`:""}`}}const vn=new In;function ei(k){return k.segments.map(F=>ye(F)).join("/")}function Oi(k,F){if(!k.hasChildren())return ei(k);if(F){const V=k.children[Si]?Oi(k.children[Si],!1):"",$=[];return zt(k.children,(oe,xe)=>{xe!==Si&&$.push(`${xe}:${Oi(oe,!1)}`)}),$.length>0?`${V}(${$.join("//")})`:V}{const V=function Be(k,F){let V=[];return zt(k.children,($,oe)=>{oe===Si&&(V=V.concat(F($,oe)))}),zt(k.children,($,oe)=>{oe!==Si&&(V=V.concat(F($,oe)))}),V}(k,($,oe)=>oe===Si?[Oi(k.children[Si],!1)]:[`${oe}:${Oi($,!1)}`]);return 1===Object.keys(k.children).length&&null!=k.children[Si]?`${ei(k)}/${V[0]}`:`${ei(k)}/(${V.join("//")})`}}function kt(k){return encodeURIComponent(k).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ht(k){return kt(k).replace(/%3B/gi,";")}function _n(k){return kt(k).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function qe(k){return decodeURIComponent(k)}function Ge(k){return qe(k.replace(/\+/g,"%20"))}function ye(k){return`${_n(k.path)}${function ke(k){return Object.keys(k).map(F=>`;${_n(F)}=${_n(k[F])}`).join("")}(k.parameters)}`}const _e=/^[^\/()?;=#]+/;function Se(k){const F=k.match(_e);return F?F[0]:""}const at=/^[^=?&#]+/,nn=/^[^&#]+/;class Dn{constructor(F){this.url=F,this.remaining=F}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ri([],{}):new ri([],this.parseChildren())}parseQueryParams(){const F={};if(this.consumeOptional("?"))do{this.parseQueryParam(F)}while(this.consumeOptional("&"));return F}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const F=[];for(this.peekStartsWith("(")||F.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),F.push(this.parseSegment());let V={};this.peekStartsWith("/(")&&(this.capture("/"),V=this.parseParens(!0));let $={};return this.peekStartsWith("(")&&($=this.parseParens(!1)),(F.length>0||Object.keys(V).length>0)&&($[Si]=new ri(F,V)),$}parseSegment(){const F=Se(this.remaining);if(""===F&&this.peekStartsWith(";"))throw new C.vHH(4009,It);return this.capture(F),new Qi(qe(F),this.parseMatrixParams())}parseMatrixParams(){const F={};for(;this.consumeOptional(";");)this.parseParam(F);return F}parseParam(F){const V=Se(this.remaining);if(!V)return;this.capture(V);let $="";if(this.consumeOptional("=")){const oe=Se(this.remaining);oe&&($=oe,this.capture($))}F[qe(V)]=qe($)}parseQueryParam(F){const V=function St(k){const F=k.match(at);return F?F[0]:""}(this.remaining);if(!V)return;this.capture(V);let $="";if(this.consumeOptional("=")){const Oe=function bn(k){const F=k.match(nn);return F?F[0]:""}(this.remaining);Oe&&($=Oe,this.capture($))}const oe=Ge(V),xe=Ge($);if(F.hasOwnProperty(oe)){let Oe=F[oe];Array.isArray(Oe)||(Oe=[Oe],F[oe]=Oe),Oe.push(xe)}else F[oe]=xe}parseParens(F){const V={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const $=Se(this.remaining),oe=this.remaining[$.length];if("/"!==oe&&")"!==oe&&";"!==oe)throw new C.vHH(4010,It);let xe;$.indexOf(":")>-1?(xe=$.slice(0,$.indexOf(":")),this.capture(xe),this.capture(":")):F&&(xe=Si);const Oe=this.parseChildren();V[xe]=1===Object.keys(Oe).length?Oe[Si]:new ri([],Oe),this.consumeOptional("//")}return V}peekStartsWith(F){return this.remaining.startsWith(F)}consumeOptional(F){return!!this.peekStartsWith(F)&&(this.remaining=this.remaining.substring(F.length),!0)}capture(F){if(!this.consumeOptional(F))throw new C.vHH(4011,It)}}function Nn(k){return k.segments.length>0?new ri([],{[Si]:k}):k}function Ei(k){const F={};for(const $ of Object.keys(k.children)){const xe=Ei(k.children[$]);(xe.segments.length>0||xe.hasChildren())&&(F[$]=xe)}return function si(k){if(1===k.numberOfChildren&&k.children[Si]){const F=k.children[Si];return new ri(k.segments.concat(F.segments),F.children)}return k}(new ri(k.segments,F))}function er(k){return k instanceof hr}const rs=!1;function zr(k,F,V,$,oe){if(0===V.length)return ro(F.root,F.root,F.root,$,oe);const xe=function Oa(k){if("string"==typeof k[0]&&1===k.length&&"/"===k[0])return new e1(!0,0,k);let F=0,V=!1;const $=k.reduce((oe,xe,Oe)=>{if("object"==typeof xe&&null!=xe){if(xe.outlets){const Ut={};return zt(xe.outlets,(zn,Li)=>{Ut[Li]="string"==typeof zn?zn.split("/"):zn}),[...oe,{outlets:Ut}]}if(xe.segmentPath)return[...oe,xe.segmentPath]}return"string"!=typeof xe?[...oe,xe]:0===Oe?(xe.split("/").forEach((Ut,zn)=>{0==zn&&"."===Ut||(0==zn&&""===Ut?V=!0:".."===Ut?F++:""!=Ut&&oe.push(Ut))}),oe):[...oe,xe]},[]);return new e1(V,F,$)}(V);return xe.toRoot()?ro(F.root,F.root,new ri([],{}),$,oe):function Oe(zn){const Li=function vi(k,F,V,$){if(k.isAbsolute)return new qo(F.root,!0,0);if(-1===$)return new qo(V,V===F.root,0);return function qi(k,F,V){let $=k,oe=F,xe=V;for(;xe>oe;){if(xe-=oe,$=$.parent,!$)throw new C.vHH(4005,rs&&"Invalid number of '../'");oe=$.segments.length}return new qo($,!1,oe-xe)}(V,$+(ls(k.commands[0])?0:1),k.numberOfDoubleDots)}(xe,F,k.snapshot?._urlSegment,zn),_i=Li.processChildren?Io(Li.segmentGroup,Li.index,xe.commands):Pi(Li.segmentGroup,Li.index,xe.commands);return ro(F.root,Li.segmentGroup,_i,$,oe)}(k.snapshot?._lastPathIndex)}function ls(k){return"object"==typeof k&&null!=k&&!k.outlets&&!k.segmentPath}function ds(k){return"object"==typeof k&&null!=k&&k.outlets}function ro(k,F,V,$,oe){let Oe,xe={};$&&zt($,(zn,Li)=>{xe[Li]=Array.isArray(zn)?zn.map(_i=>`${_i}`):`${zn}`}),Oe=k===F?V:Os(k,F,V);const Ut=Nn(Ei(Oe));return new hr(Ut,xe,oe)}function Os(k,F,V){const $={};return zt(k.children,(oe,xe)=>{$[xe]=oe===F?V:Os(oe,F,V)}),new ri(k.segments,$)}class e1{constructor(F,V,$){if(this.isAbsolute=F,this.numberOfDoubleDots=V,this.commands=$,F&&$.length>0&&ls($[0]))throw new C.vHH(4003,rs&&"Root segment cannot have matrix parameters");const oe=$.find(ds);if(oe&&oe!==He($))throw new C.vHH(4004,rs&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class qo{constructor(F,V,$){this.segmentGroup=F,this.processChildren=V,this.index=$}}function Pi(k,F,V){if(k||(k=new ri([],{})),0===k.segments.length&&k.hasChildren())return Io(k,F,V);const $=function js(k,F,V){let $=0,oe=F;const xe={match:!1,pathIndex:0,commandIndex:0};for(;oe<k.segments.length;){if($>=V.length)return xe;const Oe=k.segments[oe],Ut=V[$];if(ds(Ut))break;const zn=`${Ut}`,Li=$<V.length-1?V[$+1]:null;if(oe>0&&void 0===zn)break;if(zn&&Li&&"object"==typeof Li&&void 0===Li.outlets){if(!Vo(zn,Li,Oe))return xe;$+=2}else{if(!Vo(zn,{},Oe))return xe;$++}oe++}return{match:!0,pathIndex:oe,commandIndex:$}}(k,F,V),oe=V.slice($.commandIndex);if($.match&&$.pathIndex<k.segments.length){const xe=new ri(k.segments.slice(0,$.pathIndex),{});return xe.children[Si]=new ri(k.segments.slice($.pathIndex),k.children),Io(xe,0,oe)}return $.match&&0===oe.length?new ri(k.segments,{}):$.match&&!k.hasChildren()?sa(k,F,V):$.match?Io(k,0,oe):sa(k,F,V)}function Io(k,F,V){if(0===V.length)return new ri(k.segments,{});{const $=function Sr(k){return ds(k[0])?k[0].outlets:{[Si]:k}}(V),oe={};if(!$[Si]&&k.children[Si]&&1===k.numberOfChildren&&0===k.children[Si].segments.length){const xe=Io(k.children[Si],F,V);return new ri(k.segments,xe.children)}return zt($,(xe,Oe)=>{"string"==typeof xe&&(xe=[xe]),null!==xe&&(oe[Oe]=Pi(k.children[Oe],F,xe))}),zt(k.children,(xe,Oe)=>{void 0===$[Oe]&&(oe[Oe]=xe)}),new ri(k.segments,oe)}}function sa(k,F,V){const $=k.segments.slice(0,F);let oe=0;for(;oe<V.length;){const xe=V[oe];if(ds(xe)){const zn=ps(xe.outlets);return new ri($,zn)}if(0===oe&&ls(V[0])){$.push(new Qi(k.segments[F].path,Fs(V[0]))),oe++;continue}const Oe=ds(xe)?xe.outlets[Si]:`${xe}`,Ut=oe<V.length-1?V[oe+1]:null;Oe&&Ut&&ls(Ut)?($.push(new Qi(Oe,Fs(Ut))),oe+=2):($.push(new Qi(Oe,{})),oe++)}return new ri($,{})}function ps(k){const F={};return zt(k,(V,$)=>{"string"==typeof V&&(V=[V]),null!==V&&(F[$]=sa(new ri([],{}),0,V))}),F}function Fs(k){const F={};return zt(k,(V,$)=>F[$]=`${V}`),F}function Vo(k,F,V){return k==V.path&&jr(F,V.parameters)}const br="imperative";class ws{constructor(F,V){this.id=F,this.url=V}}class qn extends ws{constructor(F,V,$="imperative",oe=null){super(F,V),this.type=0,this.navigationTrigger=$,this.restoredState=oe}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Yi extends ws{constructor(F,V,$){super(F,V),this.urlAfterRedirects=$,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class tr extends ws{constructor(F,V,$,oe){super(F,V),this.reason=$,this.code=oe,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class es extends ws{constructor(F,V,$,oe){super(F,V),this.reason=$,this.code=oe,this.type=16}}class ho extends ws{constructor(F,V,$,oe){super(F,V),this.error=$,this.target=oe,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class rr extends ws{constructor(F,V,$,oe){super(F,V),this.urlAfterRedirects=$,this.state=oe,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Cs extends ws{constructor(F,V,$,oe){super(F,V),this.urlAfterRedirects=$,this.state=oe,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fo extends ws{constructor(F,V,$,oe,xe){super(F,V),this.urlAfterRedirects=$,this.state=oe,this.shouldActivate=xe,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class _a extends ws{constructor(F,V,$,oe){super(F,V),this.urlAfterRedirects=$,this.state=oe,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _r extends ws{constructor(F,V,$,oe){super(F,V),this.urlAfterRedirects=$,this.state=oe,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vs{constructor(F){this.route=F,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ci{constructor(F){this.route=F,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class eo{constructor(F){this.snapshot=F,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ci{constructor(F){this.snapshot=F,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class As{constructor(F){this.snapshot=F,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bi{constructor(F){this.snapshot=F,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Vs{constructor(F,V,$){this.routerEvent=F,this.position=V,this.anchor=$,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let Ls=(()=>{class k{createUrlTree(V,$,oe,xe,Oe,Ut){return zr(V||$.root,oe,xe,Oe,Ut)}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac}),k})(),as=(()=>{class k{}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:function(F){return Ls.\u0275fac(F)},providedIn:"root"}),k})();class to{constructor(F){this._root=F}get root(){return this._root.value}parent(F){const V=this.pathFromRoot(F);return V.length>1?V[V.length-2]:null}children(F){const V=$s(F,this._root);return V?V.children.map($=>$.value):[]}firstChild(F){const V=$s(F,this._root);return V&&V.children.length>0?V.children[0].value:null}siblings(F){const V=Oo(F,this._root);return V.length<2?[]:V[V.length-2].children.map(oe=>oe.value).filter(oe=>oe!==F)}pathFromRoot(F){return Oo(F,this._root).map(V=>V.value)}}function $s(k,F){if(k===F.value)return F;for(const V of F.children){const $=$s(k,V);if($)return $}return null}function Oo(k,F){if(k===F.value)return[F];for(const V of F.children){const $=Oo(k,V);if($.length)return $.unshift(F),$}return[]}class Nr{constructor(F,V){this.value=F,this.children=V}toString(){return`TreeNode(${this.value})`}}function Ms(k){const F={};return k&&k.children.forEach(V=>F[V.value.outlet]=V),F}class Fa extends to{constructor(F,V){super(F),this.snapshot=V,Xo(this,F)}toString(){return this.snapshot.toString()}}function oo(k,F){const V=function _1(k,F){const Oe=new t1([],{},{},"",{},Si,F,null,k.root,-1,{});return new Fo("",new Nr(Oe,[]))}(k,F),$=new s.X([new Qi("",{})]),oe=new s.X({}),xe=new s.X({}),Oe=new s.X({}),Ut=new s.X(""),zn=new yo($,oe,Oe,Ut,xe,Si,F,V.root);return zn.snapshot=V.root,new Fa(new Nr(zn,[]),V)}class yo{constructor(F,V,$,oe,xe,Oe,Ut,zn){this.url=F,this.params=V,this.queryParams=$,this.fragment=oe,this.data=xe,this.outlet=Oe,this.component=Ut,this.title=this.data?.pipe((0,pt.U)(Li=>Li[Xi]))??(0,Xe.of)(void 0),this._futureSnapshot=zn}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,pt.U)(F=>$r(F)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,pt.U)(F=>$r(F)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function oa(k,F="emptyOnly"){const V=k.pathFromRoot;let $=0;if("always"!==F)for($=V.length-1;$>=1;){const oe=V[$],xe=V[$-1];if(oe.routeConfig&&""===oe.routeConfig.path)$--;else{if(xe.component)break;$--}}return function za(k){return k.reduce((F,V)=>({params:{...F.params,...V.params},data:{...F.data,...V.data},resolve:{...V.data,...F.resolve,...V.routeConfig?.data,...V._resolvedData}}),{params:{},data:{},resolve:{}})}(V.slice($))}class t1{get title(){return this.data?.[Xi]}constructor(F,V,$,oe,xe,Oe,Ut,zn,Li,_i,or){this.url=F,this.params=V,this.queryParams=$,this.fragment=oe,this.data=xe,this.outlet=Oe,this.component=Ut,this.routeConfig=zn,this._urlSegment=Li,this._lastPathIndex=_i,this._resolve=or}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=$r(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$r(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map($=>$.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Fo extends to{constructor(F,V){super(V),this.url=F,Xo(this,V)}toString(){return U1(this._root)}}function Xo(k,F){F.value._routerState=k,F.children.forEach(V=>Xo(k,V))}function U1(k){const F=k.children.length>0?` { ${k.children.map(U1).join(", ")} } `:"";return`${k.value}${F}`}function Jo(k){if(k.snapshot){const F=k.snapshot,V=k._futureSnapshot;k.snapshot=V,jr(F.queryParams,V.queryParams)||k.queryParams.next(V.queryParams),F.fragment!==V.fragment&&k.fragment.next(V.fragment),jr(F.params,V.params)||k.params.next(V.params),function ir(k,F){if(k.length!==F.length)return!1;for(let V=0;V<k.length;++V)if(!jr(k[V],F[V]))return!1;return!0}(F.url,V.url)||k.url.next(V.url),jr(F.data,V.data)||k.data.next(V.data)}else k.snapshot=k._futureSnapshot,k.data.next(k._futureSnapshot.data)}function va(k,F){const V=jr(k.params,F.params)&&function Ir(k,F){return cn(k,F)&&k.every((V,$)=>jr(V.parameters,F[$].parameters))}(k.url,F.url);return V&&!(!k.parent!=!F.parent)&&(!k.parent||va(k.parent,F.parent))}function To(k,F,V){if(V&&k.shouldReuseRoute(F.value,V.value.snapshot)){const $=V.value;$._futureSnapshot=F.value;const oe=function Ba(k,F,V){return F.children.map($=>{for(const oe of V.children)if(k.shouldReuseRoute($.value,oe.value.snapshot))return To(k,$,oe);return To(k,$)})}(k,F,V);return new Nr($,oe)}{if(k.shouldAttach(F.value)){const xe=k.retrieve(F.value);if(null!==xe){const Oe=xe.route;return Oe.value._futureSnapshot=F.value,Oe.children=F.children.map(Ut=>To(k,Ut)),Oe}}const $=function D2(k){return new yo(new s.X(k.url),new s.X(k.params),new s.X(k.queryParams),new s.X(k.fragment),new s.X(k.data),k.outlet,k.component,k)}(F.value),oe=F.children.map(xe=>To(k,xe));return new Nr($,oe)}}const v1="ngNavigationCancelingError";function Qo(k,F){const{redirectTo:V,navigationBehaviorOptions:$}=er(F)?{redirectTo:F,navigationBehaviorOptions:void 0}:F,oe=ao(!1,0,F);return oe.url=V,oe.navigationBehaviorOptions=$,oe}function ao(k,F,V){const $=new Error("NavigationCancelingError: "+(k||""));return $[v1]=!0,$.cancellationCode=F,V&&($.url=V),$}function Ua(k){return Ho(k)&&er(k.url)}function Ho(k){return k&&k[v1]}class j1{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Po,this.attachRef=null}}let Po=(()=>{class k{constructor(){this.contexts=new Map}onChildOutletCreated(V,$){const oe=this.getOrCreateContext(V);oe.outlet=$,this.contexts.set(V,oe)}onChildOutletDestroyed(V){const $=this.getContext(V);$&&($.outlet=null,$.attachRef=null)}onOutletDeactivated(){const V=this.contexts;return this.contexts=new Map,V}onOutletReAttached(V){this.contexts=V}getOrCreateContext(V){let $=this.getContext(V);return $||($=new j1,this.contexts.set(V,$)),$}getContext(V){return this.contexts.get(V)||null}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})();const ya=!1;let xo=(()=>{class k{constructor(){this.activated=null,this._activatedRoute=null,this.name=Si,this.activateEvents=new C.vpe,this.deactivateEvents=new C.vpe,this.attachEvents=new C.vpe,this.detachEvents=new C.vpe,this.parentContexts=(0,C.f3M)(Po),this.location=(0,C.f3M)(C.s_b),this.changeDetector=(0,C.f3M)(C.sBO),this.environmentInjector=(0,C.f3M)(C.lqb)}ngOnChanges(V){if(V.name){const{firstChange:$,previousValue:oe}=V.name;if($)return;this.isTrackedInParentContexts(oe)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(oe)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(V){return this.parentContexts.getContext(V)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const V=this.parentContexts.getContext(this.name);V?.route&&(V.attachRef?this.attach(V.attachRef,V.route):this.activateWith(V.route,V.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new C.vHH(4012,ya);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new C.vHH(4012,ya);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new C.vHH(4012,ya);this.location.detach();const V=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(V.instance),V}attach(V,$){this.activated=V,this._activatedRoute=$,this.location.insert(V.hostView),this.attachEvents.emit(V.instance)}deactivate(){if(this.activated){const V=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(V)}}activateWith(V,$){if(this.isActivated)throw new C.vHH(4013,ya);this._activatedRoute=V;const oe=this.location,Oe=V.snapshot.component,Ut=this.parentContexts.getOrCreateContext(this.name).children,zn=new y1(V,Ut,oe.injector);if($&&function x1(k){return!!k.resolveComponentFactory}($)){const Li=$.resolveComponentFactory(Oe);this.activated=oe.createComponent(Li,oe.length,zn)}else this.activated=oe.createComponent(Oe,{index:oe.length,injector:zn,environmentInjector:$??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275dir=C.lG2({type:k,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[C.TTD]}),k})();class y1{constructor(F,V,$){this.route=F,this.childContexts=V,this.parent=$}get(F,V){return F===yo?this.route:F===Po?this.childContexts:this.parent.get(F,V)}}let Ds=(()=>{class k{}return k.\u0275fac=function(V){return new(V||k)},k.\u0275cmp=C.Xpm({type:k,selectors:[["ng-component"]],standalone:!0,features:[C.jDz],decls:1,vars:0,template:function(V,$){1&V&&C._UZ(0,"router-outlet")},dependencies:[xo],encapsulation:2}),k})();function z1(k,F){return k.providers&&!k._injector&&(k._injector=(0,C.MMx)(k.providers,F,`Route: ${k.path}`)),k._injector??F}function Zo(k){const F=k.children&&k.children.map(Zo),V=F?{...k,children:F}:{...k};return!V.component&&!V.loadComponent&&(F||V.loadChildren)&&V.outlet&&V.outlet!==Si&&(V.component=Ds),V}function po(k){return k.outlet||Si}function Ss(k,F){const V=k.filter($=>po($)===F);return V.push(...k.filter($=>po($)!==F)),V}function Rn(k){if(!k)return null;if(k.routeConfig?._injector)return k.routeConfig._injector;for(let F=k.parent;F;F=F.parent){const V=F.routeConfig;if(V?._loadedInjector)return V._loadedInjector;if(V?._injector)return V._injector}return null}class A1{constructor(F,V,$,oe){this.routeReuseStrategy=F,this.futureState=V,this.currState=$,this.forwardEvent=oe}activate(F){const V=this.futureState._root,$=this.currState?this.currState._root:null;this.deactivateChildRoutes(V,$,F),Jo(this.futureState.root),this.activateChildRoutes(V,$,F)}deactivateChildRoutes(F,V,$){const oe=Ms(V);F.children.forEach(xe=>{const Oe=xe.value.outlet;this.deactivateRoutes(xe,oe[Oe],$),delete oe[Oe]}),zt(oe,(xe,Oe)=>{this.deactivateRouteAndItsChildren(xe,$)})}deactivateRoutes(F,V,$){const oe=F.value,xe=V?V.value:null;if(oe===xe)if(oe.component){const Oe=$.getContext(oe.outlet);Oe&&this.deactivateChildRoutes(F,V,Oe.children)}else this.deactivateChildRoutes(F,V,$);else xe&&this.deactivateRouteAndItsChildren(V,$)}deactivateRouteAndItsChildren(F,V){F.value.component&&this.routeReuseStrategy.shouldDetach(F.value.snapshot)?this.detachAndStoreRouteSubtree(F,V):this.deactivateRouteAndOutlet(F,V)}detachAndStoreRouteSubtree(F,V){const $=V.getContext(F.value.outlet),oe=$&&F.value.component?$.children:V,xe=Ms(F);for(const Oe of Object.keys(xe))this.deactivateRouteAndItsChildren(xe[Oe],oe);if($&&$.outlet){const Oe=$.outlet.detach(),Ut=$.children.onOutletDeactivated();this.routeReuseStrategy.store(F.value.snapshot,{componentRef:Oe,route:F,contexts:Ut})}}deactivateRouteAndOutlet(F,V){const $=V.getContext(F.value.outlet),oe=$&&F.value.component?$.children:V,xe=Ms(F);for(const Oe of Object.keys(xe))this.deactivateRouteAndItsChildren(xe[Oe],oe);$&&($.outlet&&($.outlet.deactivate(),$.children.onOutletDeactivated()),$.attachRef=null,$.resolver=null,$.route=null)}activateChildRoutes(F,V,$){const oe=Ms(V);F.children.forEach(xe=>{this.activateRoutes(xe,oe[xe.value.outlet],$),this.forwardEvent(new Bi(xe.value.snapshot))}),F.children.length&&this.forwardEvent(new Ci(F.value.snapshot))}activateRoutes(F,V,$){const oe=F.value,xe=V?V.value:null;if(Jo(oe),oe===xe)if(oe.component){const Oe=$.getOrCreateContext(oe.outlet);this.activateChildRoutes(F,V,Oe.children)}else this.activateChildRoutes(F,V,$);else if(oe.component){const Oe=$.getOrCreateContext(oe.outlet);if(this.routeReuseStrategy.shouldAttach(oe.snapshot)){const Ut=this.routeReuseStrategy.retrieve(oe.snapshot);this.routeReuseStrategy.store(oe.snapshot,null),Oe.children.onOutletReAttached(Ut.contexts),Oe.attachRef=Ut.componentRef,Oe.route=Ut.route.value,Oe.outlet&&Oe.outlet.attach(Ut.componentRef,Ut.route.value),Jo(Ut.route.value),this.activateChildRoutes(F,null,Oe.children)}else{const Ut=Rn(oe.snapshot),zn=Ut?.get(C._Vd)??null;Oe.attachRef=null,Oe.route=oe,Oe.resolver=zn,Oe.injector=Ut,Oe.outlet&&Oe.outlet.activateWith(oe,Oe.injector),this.activateChildRoutes(F,null,Oe.children)}}else this.activateChildRoutes(F,null,$)}}class lo{constructor(F){this.path=F,this.route=this.path[this.path.length-1]}}class Ga{constructor(F,V){this.component=F,this.route=V}}function aa(k,F,V){const $=k._root;return la($,F?F._root:null,V,[$.value])}function ca(k,F){const V=Symbol(),$=F.get(k,V);return $===V?"function"!=typeof k||(0,C.Z0I)(k)?F.get(k):k:$}function la(k,F,V,$,oe={canDeactivateChecks:[],canActivateChecks:[]}){const xe=Ms(F);return k.children.forEach(Oe=>{(function G1(k,F,V,$,oe={canDeactivateChecks:[],canActivateChecks:[]}){const xe=k.value,Oe=F?F.value:null,Ut=V?V.getContext(k.value.outlet):null;if(Oe&&xe.routeConfig===Oe.routeConfig){const zn=function $a(k,F,V){if("function"==typeof V)return V(k,F);switch(V){case"pathParamsChange":return!cn(k.url,F.url);case"pathParamsOrQueryParamsChange":return!cn(k.url,F.url)||!jr(k.queryParams,F.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!va(k,F)||!jr(k.queryParams,F.queryParams);default:return!va(k,F)}}(Oe,xe,xe.routeConfig.runGuardsAndResolvers);zn?oe.canActivateChecks.push(new lo($)):(xe.data=Oe.data,xe._resolvedData=Oe._resolvedData),la(k,F,xe.component?Ut?Ut.children:null:V,$,oe),zn&&Ut&&Ut.outlet&&Ut.outlet.isActivated&&oe.canDeactivateChecks.push(new Ga(Ut.outlet.component,Oe))}else Oe&&se(F,Ut,oe),oe.canActivateChecks.push(new lo($)),la(k,null,xe.component?Ut?Ut.children:null:V,$,oe)})(Oe,xe[Oe.value.outlet],V,$.concat([Oe.value]),oe),delete xe[Oe.value.outlet]}),zt(xe,(Oe,Ut)=>se(Oe,V.getContext(Ut),oe)),oe}function se(k,F,V){const $=Ms(k),oe=k.value;zt($,(xe,Oe)=>{se(xe,oe.component?F?F.children.getContext(Oe):null:F,V)}),V.canDeactivateChecks.push(new Ga(oe.component&&F&&F.outlet&&F.outlet.isActivated?F.outlet.component:null,oe))}function ne(k){return"function"==typeof k}function Yo(k){return k instanceof ct.K||"EmptyError"===k?.name}const qs=Symbol("INITIAL_VALUE");function ba(){return(0,Ot.w)(k=>Sn(k.map(F=>F.pipe((0,Xt.q)(1),(0,Mi.O)(qs)))).pipe((0,pt.U)(F=>{for(const V of F)if(!0!==V){if(V===qs)return qs;if(!1===V||V instanceof hr)return V}return!0}),(0,Wi.h)(F=>F!==qs),(0,Xt.q)(1)))}function n2(k){return(0,hi.z)((0,Ne.b)(F=>{if(er(F))throw Qo(0,F)}),(0,pt.U)(F=>!0===F))}const La={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function I1(k,F,V,$,oe){const xe=wa(k,F,V);return xe.matched?function Wa(k,F,V,$){const oe=F.canMatch;if(!oe||0===oe.length)return(0,Xe.of)(!0);const xe=oe.map(Oe=>{const Ut=ca(Oe,k);return At(function Eo(k){return k&&ne(k.canMatch)}(Ut)?Ut.canMatch(F,V):k.runInContext(()=>Ut(F,V)))});return(0,Xe.of)(xe).pipe(ba(),n2())}($=z1(F,$),F,V).pipe((0,pt.U)(Oe=>!0===Oe?xe:{...La})):(0,Xe.of)(xe)}function wa(k,F,V){if(""===F.path)return"full"===F.pathMatch&&(k.hasChildren()||V.length>0)?{...La}:{matched:!0,consumedSegments:[],remainingSegments:V,parameters:{},positionalParamSegments:{}};const oe=(F.matcher||Ji)(V,k,F);if(!oe)return{...La};const xe={};zt(oe.posParams,(Ut,zn)=>{xe[zn]=Ut.path});const Oe=oe.consumed.length>0?{...xe,...oe.consumed[oe.consumed.length-1].parameters}:xe;return{matched:!0,consumedSegments:oe.consumed,remainingSegments:V.slice(oe.consumed.length),parameters:Oe,positionalParamSegments:oe.posParams??{}}}function qa(k,F,V,$){if(V.length>0&&function $e(k,F,V){return V.some($=>Pn(k,F,$)&&po($)!==Si)}(k,V,$)){const xe=new ri(F,function ft(k,F,V,$){const oe={};oe[Si]=$,$._sourceSegment=k,$._segmentIndexShift=F.length;for(const xe of V)if(""===xe.path&&po(xe)!==Si){const Oe=new ri([],{});Oe._sourceSegment=k,Oe._segmentIndexShift=F.length,oe[po(xe)]=Oe}return oe}(k,F,$,new ri(V,k.children)));return xe._sourceSegment=k,xe._segmentIndexShift=F.length,{segmentGroup:xe,slicedSegments:[]}}if(0===V.length&&function Yt(k,F,V){return V.some($=>Pn(k,F,$))}(k,V,$)){const xe=new ri(k.segments,function vt(k,F,V,$,oe){const xe={};for(const Oe of $)if(Pn(k,V,Oe)&&!oe[po(Oe)]){const Ut=new ri([],{});Ut._sourceSegment=k,Ut._segmentIndexShift=F.length,xe[po(Oe)]=Ut}return{...oe,...xe}}(k,F,V,$,k.children));return xe._sourceSegment=k,xe._segmentIndexShift=F.length,{segmentGroup:xe,slicedSegments:V}}const oe=new ri(k.segments,k.children);return oe._sourceSegment=k,oe._segmentIndexShift=F.length,{segmentGroup:oe,slicedSegments:V}}function Pn(k,F,V){return(!(k.hasChildren()||F.length>0)||"full"!==V.pathMatch)&&""===V.path}function Ui(k,F,V,$){return!!(po(k)===$||$!==Si&&Pn(F,V,k))&&("**"===k.path||wa(F,k,V).matched)}function ys(k,F,V){return 0===F.length&&!k.children[V]}const na=!1;class Da{constructor(F){this.segmentGroup=F||null}}class V1{constructor(F){this.urlTree=F}}function ua(k){return(0,Te._)(new Da(k))}function v2(k){return(0,Te._)(new V1(k))}class X2{constructor(F,V,$,oe,xe){this.injector=F,this.configLoader=V,this.urlSerializer=$,this.urlTree=oe,this.config=xe,this.allowRedirects=!0}apply(){const F=qa(this.urlTree.root,[],[],this.config).segmentGroup,V=new ri(F.segments,F.children);return this.expandSegmentGroup(this.injector,this.config,V,Si).pipe((0,pt.U)(xe=>this.createUrlTree(Ei(xe),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,Pe.K)(xe=>{if(xe instanceof V1)return this.allowRedirects=!1,this.match(xe.urlTree);throw xe instanceof Da?this.noMatchError(xe):xe}))}match(F){return this.expandSegmentGroup(this.injector,this.config,F.root,Si).pipe((0,pt.U)(oe=>this.createUrlTree(Ei(oe),F.queryParams,F.fragment))).pipe((0,Pe.K)(oe=>{throw oe instanceof Da?this.noMatchError(oe):oe}))}noMatchError(F){return new C.vHH(4002,na)}createUrlTree(F,V,$){const oe=Nn(F);return new hr(oe,V,$)}expandSegmentGroup(F,V,$,oe){return 0===$.segments.length&&$.hasChildren()?this.expandChildren(F,V,$).pipe((0,pt.U)(xe=>new ri([],xe))):this.expandSegment(F,$,V,$.segments,oe,!0)}expandChildren(F,V,$){const oe=[];for(const xe of Object.keys($.children))"primary"===xe?oe.unshift(xe):oe.push(xe);return(0,De.D)(oe).pipe((0,st.b)(xe=>{const Oe=$.children[xe],Ut=Ss(V,xe);return this.expandSegmentGroup(F,Ut,Oe,xe).pipe((0,pt.U)(zn=>({segment:zn,outlet:xe})))}),Bt((xe,Oe)=>(xe[Oe.outlet]=Oe.segment,xe),{}),Di())}expandSegment(F,V,$,oe,xe,Oe){return(0,De.D)($).pipe((0,st.b)(Ut=>this.expandSegmentAgainstRoute(F,V,$,Ut,oe,xe,Oe).pipe((0,Pe.K)(Li=>{if(Li instanceof Da)return(0,Xe.of)(null);throw Li}))),ht(Ut=>!!Ut),(0,Pe.K)((Ut,zn)=>{if(Yo(Ut))return ys(V,oe,xe)?(0,Xe.of)(new ri([],{})):ua(V);throw Ut}))}expandSegmentAgainstRoute(F,V,$,oe,xe,Oe,Ut){return Ui(oe,V,xe,Oe)?void 0===oe.redirectTo?this.matchSegmentAgainstRoute(F,V,oe,xe,Oe):Ut&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(F,V,$,oe,xe,Oe):ua(V):ua(V)}expandSegmentAgainstRouteUsingRedirect(F,V,$,oe,xe,Oe){return"**"===oe.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(F,$,oe,Oe):this.expandRegularSegmentAgainstRouteUsingRedirect(F,V,$,oe,xe,Oe)}expandWildCardWithParamsAgainstRouteUsingRedirect(F,V,$,oe){const xe=this.applyRedirectCommands([],$.redirectTo,{});return $.redirectTo.startsWith("/")?v2(xe):this.lineralizeSegments($,xe).pipe((0,ti.z)(Oe=>{const Ut=new ri(Oe,{});return this.expandSegment(F,Ut,V,Oe,oe,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(F,V,$,oe,xe,Oe){const{matched:Ut,consumedSegments:zn,remainingSegments:Li,positionalParamSegments:_i}=wa(V,oe,xe);if(!Ut)return ua(V);const or=this.applyRedirectCommands(zn,oe.redirectTo,_i);return oe.redirectTo.startsWith("/")?v2(or):this.lineralizeSegments(oe,or).pipe((0,ti.z)(Go=>this.expandSegment(F,V,$,Go.concat(Li),Oe,!1)))}matchSegmentAgainstRoute(F,V,$,oe,xe){return"**"===$.path?(F=z1($,F),$.loadChildren?($._loadedRoutes?(0,Xe.of)({routes:$._loadedRoutes,injector:$._loadedInjector}):this.configLoader.loadChildren(F,$)).pipe((0,pt.U)(Ut=>($._loadedRoutes=Ut.routes,$._loadedInjector=Ut.injector,new ri(oe,{})))):(0,Xe.of)(new ri(oe,{}))):I1(V,$,oe,F).pipe((0,Ot.w)(({matched:Oe,consumedSegments:Ut,remainingSegments:zn})=>Oe?this.getChildConfig(F=$._injector??F,$,oe).pipe((0,ti.z)(_i=>{const or=_i.injector??F,Go=_i.routes,{segmentGroup:d1,slicedSegments:Ma}=qa(V,Ut,zn,Go),N1=new ri(d1.segments,d1.children);if(0===Ma.length&&N1.hasChildren())return this.expandChildren(or,Go,N1).pipe((0,pt.U)(ec=>new ri(Ut,ec)));if(0===Go.length&&0===Ma.length)return(0,Xe.of)(new ri(Ut,{}));const Ha=po($)===xe;return this.expandSegment(or,N1,Go,Ma,Ha?Si:xe,!0).pipe((0,pt.U)(N2=>new ri(Ut.concat(N2.segments),N2.children)))})):ua(V)))}getChildConfig(F,V,$){return V.children?(0,Xe.of)({routes:V.children,injector:F}):V.loadChildren?void 0!==V._loadedRoutes?(0,Xe.of)({routes:V._loadedRoutes,injector:V._loadedInjector}):function mo(k,F,V,$){const oe=F.canLoad;if(void 0===oe||0===oe.length)return(0,Xe.of)(!0);const xe=oe.map(Oe=>{const Ut=ca(Oe,k);return At(function Ve(k){return k&&ne(k.canLoad)}(Ut)?Ut.canLoad(F,V):k.runInContext(()=>Ut(F,V)))});return(0,Xe.of)(xe).pipe(ba(),n2())}(F,V,$).pipe((0,ti.z)(oe=>oe?this.configLoader.loadChildren(F,V).pipe((0,Ne.b)(xe=>{V._loadedRoutes=xe.routes,V._loadedInjector=xe.injector})):function l1(k){return(0,Te._)(ao(na,3))}())):(0,Xe.of)({routes:[],injector:F})}lineralizeSegments(F,V){let $=[],oe=V.root;for(;;){if($=$.concat(oe.segments),0===oe.numberOfChildren)return(0,Xe.of)($);if(oe.numberOfChildren>1||!oe.children[Si])return F.redirectTo,(0,Te._)(new C.vHH(4e3,na));oe=oe.children[Si]}}applyRedirectCommands(F,V,$){return this.applyRedirectCreateUrlTree(V,this.urlSerializer.parse(V),F,$)}applyRedirectCreateUrlTree(F,V,$,oe){const xe=this.createSegmentGroup(F,V.root,$,oe);return new hr(xe,this.createQueryParams(V.queryParams,this.urlTree.queryParams),V.fragment)}createQueryParams(F,V){const $={};return zt(F,(oe,xe)=>{if("string"==typeof oe&&oe.startsWith(":")){const Ut=oe.substring(1);$[xe]=V[Ut]}else $[xe]=oe}),$}createSegmentGroup(F,V,$,oe){const xe=this.createSegments(F,V.segments,$,oe);let Oe={};return zt(V.children,(Ut,zn)=>{Oe[zn]=this.createSegmentGroup(F,Ut,$,oe)}),new ri(xe,Oe)}createSegments(F,V,$,oe){return V.map(xe=>xe.path.startsWith(":")?this.findPosParam(F,xe,oe):this.findOrReturn(xe,$))}findPosParam(F,V,$){const oe=$[V.path.substring(1)];if(!oe)throw new C.vHH(4001,na);return oe}findOrReturn(F,V){let $=0;for(const oe of V){if(oe.path===F.path)return V.splice($),oe;$++}return F}}class I2{}class I{constructor(F,V,$,oe,xe,Oe,Ut){this.injector=F,this.rootComponentType=V,this.config=$,this.urlTree=oe,this.url=xe,this.paramsInheritanceStrategy=Oe,this.urlSerializer=Ut}recognize(){const F=qa(this.urlTree.root,[],[],this.config.filter(V=>void 0===V.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,F,Si).pipe((0,pt.U)(V=>{if(null===V)return null;const $=new t1([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Si,this.rootComponentType,null,this.urlTree.root,-1,{}),oe=new Nr($,V),xe=new Fo(this.url,oe);return this.inheritParamsAndData(xe._root),xe}))}inheritParamsAndData(F){const V=F.value,$=oa(V,this.paramsInheritanceStrategy);V.params=Object.freeze($.params),V.data=Object.freeze($.data),F.children.forEach(oe=>this.inheritParamsAndData(oe))}processSegmentGroup(F,V,$,oe){return 0===$.segments.length&&$.hasChildren()?this.processChildren(F,V,$):this.processSegment(F,V,$,$.segments,oe)}processChildren(F,V,$){return(0,De.D)(Object.keys($.children)).pipe((0,st.b)(oe=>{const xe=$.children[oe],Oe=Ss(V,oe);return this.processSegmentGroup(F,Oe,xe,oe)}),Bt((oe,xe)=>oe&&xe?(oe.push(...xe),oe):null),function Ii(k,F=!1){return(0,Ye.e)((V,$)=>{let oe=0;V.subscribe((0,Gt.x)($,xe=>{const Oe=k(xe,oe++);(Oe||F)&&$.next(xe),!Oe&&$.complete()}))})}(oe=>null!==oe),Tn(null),Di(),(0,pt.U)(oe=>{if(null===oe)return null;const xe=we(oe);return function L(k){k.sort((F,V)=>F.value.outlet===Si?-1:V.value.outlet===Si?1:F.value.outlet.localeCompare(V.value.outlet))}(xe),xe}))}processSegment(F,V,$,oe,xe){return(0,De.D)(V).pipe((0,st.b)(Oe=>this.processSegmentAgainstRoute(Oe._injector??F,Oe,$,oe,xe)),ht(Oe=>!!Oe),(0,Pe.K)(Oe=>{if(Yo(Oe))return ys($,oe,xe)?(0,Xe.of)([]):(0,Xe.of)(null);throw Oe}))}processSegmentAgainstRoute(F,V,$,oe,xe){if(V.redirectTo||!Ui(V,$,oe,xe))return(0,Xe.of)(null);let Oe;if("**"===V.path){const Ut=oe.length>0?He(oe).parameters:{},zn=rn($)+oe.length,Li=new t1(oe,Ut,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Jn(V),po(V),V.component??V._loadedComponent??null,V,yt($),zn,Bn(V));Oe=(0,Xe.of)({snapshot:Li,consumedSegments:[],remainingSegments:[]})}else Oe=I1($,V,oe,F).pipe((0,pt.U)(({matched:Ut,consumedSegments:zn,remainingSegments:Li,parameters:_i})=>{if(!Ut)return null;const or=rn($)+zn.length;return{snapshot:new t1(zn,_i,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Jn(V),po(V),V.component??V._loadedComponent??null,V,yt($),or,Bn(V)),consumedSegments:zn,remainingSegments:Li}}));return Oe.pipe((0,Ot.w)(Ut=>{if(null===Ut)return(0,Xe.of)(null);const{snapshot:zn,consumedSegments:Li,remainingSegments:_i}=Ut;F=V._injector??F;const or=V._loadedInjector??F,Go=function j(k){return k.children?k.children:k.loadChildren?k._loadedRoutes:[]}(V),{segmentGroup:d1,slicedSegments:Ma}=qa($,Li,_i,Go.filter(Ha=>void 0===Ha.redirectTo));if(0===Ma.length&&d1.hasChildren())return this.processChildren(or,Go,d1).pipe((0,pt.U)(Ha=>null===Ha?null:[new Nr(zn,Ha)]));if(0===Go.length&&0===Ma.length)return(0,Xe.of)([new Nr(zn,[])]);const N1=po(V)===xe;return this.processSegment(or,Go,d1,Ma,N1?Si:xe).pipe((0,pt.U)(Ha=>null===Ha?null:[new Nr(zn,Ha)]))}))}}function ie(k){const F=k.value.routeConfig;return F&&""===F.path&&void 0===F.redirectTo}function we(k){const F=[],V=new Set;for(const $ of k){if(!ie($)){F.push($);continue}const oe=F.find(xe=>$.value.routeConfig===xe.value.routeConfig);void 0!==oe?(oe.children.push(...$.children),V.add(oe)):F.push($)}for(const $ of V){const oe=we($.children);F.push(new Nr($.value,oe))}return F.filter($=>!V.has($))}function yt(k){let F=k;for(;F._sourceSegment;)F=F._sourceSegment;return F}function rn(k){let F=k,V=F._segmentIndexShift??0;for(;F._sourceSegment;)F=F._sourceSegment,V+=F._segmentIndexShift??0;return V-1}function Jn(k){return k.data||{}}function Bn(k){return k.resolve||{}}function Bs(k){return"string"==typeof k.title||null===k.title}function Ps(k){return(0,Ot.w)(F=>{const V=k(F);return V?(0,De.D)(V).pipe((0,pt.U)(()=>F)):(0,Xe.of)(F)})}const uo=new C.OlP("ROUTES");let Uo=(()=>{class k{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,C.f3M)(C.Sil)}loadComponent(V){if(this.componentLoaders.get(V))return this.componentLoaders.get(V);if(V._loadedComponent)return(0,Xe.of)(V._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(V);const $=At(V.loadComponent()).pipe((0,pt.U)(h1),(0,Ne.b)(xe=>{this.onLoadEndListener&&this.onLoadEndListener(V),V._loadedComponent=xe}),(0,Br.x)(()=>{this.componentLoaders.delete(V)})),oe=new je($,()=>new Ze.x).pipe(Pt());return this.componentLoaders.set(V,oe),oe}loadChildren(V,$){if(this.childrenLoaders.get($))return this.childrenLoaders.get($);if($._loadedRoutes)return(0,Xe.of)({routes:$._loadedRoutes,injector:$._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener($);const xe=this.loadModuleFactoryOrRoutes($.loadChildren).pipe((0,pt.U)(Ut=>{this.onLoadEndListener&&this.onLoadEndListener($);let zn,Li,_i=!1;Array.isArray(Ut)?Li=Ut:(zn=Ut.create(V).injector,Li=me(zn.get(uo,[],C.XFs.Self|C.XFs.Optional)));return{routes:Li.map(Zo),injector:zn}}),(0,Br.x)(()=>{this.childrenLoaders.delete($)})),Oe=new je(xe,()=>new Ze.x).pipe(Pt());return this.childrenLoaders.set($,Oe),Oe}loadModuleFactoryOrRoutes(V){return At(V()).pipe((0,pt.U)(h1),(0,ti.z)($=>$ instanceof C.YKP||Array.isArray($)?(0,Xe.of)($):(0,De.D)(this.compiler.compileModuleAsync($))))}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})();function h1(k){return function Za(k){return k&&"object"==typeof k&&"default"in k}(k)?k.default:k}let fa=(()=>{class k{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Ze.x,this.configLoader=(0,C.f3M)(Uo),this.environmentInjector=(0,C.f3M)(C.lqb),this.urlSerializer=(0,C.f3M)(Tt),this.rootContexts=(0,C.f3M)(Po),this.navigationId=0,this.afterPreactivation=()=>(0,Xe.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=oe=>this.events.next(new ci(oe)),this.configLoader.onLoadStartListener=oe=>this.events.next(new vs(oe))}complete(){this.transitions?.complete()}handleNavigationRequest(V){const $=++this.navigationId;this.transitions?.next({...this.transitions.value,...V,id:$})}setupNavigations(V){return this.transitions=new s.X({id:0,targetPageId:0,currentUrlTree:V.currentUrlTree,currentRawUrl:V.currentUrlTree,extractedUrl:V.urlHandlingStrategy.extract(V.currentUrlTree),urlAfterRedirects:V.urlHandlingStrategy.extract(V.currentUrlTree),rawUrl:V.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:br,restoredState:null,currentSnapshot:V.routerState.snapshot,targetSnapshot:null,currentRouterState:V.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Wi.h)($=>0!==$.id),(0,pt.U)($=>({...$,extractedUrl:V.urlHandlingStrategy.extract($.rawUrl)})),(0,Ot.w)($=>{let oe=!1,xe=!1;return(0,Xe.of)($).pipe((0,Ne.b)(Oe=>{this.currentNavigation={id:Oe.id,initialUrl:Oe.rawUrl,extractedUrl:Oe.extractedUrl,trigger:Oe.source,extras:Oe.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,Ot.w)(Oe=>{const Ut=V.browserUrlTree.toString(),zn=!V.navigated||Oe.extractedUrl.toString()!==Ut||Ut!==V.currentUrlTree.toString();if(!zn&&"reload"!==(Oe.extras.onSameUrlNavigation??V.onSameUrlNavigation)){const _i="";return this.events.next(new es(Oe.id,V.serializeUrl($.rawUrl),_i,0)),V.rawUrlTree=Oe.rawUrl,Oe.resolve(null),_t.E}if(V.urlHandlingStrategy.shouldProcessUrl(Oe.rawUrl))return r2(Oe.source)&&(V.browserUrlTree=Oe.extractedUrl),(0,Xe.of)(Oe).pipe((0,Ot.w)(_i=>{const or=this.transitions?.getValue();return this.events.next(new qn(_i.id,this.urlSerializer.serialize(_i.extractedUrl),_i.source,_i.restoredState)),or!==this.transitions?.getValue()?_t.E:Promise.resolve(_i)}),function u1(k,F,V,$){return(0,Ot.w)(oe=>function Zs(k,F,V,$,oe){return new X2(k,F,V,$,oe).apply()}(k,F,V,oe.extractedUrl,$).pipe((0,pt.U)(xe=>({...oe,urlAfterRedirects:xe}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,V.config),(0,Ne.b)(_i=>{this.currentNavigation={...this.currentNavigation,finalUrl:_i.urlAfterRedirects},$.urlAfterRedirects=_i.urlAfterRedirects}),function gi(k,F,V,$,oe){return(0,ti.z)(xe=>function Z(k,F,V,$,oe,xe,Oe="emptyOnly"){return new I(k,F,V,$,oe,Oe,xe).recognize().pipe((0,Ot.w)(Ut=>null===Ut?function V2(k){return new de.y(F=>F.error(k))}(new I2):(0,Xe.of)(Ut)))}(k,F,V,xe.urlAfterRedirects,$.serialize(xe.urlAfterRedirects),$,oe).pipe((0,pt.U)(Oe=>({...xe,targetSnapshot:Oe}))))}(this.environmentInjector,this.rootComponentType,V.config,this.urlSerializer,V.paramsInheritanceStrategy),(0,Ne.b)(_i=>{if($.targetSnapshot=_i.targetSnapshot,"eager"===V.urlUpdateStrategy){if(!_i.extras.skipLocationChange){const Go=V.urlHandlingStrategy.merge(_i.urlAfterRedirects,_i.rawUrl);V.setBrowserUrl(Go,_i)}V.browserUrlTree=_i.urlAfterRedirects}const or=new rr(_i.id,this.urlSerializer.serialize(_i.extractedUrl),this.urlSerializer.serialize(_i.urlAfterRedirects),_i.targetSnapshot);this.events.next(or)}));if(zn&&V.urlHandlingStrategy.shouldProcessUrl(V.rawUrlTree)){const{id:_i,extractedUrl:or,source:Go,restoredState:d1,extras:Ma}=Oe,N1=new qn(_i,this.urlSerializer.serialize(or),Go,d1);this.events.next(N1);const Ha=oo(or,this.rootComponentType).snapshot;return $={...Oe,targetSnapshot:Ha,urlAfterRedirects:or,extras:{...Ma,skipLocationChange:!1,replaceUrl:!1}},(0,Xe.of)($)}{const _i="";return this.events.next(new es(Oe.id,V.serializeUrl($.extractedUrl),_i,1)),V.rawUrlTree=Oe.rawUrl,Oe.resolve(null),_t.E}}),(0,Ne.b)(Oe=>{const Ut=new Cs(Oe.id,this.urlSerializer.serialize(Oe.extractedUrl),this.urlSerializer.serialize(Oe.urlAfterRedirects),Oe.targetSnapshot);this.events.next(Ut)}),(0,pt.U)(Oe=>$={...Oe,guards:aa(Oe.targetSnapshot,Oe.currentSnapshot,this.rootContexts)}),function Aa(k,F){return(0,ti.z)(V=>{const{targetSnapshot:$,currentSnapshot:oe,guards:{canActivateChecks:xe,canDeactivateChecks:Oe}}=V;return 0===Oe.length&&0===xe.length?(0,Xe.of)({...V,guardsResult:!0}):function a1(k,F,V,$){return(0,De.D)(k).pipe((0,ti.z)(oe=>function c1(k,F,V,$,oe){const xe=F&&F.routeConfig?F.routeConfig.canDeactivate:null;if(!xe||0===xe.length)return(0,Xe.of)(!0);const Oe=xe.map(Ut=>{const zn=Rn(F)??oe,Li=ca(Ut,zn);return At(function ms(k){return k&&ne(k.canDeactivate)}(Li)?Li.canDeactivate(k,F,V,$):zn.runInContext(()=>Li(k,F,V,$))).pipe(ht())});return(0,Xe.of)(Oe).pipe(ba())}(oe.component,oe.route,V,F,$)),ht(oe=>!0!==oe,!0))}(Oe,$,oe,k).pipe((0,ti.z)(Ut=>Ut&&function X(k){return"boolean"==typeof k}(Ut)?function b1(k,F,V,$){return(0,De.D)(F).pipe((0,st.b)(oe=>(0,ii.z)(function gs(k,F){return null!==k&&F&&F(new eo(k)),(0,Xe.of)(!0)}(oe.route.parent,$),function t2(k,F){return null!==k&&F&&F(new As(k)),(0,Xe.of)(!0)}(oe.route,$),function ta(k,F,V){const $=F[F.length-1],xe=F.slice(0,F.length-1).reverse().map(Oe=>function sr(k){const F=k.routeConfig?k.routeConfig.canActivateChild:null;return F&&0!==F.length?{node:k,guards:F}:null}(Oe)).filter(Oe=>null!==Oe).map(Oe=>Vn(()=>{const Ut=Oe.guards.map(zn=>{const Li=Rn(Oe.node)??V,_i=ca(zn,Li);return At(function jn(k){return k&&ne(k.canActivateChild)}(_i)?_i.canActivateChild($,k):Li.runInContext(()=>_i($,k))).pipe(ht())});return(0,Xe.of)(Ut).pipe(ba())}));return(0,Xe.of)(xe).pipe(ba())}(k,oe.path,V),function Bo(k,F,V){const $=F.routeConfig?F.routeConfig.canActivate:null;if(!$||0===$.length)return(0,Xe.of)(!0);const oe=$.map(xe=>Vn(()=>{const Oe=Rn(F)??V,Ut=ca(xe,Oe);return At(function lt(k){return k&&ne(k.canActivate)}(Ut)?Ut.canActivate(F,k):Oe.runInContext(()=>Ut(F,k))).pipe(ht())}));return(0,Xe.of)(oe).pipe(ba())}(k,oe.route,V))),ht(oe=>!0!==oe,!0))}($,xe,k,F):(0,Xe.of)(Ut)),(0,pt.U)(Ut=>({...V,guardsResult:Ut})))})}(this.environmentInjector,Oe=>this.events.next(Oe)),(0,Ne.b)(Oe=>{if($.guardsResult=Oe.guardsResult,er(Oe.guardsResult))throw Qo(0,Oe.guardsResult);const Ut=new fo(Oe.id,this.urlSerializer.serialize(Oe.extractedUrl),this.urlSerializer.serialize(Oe.urlAfterRedirects),Oe.targetSnapshot,!!Oe.guardsResult);this.events.next(Ut)}),(0,Wi.h)(Oe=>!!Oe.guardsResult||(V.restoreHistory(Oe),this.cancelNavigationTransition(Oe,"",3),!1)),Ps(Oe=>{if(Oe.guards.canActivateChecks.length)return(0,Xe.of)(Oe).pipe((0,Ne.b)(Ut=>{const zn=new _a(Ut.id,this.urlSerializer.serialize(Ut.extractedUrl),this.urlSerializer.serialize(Ut.urlAfterRedirects),Ut.targetSnapshot);this.events.next(zn)}),(0,Ot.w)(Ut=>{let zn=!1;return(0,Xe.of)(Ut).pipe(function Zi(k,F){return(0,ti.z)(V=>{const{targetSnapshot:$,guards:{canActivateChecks:oe}}=V;if(!oe.length)return(0,Xe.of)(V);let xe=0;return(0,De.D)(oe).pipe((0,st.b)(Oe=>function dr(k,F,V,$){const oe=k.routeConfig,xe=k._resolve;return void 0!==oe?.title&&!Bs(oe)&&(xe[Xi]=oe.title),function ji(k,F,V,$){const oe=function wo(k){return[...Object.keys(k),...Object.getOwnPropertySymbols(k)]}(k);if(0===oe.length)return(0,Xe.of)({});const xe={};return(0,De.D)(oe).pipe((0,ti.z)(Oe=>function No(k,F,V,$){const oe=Rn(F)??$,xe=ca(k,oe);return At(xe.resolve?xe.resolve(F,V):oe.runInContext(()=>xe(F,V)))}(k[Oe],F,V,$).pipe(ht(),(0,Ne.b)(Ut=>{xe[Oe]=Ut}))),mi(1),(0,Gi.h)(xe),(0,Pe.K)(Oe=>Yo(Oe)?_t.E:(0,Te._)(Oe)))}(xe,k,F,$).pipe((0,pt.U)(Oe=>(k._resolvedData=Oe,k.data=oa(k,V).resolve,oe&&Bs(oe)&&(k.data[Xi]=oe.title),null)))}(Oe.route,$,k,F)),(0,Ne.b)(()=>xe++),mi(1),(0,ti.z)(Oe=>xe===oe.length?(0,Xe.of)(V):_t.E))})}(V.paramsInheritanceStrategy,this.environmentInjector),(0,Ne.b)({next:()=>zn=!0,complete:()=>{zn||(V.restoreHistory(Ut),this.cancelNavigationTransition(Ut,"",2))}}))}),(0,Ne.b)(Ut=>{const zn=new _r(Ut.id,this.urlSerializer.serialize(Ut.extractedUrl),this.urlSerializer.serialize(Ut.urlAfterRedirects),Ut.targetSnapshot);this.events.next(zn)}))}),Ps(Oe=>{const Ut=zn=>{const Li=[];zn.routeConfig?.loadComponent&&!zn.routeConfig._loadedComponent&&Li.push(this.configLoader.loadComponent(zn.routeConfig).pipe((0,Ne.b)(_i=>{zn.component=_i}),(0,pt.U)(()=>{})));for(const _i of zn.children)Li.push(...Ut(_i));return Li};return Sn(Ut(Oe.targetSnapshot.root)).pipe(Tn(),(0,Xt.q)(1))}),Ps(()=>this.afterPreactivation()),(0,pt.U)(Oe=>{const Ut=function cr(k,F,V){const $=To(k,F._root,V?V._root:void 0);return new Fa($,F)}(V.routeReuseStrategy,Oe.targetSnapshot,Oe.currentRouterState);return $={...Oe,targetRouterState:Ut}}),(0,Ne.b)(Oe=>{V.currentUrlTree=Oe.urlAfterRedirects,V.rawUrlTree=V.urlHandlingStrategy.merge(Oe.urlAfterRedirects,Oe.rawUrl),V.routerState=Oe.targetRouterState,"deferred"===V.urlUpdateStrategy&&(Oe.extras.skipLocationChange||V.setBrowserUrl(V.rawUrlTree,Oe),V.browserUrlTree=Oe.urlAfterRedirects)}),((k,F,V)=>(0,pt.U)($=>(new A1(F,$.targetRouterState,$.currentRouterState,V).activate(k),$)))(this.rootContexts,V.routeReuseStrategy,Oe=>this.events.next(Oe)),(0,Xt.q)(1),(0,Ne.b)({next:Oe=>{oe=!0,this.lastSuccessfulNavigation=this.currentNavigation,V.navigated=!0,this.events.next(new Yi(Oe.id,this.urlSerializer.serialize(Oe.extractedUrl),this.urlSerializer.serialize(V.currentUrlTree))),V.titleStrategy?.updateTitle(Oe.targetRouterState.snapshot),Oe.resolve(!0)},complete:()=>{oe=!0}}),(0,Br.x)(()=>{oe||xe||this.cancelNavigationTransition($,"",1),this.currentNavigation?.id===$.id&&(this.currentNavigation=null)}),(0,Pe.K)(Oe=>{if(xe=!0,Ho(Oe)){Ua(Oe)||(V.navigated=!0,V.restoreHistory($,!0));const Ut=new tr($.id,this.urlSerializer.serialize($.extractedUrl),Oe.message,Oe.cancellationCode);if(this.events.next(Ut),Ua(Oe)){const zn=V.urlHandlingStrategy.merge(Oe.url,V.rawUrlTree),Li={skipLocationChange:$.extras.skipLocationChange,replaceUrl:"eager"===V.urlUpdateStrategy||r2($.source)};V.scheduleNavigation(zn,br,null,Li,{resolve:$.resolve,reject:$.reject,promise:$.promise})}else $.resolve(!1)}else{V.restoreHistory($,!0);const Ut=new ho($.id,this.urlSerializer.serialize($.extractedUrl),Oe,$.targetSnapshot??void 0);this.events.next(Ut);try{$.resolve(V.errorHandler(Oe))}catch(zn){$.reject(zn)}}return _t.E}))}))}cancelNavigationTransition(V,$,oe){const xe=new tr(V.id,this.urlSerializer.serialize(V.extractedUrl),$,oe);this.events.next(xe),V.resolve(!1)}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})();function r2(k){return k!==br}let H2=(()=>{class k{buildTitle(V){let $,oe=V.root;for(;void 0!==oe;)$=this.getResolvedTitleForRoute(oe)??$,oe=oe.children.find(xe=>xe.outlet===Si);return $}getResolvedTitleForRoute(V){return V.data[Xi]}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:function(){return(0,C.f3M)(J2)},providedIn:"root"}),k})(),J2=(()=>{class k extends H2{constructor(V){super(),this.title=V}updateTitle(V){const $=this.buildTitle(V);void 0!==$&&this.title.setTitle($)}}return k.\u0275fac=function(V){return new(V||k)(C.LFG(Ur.Dx))},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})(),gc=(()=>{class k{}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:function(){return(0,C.f3M)($1)},providedIn:"root"}),k})();class Dl{shouldDetach(F){return!1}store(F,V){}shouldAttach(F){return!1}retrieve(F){return null}shouldReuseRoute(F,V){return F.routeConfig===V.routeConfig}}let $1=(()=>{class k extends Dl{}return k.\u0275fac=function(){let F;return function($){return(F||(F=C.n5z(k)))($||k)}}(),k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})();const y2=new C.OlP("",{providedIn:"root",factory:()=>({})});let x2=(()=>{class k{}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:function(){return(0,C.f3M)(vc)},providedIn:"root"}),k})(),vc=(()=>{class k{shouldProcessUrl(V){return!0}extract(V){return V}merge(V,$){return V}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})();function Q2(k){throw k}function Vc(k,F,V){return F.parse("/")}const Hc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},yc={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ca=(()=>{class k{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,C.f3M)(C.c2e),this.isNgZoneEnabled=!1,this.options=(0,C.f3M)(y2,{optional:!0})||{},this.errorHandler=this.options.errorHandler||Q2,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Vc,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,C.f3M)(x2),this.routeReuseStrategy=(0,C.f3M)(gc),this.urlCreationStrategy=(0,C.f3M)(as),this.titleStrategy=(0,C.f3M)(H2),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=me((0,C.f3M)(uo,{optional:!0})??[]),this.navigationTransitions=(0,C.f3M)(fa),this.urlSerializer=(0,C.f3M)(Tt),this.location=(0,C.f3M)(ot.Ye),this.isNgZoneEnabled=(0,C.f3M)(C.R0b)instanceof C.R0b&&C.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new hr,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=oo(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(V=>{this.lastSuccessfulId=V.id,this.currentPageId=this.browserPageId??0},V=>{this.console.warn(`Unhandled Navigation Error: ${V}`)})}resetRootComponentType(V){this.routerState.root.component=V,this.navigationTransitions.rootComponentType=V}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const V=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),br,V)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(V=>{const $="popstate"===V.type?"popstate":"hashchange";"popstate"===$&&setTimeout(()=>{this.navigateToSyncWithBrowser(V.url,$,V.state)},0)}))}navigateToSyncWithBrowser(V,$,oe){const xe={replaceUrl:!0},Oe=oe?.navigationId?oe:null;if(oe){const zn={...oe};delete zn.navigationId,delete zn.\u0275routerPageId,0!==Object.keys(zn).length&&(xe.state=zn)}const Ut=this.parseUrl(V);this.scheduleNavigation(Ut,$,Oe,xe)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(V){this.config=V.map(Zo),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(V,$={}){const{relativeTo:oe,queryParams:xe,fragment:Oe,queryParamsHandling:Ut,preserveFragment:zn}=$,Li=zn?this.currentUrlTree.fragment:Oe;let _i=null;switch(Ut){case"merge":_i={...this.currentUrlTree.queryParams,...xe};break;case"preserve":_i=this.currentUrlTree.queryParams;break;default:_i=xe||null}return null!==_i&&(_i=this.removeEmptyProps(_i)),this.urlCreationStrategy.createUrlTree(oe,this.routerState,this.currentUrlTree,V,_i,Li??null)}navigateByUrl(V,$={skipLocationChange:!1}){const oe=er(V)?V:this.parseUrl(V),xe=this.urlHandlingStrategy.merge(oe,this.rawUrlTree);return this.scheduleNavigation(xe,br,null,$)}navigate(V,$={skipLocationChange:!1}){return function H1(k){for(let F=0;F<k.length;F++){const V=k[F];if(null==V)throw new C.vHH(4008,false)}}(V),this.navigateByUrl(this.createUrlTree(V,$),$)}serializeUrl(V){return this.urlSerializer.serialize(V)}parseUrl(V){let $;try{$=this.urlSerializer.parse(V)}catch(oe){$=this.malformedUriErrorHandler(oe,this.urlSerializer,V)}return $}isActive(V,$){let oe;if(oe=!0===$?{...Hc}:!1===$?{...yc}:$,er(V))return $n(this.currentUrlTree,V,oe);const xe=this.parseUrl(V);return $n(this.currentUrlTree,xe,oe)}removeEmptyProps(V){return Object.keys(V).reduce(($,oe)=>{const xe=V[oe];return null!=xe&&($[oe]=xe),$},{})}scheduleNavigation(V,$,oe,xe,Oe){if(this.disposed)return Promise.resolve(!1);let Ut,zn,Li,_i;return Oe?(Ut=Oe.resolve,zn=Oe.reject,Li=Oe.promise):Li=new Promise((or,Go)=>{Ut=or,zn=Go}),_i="computed"===this.canceledNavigationResolution?oe&&oe.\u0275routerPageId?oe.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:_i,source:$,restoredState:oe,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:V,extras:xe,resolve:Ut,reject:zn,promise:Li,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Li.catch(or=>Promise.reject(or))}setBrowserUrl(V,$){const oe=this.urlSerializer.serialize(V);if(this.location.isCurrentPathEqualTo(oe)||$.extras.replaceUrl){const Oe={...$.extras.state,...this.generateNgRouterState($.id,this.browserPageId)};this.location.replaceState(oe,"",Oe)}else{const xe={...$.extras.state,...this.generateNgRouterState($.id,$.targetPageId)};this.location.go(oe,"",xe)}}restoreHistory(V,$=!1){if("computed"===this.canceledNavigationResolution){const xe=this.currentPageId-(this.browserPageId??this.currentPageId);0!==xe?this.location.historyGo(xe):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===xe&&(this.resetState(V),this.browserUrlTree=V.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&($&&this.resetState(V),this.resetUrlToCurrentUrlTree())}resetState(V){this.routerState=V.currentRouterState,this.currentUrlTree=V.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,V.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(V,$){return"computed"===this.canceledNavigationResolution?{navigationId:V,\u0275routerPageId:$}:{navigationId:V}}}return k.\u0275fac=function(V){return new(V||k)},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})(),s2=(()=>{class k{constructor(V,$,oe,xe,Oe,Ut){this.router=V,this.route=$,this.tabIndexAttribute=oe,this.renderer=xe,this.el=Oe,this.locationStrategy=Ut,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new Ze.x;const zn=Oe.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===zn||"area"===zn,this.isAnchorElement?this.subscription=V.events.subscribe(Li=>{Li instanceof Yi&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(V){this._preserveFragment=(0,C.D6c)(V)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(V){this._skipLocationChange=(0,C.D6c)(V)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(V){this._replaceUrl=(0,C.D6c)(V)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(V){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",V)}ngOnChanges(V){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(V){null!=V?(this.commands=Array.isArray(V)?V:[V],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(V,$,oe,xe,Oe){return!!(null===this.urlTree||this.isAnchorElement&&(0!==V||$||oe||xe||Oe||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const V=null===this.href?null:(0,C.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",V)}applyAttributeValue(V,$){const oe=this.renderer,xe=this.el.nativeElement;null!==$?oe.setAttribute(xe,V,$):oe.removeAttribute(xe,V)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return k.\u0275fac=function(V){return new(V||k)(C.Y36(Ca),C.Y36(yo),C.$8M("tabindex"),C.Y36(C.Qsj),C.Y36(C.SBq),C.Y36(ot.S$))},k.\u0275dir=C.lG2({type:k,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(V,$){1&V&&C.NdJ("click",function(xe){return $.onClick(xe.button,xe.ctrlKey,xe.shiftKey,xe.altKey,xe.metaKey)}),2&V&&C.uIk("target",$.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[C.TTD]}),k})(),b2=(()=>{class k{get isActive(){return this._isActive}constructor(V,$,oe,xe,Oe){this.router=V,this.element=$,this.renderer=oe,this.cdr=xe,this.link=Oe,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new C.vpe,this.routerEventsSubscription=V.events.subscribe(Ut=>{Ut instanceof Yi&&this.update()})}ngAfterContentInit(){(0,Xe.of)(this.links.changes,(0,Xe.of)(null)).pipe((0,Hr.J)()).subscribe(V=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const V=[...this.links.toArray(),this.link].filter($=>!!$).map($=>$.onChanges);this.linkInputChangesSubscription=(0,De.D)(V).pipe((0,Hr.J)()).subscribe($=>{this._isActive!==this.isLinkActive(this.router)($)&&this.update()})}set routerLinkActive(V){const $=Array.isArray(V)?V:V.split(" ");this.classes=$.filter(oe=>!!oe)}ngOnChanges(V){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||Promise.resolve().then(()=>{const V=this.hasActiveLinks();this._isActive!==V&&(this._isActive=V,this.cdr.markForCheck(),this.classes.forEach($=>{V?this.renderer.addClass(this.element.nativeElement,$):this.renderer.removeClass(this.element.nativeElement,$)}),V&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(V))})}isLinkActive(V){const $=function w1(k){return!!k.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return oe=>!!oe.urlTree&&V.isActive(oe.urlTree,$)}hasActiveLinks(){const V=this.isLinkActive(this.router);return this.link&&V(this.link)||this.links.some(V)}}return k.\u0275fac=function(V){return new(V||k)(C.Y36(Ca),C.Y36(C.SBq),C.Y36(C.Qsj),C.Y36(C.sBO),C.Y36(s2,8))},k.\u0275dir=C.lG2({type:k,selectors:[["","routerLinkActive",""]],contentQueries:function(V,$,oe){if(1&V&&C.Suo(oe,s2,5),2&V){let xe;C.iGM(xe=C.CRH())&&($.links=xe)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[C.TTD]}),k})();class Pc{}let D=(()=>{class k{constructor(V,$,oe,xe,Oe){this.router=V,this.injector=oe,this.preloadingStrategy=xe,this.loader=Oe}setUpPreloading(){this.subscription=this.router.events.pipe((0,Wi.h)(V=>V instanceof Yi),(0,st.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(V,$){const oe=[];for(const xe of $){xe.providers&&!xe._injector&&(xe._injector=(0,C.MMx)(xe.providers,V,`Route: ${xe.path}`));const Oe=xe._injector??V,Ut=xe._loadedInjector??Oe;(xe.loadChildren&&!xe._loadedRoutes&&void 0===xe.canLoad||xe.loadComponent&&!xe._loadedComponent)&&oe.push(this.preloadConfig(Oe,xe)),(xe.children||xe._loadedRoutes)&&oe.push(this.processRoutes(Ut,xe.children??xe._loadedRoutes))}return(0,De.D)(oe).pipe((0,Hr.J)())}preloadConfig(V,$){return this.preloadingStrategy.preload($,()=>{let oe;oe=$.loadChildren&&void 0===$.canLoad?this.loader.loadChildren(V,$):(0,Xe.of)(null);const xe=oe.pipe((0,ti.z)(Oe=>null===Oe?(0,Xe.of)(void 0):($._loadedRoutes=Oe.routes,$._loadedInjector=Oe.injector,this.processRoutes(Oe.injector??V,Oe.routes))));if($.loadComponent&&!$._loadedComponent){const Oe=this.loader.loadComponent($);return(0,De.D)([xe,Oe]).pipe((0,Hr.J)())}return xe})}}return k.\u0275fac=function(V){return new(V||k)(C.LFG(Ca),C.LFG(C.Sil),C.LFG(C.lqb),C.LFG(Pc),C.LFG(Uo))},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})();const q=new C.OlP("");let he=(()=>{class k{constructor(V,$,oe,xe,Oe={}){this.urlSerializer=V,this.transitions=$,this.viewportScroller=oe,this.zone=xe,this.options=Oe,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},Oe.scrollPositionRestoration=Oe.scrollPositionRestoration||"disabled",Oe.anchorScrolling=Oe.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(V=>{V instanceof qn?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=V.navigationTrigger,this.restoredId=V.restoredState?V.restoredState.navigationId:0):V instanceof Yi&&(this.lastId=V.id,this.scheduleScrollEvent(V,this.urlSerializer.parse(V.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(V=>{V instanceof Vs&&(V.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(V.position):V.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(V.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(V,$){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Vs(V,"popstate"===this.lastSource?this.store[this.restoredId]:null,$))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return k.\u0275fac=function(V){C.$Z()},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac}),k})();var Fe=(()=>((Fe=Fe||{})[Fe.COMPLETE=0]="COMPLETE",Fe[Fe.FAILED=1]="FAILED",Fe[Fe.REDIRECTING=2]="REDIRECTING",Fe))();const Mt=!1;function fi(k,F){return{\u0275kind:k,\u0275providers:F}}const Vi=new C.OlP("",{providedIn:"root",factory:()=>!1});function Fr(){const k=(0,C.f3M)(C.zs3);return F=>{const V=k.get(C.z2F);if(F!==V.components[0])return;const $=k.get(Ca),oe=k.get(_s);1===k.get(vr)&&$.initialNavigation(),k.get(Va,null,C.XFs.Optional)?.setUpPreloading(),k.get(q,null,C.XFs.Optional)?.init(),$.resetRootComponentType(V.componentTypes[0]),oe.closed||(oe.next(),oe.complete(),oe.unsubscribe())}}const _s=new C.OlP(Mt?"bootstrap done indicator":"",{factory:()=>new Ze.x}),vr=new C.OlP(Mt?"initial navigation":"",{providedIn:"root",factory:()=>1});function Ia(){let k=[];return k=Mt?[{provide:C.Xts,multi:!0,useFactory:()=>{const F=(0,C.f3M)(Ca);return()=>F.events.subscribe(V=>{console.group?.(`Router Event: ${V.constructor.name}`),console.log(function Gs(k){if(!("type"in k))return`Unknown Router Event: ${k.constructor.name}`;switch(k.type){case 14:return`ActivationEnd(path: '${k.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${k.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${k.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${k.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${k.id}, url: '${k.url}', urlAfterRedirects: '${k.urlAfterRedirects}', state: ${k.state}, shouldActivate: ${k.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${k.id}, url: '${k.url}', urlAfterRedirects: '${k.urlAfterRedirects}', state: ${k.state})`;case 2:return`NavigationCancel(id: ${k.id}, url: '${k.url}')`;case 16:return`NavigationSkipped(id: ${k.id}, url: '${k.url}')`;case 1:return`NavigationEnd(id: ${k.id}, url: '${k.url}', urlAfterRedirects: '${k.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${k.id}, url: '${k.url}', error: ${k.error})`;case 0:return`NavigationStart(id: ${k.id}, url: '${k.url}')`;case 6:return`ResolveEnd(id: ${k.id}, url: '${k.url}', urlAfterRedirects: '${k.urlAfterRedirects}', state: ${k.state})`;case 5:return`ResolveStart(id: ${k.id}, url: '${k.url}', urlAfterRedirects: '${k.urlAfterRedirects}', state: ${k.state})`;case 10:return`RouteConfigLoadEnd(path: ${k.route.path})`;case 9:return`RouteConfigLoadStart(path: ${k.route.path})`;case 4:return`RoutesRecognized(id: ${k.id}, url: '${k.url}', urlAfterRedirects: '${k.urlAfterRedirects}', state: ${k.state})`;case 15:return`Scroll(anchor: '${k.anchor}', position: '${k.position?`${k.position[0]}, ${k.position[1]}`:null}')`}}(V)),console.log(V),console.groupEnd?.()})}}]:[],fi(1,k)}const Va=new C.OlP(Mt?"router preloader":"");function ia(k){return fi(0,[{provide:Va,useExisting:D},{provide:Pc,useExisting:k}])}const C1=!1,Ts=new C.OlP(C1?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),Ya=[ot.Ye,{provide:Tt,useClass:In},Ca,Po,{provide:yo,useFactory:function An(k){return k.routerState.root},deps:[Ca]},Uo,C1?{provide:Vi,useValue:!0}:[]];function ai(){return new C.PXZ("Router",Ca)}let o2=(()=>{class k{constructor(V){}static forRoot(V,$){return{ngModule:k,providers:[Ya,C1&&$?.enableTracing?Ia().\u0275providers:[],{provide:uo,multi:!0,useValue:V},{provide:Ts,useFactory:us,deps:[[Ca,new C.FiY,new C.tp0]]},{provide:y2,useValue:$||{}},$?.useHash?{provide:ot.S$,useClass:ot.Do}:{provide:ot.S$,useClass:ot.b0},{provide:q,useFactory:()=>{const k=(0,C.f3M)(ot.EM),F=(0,C.f3M)(C.R0b),V=(0,C.f3M)(y2),$=(0,C.f3M)(fa),oe=(0,C.f3M)(Tt);return V.scrollOffset&&k.setOffset(V.scrollOffset),new he(oe,$,k,F,V)}},$?.preloadingStrategy?ia($.preloadingStrategy).\u0275providers:[],{provide:C.PXZ,multi:!0,useFactory:ai},$?.initialNavigation?Ao($):[],[{provide:L1,useFactory:Fr},{provide:C.tb,multi:!0,useExisting:L1}]]}}static forChild(V){return{ngModule:k,providers:[{provide:uo,multi:!0,useValue:V}]}}}return k.\u0275fac=function(V){return new(V||k)(C.LFG(Ts,8))},k.\u0275mod=C.oAB({type:k}),k.\u0275inj=C.cJS({imports:[Ds]}),k})();function us(k){if(C1&&k)throw new C.vHH(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Ao(k){return["disabled"===k.initialNavigation?fi(3,[{provide:C.ip1,multi:!0,useFactory:()=>{const F=(0,C.f3M)(Ca);return()=>{F.setUpLocationChangeListener()}}},{provide:vr,useValue:2}]).\u0275providers:[],"enabledBlocking"===k.initialNavigation?fi(2,[{provide:vr,useValue:0},{provide:C.ip1,multi:!0,deps:[C.zs3],useFactory:F=>{const V=F.get(ot.V_,Promise.resolve());return()=>V.then(()=>new Promise($=>{const oe=F.get(Ca),xe=F.get(_s);(function bt(k,F){k.events.pipe((0,Wi.h)(V=>V instanceof Yi||V instanceof tr||V instanceof ho||V instanceof es),(0,pt.U)(V=>V instanceof Yi||V instanceof es?Fe.COMPLETE:V instanceof tr&&(0===V.code||1===V.code)?Fe.REDIRECTING:Fe.FAILED),(0,Wi.h)(V=>V!==Fe.REDIRECTING),(0,Xt.q)(1)).subscribe(()=>{F()})})(oe,()=>{$(!0)}),F.get(fa).afterPreactivation=()=>($(!0),xe.closed?(0,Xe.of)(void 0):xe),oe.initialNavigation()}))}}]).\u0275providers:[]]}const L1=new C.OlP(C1?"Router Initializer":"")},2216:(yi,on,ue)=>{"use strict";ue.d(on,{BN:()=>Zs,uH:()=>Z});var C=ue(1571);function De(I,L){var j=Object.keys(I);if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(I);L&&(ie=ie.filter(function(we){return Object.getOwnPropertyDescriptor(I,we).enumerable})),j.push.apply(j,ie)}return j}function Xe(I){for(var L=1;L<arguments.length;L++){var j=null!=arguments[L]?arguments[L]:{};L%2?De(Object(j),!0).forEach(function(ie){gt(I,ie,j[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(j)):De(Object(j)).forEach(function(ie){Object.defineProperty(I,ie,Object.getOwnPropertyDescriptor(j,ie))})}return I}function s(I){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L})(I)}function Et(I,L){for(var j=0;j<L.length;j++){var ie=L[j];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(I,ie.key,ie)}}function gt(I,L,j){return L in I?Object.defineProperty(I,L,{value:j,enumerable:!0,configurable:!0,writable:!0}):I[L]=j,I}function Gt(I,L){return function En(I){if(Array.isArray(I))return I}(I)||function ii(I,L){var j=null==I?null:typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(null!=j){var yt,rn,ie=[],we=!0,Je=!1;try{for(j=j.call(I);!(we=(yt=j.next()).done)&&(ie.push(yt.value),!L||ie.length!==L);we=!0);}catch(mn){Je=!0,rn=mn}finally{try{!we&&null!=j.return&&j.return()}finally{if(Je)throw rn}}return ie}}(I,L)||hn(I,L)||function Te(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kn(I){return function Sn(I){if(Array.isArray(I))return Vn(I)}(I)||function dn(I){if(typeof Symbol<"u"&&null!=I[Symbol.iterator]||null!=I["@@iterator"])return Array.from(I)}(I)||hn(I)||function hi(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hn(I,L){if(I){if("string"==typeof I)return Vn(I,L);var j=Object.prototype.toString.call(I).slice(8,-1);if("Object"===j&&I.constructor&&(j=I.constructor.name),"Map"===j||"Set"===j)return Array.from(I);if("Arguments"===j||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(j))return Vn(I,L)}}function Vn(I,L){(null==L||L>I.length)&&(L=I.length);for(var j=0,ie=new Array(L);j<L;j++)ie[j]=I[j];return ie}var _t=function(){},Ue={},Ye={},Pt=null,je={mark:_t,measure:_t};try{typeof window<"u"&&(Ue=window),typeof document<"u"&&(Ye=document),typeof MutationObserver<"u"&&(Pt=MutationObserver),typeof performance<"u"&&(je=performance)}catch{}var xt,ht,st,Ne,Pe,ot=(Ue.navigator||{}).userAgent,pt=void 0===ot?"":ot,Ot=Ue,Xt=Ye,Mi=Pt,Wi=je,Tn=!!Xt.documentElement&&!!Xt.head&&"function"==typeof Xt.addEventListener&&"function"==typeof Xt.createElement,rt=~pt.indexOf("MSIE")||~pt.indexOf("Trident/"),Ke="___FONT_AWESOME___",Bt=16,mi="fa",Di="svg-inline--fa",Ii="data-fa-i2svg",Gi="data-fa-pseudo-element",Br="data-fa-pseudo-element-pending",Hr="data-prefix",Ur="data-icon",Si="fontawesome-i2svg",Xi="async",Rs=["HTML","HEAD","STYLE","SCRIPT"],$r=function(){try{return!0}catch{return!1}}(),Ji="classic",ir="sharp",jr=[Ji,ir];function sn(I){return new Proxy(I,{get:function(j,ie){return ie in j?j[ie]:j[Ji]}})}var me=sn((gt(xt={},Ji,{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands",fak:"kit",fakd:"kit","fa-kit":"kit","fa-kit-duotone":"kit"}),gt(xt,ir,{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"}),xt)),He=sn((gt(ht={},Ji,{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab",kit:"fak"}),gt(ht,ir,{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"}),ht)),it=sn((gt(st={},Ji,{fab:"fa-brands",fad:"fa-duotone",fak:"fa-kit",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"}),gt(st,ir,{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"}),st)),zt=sn((gt(Ne={},Ji,{"fa-brands":"fab","fa-duotone":"fad","fa-kit":"fak","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"}),gt(Ne,ir,{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"}),Ne)),At=/fa(s|r|l|t|d|b|k|ss|sr|sl|st)?[\-\ ]/,It="fa-layers-text",Hn=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp|Kit)?.*/i,Qt=sn((gt(Pe={},Ji,{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"}),gt(Pe,ir,{900:"fass",400:"fasr",300:"fasl",100:"fast"}),Pe)),$n=[1,2,3,4,5,6,7,8,9,10],Wn=$n.concat([11,12,13,14,15,16,17,18,19,20]),Zn=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],Fi={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},Hi=new Set;Object.keys(He[Ji]).map(Hi.add.bind(Hi)),Object.keys(He[ir]).map(Hi.add.bind(Hi));var Xr=[].concat(jr,Kn(Hi),["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",Fi.GROUP,Fi.SWAP_OPACITY,Fi.PRIMARY,Fi.SECONDARY]).concat($n.map(function(I){return"".concat(I,"x")})).concat(Wn.map(function(I){return"w-".concat(I)})),Ti=Ot.FontAwesomeConfig||{};Xt&&"function"==typeof Xt.querySelector&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(I){var L=Gt(I,2),ie=L[1],we=function ri(I){return""===I||"false"!==I&&("true"===I||I)}(function hr(I){var L=Xt.querySelector("script["+I+"]");if(L)return L.getAttribute(I)}(L[0]));null!=we&&(Ti[ie]=we)});var Ir={styleDefault:"solid",familyDefault:"classic",cssPrefix:mi,replacementClass:Di,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Ti.familyPrefix&&(Ti.cssPrefix=Ti.familyPrefix);var cn=Xe(Xe({},Ir),Ti);cn.autoReplaceSvg||(cn.observeMutations=!1);var Be={};Object.keys(Ir).forEach(function(I){Object.defineProperty(Be,I,{enumerable:!0,set:function(j){cn[I]=j,Tt.forEach(function(ie){return ie(Be)})},get:function(){return cn[I]}})}),Object.defineProperty(Be,"familyPrefix",{enumerable:!0,set:function(L){cn.cssPrefix=L,Tt.forEach(function(j){return j(Be)})},get:function(){return cn.cssPrefix}}),Ot.FontAwesomeConfig=Be;var Tt=[],vn=Bt,ei={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1},kt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function Ht(){for(var I=12,L="";I-- >0;)L+=kt[62*Math.random()|0];return L}function an(I){for(var L=[],j=(I||[]).length>>>0;j--;)L[j]=I[j];return L}function _n(I){return I.classList?an(I.classList):(I.getAttribute("class")||"").split(" ").filter(function(L){return L})}function qe(I){return"".concat(I).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function ye(I){return Object.keys(I||{}).reduce(function(L,j){return L+"".concat(j,": ").concat(I[j].trim(),";")},"")}function ke(I){return I.size!==ei.size||I.x!==ei.x||I.y!==ei.y||I.rotate!==ei.rotate||I.flipX||I.flipY}var Se=':root, :host {\n  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Solid";\n  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Regular";\n  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Light";\n  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Thin";\n  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";\n  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";\n  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";\n  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";\n  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";\n  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";\n}\n\nsvg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {\n  overflow: visible;\n  box-sizing: content-box;\n}\n\n.svg-inline--fa {\n  display: var(--fa-display, inline-block);\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-2xs {\n  vertical-align: 0.1em;\n}\n.svg-inline--fa.fa-xs {\n  vertical-align: 0em;\n}\n.svg-inline--fa.fa-sm {\n  vertical-align: -0.0714285705em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.2em;\n}\n.svg-inline--fa.fa-xl {\n  vertical-align: -0.25em;\n}\n.svg-inline--fa.fa-2xl {\n  vertical-align: -0.3125em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: var(--fa-pull-margin, 0.3em);\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: var(--fa-pull-margin, 0.3em);\n  width: auto;\n}\n.svg-inline--fa.fa-li {\n  width: var(--fa-li-width, 2em);\n  top: 0.25em;\n}\n.svg-inline--fa.fa-fw {\n  width: var(--fa-fw-width, 1.25em);\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: var(--fa-counter-background-color, #ff253a);\n  border-radius: var(--fa-counter-border-radius, 1em);\n  box-sizing: border-box;\n  color: var(--fa-inverse, #fff);\n  line-height: var(--fa-counter-line-height, 1);\n  max-width: var(--fa-counter-max-width, 5em);\n  min-width: var(--fa-counter-min-width, 1.5em);\n  overflow: hidden;\n  padding: var(--fa-counter-padding, 0.25em 0.5em);\n  right: var(--fa-right, 0);\n  text-overflow: ellipsis;\n  top: var(--fa-top, 0);\n  -webkit-transform: scale(var(--fa-counter-scale, 0.25));\n          transform: scale(var(--fa-counter-scale, 0.25));\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: var(--fa-bottom, 0);\n  right: var(--fa-right, 0);\n  top: auto;\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: var(--fa-bottom, 0);\n  left: var(--fa-left, 0);\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  top: var(--fa-top, 0);\n  right: var(--fa-right, 0);\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: var(--fa-left, 0);\n  right: auto;\n  top: var(--fa-top, 0);\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-2xs {\n  font-size: 0.625em;\n  line-height: 0.1em;\n  vertical-align: 0.225em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n  line-height: 0.0833333337em;\n  vertical-align: 0.125em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n  line-height: 0.0714285718em;\n  vertical-align: 0.0535714295em;\n}\n\n.fa-lg {\n  font-size: 1.25em;\n  line-height: 0.05em;\n  vertical-align: -0.075em;\n}\n\n.fa-xl {\n  font-size: 1.5em;\n  line-height: 0.0416666682em;\n  vertical-align: -0.125em;\n}\n\n.fa-2xl {\n  font-size: 2em;\n  line-height: 0.03125em;\n  vertical-align: -0.1875em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: var(--fa-li-margin, 2.5em);\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: calc(var(--fa-li-width, 2em) * -1);\n  position: absolute;\n  text-align: center;\n  width: var(--fa-li-width, 2em);\n  line-height: inherit;\n}\n\n.fa-border {\n  border-color: var(--fa-border-color, #eee);\n  border-radius: var(--fa-border-radius, 0.1em);\n  border-style: var(--fa-border-style, solid);\n  border-width: var(--fa-border-width, 0.08em);\n  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);\n}\n\n.fa-pull-left {\n  float: left;\n  margin-right: var(--fa-pull-margin, 0.3em);\n}\n\n.fa-pull-right {\n  float: right;\n  margin-left: var(--fa-pull-margin, 0.3em);\n}\n\n.fa-beat {\n  -webkit-animation-name: fa-beat;\n          animation-name: fa-beat;\n  -webkit-animation-delay: var(--fa-animation-delay, 0s);\n          animation-delay: var(--fa-animation-delay, 0s);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);\n          animation-timing-function: var(--fa-animation-timing, ease-in-out);\n}\n\n.fa-bounce {\n  -webkit-animation-name: fa-bounce;\n          animation-name: fa-bounce;\n  -webkit-animation-delay: var(--fa-animation-delay, 0s);\n          animation-delay: var(--fa-animation-delay, 0s);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));\n          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));\n}\n\n.fa-fade {\n  -webkit-animation-name: fa-fade;\n          animation-name: fa-fade;\n  -webkit-animation-delay: var(--fa-animation-delay, 0s);\n          animation-delay: var(--fa-animation-delay, 0s);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n}\n\n.fa-beat-fade {\n  -webkit-animation-name: fa-beat-fade;\n          animation-name: fa-beat-fade;\n  -webkit-animation-delay: var(--fa-animation-delay, 0s);\n          animation-delay: var(--fa-animation-delay, 0s);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n}\n\n.fa-flip {\n  -webkit-animation-name: fa-flip;\n          animation-name: fa-flip;\n  -webkit-animation-delay: var(--fa-animation-delay, 0s);\n          animation-delay: var(--fa-animation-delay, 0s);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);\n          animation-timing-function: var(--fa-animation-timing, ease-in-out);\n}\n\n.fa-shake {\n  -webkit-animation-name: fa-shake;\n          animation-name: fa-shake;\n  -webkit-animation-delay: var(--fa-animation-delay, 0s);\n          animation-delay: var(--fa-animation-delay, 0s);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, linear);\n          animation-timing-function: var(--fa-animation-timing, linear);\n}\n\n.fa-spin {\n  -webkit-animation-name: fa-spin;\n          animation-name: fa-spin;\n  -webkit-animation-delay: var(--fa-animation-delay, 0s);\n          animation-delay: var(--fa-animation-delay, 0s);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 2s);\n          animation-duration: var(--fa-animation-duration, 2s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, linear);\n          animation-timing-function: var(--fa-animation-timing, linear);\n}\n\n.fa-spin-reverse {\n  --fa-animation-direction: reverse;\n}\n\n.fa-pulse,\n.fa-spin-pulse {\n  -webkit-animation-name: fa-spin;\n          animation-name: fa-spin;\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, steps(8));\n          animation-timing-function: var(--fa-animation-timing, steps(8));\n}\n\n@media (prefers-reduced-motion: reduce) {\n  .fa-beat,\n.fa-bounce,\n.fa-fade,\n.fa-beat-fade,\n.fa-flip,\n.fa-pulse,\n.fa-shake,\n.fa-spin,\n.fa-spin-pulse {\n    -webkit-animation-delay: -1ms;\n            animation-delay: -1ms;\n    -webkit-animation-duration: 1ms;\n            animation-duration: 1ms;\n    -webkit-animation-iteration-count: 1;\n            animation-iteration-count: 1;\n    -webkit-transition-delay: 0s;\n            transition-delay: 0s;\n    -webkit-transition-duration: 0s;\n            transition-duration: 0s;\n  }\n}\n@-webkit-keyframes fa-beat {\n  0%, 90% {\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  45% {\n    -webkit-transform: scale(var(--fa-beat-scale, 1.25));\n            transform: scale(var(--fa-beat-scale, 1.25));\n  }\n}\n@keyframes fa-beat {\n  0%, 90% {\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  45% {\n    -webkit-transform: scale(var(--fa-beat-scale, 1.25));\n            transform: scale(var(--fa-beat-scale, 1.25));\n  }\n}\n@-webkit-keyframes fa-bounce {\n  0% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  10% {\n    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n  }\n  30% {\n    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n  }\n  50% {\n    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n  }\n  57% {\n    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n  }\n  64% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  100% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n}\n@keyframes fa-bounce {\n  0% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  10% {\n    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n  }\n  30% {\n    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n  }\n  50% {\n    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n  }\n  57% {\n    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n  }\n  64% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  100% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n}\n@-webkit-keyframes fa-fade {\n  50% {\n    opacity: var(--fa-fade-opacity, 0.4);\n  }\n}\n@keyframes fa-fade {\n  50% {\n    opacity: var(--fa-fade-opacity, 0.4);\n  }\n}\n@-webkit-keyframes fa-beat-fade {\n  0%, 100% {\n    opacity: var(--fa-beat-fade-opacity, 0.4);\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  50% {\n    opacity: 1;\n    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));\n            transform: scale(var(--fa-beat-fade-scale, 1.125));\n  }\n}\n@keyframes fa-beat-fade {\n  0%, 100% {\n    opacity: var(--fa-beat-fade-opacity, 0.4);\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  50% {\n    opacity: 1;\n    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));\n            transform: scale(var(--fa-beat-fade-scale, 1.125));\n  }\n}\n@-webkit-keyframes fa-flip {\n  50% {\n    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n  }\n}\n@keyframes fa-flip {\n  50% {\n    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n  }\n}\n@-webkit-keyframes fa-shake {\n  0% {\n    -webkit-transform: rotate(-15deg);\n            transform: rotate(-15deg);\n  }\n  4% {\n    -webkit-transform: rotate(15deg);\n            transform: rotate(15deg);\n  }\n  8%, 24% {\n    -webkit-transform: rotate(-18deg);\n            transform: rotate(-18deg);\n  }\n  12%, 28% {\n    -webkit-transform: rotate(18deg);\n            transform: rotate(18deg);\n  }\n  16% {\n    -webkit-transform: rotate(-22deg);\n            transform: rotate(-22deg);\n  }\n  20% {\n    -webkit-transform: rotate(22deg);\n            transform: rotate(22deg);\n  }\n  32% {\n    -webkit-transform: rotate(-12deg);\n            transform: rotate(-12deg);\n  }\n  36% {\n    -webkit-transform: rotate(12deg);\n            transform: rotate(12deg);\n  }\n  40%, 100% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n}\n@keyframes fa-shake {\n  0% {\n    -webkit-transform: rotate(-15deg);\n            transform: rotate(-15deg);\n  }\n  4% {\n    -webkit-transform: rotate(15deg);\n            transform: rotate(15deg);\n  }\n  8%, 24% {\n    -webkit-transform: rotate(-18deg);\n            transform: rotate(-18deg);\n  }\n  12%, 28% {\n    -webkit-transform: rotate(18deg);\n            transform: rotate(18deg);\n  }\n  16% {\n    -webkit-transform: rotate(-22deg);\n            transform: rotate(-22deg);\n  }\n  20% {\n    -webkit-transform: rotate(22deg);\n            transform: rotate(22deg);\n  }\n  32% {\n    -webkit-transform: rotate(-12deg);\n            transform: rotate(-12deg);\n  }\n  36% {\n    -webkit-transform: rotate(12deg);\n            transform: rotate(12deg);\n  }\n  40%, 100% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n}\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both,\n.fa-flip-horizontal.fa-flip-vertical {\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n.fa-rotate-by {\n  -webkit-transform: rotate(var(--fa-rotate-angle, none));\n          transform: rotate(var(--fa-rotate-angle, none));\n}\n\n.fa-stack {\n  display: inline-block;\n  vertical-align: middle;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n  z-index: var(--fa-stack-z-index, auto);\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: var(--fa-inverse, #fff);\n}\n\n.sr-only,\n.fa-sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n\n.sr-only-focusable:not(:focus),\n.fa-sr-only-focusable:not(:focus) {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse,\n.fa-duotone.fa-inverse {\n  color: var(--fa-inverse, #fff);\n}';function at(){var I=mi,L=Di,j=Be.cssPrefix,ie=Be.replacementClass,we=Se;if(j!==I||ie!==L){var Je=new RegExp("\\.".concat(I,"\\-"),"g"),yt=new RegExp("\\--".concat(I,"\\-"),"g"),rn=new RegExp("\\.".concat(L),"g");we=we.replace(Je,".".concat(j,"-")).replace(yt,"--".concat(j,"-")).replace(rn,".".concat(ie))}return we}var St=!1;function nn(){Be.autoAddCss&&!St&&(function Oi(I){if(I&&Tn){var L=Xt.createElement("style");L.setAttribute("type","text/css"),L.innerHTML=I;for(var j=Xt.head.childNodes,ie=null,we=j.length-1;we>-1;we--){var Je=j[we],yt=(Je.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(yt)>-1&&(ie=Je)}Xt.head.insertBefore(L,ie)}}(at()),St=!0)}var bn={mixout:function(){return{dom:{css:at,insertCss:nn}}},hooks:function(){return{beforeDOMElementCreation:function(){nn()},beforeI2svg:function(){nn()}}}},Dn=Ot||{};Dn[Ke]||(Dn[Ke]={}),Dn[Ke].styles||(Dn[Ke].styles={}),Dn[Ke].hooks||(Dn[Ke].hooks={}),Dn[Ke].shims||(Dn[Ke].shims=[]);var Nn=Dn[Ke],Ei=[],er=!1;function Er(I){var L=I.tag,j=I.attributes,ie=void 0===j?{}:j,we=I.children,Je=void 0===we?[]:we;return"string"==typeof I?qe(I):"<".concat(L," ").concat(function Ge(I){return Object.keys(I||{}).reduce(function(L,j){return L+"".concat(j,'="').concat(qe(I[j]),'" ')},"").trim()}(ie),">").concat(Je.map(Er).join(""),"</").concat(L,">")}function zs(I,L,j){if(I&&I[L]&&I[L][j])return{prefix:L,iconName:j,icon:I[L][j]}}Tn&&((er=(Xt.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Xt.readyState))||Xt.addEventListener("DOMContentLoaded",function I(){Xt.removeEventListener("DOMContentLoaded",I),er=1,Ei.map(function(L){return L()})}));var zr=function(L,j,ie,we){var mn,Jn,Bn,Je=Object.keys(L),yt=Je.length,rn=void 0!==we?function(L,j){return function(ie,we,Je,yt){return L.call(j,ie,we,Je,yt)}}(j,we):j;for(void 0===ie?(mn=1,Bn=L[Je[0]]):(mn=0,Bn=ie);mn<yt;mn++)Bn=rn(Bn,L[Jn=Je[mn]],Jn,L);return Bn};function ds(I){var L=function ls(I){for(var L=[],j=0,ie=I.length;j<ie;){var we=I.charCodeAt(j++);if(we>=55296&&we<=56319&&j<ie){var Je=I.charCodeAt(j++);56320==(64512&Je)?L.push(((1023&we)<<10)+(1023&Je)+65536):(L.push(we),j--)}else L.push(we)}return L}(I);return 1===L.length?L[0].toString(16):null}function Os(I){return Object.keys(I).reduce(function(L,j){var ie=I[j];return ie.icon?L[ie.iconName]=ie.icon:L[j]=ie,L},{})}function e1(I,L){var ie=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipHooks,we=void 0!==ie&&ie,Je=Os(L);"function"!=typeof Nn.hooks.addPack||we?Nn.styles[I]=Xe(Xe({},Nn.styles[I]||{}),Je):Nn.hooks.addPack(I,Os(L)),"fas"===I&&e1("fa",L)}var qo,So,vi,qi=Nn.styles,Sr=Nn.shims,Pi=(gt(qo={},Ji,Object.values(it[Ji])),gt(qo,ir,Object.values(it[ir])),qo),Io=null,js={},sa={},ps={},Fs={},Vo={},br=(gt(So={},Ji,Object.keys(me[Ji])),gt(So,ir,Object.keys(me[ir])),So);var Yi=function(){var L=function(Je){return zr(qi,function(yt,rn,mn){return yt[mn]=zr(rn,Je,{}),yt},{})};js=L(function(we,Je,yt){return Je[3]&&(we[Je[3]]=yt),Je[2]&&Je[2].filter(function(mn){return"number"==typeof mn}).forEach(function(mn){we[mn.toString(16)]=yt}),we}),sa=L(function(we,Je,yt){return we[yt]=yt,Je[2]&&Je[2].filter(function(mn){return"string"==typeof mn}).forEach(function(mn){we[mn]=yt}),we}),Vo=L(function(we,Je,yt){var rn=Je[2];return we[yt]=yt,rn.forEach(function(mn){we[mn]=yt}),we});var j="far"in qi||Be.autoFetchSvg,ie=zr(Sr,function(we,Je){var yt=Je[0],rn=Je[1],mn=Je[2];return"far"===rn&&!j&&(rn="fas"),"string"==typeof yt&&(we.names[yt]={prefix:rn,iconName:mn}),"number"==typeof yt&&(we.unicodes[yt.toString(16)]={prefix:rn,iconName:mn}),we},{names:{},unicodes:{}});ps=ie.names,Fs=ie.unicodes,Io=_r(Be.styleDefault,{family:Be.familyDefault})};function tr(I,L){return(js[I]||{})[L]}function ho(I,L){return(Vo[I]||{})[L]}function rr(I){return ps[I]||{prefix:null,iconName:null}}function fo(){return Io}(function In(I){Tt.push(I)})(function(I){Io=_r(I.styleDefault,{family:Be.familyDefault})}),Yi();var _a=function(){return{prefix:null,iconName:null,rest:[]}};function _r(I){var j=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).family,ie=void 0===j?Ji:j;return He[ie][I]||He[ie][me[ie][I]]||(I in Nn.styles?I:null)||null}var vs=(gt(vi={},Ji,Object.keys(it[Ji])),gt(vi,ir,Object.keys(it[ir])),vi);function ci(I){var L,ie=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).skipLookups,we=void 0!==ie&&ie,Je=(gt(L={},Ji,"".concat(Be.cssPrefix,"-").concat(Ji)),gt(L,ir,"".concat(Be.cssPrefix,"-").concat(ir)),L),yt=null,rn=Ji;(I.includes(Je[Ji])||I.some(function(Jn){return vs[Ji].includes(Jn)}))&&(rn=Ji),(I.includes(Je[ir])||I.some(function(Jn){return vs[ir].includes(Jn)}))&&(rn=ir);var mn=I.reduce(function(Jn,Bn){var gi=function qn(I,L){var j=L.split("-"),ie=j[0],we=j.slice(1).join("-");return ie!==I||""===we||function ws(I){return~Xr.indexOf(I)}(we)?null:we}(Be.cssPrefix,Bn);if(qi[Bn]?(Bn=Pi[rn].includes(Bn)?zt[rn][Bn]:Bn,yt=Bn,Jn.prefix=Bn):br[rn].indexOf(Bn)>-1?(yt=Bn,Jn.prefix=_r(Bn,{family:rn})):gi?Jn.iconName=gi:Bn!==Be.replacementClass&&Bn!==Je[Ji]&&Bn!==Je[ir]&&Jn.rest.push(Bn),!we&&Jn.prefix&&Jn.iconName){var Zi="fa"===yt?rr(Jn.iconName):{},dr=ho(Jn.prefix,Jn.iconName);Zi.prefix&&(yt=null),Jn.iconName=Zi.iconName||dr||Jn.iconName,Jn.prefix=Zi.prefix||Jn.prefix,"far"===Jn.prefix&&!qi.far&&qi.fas&&!Be.autoFetchSvg&&(Jn.prefix="fas")}return Jn},_a());return(I.includes("fa-brands")||I.includes("fab"))&&(mn.prefix="fab"),(I.includes("fa-duotone")||I.includes("fad"))&&(mn.prefix="fad"),!mn.prefix&&rn===ir&&(qi.fass||Be.autoFetchSvg)&&(mn.prefix="fass",mn.iconName=ho(mn.prefix,mn.iconName)||mn.iconName),("fa"===mn.prefix||"fa"===yt)&&(mn.prefix=fo()||"fas"),mn}var eo=function(){function I(){(function de(I,L){if(!(I instanceof L))throw new TypeError("Cannot call a class as a function")})(this,I),this.definitions={}}return function qt(I,L,j){L&&Et(I.prototype,L),j&&Et(I,j),Object.defineProperty(I,"prototype",{writable:!1})}(I,[{key:"add",value:function(){for(var j=this,ie=arguments.length,we=new Array(ie),Je=0;Je<ie;Je++)we[Je]=arguments[Je];var yt=we.reduce(this._pullDefinitions,{});Object.keys(yt).forEach(function(rn){j.definitions[rn]=Xe(Xe({},j.definitions[rn]||{}),yt[rn]),e1(rn,yt[rn]);var mn=it[Ji][rn];mn&&e1(mn,yt[rn]),Yi()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(j,ie){var we=ie.prefix&&ie.iconName&&ie.icon?{0:ie}:ie;return Object.keys(we).map(function(Je){var yt=we[Je],rn=yt.prefix,mn=yt.iconName,Jn=yt.icon,Bn=Jn[2];j[rn]||(j[rn]={}),Bn.length>0&&Bn.forEach(function(gi){"string"==typeof gi&&(j[rn][gi]=Jn)}),j[rn][mn]=Jn}),j}}]),I}(),Ci=[],As={},Bi={},Vs=Object.keys(Bi);function Qn(I,L){for(var j=arguments.length,ie=new Array(j>2?j-2:0),we=2;we<j;we++)ie[we-2]=arguments[we];return(As[I]||[]).forEach(function(yt){L=yt.apply(null,[L].concat(ie))}),L}function Ls(I){for(var L=arguments.length,j=new Array(L>1?L-1:0),ie=1;ie<L;ie++)j[ie-1]=arguments[ie];(As[I]||[]).forEach(function(Je){Je.apply(null,j)})}function so(){var I=arguments[0],L=Array.prototype.slice.call(arguments,1);return Bi[I]?Bi[I].apply(null,L):void 0}function as(I){"fa"===I.prefix&&(I.prefix="fas");var L=I.iconName,j=I.prefix||fo();if(L)return L=ho(j,L)||L,zs(to.definitions,j,L)||zs(Nn.styles,j,L)}var to=new eo,Oo={i2svg:function(){var L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Tn?(Ls("beforeI2svg",L),so("pseudoElements2svg",L),so("i2svg",L)):Promise.reject("Operation requires a DOM of some kind.")},watch:function(){var L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},j=L.autoReplaceSvgRoot;!1===Be.autoReplaceSvg&&(Be.autoReplaceSvg=!0),Be.observeMutations=!0,function rs(I){Tn&&(er?setTimeout(I,0):Ei.push(I))}(function(){Fa({autoReplaceSvgRoot:j}),Ls("watch",L)})}},Ms={noAuto:function(){Be.autoReplaceSvg=!1,Be.observeMutations=!1,Ls("noAuto")},config:Be,dom:Oo,parse:{icon:function(L){if(null===L)return null;if("object"===s(L)&&L.prefix&&L.iconName)return{prefix:L.prefix,iconName:ho(L.prefix,L.iconName)||L.iconName};if(Array.isArray(L)&&2===L.length){var j=0===L[1].indexOf("fa-")?L[1].slice(3):L[1],ie=_r(L[0]);return{prefix:ie,iconName:ho(ie,j)||j}}if("string"==typeof L&&(L.indexOf("".concat(Be.cssPrefix,"-"))>-1||L.match(At))){var we=ci(L.split(" "),{skipLookups:!0});return{prefix:we.prefix||fo(),iconName:ho(we.prefix,we.iconName)||we.iconName}}if("string"==typeof L){var Je=fo();return{prefix:Je,iconName:ho(Je,L)||L}}}},library:to,findIconDefinition:as,toHtml:Er},Fa=function(){var j=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).autoReplaceSvgRoot,ie=void 0===j?Xt:j;(Object.keys(Nn.styles).length>0||Be.autoFetchSvg)&&Tn&&Be.autoReplaceSvg&&Ms.dom.i2svg({node:ie})};function oo(I,L){return Object.defineProperty(I,"abstract",{get:L}),Object.defineProperty(I,"html",{get:function(){return I.abstract.map(function(ie){return Er(ie)})}}),Object.defineProperty(I,"node",{get:function(){if(Tn){var ie=Xt.createElement("div");return ie.innerHTML=I.html,ie.children}}}),I}function oa(I){var L=I.icons,j=L.main,ie=L.mask,we=I.prefix,Je=I.iconName,yt=I.transform,rn=I.symbol,mn=I.title,Jn=I.maskId,Bn=I.titleId,gi=I.extra,Zi=I.watchable,dr=void 0!==Zi&&Zi,ji=ie.found?ie:j,wo=ji.width,No=ji.height,Bs="fak"===we,Ps=[Be.replacementClass,Je?"".concat(Be.cssPrefix,"-").concat(Je):""].filter(function(fa){return-1===gi.classes.indexOf(fa)}).filter(function(fa){return""!==fa||!!fa}).concat(gi.classes).join(" "),xs={children:[],attributes:Xe(Xe({},gi.attributes),{},{"data-prefix":we,"data-icon":Je,class:Ps,role:gi.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(wo," ").concat(No)})},uo=Bs&&!~gi.classes.indexOf("fa-fw")?{width:"".concat(wo/No*16*.0625,"em")}:{};dr&&(xs.attributes[Ii]=""),mn&&(xs.children.push({tag:"title",attributes:{id:xs.attributes["aria-labelledby"]||"title-".concat(Bn||Ht())},children:[mn]}),delete xs.attributes.title);var Uo=Xe(Xe({},xs),{},{prefix:we,iconName:Je,main:j,mask:ie,maskId:Jn,transform:yt,symbol:rn,styles:Xe(Xe({},uo),gi.styles)}),Za=ie.found&&j.found?so("generateAbstractMask",Uo)||{children:[],attributes:{}}:so("generateAbstractIcon",Uo)||{children:[],attributes:{}},ha=Za.attributes;return Uo.children=Za.children,Uo.attributes=ha,rn?function yo(I){var j=I.iconName,ie=I.children,we=I.attributes,Je=I.symbol,yt=!0===Je?"".concat(I.prefix,"-").concat(Be.cssPrefix,"-").concat(j):Je;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:Xe(Xe({},we),{},{id:yt}),children:ie}]}]}(Uo):function _1(I){var L=I.children,j=I.main,ie=I.mask,we=I.attributes,Je=I.styles,yt=I.transform;if(ke(yt)&&j.found&&!ie.found){var Jn={x:j.width/j.height/2,y:.5};we.style=ye(Xe(Xe({},Je),{},{"transform-origin":"".concat(Jn.x+yt.x/16,"em ").concat(Jn.y+yt.y/16,"em")}))}return[{tag:"svg",attributes:we,children:L}]}(Uo)}function za(I){var L=I.content,j=I.width,ie=I.height,we=I.transform,Je=I.title,yt=I.extra,rn=I.watchable,mn=void 0!==rn&&rn,Jn=Xe(Xe(Xe({},yt.attributes),Je?{title:Je}:{}),{},{class:yt.classes.join(" ")});mn&&(Jn[Ii]="");var Bn=Xe({},yt.styles);ke(we)&&(Bn.transform=function _e(I){var L=I.transform,j=I.width,we=I.height,Je=void 0===we?Bt:we,yt=I.startCentered,rn=void 0!==yt&&yt,mn="";return mn+=rn&&rt?"translate(".concat(L.x/vn-(void 0===j?Bt:j)/2,"em, ").concat(L.y/vn-Je/2,"em) "):rn?"translate(calc(-50% + ".concat(L.x/vn,"em), calc(-50% + ").concat(L.y/vn,"em)) "):"translate(".concat(L.x/vn,"em, ").concat(L.y/vn,"em) "),(mn+="scale(".concat(L.size/vn*(L.flipX?-1:1),", ").concat(L.size/vn*(L.flipY?-1:1),") "))+"rotate(".concat(L.rotate,"deg) ")}({transform:we,startCentered:!0,width:j,height:ie}),Bn["-webkit-transform"]=Bn.transform);var gi=ye(Bn);gi.length>0&&(Jn.style=gi);var Zi=[];return Zi.push({tag:"span",attributes:Jn,children:[L]}),Je&&Zi.push({tag:"span",attributes:{class:"sr-only"},children:[Je]}),Zi}var Fo=Nn.styles;function Xo(I){var L=I[0],j=I[1],Je=Gt(I.slice(4),1)[0];return{found:!0,width:L,height:j,icon:Array.isArray(Je)?{tag:"g",attributes:{class:"".concat(Be.cssPrefix,"-").concat(Fi.GROUP)},children:[{tag:"path",attributes:{class:"".concat(Be.cssPrefix,"-").concat(Fi.SECONDARY),fill:"currentColor",d:Je[0]}},{tag:"path",attributes:{class:"".concat(Be.cssPrefix,"-").concat(Fi.PRIMARY),fill:"currentColor",d:Je[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:Je}}}}var U1={found:!1,width:512,height:512};function va(I,L){var j=L;return"fa"===L&&null!==Be.styleDefault&&(L=fo()),new Promise(function(ie,we){if(so("missingIconAbstract"),"fa"===j){var yt=rr(I)||{};I=yt.iconName||I,L=yt.prefix||L}if(I&&L&&Fo[L]&&Fo[L][I])return ie(Xo(Fo[L][I]));(function Jo(I,L){!$r&&!Be.showMissingIcons&&I&&console.error('Icon with name "'.concat(I,'" and prefix "').concat(L,'" is missing.'))})(I,L),ie(Xe(Xe({},U1),{},{icon:Be.showMissingIcons&&I&&so("missingIconAbstract")||{}}))})}var cr=function(){},To=Be.measurePerformance&&Wi&&Wi.mark&&Wi.measure?Wi:{mark:cr,measure:cr},Ba='FA "6.5.1"',v1=function(L){To.mark("".concat(Ba," ").concat(L," ends")),To.measure("".concat(Ba," ").concat(L),"".concat(Ba," ").concat(L," begins"),"".concat(Ba," ").concat(L," ends"))},Qo={begin:function(L){return To.mark("".concat(Ba," ").concat(L," begins")),function(){return v1(L)}},end:v1},ao=function(){};function Ua(I){return"string"==typeof(I.getAttribute?I.getAttribute(Ii):null)}function ya(I){return Xt.createElementNS("http://www.w3.org/2000/svg",I)}function xo(I){return Xt.createElement(I)}function y1(I){var j=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ceFn,ie=void 0===j?"svg"===I.tag?ya:xo:j;if("string"==typeof I)return Xt.createTextNode(I);var we=ie(I.tag);return Object.keys(I.attributes||[]).forEach(function(yt){we.setAttribute(yt,I.attributes[yt])}),(I.children||[]).forEach(function(yt){we.appendChild(y1(yt,{ceFn:ie}))}),we}var Ds={replace:function(L){var j=L[0];if(j.parentNode)if(L[1].forEach(function(we){j.parentNode.insertBefore(y1(we),j)}),null===j.getAttribute(Ii)&&Be.keepOriginalSource){var ie=Xt.createComment(function x1(I){var L=" ".concat(I.outerHTML," ");return"".concat(L,"Font Awesome fontawesome.com ")}(j));j.parentNode.replaceChild(ie,j)}else j.remove()},nest:function(L){var j=L[0],ie=L[1];if(~_n(j).indexOf(Be.replacementClass))return Ds.replace(L);var we=new RegExp("".concat(Be.cssPrefix,"-.*"));if(delete ie[0].attributes.id,ie[0].attributes.class){var Je=ie[0].attributes.class.split(" ").reduce(function(rn,mn){return mn===Be.replacementClass||mn.match(we)?rn.toSvg.push(mn):rn.toNode.push(mn),rn},{toNode:[],toSvg:[]});ie[0].attributes.class=Je.toSvg.join(" "),0===Je.toNode.length?j.removeAttribute("class"):j.setAttribute("class",Je.toNode.join(" "))}var yt=ie.map(function(rn){return Er(rn)}).join("\n");j.setAttribute(Ii,""),j.innerHTML=yt}};function z1(I){I()}function bo(I,L){var j="function"==typeof L?L:ao;if(0===I.length)j();else{var ie=z1;Be.mutateApproach===Xi&&(ie=Ot.requestAnimationFrame||z1),ie(function(){var we=function Po(){return!0===Be.autoReplaceSvg?Ds.replace:Ds[Be.autoReplaceSvg]||Ds.replace}(),Je=Qo.begin("mutate");I.map(we),Je(),j()})}}var n1=!1;function r1(){n1=!0}function Ws(){n1=!1}var xa=null;function ea(I){if(Mi&&Be.observeMutations){var L=I.treeCallback,j=void 0===L?ao:L,ie=I.nodeCallback,we=void 0===ie?ao:ie,Je=I.pseudoElementsCallback,yt=void 0===Je?ao:Je,rn=I.observeMutationsRoot,mn=void 0===rn?Xt:rn;xa=new Mi(function(Jn){if(!n1){var Bn=fo();an(Jn).forEach(function(gi){if("childList"===gi.type&&gi.addedNodes.length>0&&!Ua(gi.addedNodes[0])&&(Be.searchPseudoElements&&yt(gi.target),j(gi.target)),"attributes"===gi.type&&gi.target.parentNode&&Be.searchPseudoElements&&yt(gi.target.parentNode),"attributes"===gi.type&&Ua(gi.target)&&~Zn.indexOf(gi.attributeName))if("class"===gi.attributeName&&function Ho(I){var L=I.getAttribute?I.getAttribute(Hr):null,j=I.getAttribute?I.getAttribute(Ur):null;return L&&j}(gi.target)){var Zi=ci(_n(gi.target)),ji=Zi.iconName;gi.target.setAttribute(Hr,Zi.prefix||Bn),ji&&gi.target.setAttribute(Ur,ji)}else(function j1(I){return I&&I.classList&&I.classList.contains&&I.classList.contains(Be.replacementClass)})(gi.target)&&we(gi.target)})}}),Tn&&xa.observe(mn,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function Rn(I){var L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{styleParser:!0},j=function Zo(I){var L=I.getAttribute("data-prefix"),j=I.getAttribute("data-icon"),ie=void 0!==I.innerText?I.innerText.trim():"",we=ci(_n(I));return we.prefix||(we.prefix=fo()),L&&j&&(we.prefix=L,we.iconName=j),we.iconName&&we.prefix||(we.prefix&&ie.length>0&&(we.iconName=function es(I,L){return(sa[I]||{})[L]}(we.prefix,I.innerText)||tr(we.prefix,ds(I.innerText))),!we.iconName&&Be.autoFetchSvg&&I.firstChild&&I.firstChild.nodeType===Node.TEXT_NODE&&(we.iconName=I.firstChild.data)),we}(I),ie=j.iconName,we=j.prefix,Je=j.rest,yt=function po(I){var L=an(I.attributes).reduce(function(we,Je){return"class"!==we.name&&"style"!==we.name&&(we[Je.name]=Je.value),we},{}),j=I.getAttribute("title"),ie=I.getAttribute("data-fa-title-id");return Be.autoA11y&&(j?L["aria-labelledby"]="".concat(Be.replacementClass,"-title-").concat(ie||Ht()):(L["aria-hidden"]="true",L.focusable="false")),L}(I),rn=Qn("parseNodeAttributes",{},I),mn=L.styleParser?function ja(I){var L=I.getAttribute("style"),j=[];return L&&(j=L.split(";").reduce(function(ie,we){var Je=we.split(":"),yt=Je[0],rn=Je.slice(1);return yt&&rn.length>0&&(ie[yt]=rn.join(":").trim()),ie},{})),j}(I):[];return Xe({iconName:ie,title:I.getAttribute("title"),titleId:I.getAttribute("data-fa-title-id"),prefix:we,transform:ei,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:Je,styles:mn,attributes:yt}},rn)}var s1=Nn.styles;function A1(I){var L="nest"===Be.autoReplaceSvg?Rn(I,{styleParser:!1}):Rn(I);return~L.extra.classes.indexOf(It)?so("generateLayersText",I,L):so("generateSvgReplacementMutation",I,L)}var lo=new Set;function Ga(I){var L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!Tn)return Promise.resolve();var j=Xt.documentElement.classList,ie=function(gi){return j.add("".concat(Si,"-").concat(gi))},we=function(gi){return j.remove("".concat(Si,"-").concat(gi))},Je=Be.autoFetchSvg?lo:jr.map(function(Bn){return"fa-".concat(Bn)}).concat(Object.keys(s1));Je.includes("fa")||Je.push("fa");var yt=[".".concat(It,":not([").concat(Ii,"])")].concat(Je.map(function(Bn){return".".concat(Bn,":not([").concat(Ii,"])")})).join(", ");if(0===yt.length)return Promise.resolve();var rn=[];try{rn=an(I.querySelectorAll(yt))}catch{}if(!(rn.length>0))return Promise.resolve();ie("pending"),we("complete");var mn=Qo.begin("onTree"),Jn=rn.reduce(function(Bn,gi){try{var Zi=A1(gi);Zi&&Bn.push(Zi)}catch(dr){$r||"MissingIcon"===dr.name&&console.error(dr)}return Bn},[]);return new Promise(function(Bn,gi){Promise.all(Jn).then(function(Zi){bo(Zi,function(){ie("active"),ie("complete"),we("pending"),"function"==typeof L&&L(),mn(),Bn()})}).catch(function(Zi){mn(),gi(Zi)})})}function aa(I){var L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;A1(I).then(function(j){j&&bo([j],L)})}jr.map(function(I){lo.add("fa-".concat(I))}),Object.keys(me[Ji]).map(lo.add.bind(lo)),Object.keys(me[ir]).map(lo.add.bind(lo)),lo=Kn(lo);var ca=function(L){var j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},ie=j.transform,we=void 0===ie?ei:ie,Je=j.symbol,yt=void 0!==Je&&Je,rn=j.mask,mn=void 0===rn?null:rn,Jn=j.maskId,Bn=void 0===Jn?null:Jn,gi=j.title,Zi=void 0===gi?null:gi,dr=j.titleId,ji=void 0===dr?null:dr,wo=j.classes,No=void 0===wo?[]:wo,Bs=j.attributes,Ps=void 0===Bs?{}:Bs,xs=j.styles,uo=void 0===xs?{}:xs;if(L){var Uo=L.prefix,Za=L.iconName,h1=L.icon;return oo(Xe({type:"icon"},L),function(){return Ls("beforeDOMElementCreation",{iconDefinition:L,params:j}),Be.autoA11y&&(Zi?Ps["aria-labelledby"]="".concat(Be.replacementClass,"-title-").concat(ji||Ht()):(Ps["aria-hidden"]="true",Ps.focusable="false")),oa({icons:{main:Xo(h1),mask:mn?Xo(mn.icon):{found:!1,width:null,height:null,icon:{}}},prefix:Uo,iconName:Za,transform:Xe(Xe({},ei),we),symbol:yt,title:Zi,maskId:Bn,titleId:ji,extra:{attributes:Ps,styles:uo,classes:No}})})}},la={mixout:function(){return{icon:(I=ca,function(L){var j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},ie=(L||{}).icon?L:as(L||{}),we=j.mask;return we&&(we=(we||{}).icon?we:as(we||{})),I(ie,Xe(Xe({},j),{},{mask:we}))})};var I},hooks:function(){return{mutationObserverCallbacks:function(j){return j.treeCallback=Ga,j.nodeCallback=aa,j}}},provides:function(L){L.i2svg=function(j){var ie=j.node,Je=j.callback;return Ga(void 0===ie?Xt:ie,void 0===Je?function(){}:Je)},L.generateSvgReplacementMutation=function(j,ie){var we=ie.iconName,Je=ie.title,yt=ie.titleId,rn=ie.prefix,mn=ie.transform,Jn=ie.symbol,Bn=ie.mask,gi=ie.maskId,Zi=ie.extra;return new Promise(function(dr,ji){Promise.all([va(we,rn),Bn.iconName?va(Bn.iconName,Bn.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(wo){var No=Gt(wo,2);dr([j,oa({icons:{main:No[0],mask:No[1]},prefix:rn,iconName:we,transform:mn,symbol:Jn,maskId:gi,title:Je,titleId:yt,extra:Zi,watchable:!0})])}).catch(ji)})},L.generateAbstractIcon=function(j){var Jn,ie=j.children,we=j.attributes,Je=j.main,yt=j.transform,mn=ye(j.styles);return mn.length>0&&(we.style=mn),ke(yt)&&(Jn=so("generateAbstractTransformGrouping",{main:Je,transform:yt,containerWidth:Je.width,iconWidth:Je.width})),ie.push(Jn||Je.icon),{children:ie,attributes:we}}}},G1={mixout:function(){return{layer:function(j){var ie=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},we=ie.classes,Je=void 0===we?[]:we;return oo({type:"layer"},function(){Ls("beforeDOMElementCreation",{assembler:j,params:ie});var yt=[];return j(function(rn){Array.isArray(rn)?rn.map(function(mn){yt=yt.concat(mn.abstract)}):yt=yt.concat(rn.abstract)}),[{tag:"span",attributes:{class:["".concat(Be.cssPrefix,"-layers")].concat(Kn(Je)).join(" ")},children:yt}]})}}}},$a={mixout:function(){return{counter:function(j){var ie=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},we=ie.title,Je=void 0===we?null:we,yt=ie.classes,rn=void 0===yt?[]:yt,mn=ie.attributes,Jn=void 0===mn?{}:mn,Bn=ie.styles,gi=void 0===Bn?{}:Bn;return oo({type:"counter",content:j},function(){return Ls("beforeDOMElementCreation",{content:j,params:ie}),function t1(I){var L=I.content,j=I.title,ie=I.extra,we=Xe(Xe(Xe({},ie.attributes),j?{title:j}:{}),{},{class:ie.classes.join(" ")}),Je=ye(ie.styles);Je.length>0&&(we.style=Je);var yt=[];return yt.push({tag:"span",attributes:we,children:[L]}),j&&yt.push({tag:"span",attributes:{class:"sr-only"},children:[j]}),yt}({content:j.toString(),title:Je,extra:{attributes:Jn,styles:gi,classes:["".concat(Be.cssPrefix,"-layers-counter")].concat(Kn(rn))}})})}}}},se={mixout:function(){return{text:function(j){var ie=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},we=ie.transform,Je=void 0===we?ei:we,yt=ie.title,rn=void 0===yt?null:yt,mn=ie.classes,Jn=void 0===mn?[]:mn,Bn=ie.attributes,gi=void 0===Bn?{}:Bn,Zi=ie.styles,dr=void 0===Zi?{}:Zi;return oo({type:"text",content:j},function(){return Ls("beforeDOMElementCreation",{content:j,params:ie}),za({content:j,transform:Xe(Xe({},ei),Je),title:rn,extra:{attributes:gi,styles:dr,classes:["".concat(Be.cssPrefix,"-layers-text")].concat(Kn(Jn))}})})}}},provides:function(L){L.generateLayersText=function(j,ie){var we=ie.title,Je=ie.transform,yt=ie.extra,rn=null,mn=null;if(rt){var Jn=parseInt(getComputedStyle(j).fontSize,10),Bn=j.getBoundingClientRect();rn=Bn.width/Jn,mn=Bn.height/Jn}return Be.autoA11y&&!we&&(yt.attributes["aria-hidden"]="true"),Promise.resolve([j,za({content:j.innerHTML,width:rn,height:mn,transform:Je,title:we,extra:yt,watchable:!0})])}}},ne=new RegExp('"',"ug"),X=[1105920,1112319];function lt(I,L){var j="".concat(Br).concat(L.replace(":","-"));return new Promise(function(ie,we){if(null!==I.getAttribute(j))return ie();var yt=an(I.children).filter(function(h1){return h1.getAttribute(Gi)===L})[0],rn=Ot.getComputedStyle(I,L),mn=rn.getPropertyValue("font-family").match(Hn),Jn=rn.getPropertyValue("font-weight"),Bn=rn.getPropertyValue("content");if(yt&&!mn)return I.removeChild(yt),ie();if(mn&&"none"!==Bn&&""!==Bn){var gi=rn.getPropertyValue("content"),Zi=~["Sharp"].indexOf(mn[2])?ir:Ji,dr=~["Solid","Regular","Light","Thin","Duotone","Brands","Kit"].indexOf(mn[2])?He[Zi][mn[2].toLowerCase()]:Qt[Zi][Jn],ji=function Ve(I){var L=I.replace(ne,""),j=function ro(I,L){var we,j=I.length,ie=I.charCodeAt(L);return ie>=55296&&ie<=56319&&j>L+1&&(we=I.charCodeAt(L+1))>=56320&&we<=57343?1024*(ie-55296)+we-56320+65536:ie}(L,0),ie=j>=X[0]&&j<=X[1],we=2===L.length&&L[0]===L[1];return{value:ds(we?L[0]:L),isSecondary:ie||we}}(gi),wo=ji.value,No=ji.isSecondary,Bs=mn[0].startsWith("FontAwesome"),Ps=tr(dr,wo),xs=Ps;if(Bs){var uo=function Cs(I){var L=Fs[I],j=tr("fas",I);return L||(j?{prefix:"fas",iconName:j}:null)||{prefix:null,iconName:null}}(wo);uo.iconName&&uo.prefix&&(Ps=uo.iconName,dr=uo.prefix)}if(!Ps||No||yt&&yt.getAttribute(Hr)===dr&&yt.getAttribute(Ur)===xs)ie();else{I.setAttribute(j,xs),yt&&I.removeChild(yt);var Uo=function Ss(){return{iconName:null,title:null,titleId:null,prefix:null,transform:ei,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}(),Za=Uo.extra;Za.attributes[Gi]=L,va(Ps,dr).then(function(h1){var ha=oa(Xe(Xe({},Uo),{},{icons:{main:h1,mask:_a()},prefix:dr,iconName:xs,extra:Za,watchable:!0})),fa=Xt.createElementNS("http://www.w3.org/2000/svg","svg");"::before"===L?I.insertBefore(fa,I.firstChild):I.appendChild(fa),fa.outerHTML=ha.map(function(r2){return Er(r2)}).join("\n"),I.removeAttribute(j),ie()}).catch(we)}}else ie()})}function jn(I){return Promise.all([lt(I,"::before"),lt(I,"::after")])}function ms(I){return!(I.parentNode===document.head||~Rs.indexOf(I.tagName.toUpperCase())||I.getAttribute(Gi)||I.parentNode&&"svg"===I.parentNode.tagName)}function Eo(I){if(Tn)return new Promise(function(L,j){var ie=an(I.querySelectorAll("*")).filter(ms).map(jn),we=Qo.begin("searchPseudoElements");r1(),Promise.all(ie).then(function(){we(),Ws(),L()}).catch(function(){we(),Ws(),j()})})}var o1=!1,qs=function(L){return L.toLowerCase().split(" ").reduce(function(ie,we){var Je=we.toLowerCase().split("-"),yt=Je[0],rn=Je.slice(1).join("-");if(yt&&"h"===rn)return ie.flipX=!0,ie;if(yt&&"v"===rn)return ie.flipY=!0,ie;if(rn=parseFloat(rn),isNaN(rn))return ie;switch(yt){case"grow":ie.size=ie.size+rn;break;case"shrink":ie.size=ie.size-rn;break;case"left":ie.x=ie.x-rn;break;case"right":ie.x=ie.x+rn;break;case"up":ie.y=ie.y-rn;break;case"down":ie.y=ie.y+rn;break;case"rotate":ie.rotate=ie.rotate+rn}return ie},{size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0})},Aa={x:0,y:0,width:"100%",height:"100%"};function a1(I){return I.attributes&&(I.attributes.fill||!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(I.attributes.fill="black"),I}!function Gs(I,L){var j=L.mixoutsTo;Ci=I,As={},Object.keys(Bi).forEach(function(ie){-1===Vs.indexOf(ie)&&delete Bi[ie]}),Ci.forEach(function(ie){var we=ie.mixout?ie.mixout():{};if(Object.keys(we).forEach(function(yt){"function"==typeof we[yt]&&(j[yt]=we[yt]),"object"===s(we[yt])&&Object.keys(we[yt]).forEach(function(rn){j[yt]||(j[yt]={}),j[yt][rn]=we[yt][rn]})}),ie.hooks){var Je=ie.hooks();Object.keys(Je).forEach(function(yt){As[yt]||(As[yt]=[]),As[yt].push(Je[yt])})}ie.provides&&ie.provides(Bi)})}([bn,la,G1,$a,se,{hooks:function(){return{mutationObserverCallbacks:function(j){return j.pseudoElementsCallback=Eo,j}}},provides:function(L){L.pseudoElements2svg=function(j){var ie=j.node;Be.searchPseudoElements&&Eo(void 0===ie?Xt:ie)}}},{mixout:function(){return{dom:{unwatch:function(){r1(),o1=!0}}}},hooks:function(){return{bootstrap:function(){ea(Qn("mutationObserverCallbacks",{}))},noAuto:function(){!function co(){xa&&xa.disconnect()}()},watch:function(j){var ie=j.observeMutationsRoot;o1?Ws():ea(Qn("mutationObserverCallbacks",{observeMutationsRoot:ie}))}}}},{mixout:function(){return{parse:{transform:function(j){return qs(j)}}}},hooks:function(){return{parseNodeAttributes:function(j,ie){var we=ie.getAttribute("data-fa-transform");return we&&(j.transform=qs(we)),j}}},provides:function(L){L.generateAbstractTransformGrouping=function(j){var ie=j.main,we=j.transform,yt=j.iconWidth,rn={transform:"translate(".concat(j.containerWidth/2," 256)")},mn="translate(".concat(32*we.x,", ").concat(32*we.y,") "),Jn="scale(".concat(we.size/16*(we.flipX?-1:1),", ").concat(we.size/16*(we.flipY?-1:1),") "),Bn="rotate(".concat(we.rotate," 0 0)"),dr={outer:rn,inner:{transform:"".concat(mn," ").concat(Jn," ").concat(Bn)},path:{transform:"translate(".concat(yt/2*-1," -256)")}};return{tag:"g",attributes:Xe({},dr.outer),children:[{tag:"g",attributes:Xe({},dr.inner),children:[{tag:ie.icon.tag,children:ie.icon.children,attributes:Xe(Xe({},ie.icon.attributes),dr.path)}]}]}}}},{hooks:function(){return{parseNodeAttributes:function(j,ie){var we=ie.getAttribute("data-fa-mask"),Je=we?ci(we.split(" ").map(function(yt){return yt.trim()})):_a();return Je.prefix||(Je.prefix=fo()),j.mask=Je,j.maskId=ie.getAttribute("data-fa-mask-id"),j}}},provides:function(L){L.generateAbstractMask=function(j){var I,ie=j.children,we=j.attributes,Je=j.main,yt=j.mask,rn=j.maskId,Bn=Je.icon,Zi=yt.icon,dr=function J(I){var L=I.transform,ie=I.iconWidth,we={transform:"translate(".concat(I.containerWidth/2," 256)")},Je="translate(".concat(32*L.x,", ").concat(32*L.y,") "),yt="scale(".concat(L.size/16*(L.flipX?-1:1),", ").concat(L.size/16*(L.flipY?-1:1),") "),rn="rotate(".concat(L.rotate," 0 0)");return{outer:we,inner:{transform:"".concat(Je," ").concat(yt," ").concat(rn)},path:{transform:"translate(".concat(ie/2*-1," -256)")}}}({transform:j.transform,containerWidth:yt.width,iconWidth:Je.width}),ji={tag:"rect",attributes:Xe(Xe({},Aa),{},{fill:"white"})},wo=Bn.children?{children:Bn.children.map(a1)}:{},No={tag:"g",attributes:Xe({},dr.inner),children:[a1(Xe({tag:Bn.tag,attributes:Xe(Xe({},Bn.attributes),dr.path)},wo))]},Bs={tag:"g",attributes:Xe({},dr.outer),children:[No]},Ps="mask-".concat(rn||Ht()),xs="clip-".concat(rn||Ht()),uo={tag:"mask",attributes:Xe(Xe({},Aa),{},{id:Ps,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[ji,Bs]},Uo={tag:"defs",children:[{tag:"clipPath",attributes:{id:xs},children:(I=Zi,"g"===I.tag?I.children:[I])},uo]};return ie.push(Uo,{tag:"rect",attributes:Xe({fill:"currentColor","clip-path":"url(#".concat(xs,")"),mask:"url(#".concat(Ps,")")},Aa)}),{children:ie,attributes:we}}}},{provides:function(L){var j=!1;Ot.matchMedia&&(j=Ot.matchMedia("(prefers-reduced-motion: reduce)").matches),L.missingIconAbstract=function(){var ie=[],we={fill:"currentColor"},Je={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};ie.push({tag:"path",attributes:Xe(Xe({},we),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var yt=Xe(Xe({},Je),{},{attributeName:"opacity"}),rn={tag:"circle",attributes:Xe(Xe({},we),{},{cx:"256",cy:"364",r:"28"}),children:[]};return j||rn.children.push({tag:"animate",attributes:Xe(Xe({},Je),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:Xe(Xe({},yt),{},{values:"1;0;1;1;0;1;"})}),ie.push(rn),ie.push({tag:"path",attributes:Xe(Xe({},we),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:j?[]:[{tag:"animate",attributes:Xe(Xe({},yt),{},{values:"1;0;0;0;0;1;"})}]}),j||ie.push({tag:"path",attributes:Xe(Xe({},we),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:Xe(Xe({},yt),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:ie}}}},{hooks:function(){return{parseNodeAttributes:function(j,ie){var we=ie.getAttribute("data-fa-symbol");return j.symbol=null!==we&&(""===we||we),j}}}}],{mixoutsTo:Ms});var La=Ms.parse,qa=Ms.icon,Yt=ue(1481);const Pn=["*"],na=I=>{const L={[`fa-${I.animation}`]:null!=I.animation&&!I.animation.startsWith("spin"),"fa-spin":"spin"===I.animation||"spin-reverse"===I.animation,"fa-spin-pulse":"spin-pulse"===I.animation||"spin-pulse-reverse"===I.animation,"fa-spin-reverse":"spin-reverse"===I.animation||"spin-pulse-reverse"===I.animation,"fa-pulse":"spin-pulse"===I.animation||"spin-pulse-reverse"===I.animation,"fa-fw":I.fixedWidth,"fa-border":I.border,"fa-inverse":I.inverse,"fa-layers-counter":I.counter,"fa-flip-horizontal":"horizontal"===I.flip||"both"===I.flip,"fa-flip-vertical":"vertical"===I.flip||"both"===I.flip,[`fa-${I.size}`]:null!==I.size,[`fa-rotate-${I.rotate}`]:null!==I.rotate,[`fa-pull-${I.pull}`]:null!==I.pull,[`fa-stack-${I.stackItemSize}`]:null!=I.stackItemSize};return Object.keys(L).map(j=>L[j]?j:null).filter(j=>j)};let ua=(()=>{class I{constructor(){this.defaultPrefix="fas",this.fallbackIcon=null}}return I.\u0275fac=function(j){return new(j||I)},I.\u0275prov=C.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})(),v2=(()=>{class I{constructor(){this.definitions={}}addIcons(...j){for(const ie of j){ie.prefix in this.definitions||(this.definitions[ie.prefix]={}),this.definitions[ie.prefix][ie.iconName]=ie;for(const we of ie.icon[2])"string"==typeof we&&(this.definitions[ie.prefix][we]=ie)}}addIconPacks(...j){for(const ie of j){const we=Object.keys(ie).map(Je=>ie[Je]);this.addIcons(...we)}}getIconDefinition(j,ie){return j in this.definitions&&ie in this.definitions[j]?this.definitions[j][ie]:null}}return I.\u0275fac=function(j){return new(j||I)},I.\u0275prov=C.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})(),zo=(()=>{class I{constructor(){this.stackItemSize="1x"}ngOnChanges(j){if("size"in j)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}return I.\u0275fac=function(j){return new(j||I)},I.\u0275dir=C.lG2({type:I,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[C.TTD]}),I})(),l1=(()=>{class I{constructor(j,ie){this.renderer=j,this.elementRef=ie}ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}ngOnChanges(j){"size"in j&&(null!=j.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,`fa-${j.size.currentValue}`),null!=j.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,`fa-${j.size.previousValue}`))}}return I.\u0275fac=function(j){return new(j||I)(C.Y36(C.Qsj),C.Y36(C.SBq))},I.\u0275cmp=C.Xpm({type:I,selectors:[["fa-stack"]],inputs:{size:"size"},features:[C.TTD],ngContentSelectors:Pn,decls:1,vars:0,template:function(j,ie){1&j&&(C.F$t(),C.Hsn(0))},encapsulation:2}),I})(),Zs=(()=>{class I{constructor(j,ie,we,Je,yt){this.sanitizer=j,this.config=ie,this.iconLibrary=we,this.stackItem=Je,this.classes=[],null!=yt&&null==Je&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}set spin(j){this.animation=j?"spin":void 0}set pulse(j){this.animation=j?"spin-pulse":void 0}ngOnChanges(j){if(null!=this.icon||null!=this.config.fallbackIcon){if(j){const we=this.findIconDefinition(null!=this.icon?this.icon:this.config.fallbackIcon);if(null!=we){const Je=this.buildParams();this.renderIcon(we,Je)}}}else(()=>{throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")})()}render(){this.ngOnChanges({})}findIconDefinition(j){const ie=((I,L)=>(I=>void 0!==I.prefix&&void 0!==I.iconName)(I)?I:"string"==typeof I?{prefix:L,iconName:I}:{prefix:I[0],iconName:I[1]})(j,this.config.defaultPrefix);return"icon"in ie?ie:this.iconLibrary.getIconDefinition(ie.prefix,ie.iconName)??((I=>{throw new Error(`Could not find icon with iconName=${I.iconName} and prefix=${I.prefix} in the icon library.`)})(ie),null)}buildParams(){const j={flip:this.flip,animation:this.animation,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},ie="string"==typeof this.transform?La.transform(this.transform):this.transform;return{title:this.title,transform:ie,classes:[...na(j),...this.classes],mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}renderIcon(j,ie){const we=qa(j,ie);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(we.html.join("\n"))}}return I.\u0275fac=function(j){return new(j||I)(C.Y36(Yt.H7),C.Y36(ua),C.Y36(v2),C.Y36(zo,8),C.Y36(l1,8))},I.\u0275cmp=C.Xpm({type:I,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(j,ie){2&j&&(C.Ikx("innerHTML",ie.renderedIconHTML,C.oJD),C.uIk("title",ie.title))},inputs:{icon:"icon",title:"title",animation:"animation",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",classes:"classes",transform:"transform",a11yRole:"a11yRole"},features:[C.TTD],decls:0,vars:0,template:function(j,ie){},encapsulation:2}),I})(),Z=(()=>{class I{}return I.\u0275fac=function(j){return new(j||I)},I.\u0275mod=C.oAB({type:I}),I.\u0275inj=C.cJS({}),I})()},2687:(yi,on,ue)=>{"use strict";ue.d(on,{$aW:()=>q8,EQ8:()=>D7,EyR:()=>B9,LM3:()=>l9,S5n:()=>a3,W7v:()=>Di,bMA:()=>Ag,cRF:()=>Q1,f8k:()=>ml,yOZ:()=>zn,yYj:()=>Qr});var Di={prefix:"fas",iconName:"circle-minus",icon:[512,512,["minus-circle"],"f056","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM184 232H328c13.3 0 24 10.7 24 24s-10.7 24-24 24H184c-13.3 0-24-10.7-24-24s10.7-24 24-24z"]},zn={prefix:"fas",iconName:"angle-right",icon:[320,512,[8250],"f105","M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"]},ml={prefix:"fas",iconName:"circle-check",icon:[512,512,[61533,"check-circle"],"f058","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"]},a3={prefix:"fas",iconName:"money-check",icon:[576,512,[],"f53c","M64 64C28.7 64 0 92.7 0 128V384c0 35.3 28.7 64 64 64H512c35.3 0 64-28.7 64-64V128c0-35.3-28.7-64-64-64H64zm48 160H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16zM96 336c0-8.8 7.2-16 16-16H464c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16zM376 160h80c13.3 0 24 10.7 24 24v48c0 13.3-10.7 24-24 24H376c-13.3 0-24-10.7-24-24V184c0-13.3 10.7-24 24-24z"]},q8={prefix:"fas",iconName:"trash",icon:[448,512,[],"f1f8","M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"]},Qr={prefix:"fas",iconName:"cart-shopping",icon:[576,512,[128722,"shopping-cart"],"f07a","M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"]},Q1={prefix:"fas",iconName:"sliders",icon:[512,512,["sliders-h"],"f1de","M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z"]},Ag={prefix:"fas",iconName:"cart-arrow-down",icon:[576,512,[],"f218","M24 0C10.7 0 0 10.7 0 24S10.7 48 24 48H69.5c3.8 0 7.1 2.7 7.9 6.5l51.6 271c6.5 34 36.2 58.5 70.7 58.5H488c13.3 0 24-10.7 24-24s-10.7-24-24-24H199.7c-11.5 0-21.4-8.2-23.6-19.5L170.7 288H459.2c32.6 0 61.1-21.8 69.5-53.3l41-152.3C576.6 57 557.4 32 531.1 32H360V134.1l23-23c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-64 64c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l23 23V32H120.1C111 12.8 91.6 0 69.5 0H24zM176 512a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm336-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0z"]},l9={prefix:"fas",iconName:"spinner",icon:[512,512,[],"f110","M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z"]},D7={prefix:"fas",iconName:"circle-plus",icon:[512,512,["plus-circle"],"f055","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344V280H168c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H280v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"]},B9={prefix:"fas",iconName:"angle-left",icon:[320,512,[8249],"f104","M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"]}},371:(yi,on,ue)=>{"use strict";ue.d(on,{Dg:()=>Gt,Fy:()=>hn,bB:()=>hi,o6:()=>Vn});var C=ue(1571),De=ue(6895),Xe=ue(1607);function s(Te,_t){if(1&Te){const Ue=C.EpF();C.TgZ(0,"li",7),C.NdJ("click",function(){const je=C.CHM(Ue).index,Ze=C.oxw(2);return C.KtG(Ze.selectSlide(je))}),C.qZA()}2&Te&&C.ekj("active",!0===_t.$implicit.active)}function ct(Te,_t){if(1&Te&&(C.ynx(0),C.TgZ(1,"ol",5),C.YNc(2,s,1,2,"li",6),C.qZA(),C.BQk()),2&Te){const Ue=C.oxw();C.xp6(2),C.Q6J("ngForOf",Ue.indicatorsSlides())}}function de(Te,_t){if(1&Te){const Ue=C.EpF();C.TgZ(0,"button",9),C.NdJ("click",function(){const je=C.CHM(Ue).index,Ze=C.oxw(2);return C.KtG(Ze.selectSlide(je))}),C.qZA()}if(2&Te){const Ue=_t.$implicit,Ye=_t.index,Pt=C.oxw(2);C.ekj("active",!0===Ue.active),C.uIk("data-bs-target","#carousel"+Pt.currentId)("data-bs-slide-to",Ye)}}function Et(Te,_t){if(1&Te&&(C.ynx(0),C.TgZ(1,"div",5),C.YNc(2,de,1,4,"button",8),C.qZA(),C.BQk()),2&Te){const Ue=C.oxw();C.xp6(2),C.Q6J("ngForOf",Ue.indicatorsSlides())}}function qt(Te,_t){if(1&Te){const Ue=C.EpF();C.TgZ(0,"a",10),C.NdJ("click",function(){C.CHM(Ue);const Pt=C.oxw();return C.KtG(Pt.previousSlide())}),C._UZ(1,"span",11),C.TgZ(2,"span",12),C._uU(3,"Previous"),C.qZA()()}if(2&Te){const Ue=C.oxw();C.ekj("disabled",Ue.checkDisabledClass("prev")),C.uIk("data-bs-target","#carousel"+Ue.currentId)}}function gt(Te,_t){if(1&Te){const Ue=C.EpF();C.TgZ(0,"a",13),C.NdJ("click",function(){C.CHM(Ue);const Pt=C.oxw();return C.KtG(Pt.nextSlide())}),C._UZ(1,"span",14),C.TgZ(2,"span",12),C._uU(3,"Next"),C.qZA()()}if(2&Te){const Ue=C.oxw();C.ekj("disabled",Ue.checkDisabledClass("next")),C.uIk("data-bs-target","#carousel"+Ue.currentId)}}const jt=function(Te){return{display:Te}},wt=["*"];let Gt=(()=>{class Te{constructor(){this.interval=5e3,this.noPause=!1,this.noWrap=!1,this.showIndicators=!0,this.pauseOnFocus=!1,this.indicatorsByChunk=!1,this.itemsPerSlide=1,this.singleSlideOffset=!1}}return Te.\u0275fac=function(Ue){return new(Ue||Te)},Te.\u0275prov=C.Yz7({token:Te,factory:Te.\u0275fac,providedIn:"root"}),Te})();var dn=(()=>{return(Te=dn||(dn={}))[Te.UNKNOWN=0]="UNKNOWN",Te[Te.NEXT=1]="NEXT",Te[Te.PREV=2]="PREV",dn;var Te})();let ii=1,hn=(()=>{class Te{constructor(Ue,Ye,Pt){this.ngZone=Ye,this.platformId=Pt,this.noWrap=!1,this.noPause=!1,this.showIndicators=!0,this.pauseOnFocus=!1,this.indicatorsByChunk=!1,this.itemsPerSlide=1,this.singleSlideOffset=!1,this.isAnimated=!1,this.activeSlideChange=new C.vpe(!1),this.slideRangeChange=new C.vpe,this.startFromIndex=0,this._interval=5e3,this._slides=new Xe.Su,this._currentVisibleSlidesIndex=0,this.isPlaying=!1,this.destroyed=!1,this.currentId=0,this.getActive=je=>je.active,this.makeSlidesConsistent=je=>{je.forEach((Ze,ot)=>Ze.item.order=ot)},Object.assign(this,Ue),this.currentId=ii++}set activeSlide(Ue){this.multilist||(function En(Te){return"number"==typeof Te||"[object Number]"===Object.prototype.toString.call(Te)}(Ue)&&(this.customActiveSlide=Ue),this._slides.length&&Ue!==this._currentActiveSlide&&this._select(Ue))}get activeSlide(){return this._currentActiveSlide||0}get interval(){return this._interval}set interval(Ue){this._interval=Ue,this.restartTimer()}get slides(){return this._slides.toArray()}get isFirstSlideVisible(){const Ue=this.getVisibleIndexes();return!(!Ue||Ue instanceof Array&&!Ue.length)&&Ue.includes(0)}get isLastSlideVisible(){const Ue=this.getVisibleIndexes();return!(!Ue||Ue instanceof Array&&!Ue.length)&&Ue.includes(this._slides.length-1)}get _bsVer(){return(0,Xe.Wl)()}ngAfterViewInit(){setTimeout(()=>{this.singleSlideOffset&&(this.indicatorsByChunk=!1),this.multilist&&(this._chunkedSlides=function Sn(Te,_t){const Ue=[],Ye=Math.ceil(Te.length/_t);let Pt=0;for(;Pt<Ye;){const je=Te.splice(0,Pt===Ye-1&&_t<Te.length?Te.length:_t);Ue.push(je),Pt++}return Ue}(this.mapSlidesAndIndexes(),this.itemsPerSlide),this.selectInitialSlides()),this.customActiveSlide&&!this.multilist&&this._select(this.customActiveSlide)},0)}ngOnDestroy(){this.destroyed=!0}addSlide(Ue){this._slides.add(Ue),this.multilist&&this._slides.length<=this.itemsPerSlide&&(Ue.active=!0),!this.multilist&&this.isAnimated&&(Ue.isAnimated=!0),!this.multilist&&1===this._slides.length&&(this._currentActiveSlide=void 0,this.customActiveSlide||(this.activeSlide=0),this.play()),this.multilist&&this._slides.length>this.itemsPerSlide&&this.play()}removeSlide(Ue){const Ye=this._slides.indexOf(Ue);if(this._currentActiveSlide===Ye){let Pt;this._slides.length>1&&(Pt=this.isLast(Ye)?this.noWrap?Ye-1:0:Ye),this._slides.remove(Ye),setTimeout(()=>{this._select(Pt)},0)}else{this._slides.remove(Ye);const Pt=this.getCurrentSlideIndex();setTimeout(()=>{this._currentActiveSlide=Pt,this.activeSlideChange.emit(this._currentActiveSlide)},0)}}nextSlideFromInterval(Ue=!1){this.move(dn.NEXT,Ue)}nextSlide(Ue=!1){this.isPlaying&&this.restartTimer(),this.move(dn.NEXT,Ue)}previousSlide(Ue=!1){this.isPlaying&&this.restartTimer(),this.move(dn.PREV,Ue)}getFirstVisibleIndex(){return this.slides.findIndex(this.getActive)}getLastVisibleIndex(){return function Kn(Te,_t){let Ue=Te.length;for(;Ue--;)if(_t(Te[Ue],Ue,Te))return Ue;return-1}(this.slides,this.getActive)}move(Ue,Ye=!1){const Pt=this.getFirstVisibleIndex(),je=this.getLastVisibleIndex();this.noWrap&&(Ue===dn.NEXT&&this.isLast(je)||Ue===dn.PREV&&0===Pt)||(this.multilist?this.moveMultilist(Ue):this.activeSlide=this.findNextSlideIndex(Ue,Ye)||0)}keydownPress(Ue){if(13===Ue.keyCode||"Enter"===Ue.key||32===Ue.keyCode||"Space"===Ue.key)return this.nextSlide(),void Ue.preventDefault();37!==Ue.keyCode&&"LeftArrow"!==Ue.key?39!==Ue.keyCode&&"RightArrow"!==Ue.key||this.nextSlide():this.previousSlide()}onMouseLeave(){this.pauseOnFocus||this.play()}onMouseUp(){this.pauseOnFocus||this.play()}pauseFocusIn(){this.pauseOnFocus&&(this.isPlaying=!1,this.resetTimer())}pauseFocusOut(){this.play()}selectSlide(Ue){this.isPlaying&&this.restartTimer(),this.multilist?this.selectSlideRange(this.indicatorsByChunk?Ue*this.itemsPerSlide:Ue):this.activeSlide=this.indicatorsByChunk?Ue*this.itemsPerSlide:Ue}play(){this.isPlaying||(this.isPlaying=!0,this.restartTimer())}pause(){this.noPause||(this.isPlaying=!1,this.resetTimer())}getCurrentSlideIndex(){return this._slides.findIndex(this.getActive)}isLast(Ue){return Ue+1>=this._slides.length}isFirst(Ue){return 0===Ue}indicatorsSlides(){return this.slides.filter((Ue,Ye)=>!this.indicatorsByChunk||Ye%this.itemsPerSlide==0)}selectInitialSlides(){const Ue=this.startFromIndex<=this._slides.length?this.startFromIndex:0;if(this.hideSlides(),this.singleSlideOffset){if(this._slidesWithIndexes=this.mapSlidesAndIndexes(),this._slides.length-Ue<this.itemsPerSlide){const Ye=this._slidesWithIndexes.slice(0,Ue);this._slidesWithIndexes=[...this._slidesWithIndexes,...Ye].slice(Ye.length).slice(0,this.itemsPerSlide)}else this._slidesWithIndexes=this._slidesWithIndexes.slice(Ue,Ue+this.itemsPerSlide);this._slidesWithIndexes.forEach(Ye=>Ye.item.active=!0),this.makeSlidesConsistent(this._slidesWithIndexes)}else this.selectRangeByNestedIndex(Ue);this.slideRangeChange.emit(this.getVisibleIndexes())}findNextSlideIndex(Ue,Ye){let Pt=0;if(Ye||!this.isLast(this.activeSlide)||Ue===dn.PREV||!this.noWrap){switch(Ue){case dn.NEXT:if(typeof this._currentActiveSlide>"u"){Pt=0;break}if(!this.isLast(this._currentActiveSlide)){Pt=this._currentActiveSlide+1;break}Pt=!Ye&&this.noWrap?this._currentActiveSlide:0;break;case dn.PREV:if(typeof this._currentActiveSlide>"u"){Pt=0;break}if(this._currentActiveSlide>0){Pt=this._currentActiveSlide-1;break}if(!Ye&&this.noWrap){Pt=this._currentActiveSlide;break}Pt=this._slides.length-1;break;default:throw new Error("Unknown direction")}return Pt}}mapSlidesAndIndexes(){return this.slides.slice().map((Ue,Ye)=>({index:Ye,item:Ue}))}selectSlideRange(Ue){if(!this.isIndexInRange(Ue)){if(this.hideSlides(),this.singleSlideOffset){const Ye=this.isIndexOnTheEdges(Ue)?Ue:Ue-this.itemsPerSlide+1,Pt=this.isIndexOnTheEdges(Ue)?Ue+this.itemsPerSlide:Ue+1;this._slidesWithIndexes=this.mapSlidesAndIndexes().slice(Ye,Pt),this.makeSlidesConsistent(this._slidesWithIndexes),this._slidesWithIndexes.forEach(je=>je.item.active=!0)}else this.selectRangeByNestedIndex(Ue);this.slideRangeChange.emit(this.getVisibleIndexes())}}selectRangeByNestedIndex(Ue){if(!this._chunkedSlides)return;const Ye=this._chunkedSlides.map((Pt,je)=>({index:je,list:Pt})).find(Pt=>void 0!==Pt.list.find(je=>je.index===Ue));Ye&&(this._currentVisibleSlidesIndex=Ye.index,this._chunkedSlides[Ye.index].forEach(Pt=>{Pt.item.active=!0}))}isIndexOnTheEdges(Ue){return Ue+1-this.itemsPerSlide<=0||Ue+this.itemsPerSlide<=this._slides.length}isIndexInRange(Ue){return this.singleSlideOffset&&this._slidesWithIndexes?this._slidesWithIndexes.map(Pt=>Pt.index).indexOf(Ue)>=0:Ue<=this.getLastVisibleIndex()&&Ue>=this.getFirstVisibleIndex()}hideSlides(){this.slides.forEach(Ue=>Ue.active=!1)}isVisibleSlideListLast(){return!!this._chunkedSlides&&this._currentVisibleSlidesIndex===this._chunkedSlides.length-1}isVisibleSlideListFirst(){return 0===this._currentVisibleSlidesIndex}moveSliderByOneItem(Ue){let Ye,Pt,je,Ze,ot;if(this.noWrap){Ye=this.getFirstVisibleIndex(),Pt=this.getLastVisibleIndex(),je=Ue===dn.NEXT?Ye:Pt,Ze=Ue!==dn.NEXT?Ye-1:this.isLast(Pt)?0:Pt+1;const pt=this._slides.get(je);pt&&(pt.active=!1);const Ot=this._slides.get(Ze);Ot&&(Ot.active=!0);const Xt=this.mapSlidesAndIndexes().filter(Mi=>Mi.item.active);return this.makeSlidesConsistent(Xt),this.singleSlideOffset&&(this._slidesWithIndexes=Xt),void this.slideRangeChange.emit(this.getVisibleIndexes())}if(this._slidesWithIndexes&&this._slidesWithIndexes[0]){if(Ye=this._slidesWithIndexes[0].index,Pt=this._slidesWithIndexes[this._slidesWithIndexes.length-1].index,Ue===dn.NEXT){this._slidesWithIndexes.shift(),ot=this.isLast(Pt)?0:Pt+1;const pt=this._slides.get(ot);pt&&this._slidesWithIndexes.push({index:ot,item:pt})}else{this._slidesWithIndexes.pop(),ot=this.isFirst(Ye)?this._slides.length-1:Ye-1;const pt=this._slides.get(ot);pt&&(this._slidesWithIndexes=[{index:ot,item:pt},...this._slidesWithIndexes])}this.hideSlides(),this._slidesWithIndexes.forEach(pt=>pt.item.active=!0),this.makeSlidesConsistent(this._slidesWithIndexes),this.slideRangeChange.emit(this._slidesWithIndexes.map(pt=>pt.index))}}moveMultilist(Ue){this.singleSlideOffset?this.moveSliderByOneItem(Ue):(this.hideSlides(),this._currentVisibleSlidesIndex=this.noWrap?Ue===dn.NEXT?this._currentVisibleSlidesIndex+1:this._currentVisibleSlidesIndex-1:Ue===dn.NEXT?this.isVisibleSlideListLast()?0:this._currentVisibleSlidesIndex+1:this.isVisibleSlideListFirst()?this._chunkedSlides?this._chunkedSlides.length-1:0:this._currentVisibleSlidesIndex-1,this._chunkedSlides&&this._chunkedSlides[this._currentVisibleSlidesIndex].forEach(Ye=>Ye.item.active=!0),this.slideRangeChange.emit(this.getVisibleIndexes()))}getVisibleIndexes(){return!this.singleSlideOffset&&this._chunkedSlides?this._chunkedSlides[this._currentVisibleSlidesIndex].map(Ue=>Ue.index):this._slidesWithIndexes?this._slidesWithIndexes.map(Ue=>Ue.index):void 0}_select(Ue){if(isNaN(Ue))return void this.pause();if(!this.multilist&&typeof this._currentActiveSlide<"u"){const Pt=this._slides.get(this._currentActiveSlide);typeof Pt<"u"&&(Pt.active=!1)}const Ye=this._slides.get(Ue);typeof Ye<"u"&&(this._currentActiveSlide=Ue,Ye.active=!0,this.activeSlide=Ue,this.activeSlideChange.emit(Ue))}restartTimer(){this.resetTimer();const Ue=+this.interval;!isNaN(Ue)&&Ue>0&&(0,De.NF)(this.platformId)&&(this.currentInterval=this.ngZone.runOutsideAngular(()=>window.setInterval(()=>{const Ye=+this.interval;this.ngZone.run(()=>{this.isPlaying&&!isNaN(this.interval)&&Ye>0&&this.slides.length?this.nextSlideFromInterval():this.pause()})},Ue)))}get multilist(){return this.itemsPerSlide>1}resetTimer(){this.currentInterval&&(clearInterval(this.currentInterval),this.currentInterval=void 0)}checkDisabledClass(Ue){return"prev"===Ue?0===this.activeSlide&&this.noWrap&&!this.multilist||this.isFirstSlideVisible&&this.noWrap&&this.multilist:this.isLast(this.activeSlide)&&this.noWrap&&!this.multilist||this.isLastSlideVisible&&this.noWrap&&this.multilist}}return Te.\u0275fac=function(Ue){return new(Ue||Te)(C.Y36(Gt),C.Y36(C.R0b),C.Y36(C.Lbi))},Te.\u0275cmp=C.Xpm({type:Te,selectors:[["carousel"]],inputs:{noWrap:"noWrap",noPause:"noPause",showIndicators:"showIndicators",pauseOnFocus:"pauseOnFocus",indicatorsByChunk:"indicatorsByChunk",itemsPerSlide:"itemsPerSlide",singleSlideOffset:"singleSlideOffset",isAnimated:"isAnimated",activeSlide:"activeSlide",startFromIndex:"startFromIndex",interval:"interval"},outputs:{activeSlideChange:"activeSlideChange",slideRangeChange:"slideRangeChange"},ngContentSelectors:wt,decls:7,vars:8,consts:[["tabindex","0",1,"carousel","slide",3,"id","mouseenter","mouseleave","mouseup","keydown","focusin","focusout"],[4,"ngIf"],[1,"carousel-inner",3,"ngStyle"],["class","left carousel-control carousel-control-prev","href","javascript:void(0);","tabindex","0","role","button",3,"disabled","click",4,"ngIf"],["class","right carousel-control carousel-control-next","href","javascript:void(0);","tabindex","0","role","button",3,"disabled","click",4,"ngIf"],[1,"carousel-indicators"],[3,"active","click",4,"ngFor","ngForOf"],[3,"click"],["type","button","aria-current","true",3,"active","click",4,"ngFor","ngForOf"],["type","button","aria-current","true",3,"click"],["href","javascript:void(0);","tabindex","0","role","button",1,"left","carousel-control","carousel-control-prev",3,"click"],["aria-hidden","true",1,"icon-prev","carousel-control-prev-icon"],[1,"sr-only","visually-hidden"],["href","javascript:void(0);","tabindex","0","role","button",1,"right","carousel-control","carousel-control-next",3,"click"],["aria-hidden","true",1,"icon-next","carousel-control-next-icon"]],template:function(Ue,Ye){1&Ue&&(C.F$t(),C.TgZ(0,"div",0),C.NdJ("mouseenter",function(){return Ye.pause()})("mouseleave",function(){return Ye.onMouseLeave()})("mouseup",function(){return Ye.onMouseUp()})("keydown",function(je){return Ye.keydownPress(je)})("focusin",function(){return Ye.pauseFocusIn()})("focusout",function(){return Ye.pauseFocusOut()}),C.YNc(1,ct,3,1,"ng-container",1),C.YNc(2,Et,3,1,"ng-container",1),C.TgZ(3,"div",2),C.Hsn(4),C.qZA(),C.YNc(5,qt,4,3,"a",3),C.YNc(6,gt,4,3,"a",4),C.qZA()),2&Ue&&(C.Q6J("id","carousel"+Ye.currentId),C.xp6(1),C.Q6J("ngIf",!Ye._bsVer.isBs5&&Ye.showIndicators&&Ye.slides.length>1),C.xp6(1),C.Q6J("ngIf",Ye._bsVer.isBs5&&Ye.showIndicators&&Ye.slides.length>1),C.xp6(1),C.Q6J("ngStyle",C.VKq(6,jt,Ye.multilist?"flex":"block")),C.xp6(2),C.Q6J("ngIf",Ye.slides.length>1),C.xp6(1),C.Q6J("ngIf",Ye.slides.length>1))},dependencies:[De.sg,De.O5,De.PC],encapsulation:2}),Te})(),Vn=(()=>{class Te{constructor(Ue){this.active=!1,this.itemWidth="100%",this.order=0,this.isAnimated=!1,this.addClass=!0,this.multilist=!1,this.carousel=Ue}ngOnInit(){this.carousel.addSlide(this),this.itemWidth=100/this.carousel.itemsPerSlide+"%",this.multilist=this.carousel?.itemsPerSlide>1}ngOnDestroy(){this.carousel.removeSlide(this)}}return Te.\u0275fac=function(Ue){return new(Ue||Te)(C.Y36(hn))},Te.\u0275cmp=C.Xpm({type:Te,selectors:[["slide"]],hostVars:15,hostBindings:function(Ue,Ye){2&Ue&&(C.uIk("aria-hidden",!Ye.active),C.Udp("width",Ye.itemWidth)("order",Ye.order),C.ekj("multilist-margin",Ye.multilist)("active",Ye.active)("carousel-animation",Ye.isAnimated)("item",Ye.addClass)("carousel-item",Ye.addClass))},inputs:{active:"active"},ngContentSelectors:wt,decls:2,vars:2,consts:[[1,"item"]],template:function(Ue,Ye){1&Ue&&(C.F$t(),C.TgZ(0,"div",0),C.Hsn(1),C.qZA()),2&Ue&&C.ekj("active",Ye.active)},styles:[".carousel-animation[_nghost-%COMP%]{transition:opacity .6s ease,visibility .6s ease;float:left}.carousel-animation.active[_nghost-%COMP%]{opacity:1;visibility:visible}.carousel-animation[_nghost-%COMP%]:not(.active){display:block;position:absolute;opacity:0;visibility:hidden}.multilist-margin[_nghost-%COMP%]{margin-right:auto}.carousel-item[_nghost-%COMP%]{perspective:1000px}"]}),Te})(),hi=(()=>{class Te{static forRoot(){return{ngModule:Te,providers:[]}}}return Te.\u0275fac=function(Ue){return new(Ue||Te)},Te.\u0275mod=C.oAB({type:Te}),Te.\u0275inj=C.cJS({imports:[De.ez]}),Te})()},7817:(yi,on,ue)=>{"use strict";ue.d(on,{TO:()=>qe,Hz:()=>Ge,mr:()=>ke,Mq:()=>ye});var C=ue(1571),De=ue(9300),Xe=ue(1607),s=ue(6895),ct=ue(7579),de=ue(6451),Et=ue(8421),qt=ue(9751),gt=ue(5577),jt=ue(1144),wt=ue(576),Gt=ue(3268);const Kn=["addListener","removeListener"],Sn=["addEventListener","removeEventListener"],En=["on","off"];function dn(J,_e,Se,at){if((0,wt.m)(Se)&&(at=Se,Se=void 0),at)return dn(J,_e,Se).pipe((0,Gt.Z)(at));const[St,nn]=function hi(J){return(0,wt.m)(J.addEventListener)&&(0,wt.m)(J.removeEventListener)}(J)?Sn.map(bn=>Dn=>J[bn](_e,Dn,Se)):function hn(J){return(0,wt.m)(J.addListener)&&(0,wt.m)(J.removeListener)}(J)?Kn.map(ii(J,_e)):function Vn(J){return(0,wt.m)(J.on)&&(0,wt.m)(J.off)}(J)?En.map(ii(J,_e)):[];if(!St&&(0,jt.z)(J))return(0,gt.z)(bn=>dn(bn,_e,Se))((0,Et.Xf)(J));if(!St)throw new TypeError("Invalid event target");return new qt.y(bn=>{const Dn=(...Nn)=>bn.next(1<Nn.length?Nn:Nn[0]);return St(Dn),()=>nn(Dn)})}function ii(J,_e){return Se=>at=>J[Se](_e,at)}var Te=ue(9646),_t=ue(4408),Ue=ue(727);const Ye={schedule(J){let _e=requestAnimationFrame,Se=cancelAnimationFrame;const{delegate:at}=Ye;at&&(_e=at.requestAnimationFrame,Se=at.cancelAnimationFrame);const St=_e(nn=>{Se=void 0,J(nn)});return new Ue.w0(()=>Se?.(St))},requestAnimationFrame(...J){const{delegate:_e}=Ye;return(_e?.requestAnimationFrame||requestAnimationFrame)(...J)},cancelAnimationFrame(...J){const{delegate:_e}=Ye;return(_e?.cancelAnimationFrame||cancelAnimationFrame)(...J)},delegate:void 0};var je=ue(7565);const ot=new class Ze extends je.v{flush(_e){this._active=!0;const Se=this._scheduled;this._scheduled=void 0;const{actions:at}=this;let St;_e=_e||at.shift();do{if(St=_e.execute(_e.state,_e.delay))break}while((_e=at[0])&&_e.id===Se&&at.shift());if(this._active=!1,St){for(;(_e=at[0])&&_e.id===Se&&at.shift();)_e.unsubscribe();throw St}}}(class Pt extends _t.o{constructor(_e,Se){super(_e,Se),this.scheduler=_e,this.work=Se}requestAsyncId(_e,Se,at=0){return null!==at&&at>0?super.requestAsyncId(_e,Se,at):(_e.actions.push(this),_e._scheduled||(_e._scheduled=Ye.requestAnimationFrame(()=>_e.flush(void 0))))}recycleAsyncId(_e,Se,at=0){var St;if(null!=at?at>0:this.delay>0)return super.recycleAsyncId(_e,Se,at);const{actions:nn}=_e;null!=Se&&(null===(St=nn[nn.length-1])||void 0===St?void 0:St.id)!==Se&&(Ye.cancelAnimationFrame(Se),_e._scheduled=void 0)}});var Ot=(()=>{return(J=Ot||(Ot={})).top="top",J.bottom="bottom",J.left="left",J.right="right",J.auto="auto",J.end="right",J.start="left",J["top left"]="top left",J["top right"]="top right",J["right top"]="right top",J["right bottom"]="right bottom",J["bottom right"]="bottom right",J["bottom left"]="bottom left",J["left bottom"]="left bottom",J["left top"]="left top",J["top start"]="top left",J["top end"]="top right",J["end top"]="right top",J["end bottom"]="right bottom",J["bottom end"]="bottom right",J["bottom start"]="bottom left",J["start bottom"]="start bottom",J["start top"]="left top",Ot;var J})(),Xt=(()=>{return(J=Xt||(Xt={})).top="top",J.bottom="bottom",J.left="start",J.right="end",J.auto="auto",J.end="end",J.start="start",J["top left"]="top start",J["top right"]="top end",J["right top"]="end top",J["right bottom"]="end bottom",J["bottom right"]="bottom end",J["bottom left"]="bottom start",J["left bottom"]="start bottom",J["left top"]="start top",J["top start"]="top start",J["top end"]="top end",J["end top"]="end top",J["end bottom"]="end bottom",J["bottom end"]="bottom end",J["bottom start"]="bottom start",J["start bottom"]="start bottom",J["start top"]="start top",Xt;var J})();function Mi(J,_e){if(1!==J.nodeType)return[];const at=J.ownerDocument.defaultView?.getComputedStyle(J,null);return _e?at&&at[_e]:at}function Wi(J){if(!J)return document.documentElement;let at,Se=J?.offsetParent;for(;null===Se&&J.nextElementSibling&&at!==J.nextElementSibling;)at=J.nextElementSibling,Se=at.offsetParent;const St=Se&&Se.nodeName;return St&&"BODY"!==St&&"HTML"!==St?Se&&-1!==["TH","TD","TABLE"].indexOf(Se.nodeName)&&"static"===Mi(Se,"position")?Wi(Se):Se:at?at.ownerDocument.documentElement:document.documentElement}function Tn(J){return null!==J.parentNode?Tn(J.parentNode):J}function rt(J,_e){if(!(J&&J.nodeType&&_e&&_e.nodeType))return document.documentElement;const Se=J.compareDocumentPosition(_e)&Node.DOCUMENT_POSITION_FOLLOWING,at=Se?J:_e,St=Se?_e:J,nn=document.createRange();nn.setStart(at,0),nn.setEnd(St,0);const bn=nn.commonAncestorContainer;if(J!==bn&&_e!==bn||at.contains(St))return function ti(J){const{nodeName:_e}=J;return"BODY"!==_e&&("HTML"===_e||Wi(J.firstElementChild)===J)}(bn)?bn:Wi(bn);const Dn=Tn(J);return Dn.host?rt(Dn.host,_e):rt(J,Tn(_e).host)}function xt(J){if(!J||!J.parentElement)return document.documentElement;let _e=J.parentElement;for(;_e?.parentElement&&"none"===Mi(_e,"transform");)_e=_e.parentElement;return _e||document.documentElement}function ht(J,_e){const Se="x"===_e?"Left":"Top",at="Left"===Se?"Right":"Bottom";return parseFloat(J[`border${Se}Width`])+parseFloat(J[`border${at}Width`])}function st(J,_e,Se,at){return Math.max(_e[`offset${J}`],_e[`scroll${J}`],Se[`client${J}`],Se[`offset${J}`],Se[`scroll${J}`],0)}function Ne(J){const _e=J.body,Se=J.documentElement;return{height:st("Height",_e,Se),width:st("Width",_e,Se)}}function Pe(J){return{...J,right:(J.left||0)+J.width,bottom:(J.top||0)+J.height}}function Bt(J){return"number"==typeof J||"[object Number]"===Object.prototype.toString.call(J)}function mi(J){const _e=J.getBoundingClientRect();if(!(_e&&Bt(_e.top)&&Bt(_e.left)&&Bt(_e.bottom)&&Bt(_e.right)))return _e;const Se={left:_e.left,top:_e.top,width:_e.right-_e.left,height:_e.bottom-_e.top},at="HTML"===J.nodeName?Ne(J.ownerDocument):void 0,St=at?.width||J.clientWidth||Bt(_e.right)&&Bt(Se.left)&&_e.right-Se.left||0,nn=at?.height||J.clientHeight||Bt(_e.bottom)&&Bt(Se.top)&&_e.bottom-Se.top||0;let bn=J.offsetWidth-St,Dn=J.offsetHeight-nn;if(bn||Dn){const Nn=Mi(J);bn-=ht(Nn,"x"),Dn-=ht(Nn,"y"),Se.width-=bn,Se.height-=Dn}return Pe(Se)}function Di(J){return"HTML"===J.nodeName?J:J.parentNode||J.host}function Ii(J){if(!J)return document.body;switch(J.nodeName){case"HTML":case"BODY":return J.ownerDocument.body;case"#document":return J.body}const{overflow:_e,overflowX:Se,overflowY:at}=Mi(J);return/(auto|scroll|overlay)/.test(String(_e)+String(at)+String(Se))?J:Ii(Di(J))}function Gi(J,_e,Se=!1){const at="HTML"===_e.nodeName,St=mi(J),nn=mi(_e),Dn=(Ii(J),Mi(_e)),Nn=parseFloat(Dn.borderTopWidth),Ei=parseFloat(Dn.borderLeftWidth);Se&&at&&(nn.top=Math.max(nn.top??0,0),nn.left=Math.max(nn.left??0,0));const si=Pe({top:(St.top??0)-(nn.top??0)-Nn,left:(St.left??0)-(nn.left??0)-Ei,width:St.width,height:St.height});if(si.marginTop=0,si.marginLeft=0,at){const er=parseFloat(Dn.marginTop),rs=parseFloat(Dn.marginLeft);Bt(si.top)&&(si.top-=Nn-er),Bt(si.bottom)&&(si.bottom-=Nn-er),Bt(si.left)&&(si.left-=Ei-rs),Bt(si.right)&&(si.right-=Ei-rs),si.marginTop=er,si.marginLeft=rs}return si}function Br(J,_e="top"){const Se="top"===_e?"scrollTop":"scrollLeft",at=J.nodeName;return"BODY"===at||"HTML"===at?(J.ownerDocument.scrollingElement||J.ownerDocument.documentElement)[Se]:J[Se]}function Ur(J){const _e=J.nodeName;return"BODY"!==_e&&"HTML"!==_e&&("fixed"===Mi(J,"position")||Ur(Di(J)))}function Si(J,_e,Se=0,at,St=!1){let nn={top:0,left:0};const bn=St?xt(J):rt(J,_e);if("viewport"===at)nn=function Hr(J,_e=!1){const Se=J.ownerDocument.documentElement,at=Gi(J,Se),St=Math.max(Se.clientWidth,window.innerWidth||0),nn=Math.max(Se.clientHeight,window.innerHeight||0),bn=_e?0:Br(Se),Dn=_e?0:Br(Se,"left");return Pe({top:bn-Number(at?.top)+Number(at?.marginTop),left:Dn-Number(at?.left)+Number(at?.marginLeft),width:St,height:nn})}(bn,St);else{let Dn;"scrollParent"===at?(Dn=Ii(Di(_e)),"BODY"===Dn.nodeName&&(Dn=J.ownerDocument.documentElement)):Dn="window"===at?J.ownerDocument.documentElement:at;const Nn=Gi(Dn,bn,St);if(Nn&&"HTML"===Dn.nodeName&&!Ur(bn)){const{height:Ei,width:si}=Ne(J.ownerDocument);Bt(nn.top)&&Bt(Nn.top)&&Bt(Nn.marginTop)&&(nn.top+=Nn.top-Nn.marginTop),Bt(nn.top)&&(nn.bottom=Number(Ei)+Number(Nn.top)),Bt(nn.left)&&Bt(Nn.left)&&Bt(Nn.marginLeft)&&(nn.left+=Nn.left-Nn.marginLeft),Bt(nn.top)&&(nn.right=Number(si)+Number(Nn.left))}else Nn&&(nn=Nn)}return Bt(nn.left)&&(nn.left+=Se),Bt(nn.top)&&(nn.top+=Se),Bt(nn.right)&&(nn.right-=Se),Bt(nn.bottom)&&(nn.bottom-=Se),nn}function Xi({width:J,height:_e}){return J*_e}function Rs(J,_e,Se,at,St=["top","bottom","right","left"],nn="viewport",bn=0){if(-1===J.indexOf("auto"))return J;const Dn=Si(Se,at,bn,nn),Nn={top:{width:Dn?.width??0,height:(_e?.top??0)-(Dn?.top??0)},right:{width:(Dn?.right??0)-(_e?.right??0),height:Dn?.height??0},bottom:{width:Dn?.width??0,height:(Dn?.bottom??0)-(_e?.bottom??0)},left:{width:(_e.left??0)-(Dn?.left??0),height:Dn?.height??0}},Ei=Object.keys(Nn).map(Er=>({position:Er,...Nn[Er],area:Xi(Nn[Er])})).sort((Er,zs)=>zs.area-Er.area);let si=Ei.filter(({width:Er,height:zs})=>Er>=Se.clientWidth&&zs>=Se.clientHeight);si=si.filter(({position:Er})=>St.some(zs=>zs===Er));const er=si.length>0?si[0].position:Ei[0].position,rs=J.split(" ")[1];return Se.className=Se.className.replace(/bs-tooltip-auto/g,`bs-tooltip-${(0,Xe.Wl)().isBs5?Xt[er]:er}`),er+(rs?`-${rs}`:"")}const jr=(J,_e=0)=>J?parseFloat(J):_e;function sn(J){const Se=J.ownerDocument.defaultView?.getComputedStyle(J),at=jr(Se?.marginTop)+jr(Se?.marginBottom),St=jr(Se?.marginLeft)+jr(Se?.marginRight);return{width:Number(J.offsetWidth)+St,height:Number(J.offsetHeight)+at}}function me(J,_e,Se){return Gi(_e,Se?xt(J):rt(J,_e),Se)}function He(J,_e,Se){const at=Se.split(" ")[0],St=sn(J),nn={width:St.width,height:St.height},bn=-1!==["right","left"].indexOf(at),Dn=bn?"top":"left",Nn=bn?"left":"top",Ei=bn?"height":"width",si=bn?"width":"height";return nn[Dn]=(_e[Dn]??0)+_e[Ei]/2-St[Ei]/2,nn[Nn]=at===Nn?(_e[Nn]??0)-St[si]:_e[function Ji(J){const _e={left:"right",right:"left",bottom:"top",top:"bottom"};return J.replace(/left|right|bottom|top/g,Se=>_e[Se])}(Nn)]??0,nn}function it(J,_e){return!!J.modifiers[_e]?.enabled}const zt={top:["top","top start","top end"],bottom:["bottom","bottom start","bottom end"],start:["start","start top","start bottom"],end:["end","end top","end bottom"]};function At(J,_e){return!!(0,Xe.Wl)().isBs5&&zt[_e].includes(J)}function Qt(J,_e,Se){!J||!_e||Object.keys(_e).forEach(at=>{let St="";-1!==["width","height","top","right","bottom","left"].indexOf(at)&&function Ke(J){return""!==J&&!isNaN(parseFloat(J))&&isFinite(Number(J))}(_e[at])&&(St="px"),Se?Se.setStyle(J,at,`${String(_e[at])}${St}`):J.style[at]=String(_e[at])+St})}function $n(J){let _e=J.offsets.target;const Se=J.instance.target.querySelector(".arrow");if(!Se)return J;const at=-1!==["left","right"].indexOf(J.placement.split(" ")[0]),St=at?"height":"width",nn=at?"Top":"Left",bn=nn.toLowerCase(),Dn=at?"left":"top",Nn=at?"bottom":"right",Ei=sn(Se)[St],si=J.placement.split(" ")[1];(J.offsets.host[Nn]??0)-Ei<(_e[bn]??0)&&(_e[bn]-=(_e[bn]??0)-((J.offsets.host[Nn]??0)-Ei)),Number(J.offsets.host[bn])+Number(Ei)>(_e[Nn]??0)&&(_e[bn]+=Number(J.offsets.host[bn])+Number(Ei)-Number(_e[Nn])),_e=Pe(_e);const er=Mi(J.instance.target),rs=parseFloat(er[`margin${nn}`])||0,Er=parseFloat(er[`border${nn}Width`])||0;let zs;if(si){const zr=parseFloat(er.borderRadius)||0,ls=Number(rs+Er+zr);zs=bn===si?Number(J.offsets.host[bn])+ls:Number(J.offsets.host[bn])+Number(J.offsets.host[St]-ls)}else zs=Number(J.offsets.host[bn])+Number(J.offsets.host[St]/2-Ei/2);let Qs=zs-(_e[bn]??0)-rs-Er;return Qs=Math.max(Math.min(_e[St]-(Ei+5),Qs),0),J.offsets.arrow={[bn]:Math.round(Qs),[Dn]:""},J.instance.arrow=Se,J}function Wn(J){if(J.offsets.target=Pe(J.offsets.target),!it(J.options,"flip"))return J.offsets.target={...J.offsets.target,...He(J.instance.target,J.offsets.host,J.placement)},J;const _e=Si(J.instance.target,J.instance.host,0,"viewport",!1);let Se=J.placement.split(" ")[0],at=J.placement.split(" ")[1]||"";const Dn=Rs("auto",J.offsets.host,J.instance.target,J.instance.host,J.options.allowedPositions),Nn=[Se,Dn];return Nn.forEach((Ei,si)=>{if(Se!==Ei||Nn.length===si+1)return;Se=J.placement.split(" ")[0];const er="left"===Se&&Math.floor(J.offsets.target.right??0)>Math.floor(J.offsets.host.left??0)||"right"===Se&&Math.floor(J.offsets.target.left??0)<Math.floor(J.offsets.host.right??0)||"top"===Se&&Math.floor(J.offsets.target.bottom??0)>Math.floor(J.offsets.host.top??0)||"bottom"===Se&&Math.floor(J.offsets.target.top??0)<Math.floor(J.offsets.host.bottom??0),rs=Math.floor(J.offsets.target.left??0)<Math.floor(_e.left??0),Er=Math.floor(J.offsets.target.right??0)>Math.floor(_e.right??0),zs=Math.floor(J.offsets.target.top??0)<Math.floor(_e.top??0),Qs=Math.floor(J.offsets.target.bottom??0)>Math.floor(_e.bottom??0),zr="left"===Se&&rs||"right"===Se&&Er||"top"===Se&&zs||"bottom"===Se&&Qs,ls=-1!==["top","bottom"].indexOf(Se),ds=ls&&"left"===at&&rs||ls&&"right"===at&&Er||!ls&&"left"===at&&zs||!ls&&"right"===at&&Qs;(er||zr||ds)&&((er||zr)&&(Se=Nn[si+1]),ds&&(at=function ir(J){return"right"===J?"left":"left"===J?"right":J}(at)),J.placement=Se+(at?` ${at}`:""),J.offsets.target={...J.offsets.target,...He(J.instance.target,J.offsets.host,J.placement)})}),J}function Fi(J){if(!it(J.options,"preventOverflow"))return J;const _e="transform",Se=J.instance.target.style,{top:at,left:St,[_e]:nn}=Se;Se.top="",Se.left="",Se[_e]="";const bn=Si(J.instance.target,J.instance.host,0,J.options.modifiers.preventOverflow?.boundariesElement||"scrollParent",!1);Se.top=at,Se.left=St,Se[_e]=nn;const Nn={primary(Ei){let si=J.offsets.target[Ei];return(J.offsets.target[Ei]??0)<(bn[Ei]??0)&&(si=Math.max(J.offsets.target[Ei]??0,bn[Ei]??0)),{[Ei]:si}},secondary(Ei){const si="right"===Ei,er=si?"left":"top";let Er=J.offsets.target[er];return(J.offsets.target[Ei]??0)>(bn[Ei]??0)&&(Er=Math.min(J.offsets.target[er]??0,(bn[Ei]??0)-J.offsets.target[si?"width":"height"])),{[er]:Er}}};return["left","right","top","bottom"].forEach(Ei=>{const si=-1!==["left","top","start"].indexOf(Ei)?Nn.primary:Nn.secondary;J.offsets.target={...J.offsets.target,...si(Ei)}}),J}function Hi(J){const _e=J.placement,Se=_e.split(" ")[0],at=_e.split(" ")[1];if(at){const{host:St,target:nn}=J.offsets,bn=-1!==["bottom","top"].indexOf(Se),Dn=bn?"left":"top",Nn=bn?"width":"height",Ei={start:{[Dn]:St[Dn]},end:{[Dn]:(St[Dn]??0)+St[Nn]-nn[Nn]}};J.offsets.target={...nn,[Dn]:Dn===at?Ei.start[Dn]:Ei.end[Dn]}}return J}const Ti=new class Xr{position(_e,Se){return this.offset(_e,Se)}offset(_e,Se){return me(Se,_e)}positionElements(_e,Se,at,St,nn){const bn=[Wn,Hi,Fi,$n],Nn=function Zn(J,_e,Se,at){if(!J||!_e)return;const St=me(J,_e);!Se.match(/^(auto)*\s*(left|right|top|bottom|start|end)*$/)&&!Se.match(/^(left|right|top|bottom|start|end)*(?: (left|right|top|bottom|start|end))*$/)&&(Se="auto");const nn=!!Se.match(/auto/g);let bn=Se.match(/auto\s(left|right|top|bottom|start|end)/)?Se.split(" ")[1]||"auto":Se;const Dn=bn.match(/^(left|right|top|bottom|start|end)* ?(?!\1)(left|right|top|bottom|start|end)?/);return Dn&&(bn=Dn[1]+(Dn[2]?` ${Dn[2]}`:"")),-1!==["left right","right left","top bottom","bottom top"].indexOf(bn)&&(bn="auto"),bn=Rs(bn,St,J,_e,at?at.allowedPositions:void 0),{options:at||{modifiers:{}},instance:{target:J,host:_e,arrow:void 0},offsets:{target:He(J,St,bn),host:St,arrow:void 0},positionFixed:!1,placement:bn,placementAuto:nn}}(Se,_e,Ot[at],nn);if(Nn)return bn.reduce((Ei,si)=>si(Ei),Nn)}};function hr(J,_e,Se,at,St,nn){const bn=Ti.positionElements(J,_e,Se,at,St);if(!bn)return;const Dn=function $r(J){return{width:J.offsets.target.width,height:J.offsets.target.height,left:Math.floor(J.offsets.target.left??0),top:Math.round(J.offsets.target.top??0),bottom:Math.round(J.offsets.target.bottom??0),right:Math.floor(J.offsets.target.right??0)}}(bn);Qt(_e,{"will-change":"transform",top:"0px",left:"0px",transform:`translate3d(${Dn.left}px, ${Dn.top}px, 0px)`},nn),bn.instance.arrow&&Qt(bn.instance.arrow,bn.offsets.arrow,nn),function Hn(J,_e){const Se=J.instance.target;let at=Se.className;const St=(0,Xe.Wl)().isBs5?Xt[J.placement]:J.placement;J.placementAuto&&(at=at.replace(/bs-popover-auto/g,`bs-popover-${St}`),at=at.replace(/ms-2|me-2|mb-2|mt-2/g,""),at=at.replace(/bs-tooltip-auto/g,`bs-tooltip-${St}`),at=at.replace(/\sauto/g,` ${St}`),-1!==at.indexOf("popover")&&(at=at+" "+function It(J){return(0,Xe.Wl)().isBs5?At(J,"end")?"ms-2":At(J,"start")?"me-2":At(J,"top")?"mb-2":At(J,"bottom")?"mt-2":"":""}(St)),-1!==at.indexOf("popover")&&-1===at.indexOf("popover-auto")&&(at+=" popover-auto"),-1!==at.indexOf("tooltip")&&-1===at.indexOf("tooltip-auto")&&(at+=" tooltip-auto")),at=at.replace(/left|right|top|bottom|end|start/g,`${St.split(" ")[0]}`),_e?_e.setAttribute(Se,"class",at):Se.className=at}(bn,nn)}let ri=(()=>{class J{constructor(Se,at,St){this.update$$=new ct.x,this.positionElements=new Map,this.isDisabled=!1,(0,s.NF)(St)&&Se.runOutsideAngular(()=>{this.triggerEvent$=(0,de.T)(dn(window,"scroll",{passive:!0}),dn(window,"resize",{passive:!0}),(0,Te.of)(0,ot),this.update$$),this.triggerEvent$.subscribe(()=>{this.isDisabled||this.positionElements.forEach(nn=>{hr(Qi(nn.target),Qi(nn.element),nn.attachment,nn.appendToBody,this.options,at.createRenderer(null,null))})})})}position(Se){this.addPositionElement(Se)}get event$(){return this.triggerEvent$}disable(){this.isDisabled=!0}enable(){this.isDisabled=!1}addPositionElement(Se){this.positionElements.set(Qi(Se.element),Se)}calcPosition(){this.update$$.next(null)}deletePositionElement(Se){this.positionElements.delete(Qi(Se))}setOptions(Se){this.options=Se}}return J.\u0275fac=function(Se){return new(Se||J)(C.LFG(C.R0b),C.LFG(C.FYo),C.LFG(C.Lbi))},J.\u0275prov=C.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})();function Qi(J){return"string"==typeof J?document.querySelector(J):J instanceof C.SBq?J.nativeElement:J??null}class cn{constructor(_e,Se,at){this.nodes=_e,this.viewRef=Se,this.componentRef=at}}class Be{constructor(_e,Se,at,St,nn,bn,Dn,Nn,Ei){this._viewContainerRef=_e,this._renderer=Se,this._elementRef=at,this._injector=St,this._componentFactoryResolver=nn,this._ngZone=bn,this._applicationRef=Dn,this._posService=Nn,this._document=Ei,this.onBeforeShow=new C.vpe,this.onShown=new C.vpe,this.onBeforeHide=new C.vpe,this.onHidden=new C.vpe,this._providers=[],this._isHiding=!1,this.containerDefaultSelector="body",this._listenOpts={},this._globalListener=Function.prototype}get isShown(){return!this._isHiding&&!!this._componentRef}attach(_e){return this._componentFactory=this._componentFactoryResolver.resolveComponentFactory(_e),this}to(_e){return this.container=_e||this.container,this}position(_e){return _e?(this.attachment=_e.attachment||this.attachment,this._elementRef=_e.target||this._elementRef,this):this}provide(_e){return this._providers.push(_e),this}show(_e={}){if(this._subscribePositioning(),this._innerComponent=void 0,!this._componentRef){this.onBeforeShow.emit(),this._contentRef=this._getContentRef(_e.content,_e.context,_e.initialState);const Se=C.zs3.create({providers:this._providers,parent:this._injector});if(!this._componentFactory)return;if(this._componentRef=this._componentFactory.create(Se,this._contentRef.nodes),this._applicationRef.attachView(this._componentRef.hostView),this.instance=this._componentRef.instance,Object.assign(this._componentRef.instance,_e),this.container instanceof C.SBq&&this.container.nativeElement.appendChild(this._componentRef.location.nativeElement),"string"==typeof this.container&&typeof this._document<"u"){const at=this._document.querySelector(this.container)||this._document.querySelector(this.containerDefaultSelector);if(!at)return;at.appendChild(this._componentRef.location.nativeElement)}!this.container&&this._elementRef&&this._elementRef.nativeElement.parentElement&&this._elementRef.nativeElement.parentElement.appendChild(this._componentRef.location.nativeElement),this._contentRef.componentRef&&(this._innerComponent=this._contentRef.componentRef.instance,this._contentRef.componentRef.changeDetectorRef.markForCheck(),this._contentRef.componentRef.changeDetectorRef.detectChanges()),this._componentRef.changeDetectorRef.markForCheck(),this._componentRef.changeDetectorRef.detectChanges(),this.onShown.emit(_e.id?{id:_e.id}:this._componentRef.instance)}return this._registerOutsideClick(),this._componentRef}hide(_e){if(!this._componentRef)return this;this._posService.deletePositionElement(this._componentRef.location),this.onBeforeHide.emit(this._componentRef.instance);const Se=this._componentRef.location.nativeElement;return Se.parentNode?.removeChild(Se),this._contentRef?.componentRef?.destroy(),this._viewContainerRef&&this._contentRef?.viewRef&&this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._contentRef.viewRef)),this._contentRef?.viewRef?.destroy(),this._contentRef=void 0,this._componentRef=void 0,this._removeGlobalListener(),this.onHidden.emit(_e?{id:_e}:null),this}toggle(){this.isShown?this.hide():this.show()}dispose(){this.isShown&&this.hide(),this._unsubscribePositioning(),this._unregisterListenersFn&&this._unregisterListenersFn()}listen(_e){this.triggers=_e.triggers||this.triggers,this._listenOpts.outsideClick=_e.outsideClick,this._listenOpts.outsideEsc=_e.outsideEsc,_e.target=_e.target||this._elementRef?.nativeElement;const Se=this._listenOpts.hide=()=>_e.hide?_e.hide():void this.hide(),at=this._listenOpts.show=nn=>{_e.show?_e.show(nn):this.show(nn),nn()};return this._renderer&&(this._unregisterListenersFn=(0,Xe.wo)(this._renderer,{target:_e.target,triggers:_e.triggers,show:at,hide:Se,toggle:nn=>{this.isShown?Se():at(nn)}})),this}_removeGlobalListener(){this._globalListener&&(this._globalListener(),this._globalListener=Function.prototype)}attachInline(_e,Se){return _e&&Se&&(this._inlineViewRef=_e.createEmbeddedView(Se)),this}_registerOutsideClick(){if(this._componentRef&&this._componentRef.location){if(this._listenOpts.outsideClick){const _e=this._componentRef.location.nativeElement;setTimeout(()=>{this._renderer&&this._elementRef&&(this._globalListener=(0,Xe.Rg)(this._renderer,{targets:[_e,this._elementRef.nativeElement],outsideClick:this._listenOpts.outsideClick,hide:()=>this._listenOpts.hide&&this._listenOpts.hide()}))})}this._listenOpts.outsideEsc&&this._renderer&&this._elementRef&&(this._globalListener=(0,Xe.C)(this._renderer,{targets:[this._componentRef.location.nativeElement,this._elementRef.nativeElement],outsideEsc:this._listenOpts.outsideEsc,hide:()=>this._listenOpts.hide&&this._listenOpts.hide()}))}}getInnerComponent(){return this._innerComponent}_subscribePositioning(){this._zoneSubscription||!this.attachment||(this.onShown.subscribe(()=>{this._posService.position({element:this._componentRef?.location,target:this._elementRef,attachment:this.attachment,appendToBody:"body"===this.container})}),this._zoneSubscription=this._ngZone.onStable.subscribe(()=>{this._componentRef&&this._posService.calcPosition()}))}_unsubscribePositioning(){this._zoneSubscription&&(this._zoneSubscription.unsubscribe(),this._zoneSubscription=void 0)}_getContentRef(_e,Se,at){if(!_e)return new cn([]);if(_e instanceof C.Rgc){if(this._viewContainerRef){const bn=this._viewContainerRef.createEmbeddedView(_e,Se);return bn.markForCheck(),new cn([bn.rootNodes],bn)}const nn=_e.createEmbeddedView({});return this._applicationRef.attachView(nn),new cn([nn.rootNodes],nn)}if("function"==typeof _e){const nn=this._componentFactoryResolver.resolveComponentFactory(_e),bn=C.zs3.create({providers:this._providers,parent:this._injector}),Dn=nn.create(bn);return Object.assign(Dn.instance,at),this._applicationRef.attachView(Dn.hostView),new cn([[Dn.location.nativeElement]],Dn.hostView,Dn)}const St=this._renderer?[this._renderer.createText(`${_e}`)]:[];return new cn([St])}}let Tt=(()=>{class J{constructor(Se,at,St,nn,bn,Dn){this._componentFactoryResolver=Se,this._ngZone=at,this._injector=St,this._posService=nn,this._applicationRef=bn,this._document=Dn}createLoader(Se,at,St){return new Be(at,St,Se,this._injector,this._componentFactoryResolver,this._ngZone,this._applicationRef,this._posService,this._document)}}return J.\u0275fac=function(Se){return new(Se||J)(C.LFG(C._Vd),C.LFG(C.R0b),C.LFG(C.zs3),C.LFG(ri),C.LFG(C.z2F),C.LFG(s.K0))},J.\u0275prov=C.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})();var In=ue(7340);const vn=function(J){return{dropdown:J}},ei=["*"];let Oi=(()=>{class J{constructor(){this.autoClose=!0,this.insideClick=!1,this.isAnimated=!1,this.stopOnClickPropagation=!1}}return J.\u0275fac=function(Se){return new(Se||J)},J.\u0275prov=C.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})(),kt=(()=>{class J{constructor(){this.direction="down",this.autoClose=!0,this.insideClick=!1,this.isAnimated=!1,this.stopOnClickPropagation=!1,this.isOpenChange=new C.vpe,this.isDisabledChange=new C.vpe,this.toggleClick=new C.vpe,this.counts=0,this.dropdownMenu=new Promise(Se=>{this.resolveDropdownMenu=Se})}}return J.\u0275fac=function(Se){return new(Se||J)},J.\u0275prov=C.Yz7({token:J,factory:J.\u0275fac,providedIn:"platform"}),J})();const an=[(0,In.oB)({height:0,overflow:"hidden"}),(0,In.jt)("220ms cubic-bezier(0, 0, 0.2, 1)",(0,In.oB)({height:"*",overflow:"hidden"}))];let _n=(()=>{class J{constructor(Se,at,St,nn,bn){this._state=Se,this.cd=at,this._renderer=St,this._element=nn,this.isOpen=!1,this._factoryDropDownAnimation=bn.build(an),this._subscription=Se.isOpenChange.subscribe(Dn=>{this.isOpen=Dn;const Nn=this._element.nativeElement.querySelector(".dropdown-menu");this._renderer.addClass(this._element.nativeElement.querySelector("div"),"open"),Nn&&(this._renderer.addClass(Nn,"show"),(Nn.classList.contains("dropdown-menu-right")||Nn.classList.contains("dropdown-menu-end"))&&(this._renderer.setStyle(Nn,"left","auto"),this._renderer.setStyle(Nn,"right","0")),"up"===this.direction&&(this._renderer.setStyle(Nn,"top","auto"),this._renderer.setStyle(Nn,"transform","translateY(-101%)"))),Nn&&this._state.isAnimated&&this._factoryDropDownAnimation.create(Nn).play(),this.cd.markForCheck(),this.cd.detectChanges()})}get direction(){return this._state.direction}_contains(Se){return this._element.nativeElement.contains(Se)}ngOnDestroy(){this._subscription.unsubscribe()}}return J.\u0275fac=function(Se){return new(Se||J)(C.Y36(kt),C.Y36(C.sBO),C.Y36(C.Qsj),C.Y36(C.SBq),C.Y36(In._j))},J.\u0275cmp=C.Xpm({type:J,selectors:[["bs-dropdown-container"]],hostAttrs:[2,"display","block","position","absolute","z-index","1040"],ngContentSelectors:ei,decls:2,vars:9,consts:[[3,"ngClass"]],template:function(Se,at){1&Se&&(C.F$t(),C.TgZ(0,"div",0),C.Hsn(1),C.qZA()),2&Se&&(C.ekj("dropup","up"===at.direction)("show",at.isOpen)("open",at.isOpen),C.Q6J("ngClass",C.VKq(7,vn,"down"===at.direction)))},dependencies:[s.mk],encapsulation:2,changeDetection:0}),J})(),qe=(()=>{class J{constructor(Se,at,St,nn,bn,Dn,Nn){this._elementRef=Se,this._renderer=at,this._viewContainerRef=St,this._cis=nn,this._state=bn,this._config=Dn,this.dropup=!1,this._isInlineOpen=!1,this._isDisabled=!1,this._subscriptions=[],this._isInited=!1,this._state.autoClose=this._config.autoClose,this._state.insideClick=this._config.insideClick,this._state.isAnimated=this._config.isAnimated,this._state.stopOnClickPropagation=this._config.stopOnClickPropagation,this._factoryDropDownAnimation=Nn.build(an),this._dropdown=this._cis.createLoader(this._elementRef,this._viewContainerRef,this._renderer).provide({provide:kt,useValue:this._state}),this.onShown=this._dropdown.onShown,this.onHidden=this._dropdown.onHidden,this.isOpenChange=this._state.isOpenChange}set autoClose(Se){this._state.autoClose=Se}get autoClose(){return this._state.autoClose}set isAnimated(Se){this._state.isAnimated=Se}get isAnimated(){return this._state.isAnimated}set insideClick(Se){this._state.insideClick=Se}get insideClick(){return this._state.insideClick}set isDisabled(Se){this._isDisabled=Se,this._state.isDisabledChange.emit(Se),Se&&this.hide()}get isDisabled(){return this._isDisabled}get isOpen(){return this._showInline?this._isInlineOpen:this._dropdown.isShown}set isOpen(Se){Se?this.show():this.hide()}get _showInline(){return!this.container}ngOnInit(){this._isInited||(this._isInited=!0,this._dropdown.listen({outsideClick:!1,triggers:this.triggers,show:()=>this.show()}),this._subscriptions.push(this._state.toggleClick.subscribe(Se=>this.toggle(Se))),this._subscriptions.push(this._state.isDisabledChange.pipe((0,De.h)(Se=>Se)).subscribe(()=>this.hide())))}show(){if(!this.isOpen&&!this.isDisabled){if(this._showInline)return this._inlinedMenu||this._state.dropdownMenu.then(Se=>{this._dropdown.attachInline(Se.viewContainer,Se.templateRef),this._inlinedMenu=this._dropdown._inlineViewRef,this.addBs4Polyfills(),this._inlinedMenu&&this._renderer.addClass(this._inlinedMenu.rootNodes[0].parentNode,"open"),this.playAnimation()}).catch(),this.addBs4Polyfills(),this._isInlineOpen=!0,this.onShown.emit(!0),this._state.isOpenChange.emit(!0),void this.playAnimation();this._state.dropdownMenu.then(Se=>{const at=this.dropup||typeof this.dropup<"u"&&this.dropup;this._state.direction=at?"up":"down";const St=this.placement||(at?"top start":"bottom start");this._dropdown.attach(_n).to(this.container).position({attachment:St}).show({content:Se.templateRef,placement:St}),this._state.isOpenChange.emit(!0)}).catch()}}hide(){this.isOpen&&(this._showInline?(this.removeShowClass(),this.removeDropupStyles(),this._isInlineOpen=!1,this.onHidden.emit(!0)):this._dropdown.hide(),this._state.isOpenChange.emit(!1))}toggle(Se){return this.isOpen||!Se?this.hide():this.show()}_contains(Se){return this._elementRef.nativeElement.contains(Se.target)||this._dropdown.instance&&this._dropdown.instance._contains(Se.target)}navigationClick(Se){const at=this._elementRef.nativeElement.querySelector(".dropdown-menu");if(!at)return;const St=this._elementRef.nativeElement.ownerDocument.activeElement,nn=at.querySelectorAll(".dropdown-item");switch(Se.keyCode){case 38:this._state.counts>0&&nn[--this._state.counts].focus();break;case 40:this._state.counts+1<nn.length&&(St.classList!==nn[this._state.counts].classList?nn[this._state.counts].focus():nn[++this._state.counts].focus())}Se.preventDefault()}ngOnDestroy(){for(const Se of this._subscriptions)Se.unsubscribe();this._dropdown.dispose()}addBs4Polyfills(){this.addShowClass(),this.checkRightAlignment(),this.addDropupStyles()}playAnimation(){this._state.isAnimated&&this._inlinedMenu&&setTimeout(()=>{this._inlinedMenu&&this._factoryDropDownAnimation.create(this._inlinedMenu.rootNodes[0]).play()})}addShowClass(){this._inlinedMenu&&this._inlinedMenu.rootNodes[0]&&this._renderer.addClass(this._inlinedMenu.rootNodes[0],"show")}removeShowClass(){this._inlinedMenu&&this._inlinedMenu.rootNodes[0]&&this._renderer.removeClass(this._inlinedMenu.rootNodes[0],"show")}checkRightAlignment(){if(this._inlinedMenu&&this._inlinedMenu.rootNodes[0]){const Se=this._inlinedMenu.rootNodes[0].classList.contains("dropdown-menu-right")||this._inlinedMenu.rootNodes[0].classList.contains("dropdown-menu-end");this._renderer.setStyle(this._inlinedMenu.rootNodes[0],"left",Se?"auto":"0"),this._renderer.setStyle(this._inlinedMenu.rootNodes[0],"right",Se?"0":"auto")}}addDropupStyles(){this._inlinedMenu&&this._inlinedMenu.rootNodes[0]&&(this._renderer.setStyle(this._inlinedMenu.rootNodes[0],"top",this.dropup?"auto":"100%"),this._renderer.setStyle(this._inlinedMenu.rootNodes[0],"transform",this.dropup?"translateY(-101%)":"translateY(0)"),this._renderer.setStyle(this._inlinedMenu.rootNodes[0],"bottom","auto"))}removeDropupStyles(){this._inlinedMenu&&this._inlinedMenu.rootNodes[0]&&(this._renderer.removeStyle(this._inlinedMenu.rootNodes[0],"top"),this._renderer.removeStyle(this._inlinedMenu.rootNodes[0],"transform"),this._renderer.removeStyle(this._inlinedMenu.rootNodes[0],"bottom"))}}return J.\u0275fac=function(Se){return new(Se||J)(C.Y36(C.SBq),C.Y36(C.Qsj),C.Y36(C.s_b),C.Y36(Tt),C.Y36(kt),C.Y36(Oi),C.Y36(In._j))},J.\u0275dir=C.lG2({type:J,selectors:[["","bsDropdown",""],["","dropdown",""]],hostVars:6,hostBindings:function(Se,at){1&Se&&C.NdJ("keydown.arrowDown",function(nn){return at.navigationClick(nn)})("keydown.arrowUp",function(nn){return at.navigationClick(nn)}),2&Se&&C.ekj("dropup",at.dropup)("open",at.isOpen)("show",at.isOpen)},inputs:{placement:"placement",triggers:"triggers",container:"container",dropup:"dropup",autoClose:"autoClose",isAnimated:"isAnimated",insideClick:"insideClick",isDisabled:"isDisabled",isOpen:"isOpen"},outputs:{isOpenChange:"isOpenChange",onShown:"onShown",onHidden:"onHidden"},exportAs:["bs-dropdown"],features:[C._Bn([kt])]}),J})(),Ge=(()=>{class J{constructor(Se,at,St){Se.resolveDropdownMenu({templateRef:St,viewContainer:at})}}return J.\u0275fac=function(Se){return new(Se||J)(C.Y36(kt),C.Y36(C.s_b),C.Y36(C.Rgc))},J.\u0275dir=C.lG2({type:J,selectors:[["","bsDropdownMenu",""],["","dropdownMenu",""]],exportAs:["bs-dropdown-menu"]}),J})(),ye=(()=>{class J{constructor(Se,at,St,nn,bn){this._changeDetectorRef=Se,this._dropdown=at,this._element=St,this._renderer=nn,this._state=bn,this.isOpen=!1,this._subscriptions=[],this._subscriptions.push(this._state.isOpenChange.subscribe(Dn=>{this.isOpen=Dn,Dn?(this._documentClickListener=this._renderer.listen("document","click",Nn=>{this._state.autoClose&&2!==Nn.button&&!this._element.nativeElement.contains(Nn.target)&&(!this._state.insideClick||!this._dropdown._contains(Nn))&&(this._state.toggleClick.emit(!1),this._changeDetectorRef.detectChanges())}),this._escKeyUpListener=this._renderer.listen(this._element.nativeElement,"keyup.esc",()=>{this._state.autoClose&&(this._state.toggleClick.emit(!1),this._changeDetectorRef.detectChanges())})):(this._documentClickListener&&this._documentClickListener(),this._escKeyUpListener&&this._escKeyUpListener())})),this._subscriptions.push(this._state.isDisabledChange.subscribe(Dn=>this.isDisabled=Dn||void 0))}onClick(Se){this._state.stopOnClickPropagation&&Se.stopPropagation(),!this.isDisabled&&this._state.toggleClick.emit(!0)}ngOnDestroy(){this._documentClickListener&&this._documentClickListener(),this._escKeyUpListener&&this._escKeyUpListener();for(const Se of this._subscriptions)Se.unsubscribe()}}return J.\u0275fac=function(Se){return new(Se||J)(C.Y36(C.sBO),C.Y36(qe),C.Y36(C.SBq),C.Y36(C.Qsj),C.Y36(kt))},J.\u0275dir=C.lG2({type:J,selectors:[["","bsDropdownToggle",""],["","dropdownToggle",""]],hostVars:3,hostBindings:function(Se,at){1&Se&&C.NdJ("click",function(nn){return at.onClick(nn)}),2&Se&&C.uIk("aria-haspopup",!0)("disabled",at.isDisabled)("aria-expanded",at.isOpen)},exportAs:["bs-dropdown-toggle"]}),J})(),ke=(()=>{class J{static forRoot(){return{ngModule:J,providers:[Tt,ri,kt]}}}return J.\u0275fac=function(Se){return new(Se||J)},J.\u0275mod=C.oAB({type:J}),J.\u0275inj=C.cJS({imports:[s.ez]}),J})()},2521:(yi,on,ue)=>{"use strict";ue.d(on,{Qt:()=>_t,u3:()=>Ue});var C=ue(1571),De=ue(433),Xe=ue(6895);const s=function(Ye,Pt){return{"pull-left":Ye,"float-left":Pt}},ct=function(Ye,Pt){return{"pull-right":Ye,"float-right":Pt}},de=function(Ye,Pt){return{disabled:Ye,currentPage:Pt}};function Et(Ye,Pt){if(1&Ye){const je=C.EpF();C.TgZ(0,"li",11)(1,"a",12),C.NdJ("click",function(ot){C.CHM(je);const pt=C.oxw();return C.KtG(pt.selectPage(1,ot))}),C.GkF(2,13),C.qZA()()}if(2&Ye){const je=C.oxw(),Ze=C.MAs(13);C.ekj("disabled",je.noPrevious()||je.disabled),C.xp6(2),C.Q6J("ngTemplateOutlet",je.customFirstTemplate||Ze)("ngTemplateOutletContext",C.WLB(4,de,je.noPrevious()||je.disabled,je.page))}}function qt(Ye,Pt){if(1&Ye){const je=C.EpF();C.TgZ(0,"li",14)(1,"a",12),C.NdJ("click",function(ot){C.CHM(je);const pt=C.oxw();return C.KtG(pt.selectPage(pt.page-1,ot))}),C.GkF(2,13),C.qZA()()}if(2&Ye){const je=C.oxw(),Ze=C.MAs(11);C.ekj("disabled",je.noPrevious()||je.disabled),C.xp6(2),C.Q6J("ngTemplateOutlet",je.customPreviousTemplate||Ze)("ngTemplateOutletContext",C.WLB(4,de,je.noPrevious()||je.disabled,je.page))}}const gt=function(Ye,Pt,je){return{disabled:Ye,$implicit:Pt,currentPage:je}};function jt(Ye,Pt){if(1&Ye){const je=C.EpF();C.TgZ(0,"li",15)(1,"a",12),C.NdJ("click",function(ot){const Ot=C.CHM(je).$implicit,Xt=C.oxw();return C.KtG(Xt.selectPage(Ot.number,ot))}),C.GkF(2,13),C.qZA()()}if(2&Ye){const je=Pt.$implicit,Ze=C.oxw(),ot=C.MAs(7);C.ekj("active",je.active)("disabled",Ze.disabled&&!je.active),C.xp6(2),C.Q6J("ngTemplateOutlet",Ze.customPageTemplate||ot)("ngTemplateOutletContext",C.kEZ(6,gt,Ze.disabled,je,Ze.page))}}function wt(Ye,Pt){if(1&Ye){const je=C.EpF();C.TgZ(0,"li",16)(1,"a",12),C.NdJ("click",function(ot){C.CHM(je);const pt=C.oxw();return C.KtG(pt.selectPage(pt.page+1,ot))}),C.GkF(2,13),C.qZA()()}if(2&Ye){const je=C.oxw(),Ze=C.MAs(9);C.ekj("disabled",je.noNext()||je.disabled),C.xp6(2),C.Q6J("ngTemplateOutlet",je.customNextTemplate||Ze)("ngTemplateOutletContext",C.WLB(4,de,je.noNext()||je.disabled,je.page))}}function Gt(Ye,Pt){if(1&Ye){const je=C.EpF();C.TgZ(0,"li",17)(1,"a",12),C.NdJ("click",function(ot){C.CHM(je);const pt=C.oxw();return C.KtG(pt.selectPage(pt.totalPages,ot))}),C.GkF(2,13),C.qZA()()}if(2&Ye){const je=C.oxw(),Ze=C.MAs(15);C.ekj("disabled",je.noNext()||je.disabled),C.xp6(2),C.Q6J("ngTemplateOutlet",je.customLastTemplate||Ze)("ngTemplateOutletContext",C.WLB(4,de,je.noNext()||je.disabled,je.page))}}function Kn(Ye,Pt){1&Ye&&C._uU(0),2&Ye&&C.Oqu(Pt.$implicit.text)}function Sn(Ye,Pt){if(1&Ye&&C._uU(0),2&Ye){const je=C.oxw();C.Oqu(je.getText("next"))}}function En(Ye,Pt){if(1&Ye&&C._uU(0),2&Ye){const je=C.oxw();C.Oqu(je.getText("previous"))}}function dn(Ye,Pt){if(1&Ye&&C._uU(0),2&Ye){const je=C.oxw();C.Oqu(je.getText("first"))}}function ii(Ye,Pt){if(1&Ye&&C._uU(0),2&Ye){const je=C.oxw();C.Oqu(je.getText("last"))}}let hn=(()=>{class Ye{constructor(){this.main={itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",pageBtnClass:"",rotate:!0},this.pager={itemsPerPage:15,previousText:"\xab Previous",nextText:"Next \xbb",pageBtnClass:"",align:!0}}}return Ye.\u0275fac=function(je){return new(je||Ye)},Ye.\u0275prov=C.Yz7({token:Ye,factory:Ye.\u0275fac,providedIn:"root"}),Ye})();const Vn={provide:De.JU,useExisting:(0,C.Gpc)(()=>hi),multi:!0};let hi=(()=>{class Ye{constructor(je,Ze,ot){this.elementRef=je,this.changeDetection=ot,this.align=!1,this.boundaryLinks=!1,this.directionLinks=!0,this.firstText="First",this.previousText="\xab Previous",this.nextText="Next \xbb",this.lastText="Last",this.rotate=!0,this.pageBtnClass="",this.disabled=!1,this.numPages=new C.vpe,this.pageChanged=new C.vpe,this.onChange=Function.prototype,this.onTouched=Function.prototype,this.classMap="",this.inited=!1,this._itemsPerPage=15,this._totalItems=0,this._totalPages=0,this._page=1,this.elementRef=je,this.config||this.configureOptions(Object.assign({},Ze.main,Ze.pager))}get itemsPerPage(){return this._itemsPerPage}set itemsPerPage(je){this._itemsPerPage=je,this.totalPages=this.calculateTotalPages()}get totalItems(){return this._totalItems}set totalItems(je){this._totalItems=je,this.totalPages=this.calculateTotalPages()}get totalPages(){return this._totalPages}set totalPages(je){this._totalPages=je,this.numPages.emit(je),this.inited&&this.selectPage(this.page)}get page(){return this._page}set page(je){const Ze=this._page;this._page=je>this.totalPages?this.totalPages:je||1,this.changeDetection.markForCheck(),!(Ze===this._page||typeof Ze>"u")&&this.pageChanged.emit({page:this._page,itemsPerPage:this.itemsPerPage})}configureOptions(je){this.config=Object.assign({},je)}ngOnInit(){typeof window<"u"&&(this.classMap=this.elementRef.nativeElement.getAttribute("class")||""),typeof this.maxSize>"u"&&(this.maxSize=this.config?.maxSize||0),typeof this.rotate>"u"&&(this.rotate=!!this.config?.rotate),typeof this.boundaryLinks>"u"&&(this.boundaryLinks=!!this.config?.boundaryLinks),typeof this.directionLinks>"u"&&(this.directionLinks=!!this.config?.directionLinks),typeof this.pageBtnClass>"u"&&(this.pageBtnClass=this.config?.pageBtnClass||""),typeof this.itemsPerPage>"u"&&(this.itemsPerPage=this.config?.itemsPerPage||0),this.totalPages=this.calculateTotalPages(),this.pages=this.getPages(this.page,this.totalPages),this.inited=!0}writeValue(je){this.page=je,this.pages=this.getPages(this.page,this.totalPages)}getText(je){return this[`${je}Text`]||this.config[`${je}Text`]}noPrevious(){return 1===this.page}noNext(){return this.page===this.totalPages}registerOnChange(je){this.onChange=je}registerOnTouched(je){this.onTouched=je}selectPage(je,Ze){Ze&&Ze.preventDefault(),this.disabled||(Ze&&Ze.target&&Ze.target.blur(),this.writeValue(je),this.onChange(this.page))}makePage(je,Ze,ot){return{text:Ze,number:je,active:ot}}getPages(je,Ze){const ot=[];let pt=1,Ot=Ze;const Xt=typeof this.maxSize<"u"&&this.maxSize<Ze;Xt&&this.maxSize&&(this.rotate?(pt=Math.max(je-Math.floor(this.maxSize/2),1),Ot=pt+this.maxSize-1,Ot>Ze&&(Ot=Ze,pt=Ot-this.maxSize+1)):(pt=(Math.ceil(je/this.maxSize)-1)*this.maxSize+1,Ot=Math.min(pt+this.maxSize-1,Ze)));for(let Mi=pt;Mi<=Ot;Mi++){const Wi=this.makePage(Mi,Mi.toString(),Mi===je);ot.push(Wi)}if(Xt&&!this.rotate){if(pt>1){const Mi=this.makePage(pt-1,"...",!1);ot.unshift(Mi)}if(Ot<Ze){const Mi=this.makePage(Ot+1,"...",!1);ot.push(Mi)}}return ot}calculateTotalPages(){const je=this.itemsPerPage<1?1:Math.ceil(this.totalItems/this.itemsPerPage);return Math.max(je||0,1)}}return Ye.\u0275fac=function(je){return new(je||Ye)(C.Y36(C.SBq),C.Y36(hn),C.Y36(C.sBO))},Ye.\u0275cmp=C.Xpm({type:Ye,selectors:[["pager"]],inputs:{align:"align",maxSize:"maxSize",boundaryLinks:"boundaryLinks",directionLinks:"directionLinks",firstText:"firstText",previousText:"previousText",nextText:"nextText",lastText:"lastText",rotate:"rotate",pageBtnClass:"pageBtnClass",disabled:"disabled",itemsPerPage:"itemsPerPage",totalItems:"totalItems"},outputs:{numPages:"numPages",pageChanged:"pageChanged"},features:[C._Bn([Vn])],decls:7,vars:24,consts:[[1,"pager"],[3,"ngClass"],["href","",3,"click"]],template:function(je,Ze){1&je&&(C.TgZ(0,"ul",0)(1,"li",1)(2,"a",2),C.NdJ("click",function(pt){return Ze.selectPage(Ze.page-1,pt)}),C._uU(3),C.qZA()(),C.TgZ(4,"li",1)(5,"a",2),C.NdJ("click",function(pt){return Ze.selectPage(Ze.page+1,pt)}),C._uU(6),C.qZA()()()),2&je&&(C.xp6(1),C.Tol(Ze.pageBtnClass),C.ekj("disabled",Ze.noPrevious())("previous",Ze.align),C.Q6J("ngClass",C.WLB(18,s,Ze.align,Ze.align)),C.xp6(2),C.Oqu(Ze.getText("previous")),C.xp6(1),C.Tol(Ze.pageBtnClass),C.ekj("disabled",Ze.noNext())("next",Ze.align),C.Q6J("ngClass",C.WLB(21,ct,Ze.align,Ze.align)),C.xp6(2),C.Oqu(Ze.getText("next")))},dependencies:[Xe.mk],encapsulation:2}),Ye})();const Te={provide:De.JU,useExisting:(0,C.Gpc)(()=>_t),multi:!0};let _t=(()=>{class Ye{constructor(je,Ze,ot){this.elementRef=je,this.changeDetection=ot,this.align=!0,this.boundaryLinks=!1,this.directionLinks=!0,this.rotate=!0,this.pageBtnClass="",this.disabled=!1,this.numPages=new C.vpe,this.pageChanged=new C.vpe,this.onChange=Function.prototype,this.onTouched=Function.prototype,this.classMap="",this.inited=!1,this._itemsPerPage=10,this._totalItems=0,this._totalPages=0,this._page=1,this.elementRef=je,this.config||this.configureOptions(Ze.main)}get itemsPerPage(){return this._itemsPerPage}set itemsPerPage(je){this._itemsPerPage=je,this.totalPages=this.calculateTotalPages()}get totalItems(){return this._totalItems}set totalItems(je){this._totalItems=je,this.totalPages=this.calculateTotalPages()}get totalPages(){return this._totalPages}set totalPages(je){this._totalPages=je,this.numPages.emit(je),this.inited&&this.selectPage(this.page)}get page(){return this._page}set page(je){const Ze=this._page;this._page=je>this.totalPages?this.totalPages:je||1,this.changeDetection.markForCheck(),!(Ze===this._page||typeof Ze>"u")&&this.pageChanged.emit({page:this._page,itemsPerPage:this.itemsPerPage})}configureOptions(je){this.config=Object.assign({},je)}ngOnInit(){typeof window<"u"&&(this.classMap=this.elementRef.nativeElement.getAttribute("class")||""),typeof this.maxSize>"u"&&(this.maxSize=this.config?.maxSize||0),typeof this.rotate>"u"&&(this.rotate=!!this.config?.rotate),typeof this.boundaryLinks>"u"&&(this.boundaryLinks=!!this.config?.boundaryLinks),typeof this.directionLinks>"u"&&(this.directionLinks=!!this.config?.directionLinks),typeof this.pageBtnClass>"u"&&(this.pageBtnClass=this.config?.pageBtnClass||""),typeof this.itemsPerPage>"u"&&(this.itemsPerPage=this.config?.itemsPerPage||0),this.totalPages=this.calculateTotalPages(),this.pages=this.getPages(this.page,this.totalPages),this.inited=!0}writeValue(je){this.page=je,this.pages=this.getPages(this.page,this.totalPages)}getText(je){return this[`${je}Text`]||this.config[`${je}Text`]}noPrevious(){return 1===this.page}noNext(){return this.page===this.totalPages}registerOnChange(je){this.onChange=je}registerOnTouched(je){this.onTouched=je}selectPage(je,Ze){Ze&&Ze.preventDefault(),this.disabled||(Ze&&Ze.target&&Ze.target.blur(),this.writeValue(je),this.onChange(this.page))}makePage(je,Ze,ot){return{text:Ze,number:je,active:ot}}getPages(je,Ze){const ot=[];let pt=1,Ot=Ze;const Xt=typeof this.maxSize<"u"&&this.maxSize<Ze;Xt&&this.maxSize&&(this.rotate?(pt=Math.max(je-Math.floor(this.maxSize/2),1),Ot=pt+this.maxSize-1,Ot>Ze&&(Ot=Ze,pt=Ot-this.maxSize+1)):(pt=(Math.ceil(je/this.maxSize)-1)*this.maxSize+1,Ot=Math.min(pt+this.maxSize-1,Ze)));for(let Mi=pt;Mi<=Ot;Mi++){const Wi=this.makePage(Mi,Mi.toString(),Mi===je);ot.push(Wi)}if(Xt&&!this.rotate){if(pt>1){const Mi=this.makePage(pt-1,"...",!1);ot.unshift(Mi)}if(Ot<Ze){const Mi=this.makePage(Ot+1,"...",!1);ot.push(Mi)}}return ot}calculateTotalPages(){const je=this.itemsPerPage<1?1:Math.ceil(this.totalItems/this.itemsPerPage);return Math.max(je||0,1)}}return Ye.\u0275fac=function(je){return new(je||Ye)(C.Y36(C.SBq),C.Y36(hn),C.Y36(C.sBO))},Ye.\u0275cmp=C.Xpm({type:Ye,selectors:[["pagination"]],inputs:{align:"align",maxSize:"maxSize",boundaryLinks:"boundaryLinks",directionLinks:"directionLinks",firstText:"firstText",previousText:"previousText",nextText:"nextText",lastText:"lastText",rotate:"rotate",pageBtnClass:"pageBtnClass",disabled:"disabled",customPageTemplate:"customPageTemplate",customNextTemplate:"customNextTemplate",customPreviousTemplate:"customPreviousTemplate",customFirstTemplate:"customFirstTemplate",customLastTemplate:"customLastTemplate",itemsPerPage:"itemsPerPage",totalItems:"totalItems"},outputs:{numPages:"numPages",pageChanged:"pageChanged"},features:[C._Bn([Te])],decls:16,vars:6,consts:[[1,"pagination",3,"ngClass"],["class","pagination-first page-item",3,"disabled",4,"ngIf"],["class","pagination-prev page-item",3,"disabled",4,"ngIf"],["class","pagination-page page-item",3,"active","disabled",4,"ngFor","ngForOf"],["class","pagination-next page-item",3,"disabled",4,"ngIf"],["class","pagination-last page-item",3,"disabled",4,"ngIf"],["defaultPageTemplate",""],["defaultNextTemplate",""],["defaultPreviousTemplate",""],["defaultFirstTemplate",""],["defaultLastTemplate",""],[1,"pagination-first","page-item"],["href","",1,"page-link",3,"click"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"pagination-prev","page-item"],[1,"pagination-page","page-item"],[1,"pagination-next","page-item"],[1,"pagination-last","page-item"]],template:function(je,Ze){1&je&&(C.TgZ(0,"ul",0),C.YNc(1,Et,3,7,"li",1),C.YNc(2,qt,3,7,"li",2),C.YNc(3,jt,3,10,"li",3),C.YNc(4,wt,3,7,"li",4),C.YNc(5,Gt,3,7,"li",5),C.qZA(),C.YNc(6,Kn,1,1,"ng-template",null,6,C.W1O),C.YNc(8,Sn,1,1,"ng-template",null,7,C.W1O),C.YNc(10,En,1,1,"ng-template",null,8,C.W1O),C.YNc(12,dn,1,1,"ng-template",null,9,C.W1O),C.YNc(14,ii,1,1,"ng-template",null,10,C.W1O)),2&je&&(C.Q6J("ngClass",Ze.classMap),C.xp6(1),C.Q6J("ngIf",Ze.boundaryLinks),C.xp6(1),C.Q6J("ngIf",Ze.directionLinks),C.xp6(1),C.Q6J("ngForOf",Ze.pages),C.xp6(1),C.Q6J("ngIf",Ze.directionLinks),C.xp6(1),C.Q6J("ngIf",Ze.boundaryLinks))},dependencies:[Xe.mk,Xe.sg,Xe.O5,Xe.tP],encapsulation:2}),Ye})(),Ue=(()=>{class Ye{static forRoot(){return{ngModule:Ye,providers:[]}}}return Ye.\u0275fac=function(je){return new(je||Ye)},Ye.\u0275mod=C.oAB({type:Ye}),Ye.\u0275inj=C.cJS({imports:[Xe.ez]}),Ye})()},1607:(yi,on,ue)=>{"use strict";ue.d(on,{C:()=>Et,Rg:()=>de,Su:()=>ot,Wl:()=>je,wo:()=>ct});class C{constructor(Tn,rt){this.open=Tn,this.close=rt||Tn}isManual(){return"manual"===this.open||"manual"===this.close}}const De={hover:["mouseover","mouseout"],focus:["focusin","focusout"]};function ct(ti,Tn){const rt=function Xe(ti,Tn=De){const rt=(ti||"").trim();if(0===rt.length)return[];const xt=rt.split(/\s+/).map(st=>st.split(":")).map(st=>{const Ne=Tn[st[0]]||st;return new C(Ne[0],Ne[1])}),ht=xt.filter(st=>st.isManual());if(ht.length>1)throw new Error("Triggers parse error: only one manual trigger is allowed");if(1===ht.length&&xt.length>1)throw new Error("Triggers parse error: manual trigger can't be mixed with other triggers");return xt}(Tn.triggers),xt=Tn.target;if(1===rt.length&&rt[0].isManual())return Function.prototype;const ht=[],st=[],Ne=()=>{st.forEach(Pe=>ht.push(Pe())),st.length=0};return rt.forEach(Pe=>{const Ke=Pe.open===Pe.close,Bt=Ke?Tn.toggle:Tn.show;if(!Ke&&Pe.close&&Tn.hide){const mi=Pe.close,Di=Tn.hide;st.push(()=>ti.listen(xt,mi,Di))}Bt&&ht.push(ti.listen(xt,Pe.open,()=>Bt(Ne)))}),()=>{ht.forEach(Pe=>Pe())}}function de(ti,Tn){return Tn.outsideClick?ti.listen("document","click",rt=>{Tn.target&&Tn.target.contains(rt.target)||Tn.targets&&Tn.targets.some(xt=>xt.contains(rt.target))||Tn.hide&&Tn.hide()}):Function.prototype}function Et(ti,Tn){return Tn.outsideEsc?ti.listen("document","keyup.esc",rt=>{Tn.target&&Tn.target.contains(rt.target)||Tn.targets&&Tn.targets.some(xt=>xt.contains(rt.target))||Tn.hide&&Tn.hide()}):Function.prototype}const qt=typeof window<"u"&&window||{};let Te;function _t(){const ti=qt.document.createElement("span");ti.innerText="testing bs version",ti.classList.add("d-none"),ti.classList.add("pl-1"),qt.document.head.appendChild(ti);const Tn=qt.getComputedStyle(ti).paddingLeft;return Tn&&parseFloat(Tn)?(qt.document.head.removeChild(ti),"bs4"):(qt.document.head.removeChild(ti),"bs5")}function je(){return{isBs4:(Te||(Te=_t()),"bs4"===Te),isBs5:(Te||(Te=_t()),"bs5"===Te)}}class ot{constructor(){this.length=0,this.asArray=[]}get(Tn){if(0===this.length||Tn<0||Tn>=this.length)return;let rt=this.head;for(let xt=0;xt<Tn;xt++)rt=rt?.next;return rt?.value}add(Tn,rt=this.length){if(rt<0||rt>this.length)throw new Error("Position is out of the list");const xt={value:Tn,next:void 0,previous:void 0};if(0===this.length)this.head=xt,this.tail=xt,this.current=xt;else if(0===rt&&this.head)xt.next=this.head,this.head.previous=xt,this.head=xt;else if(rt===this.length&&this.tail)this.tail.next=xt,xt.previous=this.tail,this.tail=xt;else{const ht=this.getNode(rt-1),st=ht?.next;ht&&st&&(ht.next=xt,st.previous=xt,xt.previous=ht,xt.next=st)}this.length++,this.createInternalArrayRepresentation()}remove(Tn=0){if(0===this.length||Tn<0||Tn>=this.length)throw new Error("Position is out of the list");if(0===Tn&&this.head)this.head=this.head.next,this.head?this.head.previous=void 0:this.tail=void 0;else if(Tn===this.length-1&&this.tail?.previous)this.tail=this.tail.previous,this.tail.next=void 0;else{const rt=this.getNode(Tn);rt?.next&&rt.previous&&(rt.next.previous=rt.previous,rt.previous.next=rt.next)}this.length--,this.createInternalArrayRepresentation()}set(Tn,rt){if(0===this.length||Tn<0||Tn>=this.length)throw new Error("Position is out of the list");const xt=this.getNode(Tn);xt&&(xt.value=rt,this.createInternalArrayRepresentation())}toArray(){return this.asArray}findAll(Tn){let rt=this.head;const xt=[];if(!rt)return xt;for(let ht=0;ht<this.length;ht++){if(!rt)return xt;Tn(rt.value,ht)&&xt.push({index:ht,value:rt.value}),rt=rt.next}return xt}push(...Tn){return Tn.forEach(rt=>{this.add(rt)}),this.length}pop(){if(0===this.length)return;const Tn=this.tail;return this.remove(this.length-1),Tn?.value}unshift(...Tn){return Tn.reverse(),Tn.forEach(rt=>{this.add(rt,0)}),this.length}shift(){if(0===this.length)return;const Tn=this.head?.value;return this.remove(),Tn}forEach(Tn){let rt=this.head;for(let xt=0;xt<this.length;xt++){if(!rt)return;Tn(rt.value,xt),rt=rt.next}}indexOf(Tn){let rt=this.head,xt=-1;for(let ht=0;ht<this.length;ht++){if(!rt)return xt;if(rt.value===Tn){xt=ht;break}rt=rt.next}return xt}some(Tn){let rt=this.head,xt=!1;for(;rt&&!xt;){if(Tn(rt.value)){xt=!0;break}rt=rt.next}return xt}every(Tn){let rt=this.head,xt=!0;for(;rt&&xt;)Tn(rt.value)||(xt=!1),rt=rt.next;return xt}toString(){return"[Linked List]"}find(Tn){let rt=this.head;for(let xt=0;xt<this.length;xt++){if(!rt)return;if(Tn(rt.value,xt))return rt.value;rt=rt.next}}findIndex(Tn){let rt=this.head;for(let xt=0;xt<this.length;xt++){if(!rt)return-1;if(Tn(rt.value,xt))return xt;rt=rt.next}return-1}getNode(Tn){if(0===this.length||Tn<0||Tn>=this.length)throw new Error("Position is out of the list");let rt=this.head;for(let xt=0;xt<Tn;xt++)rt=rt?.next;return rt}createInternalArrayRepresentation(){const Tn=[];let rt=this.head;for(;rt;)Tn.push(rt.value),rt=rt.next;this.asArray=Tn}}typeof console>"u"||console},7185:(yi,on,ue)=>{"use strict";ue.d(on,{Rh:()=>ti,_W:()=>Ot});var C=ue(1571),De=ue(7340),Xe=ue(6895),s=ue(7579),ct=ue(1481);const de=["toast-component",""];function Et(st,Ne){if(1&st){const Pe=C.EpF();C.TgZ(0,"button",5),C.NdJ("click",function(){C.CHM(Pe);const Bt=C.oxw();return C.KtG(Bt.remove())}),C.TgZ(1,"span",6),C._uU(2,"\xd7"),C.qZA()()}}function qt(st,Ne){if(1&st&&(C.ynx(0),C._uU(1),C.BQk()),2&st){const Pe=C.oxw(2);C.xp6(1),C.hij("[",Pe.duplicatesCount+1,"]")}}function gt(st,Ne){if(1&st&&(C.TgZ(0,"div"),C._uU(1),C.YNc(2,qt,2,1,"ng-container",4),C.qZA()),2&st){const Pe=C.oxw();C.Tol(Pe.options.titleClass),C.uIk("aria-label",Pe.title),C.xp6(1),C.hij(" ",Pe.title," "),C.xp6(1),C.Q6J("ngIf",Pe.duplicatesCount)}}function jt(st,Ne){if(1&st&&C._UZ(0,"div",7),2&st){const Pe=C.oxw();C.Tol(Pe.options.messageClass),C.Q6J("innerHTML",Pe.message,C.oJD)}}function wt(st,Ne){if(1&st&&(C.TgZ(0,"div",8),C._uU(1),C.qZA()),2&st){const Pe=C.oxw();C.Tol(Pe.options.messageClass),C.uIk("aria-label",Pe.message),C.xp6(1),C.hij(" ",Pe.message," ")}}function Gt(st,Ne){if(1&st&&(C.TgZ(0,"div"),C._UZ(1,"div",9),C.qZA()),2&st){const Pe=C.oxw();C.xp6(1),C.Udp("width",Pe.width+"%")}}class hi{constructor(Ne,Pe){this.component=Ne,this.injector=Pe}attach(Ne,Pe){return this._attachedHost=Ne,Ne.attach(this,Pe)}detach(){const Ne=this._attachedHost;if(Ne)return this._attachedHost=void 0,Ne.detach()}get isAttached(){return null!=this._attachedHost}setAttachedHost(Ne){this._attachedHost=Ne}}class Te{attach(Ne,Pe){return this._attachedPortal=Ne,this.attachComponentPortal(Ne,Pe)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(Ne){this._disposeFn=Ne}}class _t{constructor(Ne){this._overlayRef=Ne,this.duplicatesCount=0,this._afterClosed=new s.x,this._activate=new s.x,this._manualClose=new s.x,this._resetTimeout=new s.x,this._countDuplicate=new s.x}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(Ne,Pe){Ne&&this._resetTimeout.next(),Pe&&this._countDuplicate.next(++this.duplicatesCount)}}class Ue{constructor(Ne,Pe,Ke,Bt,mi,Di){this.toastId=Ne,this.config=Pe,this.message=Ke,this.title=Bt,this.toastType=mi,this.toastRef=Di,this._onTap=new s.x,this._onAction=new s.x,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(Ne){this._onAction.next(Ne)}onAction(){return this._onAction.asObservable()}}const Pt=new C.OlP("ToastConfig");class je extends Te{constructor(Ne,Pe,Ke){super(),this._hostDomElement=Ne,this._componentFactoryResolver=Pe,this._appRef=Ke}attachComponentPortal(Ne,Pe){const Ke=this._componentFactoryResolver.resolveComponentFactory(Ne.component);let Bt;return Bt=Ke.create(Ne.injector),this._appRef.attachView(Bt.hostView),this.setDisposeFn(()=>{this._appRef.detachView(Bt.hostView),Bt.destroy()}),Pe?this._hostDomElement.insertBefore(this._getComponentRootNode(Bt),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(Bt)),Bt}_getComponentRootNode(Ne){return Ne.hostView.rootNodes[0]}}let Ze=(()=>{class st{constructor(){this._document=(0,C.f3M)(Xe.K0)}ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const Pe=this._document.createElement("div");Pe.classList.add("overlay-container"),Pe.setAttribute("aria-live","polite"),this._document.body.appendChild(Pe),this._containerElement=Pe}}return st.\u0275fac=function(Pe){return new(Pe||st)},st.\u0275prov=C.Yz7({token:st,factory:st.\u0275fac,providedIn:"root"}),st})();class ot{constructor(Ne){this._portalHost=Ne}attach(Ne,Pe=!0){return this._portalHost.attach(Ne,Pe)}detach(){return this._portalHost.detach()}}let pt=(()=>{class st{constructor(){this._overlayContainer=(0,C.f3M)(Ze),this._componentFactoryResolver=(0,C.f3M)(C._Vd),this._appRef=(0,C.f3M)(C.z2F),this._document=(0,C.f3M)(Xe.K0),this._paneElements=new Map}create(Pe,Ke){return this._createOverlayRef(this.getPaneElement(Pe,Ke))}getPaneElement(Pe="",Ke){return this._paneElements.get(Ke)||this._paneElements.set(Ke,{}),this._paneElements.get(Ke)[Pe]||(this._paneElements.get(Ke)[Pe]=this._createPaneElement(Pe,Ke)),this._paneElements.get(Ke)[Pe]}_createPaneElement(Pe,Ke){const Bt=this._document.createElement("div");return Bt.id="toast-container",Bt.classList.add(Pe),Bt.classList.add("toast-container"),Ke?Ke.getContainerElement().appendChild(Bt):this._overlayContainer.getContainerElement().appendChild(Bt),Bt}_createPortalHost(Pe){return new je(Pe,this._componentFactoryResolver,this._appRef)}_createOverlayRef(Pe){return new ot(this._createPortalHost(Pe))}}return st.\u0275fac=function(Pe){return new(Pe||st)},st.\u0275prov=C.Yz7({token:st,factory:st.\u0275fac,providedIn:"root"}),st})(),Ot=(()=>{class st{constructor(Pe,Ke,Bt,mi,Di){this.overlay=Ke,this._injector=Bt,this.sanitizer=mi,this.ngZone=Di,this.currentlyActive=0,this.toasts=[],this.index=0,this.toastrConfig={...Pe.default,...Pe.config},Pe.config.iconClasses&&(this.toastrConfig.iconClasses={...Pe.default.iconClasses,...Pe.config.iconClasses})}show(Pe,Ke,Bt={},mi=""){return this._preBuildNotification(mi,Pe,Ke,this.applyConfig(Bt))}success(Pe,Ke,Bt={}){return this._preBuildNotification(this.toastrConfig.iconClasses.success||"",Pe,Ke,this.applyConfig(Bt))}error(Pe,Ke,Bt={}){return this._preBuildNotification(this.toastrConfig.iconClasses.error||"",Pe,Ke,this.applyConfig(Bt))}info(Pe,Ke,Bt={}){return this._preBuildNotification(this.toastrConfig.iconClasses.info||"",Pe,Ke,this.applyConfig(Bt))}warning(Pe,Ke,Bt={}){return this._preBuildNotification(this.toastrConfig.iconClasses.warning||"",Pe,Ke,this.applyConfig(Bt))}clear(Pe){for(const Ke of this.toasts)if(void 0!==Pe){if(Ke.toastId===Pe)return void Ke.toastRef.manualClose()}else Ke.toastRef.manualClose()}remove(Pe){const Ke=this._findToast(Pe);if(!Ke||(Ke.activeToast.toastRef.close(),this.toasts.splice(Ke.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){const Bt=this.toasts[this.currentlyActive].toastRef;Bt.isInactive()||(this.currentlyActive=this.currentlyActive+1,Bt.activate())}return!0}findDuplicate(Pe="",Ke="",Bt,mi){const{includeTitleDuplicates:Di}=this.toastrConfig;for(const Ii of this.toasts)if((!Di||Di&&Ii.title===Pe)&&Ii.message===Ke)return Ii.toastRef.onDuplicate(Bt,mi),Ii;return null}applyConfig(Pe={}){return{...this.toastrConfig,...Pe}}_findToast(Pe){for(let Ke=0;Ke<this.toasts.length;Ke++)if(this.toasts[Ke].toastId===Pe)return{index:Ke,activeToast:this.toasts[Ke]};return null}_preBuildNotification(Pe,Ke,Bt,mi){return mi.onActivateTick?this.ngZone.run(()=>this._buildNotification(Pe,Ke,Bt,mi)):this._buildNotification(Pe,Ke,Bt,mi)}_buildNotification(Pe,Ke,Bt,mi){if(!mi.toastComponent)throw new Error("toastComponent required");const Di=this.findDuplicate(Bt,Ke,this.toastrConfig.resetTimeoutOnDuplicate&&mi.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&Bt||Ke)&&this.toastrConfig.preventDuplicates&&null!==Di)return Di;this.previousToastMessage=Ke;let Ii=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(Ii=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));const Gi=this.overlay.create(mi.positionClass,this.overlayContainer);this.index=this.index+1;let Br=Ke;Ke&&mi.enableHtml&&(Br=this.sanitizer.sanitize(C.q3G.HTML,Ke));const Hr=new _t(Gi),Ur=new Ue(this.index,mi,Br,Bt,Pe,Hr),Xi=C.zs3.create({providers:[{provide:Ue,useValue:Ur}],parent:this._injector}),Rs=new hi(mi.toastComponent,Xi),$r=Gi.attach(Rs,mi.newestOnTop);Hr.componentInstance=$r.instance;const Ji={toastId:this.index,title:Bt||"",message:Ke||"",toastRef:Hr,onShown:Hr.afterActivate(),onHidden:Hr.afterClosed(),onTap:Ur.onTap(),onAction:Ur.onAction(),portal:$r};return Ii||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{Ji.toastRef.activate()})),this.toasts.push(Ji),Ji}}return st.\u0275fac=function(Pe){return new(Pe||st)(C.LFG(Pt),C.LFG(pt),C.LFG(C.zs3),C.LFG(ct.H7),C.LFG(C.R0b))},st.\u0275prov=C.Yz7({token:st,factory:st.\u0275fac,providedIn:"root"}),st})(),Xt=(()=>{class st{get displayStyle(){if("inactive"===this.state.value)return"none"}constructor(Pe,Ke,Bt){this.toastrService=Pe,this.toastPackage=Ke,this.ngZone=Bt,this.width=-1,this.toastClasses="",this.state={value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}},this.message=Ke.message,this.title=Ke.title,this.options=Ke.config,this.originalTimeout=Ke.config.timeOut,this.toastClasses=`${Ke.toastType} ${Ke.config.toastClass}`,this.sub=Ke.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=Ke.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=Ke.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=Ke.toastRef.countDuplicate().subscribe(mi=>{this.duplicatesCount=mi})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state={...this.state,value:"active"},!0!==this.options.disableTimeOut&&"timeOut"!==this.options.disableTimeOut&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=(new Date).getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(0===this.width||100===this.width||!this.options.timeOut)return;const Pe=(new Date).getTime();this.width=(this.hideTime-Pe)/this.options.timeOut*100,"increasing"===this.options.progressAnimation&&(this.width=100-this.width),this.width<=0&&(this.width=0),this.width>=100&&(this.width=100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state={...this.state,value:"active"},this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=(new Date).getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){"removed"!==this.state.value&&(clearTimeout(this.timeout),this.state={...this.state,value:"removed"},this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){"removed"!==this.state.value&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){"removed"!==this.state.value&&"extendedTimeOut"!==this.options.disableTimeOut&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width=0)}delayedHideToast(){!0===this.options.disableTimeOut||"extendedTimeOut"===this.options.disableTimeOut||0===this.options.extendedTimeOut||"removed"===this.state.value||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=(new Date).getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(Pe,Ke){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(Pe),Ke)):this.timeout=setTimeout(()=>Pe(),Ke)}outsideInterval(Pe,Ke){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(Pe),Ke)):this.intervalId=setInterval(()=>Pe(),Ke)}runInsideAngular(Pe){this.ngZone?this.ngZone.run(()=>Pe()):Pe()}}return st.\u0275fac=function(Pe){return new(Pe||st)(C.Y36(Ot),C.Y36(Ue),C.Y36(C.R0b))},st.\u0275cmp=C.Xpm({type:st,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(Pe,Ke){1&Pe&&C.NdJ("click",function(){return Ke.tapToast()})("mouseenter",function(){return Ke.stickAround()})("mouseleave",function(){return Ke.delayedHideToast()}),2&Pe&&(C.d8E("@flyInOut",Ke.state),C.Tol(Ke.toastClasses),C.Udp("display",Ke.displayStyle))},standalone:!0,features:[C.jDz],attrs:de,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(Pe,Ke){1&Pe&&(C.YNc(0,Et,3,0,"button",0),C.YNc(1,gt,3,5,"div",1),C.YNc(2,jt,1,3,"div",2),C.YNc(3,wt,2,4,"div",3),C.YNc(4,Gt,2,2,"div",4)),2&Pe&&(C.Q6J("ngIf",Ke.options.closeButton),C.xp6(1),C.Q6J("ngIf",Ke.title),C.xp6(1),C.Q6J("ngIf",Ke.message&&Ke.options.enableHtml),C.xp6(1),C.Q6J("ngIf",Ke.message&&!Ke.options.enableHtml),C.xp6(1),C.Q6J("ngIf",Ke.options.progressBar))},dependencies:[Xe.O5],encapsulation:2,data:{animation:[(0,De.X$)("flyInOut",[(0,De.SB)("inactive",(0,De.oB)({opacity:0})),(0,De.SB)("active",(0,De.oB)({opacity:1})),(0,De.SB)("removed",(0,De.oB)({opacity:0})),(0,De.eR)("inactive => active",(0,De.jt)("{{ easeTime }}ms {{ easing }}")),(0,De.eR)("active => removed",(0,De.jt)("{{ easeTime }}ms {{ easing }}"))])]}}),st})();const Mi={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing",toastComponent:Xt},Wi=(st={})=>(0,C.MR2)([{provide:Pt,useValue:{default:Mi,config:st}}]);let ti=(()=>{class st{static forRoot(Pe={}){return{ngModule:st,providers:[Wi(Pe)]}}}return st.\u0275fac=function(Pe){return new(Pe||st)},st.\u0275mod=C.oAB({type:st}),st.\u0275inj=C.cJS({imports:[Xt]}),st})()},8909:(yi,on,ue)=>{"use strict";ue.d(on,{LI:()=>Ye,Of:()=>Vn,pm:()=>Ue,wH:()=>Pt});var C=ue(1571),De=ue(9838),Xe=ue(9300),s=ue(4004),ct=ue(1135),de=ue(6895);function Et(je,Ze){1&je&&C.GkF(0)}function qt(je,Ze){if(1&je&&(C.ynx(0),C._uU(1),C.BQk()),2&je){const ot=C.oxw(2).$implicit;C.xp6(1),C.Oqu(ot.label)}}const gt=function(je){return{"xng-breadcrumb-link-disabled":je}},jt=function(je,Ze,ot,pt,Ot,Xt){return{$implicit:je,info:Ze,last:ot,first:pt,index:Ot,count:Xt}};function wt(je,Ze){if(1&je&&(C.TgZ(0,"a",7),C.YNc(1,Et,1,0,"ng-container",8),C.YNc(2,qt,2,1,"ng-container",9),C.qZA()),2&je){const ot=C.oxw(),pt=ot.$implicit,Ot=ot.last,Xt=ot.first,Mi=ot.index,Wi=ot.count,ti=C.oxw();C.Q6J("ngClass",C.VKq(10,gt,pt.disable))("routerLink",pt.routeInterceptor?pt.routeInterceptor(pt.routeLink,pt):pt.routeLink)("queryParams",ti.preserveQueryParams?pt.queryParams:void 0)("fragment",ti.preserveFragment?pt.fragment:void 0)("target",ti.anchorTarget?ti.anchorTarget:"_self"),C.uIk("aria-disabled",pt.disable)("tabIndex",pt.disable?-1:0),C.xp6(1),C.Q6J("ngTemplateOutlet",ti.itemTemplate)("ngTemplateOutletContext",C.HTZ(12,jt,pt.label,pt.info,Ot,Xt,Mi,Wi)),C.xp6(1),C.Q6J("ngIf",!ti.itemTemplate)}}function Gt(je,Ze){1&je&&C.GkF(0)}function Kn(je,Ze){if(1&je&&(C.ynx(0),C._uU(1),C.BQk()),2&je){const ot=C.oxw(2).$implicit;C.xp6(1),C.Oqu(ot.label)}}function Sn(je,Ze){if(1&je&&(C.TgZ(0,"label",10),C.YNc(1,Gt,1,0,"ng-container",8),C.YNc(2,Kn,2,1,"ng-container",9),C.qZA()),2&je){const ot=C.oxw(),pt=ot.$implicit,Ot=ot.last,Xt=ot.first,Mi=ot.index,Wi=ot.count,ti=C.oxw();C.xp6(1),C.Q6J("ngTemplateOutlet",ti.itemTemplate)("ngTemplateOutletContext",C.HTZ(3,jt,pt.label,pt.info,Ot,Xt,Mi,Wi)),C.xp6(1),C.Q6J("ngIf",!ti.itemTemplate)}}function En(je,Ze){1&je&&C.GkF(0)}function dn(je,Ze){if(1&je&&(C.ynx(0),C._uU(1),C.BQk()),2&je){const ot=C.oxw(3);C.xp6(1),C.Oqu(ot.separator)}}function ii(je,Ze){if(1&je&&(C.TgZ(0,"li",11),C.YNc(1,En,1,0,"ng-container",12),C.YNc(2,dn,2,1,"ng-container",9),C.qZA()),2&je){const ot=C.oxw(2);C.xp6(1),C.Q6J("ngTemplateOutlet",ot.separatorTemplate),C.xp6(1),C.Q6J("ngIf",!ot.separatorTemplate)}}function hn(je,Ze){if(1&je&&(C.ynx(0),C.TgZ(1,"li",3),C.YNc(2,wt,3,19,"a",4),C.YNc(3,Sn,3,10,"label",5),C.qZA(),C.YNc(4,ii,3,2,"li",6),C.BQk()),2&je){const ot=Ze.last;C.xp6(2),C.Q6J("ngIf",!ot),C.xp6(1),C.Q6J("ngIf",ot),C.xp6(1),C.Q6J("ngIf",!ot)}}let Vn=(()=>{class je{}return je.\u0275fac=function(ot){return new(ot||je)},je.\u0275dir=C.lG2({type:je,selectors:[["","xngBreadcrumbItem",""]]}),je})();const _t=je=>je&&Object.keys(je).length>0;let Ue=(()=>{class je{constructor(ot,pt){this.activatedRoute=ot,this.router=pt,this.baseHref="/",this.dynamicBreadcrumbStore=[],this.currentBreadcrumbs=[],this.previousBreadcrumbs=[],this.breadcrumbs=new ct.X([]),this.breadcrumbs$=this.breadcrumbs.asObservable(),this.detectRouteChanges()}detectRouteChanges(){this.setupBreadcrumbs(this.activatedRoute.snapshot),this.router.events.pipe((0,Xe.h)(ot=>ot instanceof De.c9)).subscribe(ot=>{ot.shouldActivate&&this.setupBreadcrumbs(ot.state.root)})}setupBreadcrumbs(ot){this.previousBreadcrumbs=this.currentBreadcrumbs;const pt=this.getRootBreadcrumb();this.currentBreadcrumbs=pt?[pt]:[],this.prepareBreadcrumbList(ot,this.baseHref)}getRootBreadcrumb(){const ot=this.router.config.find(Xt=>""===Xt.path),pt=this.extractObject(ot?.data?.breadcrumb),Ot=this.getFromStore(pt.alias,"/");if(_t(pt)||_t(Ot))return{...Ot,...pt,routeLink:this.baseHref,...this.getQueryParamsFromPreviousList("/")}}prepareBreadcrumbItem(ot,pt){const{path:Ot,breadcrumb:Xt}=this.parseRouteData(ot.routeConfig),Mi=this.resolvePathSegment(Ot,ot),Wi=`${pt}${Mi}`,ti=this.getFromStore(Xt.alias,Wi),Tn=this.extractLabel(ti?.label||Xt?.label,Mi);let rt=!1,xt="";return Tn||(rt=!0,xt=Mi),{...ti,...Xt,label:rt?xt:Tn,routeLink:Wi,isAutoGeneratedLabel:rt,...this.getQueryParamsFromPreviousList(Wi)}}prepareBreadcrumbList(ot,pt){if(ot.routeConfig?.path){const Mi=this.prepareBreadcrumbItem(ot,pt);if(this.currentBreadcrumbs.push(Mi),ot.firstChild)return this.prepareBreadcrumbList(ot.firstChild,Mi.routeLink+"/")}else if(ot.firstChild)return this.prepareBreadcrumbList(ot.firstChild,pt);this.setQueryParamsForActiveBreadcrumb(this.currentBreadcrumbs[this.currentBreadcrumbs.length-1],ot);const Xt=this.currentBreadcrumbs.filter(Mi=>!Mi.skip);this.breadcrumbs.next(Xt)}getFromStore(ot,pt){return this.dynamicBreadcrumbStore.find(Ot=>ot&&ot===Ot.alias||pt&&pt===Ot.routeLink||this.matchRegex(pt,Ot.routeRegex))}matchRegex(ot,pt){return ot.match(new RegExp(pt))?.[0]===ot}resolvePathSegment(ot,pt){return ot.includes(":")&&Object.entries(pt.params).forEach(([Ot,Xt])=>{ot=ot.replace(`:${Ot}`,`${Xt}`)}),ot}getQueryParamsFromPreviousList(ot){const{queryParams:pt,fragment:Ot}=this.previousBreadcrumbs.find(Xt=>Xt.routeLink===ot)||{};return{queryParams:pt,fragment:Ot}}setQueryParamsForActiveBreadcrumb(ot,pt){if(ot){const{queryParams:Ot,fragment:Xt}=pt;ot.queryParams=Ot?{...Ot}:void 0,ot.fragment=Xt}}parseRouteData(ot){const{path:pt,data:Ot}=ot;return{path:pt,breadcrumb:this.mergeWithBaseChildData(ot,Ot?.breadcrumb)}}mergeWithBaseChildData(ot,pt){if(!ot)return this.extractObject(pt);let Ot;ot.loadChildren?Ot=ot._loadedRoutes.find(Mi=>""===Mi.path):ot.children&&(Ot=ot.children.find(Mi=>""===Mi.path));const Xt=Ot?.data?.breadcrumb;return Xt?this.mergeWithBaseChildData(Ot,{...this.extractObject(pt),...this.extractObject(Xt)}):this.extractObject(pt)}set(ot,pt){const Ot=this.extractObject(pt);let Xt;Xt=ot.startsWith("@")?["alias",{...Ot,alias:ot.slice(1)}]:ot.includes(":")?["routeRegex",{...Ot,routeRegex:this.buildRegex(ot)}]:["routeLink",{...Ot,routeLink:this.ensureLeadingSlash(ot)}],Xt[1].isAutoGeneratedLabel=!1,this.updateStore(...Xt),this.updateCurrentBreadcrumbs(...Xt)}updateStore(ot,pt){const Ot=this.dynamicBreadcrumbStore.findIndex(Xt=>pt[ot]===Xt[ot]);Ot>-1?this.dynamicBreadcrumbStore[Ot]={...this.dynamicBreadcrumbStore[Ot],...pt}:this.dynamicBreadcrumbStore.push({...pt})}updateCurrentBreadcrumbs(ot,pt){const Ot=this.currentBreadcrumbs.findIndex(Xt=>"routeRegex"===ot?this.matchRegex(Xt.routeLink,pt[ot]):pt[ot]===Xt[ot]);if(Ot>-1){this.currentBreadcrumbs[Ot]={...this.currentBreadcrumbs[Ot],...pt};const Xt=this.currentBreadcrumbs.filter(Mi=>!Mi.skip);this.breadcrumbs.next([...Xt])}}buildRegex(ot){return this.ensureLeadingSlash(ot).replace(new RegExp("/:[^/]+","g"),"/[^/]+")}ensureLeadingSlash(ot){return ot.startsWith("/")?ot:`/${ot}`}extractLabel(ot,pt){const Ot="object"==typeof ot?ot.label:ot;return"function"==typeof Ot?Ot(pt):Ot}extractObject(ot){return!ot||"string"!=typeof ot&&"function"!=typeof ot?ot||{}:{label:ot}}}return je.\u0275fac=function(ot){return new(ot||je)(C.LFG(De.gz),C.LFG(De.F0))},je.\u0275prov=C.Yz7({token:je,factory:je.\u0275fac,providedIn:"root"}),je})(),Ye=(()=>{class je{constructor(ot,pt){this.breadcrumbService=ot,this._separator="/",this.autoGenerate=!0,this.preserveQueryParams=!0,this.preserveFragment=!0,this.class="",this.setupMessage="not set up yet",this.someParameterValue=null,pt.params.subscribe(Ot=>{this.setupComponent(Ot.someParam)})}set separator(ot){ot instanceof C.Rgc?(this.separatorTemplate=ot,this._separator=void 0):(this.separatorTemplate=void 0,this._separator=ot||"/")}get separator(){return this._separator}setupComponent(ot){this.setupMessage="set up at "+new Date,this.someParameterValue=ot}ngOnInit(){this.breadcrumbs$=this.breadcrumbService.breadcrumbs$.pipe((0,s.U)(ot=>ot.filter(pt=>!!this.autoGenerate||!pt.isAutoGeneratedLabel).map(pt=>{const{routeInterceptor:Ot,routeLink:Xt}=pt;return{...pt,routeLink:Ot?.(Xt,pt)||Xt}})))}}return je.\u0275fac=function(ot){return new(ot||je)(C.Y36(Ue),C.Y36(De.gz))},je.\u0275cmp=C.Xpm({type:je,selectors:[["xng-breadcrumb"]],contentQueries:function(ot,pt,Ot){if(1&ot&&C.Suo(Ot,Vn,5,C.Rgc),2&ot){let Xt;C.iGM(Xt=C.CRH())&&(pt.itemTemplate=Xt.first)}},inputs:{autoGenerate:"autoGenerate",preserveQueryParams:"preserveQueryParams",preserveFragment:"preserveFragment",class:"class",anchorTarget:"anchorTarget",separator:"separator"},decls:4,vars:4,consts:[["aria-label","breadcrumb",1,"xng-breadcrumb-root",3,"ngClass"],[1,"xng-breadcrumb-list"],[4,"ngFor","ngForOf"],[1,"xng-breadcrumb-item"],["class","xng-breadcrumb-link","role","button","rel","noopener noreferrer",3,"ngClass","routerLink","queryParams","fragment","target",4,"ngIf"],["class","xng-breadcrumb-trail",4,"ngIf"],["class","xng-breadcrumb-separator","aria-hidden","true",4,"ngIf"],["role","button","rel","noopener noreferrer",1,"xng-breadcrumb-link",3,"ngClass","routerLink","queryParams","fragment","target"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf"],[1,"xng-breadcrumb-trail"],["aria-hidden","true",1,"xng-breadcrumb-separator"],[4,"ngTemplateOutlet"]],template:function(ot,pt){1&ot&&(C.TgZ(0,"nav",0)(1,"ol",1),C.YNc(2,hn,5,3,"ng-container",2),C.ALo(3,"async"),C.qZA()()),2&ot&&(C.Q6J("ngClass",pt.class),C.xp6(2),C.Q6J("ngForOf",C.lcZ(3,2,pt.breadcrumbs$)))},dependencies:[de.mk,de.sg,de.O5,de.tP,De.rH,de.Ov],styles:[".xng-breadcrumb-root{margin:0;color:#0009}.xng-breadcrumb-list{display:flex;align-items:center;flex-wrap:wrap;margin:0;padding:0}.xng-breadcrumb-item{list-style:none}.xng-breadcrumb-trail{display:flex;align-items:center;color:#000000e6}.xng-breadcrumb-link{display:flex;align-items:center;white-space:nowrap;color:inherit;text-decoration:none;transition:-webkit-text-decoration .3s;transition:text-decoration .3s;transition:text-decoration .3s,-webkit-text-decoration .3s;cursor:pointer}.xng-breadcrumb-link:hover{text-decoration:underline}.xng-breadcrumb-link-disabled{pointer-events:none;cursor:disabled}.xng-breadcrumb-separator{display:flex;-webkit-user-select:none;user-select:none;margin-left:8px;margin-right:8px}\n"],encapsulation:2}),je})(),Pt=(()=>{class je{}return je.\u0275fac=function(ot){return new(ot||je)},je.\u0275mod=C.oAB({type:je}),je.\u0275inj=C.cJS({imports:[de.ez,De.Bz]}),je})()},7582:(yi,on,ue)=>{"use strict";function Gt(rt,xt,ht,st){return new(ht||(ht=Promise))(function(Pe,Ke){function Bt(Ii){try{Di(st.next(Ii))}catch(Gi){Ke(Gi)}}function mi(Ii){try{Di(st.throw(Ii))}catch(Gi){Ke(Gi)}}function Di(Ii){Ii.done?Pe(Ii.value):function Ne(Pe){return Pe instanceof ht?Pe:new ht(function(Ke){Ke(Pe)})}(Ii.value).then(Bt,mi)}Di((st=st.apply(rt,xt||[])).next())})}function Te(rt){return this instanceof Te?(this.v=rt,this):new Te(rt)}function _t(rt,xt,ht){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ne,st=ht.apply(rt,xt||[]),Pe=[];return Ne={},Ke("next"),Ke("throw"),Ke("return"),Ne[Symbol.asyncIterator]=function(){return this},Ne;function Ke(Br){st[Br]&&(Ne[Br]=function(Hr){return new Promise(function(Ur,Si){Pe.push([Br,Hr,Ur,Si])>1||Bt(Br,Hr)})})}function Bt(Br,Hr){try{!function mi(Br){Br.value instanceof Te?Promise.resolve(Br.value.v).then(Di,Ii):Gi(Pe[0][2],Br)}(st[Br](Hr))}catch(Ur){Gi(Pe[0][3],Ur)}}function Di(Br){Bt("next",Br)}function Ii(Br){Bt("throw",Br)}function Gi(Br,Hr){Br(Hr),Pe.shift(),Pe.length&&Bt(Pe[0][0],Pe[0][1])}}function Ye(rt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ht,xt=rt[Symbol.asyncIterator];return xt?xt.call(rt):(rt=function dn(rt){var xt="function"==typeof Symbol&&Symbol.iterator,ht=xt&&rt[xt],st=0;if(ht)return ht.call(rt);if(rt&&"number"==typeof rt.length)return{next:function(){return rt&&st>=rt.length&&(rt=void 0),{value:rt&&rt[st++],done:!rt}}};throw new TypeError(xt?"Object is not iterable.":"Symbol.iterator is not defined.")}(rt),ht={},st("next"),st("throw"),st("return"),ht[Symbol.asyncIterator]=function(){return this},ht);function st(Pe){ht[Pe]=rt[Pe]&&function(Ke){return new Promise(function(Bt,mi){!function Ne(Pe,Ke,Bt,mi){Promise.resolve(mi).then(function(Di){Pe({value:Di,done:Bt})},Ke)}(Bt,mi,(Ke=rt[Pe](Ke)).done,Ke.value)})}}}ue.d(on,{FC:()=>_t,KL:()=>Ye,mG:()=>Gt,qq:()=>Te}),"function"==typeof SuppressedError&&SuppressedError}},yi=>{yi(yi.s=4133)}]);